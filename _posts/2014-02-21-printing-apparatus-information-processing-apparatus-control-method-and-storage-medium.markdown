---

title: Printing apparatus, information processing apparatus, control method, and storage medium
abstract: If a request for first element data and second element data is received, delay data indicating that notification of the second element data is to be delayed and the first element data are sent as response data in response to the received request, and thereafter notification of the second element data is sent.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09317228&OS=09317228&RS=09317228
owner: Canon Kabushiki Kaisha
number: 09317228
owner_city: Tokyo
owner_country: JP
publication_date: 20140221
---
The present subject matter relates to a technique for communication between an information processing apparatus and a printing apparatus.

Print Service Definition v1.1 for Web Services on Devices referred to herein as Non Patent Literature Document 1 discusses a technique by which a client computer requests a specific element from a printer and a technique by which the printer responds with the specific element.

A situation is assumed in which there is a limitation on the size of response data with which an image processing apparatus responds and the image processing apparatus cannot respond or an error occurs if the size of the response data exceeds the size limit.

However Non Patent Document 1 does not consider the situations in which the size of response data exceeds the size limit at the time of responding. Thus when the technique discussed in Non Patent Document 1 is used in the above situations responding may be impossible or an error may occur.

The present subject matter is directed to a technique capable of reducing the possibility that the size of response data exceeds a size limit.

According to an aspect of the present subject matter an image processing apparatus includes a receiving unit configured to receive a request for first element data and second element data a responding unit configured to respond with delay data indicating that notification of the second element data is to be delayed and the first element data as response data in response to the request received by the receiving unit if the receiving unit receives the request for the first element data and the second element data and a notifying unit configured to notify the second element data after the responding unit responds with the response data.

According to another aspect of the present subject matter an information processing apparatus includes a first requesting unit configured to send a request for element data to an image processing apparatus a receiving unit configured to receive response data in response to the request after the first requesting unit sends the request a determining unit configured to determine whether the response data includes information indicating that the element data is to be acquired again and a second requesting unit configured to send a request for the element data again to the image processing apparatus if the determining unit determines that the response data includes the information indicating that the element data is to be acquired again.

Further features of the present subject matter will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

Various exemplary embodiments features and aspects of the subject matter will be described in detail below with reference to the drawings. It is noted that the following exemplary embodiments are in no way intended to limit the scope of the invention according to the claims and all combinations of features described in the exemplary embodiments are not necessarily essential.

Standardization has been promoted in the field of network printing systems in which a plurality of information processing apparatuses shares a printing apparatus that is an example of an image processing apparatus. An example of a network printing system using Web Services on Devices WSD for printing will be described. In the network printing system an event based protocol can be used. Furthermore using an event notified from the printing apparatus to the information processing apparatuses the information processing apparatuses can execute various controls based on the event. For example the printing apparatus notifies the information processing apparatuses of the current status of the printing apparatus by using a PrinterElementsChange event which notifies that the status has been changed.

Meanwhile if an information processing apparatus that is newly connected to the network only uses event based information notification processing the information processing apparatus does not receive notification about the status of the printing apparatus until the status of the printing apparatus is changed after the information processing apparatus is connected to the network. In other words applications running in the information processing apparatus that is newly connected to the network cannot have information about the printing apparatus until the status of the printing apparatus is changed next. Thus a unit is provided to enable the information processing apparatus to send an active request for information about the printing apparatus GetPrinterElementsRequest Operation . When a connection is established between the printing apparatus and the information processing apparatus that is newly connected to the network the information processing apparatus first requests various types of information about the printing apparatus so that the information processing apparatus can acquire information about the printing apparatus.

A GetPrinterElementsRequest is designed so that an acquisition request for a plurality of pieces of information can be made at one time. A GetPrinterElementsResponse which is a response to the acquisition request is designed so that a GetPrinterElementsRequest sent at one time is responded at one time.

However with the high performance of the recent printing apparatuses the size of information of a printing apparatus has increased. The size of a GetPrinterElementsResponse that can be received by an information processing apparatus is limited. The size of a GetPrinterElementsResponse which is a response to a GetPrinterElementsRequest may exceed a data size that can be received by an information processing apparatus. If an information acquisition request is sent one by one so as not to exceed the size limit of received data the size of received data in response to one request is reduced. However the responding processing load of the printing apparatus increases because a plurality of responses needs to be sent in response to a plurality of GetPrinterElementsRequests. A system that can solve the above problem is described below.

Configurations of an information processing apparatus and a printing apparatus according to the present exemplary embodiment will be described below with reference to .

An information processing apparatus includes an input interface a central processing unit CPU a read only memory ROM a random access memory RAM an external storage device an output interface a display unit a keyboard a mouse and a network interface . The network interface is connected to a network via a network cable . The ROM stores an initialization program. The external storage device stores application programs an operating system OS a printer driver and various types of data. The RAM is used as a work memory by various programs stored in the external storage device . Furthermore the CPU executes processing based on a program stored in the external storage device whereby the software configuration of the information processing apparatus as illustrated in and processing of each step in flow charts described below are realized.

The printing apparatus includes a network interface a RAM a print engine a ROM and a CPU . The network interface is connected to the network via a network cable . The RAM is used as a main memory and a work memory for the CPU and stores various types of data and a receiving buffer for temporarily storing received print jobs. The print engine executes printing based on data stored in the RAM . The ROM stores various types of control programs such as a status management program and data used by each control program. The CPU controls each unit of the printing apparatus according to the control programs. The status management program is a program for monitoring the status of the printing apparatus based on information of various types of sensors not illustrated in the printing apparatus generating status information and storing the status information in the RAM . The printing apparatus generates response data and event data described below based on the generated status information. Furthermore the CPU executes processing based on a program stored in the ROM whereby processing of each step in the flow charts described below is realized.

While an example of how processing is assigned to the information processing apparatus and the printing apparatus is described above the form of assignment is not particularly limited to the above described example and any other form can be adopted.

The port monitor may be a standard port monitor preinstalled in the OS or a vendor specific port monitor.

The flow in which when information of the printing apparatus is changed the printing apparatus executes event notification to the information processing apparatus will be described. In step S the printing apparatus detects that information of the printing apparatus is changed and then in step S the printing apparatus generates event data and issues a PrinterElementsChangeEvent to the information processing apparatus . The PrinterElementsChangeEvent issuing processing is referred to as an event notification and content of the event notification is referred to as event data. The event notification is different from the information acquisition response in that the event notification can be transmitted even if the information processing apparatus does not request. Furthermore there is no ID associated with the event notification. In step S the information processing apparatus receives the event notification and then in step S the information processing apparatus updates information stored in the storage area S based on the received information.

As used herein the issuance of an information acquisition response in response to an information acquisition request when the information acquisition request is received is referred to as response whereas spontaneous transmission of event data without designating an associated ID as described above is referred to as notification .

A configuration in which the port monitor WSD port monitor of the OS executes processing that is to be executed on the information processing apparatus side to issue an information acquisition request receive response data receive event data and update the storage area S with received information is described.

The relationship between attribute information and an attribute value as used herein will be described with reference to a code as an example. In the code query ihv Status2 is attribute information and ihv Status enclosed in double quotation marks in the attribute information is an attribute value.

The attribute information query ihv Status of the code indicates that the printer driver in the information processing apparatus requires the element data ihv Status of the printing apparatus . The port monitor is informed that the element data ihv Status is required so that the port monitor operates to leave the element data ihv Status in the storage area S. In a code the attribute information query ihv Capability indicates that the printer driver in the information processing apparatus requires the element data ihv Capability of the printing apparatus . An element that begins with ihv such as ihv Status and ihv Capability is referred to as a private element. Element data that is enclosed in private elements in the XML configuration and with which an information acquisition response or event notification is sent to the information processing apparatus by the printing apparatus is referred to as data of a private element. The relationship between the element and the element data will be described below.

When the OS confirms that a connection has been established between the information processing apparatus and the printing apparatus the OS sends an information acquisition request to request the printing apparatus to acquire information of the printing apparatus . The information that the OS requests the printing apparatus to acquire includes WSD print service standard public elements public elements and also private elements described in the Bidi extension file .

The relationship between the element data and the element will be described with reference to a code illustrated in . As used herein a description enclosed in angle brackets such as and is referred to as an element. An element that includes no slash at the beginning is a start element. An element that includes a slash at the beginning is an end element. As used herein a description data between the start element and the end element is referred to as element data. As used herein the element data is sometimes referred to as data enclosed in elements.

Immediately after the connection is established between the information processing apparatus and the printing apparatus the OS requests a plurality of data at one time as illustrated in . However the size of information acquisition response data response data with which the printing apparatus responds to the information acquisition request is limited. A possible method to reduce the size of response data and obtain all pieces of information of the printing apparatus is to simply divide the public elements and the private elements and then send an information acquisition request for each one of the divided public elements and the divided private elements. However if all elements are divided to make an information acquisition request for each one of the divided elements the number of times the information processing apparatus sends an information acquisition request increases. Furthermore the load on the printing apparatus responding with response data to each information acquisition request also increases. Thus the information processing apparatus is demanded to request acquisition of as much information of the printing apparatus as possible at one time. Further since the OS is also likely to use the data of public elements it is not desirable to divide an information acquisition request to cause a delay in acquisition of information. Thus a method in which data of public elements is acquired at one time while acquisition of data of private elements is divided as many times as possible will be described below with reference to .

In the present exemplary embodiment the configuration in which event notification is executed immediately after the printing apparatus responds with the response data in step S has been described however the configuration is not limited to the example and the event notification may be executed together with notification to other information processing apparatuses when the information of the printing apparatus is changed next time.

As described above the element data of which notification can be delayed is not included is included as empty data in the response data to the information acquisition request and the element data is notified as event data whereby the size of the response data can be reduced.

The response data in a case in which element data of all elements requested by the printing apparatus is sent in response will be described with reference to . A code shows that the attribute information Name wsdst PrinterStatus and the attribute information Valid true are added to the element wsdst ElementData . The attribute value wsdst PrinterStatus indicates that the element data of wsdst ElementData is PrinterStatus . The attribute value true indicates that the data enclosed in the elements wsdst ElementData is valid. An element is the start element wsdst PrinterStatus and the element data PrinterStatus is stored between the start element and the end element. The element which is the start element wsdst PrinterStatus includes the prefix wsdst . This indicates that the element data PrinterStatus is a public element. An element is the start element wsdst DefaultPrintTicket and the element data DefaultPrintTicket which is a public element is stored between the start element and the end element. An element is the start element ihv Status and an element is the start element ihv Capability . The prefix ihv indicates that the elements and are private elements. The data Status and the element data Capability are stored between the start elements and end elements respectively. The response data illustrated in indicates that a plurality of pieces of data is returned at one time. Since the response data illustrated in includes data of a plurality of private elements and data of a plurality of public elements the size of the response data may exceed the size limit of data that can be received by the information processing apparatus .

On the other hand shows that the data Status in is returned in the form of empty data. A code shows that the attribute information Name ihv Status and the attribute information Valid false are added to the element wsdst ElementData . The element wsdst ElementData in the code is different from the element wsdst ElementData in the code in that the element wsdst ElementData in the code is empty data closed with at the end. The attribute value false indicates that element data of the element wsdst ElementData is invalid does not exist . A code is also empty data. The code is a response to the element data delay indicating that the element of the code may be empty data i.e. notification of the element can be delayed. Thus the printing apparatus responds with the code in the form of empty data.

The empty data can be indicated as null or data with no description other than the element closed with at the end.

As described above illustrates contents of an information acquisition request from which the data Status has been eliminated by the printing apparatus having referred to the Bidi extension file in and determined in the processing in step S in that the data of the element Status can be delayed. The printing apparatus responds with the information acquisition response illustrated in in the processing in step S in .

In the present exemplary embodiment the operation has been described on the assumption that the operation is an operation executed at the time when the OS sends an information acquisition request for element data of a plurality of elements in a batch immediately after the connection is established between the information processing apparatus and the printing apparatus . However the operation may be an operation executed at the time when software other than the OS in the information processing apparatus sends an information acquisition request for element data of a plurality of elements in a batch.

In the first exemplary embodiment the configuration has been described in which the private element corresponding to the private element to which the identifier  Delay indicating that notification of the element can be delayed is added is notified in the form of empty data which is an example of delay data whereby the size of the information acquisition response is prevented from exceeding the size limit.

In a second exemplary embodiment the configuration will be described in which only data of the public elements is sent in response while event notification of data of the private element is sent to overcome the problem. In the configuration of the present exemplary embodiment the information processing apparatus is not required to transmit the private element to which the identifier  Delay is added.

On the other hand in step S if the printing apparatus determines that the requested information includes both data of a public element and data of a private element YES in step S then in step S the printing apparatus stores the requested private element as event data in the storage area S. Thereafter in step S the printing apparatus generates response data including data of the requested public element and empty data of the requested private element. In step S the printing apparatus responds with the generated response data to the information processing apparatus . In step S the printing apparatus reads the event data stored in the storage area S and executes event notification by transmitting the event data to the information processing apparatus that has requested the acquisition of the information. In step S the printing apparatus ends the processing of the printing apparatus having received the information acquisition request.

As described above according to the present exemplary embodiment the printing apparatus responds with only the data of the public element while executing event notification of the data of the private element whereby the size of the information acquisition response can be reduced. When data of a plurality of private elements is to be transmitted to the information processing apparatus by event notification the printing apparatus may send event notification of the data of the plurality of private elements in a batch or may send event notification for each of the plurality of private elements.

In the second exemplary embodiment the configuration is described in which the data of the public elements is separated from the data of the private element steps S and S whereby the size of the information acquisition response is reduced.

In a third exemplary embodiment the configuration is described in which the event notification of the private element is executed only if the size of the response data exceeds the size limit to overcome the problem.

On the other hand in step S if the printing apparatus determines that the size of the response data exceeds the size limit YES in step S then in step S the printing apparatus eliminates the data of one or more private elements from the response data and stores the eliminated data of the private elements in the storage area S. The elimination of data of a private element refers to changing the data of the private element to be eliminated from response data into empty data such as the empty data illustrated in . In step S the printing apparatus responds to the information processing apparatus with the response data from which the data of the private elements has been eliminated in the processing in step S. In step S the printing apparatus reads the element data of the private elements stored in the storage area S and sends event notification of the element data of the private elements as event data to the information processing apparatus that has requested the acquisition of the information. In step S the printing apparatus ends the processing of the printing apparatus having received the information acquisition request.

As described above in the present exemplary embodiment the printing apparatus sends event notification of the element data of the private elements only if the size of the response data exceeds the size limit whereby the size of the information acquisition response can be reduced as appropriate.

In the first to third exemplary embodiments event notification of the data of the private elements is executed so that the size of the information acquisition response does not exceed the size limit.

In a fourth exemplary embodiment the information processing apparatus divides an information acquisition request and sends the divided information acquisition requests separately to overcome the problem. However it is a waste of communications for the information processing apparatus to separate all elements of an information acquisition request and then request each one of the elements after the connection is established between the information processing apparatus and the printing apparatus . Furthermore depending on software OS and printer driver application in the information processing apparatus there may be element data that is desirably acquired promptly after the connection with the printing apparatus is established. Thus the element data to be requested separately is desirably element data that is data of a private element and does not cause any problem even if the element data is not acquired promptly after the connection is established between the information processing apparatus and the printing apparatus .

Examples of element data that is desirably acquired promptly after the connection with the printing apparatus is established include information Capability indicating the printing capability of the printing apparatus . Based on the information Capability the OS generates settable information such as the size and type of sheet that can be used as print settings of the application . Users demand that the print settings of the application to which the settable information is applied can be used promptly after the information processing apparatus and the printing apparatus are connected.

The determination in step S is conducted by determining whether the data of the private element to be requested is described in the Bidi extension file. If the data of the private element to be requested is not described in the Bidi extension file the information processing apparatus determines that the element data to be requested is only the data of the public element requested by the OS. Thus the result of the determination in step S is YES . On the other hand if the data of the private element to be requested is described in the Bidi extension file the information processing apparatus determines that the element data to be requested is the data of the public element requested by the OS and the data of the private element requested by the Bidi extension file. Thus the result of the determination in step S is NO .

In step S after the information processing apparatus acquires response data in response to the processing in step S the information processing apparatus stores the acquired response data in a storage area S and then in step S the information processing apparatus ends the information acquisition request processing.

On the other hand in the determination in step S if the information processing apparatus determines that the data of the element to be acquired is not only the data of the public element NO in step S then in step S the information processing apparatus requests in a batch acquisition of information of the data of public elements and the data of all private elements that is not allowed to be delayed. In step S after the information processing apparatus acquires response data in response to the processing in step S the information processing apparatus stores the acquired response data in the storage area S. In step S the information processing apparatus requests acquisition of information of the data of the private elements that is allowed to be delayed. In step S after the information processing apparatus receives the response data in response to the processing in step S the information processing apparatus stores the acquired response data in the storage area S and then in step S the information processing apparatus ends the information acquisition request processing.

As described above in the present exemplary embodiment only a request for information that is allowed to be acquired by a delayed data acquisition request is delayed so that the information acquisition request can be divided as appropriate not to cause the response data to exceed the size limit.

As described above the processing in step S is executed after the processing in step S is completed so that the processing load per unit time of the image processing apparatus can be reduced. Instead of executing the processing in step S after the completion of the processing in step S the private data may be requested in step S without waiting for the reception and storage of the response data in step S.

In the present exemplary embodiment the port monitor of the OS is configured to execute the processing illustrated in . Thus the Bidi extension file of the printer driver is configured to notify the port monitor that a delayed data acquisition request is allowed so that the printer driver developed by an IHV that does not expect a delayed data acquisition request will not be affected.

However if every printer driver developed by an IHV recognizes that a delayed data acquisition request may occur the delay allowance information of the Bidi extension file is not required. That is to say the technical problem can be solved by the configuration in which the port monitor always sends an information acquisition request for data of private elements separately from an information acquisition request for data of public elements.

In the fourth exemplary embodiment the configuration is described in which the information acquisition request to be made by the information processing apparatus is divided in advance. In the configuration of the fourth exemplary embodiment since the information processing apparatus cannot be informed of the size of response data in advance the information acquisition request is divided in advance and then sent.

In a fifth exemplary embodiment the configuration will be described in which the information processing apparatus requests acquisition of information of element data of all elements in a batch and if for example the size of response data exceeds the size limit the information processing apparatus requests acquisition of the information again.

The retry identifier is an identifier indicating that the information processing apparatus is to acquire again the element data to which the retry identifier is added from the printing apparatus . The retry identifier will be described in detail with reference to . illustrates response data. In a code the attribute value retry is added to the attribute Valid . The attribute value retry indicates that an information acquisition request is required again to acquire the data of the element ihv Status .

In the determination in step S if the information processing apparatus determines that there is an element to which the retry identifier retry is added YES in step S then in step S the information processing apparatus requests again the element ihv Status to which the retry identifier retry is added. Specifically the information processing apparatus sends the information acquisition request again to realize the processing in step S. In step S after the information processing apparatus acquires the response data in response to the processing in step S the information processing apparatus stores the acquired response data in the storage area S. In step S the information processing apparatus ends the information acquisition request processing.

On the other hand in the determination in step S if the information processing apparatus determines that there is no element to which the retry identifier retry is added NO in step S then the information processing apparatus ends the information acquisition request processing.

As described above according to the present exemplary embodiment for example the information processing apparatus is only required to request again acquisition of information of only the data of the element to which the retry identifier is added if the response data exceeds the size limit. This can minimize the number of times of the information acquisition request.

While the configuration has been described in which the attribute value retry of the attribute valid is used as the retry identifier in the present exemplary embodiment the retry identifier may be expressed by an attribute other than the attribute valid .

It is apparent that an object of the present subject matter can be attained also by supplying to a system or an apparatus a storage medium that stores program codes of software configured to realize the functions of the exemplary embodiments described above and by causing a computer or CPU or MPU of the system or the apparatus to read and execute the program codes stored in the storage medium. In this case the program codes read from the storage medium realize the functions of the exemplary embodiments and the present subject matter may comprise the storage medium storing the program codes.

Examples of storage media for supplying the program codes that can be used include a flexible disk a hard disk an optical disk a magneto optical disk a compact disk read only memory CD ROM a CD recordable CD R a magnetic tape a non volatile memory card a ROM and a digital versatile disk DVD .

It is apparent that the scope of the present subject matter encompasses not only the cases in which a computer executes read program codes to realize the functions of the exemplary embodiments described above but also the cases in which an OS running on the computer or the like executes a part of or the entire processing according to instructions of the program codes so that the processing realizes the functions of the exemplary embodiments described above.

It is also apparent that the scope of the present subject matter encompasses the cases in which program codes read from a storage medium are written in a memory included in a function expansion board inserted in a computer or a function expansion unit connected to the computer and thereafter a CPU or the like included in the function expansion board or the function expansion unit executes a part of or the entire processing according to instructions of the program codes so that the processing realizes the functions of the exemplary embodiments described above.

The present subject matter can reduce the possibility that the size of response data exceeds a size limit.

Embodiments of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions recorded on a storage medium e.g. non transitory computer readable storage medium to perform the functions of one or more of the above described embodiment s of the present invention and by a method performed by the computer of the system or apparatus by for example reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above described embodiment s . The computer may comprise one or more of a central processing unit CPU micro processing unit MPU or other circuitry and may include a network of separate computers or separate computer processors. The computer executable instructions may be provided to the computer for example from a network or the storage medium. The storage medium may include for example one or more of a hard disk a random access memory RAM a read only memory ROM a storage of distributed computing systems an optical disk such as a compact disc CD digital versatile disc DVD or Blu ray Disc BD a flash memory device a memory card and the like.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2013 060267 filed Mar. 22 2013 which is hereby incorporated by reference herein in its entirety.

