---

title: Communication control technology and communication apparatus
abstract: A non-transitory computer-readable medium having a communication control program stored thereon and readable by a controller of a communication apparatus, the communication control program, when executed by the controller, causes the controller to perform: determining whether a wireless setting for performing wireless communication through a second communication unit is stored; requesting a wireless setting for performing wireless communication with an external apparatus through the second communication unit from the external apparatus through a first communication unit; acquiring a wireless setting for performing wireless communication with the external apparatus through the second communication unit in response to the request; and when it is determined that the wireless setting is not stored and the wireless setting is acquired by the acquiring, setting the acquired wireless setting as the wireless setting for performing the wireless communication through the second communication unit.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08922820&OS=08922820&RS=08922820
owner: Brother Kogyo Kabushiki Kaisha
number: 08922820
owner_city: Nagoya-shi, Aichi-ken
owner_country: JP
publication_date: 20140318
---
This application claims priority from Japanese Patent Application No. 2013 070374 filed on Mar. 28 2013 the entire subject matter of which is incorporated herein by reference.

In a printer configured to perform a printing operation for a recording sheet there has been proposed a technology of transmitting receiving print data for printing by wireless communication. In this technology the printer acquires print data from a PC which is connected to a relay apparatus for example an access point of wireless LAN by wireless communication through the relay apparatus of the wireless LAN that covers a using place of the printer and executes a printing operation based on the received print data.

The printer that acquires the print data from the access point by the wireless communication should be wirelessly connected to the access point so as to transmit receive data.

On the other hand when a PC is provided with a wireless communication function the PC should be wirelessly connected to the access point that wirelessly connected to the printer so as to transmit and receive data to and from the access point. In this case a user should manually operate the access point the PC and the like e.g. input a character string for setting the wireless connection between the PC and the access point. Such a manual operation for setting the wireless connection is a troublesome for the user.

Also in recent years the function of performing wireless communication through the access point is also provided to a small terminal hereinafter referred to as a portable device which the user can carry such as a laptop PC a smart phone and the like. It is also necessary to perform the above troublesome process for the terminal when setting the wireless connection with the access point.

Therefore illustrative aspects of the invention provide a communication control program and a communication apparatus capable of easily making a wireless setting for performing wireless communication for which the wireless setting is necessarily set.

According to one illustrative aspect of the invention there is provided a non transitory computer readable medium having a communication control program stored thereon and readable by a controller of a communication apparatus wherein the communication apparatus comprises a first communication unit configured to perform communication by a near field communication method a second communication unit configured to perform communication by a wireless communication method that is different from the near field communication method a storage unit comprising a first storage area that is allotted to the communication control program and the controller the communication control program when executed by the controller causes the controller to perform operations comprising a first determination process of determining whether a wireless setting for performing wireless communication through the second communication unit is stored in the first storage area a request process of in a case where the communication apparatus is in communication with an external apparatus through the first communication unit requesting a wireless setting for performing wireless communication with the external apparatus through the second communication unit from the external apparatus through the first communication unit an acquire process of in response to the request issued by the request unit acquiring a wireless setting for performing wireless communication with the external apparatus through the second communication unit from the external apparatus through the first communication unit and a communication control process of in a case where the first determination process determines that the wireless setting is not stored in the first storage area and in a case where the wireless setting is acquired from the external apparatus by the acquire process setting the acquired wireless setting as the wireless setting for performing the wireless communication through the second communication unit.

Incidentally the invention can be implemented by a variety of aspects such as a communication apparatus a control device controlling the communication apparatus a communication system a communication method a communication control program for controlling the communication apparatus a computer readable medium having the communication control program stored thereon and the like.

Hereinafter preferred illustrative embodiments of the invention will be described with reference to the accompanying drawings. First a first illustrative embodiment is described with reference to . is a block diagram showing an electrical configuration of a portable device having a device control application mounted therein that is an illustrative embodiment of the communication control program of the invention. The portable device is able to perform wireless communication hereinafter referred to as Wi Fi communication based on Wi Fi registered trademark standards with an external apparatus such as a multi functional peripheral apparatus hereinafter referred to as MFP . As specifically described later the portable device having the device control application mounted therein can easily make a wireless setting for performing Wi Fi communication with the external apparatus such as the MFP .

The portable device of this illustrative embodiment is configured by a portable device such as a smart phone. The portable device is provided with a CPU which is an abbreviation of Central Processing Unit a flash memory a RAM which is an abbreviation of Random Access Memory an operation key an LCD which is an abbreviation of Liquid Crystal Display a touch panel a memory card interface memory card I F a voice I O which is an abbreviation of Input Output unit a telephone network communication unit a near field communication unit and a wireless LAN which is an abbreviation of Local Area Network communication unit . The respective units are connected to each other by a bus line .

The CPU controls the respective units connected to the bus line in response to fixed values or programs stored in the flash memory and the like. The flash memory is a rewritable non volatile memory. The flash memory stores therein an operating system hereinafter referred to as the OS and the device control application . In the below the CPU that executes a program such as an application and an operating system may be simply described by a program name. For example the description of application may mean the CPU executing the application .

The OS is basic software for implementing standard functions of the portable device . In this illustrative embodiment an Android registered trademark OS is adopted as the OS . The device control application is an application that is provided by a vendor of the device such as the MFP is installed in the portable device by a user and enables a device to be used from the portable device . For example it is possible to directly use printing and scan functions of the device from the portable device without through a PC and the like. The respective processing shown in flow charts of is executed by the CPU in accordance with the device control application

The flash memory is provided with a storage area for an OS and a storage area for an application. The storage area for an OS is a storage area that is used by the OS and is allotted to the OS . A variety of setting information set by the OS for example an SSID which is an abbreviation of Service Set Identifier that is a wireless setting of the Wi Fi communication and the like are stored in the storage area for an OS. On the other hand the storage area for an application is a storage area that is used by the device control application and is allotted to the device control application . The wireless setting of the Wi Fi communication set by the device control application more specifically an SSID of an access point AP that is a relay apparatus is stored in the storage area for an application. The RAM is a rewritable volatile memory having a temporary area for temporarily storing a variety of data when the CPU executes the device control application and the like.

The operation key is a mechanical key for inputting an instruction and the like to the portable device and is provided to a housing of the portable device for example. The LCD is a liquid crystal display apparatus for displaying a variety of screens.

The touch panel is provided with overlapping with the LCD and inputs an instruction and the like to the portable device when an indicator such as a finger and a rod is touched or comes close thereto. The memory card I F is an interface to which a rewritable non volatile memory card MC is mounted and controls writing and readout of the data to and from the memory card MC. The voice I O unit is a device for voice input and output consisting of a microphone a speaker and the like. The telephone network communication unit is a circuit for communication through a mobile telephone network not shown .

The near field communication unit is an interface for performing communication by near field communication having a communication possible distance such as a short distance of about 10 cm. In this illustrative embodiment the near field communication that is performed by the near field communication unit is non contact communication hereinafter the communication is referred to as NFC communication conforming to NFC standards. In this illustrative embodiment the portable device is able to perform the NFC communication with the MFP having the near field communication unit .

The wireless LAN communication unit is an interface for performing wireless communication by the wireless LAN. In this illustrative embodiment the communication that is performed by the wireless LAN communication unit is wireless communication by the wireless LAN based on the standards of IEEE 802.11b g. As described above the portable device is able to perform the Wi Fi communication with the MFP having the wireless LAN communication unit . Incidentally a communication possible distance by the Wi Fi communication is about 100 m. The wireless LAN communication unit is wirelessly connected to the wireless LAN communication unit of the MFP by any one mode of an infrastructure mode and an ad hoc mode. The infrastructure mode is a mode for wirelessly connecting the portable device the wireless LAN communication unit and the MFP a wireless LAN communication unit through the AP that is a relay apparatus. On the other hand the ad hoc mode is a mode for wirelessly connecting the portable device and the MFP each other without through the AP . In the below the wireless connection by the infrastructure mode is also referred to as infrastructure connection and the wireless connection by the ad hoc mode is also referred to as direct connection .

The MFP has a variety of functions such as printing scan copying facsimile functions and the like. The MFP has a printer unit a scanner unit a facsimile communication unit and the like not shown for implementing the various functions. The MFP has a near field communication unit like the near field communication unit . Also the MFP has a wireless LAN communication unit like the wireless LAN communication unit .

The AP to is a relay apparatus for relaying the Wi Fi communication between two apparatuses. The AP is able to connect to a network . The AP is able to connect to the other AP a server not shown and the like through the network . As described above the communication possible distance of the Wi Fi communication has a limit such as about 100 m. Therefore for example as shown in the portable device and the MFP are able to be infrastructure connected through the AP in an area A within which they are able to perform communication with the AP by the Wi Fi communication. On the other hand the portable device and the MFP located in the area A are unable to be wirelessly connected to the APs to located beyond the area A.

When this processing starts the CPU waits for reception of an NFC event from the MFP S No . The NFC event is an event that is transmitted from the MFP when the MFP detects the portable device as an antenna unit not shown of the near field communication unit of the portable device is enabled to come close to an antenna unit not shown of the near field communication unit of the MFP . In S when the CPU receives an NFC event S Yes the CPU determines whether the SSIDs which are the wireless setting of the Wi Fi communication are stored saved in the storage area for an application S .

When the CPU determines that the SSIDs are stored in the storage area for an application S Yes the CPU determines whether an SSID of a valid state is present in the SSIDs stored in the storage area for an application S . Incidentally the SSID of a valid state indicates an SSID of the AP that can be wirelessly connected at a current position of the portable device . For example in for the portable device located in the area A the SSID of the AP is an SSID of a valid state. On the other hand an SSID of the AP that cannot be wirelessly connected at a current position of the portable device is an SSID of an invalid state not the valid state. For example in when the APs to are located beyond the communication possible distance of the Wi Fi communication as regards the portable device the respective SSIDs of the APs to are SSIDs of an invalid state.

Specifically in S the CPU first acquires an available active SSID of the wireless setting of the Wi Fi communication i.e. the SSIDs stored in the storage area for an OS from the OS . Then the CPU compares the acquired SSID and the SSIDs stored in the storage area for an application. When there is a coinciding SSID the CPU determines that there is an SSID of a valid state. On the other hand when there is no coinciding SSID or when an available SSID cannot be acquired the CPU determines that there is no SSID of a valid state.

In S when the CPU determines that there is no SSID of a valid state in the SSIDs stored in the storage area for an application S No the CPU requests the SSID from the MFP by the NFC communication S . More specifically in S the CPU requests both an SSID for infrastructure and an SSID for direct from the MFP . Incidentally the SSID for infrastructure is an SSID that is used when establishing the infrastructure connection with the MFP through the AP specifically the SSID of the AP . On the other hand the SSID for direct is an SSID that is used when establishing the direct connection with the MFP and is a so called one time SSID that is issued by the MFP so as to allow the connection with the wireless LAN communication unit on condition that the SSID is used only one time.

On the other hand when the CPU determines in S that an SSID is not stored in the storage area for an application S No the CPU determines whether the SSID of the AP under connection is stored in the storage area for an OS S . That is in S the CPU determines whether the SSID of the AP under connection is present in the SSIDs stored by the OS . Incidentally the description under connection indicates that the infrastructure connection is established between the wireless LAN communication unit and the AP . In S when the CPU determines that the SSID of the AP under connection is not stored in the storage area for an OS S No the CPU proceeds to S. Hence according to the device control application of this illustrative embodiment 1 when the SSIDs are stored in the storage area for an application but there is no SSID of a valid state or 2 when the SSID is not stored in the storage area for an application and the SSID of the AP under connection is not also stored in the storage area for an OS the CPU requests the SSID from the MFP . Therefore when there is no SSID enabling the portable device to perform the Wi Fi communication the CPU requests the SSID from the MFP .

When the processing of S is executed the MFP sends an SSID corresponding to a situation of the MFP at that time back to the portable device by the NFC communication. When there is no limitation on the transmission of the SSID for infrastructure or SSID for direct to the portable device the MFP sends the SSID for infrastructure set in the MFP and the SSID for direct issued by the MFP back to the portable device in response to the request from the portable device . On the other hand when the MFP is unable to send back the SSID for direct for example when the SSID for direct has been issued for another terminal the MFP sends back only the SSID for infrastructure set in the MFP . Also when the MFP is unable to send back the SSID for infrastructure for example when the MFP is not wirelessly connected to the AP the MFP sends back only the SSID for direct issued by the MFP .

Incidentally the MFP sends the SSID having a flag attached thereto which enables a type of the SSID to be identified as the SSID for infrastructure or SSID of direct back to the portable device so that the type of the SSID can be specified in the portable device . When the SSID sent back to the portable device by the MFP includes the SSID for infrastructure the MFP sends a password set for the SSID for infrastructure an IP address allotted to the MFP and a model name given to the MFP back to the portable device as data of one set together with the SSID for infrastructure.

After the processing of S the CPU waits for reception of the SSID from the MFP by the NFC communication S No . When the SSID sent back from the MFP is received S Yes the CPU determines the type of the received SSID S . In S the CPU determines the type of the SSID based on the flag attached to the SSID.

When the CPU determines that the received SSIDs are both the SSID for infrastructure and the SSID for direct S the SSID for infrastructure the SSID for direct the CPU determines whether a screen displayed on the LCD is a print preview screen S . When the CPU determines that a print preview screen is displayed on the LCD S Yes the CPU executes processing for connecting the wireless LAN communication unit and the wireless LAN communication unit of the MFP S by the direct connection. Specifically the CPU sets the received SSID for direct as the wireless setting for performing the Wi Fi communication through the wireless LAN communication unit .

After the processing of S the CPU transmits print data which includes image data selected as a print target and a print setting set in the portable device to the MFP connected by the direct connection S and then proceeds to S. The MFP having received the print data enables the printer unit not shown to execute a printing operation based on the received print data. Incidentally after the CPU transmits the print data to the MFP in S the CPU deletes the SSID for direct set so as to establish the direct connection with the MFP that is the CPU releases the setting of the SSID for direct . Thereby the direct connection between the portable device and the MFP is disconnected. Therefore it is possible to limit the using of the SSID for direct to one time so that it is possible to guarantee the security. On the other hand when the CPU determines in S that a print preview screen is not displayed on the LCD S No the CPU displays a predetermined screen for displaying a message such as an error on the LCD S and then proceeds to S.

In this way the SSID for direct received from the MFP is set as the wireless setting for performing the Wi Fi communication on condition that the preview screen is displayed on the LCD . However when the preview screen is not displayed on the LCD the wireless setting is not set. Hence the user can enable the MFP to execute the printing by displaying the preview screen on the LCD .

In S the CPU displays a user interface UI for inputting a password for the received SSID for infrastructure on the LCD S . When a password that is input to the UI displayed on the LCD by the user coincides with the password received from the MFP the CPU determines that the password input by the user is a password validating the authentication. When a password is not input to the UI displayed on the LCD S No or when a password is input but the password is an incorrect password invalidating the authentication S Yes S No if the input of the password is not cancelled by a predetermined operation S No the CPU returns to S.

When a password is input to the UI displayed on the LCD and the password is a correct password validating the authentication S Yes S Yes the CPU executes processing for infrastructure connecting the wireless LAN communication unit of the portable device and the wireless LAN communication unit of the MFP through the AP indicated by the SSID for infrastructure S . Specifically the CPU sets the received SSID for infrastructure as the wireless setting for performing the Wi Fi communication through the wireless LAN communication unit . Then the CPU associates and stores saves the received SSID for infrastructure the received IP address the received model name and the received password in the storage area for an application S and ends this processing.

Therefore when the portable device receives both the SSID for infrastructure and the SSID for direct from the MFP in response to the request issued from the portable device to the MFP the CPU transmits the print data to the MFP by the direct connection using the SSID for direct. Since the using of the SSID for direct is limited to one time it is possible to secure the sufficient security even though the authentication is not made using the password. Hence while securing the sufficient security and making an operation unnecessary which is inconvenient to a user such as the password input it is possible to enable the MFP to execute the printing based on the print data.

On the other hand since the received SSID for infrastructure is automatically stored in the storage area for an application on condition that the authentication by the password is valid it is not necessary for the user to manually register the SSID for infrastructure. The SSID for infrastructure stored in the storage area for an application can be also used as an SSID for wireless connection infrastructure connection with the AP in a utility of transmitting the image data to a cloud server not shown on the network not the printing utility like this illustrative embodiment.

In particular regarding the SSID for infrastructure received from the MFP the IP address and the model name of the MFP having transmitted the SSID for infrastructure i.e. the MFP that is a transmission destination of the print data are associated and stored. Hence from next time when the portable device and the AP are infrastructure connected using one SSID for infrastructure from the SSIDs for infrastructure stored in the storage area for an application it is possible to set the MFP which is connected through the AP in S of this time as the communication destination of the Wi Fi communication through the AP . That is it is possible to easily set the communication destination of the Wi Fi communication through the AP without enabling the portable device to again perform the NFC communication with the MFP .

On the other hand when the password input is cancelled S Yes the CPU ends this processing. Hence when the portable device receives the SSID for infrastructure from the MFP but the user cancels the password input to thereby abandon the authentication of the received SSID for infrastructure the infrastructure connection using the received SSID for infrastructure is not performed and the SSID for infrastructure is not stored in the storage area for an application.

In S when the CPU determines that the received SSID is the SSID for direct S SSID for direct the CPU determines whether the screen displayed on the LCD is a print preview screen S . When the CPU determines that a print preview screen is displayed on the LCD S Yes the CPU executes the direct connection processing S like S transmits the print data S like S and ends this processing. Meanwhile in S the CPU transmits the print data to the MFP and then deletes the SSID for direct that has been set so as to establish the direct connection with the MFP . On the other hand when the CPU determines in S that a print preview screen is not displayed on the LCD S No the CPU displays a predetermined error screen on the LCD S and then ends this processing. Also when the CPU determines in S that the received SSID is the SSID for infrastructure S SSID for infrastructure IP the CPU proceeds to S.

Therefore when the portable device receives only the SSID for infrastructure from the MFP in response to the request for SSID issued from the portable device to the MFP the portable device is wirelessly connected to the MFP only when the authentication by the password is valid. Differently from the SSID for direct the SSID for infrastructure has no limitation on the number of connection times. However since the SSID for infrastructure has the condition of the wireless connection that the authentication by the password is valid it is possible to secure the sufficient security. On the other hand when the portable device receives only the SSID for direct from the MFP the portable device is wirelessly connected to the MFP without the authentication by the password. Since the SSID for direct has the limitation on the number of connection times it is possible to secure the sufficient security even though the authentication by the password is not performed. Therefore while the sufficient security is secured and the user does not perform a troublesome operation it is possible to wirelessly connect the portable device to the MFP .

When the CPU determines in S that there is an SSID of a valid state in the SSIDs stored in the storage area for an application S Yes the CPU executes SSID comparison processing S and then ends this processing. The SSID comparison processing S is processing of checking whether the SSID of a valid state which is the SSID stored in the storage area for an application coincides with the AP wirelessly connected to the MFP . The detailed processing thereof will be described later with reference to .

Also when the CPU determines in S that the SSID of the AP under connection is stored in the storage area for an OS S Yes the CPU stores saves the corresponding SSID and the password of the SSID stored in the storage area for an OS in the storage area for an application S . Then the CPU executes the SSID comparison processing S and then ends this processing. Therefore since the SSID of the AP under connection which is the SSID for infrastructure stored in the storage area for an OS not in the storage area for an application is stored in the storage area for an application it is possible to perform the Wi Fi communication using the SSID stored in this time from next time without the user manually registering the SSID.

After the processing of S the CPU waits for reception of the SSID from the MFP by the NFC communication S No . When the SSID sent back from the MFP is received S Yes the CPU determines whether the SSID for infrastructure which is a comparison target is the SSID received from the MFP i.e. the same SSID as the SSID for infrastructure set in the MFP i.e. whether both SSIDs are an SSID for wireless connection with the common AP S . Incidentally the SSID for infrastructure which is a comparison target in S is the SSID determined as the valid state in S or the SSID of the AP under connection stored in the storage area for an application in S.

When the CPU determines in S that the SSID for infrastructure which is a comparison target is the same as the SSID for infrastructure set in the MFP S Yes the CPU determines whether a screen displayed on the LCD is a print preview screen S . When the CPU determines that a print preview screen is displayed on the LCD S Yes the CPU transmits the image data selected as the print target and the print data including the print setting set in the portable device to the IP address which is received together with the SSID from the MFP i.e. to the MFP that is a destination through the AP indicated by the SSID determined as the same in S S . On the other hand when the CPU determines in S that a print preview screen is not displayed on the LCD S No the CPU displays a predetermined error screen on the LCD S and proceeds to S.

In S the CPU associates and stores the SSID for infrastructure which is stored in the storage area for an application and is determined as the same in S and the IP address and model name received together with the SSID from the MFP in the storage area for an application S and then ends this processing. Therefore from next time when the portable device and the AP are infrastructure connected using one SSID for infrastructure from the SSIDs for infrastructure stored in the storage area for an application it is possible to set the MFP which is specified by the IP address and model name stored in S as the communication destination of the Wi Fi communication through the AP . That is it is possible to easily set the communication destination of the Wi Fi communication through the AP without enabling the portable device to again perform the NFC communication with the MFP .

When the CPU determines in S that the SSID for infrastructure which is a comparison target is different from the SSID for infrastructure set in the MFP S No the CPU proceeds to S of . Thereby when the portable device receives the SSID for direct from the MFP the portable device and the MFP are connected by the direct connection using the SSID for direct so that the print data is transmitted. On the other hand when the portable device receives the SSID for infrastructure from the MFP the portable device can store the SSID for infrastructure in the storage area for an application. Incidentally the case where the CPU determines in S that the SSID for infrastructure which is a comparison target is different from the SSID for infrastructure set in the MFP includes 1 a case where the SSID for infrastructure received from the MFP is different from the SSID that is a comparison target or 2 a case where the SSID received from the MFP is only the SSID for direct.

When the SSID received from the MFP is different from the SSID which is a comparison target the AP to which the portable device is connected is different from the AP to which the MFP is connected. Hence it is not possible to transmit the print data from the portable device to the MFP in the infrastructure connection. However in this case when the portable device receives the SSID for direct from the MFP the portable device connects the portable device and the MFP by the direct connection by using the SSID for direct received from the MFP and transmits the print data to the MFP . Therefore it is possible to enable the MFP to execute the printing based on the selected image data. Also when the portable device receives the SSID for infrastructure set in the MFP from the MFP the portable device sets the received SSID for infrastructure as the wireless setting for the Wi Fi communication. Hence it is possible to infrastructure connect the portable device and the MFP through the common AP . In this way even when the SSID received from the MFP is different from the SSID which is a comparison target it is possible to securely perform the Wi Fi communication between the portable device and the MFP .

According to the first illustrative embodiment when there is no SSID enabling the portable device to perform the Wi Fi communication the portable device requests the SSID from the MFP . Then as a result of the request the portable device receives the SSID from the MFP and sets the received SSID as the wireless setting for the Wi Fi communication. Therefore since it is possible to set the SSID in the portable device even though the user does not manually set the SSID it is possible to easily set the wireless setting for the Wi Fi communication.

Subsequently a second illustrative embodiment is described with reference to . In the first illustrative embodiment the portable device acquires at least one of the SSID for infrastructure set in the MFP and the SSID for direct issued by the MFP from the MFP and determines whether the AP indicated by the acquired SSID is an access point common to the AP to which the portable device is connected. In contrast in the second illustrative embodiment the SSID is transmitted from the portable device to the MFP the MFP performs the determination and the portable device performs control in accordance with a result of the determination. In the second illustrative embodiment the same parts as the first illustrative embodiment are denoted with the same reference numerals and the descriptions thereof are omitted.

The MFP having received the SSID and the request for the comparison compares the SSID for infrastructure received from the portable device and the SSID for infrastructure set in the MFP . When both the SSIDs coincide with each other i.e. both the SSIDs are the SSID for wireless connection with the common AP the MFP sends TRUE an IP address allotted to the MFP and a model name given to the MFP back to the portable device as data of one set by the NFC communication. On the other hand when the SSID for infrastructure received from the portable device is different from the SSID for infrastructure set in the MFP the MFP may send FALSE and the SSID corresponding to the situation of the MFP back to the portable device by the NFC communication like S. Incidentally when transmitting the SSID for infrastructure the MFP sets the SSID for infrastructure and the IP address and model name of the MFP as data of one set.

After the processing of S the CPU of the portable device waits for reception of a response from the MFP by the NFC communication S NO . Upon receiving the response from the MFP S Yes the CPU proceeds to S. When the portable device receives TRUE from the MFP the CPU determines in S that the SSID transmitted to the MFP i.e. the SSID for infrastructure which is a comparison target is the same as the SSID for infrastructure set in the MFP . In this case S Yes the CPU executes processing of S and ends this processing. On the other hand when the portable device receives FALSE from the MFP the CPU determines in S that the SSID for infrastructure which is a comparison target is different from the SSID for infrastructure set in the MFP . In this case S No the CPU proceeds to S of and executes the processing corresponding to the type of the SSID received from the MFP .

According to the second illustrative embodiment when the SSID for infrastructure enabling the portable device to be infrastructure connected which is a comparison target is different from the SSID for infrastructure set in the MFP as the comparison result by the MFP the portable device can be wirelessly connected to the MFP by the direct connection or the infrastructure connection through the AP by using the SSID received from the MFP like the first illustrative embodiment. Therefore it is possible to securely perform the Wi Fi communication between the portable device and the MFP .

Subsequently a third illustrative embodiment is described with reference to . In the above illustrative embodiments when the portable device receives both the SSID for infrastructure and the SSID for direct from the MFP in response to the request for the SSID transmitted to the MFP the portable device and the MFP are connected by the direct connection using the SSID for direct on condition that the print preview screen is displayed on the LCD . Thereby the print data is transmitted from the portable device to the MFP . In contrast according to the third illustrative embodiment when both the SSID for infrastructure and the SSID for direct are received from the MFP in response to the request for the SSID transmitted to the MFP the aspect of the wireless connection between the portable device and the MFP is controlled depending on an authentication result by a password. In the third illustrative embodiment the same parts as the first illustrative embodiment are denoted with the same reference numerals and the descriptions thereof are omitted.

When a password is input in the UI displayed on the LCD and the password is a correct password validating the authentication S Yes S Yes the CPU performs the infrastructure connection processing S like the processing of S and associates and stores the received SSID for infrastructure the received IP address and the received model name in the storage area for an application S like the processing of S. Then the CPU proceeds to S.

On the other hand when the password is input to the displayed UI but the password is an incorrect password invalidating the authentication S Yes S No or when the password input is cancelled S Yes the CPU performs the direct connection processing like the processing of S and proceeds to S. Meanwhile in S the CPU transmits the print data to the MFP and then deletes the SSID for direct that has been set so as to establish the direct connection with the MFP .

In S the CPU determines whether the screen displayed on the LCD is a print preview screen. When the CPU determines that a print preview screen is displayed on the LCD S Yes the CPU transmits the print data which includes the image data selected as the print target and the print setting set in the portable device to the MFP that is enabled to perform the Wi Fi communication with the portable device by the processing of S or S S and then ends this processing. On the other hand when the CPU determined in S that the print preview screen is not displayed on the LCD S No the CPU displays a predetermined error screen on the LCD S and then ends this processing.

According to the third illustrative embodiment when the portable device receives both the SSID for infrastructure and the SSID for direct from the MFP the portable device and the MFP are connected to each other by the direct connection using the received SSID for direct even though the password validating the authentication of the received SSID for infrastructure is not input. Since the SSID for direct has the limitation on the number of connection times it is possible to secure the sufficient security even though the authentication by the password is not performed. Therefore it is possible to transmit the print data to the MFP at a state where the sufficient security is secured. Also when the password validating the authentication of the received SSID for infrastructure is input the portable device and the MFP are infrastructure connected through the AP by using the received SSID for infrastructure. Therefore the portable device is able to transmit the print data to the MFP by the Wi Fi communication through the AP . Also since the SSID for infrastructure authenticated by the password is stored in the storage area for an application it is possible to perform the Wi Fi communication by the infrastructure connection using the SSID stored in this time from next time.

In the respective illustrative embodiments the device control application is an example of the communication control program. The portable device is an example of the communication apparatus. The MFP is an example of the external apparatus. The AP is an example of the relay apparatus. The near field communication unit is an example of the first communication unit. The wireless LAN communication unit is an example of the second communication unit. The CPU is an example of the controller. The flash memory is an example of the storage unit. The storage area for an application is an example of the first storage area. The storage area for an OS is an example of the second storage area. The OS is an example of the program other than the communication control program. The SSID for infrastructure and the SSID for direct are examples of the wireless setting for performing the wireless communication through the second communication unit. The SSID for direct is an example of the wireless setting having the limitation on the connection time or the number of connection times i.e. the first wireless setting. The SSID for infrastructure is an example of the second wireless setting. The IP address and the model name are examples of the apparatus information for specifying the external apparatus as a wireless communication destination. The password input UI for the SSID for infrastructure is an example of the screen for an input relating to the authentication of the wireless setting. The print preview screen is an example of the predetermined screen relating to the predetermined function that can be executed by the external apparatus. The CPU executing the processing of S is an example of the first determination process. The CPU executing the processing of S is an example of the request process. The CPU executing the processing of S S S S and S is an example of the communication control process. The CPU executing the processing of S and S is an example of the first storage control process. The CPU executing the processing of S is an example of the second determination process. The CPU executing the processing of S is an example of the second storage control process. The CPU executing the processing of S is an example of the third determination process. The CPU executing the processing of S is an example of the fourth determination process. The CPU executing the processing of S and S of is an example of the first authentication screen display process. The CPU executing the processing of S of is an example of the second authentication screen display process. The CPU executing the processing of S is an example of the third storage control process. The CPU executing the processing of S is an example of the fourth storage control process. The CPU executing the processing of S is an example of the wireless setting transmission process. The CPU executing the processing of S is an example of the fifth determination process. The CPU executing the processing of S is an example of the second request process. The CPU executing the processing of S is an example of the fifth storage control process.

Although the invention has been described with reference to the illustrative embodiments the invention is not limited to the illustrative embodiments and a variety of improvements and modifications can be easily conceived without departing from the gist of the invention.

For example in the respective illustrative embodiments the portable device such as a smart phone has been exemplified as the communication apparatus having the device control application mounted therein. However a variety of apparatuses can be adopted as the communication apparatus insofar as it can perform wireless communication by the NFC communication and the Wi Fi communication. For example when an apparatus such as a tablet computer a note type PC a digital camera and a music reproduction apparatus is configured to perform wireless communication by the NFC communication and the Wi Fi communication the corresponding apparatus can be adopted as the communication apparatus having the device control application mounted therein. Also in the respective illustrative embodiments the OS of the portable device is the Android OS. However the other OS may be also adopted.

In the respective illustrative embodiments the SSID is set in the portable device in the printing processing for enabling the MFP to execute the printing function. However the SSID may be set in the portable device in the processing for enabling the MFP to execute a function other than the printing function for example the scan function. Also the SSID may be set in the portable device in processing in which data having a relatively small size such as setting data is transmitted and received through the NFC communication and data having a large size such as image data is transmitted and received through the Wi Fi communication without being limited to the processing for enabling the MFP to execute the function. Also in the respective illustrative embodiments the MFP having the functions such as the printing function has been exemplified as the external apparatus. However an apparatus having a single function such as a printer and a scanner and a PC having a saving function and the like may be also adopted as the external apparatus.

In the respective illustrative embodiments when the SSID is not stored in the storage area for an application it is determined whether the SSID of the AP under connection is stored in the storage area for an OS. However a configuration may be possible in which when the SSID is not stored in the storage area for an application the request for the SSID is transmitted to the MFP without determining whether the SSID is stored in the storage area for an OS. Also in this case since the SSID can be received from the MFP it is possible to enable the portable device to perform the Wi Fi communication by using the received SSID without the user manually registering the SSID.

In the respective illustrative embodiments the CPU determines in S whether the SSID of the AP under connection is stored in the storage area for an OS to thereby determine whether or not the SSID of the AP under connection. Instead of this the CPU may determine whether the SSID of the AP under connection is stored in the RAM to thereby determine whether or not the SSID of the AP under connection. That is it may be determined whether or not the SSID of the AP under connection based on the SSID stored in the RAM upon acquisition by an API Application Programming Interface .

In the respective illustrative embodiments the CPU requests the SSID from the MFP on condition that the SSID is stored in the storage area for an application. Instead of this the CPU may request the SSID from the MFP irrespective of whether the SSID is stored in the storage area for an application and when the SSID is received from the MFP in response to the request the CPU may set the received SSID as the wireless setting for performing the Wi Fi communication on condition that the SSID is not stored in the storage area for an application. This modified embodiment is implemented by executing the respective processing of S S S and S after the determination result of Yes in S and before the processing of S in the printing processing of .

In the third illustrative embodiment when the SSID for infrastructure transmitted from the portable device to the MFP is different from the SSID for infrastructure set in the MFP the portable device establishes the wireless connection in accordance with the SSID received from the MFP . Instead of this when the two SSIDs for infrastructure are different the MFP may establish the wireless connection by using the SSID for infrastructure that is transmitted to the MFP by the portable device . In this case when the two SSIDs are different the MFP sends FALSE the IP address allotted to the MFP and the model name given to the MFP back to the portable device as data of one set by the NFC communication. When FALSE is received the portable device may set the SSID transmitted to the MFP as the wireless setting for performing the Wi Fi communication with the MFP . Alternatively when the two SSIDs for infrastructure are different the MFP may issue an SSID for direct and then transmit the SSID for direct to the portable device together with FALSE .

In the third illustrative embodiment the portable device determines in S whether the SSID for infrastructure which is a comparison target is the same as the SSID for infrastructure set in the MFP based on TRUE or FALSE received from the MFP . Instead of this when both the SSIDs are the same the MFP may send back the SSID and the IP address and when both the SSIDs are different the MFP may not reply. In this case the portable device may determine whether both the SSIDs are the same based on whether the SSID is received.

In the respective illustrative embodiments the IP address and the model name have been exemplified as the apparatus information for specifying the MFP of the wireless communication destination in the Wi Fi communication by the infrastructure connection. However only the IP address may be used. Also instead of the IP address a node name a MAC address and the like may be used as the apparatus information.

In the respective illustrative embodiments the portable device determines whether the SSID received from the MFP is the SSID for infrastructure or the SSID for direct based on the flag attached to the SSID by the MFP . Alternatively the type of the SSID received from the MFP may be determined on the basis of whether the IP address is also sent back with the SSID by the MFP . In this case the CPU determines the SSID which the IP address is also sent back therewith as the SSID for infrastructure and the CPU determines the SSID which the IP address is not sent back therewith as the SSID for direct.

In the respective illustrative embodiments when the portable device receives both the SSID for infrastructure and the SSID for direct from the MFP the portable device transmits the print data by the direction connection establishes the infrastructure connection by using the received SSID for infrastructure and stores the SSID for infrastructure in the storage area for an application. Instead of this when both the SSID for infrastructure and the SSID for direct are received from the MFP the portable device may store the received SSID for infrastructure in the storage area for an application without establishing the infrastructure connection. Also in the respective illustrative embodiments when the portable device receives only the SSID for infrastructure from the MFP the portable device may establish the infrastructure connection by using the received SSID for infrastructure and then transmit the print data through the infrastructure connection.

In the respective illustrative embodiments the SSID for direct is the SSID having the condition that it is used only one time. However the number of using times may not be limited to one time and may be two or more times inasmuch as the security can be secured. Also the connection limitation of the SSID for direct may be defined by a time element such as elapsed time after the SSID is issued not by the number of using times such as one time.

In the respective illustrative embodiments the SSID that is stored in the storage area for an application is limited to the SSID for infrastructure. However when the portable device receives the SSID for direct from the MFP in response to the request from the portable device the received SSID for direct may be stored in the storage area for an application. In this case the SSID for direct stored in the storage area for an application may be deleted when a predetermined condition such as the number of using times and elapsed time after the SSID is stored is satisfied.

In the respective illustrative embodiments and modified embodiments the CPU executes the respective processing of . However a plurality of CPUs may cooperatively execute the respective processing of . Also a single IC such as ASIC may independently or multiple ICs may cooperatively execute the respective processing of . Also the CPU and the IC such as ASIC may cooperatively execute the respective processing of .

The respective features described in the first to third illustrative embodiments and the respective modified embodiments may be appropriately combined.

 1 According to the above described non transitory computer readable medium in the case where the wireless setting for performing wireless communication through the second communication unit is not stored in the first storage area allotted to the communication control program the wireless setting for performing wireless communication with the external apparatus through the second communication unit which is acquired from the external apparatus through the first communication unit performing communication with the external apparatus by the near field communication method is set by the communication control process. Hence it is possible to easily make a wireless setting for performing wireless communication through the second communication unit i.e. wireless setting for which the wireless setting is necessarily set.

 2 The wireless setting which is set by the communication control process for performing wireless communication with the relay apparatus which performs wireless communication with the external apparatus through the second communication unit is stored in the first storage area. Therefore since it is possible to use the wireless setting which is set by a setting control process by the communication control program it is possible to use the wireless setting at any time by the communication control program.

 3 In the case where the wireless setting that is set by the communication control process is the wireless setting for performing wireless communication with the relay apparatus which performs wireless communication with the external apparatus through the second communication unit the stored state of the wireless setting in the first storage area is kept even after the wireless communication using the wireless setting is completed. On the other hand in the case where the wireless setting that is set by the communication control process is the wireless setting having a limitation on the connection time or the number of connection times the wireless setting is not stored any more in the first storage area after the wireless communication using the wireless setting is completed. Hence since the wireless setting of which the security is guaranteed by the limitation on the connection time or the number of connection times is not stored any more in the first storage area after the wireless communication using the wireless setting is completed it is possible to suppress the wireless setting having a limitation on the connection time or the number of connection times from being set beyond the limitation on the connection time or the number of connection times.

 4 In the case where the wireless setting for performing wireless communication through the second communication unit is not stored in the first storage area and the wireless setting set as the wireless setting for performing wireless communication through the second communication unit is not stored in the second storage area allotted to the program other than the communication control program the wireless setting for performing wireless communication with the external apparatus through the second communication unit is requested to the external apparatus through the first communication unit. As a result of the request it is possible to set the wireless setting for performing wireless communication with the external apparatus through the second communication unit. Hence it is possible to easily make the wireless setting for performing wireless communication for which it is necessary to set the wireless setting.

 5 In the case where the wireless setting set as the wireless setting for performing wireless communication through the second communication unit is stored in the second storage area the wireless setting stored in the second storage area is stored in the first storage area. Therefore since it is possible to use the wireless setting which is used by the program other than the communication control program by the communication control program it is possible to use the wireless setting at any time by the communication control program.

 6 In the case where the wireless setting for performing wireless communication through the second communication unit is stored in the first storage area but the wireless setting stored in the first storage area is not the wireless setting of a valid state capable of performing wireless communication with the external apparatus through the second communication unit the wireless setting for performing wireless communication with the external apparatus through the second communication unit is requested to the external apparatus through the first communication unit. As a result of the request it is possible to set the wireless setting for performing wireless communication through the second communication unit. In the case where the wireless setting stored in the first storage area is not the wireless setting of a valid state it is not possible to perform wireless communication through the second communication unit even though the corresponding wireless setting is set. In contrast according to the non transitory computer readable medium of this aspect it is possible to easily make the wireless setting for performing wireless communication through the second communication unit even at that state.

 7 The wireless setting of which the security is not guaranteed by the limitation on the connection time or the number of connection times is set on condition that an input validating the authentication of the wireless setting is made. Thus it is possible to secure the sufficient security. On the other hand the wireless setting having the limitation on the connection time or the number of connection times secures the sufficient security without the authentication. Therefore in the case where the wireless setting acquired from the external apparatus is the wireless setting having the connection limitation the acquired wireless setting is set as the wireless setting for performing wireless communication through the second communication unit without the authentication. Hence it is possible to reduce the user s operation for setting the wireless setting without sacrificing the security.

 8 In the case where the wireless setting for performing wireless communication with the external apparatus through the second communication unit which is acquired from the external apparatus in response to the request for the wireless setting transmitted to the external apparatus is both the first wireless setting having the limitation on the connection time or the number of connection times and for performing wireless communication with the external apparatus without through the relay apparatus and the second wireless setting having no connection limitation and for performing wireless communication with the relay apparatus performing wireless communication with the external apparatus the screen for an input relating to authentication of the second wireless setting is displayed on the display unit. In the case an input validating the authentication of the wireless setting which is a target is made on the screen the second wireless setting is set as the wireless setting for performing wireless communication with the relay apparatus through the second communication unit. On the other hand in the case an input validating the authentication of the wireless setting which is a target is not made on the screen the first wireless setting acquired together with the second wireless setting is set as the wireless setting for performing wireless communication with the external apparatus through the second communication unit without through the relay apparatus. Hence even when an input validating the authentication of the wireless setting which is a target is not made it is possible to set the wireless setting for performing wireless communication through the second communication unit at a state where the sufficient security is secured.

 9 The wireless setting which is set by the communication control process on the basis of the input validating the authentication of the wireless setting which is a target made on the screen for an input relating to the authentication and the apparatus information for specifying the external apparatus as a wireless communication destination which is acquired from the external apparatus through the first communication unit are associated and stored in the first storage area. Therefore when one wireless setting is selected and set from the first storage area it is possible to set the external apparatus which is associated with the wireless setting in the first storage area as the wireless communication destination. Hence it is possible to easily implement the wireless communication through the second communication unit without again acquiring the apparatus information from the same external apparatus through the first communication unit.

 10 In the case where the wireless setting for performing wireless communication with the external apparatus through the second communication unit which is acquired from the external apparatus in response to the request for the wireless setting transmitted to the external apparatus is both the first wireless setting having the limitation on the connection time or the number of connection times and for performing wireless communication with the external apparatus without through the relay apparatus and the second wireless setting having no connection limitation and for performing wireless communication with the relay apparatus performing wireless communication with the external apparatus the first wireless setting is set as the wireless setting for performing wireless communication through the second communication unit without the authentication and the wireless communication with the external apparatus through the second communication unit is performed by the first wireless setting. Therefore it is possible to easily implement the wireless communication with the external apparatus through the second communication unit while reducing the user s operation for setting the wireless setting without sacrificing the security. On the other hand the screen for an input relating to the authentication of the second wireless setting which is acquired together with the first wireless setting is displayed on the display unit. In the case an input validating the authentication of the wireless setting which is a target is made on the screen the second wireless setting and the apparatus information for specifying the external apparatus as a wireless communication destination which is acquired from the external apparatus through the first communication unit are associated and stored in the first storage area. Therefore when one wireless setting is selected and set from the first storage area it is possible to set the external apparatus which is associated with the wireless setting in the first storage area as the wireless communication destination. Hence it is possible to easily implement the wireless communication through the second communication unit without again acquiring the apparatus information from the same external apparatus through the first communication unit.

 11 In the case where the wireless setting set in the external apparatus is different from the wireless setting which is not stored in the first storage area but stored in the second storage area or the wireless setting of a valid state stored in the first storage area even though the former wireless setting is set in the external apparatus and the latter wireless setting is set in the communication apparatus it is not possible to perform wireless communication between the external apparatus and the communication apparatus because the relay apparatus with which the external apparatus performs wireless communication and the relay apparatus with which the communication apparatus performs wireless communication through the second communication unit are different each other. In contrast in this case since the wireless setting set in the communication apparatus is set as the wireless setting for performing wireless communication with the relay apparatus which performs wireless communication with the external apparatus through the second communication unit it is possible to securely perform wireless communication with the external apparatus through the relay apparatus. Incidentally in this aspect the wireless setting for performing wireless communication with a relay apparatus which performs wireless communication with the external apparatus through the second communication unit is the acquired wireless setting in the case where the communication apparatus sets the wireless setting acquired from the external apparatus through the first communication unit and is the wireless setting transmitted to the external apparatus in the case where the external apparatus sets the wireless setting transmitted from the communication apparatus.

 12 In the case where the wireless setting set in the external apparatus is different from the wireless setting which is not stored in the first storage area but stored in the second storage area or the wireless setting of a valid state stored in the first storage area even though the former wireless setting is set in the external apparatus and the latter wireless setting is set in the communication apparatus it is not possible to perform wireless communication between the external apparatus and the communication apparatus because the relay apparatus with which the external apparatus performs wireless communication and the relay apparatus with which the communication apparatus performs wireless communication through the second communication unit are different each other. In contrast in this case since the wireless setting acquired from the external apparatus is set as the wireless setting for performing wireless communication with the relay apparatus which performs wireless communication with the external apparatus through the second communication unit it is possible to switch the relay apparatus with which the communication apparatus performs wireless communication through the second communication unit to the relay apparatus with which the external apparatus performs wireless communication. Thereby it is possible to securely perform wireless communication with the external apparatus through the relay apparatus.

 13 In the case it is determined that both the wireless setting set in the external apparatus and the wireless setting which is not stored in the first storage area but stored in the second storage area or the wireless setting of a valid state stored in the first storage area are the wireless settings for performing wireless communication with the common relay apparatus the wireless setting for performing wireless communication with the common relay apparatus and the apparatus information for specifying the external apparatus as a wireless communication destination which is acquired from the external apparatus through the first communication unit are associated with each other and stored in the first storage area. Hence when one wireless setting is selected and set from the first storage area it is possible to set the external apparatus which is associated with the wireless setting in the first storage area as the wireless communication destination.

 14 In the case where the wireless setting for performing wireless communication with the external apparatus through the second communication unit is acquired in response to the request for the wireless setting transmitted to the external apparatus the acquired wireless setting is set on condition that the predetermined screen relating to the predetermined function to be executable by the external apparatus is displayed on the display unit. By the set wireless setting the wireless communication for enabling the external apparatus to execute the function corresponding to the predetermined screen displayed on the display unit is performed as the wireless communication with the external apparatus through the second communication unit. Therefore the user can enable the external apparatus to execute a desired function by displaying a predetermined screen corresponding to the desired function to be executed by the external apparatus.

 15 It is possible to enable the external apparatus to execute a printing operation based on the print data transmitted from the communication apparatus having the communication control program mounted therein by the wireless communication through the second communication unit.

 16 According to the above described communication apparatus it is possible to obtain the same advantages as those of the above described non transitory computer readable medium.

