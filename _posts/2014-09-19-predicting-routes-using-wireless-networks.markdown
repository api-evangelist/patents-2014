---

title: Predicting routes using wireless networks
abstract: The disclosed implementations provide a system and method of predicting routes for mobile devices using wireless networks, including generating and sending content to a mobile device that is travelling on a predetermined route (e.g., a bus route determined by a transportation agency). The mobile device can scan for a wireless network that is installed on a vehicle travelling on a predetermined route. The system can predict which predetermined route the mobile device is travelling on by accessing a database that associates wireless networks with transportation vehicles. The system can confirm whether the mobile device is travelling on a predetermined route based on the device's sensor measurements, timestamps collected over a period of time and the identity of the wireless network that is connected to the device. The system can send content to the mobile device based on the mobile device's location and predicted future locations along the predetermined route.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09094792&OS=09094792&RS=09094792
owner: Apple Inc.
number: 09094792
owner_city: Cupertino
owner_country: US
publication_date: 20140919
---
This application is a continuation of and claims priority to U.S. patent application Ser. No. 13 402 794 filed on Feb. 22 2012 the entire contents of which are hereby incorporated by reference.

Transportation agencies can manage vehicles that travel predetermined routes at predetermined times to pick up and drop off riders e.g. buses . Transportation agencies often post their schedules online or in newspapers so that riders will know when and where vehicles will be. If the schedules are posted online on a server a device e.g. a smart phone can send a request to the server and the server can respond with a schedule of times that are displayed on the device.

The disclosed implementations provide a system and method of predicting routes for mobile devices using wireless networks including generating and sending content to a mobile device that is travelling on a predetermined route e.g. a bus route determined by a transportation agency . The mobile device can scan for a wireless network e.g. Wi Fi access point that is installed on a vehicle travelling on a predetermined route. The system can predict which predetermined route the mobile device is travelling on by accessing a database that associates wireless networks with transportation vehicles. The system can confirm whether the mobile device is travelling on a predetermined route based on the device s sensor measurements timestamps collected over a period of time and the identity of the wireless network that is connected to the device. The system can send content to the mobile device based on the mobile device s location and predicted future locations along the predetermined route. For example content can be information about when the vehicle will arrive at a next stop on the predetermined route.

In general one innovative aspect of the subject matter described in this specification can be embodied in methods that include the actions of receiving a request from a wireless network installed in a moving object the wireless network being coupled to a mobile device in the moving object retrieving a predetermined route associated with the wireless network from a database generating content based at least on the predetermined route and sending the content to the mobile device. Other embodiments of this aspect include corresponding systems apparatus and computer programs configured to perform the actions of the methods encoded on computer storage devices.

These and other embodiments can each optionally include one or more of the following features. The moving object is a bus train or plane. The predetermined route is an established path to be travelled by the moving object. The content includes information about a future destination along the predetermined route. The request includes data associated with one or more sensors onboard the device. The sensor data includes at least one of accelerometer data and location coordinates. Confirming that the mobile device is moving along the predetermined route based on the sensor data. Determining that the mobile device is moving along the predetermined route comprises calculating a first location and a first direction of the moving object based at least on one of the predetermined route and a time received from the mobile device determining a second location and a second direction of the mobile device based on at least one of the sensor data and the time received from the mobile device and establishing the mobile device is moving along a same path as the moving object based on at least one of the locations or the directions. The database includes an entry identifying a wireless network a service provider a route and a vehicle entity. The database is an internal database or a third party database.

Particular implementations of generating and sending content to a mobile device that is travelling on a predetermined route can provide several advantages including allowing users to receive relevant information based on their mobile devices location and predicted routes. For example a user on a vehicle that is travelling on a predetermined route e.g. a bus travelling on its bus route can receive information about the vehicle s next destination or advertisements related to the vehicle s future destination. Another advantage is that the system can consider predetermined routes from multiple sources such as an internal database or third party database to increase the likelihood of predicting a correct predetermined route.

The disclosure that follows describes a network enabled system application that provides predicting routes using a wireless network e.g. a Wi Fi hotspot . The network enabled system application can be running on one or more server computers and be communicating with one or more remotely located mobile devices using the World Wide Web the Web .

The wireless network can connect to a predictive routing system through the wide area network . The predictive routing system can include one or more servers. These servers can be in different physical locations and have different capabilities and architectures. The predictive routing system can communicate with an internal database . The internal database can include information about wireless networks that are associated with transportation vehicles that have the wireless networks installed. For example the internal database can include an entry of the wireless network being associated with the vehicle . The predictive routing system can also communicate with a third party . The third party can maintain its own database of wireless networks that are associated with vehicles. For example the third party can be a transportation agency that installs and maintains the wireless networks on the agency s vehicles. The transportation agency can maintain a database that associates its vehicles with the wireless networks e.g. routers installed on the vehicles. The predictive routing system can process data from a third party s database or the internal database to provide route prediction.

The mobile device sends wireless network information to the predictive routing system . The wireless network information can include a unique identifier e.g. a Base Station Identification Code BSID that uniquely identifies the wireless network. Other types of identifiers are also possible such as a media access control MAC address. The mobile device can obtain wireless network information by scanning for or connecting to wireless networks around the mobile device .

In some implementations the mobile device also sends sensor data to the predictive routing system. The sensor data can include data position velocity from a positioning system e.g. GPS WiFi cell based an accelerometer a gyroscope or other sensors onboard the mobile device . In some implementations the sensor data can include data measured over time e.g. multiple position and velocity points over time . In some alternative implementations the sensor data is sent to the predictive routing system by a third party e.g. a bus transportation agency .

The mobile device can determine it is travelling along a predetermined route from the wireless network information e.g. BSID signal level location data and accelerometer data. The mobile device can determine this by tracking whether the mobile device travels outside a radius from an initial position. The mobile device can calculate a distance travelled over a period of time from an initial position to a final position. In some implementations the mobile device calculates the distance travelled by analyzing location data e.g. GPS or cell tower data . For example the mobile device can calculate distance by analyzing location data over a period of time. In some other implementations the mobile device calculates the radius travelled by analyzing accelerometer data e.g. direction and speed . For example by knowing a speed and direction of a mobile device over a period of time the mobile device can calculate a distance travelled over a period of time. If the mobile device has travelled a distance beyond a radius e.g. the radius of a general enterprise WiFi network range around an initial position while maintaining a consistent BSID signal level over the period of time the mobile device can infer it is traveling along a predetermined route. The mobile device can send the determination of whether the mobile device is traveling along a predetermined route to the predictive routing system .

In some implementations the predictive routing system and not the mobile device can use the sensor data and the wireless network information sent from the mobile device to predict whether the mobile device is travelling along a predetermined route e.g. using the implementations mentioned above .

When the predictive routing system receives the information from the mobile device the predictive routing system determines whether to retrieve data including a predetermined route from the internal database or the third party database e.g. a transportation agency s database . The predictive routing system can make this determination based on the type of information received from the mobile device . For example if the mobile device sends the data in the form of a request specified by a third party the predictive routing system can retrieve data from the third party database . Likewise if the mobile device sends the data in the form of a request specified by the predictive routing system the predictive routing system can retrieve data from the internal database . In some implementations the predictive routing system retrieves data based on a unique identifier sent by the mobile device .

The system can optionally confirm that the mobile device is travelling on the predetermined route based on sensor data sent by the mobile device . For example the system can be applied to a mobile device travelling on a bus. Because a bus route and bus stop times are predetermined the system can calculate approximately where a bus travelling on the bus route should be at a certain time. The system can compare the mobile device s location and time to the calculated time and location. If the mobile device s location and time match the calculated location and time within a margin of error e.g. 5 or 10 the system can confirm the mobile device is travelling on the predetermined route of the bus. In some implementations the sensor data includes multiple locations e.g. position fixes from GPS or WiFi positioning systems and times provided by the mobile device . The system can perform the same analysis at each location and time. If each analysis yields the mobile device s location and time exists within the margin of error the system can increase the accuracy of the confirmation.

The system can also analyze the mobile device s accelerometer data. If the accelerometer data in addition to a location and time indicates the mobile device is travelling in the direction of the bus route the system can confirm with higher accuracy that the mobile device is travelling on the predetermined route. In some implementations the sensor data can include multiple measurements of accelerometer data tracked over time and location. The system can perform the same analysis with each measurement of accelerometer data at each location and time to increase accuracy of the confirmation.

After retrieving the data from a database either the internal database or the third party database the predictive routing system can generate content based on the data from the database and the data from the mobile device . The data from the database can include a predetermined route a unique base station identifier e.g. BSID a service provider a vehicle entity or other data relevant to the vehicle. The data from the mobile device can include sensor data and wireless data as discussed in step . In some implementations the mobile device can send personal profile information to the predictive routing system that includes content preferences. However the user would be provided an option through a user interface of the mobile device to opt out of having profile information sent to the predictive routing system . The system can generate content by retrieving different types of content from different sources based on the data received from the mobile device or the database . For example the system can retrieve an advertisement from an advertising service. The advertisement can be relevant to the location received from the mobile device such as a local event or a local deal. In some implementations the system can retrieve content from an Application Program Interface API that returns information specific to a subject of the API. For example the system can retrieve content about nearby restaurants from a Local API. Based on the predetermined route received from the database the system can retrieve content related to route information from a service provider such as departure times and locations transfer points and transport fees. The system can also retrieve content based on personal preferences received from the mobile device such as favorite routes most frequently travelled routes or advertisement preferences. An example of displaying generated content is described further below in reference to .

After generating content from multiple sources the predictive routing system can send the generated content to the mobile device . Upon receiving the content the mobile device can display play or otherwise present the content to the user .

Referring to the table of rows illustrate sample entries for various vehicles equipped with a wireless network. Each BSID is unique for example none of the BSID s in rows are the same. Each service provider can have multiple entries in the table such as MUNI shown in rows . Some routes can recur such as routes in rows and because multiple vehicles can travel along that route at different times. Each vehicle entity is unique for example none of the vehicle entities in rows recurs.

Entries in the database can be added through crowd sourcing techniques. In some implementations a user application running on the mobile device can be used to add entries into the database . Because many different users can use the application to add entries the application can use crowd sourcing techniques to add entries into the database. The application can be operated by users while travelling on the vehicles. A user can enter in the transportation agency and route information into the application. The application can send the information to the predictive routing system through a wireless network or a cellular data connection. The predictive routing system can obtain a vehicle entity from a transportation agency based on the time location route and transportation agency information that is sent by the mobile device . The system then can add an entry containing the wireless network transportation agency route information and vehicle entity into the database .

In some implementations the process can begin by receiving a request from a wireless network installed in a moving object the wireless network being coupled to a mobile device in the moving object e.g. a bus or train . The process can continue with retrieving a predetermined route associated with the wireless network from a database . The process can optionally continue by determining the mobile device is moving along a predetermined route . In some implementations the process predicts a predetermined route solely from the wireless network installed in the moving object. Finally the process finishes with generating or providing content based at least on the predetermined route and sending the content to the device . In some implementations the content includes data to be displayed in an application or as a notification. In some alternative implementations the content can include an address e.g. Web or IP address which using a browser on the mobile device takes the user to another network location e.g. web site to access and download content onto the mobile device .

In some implementations both voice and data communications can be established over wireless network and access device . For example device can place and receive phone calls e.g. using voice over Internet Protocol VoIP protocols send and receive e mail messages e.g. using SMPTP or Post Office Protocol 3 POP3 and retrieve electronic documents and or streams such as web pages photographs and videos over wireless network gateway and WAN e.g. using Transmission Control Protocol Internet Protocol TCP IP or User Datagram Protocol UDP . Likewise in some implementations device can place and receive phone calls send and receive e mail messages and retrieve electronic documents over access device and WAN . In some implementations device or can be physically connected to access device using one or more cables and access device can be a personal computer. In this configuration device or can be referred to as a tethered device.

Devices and can also establish communications by other means. For example wireless device can communicate with other wireless devices e.g. other devices or cell phones over the wireless network . Likewise devices and can establish peer to peer communications e.g. a personal area network by use of one or more communication subsystems such as the Bluetooth communication devices. Other communication protocols and topologies can also be implemented.

Devices or can communicate with service over the one or more wired and or wireless networks . For example service can be an online service that provides predictive routes and or content based on the predictive routes to mobile devices including the features described in reference to .

Device or can also access other data and content over one or more wired and or wireless networks . For example content publishers such as news sites Really Simple Syndication RSS feeds Web sites and developer networks can be accessed by device or . Such access can be provided by invocation of a web browsing function or application e.g. a browser running on the device or

Devices and can exchange files over one or more wireless or wired networks either directly or through service .

Sensors devices and subsystems can be coupled to peripherals interface to facilitate multiple functionalities. For example motion sensor light sensor and proximity sensor can be coupled to peripherals interface to facilitate orientation lighting and proximity functions of the device. For example in some implementations light sensor can be utilized to facilitate adjusting the brightness of touch surface . In some implementations motion sensor e.g. an accelerometer gyros can be utilized to detect movement and orientation of the device. Accordingly display objects or media can be presented according to a detected orientation e.g. portrait or landscape .

Other sensors can also be connected to peripherals interface such as a temperature sensor a biometric sensor or other sensing device to facilitate related functionalities.

Location processor e.g. GPS receiver can be connected to peripherals interface to provide geo positioning. Electronic magnetometer e.g. an integrated circuit chip can also be connected to peripherals interface to provide data that can be used to determine the direction of magnetic North. Thus electronic magnetometer can be used as an electronic compass.

Camera subsystem and an optical sensor e.g. a charged coupled device CCD or a complementary metal oxide semiconductor CMOS optical sensor can be utilized to facilitate camera functions such as recording photographs and video clips.

Communication functions can be facilitated through one or more communication subsystems . Communication subsystem s can include one or more wireless communication subsystems. Wireless communication subsystems can include radio frequency receivers and transmitters and or optical e.g. infrared receivers and transmitters. Wired communication system can include a port device e.g. a Universal Serial Bus USB port or some other wired port connection that can be used to establish a wired connection to other computing devices such as other communication devices network access devices a personal computer a printer a display screen or other processing devices capable of receiving or transmitting data. The specific design and implementation of the communication subsystem can depend on the communication network s or medium s over which the device is intended to operate. For example a device may include wireless communication subsystems designed to operate over a global system for mobile communications GSM network a GPRS network an enhanced data GSM environment EDGE network 802.x communication networks e.g. WiFi WiMax or 3G networks code division multiple access CDMA networks and a Bluetooth network. Communication subsystems may include hosting protocols such that the device may be configured as a base station for other wireless devices. As another example the communication subsystems can allow the device to synchronize with a host device using one or more protocols such as for example the TCP IP protocol HTTP protocol UDP protocol and any other known protocol.

Audio subsystem can be coupled to a speaker and one or more microphones to facilitate voice enabled functions such as voice recognition voice replication digital recording and telephony functions.

I O subsystem can include touch controller and or other input controller s . Touch controller can be coupled to a touch surface . Touch surface and touch controller can for example detect contact and movement or break thereof using any of a number of touch sensitivity technologies including but not limited to capacitive resistive infrared and surface acoustic wave technologies as well as other proximity sensor arrays or other elements for determining one or more points of contact with touch surface . In one implementation touch surface can display virtual or soft buttons and a virtual keyboard which can be used as an input output device by the user.

Other input controller s can be coupled to other input control devices such as one or more buttons rocker switches thumb wheel infrared port USB port and or a pointer device such as a stylus. The one or more buttons not shown can include an up down button for volume control of speaker and or microphone .

In some implementations device can present recorded audio and or video files such as MP3 AAC and MPEG files. In some implementations device can include the functionality of an MP3 player and may include a pin connector for tethering to other devices. Other input output and control devices can be used.

Memory interface can be coupled to memory . Memory can include high speed random access memory or non volatile memory such as one or more magnetic disk storage devices one or more optical storage devices or flash memory e.g. NAND NOR . Memory can store operating system such as Darwin RTXC LINUX UNIX OS X WINDOWS or an embedded operating system such as VxWorks. Operating system may include instructions for handling basic system services and for performing hardware dependent tasks. In some implementations operating system can include a kernel e.g. UNIX kernel .

Memory may also store communication instructions to facilitate communicating with one or more additional devices one or more computers or servers. Communication instructions can also be used to select an operational mode or communication medium for use by the device based on a geographic location obtained by the GPS Navigation instructions of the device. Memory may include graphical user interface instructions to facilitate graphic user interface processing such as generating the GUIs shown in sensor processing instructions to facilitate sensor related processing and functions phone instructions to facilitate phone related processes and functions electronic messaging instructions to facilitate electronic messaging related processes and functions web browsing instructions to facilitate web browsing related processes and functions and display GUIs described in reference to media processing instructions to facilitate media processing related processes and functions GPS Navigation instructions to facilitate GPS and navigation related processes camera instructions to facilitate camera related processes and functions and instructions for a predictive routing application that is capable of displaying GUIs as described in reference to . The memory may also store other software instructions for facilitating other processes features and applications such as applications related to navigation social networking location based services or map displays.

Each of the above identified instructions and applications can correspond to a set of instructions for performing one or more functions described above. These instructions need not be implemented as separate software programs procedures or modules. Memory can include additional instructions or fewer instructions. Furthermore various functions of the mobile device may be implemented in hardware and or in software including in one or more signal processing and or application specific integrated circuits.

The described features can be implemented advantageously in one or more computer programs that are executable on a programmable system including at least one programmable processor coupled to receive data and instructions from and to transmit data and instructions to a data storage system at least one input device and at least one output device. A computer program is a set of instructions that can be used directly or indirectly in a computer to perform a certain activity or bring about a certain result. A computer program can be written in any form of programming language e.g. Objective C Java including compiled or interpreted languages and it can be deployed in any form including as a stand alone program or as a module component subroutine or other unit suitable for use in a computing environment.

Suitable processors for the execution of a program of instructions include by way of example both general and special purpose microprocessors and the sole processor or one of multiple processors or cores of any kind of computer. Generally a processor will receive instructions and data from a read only memory or a random access memory or both. The essential elements of a computer are a processor for executing instructions and one or more memories for storing instructions and data. Generally a computer can communicate with mass storage devices for storing data files. These mass storage devices can include magnetic disks such as internal hard disks and removable disks magneto optical disks and optical disks. Storage devices suitable for tangibly embodying computer program instructions and data include all forms of non volatile memory including by way of example semiconductor memory devices such as EPROM EEPROM and flash memory devices magnetic disks such as internal hard disks and removable disks magneto optical disks and CD ROM and DVD ROM disks. The processor and the memory can be supplemented by or incorporated in ASICs application specific integrated circuits .

To provide for interaction with an author the features can be implemented on a computer having a display device such as a CRT cathode ray tube or LCD liquid crystal display monitor for displaying information to the author and a keyboard and a pointing device such as a mouse or a trackball by which the author can provide input to the computer.

The features can be implemented in a computer system that includes a back end component such as a data server or that includes a middleware component such as an application server or an Internet server or that includes a front end component such as a client computer having a graphical user interface or an Internet browser or any combination of them. The components of the system can be connected by any form or medium of digital data communication such as a communication network. Examples of communication networks include a LAN a WAN and the computers and networks forming the Internet.

The computer system can include clients and servers. A client and server are generally remote from each other and typically interact through a network. The relationship of client and server arises by virtue of computer programs running on the respective computers and having a client server relationship to each other.

One or more features or steps of the disclosed embodiments can be implemented using an Application Programming Interface API . An API can define on or more parameters that are passed between a calling application and other software code e.g. an operating system library routine function that provides a service that provides data or that performs an operation or a computation.

The API can be implemented as one or more calls in program code that send or receive one or more parameters through a parameter list or other structure based on a call convention defined in an API specification document. A parameter can be a constant a key a data structure an object an object class a variable a data type a pointer an array a list or another call. API calls and parameters can be implemented in any programming language. The programming language can define the vocabulary and calling convention that a programmer will employ to access functions supporting the API.

In some implementations an API call can report to an application the capabilities of a device running the application such as input capability output capability processing capability power capability communications capability etc.

A number of implementations have been described. Nevertheless it will be understood that various modifications may be made. Elements of one or more implementations may be combined deleted modified or supplemented to form further implementations. As yet another example the logic flows depicted in the figures do not require the particular order shown or sequential order to achieve desirable results. In addition other steps may be provided or steps may be eliminated from the described flows and other components may be added to or removed from the described systems. Accordingly other implementations are within the scope of the following claims.

