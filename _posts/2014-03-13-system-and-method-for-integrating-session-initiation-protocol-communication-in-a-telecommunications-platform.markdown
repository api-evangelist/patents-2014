---

title: System and method for integrating session initiation protocol communication in a telecommunications platform
abstract: A system and method for facilitating signaling and media communication at a communication platform that includes receiving a communication request to a resource, wherein the communication request specifies a destination endpoint; establishing signaling and media communication in a session with the destination endpoint of the communication request; registering a callback resource to a signaling event of the session; monitoring signaling messages of the session; detecting the signaling event in the signaling messages of the session; and triggering the callback resource upon detecting the signaling event.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09282124&OS=09282124&RS=09282124
owner: Twilio, Inc.
number: 09282124
owner_city: San Francisco
owner_country: US
publication_date: 20140313
---
This application claims the benefit of U.S. Provisional Application Ser. No. 61 783 134 filed on 14 Mar. 2013 which is incorporated in its entirety by this reference.

This invention relates generally to the telecommunications platform field and more specifically to a new and useful system and method for integrating session initiation protocol communication in a telecommunications platform in the telecommunications platform field.

Session Initiation Protocol SIP is a signaling protocol often used in establishing communication sessions. Such communication sessions can include voice video messaging and other forms of communication. SIP is meant to be an application layer that is independent of the transport layer. Working with SIP to build applications and provide services may require a specialized skill set and building applications on top of SIP may be challenging for some developers. In some cases setting up a SIP endpoint may pose challenges to those hoping to do so quickly and easily. Thus there is a need in the telecommunications platform field to create a new and useful system and method for integrating a session initiation protocol communication in a telecommunications platform. This invention provides such a new and useful system and method.

The following description of preferred embodiments of the invention is not intended to limit the invention to these preferred embodiments but rather to enable any person skilled in the art to make and use this invention.

As shown in a system for integrating session initiation protocol communication in a telecommunications platform is preferably a communication platform facilitating at least bridging communication endpoints through a signaling and media protocol in combination with dynamic programmatic responsive mechanisms. The communication platform is preferably a system substantially similar to the telephony platform described in U.S. patent application Ser. No. 12 417 630 filed 2 Apr. 2009 which is incorporated herein in its entirety by this reference. Herein SIP is used in describing the signaling and media protocol but any suitable protocol may alternatively be used in place of SIP. The system preferably functions to bridge signaling and media traffic with application layer interactions. Combining SIP based communication with HTTP callbacks or other suitable form of application layer callbacks can enable a HTTP request response application model in supplementing SIP communications with information and or logic. The system can provide SIP trunking e.g. originating and or terminating variations and logic can be integrated into the communication flow in a dynamic and customizable manner. Preferably SIP data and or other parameters from the communication session can be passed as parameters in the HTTP request transmitted to the callback resources which can then track react to and or alter the state of the communication session. Other parameters set within an account record through an API request embedded in the signaling communication can be used to enable various features and or responses to the communication.

The system can be distributed across multiple regions. Each region can include carrier edge services public SIP edge services client edge services a proxy core service a trunking application and optionally a communication application service. The system is preferably a multitenant platform wherein a plurality of different distinct users accounts operates within the same infrastructure of the system. The system can include an account system a billing system and additionally services or components to facilitate other features and capabilities of the system. For example the system can include event logging system analytics system recording services conferencing services communication queues text to speech TTS services transcription services and or any suitable component. A carrier edge service preferably functions to route all traffic to and from a carrier. An edge can be defined as a load balancer and a session border controller. A public SIP edge service preferably functions to route all traffic to and from a public SIP endpoint trunking and non trunking . A client edge service preferably functions to route all traffic to and from client applications of the communication platform e.g. web applications or applications using SDK to interface through SIP with the communication platform .

The proxy core is preferably a component that manages touches traffic of the communication platform as a communication router. The proxy core functions to making routing decisions for incoming and outgoing communications. For an incoming PSTN call from a carrier to the carrier edge service to the proxy core the proxy core determines if this is a trunking use case or an application use case. If a trunking use case the proxy core signals to the trunking application. If an application use case the proxy core signals to a communication application service. The use case is preferably determined based on the mapping of the destination number to a routing configuration identifier e.g. a SIP address or an application URI . The proxy core additionally includes a callback engine that monitors SIP transaction messages and can initiate request response interactions with a callback resource over an application layer protocol in response to signaling and or media events. Callback URIs are preferably configured for the communication platform through an API a control user interface or any suitable control mechanism. The communication platform may additionally include a registration record database. The registration record database is preferably used in maintaining routing information for devices that register a communication endpoint with the communication platform.

A trunking application functions to implement trunking functionality such as taking care of REFER SIP messages. In some implementations the system can include communication application service. The communication application service preferably provides a higher level of communication applications such as voice based applications to play recordings perform TTS capture input caller record messages connect other endpoints or control any suitable interaction during a communication session. Preferably the communication application service can function substantially similar to a call router that processes a document of telephony instructions such as in U.S. patent application Ser. No. 12 417 630.

The system can be operated to provide variety of different features. The system as one aspect can include registering and triggering callback resources which function to make SIP trunking sessions reactive to signaling and media events. As another aspect the system can use a unified registration system so that a phone number or other suitable endpoint identifier can be configured to perform trunking or run a communication application further fallback error responses can be defined for either trunking or application execution. For example the system can enable a SIP URI to be associated with a phone number as a main mechanism for communication but if the communication does fail a failure callback can specify an application resource or another SIP URI. In the case of a SIP URI the call can failover to the secondary SIP domain for trunking. In the case of an application resource e.g. preferably specified as a URI of an application resource then that application can be executed. Such a unified communication endpoint registration can similarly be used where an incoming call is initially handled by an application and fails over to a SIP URI. As an example a customer may have capacity for a set number of concurrent phone calls and when the customer hits that limit the system can automatically handle the overflow in accordance the fallback resource. In this example the unified registration for a number 1 415 555 1234 can have an incoming resource set as sip pbx.example.com and a fallback callback as http example.com sorry.xml . Then if the SIP server at sip pbx.example.com is busy and responds with an error response the system can access the fallback callback application. That callback application could play an error message or place in a queue until an agent is available or any suitable application logic.

Similarly select media features such as recording may be enabled during a trunking communication session. An additional aspect can enable a communication session to dynamically transition between operating modes where a communication session may be established in a low level trunking mode and then elevated to enable application processing or other media features. Operational mode transitioning can provide better use of resources and possibly allow customers to selectively reduce account usage and consequently lower platform cost . As another element of the system a signaling application module can function to provide customizable signaling endpoints wherein a signaling application module will extract and use embedded data of the endpoint identifier to alter signaling. The system is preferably configured to perform any suitable combination and or subset of processes of the methods described above.

As shown in a method S for integrating session initiation protocol communication in a telecommunications platform of a first preferred embodiment can include receiving an outgoing communication request to a resource S establishing signaling and media communication in a session S registering a callback resource to a signaling event of the session S monitoring signaling messages of the session S detecting the signaling event in the signaling messages of the session S and triggering the callback resource upon detecting the signaling event S. The method functions to bridge signaling and media traffic with HTTP as shown in . The method is preferably used in communications using SIP as a communication protocol but may alternatively be used in any suitable signaling and media communication protocol. Combining SIP based communication with HTTP callbacks can enable a HTTP request response application model in supplementing SIP communications with information and or logic. Preferably SIP data and or other parameters from the communication session can be passed as parameters in the HTTP request transmitted to the callback resources which can then track react to and or alter the state of the communication session. The method is preferably implemented within a multitenant communication platform. The callback resources configuration is preferably stored and maintained for a plurality of accounts and or sub accounts.

The method can be applied to several different signaling and messaging use cases and communication topologies.

The method can be applied to terminating and originating SIP trunking scenarios. In the terminating use case described in more detail below the call could originate from a PSTN endpoint an outside SIP endpoint an internal SIP endpoint or any suitable type of endpoint. The terminating endpoint preferably depends on mapping of a destination endpoint to a SIP endpoint as shown in . The originating use case can allow account holders to make outbound SIP communication requests through the communication platform in association with their account. Originating outbound communication requests can include a layer of authentication to facilitate interfacing with outside endpoints on behalf of an account as shown in . Furthermore there can be translation between the specified destination and the actual intended destination endpoint. In yet another variation the signaling and media communication can be initiated through an API request and the callback can be triggered during a signaling event between the communication platform and a communication endpoint. In one example shown in an API request could initiate a call to a SIP endpoint stages and in the signaling event of someone answering could result in retrieval and processing of callback resource that instructs the call to connect to another endpoint e.g. a PSTN endpoint in the example of . This API variation could similarly be applied in initially calling a PSTN number and connecting a SIP endpoint as shown in . Such use cases may be applicable in connecting a customer and a customer service agent in response to an interaction on a website or mobile app.

Block S which includes receiving a communication request to a resource functions to prompt start or initiate a communication session. The resource in one variation can be to an endpoint with an account routing configuration e.g. outside entities make a call into the communication platform . This variation will be discussed in more detail in method S. The resource may alternatively be directed to an outside endpoint through the communication platform e.g. PBX of an account holder sending an INVITE to 415 xxx xxxx . to make an termination trunking call to 415 xxx xxxx . The request preferably includes a specified destination. The communication request can be received as a signaling message directed at a domain of the platform where the signaling message is requesting to establish a media communication session with a communication endpoint. The outgoing communication request can be received as the platform facilitates SIP trunking termination. For example a customer could be enabled to use a desk phone or a call center workstation behind an IP PBX to make a call to a cell phone or landline as shown in . When using SIP the signaling message may be an INVITE a REFER or other suitable type of signaling message. The signaling message can originate from an IP public branch exchange PBX system that can reside off premise e.g. on premise at a customer s infrastructure as shown in . Alternatively an IP PBX system can operate within the platform on behalf of one or more accounts. The signaling message can include an authentication token. An authentication token could be account credentials an HMAC a signed data package or any suitable token used in verifying authenticity of the message. In one variation authentication tokens can be passed through header parameters of the SIP request. Alternatively receiving an outgoing communication request can include identifying an account of the communication platform that is mapped to a domain identifier of the originating endpoint e.g. the domain of the SIP address or the originating IP address. The credentials can be authenticated and verified as a request made on behalf of an account. If the credentials are successfully verified the platform can establish media communication with the destination of the outgoing communication. The outgoing communication request can additionally include feature headers that specify communication features such as analytics recording media processing transcription or other suitable media properties. The outgoing communication request can additionally specify a callback resource to register for the session.

An outgoing communication may alternatively be initiated in response to an application programming interface API request of a telecommunications platform. The API request is preferably transmitted on behalf of an associated account and received at an API service of the platform. For example an application or outside entity may make an API request to the communications platform to make an outgoing SIP based call. The outgoing communication may additionally be initiated from a telephony instruction in a communication application. In this use case the communication session is established between the communication platform and the destination endpoint. The callback resource may be used in detecting when the call is answered and beginning application execution or connecting to another endpoint. Though an API request may be made to connect multiple endpoints.

The communication request is preferably for establishing an audio session between at least two parties. In one variation the two parties can be the communication platform and a specified signaling and media endpoint. In another variation the two parties can be the caller originating endpoint and a destination endpoint. The destination endpoint may be specified in the request. The outgoing communication may alternatively establish a video session a chat messaging session an application communication session e.g. a multi player gaming session screen sharing session multimedia session presence information session or any suitable application of a communication session. Once instructions have been processed instructing a communication router to establish an outgoing communication the communication router will preferably make an outgoing INVITE SIP request to a specified endpoint. Alternatively the request may be a REFER SIP request or any suitable SIP request. The method may alternatively or additionally be used with other protocols for establishing a session.

Block S which includes establishing media communication in a session functions to initiate bridge or connect an originating endpoint with a destination endpoint. The destination is preferably defined by the username identifier of the destination endpoint. The destination endpoint will preferably be another telephony endpoint such as a phone number which will be connected through PSTN. A carrier can be selected and used to establish a media communication with the phone number. Alternatively the phone number could be an alternative endpoint identifier wherein the media connection is established with a proxy signaling and media service of that alternative mode of communication. In yet another variation the phone number of alternative endpoint identifier may be destination registered within the platform wherein the method below for incoming communications may be used to establish the media communication with another SIP user agent. Once instructions have been processed instructing a communication router to establish an outgoing communication a communication router will preferably make an outgoing INVITE SIP request to the specified destination endpoint. Alternatively the request may be a REFER SIP request or any suitable SIP request. The method may alternatively or additionally be used with other protocols for establishing a session. If multiple endpoints are defined and do not have an established signaling and or media connection multiple endpoints may be contacted and included in the media communication.

Block S which includes registering a callback resource to a signaling event of the session functions to associate instantiate or create a webhook reactive resource or event handler that is notified as a result of session messages signaling patterns and optionally media events. The registration of a callback resource preferably includes receiving a specified callback URI to associate with communication events. The callback resource may be set for an account for a sub account for an endpoint for a particular pattern of communication sessions for a particular instance of communication e.g. for the specific outgoing communication session or for any particular categorization of communication sessions. A unique callback resource can be specified for a specific event. The specific event is preferably a type of signaling message which may be the classification of the signaling message e.g. INVITE Ringing 200 OK BYE etc. . The type of signaling message can alternatively be a pattern that can be defined by the parameters of a signaling message. For example any SIP INVITE to an address with a particular area code in the user field of the to field. A signaling event may also be defined by a set of different signaling patterns either generated by the communication platform or received from an endpoint. For example a signaling event of hang up could be triggered from the BYE message and or a timeout in the signaling media. Multiple callback resources can be registered to handle different types of signaling messages and or to handle callbacks with different scopes e.g. one callback scoped for all sessions made in association with an account and a second callback scope for a particular session instance . A multi purpose callback resource may alternatively be specified which can be a callback resource to handle callbacks for a variety of callback events. An end user e.g. an outside developer can configure the multi purpose callback resource to parse parameters passed in to the callback resource so as to handle different events. In one exemplary implementation the callback resource can be used in a SIP based voice session and be triggered based on call events such as call starting ringing pickup answering machine hang up DTMF input and or any suitable event of SIP based voice sessions. Callback resources may alternatively be registered for any event of any suitable type of communication session. The callback resource may additionally be shared between other modalities of communication. For example a callback URI may be registered for voice session initiation for PSTN voice calls and for SIP based voice calls. The callback resource is preferably stored in a table mapping the callback resource to an account identifier an application identifier and or an endpoint identifier.

The callback resource may be registered through an administrator control panel interface through an API in headers of an outgoing communication request in the parameters of an outgoing communication instruction or in any suitable location. In one instance an outgoing communication request includes a parameter that defines the callback resource. The parameter can specify a callback resource URI or other suitable identifier and optionally a signaling event definition. In another instance during a session a signaling message can be received that includes a parameter defining the callback resource wherein registering a callback resource comprises registering the callback resource according to the parameter in the signaling message. Accordingly signaling messages can be processed to identify callback resource registration. In another instance during the session an API communication can be received that identifies the session and specifies a callback resource to register for a signaling message type. In another instance a callback resource is registered according to account settings associated with the account making the outgoing communication. Account settings can be set through an administrator control panel or through any suitable interface.

Other resources may additionally be configured for an account or an endpoint to promote robust SIP communication. A fallback URI may be configured to use if an application URI and or a callback URI fails. A lost connection configuration may specify how a call is handled if a call is dropped. A lost connection configuration may direct the call to an error handling application URI e.g. to read an error message and provide options . A lost connection configuration may alternatively specify actions to be taken to reestablish the connection.

Block S and S which include monitoring signaling messages of the session and detecting the signaling message type in the signaling messages of the session function to process signaling and media transactions of the communication session. The communication messages made by a user agent client e.g. the caller or a user agent server e.g. the callee are preferably monitored. If a communication router detects a communication that has an associated callback resource the callback resource is preferably triggered. The SIP communication may be monitored for a Trying message Ringing e.g. call is ringing OK e.g. answered Bye e.g. hang up and or any suitable type of message. The transactional messages of SIP are preferably used to bridge SIP communications to HTTP based world.

Step S which includes triggering the callback resource upon detecting the signaling message type functions to notify message or signal to a callback resource that an event has occurred. Triggering of a callback resource preferably enables evented web functionality with SIP communication. Preferably an application layer communication e.g. an HTTP request is made to a configured callback resource URI. The callback resource URI is preferably a resource external to the platform and often controlled and or operated by the account holder though the callback resource URI can reasonably be a service operated by any suitable entity . The callback resource may alternatively be hosted and triggered using any suitable protocol. Additionally communication to a callback resource can be annotated with session metadata such as SIP specific data associated with the session. Preferably SIP data and or other parameters from the communication session are passed as parameters in the HTTP request transmitted to the callback resource. For example header fields of SIP transaction messages may be passed as parameters to the callback resource. The response from a callback resource may be used in the processing and handling of the communication session. For example the callback resource may supply communication instructions to redirect the call to hang up to record a conversation to transcribe a conversation or to perform any suitable action. The use of callback resources preferably enables SIP based communication sessions to follow a HTTP request response application model that many developers are familiar with from web development experience. In one variation the callback resource is triggered and takes appropriate action external to the platform. A simple acknowledgment of being triggered may be returned to the platform. In another variation a callback resource can provide an actionable response. The callback resource response can include communication instructions that are processed and executed in association with the session. For example a response may be returned with telephony instructions that connect the session to another endpoint enable media processing features alter operating mode execute telephony instructions or direct any suitable form of action with the session.

As one exemplary use of the method a SIP based communication session may be established through an implementation of terminating SIP trunking as described above. A client agent connected through a customer s IP PBX can carry on a synchronous media communication session e.g. voice video etc. with a destination endpoint accessed over a carrier or otherwise. A callback application can be registered for the session such that the callback application is triggered on detection of a BYE signal communicated from the destination endpoint leg of the communication. When the destination endpoint hangs up the BYE signal message is received. In response to the BYE signal message the communication platform can transmit a communication to a URI of the callback application. The callback application can take action within its infrastructure e.g. logging updating status etc. or alternatively respond with some communication directive to alter the media and or signaling of the session for the leg of communication with the remaining endpoints connected to the session. In one variation the operating mode can be upgraded to enable telephony instruction processing or other suitable media features.

In addition to using callback application registration to enable signaling and media communication protocols programmable and responsive. The method may additionally include enabling media processing through signaling directives or account configuration. Media processing can include recording transcription and or other suitable media processing processes that can be added on top of basic trunking or communication bridging services. Media processing services can be enabled similar to registering a callback resource. Media processing features can be enabled through an administrator control panel interface through an API call in headers of an outgoing communication request in the parameters of an outgoing communication instruction as a parameter passed in a signaling message during a session or in any suitable manner.

In another variation described more below the destination SIP endpoints could be a signaling application modules that follow defined application logic in response to data embedded in the destination endpoint. For example multiple PSTN endpoints could be included in the user field which may be contacted in parallel or in series until one answers the communication request.

As shown in a method S for receiving inbound SIP communication of a second preferred embodiment can include receiving an incoming communication request S establishing a media communication in a session according to the incoming communication request S registering a callback resource to a signaling event S inspecting communication signaling messages of the communication session S detecting the signaling event from the communication signaling messages of the communication session S and triggering the callback resource upon detecting the signaling event S. The method of the second preferred embodiment functions to allow inbound calls or communication requests to connect to an endpoint managed by the communication platform. The inbound calls are preferably from an outside entity. In a preferred implementation the method is used to bridge SIP communication with a HTTP request response model as with the method of the first preferred embodiment. In alternative implementations of the method the method may be used in transitioning between basic SIP communications and application level communications. Basic SIP communications are preferably those established through SIP trunking in an originating call flow as shown in . Basic SIP communications preferably provide simple communication connections e.g. simply bridging a communication session between a SIP device and a PSTN device with minimal or selective processing or controlling communication interactions. The method preferably provides a way to enable rich media interactions injected into lightweight signaling and media communication flows.

Block S which includes receiving an incoming communication request functions to initiate communication with a destination. The destination is preferably an endpoint managed by the communication platform. The incoming communication request preferably originates from some form of originating endpoint. In one variation the communication request is a SIP communication request. The SIP communication request preferably specifies a destination endpoint identifier. The incoming SIP request may be initiated by any suitable device or application. DNS is preferably the mechanism in which the SIP communication request is directed to the communication platform. The inbound SIP request is preferably an INVITE request to start a communication session but the request may be any suitable initiating instruction. The INVITE request may be received from an outside carrier or communication system. A carrier may use SIP or an alternative signaling and media protocol as a mechanism for bridging PSTN initiated call to the communication platform. The carrier may alternatively be another VoIP provider. Alternatively the INVITE request may be initiated from within the communication platform e.g. communication between account instances . In a second variation the communication request can be any suitable incoming communication such as a PSTN based phone call.

Block S which includes establishing a media communication in a session according to the incoming communication request functions to initiate bridge or connect an incoming communication with a destination endpoint. Preferably a media communication or stream can be established through the communication platform with the initiating endpoint i.e. caller leg and at least one destination endpoint e.g. callee leg . The callee is preferably a signaling and media endpoint e.g. SIP endpoint connected through a public branch exchange or an alternative proxy. The media may additionally be redirected through additional media services which have been selectively enabled for the session. For example enabling of media services such as recording transcription analytics API control and or other media processing features may be enabled through account configuration and or session configuration. An account holder on the communication platform can preferably configure their account and optionally an IP PBX to facilitate originating SIP trunking. As shown in a carrier may direct a SIP INVITE REFER or other initiating signaling message to the communication platform. The addressing can specify an endpoint address e.g. phone number shortcode endpoint identifier etc. in a user field of a SIP address. The domain of the SIP address can be a domain controlled by the communication platform or otherwise redirected to the communication platform. In one implementation of the method the endpoint address is mapped to an account. For example an account may have one or more phone numbers registered within the communication platform. Within the account settings the endpoint address can be mapped to a primary account routing configuration. The account routing configuration can specify a URI domain name or other identifier of a resource that can handle the signaling and media communication as shown in . The communication platform then sends an invite addressed to the endpoint address within the resource specified in the account routing configuration. For example the domain name of the account holder s IP PBX replaces that of the communication platform in the to field of the INVITE request. Additionally the caller endpoint can be used in the username of the from field but with a domain of the communication platform which can function to provide an easy way to call back the caller through the trunking service of the communication platform. Media can be established between the caller and the callee through the communication platform and subsequent signaling can be routed through the communication platform.

Block S can include extracting an endpoint identifier which functions to map a destination endpoint identifier with an endpoint of the communication platform. In one preferred variation the destination endpoint identifier in a signaled communication request will include a local portion e.g. a username or phone number and domain portion. The destination endpoint identifier preferably maps to an endpoint record. The endpoint record is preferably a stored model of the endpoint configurations which may be stored in association with an account or sub account. An endpoint record will preferably store a signaling endpoint an application URI and or any callback URIs. Preferably the communication platform maintains a database table that maps account secure identifiers to signaling endpoints or application secure identifiers. A second database table may maintain a mapping of application secure identifiers to application URIs. Other tables may maintain callback URI s. In one exemplary implementation the endpoint identifiers of the communication platform use a syntax pattern with an application secure identifier and an account secure identifier as the local portion of the endpoint identifier. An example of an endpoint identifier may be applicationSID accountSID.example.com where accountSID is a unique secure account identifier. The endpoint identifier is preferably specified in a header of the SIP invite but may alternatively be conveyed in any suitable parameter. The secure account identifier may be used in determining an application URI any callback URIs and machine address e.g. IP address . Any suitable pattern may be used in the endpoint identifier such that the communication platform can properly route the request. In another preferred variation the destination endpoint may be an endpoint associated with the protocol medium of the incoming communication. For example an incoming PSTN phone call may be directed at a phone number destination. The communication destination may additionally or alternatively be mapped to a signaling endpoint an application URI and or any callback URIs in an endpoint record.

The incoming communication may additionally be authenticated. Due to the communication platform preferably being a multitenant platform the method preferably uses the authentication process in identifying and selecting the proper routing and application settings to use in the communication session. The authentication may be performed at the load balancer prior to being directed to the communication router at the communication router or at any suitable point.

In one preferred embodiment establishing media communication can depend on selectively routing media according to customizable mapping as shown in . The method S can include mapping a destination endpoint specified in the incoming com communication signaling request to a primary account routing configuration if the primary account routing configuration is a signaling endpoint establishing a media stream communication of the communication session comprises routing an invitation signal to the signaling endpoint and establishing the media stream from a originating endpoint of the incoming communication request and the signaling endpoint and if the primary account routing configuration is an application resource identifier establishing a media stream communication of the communication session comprises retrieving and processing an application specified by the application resource identifier to direct the media stream. The customizable mapping functions to enable a communication platform to provide a unified endpoint configuration system where an endpoint can be configured to be routed directly to a communication endpoint or to a communication application with enhanced media processing. In this embodiment a destination endpoint identifier can be selectively invoke different behavior for different accounts. For example some accounts would want an endpoint to initially route to a SIP phone while other accounts may want a telephony application to handle an inbound call. Additionally the customizable mapping can include a secondary account routing configuration wherein upon detecting an error or other suitable communication event establishing media communication according to the secondary account routing configuration. The primary routing configuration and the secondary account routing configuration could be a signaling communication endpoint such as a SIP address or domain name for an IP PBX resource or an application URI. In one account instance an incoming call may be initially handled by a communication application and if that fails fallback to connecting a SIP endpoint while in another account instance an incoming call can be connected to a SIP endpoint and if that fails fallback to a communication application e.g. instructing a text to speech service to announce an error and instruct the caller to callback later . In other account instances the primary and secondary routing configurations may both be signaling endpoints or both be communication applications.

In the variation where the account routing configuration includes a signaling endpoint establishing media communication can include establishing media communication from the originating endpoint to the destination of the signaling endpoint. For example if the signaling endpoint is sip pbx.example.com and the call was to sip then the destination connected for media communication can be pbx.example.com . In one variation two endpoints are connected for voice video screen sharing or other suitable form of a synchronous real time communication.

In a related variation the destination signaling endpoint could be a signaling application module that follows defined logic in response to data embedded in the signaling endpoint stored in the account routing configuration. If the signaling endpoint is a signaling application module the communication platform preferably routes the message according to the signaling endpoint logic above but a signaling application module a signaling and media proxy server receives the communication request the invite is processed. Accordingly the method can include routing to a signaling application module at the signaling application module coordinating signaling with the signaling endpoint in accordance with the metadata. In this variation the signaling endpoint includes metadata embedded in the endpoint identifier and the signaling application module is additionally identified.

The signaling application modules are preferably hosted and provided by the communication platform but outside entities could similarly host and operate the signaling application modules. A signaling application module can preferably be referenced as part of a signaling endpoint identifier. Parameters that define functionality of the signaling application module are additionally a part of the signaling endpoint identifier. A signaling application module preferably functions to provide a defined set of functionality that is commonly implemented for many users. A signaling application module could be defined to set up a conference call of multiple signaling endpoints to call a set of endpoints in parallel and only connect the first one to pick up to call a set of endpoints in series one after the other and or to serve any suitable use case. A web form or other suitable application can be used by a user to input the parameters of a particular signaling application module instance and the form outputs a signaling endpoint with the parameters appropriately embedded in the address as shown in . Additionally or alternatively a library could be provided that includes a function to facilitate generating a signaling endpoint with the parameters appropriately embedded. The library may be used in making outbound calls in method S. For example a signaling application module that calls a set of numbers in parallel may be generated to call three numbers in parallel and have a signaling endpoint of the pattern parallelexample.com as shown in . The syntax of the signaling endpoint and embedded parameters can be any suitable syntax. An INVITE or other communication initiation communication is preferably delivered to a resource of the signaling application module. At the resource of the signaling application module the signaling endpoint is parsed interpreted and applied in signaling and media logic. In the above example the three numbers are extracted and then used as inputs to application logic that calls a set of endpoints in parallel. Signaling application modules can be used in method S or in method S.

In an alternative variation an incoming SIP communication request may specify communication application instructions within the SIP request. In one preferred implementation SIP request headers can specify SIP communication instructions. Communication instructions embedded in the SIP request function to enable an application to be defined specifically for an incoming SIP call. The communication instructions may alternatively be specified in the body of the SIP request or in any suitable portion of the request. The request can preferably enable application control without configuring an application because communication instructions can be configured directly in the SIP request. For example a SIP request may enable one or more communication features of the communication platform by including the appropriate directives in the header of the SIP request. Using SIP request instructions may function to alleviate the system from providing full application stack support for the communication if the desired features for the communication are limited.

In the variation where the account routing configuration includes a application resource identifier establishing media communication can include retrieving a communication application specified by the application resource identifier which functions to send the request to an application server. A proxy core server preferably invites an application processing server e.g. a call router which then retrieves and executes communication application instructions. Retrieving a communication application can additionally be in response to the registered callback resource or optionally the secondary routing configuration used in error handling as shown in . The application server preferably hosts or generates application logic that can instruct the communication platform how to process handle or route the incoming communication request. A communication application is preferably a remotely hosted resource that can be accessed over HTTP SPDY alternative application layer protocol or any suitable network protocol. Alternatively a communication application may be hosted locally within the communication platform or accessed over any suitable protocol. Preferably a request is sent to an application URI and more preferably the request is sent to a URI mapped to the endpoint identifier. An application server is preferably a third party server and more preferably the server is hosting a web application. The request is preferably sent to a server over a network. In one variation the request is sent to a local server on a local area network. In yet another variation the request may be sent to multiple servers. The request preferably encapsulates at least a portion of the state information from the communication request such as the originating endpoint the destination endpoint the date and time of the initiating request geographic location of the caller e.g. country city and or state zip session identifier and or the unique call ID or other state properties of the communication. The request more preferably encapsulates all the state information of the call but may alternatively include no state information or partial state information. The state information from the initiated communication session is preferably sent via HTTP POST in the request body HTTP GET in the request URI HTTP header parameters to mimic the data flow of a web browser or by any combination or suitable alternative way. A communication application is preferably retrieved prior to establishing a communication session between the at least two endpoints. Alternatively the communication session may at least initially be routed to the appropriate destination for a basic communication session such as providing simple SIP trunking.

The instructions of the communication application can be processed in establishing media communication of the communication session. The communication platform and more preferably a communication router can convert the instructions of a communication application e.g. server response into communication actions or executable operations during the communication session. The communication instructions actions for voice based communication sessions may include for example playing a pre recorded sound file at a server specified URI such as a static mp3 file located at http demo.example.com myapp 1234.mp3 reading text to the caller using text to speech technology calling another number such as creating a new voice connection through the PSTN SIP VoIP or other IP technology system collecting digits via DTMF input recording voice response audio TTY or other inputs transcribing spoken words to text sending an SMS MMS message putting a call on hold ending a call transferring a communication to another endpoint e.g. other SIP based devices PSTN devices or other suitable destinations and or any suitable combination or sequence of these or other suitable actions. The communication instructions may be any suitable instructions customized to the particular medium of communication such as video text media messaging screen sharing session multi user application session or any suitable medium of communication. In the variations where at least one feature is specified in the SIP request the communication platform may configure the communication request to use a subset of communication resources. For example if the SIP request included a header that specified that the call should be recorded and not processed by an application then the communication session may flow through a resource that provides recording capabilities. Similarly if the SIP request is determined to be one for SIP trunking the SIP communication session may be established using basic resources for the communication session e.g. not processing with an application stack .

Block S which includes registering a callback resource to a signaling event functions to associate instantiate or create a webhook resource or event handler reactive to the communication session. Block S is preferably substantially similar to block S described above. The registration of a callback resource preferably includes receiving a specified callback URI to associate with communication events. The callback resource may be set for an account for a sub account for an endpoint for a particular pattern of communication sessions for a particular instance of communication e.g. for the specific outgoing communication session or for any particular categorization of communication sessions. A unique callback resource can be specified for a specific event. A callback resource can be registered through an account routing configuration. In this variation all calls to an endpoint would have the callback resource registered. A callback resource may additionally or alternatively be registered in response to header field or embedded parameter included in a signaling message. Such registration may require authentication parameters to verify that the registration can be authenticated on behalf of the corresponding account. For example once a call is connected to an account SIP phone through an IP PBX of the account holder the account holder could inject header parameters in a signaling message e.g. an INFO signal that registers a new or updated callback resource and includes signed tokens to verify that the request comes from the account holder. A callback resource can additionally or alternatively be registered through an API request or through any suitable mechanism.

Block S and S which include inspecting communication signaling messages of the communication session and detecting the signaling message type in the communication signaling messages of the communication session function to process signaling and media transactions or the communication session. Applied to SIP trunking applications blocks S and S can include monitoring SIP transactional messages. SIP transactional messages can be used to interact with evented resources such that SIP initiated communication sessions can be treated as request response communications. Block S which includes triggering the callback resource upon detecting the signaling message type functions to notify message or signal to a callback resource that an event has occurred. Triggering the callback resource preferably includes making an application layer communication to an external resource specified by the callback resource. Blocks S S and S can operate substantially similar to blocks S S and S.

As shown in a method S for integrating session initiation protocol in a telecommunications platform of a third preferred embodiment can include receiving a SIP endpoint registration request S authenticating the registration request S and updating a registration record according to the registration request S. The method S of the third preferred embodiment functions to register SIP endpoints to use the communication platform as a registrar for addresses of SIP communication. The method of registering SIP endpoints may be used in any suitable combination or variation of the methods described herein. A SIP device or application is preferably configured to register as a SIP endpoint of the communication platform. The communication platform preferably receives registration requests from the device or application and updates a maintained registration record so that the device can participate in communication sessions as shown in . The authentication of registration requests can provide a layer of security in the namespace of SIP endpoint registration. Additionally the authentication of registration requests can be used in expanding the ways endpoints are registered.

Block S which includes receiving a SIP endpoint registration request functions to obtain a notification for a registration update of at least one SIP endpoint on the communication platform. The registration request is preferably to add a new SIP endpoint update an existing SIP endpoint or remove an existing SIP endpoint. The registration request may originate from a device requesting to be registered. For example a SIP based phone may be registered. As another example a client device may use an application to register. The registration request may alternatively be transmitted over an API submitted through an administrator user interface or received from any suitable source.

The registration request preferably specifies a namespace identity and a device identity. The namespace identity preferably includes a communication platform identity e.g. an account id and a domain name. The communication platform identity is preferably an account identifier that functions as an account denormalizer. The communication platform identity may alternatively be a username account secure id sub account id or any suitable identifier for an entity of the communication platform. The communication platform identity may additionally include an application identifier. The domain name preferably conforms to DNS routing. The DNS is preferably configured to route SIP communication to that domain to the communication platform. For example the namespace identity may be example123 example.com where example123 refers to a particular account and example.com is used as the domain name in routing SIP requests. In one variation accounts of the communication platform may be allowed to use a predefined domain name space. In another variation accounts may be able to use any suitable verified domain. Verifying a domain may include receiving DNS configuration for a domain accessing a verification signature at specified location of the domain e.g. retrieving a text document with a verification signature from the root of the domain using an authentication callback of the domain completing an authentication process with the domain e.g. oauth or completing any suitable authentication process. Additionally the domain registration techniques may be extended to using outside account systems for registering a namespace identity such as completing oauth authentication to use a social network identity as the namespace identity. The device identity preferably includes the IP address and port to contact the device but any suitable addressing scheme may alternatively be used. A registered device may additionally be configured with a preferred transport such as TLS UDP SCTP WebSocket TCP or any suitable protocol but the use of DNS may also resolve the preferred transport.

Block S which includes authenticating the registration request functions to add a layer of security prior to changing any records. As mentioned the communication platform is preferably a multitenant platform managing multiple accounts. Authenticating the registration request preferably verifies the identity of the request. The authentication may be used in authenticating that the changes to the registration records of the communication platform are allowed. A received registration request is preferably authenticated prior to updating registration records. In one variation a device is preferably configured with an authentication token that is passed to the communication platform along with the registration request. The communication platform upon receipt of the authentication token preferably verifies the token for the registration request. If the authentication token is deemed valid the registration request is processed.

Preferably an outside service may be queried for permission. For example a callback URI may be expected for at least a subset of domains. The callback URI may be based on the domain name of the namespace identifier in the request. The callback URI may alternatively be preconfigured registered or mapped by the communication platform to use a particular authentication technique. An authentication request is preferably transmitted to the callback URI along with at least a subset of information from the registration request. The outside resource will preferably perform any suitable authentication and then respond indicating if the registration request is allowed or denied. A preferred embodiment may employ the use of a callback URI to authenticate any suitable SIP communication in addition to or in place of authenticating registration .

In one preferred implementation authentication of the request may use a policy engine that functions to provide authentication for connection requests. The policy engine preferably authenticates a registration request from the client prior to completing the registration. The policy engine is preferably used in the authentication process of a preferred embodiment in a manner substantially similar to the authentication approach described in U.S. patent application Ser. No. 13 478 495 filed 23 May 2012 herein incorporated in its entirety by this reference. The policy engine preferably authenticates the request by using a token associated with the client and analyzing a signed client communication from the client. If the client communication satisfies the authentication a preferred embodiment preferably adds or updates the registration in response to client authentication at the policy engine. If the client communication fails to satisfy the authentication an error may be logged and any suitable error response may be taken. Preferably the token is sent from the client. In one variation the client has an embedded token from when an application was instantiated. In another variation a communication can be made to an authentication application to retrieve a token. Alternatively a client identifier is sent to a policy engine that has an authentication application authenticate the credentials of the client identifier. Similarly a SIP backend authentication may alternatively be used. The authentication may occur for registration and or outbound communications. The token preferably includes an application ID and any additional parameters. The contents of a token are preferably signed with a secret key. A policy engine preferably completes authentication of the token before allowing a registration to complete. A policy engine preferably mediates the call out requests and authenticates any tokens and may additionally verify permissions associated with application identifiers. Any suitable alternative forms of authentication may alternatively or additionally be integrated into the method. Such security measures may additionally or alternatively be used in authentication and or authorization for other methods and systems of preferred embodiments described herein.

The authentication may additionally or alternatively be in place to authorize that the request has legitimate permissions to use the included credentials. For example if the registration request specifies a namespace with an outside domain name the communication platform preferably verifies that the requester has permissions to use that outside domain. Verifying outside permissions may additionally result in updating or requesting updates in outside services such as making DNS changes. Permissions may additionally be authorized. Permissions may determine the actions allowed by the registered device. The numbers that can be called from that number or the numbers that can call in to the registered device may be limited. The modes of communication such as a messaging voice sessions video sessions screen sharing sessions application sessions or other modes of communication may be set in the permissions. In one variation a device may be limited to registration only and receiving calls. Any suitable permissions may be applied to a device.

Block S which includes updating a registration record according to the registration request functions to add augment or remove registration records from the communication platform. The registration records are preferably stored in an accessible registration database. Routing tables and or any suitable routing data or models may additionally be maintained such that inbound and or outbound communication sessions can be established for the registered devices. In one use case updating a registration record includes adding a device registration to the registration records. In another use case updating a registration record includes editing information of an existing device registration. For example the IP address may need to be updated for a registered device when the device changes to a different wifi network. The device will preferably transmit a new registration request to update the new IP address. In another use case updating a registration record includes removing deleting or deactivating a registered device from the registration records. Any suitable update may alternatively be made. In one variation multiple devices may be configured for a single endpoint. The multiple devices may be configured for any suitable cooperative use. In one example multiple devices are prioritized so that if the highest priority device is not answered then the next highest priority device is called.

The method may additionally include routing inbound communication according to the registration record. An inbound communication may be received over any suitable mode of communication. The mode of communication may include messages voice sessions video sessions screen sharing sessions application sessions or any suitable mode of communication. The inbound communication is preferably a SIP communication but the inbound communication may have been initiated from any suitable protocol such as PSTN. Upon receiving an inbound communication the registration database is queried to find the appropriate registration record. The registration record will preferably map a communication platform identifier e.g. account identifier to a device identity e.g. a current IP address of the device . The inbound may simply specify the communication platform identifier to connect to the proper registered device. Additionally or alternatively the inbound communication may specify a telephony endpoint such as a telephony number or short code a username or any alternative identifier. The communication platform preferably includes a database record mapping the alternative identifier to at least the communication platform identifier. For example if the inbound communication specifies a phone number that number is preferably mapped to an account identifier and then subsequently mapped through the registration database to a current IP address of the device.

Additionally the method for registering SIP endpoints may include providing access to the registration data. Information from the registration database can preferably be accessed through an API. The registration database may be accessed through a REST API a client interface e.g. a JavaScript frontend interface a device SDK interface e.g. iOS or Android SDK interface and or any suitable interface. The interface can preferably be used to programmatically interact with the registration see who and what devices are registered see who is online history of registration duration of registration location of registration the permissions of registered users e.g. who is registered to call a particular endpoint and or any suitable property of registration. The data in the registration database is preferably associated with at least one account sub account or application id. Requests submitted through the interface preferably authenticate so that the permissions to access the requested registration information can be authorized.

As shown in a method S for transitioning between SIP operational modes of a preferred embodiment can include establishing SIP communication session in a first mode S receiving a transition signal S and altering the operational mode of the communication session S which functions to change the resources used in processing the communication session. The variation preferably functions to enable basic SIP communication sessions e.g. SIP trunking communication sessions to be elevated to a communication processed by the application stack of the communication platform as shown in . Similarly the variation may be used to demote a communication session using application processing resources to use less or basic communication sessions as shown in . The operational modes thus preferably include a basic communication mode and an application stack communication mode but any alternative operational mode may be used. In one variation an operational mode may be defined for a particular feature or set of features of the application mode. For example an operational mode may exist that routes the call through call recording resources. The basic communication mode is preferably used when a call or communication session is established from SIP trunking. The communication platform preferably established the SIP communication session which is ran through a SIP proxy of the communication platform. The application stack communication mode is preferably used when a communication router uses a retrieved communication application when processing a communication. When in an application stack communication mode the SIP session preferably has full application capabilities. An application can preferably modify state of the SIP session and perform actions such as redirect the call hang up record a conversation transcribe a conversation send an message e.g. SMS MMS application message merge the call and or to perform any suitable action.

Step S which includes establishing SIP communication session in a first mode functions to establish either a communication session in a basic application or another alternative communication mode. The method may be used to promote or demote the SIP communication mode. Additionally modes may be changed any suitable number of times. As shown in a basic SIP communication mode may be promoted to use the capabilities of an application communication mode. As shown in a SIP session in an application communication mode may be demoted to forgo the application capabilities and operate in the basic SIP communication mode. As illustrated in the communication mode may switch multiple times. The established SIP communication is preferably established in a manner substantially similar to the methods described above but the SIP session may alternatively be established in any suitable manner.

Step S which includes receiving a transition signal functions to obtain or identify a trigger to change modes of SIP communication. The transition signal may be received at any suitable point. The transition signal is preferably established and triggered through the programmatic features discussed above in methods S and S. In one variation the transition signal may be communicated in a SIP message. Either party may be able to trigger the altering of the operational mode of the communication session. Preferably the SIP signaling may include an application ID an authentication token and or any other credentials to specify how to transition the communication e.g. which app to give control to and indicate the request is authentic and or authorized . The transition signal may alternatively be submitted through an API request preferably a REST API request . The REST API preferably has a resource in which the SIP session may be accessed and acted upon. The REST API preferably specifies the new mode of operation and in the case of promoting the communication to an application communication mode the REST API request may specify parameters for what application should initially control state. In yet another variation a callback URI may be registered for a communication session and or an endpoint so that the action may be triggered based on the SIP messages. For example a callback may be registered for a basic SIP communication session so upon one of the endpoints hanging up the other endpoint is changed to an application communication mode with a pre specified application. When the communication session mode is an application communication mode an instruction of the application may trigger the change in the operational mode essentially ending the application control of that application.

Step S which includes altering the operational mode of the communication session functions to update the communication platform to use the appropriate resources to manage the communication session. When in a basic communication mode the communication session is preferably routed through a SIP proxy. When in an application communication mode the communication session is preferably routed through at least a communication router where at least a portion of an application is performed. When transitioning to the application communication mode the steps associated with initiating a communication session with the communication platform are preferably performed in a substantially consistent manner. In one variation if the communication is returning to the application communication mode for a second time the communication router may remember at least partial state within the processing of application instructions. For example if an application transfers the call to a basic mode and then the call is returned to the application the instructions after the initial transfer may be performed without having to retrieve new application instructions.

The method S is preferably used in combination with the methods S and S described above. Various signaling and media management approaches can be applied to achieve transitioning between operating modes. Altering the operational mode preferably includes onboarding new media and signaling resources into the session when upgrading an operational mode off boarding signaling and media resources of the session when downgrading and or otherwise modifying the set of signaling and media resources when transitioning.

As shown in a SIP re INVITE mechanism can be employed to upgrade or alternatively transfer a session. An existing signaling dialog can exist between a transferee the entity that experiences the transition the communication platform an IP PBX and a SIP user agent. As shown in the user agent can initiate the transfer. Alternatively the transfer may be initiated through an API triggering of a registered callback or initiated through any suitable mechanism. A REFER signaling message can be delivered which prompts the invite of the specified referrer the target. The target could be another carrier or could be a communication application service. By supporting a SIP REFER message the communication platform may support allowing any endpoint including carriers to do various transfer scenarios which can include upgrading to an application operating mode. As shown in an alternative signaling and media handling process accepts a REFER message to transition to an application mode. The referrer will preferably specify a referring endpoint. An INVITE to the endpoint is processed through the proxy core. As shown in the example of the endpoint can be an application identifier such that the media communication will flow from the carrier through the carrier media gateway and the communication application service. The signaling and media flow can similarly use REFER to transition to targeting an external domain as shown in . The trunking app can additionally monitor when the transition occurs and meter the associated account appropriately such that an account may be billed at one rate when in SIP trunking mode and a second rate when in application mode. In another variation the REFER may be handled through an edge service as shown in where the public media gateway PMG facilitates upgrading the operation mode. Similarly handing the REFER transparently at the edges could enable users to REFER to anything at any time such that if operating in an application mode the session could transition to a SIP trunking mode.

In one exemplary implementation a basic communication mode may be provided by the communication platform at one usage rate and an application communication mode provided at a second usage rate. SIP trunking can use basic communication where communication is preferably channeled between the communicating endpoints. Since facilitating the basic communication session requires fewer cheaper resources SIP trunking communication sessions may be offered to users for a lower price. An agent application or service can preferably submit a transition signal if an entity decides to dynamically change the basic communication to use features of an application or service of the communication platform. Upon transitioning to the elevated operational mode the communication session may be charged at a higher price rate for use of the application resources. The transition signal is preferably received through an API request but may alternatively be received through any suitable channel. The variation of transitioning the operational mode of a communication session may additionally or alternatively be used with the method of the second preferred embodiment or during any established communication session.

The altering of the SIP communication mode may have numerous applications. In one exemplary use case an agent may be connected to a customer representative through a SIP session. The account associated with the phone number of the customer representative is preferably charged the basic communication mode rate e.g. 0.001 min . When the customer representative has finished a transition signal is preferably received and the customer is seamlessly transitioned to a SIP communication session in an application communication mode. With the full capabilities of the application stack a customer survey application may collect feedback from the customer before ending the call. During this survey application portion the account may be charged an application customer mode rate e.g. 0.01 min . In this example the account was able to easily add a survey application without significantly increasing the cost of basic SIP communication. The communication mode changes are preferably transparent to the customer. In another exemplary use case a customer may call an endpoint for a calling card service. The call preferably starts the communication session in an application communication mode. The customer enters the code and specifies the destination they wish to call. The application then transfers them to the desired number. For the portion of the communication session with the desired endpoint the communication session is preferably demoted to a basic communication session to benefit from a lower rate. The caller may additionally be transferred to an application communication mode at the end of the call for other application related services such as reading the balance of the calling card and the option to call another number. The altering of the communication mode may be used in any suitable application.

The system and methods of the preferred embodiment and variations thereof can be embodied and or implemented at least in part as a machine configured to receive a computer readable medium storing computer readable instructions. The instructions are preferably executed by computer executable components preferably integrated with the communication platform. The computer readable medium can be stored on any suitable computer readable media such as RAMs ROMs flash memory EEPROMs optical devices CD or DVD hard drives floppy drives or any suitable device. The computer executable component is preferably a general or application specific processor but any suitable dedicated hardware or hardware firmware combination device can alternatively or additionally execute the instructions.

As a person skilled in the art will recognize from the previous detailed description and from the figures and claims modifications and changes can be made to the preferred embodiments of the invention without departing from the scope of this invention defined in the following claims.

