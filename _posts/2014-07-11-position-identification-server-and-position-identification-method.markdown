---

title: Position identification server and position identification method
abstract: A position identification server according to the present application includes a storage unit that stores coefficients of parameters of a discriminant function that indicates whether or not a terminal device is located on each floor and a maximum value of pre-measured radio wave strength of each base station on each floor, a communication unit that receives an actual measurement value of radio wave strength of radio waves received by the terminal device from the base station, and a discrimination unit that calculates the parameters of the discriminant function for each floor based on the actual measurement value of radio wave strength received by the communication unit and the maximum value of radio wave strength stored in the storage unit, calculates a solution of the discriminant function for each floor based on the calculated parameters and the coefficients of the parameters stored in the storage unit, and when there are floors where the solution of the discriminant function is greater than or equal to a predetermined value, discriminates that a floor where the solution of the discriminant function is the greatest is a floor where the terminal device is located.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09439165&OS=09439165&RS=09439165
owner: YAHOO JAPAN CORPORATION
number: 09439165
owner_city: Tokyo
owner_country: JP
publication_date: 20140711
---
The present application claims priority to and incorporates by reference the entire contents of Japanese Patent Application No. 2013 218742 filed in Japan on Oct. 21 2013.

The present invention relates to a position identification server and a position identification method.

Conventionally it is proposed that a person who has a terminal device uses radio waves of a base station of a wireless LAN Local Area Network to perform positioning in a building or the like which radio waves of GPS Global Positioning System do not reach. The positioning using a wireless LAN can be performed by for example comparing a radio wave strength from each base station with an actual measurement value of radio wave strength at the terminal device by using a database measured at each position in the building in advance. A device including the database stores radio wave strengths measured in advance for each floor for each base station and identification information of each base station in a storage unit and searches the storage unit for the radio wave strengths of each base station from which the terminal device that performs positioning receives radio waves and the identification information of each base station to identify a floor story in the building. The device including the database selects a floor where the number of associations with the identification information of the same base station is large on the basis of a search result for example Japanese Patent No. 4840395 .

However regarding actual measurement value data of radio wave strength measured at each position in the building to improve accuracy of the positioning mesh of measurement positions needs to be fine so that the database becomes large and load increases. Further to determine a floor in the building by the number of floors associated with the same base station data of all base stations in the building is required so that also the database becomes large.

It is an object of the present invention to at least partially solve the problems in the conventional technology.

According to one aspect of an embodiment a storage unit configured to store coefficients of parameters of a discriminant function that indicates whether or not a terminal device is located on each floor and a maximum value of pre measured radio wave strength of each base station on each floor a communication unit configured to receive an actual measurement value of radio wave strength of radio waves received by the terminal device from the base station and a discrimination unit configured to calculate the parameters of the discriminant function for each floor based on the actual measurement value of radio wave strength received by the communication unit and the maximum value of radio wave strength stored in the storage unit calculate a solution of the discriminant function for each floor based on the calculated parameters and the coefficients of the parameters stored in the storage unit and when there are floors where the solution of the discriminant function is greater than or equal to a predetermined value discriminate that a floor where the solution of the discriminant function is the greatest is a floor where the terminal device is located.

The above and other objects features advantages and technical and industrial significance of this invention will be better understood by reading the following detailed description of presently preferred embodiments of the invention when considered in connection with the accompanying drawings.

Hereinafter a form hereinafter referred to as an embodiment to implement the position identification server the position identification method the position identification program and the terminal device according to the present application will be described in detail with reference to the drawings. The position identification server the position identification method the position identification program and the terminal device according to the present application are not limited to the embodiment. In the embodiment described below the same reference numerals are given to the same components and redundant description is omitted.

First an example of a position identification process according to the embodiment will be described with reference to . is an illustration illustrating an example of the position identification process according to the embodiment. In the example of a terminal device receives radio waves of base stations A to C and transmits BSSID Basic Service Set Identifier which is a unique ID of each of the base stations A to and radio wave strengths also referred to as received signal strength indicators RSSIs to the position identification server . The position identification server performs the position identification process based on the received BSSIDs and the radio wave strengths. When the base stations A to C are not distinguished from each other the base stations A to C are represented as a base station .

First the terminal device receives the radio waves of the base stations A to in a building . The terminal device detects the BSSIDs of the base stations A to C from the received radio waves and acquires an actual measurement value of radio wave strength of the received radio waves for each BSSID. The terminal device associates the BSSID with the actual measurement value of radio wave strength and transmits the BSSID and the actual measurement value of radio wave strength to the position identification server through the network N step S indicated by an arrow in .

The position identification server estimates the position of the terminal device for each floor story of the building on the basis of the received BSSID and actual measurement value of radio wave strength and GMM Gaussian Mixture Model stored in a GMM storage unit step S . When the position identification server can identify the floor by using a discriminant function the position identification server estimates the position of the terminal device with respect to the floor identified by the discriminant function. Here the GMM is a radio wave strength of the base station in each floor which is represented by overlapping a plurality of Gaussian distribution functions. For example for the floor F GMM A of the base station A GMM B of the base station B GMM C of the base station C are stored in the GMM storage unit . Further for example for the floor F GMM A of the base station A GMM B of the base station B GMM of the base station C are stored in the GMM storage unit .

For example it is assumed that the position identification server estimates the position of the terminal device for the floor F and the floor F. The position identification server estimates the position of the terminal device on the floor F by performing a comprehensive evaluation using a particle filter on the basis of the actual measurement value of radio wave strength the GMM A the GMM B and the GMM C. The particle filter is one of time series filtering methods. In this method many next states are assumed to be particles and a weighted average is traced while the weighted average is being estimated as a next state on the basis of the likelihood of all the particles.

The position identification server estimates the position of the terminal device on the floor F by the particle filter. The position identification server calculates estimated values of radio wave strength from the base stations A to C at an estimated position of the terminal device . The estimated value of radio wave strength of the base station A can be calculated to be an estimated value A from the GMM A. In the same manner the estimated value of radio wave strength of the base station B can be calculated to be an estimated value B from the GMM and the estimated value of radio wave strength of the base station C can be calculated to be an estimated value C from the GMM C.

The position identification server calculates the probability that the terminal device is located on the floor F based on the calculated estimated values A to C of radio wave strength from the base stations A to C and the actual measurement values of radio wave strength from the base stations A to C. The probability that the terminal device is located on the floor F can be calculated according to for example a difference between the estimated value and the actual measurement value of radio wave strength. In the same manner for the other floors including the floor F the position identification server calculates the probability that the terminal device is located on each floor including the floor F. Here it is assumed that the probability that the terminal device is located on the floor F is 50 and the probability that the terminal device is located on the floor F is 10 .

The position identification server compares the probabilities that the terminal device is located on each floor and identifies that the terminal device is located on the floor of the highest probability that is the floor F. As a result the position identification server identifies the estimated position of the terminal device and the floor F.

The position identification server transmits the identified estimated position and floor of the terminal device to the terminal device as position information step S . When the terminal device receives the position information the terminal device notifies a user of the terminal device of the floor and the position where the terminal device is currently located by for example displaying the position information on a map of the building displayed on a screen.

In this way in the position identification process according to the embodiment the position identification server estimates the position of the terminal device for each floor of the building on the basis of the actual measurement value of radio wave strength and GMM of each of the base stations A to C. When the position identification server estimates the position of the terminal device for each floor the position identification server calculates the probability that the terminal device is located on each floor by comparing the actual measurement value of radio wave strength at a receiving position and the estimated value of radio wave strength calculated from the GMM and identifies the floor where the terminal device is located. The position identification server identifies the floor where the terminal device is located by using a discriminant function for each floor on the basis of the actual measurement value of radio wave strength of each of the base stations A to C and the maximum value of radio wave strength of each of the base stations A to C on each floor which is measured in advance. Therefore it is possible to notify the user of the terminal device of the floor and the position where the terminal device is currently located. Hereinafter the terminal device the base stations and the position identification server which perform the position identification process will be described in detail.

Next a position identification system according to the embodiment will be described with reference to . is a diagram illustrating a configuration example of the position identification system according to the embodiment. As illustrated in the position identification system includes the terminal device the base stations and the position identification server . The terminal device and the position identification server are communicably connected by wired or wireless communication through the base station and a network N. Although not illustrated in the terminal device and the position identification server may be connected through the network N via a base station independent from the base stations for example an antenna base station for mobile phones . Although illustrates an example in which the position identification system includes one terminal device and three base stations the position identification system may include more terminal devices and more base stations .

Next a configuration of the terminal device will be described. The terminal device is an information processing device used by a user and for example corresponds to a mobile phone for example smartphone a PDA Personal Digital Assistant and the like. As illustrated in the terminal device includes a communication unit a control unit and a display unit .

The communication unit is connected to the base stations and transmits and receives information to and from the position identification server through the network N. The communication unit connects to the base stations by wireless communication. The communication unit can use a wireless LAN or the like as the wireless communication. The communication unit detects BSSIDs for receivable radio waves of the base stations and acquires an actual measurement value of radio wave strength of the received radio waves for each BSSID.

The control unit is realized when for example a program stored in an internal storage device is executed by a CPU Central Processing Unit an MPU Micro Processing Unit or the like using a RAM as a work area. The control unit is realized by for example an integrated circuit such as an ASIC Application Specific Integrated Circuit and an FPGA Field Programmable Gate Array .

The control unit associates the BSSID of the base station acquired by the communication unit with the actual measurement value of radio wave strength acquired by the communication unit and transmits the BSSID and the actual measurement value of radio wave strength to the position identification server through the communication unit and the network N. The control unit maps the position information received from the position identification server onto for example a map to display the position information on the display unit . The control unit controls the entire terminal device and performs various information processing.

The display unit is a display device to display various information. For example the display unit is realized by a liquid crystal display or the like. When a touch panel is employed as an input unit not illustrated in the display unit and the input unit are integrated together.

Next a configuration of the base station will be described. The base station is for example a wireless base station of a wireless LAN. The base station connects to the terminal device by wireless communication and connects to the position identification server through the network N. The bass station is based on for example the standard of IEEE802.11a b g n or the like.

Next a configuration of the position identification server will be described. The position identification server is a server device that estimates the position of the terminal device for each floor on the basis of the BSSID and the radio wave strength received from the terminal device and the GMM stored in the GMM storage unit described later. As illustrated in the position identification server includes a communication unit a storage unit and a control unit . The position identification server may include an input unit for example keyboard mouse and the like that receives various operations from an administrator or the like of the position identification server and a display unit liquid crystal display or the like to display various information.

The communication unit is realized by for example a NIC Network Interface Card or the like. The communication unit transmits and receives information to and from the terminal device through the network N and the base station .

The storage unit is realized by for example a semiconductor memory element such as a RAM and a flash memory or a storage device such as a hard disk and an optical disk. The storage unit includes a base station storage unit a floor storage unit a GMM storage unit a pre measurement storage unit a verification data storage unit a candidate floor storage unit and a coefficient storage unit . The storage unit stores an OS Operating System executed in the control unit various programs and various data.

The base station storage unit stores the BSSID and the like of the base station received by the terminal device . is a diagram illustrating an example of the base station storage unit according to the embodiment. As illustrated in the base station storage unit includes items such as BSSID representative latitude representative longitude MaxRSSI GMMFlag and receivable floor ID .

The BSSID is a BSSID detected from the radio waves received from the base station and identifies the base station . The representative latitude and the representative longitude indicate the latitude and longitude of a position where the radio wave strength is the strongest when measuring the radio wave strength at a plurality of positions in advance to derive a GMM parameter the details will be described later . The MaxRSSI indicates the maximum value of the actual measurement values of radio wave strength corresponding to the BSSID at the representative latitude and the representative longitude. In an example of the first row in for example 75.0 dBm is measured as the radio wave strength. The GMMFlag indicates whether or not the GMM parameter used to estimate a position has already been derived. For example indicates that the GMM parameter has already been derived and indicates that the GMM parameter has not yet been derived. The receivable floor ID indicates a floor ID of a floor where the radio waves from the base station having the BSSID can be received.

The floor storage unit stores information of floors in a building in which positioning is performed. BIG. is a diagram illustrating an example of the floor storage unit according to the embodiment. As illustrated in the floor storage unit includes items such as floor ID file name of floor drawing width of floor drawing height of floor drawing latitude longitude of floor and floor number .

The floor ID identifies a floor. A unique ID may be assigned to the floor ID for example in order to be used for a plurality of buildings. The file name of floor drawing indicates a file of a floor drawing. The floor drawing is for example a drawing in which pillars walls and the like are drawn. The width of floor drawing and the height of floor drawing are for example the numbers of pixels of a drawing in the horizontal and the vertical directions. The latitude longitude of floor is to determine an area of the floor and for example indicates the latitude and longitude of the upper left lower left and upper right corners of the floor. The floor number indicates what floor the floor is in the building. By these pieces of information the pixel coordinates of the floor drawing and the latitude and longitude can be converted into each other.

The GMM storage unit stores the BSSIDs of each floor and the GMM corresponding to the BSSID. is a diagram illustrating an example of the GMM storage unit according to the embodiment. As illustrated in the GMM storage unit includes items such as floor ID the number of BSSIDs BSSID K and .

The floor ID identifies a floor. The the number of BSSIDs indicates the number of base stations from which radio waves can be received at the floor that is the number of the BSSIDs. The BSSID identifies a base station . The K is a GMM parameter and indicates a mixed number of normal distribution. The is a GMM parameter and indicates a mixing coefficient representing a weight of each normal distribution. The sum of all mixing coefficients is 1. The and the are GMM parameters and indicate averages of normal distribution in the x direction and the y direction. The the and the are GMM parameters and indicate a variance covariance matrix of normal distribution. Here a GMM for calculating a GMM parameter is illustrated in Formula 1 . Formula 1 is represented by a superposition of normal distributions considering normalization. The GMM parameter is derived based on this formula. Formula 2 illustrates a conversion formula between the radio wave strength RSSI and the GMM. The coefficients and can be calculated by the least square method not illustrated in the drawings . 1 RSSI 2 

The shape of a two dimensional GMM is determined by an average of individual normal distributions a variance covariance matrix and a mixing coefficient . The position identification server represents a distribution of the radio wave strength on a floor by using the GMM.

Here the calculation of the GMM will be described. The calculation of the GMM is based on a paper A Wireless LAN Location Estimation Method Based on Gaussian Mixture Model SUSUMU FUJITA KATSUHIKO KAJI and NOBUO KAWAGUCHI Journal of Information Processing Society of Japan Vol. 52 No. 3 1069 1081 March 2011 .

An administrator of the position identification server measures the radio wave strength of the base station on a certain floor by using the terminal device or another measurement device. For example measurement points of the radio wave strength are set at intervals of several meters. The administrator performs the measurement a plurality of times at each measurement point and determines an average of the measurements as the radio wave strength at the measurement point. The administrator converts data of the radio wave strength at a large number of measurement points into a two dimensional point distribution. In the conversion into the two dimensional point distribution an area is divided for each measurement point and points the number of which corresponds to the radio wave strength are scattered in each area so that the data is converted into a distribution of points. The area can be divided by using Voronoi tessellation.

Subsequently the distribution of points is converted into GMM by using EM algorithm. The EM algorithm has two update procedures including E step and M step. The E step and the M step are repeated until a convergence criterion is satisfied by calculating a logarithmic likelihood function. illustrates an example of the GMM calculated in this way. is an illustration illustrating an example of the GMM according to the embodiment. The GMM is a combination of Gauss functions bell shaped functions and can be represented by a so called heat map having a mountainous shape. In a portion where a contour line of the heat map that is the radio wave strength has the same value or a value within a predetermined range is represented as the same hatching.

The pre measurement storage unit stores premeasured radio wave strength of each base station at each floor and the maximum value of the premeasured radio wave strength. is a diagram illustrating an example of the pre measurement storage unit according to the embodiment. As illustrated in the pre measurement storage unit includes items such as floor ID BSSID RSSI max and RSSI .

The floor ID identifies a floor. The BSSID is a BSSID detected from the radio waves received from the base station on a corresponding floor and is identification information that identifies the base station . However any other identification information may be used according to a configuration and technical specifications if the identification information can identify the base station . The RSSI max indicates the maximum value of the radio wave strength for each BSSID on each floor among the radio waves received from the base station on the floor. The RSSI indicates the actual measurement values of radio wave strength received from the base station at a plurality of positions on the floor.

The verification data storage unit stores the actual measurement value of radio wave strength of each base station for which a floor and a position where the measurement is performed in advance are known. is a diagram illustrating an example of the verification data storage unit according to the embodiment. As illustrated in the verification data storage unit includes items such as verification data ID floor ID position BSSID and RSSI .

The verification data ID identifies verification data. The floor ID identifies a floor where the verification data is measured. The position indicates a position at which the verification data is measured on the floor. Although the position is represented as r for simplification in in practice the position is position information represented by the latitude and longitude or the like. The BSSID is a BSSID detected from the radio waves received from the base station at a position at which the verification data is measured. The BSSID identifies the base station . The RSSI indicates the value of radio wave strength received from the base station at the position at which the verification data is measured.

The candidate floor storage unit stores parameters of a discriminant function calculated for each verification data ID actual measurement floor ID and candidate floor ID and a solution of the discriminant function given by an administrator of the position identification server . The discriminant function will be described later. is a diagram illustrating an example of the candidate floor storage unit according to the embodiment. As illustrated in the candidate floor storage unit includes items such as verification data ID actual measurement floor ID candidate floor ID parameter x parameter x parameter x parameter x parameter x and solution f of discriminant function .

The verification data ID identifies verification data. The actual measurement floor ID indicates a floor where the verification data is actually measured. The candidate floor ID compares the BSSIDs which are received for each floor ID and which are stored in the pre measurement storage unit with the BSSIDs included in the verification data and indicates a floor ID which has a matched BSSID and which is stored in the pre measurement storage unit . In other words the candidate floor ID indicates a floor where one or more radio waves can be received from among radio waves from the base stations having a BSSID included in the verification data.

The parameter x indicates the maximum value of differences between the actual measurement values of radio wave strength RSSI of the verification data and the maximum value of radio wave strength RSSI max stored in the pre measurement storage unit . The parameter x indicates the number of positive differences between the RSSIs and the RSSI max. The parameter x indicates an average of the differences between the RSSIs and the RSSI max. The parameter x indicates an average of positive differences between the RSSIs and the RSSI max. The parameter x indicates the number of matched BSSIDs when comparing the BSSIDs which are received for each floor ID and which are stored in the pre measurement storage unit with the BSSIDs included in the verification data. In other words the parameter x indicates the number of matched base stations between the base stations from which the terminal device receives radio waves for each floor and the base stations on each floor stored in the pre measurement storage unit .

The solution f of discriminant function indicates a solution of the discriminant function given by the administrator of the position identification server . In the solution f of discriminant function is inputted when the actual measurement floor ID and the candidate floor ID of the verification data ID correspond with each other and is inputted when the actual measurement floor ID and the candidate floor ID of the verification data ID do not correspond with each other.

The coefficient storage unit stores coefficients of parameters of the discriminant function calculated for each floor ID. is a diagram illustrating an example of the coefficient storage unit according to the embodiment. As illustrated in the coefficient storage unit includes items such as floor ID coefficient k of parameter of discriminant function coefficient k of parameter of discriminant function coefficient k of parameter of discriminant function coefficient k of parameter of discriminant function coefficient k of parameter of discriminant function and coefficient k of parameter of discriminant function .

The floor ID identifies a floor. Although the coefficient k of parameter of discriminant function indicates a constant term of the discriminant function that is a constant the coefficient k of parameter of discriminant function is referred to as coefficient for consistency of expression. The coefficient k of parameter of discriminant function indicates a coefficient corresponding to the parameter x. The coefficient k of parameter of discriminant function indicates a coefficient corresponding to the parameter x. The coefficient k of parameter of discriminant function indicates a coefficient corresponding to the parameter x. The coefficient k of parameter of discriminant function indicates a coefficient corresponding to the parameter x. The coefficient k of parameter of discriminant function indicates a coefficient corresponding to the parameter x. The coefficients of parameters of discriminant function are calculated for each floor by a known regression analysis in particular discriminant analysis of multivariate analysis on the basis of the data stored in the candidate floor storage unit . The numerical values illustrated in are a conceptual example and actual numerical values based on the actual measurement values are various ranges of numerical values such as for example k 43.7 k 30.9 k 34.8 k 8.0 k 10.3 and k 52.7. As a new parameter the minimum value of differences between the actual measurement values of radio wave strength RSSI and the maximum value of radio wave strength RSSI max on the floor can be provided as a parameter x. In this case when a corresponding coefficient is k for example k may have a numerical value of 12.1.

Let us return to the description of . The control unit is realized when for example a program stored in an internal storage device is executed by a CPU an MPU or the like using a RAM as a work area. The control unit is realized by for example an integrated circuit such as an ASIC and an FPGA.

As illustrated in the control unit includes a determination unit an estimation unit a calculation unit an identification unit a preparation unit and a discrimination unit and realizes or implements a function and an action of information processing described below. An internal configuration of the control unit is not limited to the configuration illustrated in but may be other configuration as long as the configuration performs the information processing described below.

When the determination unit receives the BSSIDs and the actual measurement values of radio wave strength from the terminal device the determination unit counts the number of unique BSSIDs for each floor ID that is for each floor in the building. Specifically the determination unit refers to the base station storage unit and extracts the number of BSSIDs of the base stations that can be received on only a certain floor from among the received BSSIDs. When there is no unique BSSID the determination unit refers to the base station storage unit extracts a floor where radio waves can be received as a possible floor and outputs the floor ID of the extracted floor and the actual measurement value of radio wave strength to the discrimination unit .

When there are one or more unique BSSIDs the determination unit determines one or more floors where the number of unique BSSIDs is the greatest. When the number of the floors where the number of unique BSSIDs is the greatest is one the determination unit identifies that the determined floor is the floor where the terminal device is located. When the number of the floors where the number of unique BSSIDs is the greatest is two or more the determination unit identifies that a floor to which a BSSID with the maximum actual measurement value of radio wave strength among the unique BSSIDs belongs is the floor where the terminal device is located.

The determination unit extracts a BSSID with the actual measurement value of radio wave strength which is greater than a predetermined threshold value. When the determination unit can extract a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value the determination unit outputs the extracted BSSID to the estimation unit . When the determination unit cannot extract a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value for example the determination unit lowers the predetermined threshold value by 10 dBm and extracts a BSSID again. When the determination unit can extract a BSSID with the actual measurement value of radio wave strength which is greater than the lowered threshold value the determination unit outputs the extracted BSSID to the estimation unit . When the determination unit cannot extract a BSSID with the actual measurement value of radio wave strength which is greater than the lowered threshold value for example the determination unit lowers again the predetermined threshold value by 10 dBm and extracts a BSSID again. When the determination unit can extract a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value that is lowered twice the determination unit outputs the extracted BSSID the floor ID of the identified floor and the actual measurement value of radio wave strength to the estimation unit . When the determination unit cannot extract a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value that is lowered twice the determination unit performs error processing. The determination unit outputs the actual measurement value of radio wave strength to the calculation unit .

The estimation unit is inputted with the floor ID of the identified floor the BSSID and the actual measurement value of radio wave strength from the determination unit or the discrimination unit or inputted with the floor ID of the possible floor the BSSID and the actual measurement value of radio wave strength from the discrimination unit . When the estimation unit is inputted with the floor ID of the possible floor for example the estimation unit selects one floor ID in ascending order of floor ID. The estimation unit determines whether or not a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value has already been extracted on the floor of the inputted floor ID. When a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value has not been extracted that is when the floor ID of the possible floor is inputted to the estimation unit the estimation unit extracts a BSSID with the actual measurement value of radio wave strength which is greater than a predetermined threshold value. When a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value has already been extracted and when the estimation unit can extract a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value the estimation unit reads GMM parameters of the extracted BSSID on the floor from the GMM storage unit and sets the GMM parameters in the particle filter.

When the estimation unit cannot extract a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value or when the estimation unit cannot set the GMM parameters in the particle filter for example the estimation unit lowers the predetermined threshold value by 10 dBm and extracts a BSSID again. In the same manner as the determination unit the estimation unit tries to extract a BSSID by lowering the threshold value twice. When the estimation unit cannot extract a BSSID by lowering the threshold value twice the estimation unit performs error processing. When the estimation unit can set the GMM parameters in the particle filter the estimation unit estimates the position of the terminal device by using the particle filter. When the estimation unit is inputted with the floor ID of the possible floor from the discrimination unit the estimation unit outputs the estimated position of the terminal device and the floor ID used for the estimation to the calculation unit . When the estimation unit is inputted with the floor ID of the identified floor from the determination unit or the discrimination unit the estimation unit transmits the estimated position of the terminal device the floor ID of the identified floor and information such as a drawing of the identified floor which is read from the floor storage unit to the terminal device through the communication unit as position information.

Here the estimation of the position by the particle filter will be described. is an illustration illustrating an example of an initial arrangement of particles of a position estimation process according to the embodiment. In the example of particles are evenly arranged on the floor F. Each particle moves according to the existence probability in the GMM of the base station . Specifically each particle is weighted according to the existence probability added with random walk and sampled. When the weight of each particle is used as a probability that other particles next move to the position of the particle many of other particles are rearranged around a particle with a large weight. is an illustration illustrating an example after rearrangement of the particles of the position estimation process according to the embodiment. The example of illustrates a state in which for example other particles gather around a particle with a large weight. In other words it can be estimated that an estimated position of the terminal device is close to the particle with a large weight.

The calculation unit is inputted with the estimated position of the terminal device and the floor ID from the estimation unit . Further the calculation unit is inputted with the actual measurement value of radio wave strength from the determination unit . The calculation unit refers to the base station storage unit based on the floor ID and extracts a BSSID base station that can be received on the floor indicated by the floor ID. The calculation unit reads the GMM of the extracted BSSID from the GMM storage unit calculates the radio wave strength of the BSSID at the estimated position of the terminal device and determines the calculated radio wave strength as the estimated value of the radio wave strength.

Here the calculation of the estimated value of the radio wave strength of the BSSID at the estimated position of the terminal device will be described. is an illustration illustrating an example of an estimated value calculation process according to the embodiment. For example it is assumed that the estimated position of the terminal device is the estimated position the floor ID is F the base stations that can be received on the floor F are the base stations A to C and the GMMs corresponding to the base stations A to C are GMMs A to . At this time the calculation unit calculates an estimated value A of radio wave strength from the GMM A at the estimated position . In the same manner the calculation unit calculates an estimated value B of radio wave strength from the GMM B at the estimated position and calculates an estimated value C of radio wave strength from the GMM C at the estimated position .

The calculation unit calculates a probability that the terminal device is located on the floor on the basis of a normal distribution from the received actual measurement values of radio wave strength and the estimated values of radio wave strength for each BSSID at the estimated position . The probability that the terminal device is located on the floor can be calculated according to for example a difference between the estimated value and the actual measurement value of radio wave strength. Here in the example of the actual measurement values of radio wave strength are actual measurement values A to C. At this time it is assumed that on the GMM the actual measurement values A to C correspond to circular ring portions as illustrated on the horizontal surface in . Here there are overlapping portions between the estimated values A to of radio wave strength and the actual measurement values A to C of radio wave strength. In other words it can be said that there is hardly any difference between the estimated values A to C of radio wave strength and the actual measurement values A to C of radio wave strength. Here the probability can be represented by a one dimensional normal distribution indicated by Formula 3 for each BSSID and for example in the case of a floor A where three BSSIDs can be extracted the probability that the terminal device is located on the floor can be an average value of the probabilities of the BSSIDs as indicated by Formula 4 . Further for example in the case of a floor B where two BSSIDs can be extracted in the same manner the probability can be an average value of the probabilities of the BSSIDs as indicated by Formula 5 .

Here illustrates the floor F as another example. is an illustration illustrating an example of the estimated value calculation process according to the embodiment. In the example of the estimated position of the terminal device is the estimated position and the actual measurement values of radio wave strength are the actual measurement values A to C which are indicated by triangle marks. Further the GMMs corresponding to the base stations A to C are the GMMs A to . At this time there is no value corresponding to the actual measurement value A on the GMM A so that the value corresponding to the actual measurement value A is the value of the top of the mountain of the GMM A which is closest to the actual measurement value A as illustrated on the horizontal surface in . The position corresponding to the actual measurement value B has a circular ring shape on the GMM as illustrated on the horizontal surface in . Further the value corresponding to the actual measurement value C on the GMM C is just the top of the mountain of the GMM C.

The calculation unit calculates an estimated value A of radio wave strength from the GMM A at the estimated position . In the same manner the calculation unit calculates an estimated value B of radio wave strength from the GMM B at the estimated position and calculates an estimated value C of radio wave strength from the GMM at the estimated position . However at the estimated position the radio wave strength of the GMM C is smaller than or equal to a measuring limit so that the calculation unit determines for example 120 dBm as the estimated value C.

Here in the example of regarding the differences between the estimated values A to C of radio wave strength and the actual measurement values A to C of radio wave strength when comparing the estimated value A and the actual measurement value A the actual measurement value A is greater than the estimated value A. Although the estimated value B and the actual measurement value B are close to each other the actual measurement value B is greater than the estimated value B. When comparing the estimated value C and the actual measurement value C the actual measurement value C is greater than the estimated value C. As a result when calculating the probability that the terminal device is located on the floor from the estimated values A to C of radio wave strength and the actual measurement values A to C of radio wave strength by using Formulas 3 to 5 the probability is lower than that of the example in .

The calculation unit determines whether or not the position of the terminal device has been estimated for all the floor IDs of the possible floors. If there are one or more possible floors remaining the calculation unit instructs the estimation unit to perform the position estimation process and the calculation process for the next floor ID. When the calculation unit has estimated the position of the terminal device for all the possible floors the calculation unit associates the floor ID of each floor with the calculated estimated position and existence probability of the terminal device on each floor and outputs the floor IDs the estimated positions and the existence probabilities to the identification unit .

When the estimated position and the existence probability of the terminal device on each floor are inputted to the identification unit from the calculation unit the identification unit compares the existence probabilities of the terminal device on the floors. The identification unit identifies that a floor where the existence probability of the terminal device is the highest among the compared floors is the floor where the terminal device is located. The identification unit transmits the estimated position of the terminal device the floor ID of the identified floor and information such as a drawing of the identified floor which is read from the floor storage unit to the terminal device through the communication unit as position information.

The preparation unit calculates coefficients of parameters of the discriminant function used in the discrimination unit on the basis of the radio wave strength measured in advance. The preparation unit acquires the radio wave strength measured in advance at a plurality of points on the entire floor for each floor by using for example the terminal device . As a pre measurement the preparation unit receives the radio wave strength measured at each point on each floor by using for example the terminal device through the base station the network N and the communication unit and stores the radio wave strength in the pre measurement storage unit as pre measurement data.

The preparation unit determines the maximum value of radio wave strength RSSI max for each BSSID for each floor that is for each floor ID of the pre measurement data stored in the pre measurement storage unit . Specifically in the example of for example for the BSSID BSSID of the floor ID F the preparation unit determines the maximum value 50 dBm of a plurality of radio wave strengths RSSI 1 75 dBm 2 50 dBm and 3 60 dBm as the RSSI max of BSSID and stores the maximum value 50 dBm in the item RSSI max in the pre measurement storage unit . The preparation unit performs the same operation for the other floor IDs and BSSIDs to determine the RSSI max and store the RSSI max in the item RSSI max in the pre measurement storage unit . When generalizing these maximum values the maximum radio wave strength of BSSIDj on a floor i can be represented as Rmax i j . Here i is an index identifying the floor and j is an index identifying the BSSID.

The preparation unit acquires radio wave strength measured for verification at a plurality of points on a floor by using for example the terminal device in a state in which the floor is known. As a measurement for verification the preparation unit receives the radio wave strength measured at each position on each floor by using for example the terminal device through the base station the network N and the communication unit and stores the radio wave strength in the verification data storage unit as verification data.

The preparation unit refers to the pre measurement storage unit and the verification data storage unit and determines a floor where the at least a part of BSSIDs measured for verification corresponds with the BSSIDs of the pre measurement as a candidate floor. In the examples of the verification data illustrated in includes BSSID to BSSID . When searching the pre measurement storage unit illustrated in for the BSSIDs illustrated in the floor ID F includes BSSID to BSSID the floor ID F includes BSSID BSSID and BSSID and the floor ID F includes BSSID BSSID and BSSID . The preparation unit determines these search results as the candidate floors. In other words the preparation unit excludes floors of floor IDs that include no BSSID included in the verification data from the candidate floors.

When the preparation unit determines the candidate floors the preparation unit calculates the parameters x to x of the discriminant function indicated by Formula 6 for each candidate floor. The solution f of the discriminant function indicated by Formula 6 is when the discriminant function is true and the solution f is when the discriminant function is false. 0 1 1 2 2 3 3 4 4 5 5 6 

Here the calculation of the parameters x to x of the discriminant function will be described with reference to . is an illustration illustrating an example of the parameter calculation of the discriminant function. First the preparation unit acquires the maximum value of radio wave strength RSSI max from the pre measurement storage unit for each BSSID of each candidate floor. Further the preparation unit acquires the radio wave strength RSSI of each BSSID for each verification data ID from the verification data storage unit . The preparation unit calculates a difference diff between the RSSI of each BSSID of the verification data ID and the RSSI max of each BSSID of each candidate floor.

In the examples of regarding the floor ID F the RSSI of BSSID of the verification data ID is 60 dBm and the RSSI max of the floor ID F and BSSID of the pre measurement data is 50 dBm. The difference diff is 60 50 10 dBm. The preparation unit also calculates the difference diff for each BSSID of each candidate floor. The reason why the preparation unit calculates the parameters even for a false floor as a candidate floor is to obtain a pattern of a false floor and use the pattern in a regression analysis for calculating coefficients of the parameters.

When the difference diff is calculated for each BSSID of each candidate floor the preparation unit calculates the parameters x to x. The preparation unit calculates the maximum value of differences between the RSSIs and the RSSI maxes as the parameter x. The maximum value of differences is a parameter that means the greater the exceedance the higher the probability of another floor. The preparation unit calculates the number of positive differences between the RSSIs and the RSSI maxes as the parameter x. The positive difference indicates another floor so that the number of positive differences is a parameter that means the greater the number of positive differences the higher the probability of another floor.

The preparation unit calculates an average value of the differences between the RSSIs and the RSSI maxes as the parameter x. The average value of the differences is a parameter that means when a value exceeding the RSSI max is high as a whole the probability of another floor is high even when considering denial by non exceedance minus of the difference that is denial by a value indicating a high probability that the current floor is the floor where the terminal device is located. The preparation unit calculates an average value of positive differences between the RSSIs and the RSSI maxes as the parameter x. The average value of positive differences excludes differences of non exceedance and is a parameter that means the greater the average of exceedance widths the higher the probability of another floor. The preparation unit calculates the number of BSSIDs of each candidate floor which correspond with BSSIDs included in the verification data as the parameter x. The number of BSSIDs that correspond with each other is a parameter that means the greater the number of BSSIDs that are the base of the determination that is the greater the number of base stations the higher the reliability.

In the example of the parameters x to x are calculated as . and respectively. The preparation unit also calculates the parameters x to x for other candidate floors. In the example of on the candidate floors F and F the number of BSSIDs on each candidate floor that correspond with BSSIDs included in the verification data is three for each floor so that the parameters x to x of the candidate floors F and F are calculated based on the three BSSIDs. The preparation unit associates the calculated parameters with the verification data ID the actual measurement floor ID that is the floor ID where the verification data is measured and the candidate floor ID and stores the parameters and the IDs in the candidate floor storage unit .

In the preparation unit the solution f of the discriminant function is set for each candidate floor of each verification data ID. The floor of the verification data is known so that for each candidate floor of each verification data ID if the candidate floor is correct is set to the solution f of the discriminant function by an administrator of the position identification server and if the candidate floor is not correct is set to the solution f by the administrator. In the example of there are three candidate floor IDs F F and F for the verification data ID . At this time the floor ID of the floor where the verification data is measured and which is indicated by the actual measurement floor ID is F so that is set to the solution f of the discriminant function of the candidate floor ID F and is set to the solution f of the discriminant function of the candidate floor IDs F and F . The solution f of the discriminant function is set for many other verification IDs in the same manner. The preparation unit stores the set solutions f of the discriminant function in the candidate floor storage unit .

The preparation unit calculates the coefficients k to k corresponding to the parameters x to x of the discriminant function and the coefficient k that is a constant term by a regression analysis on the basis of the parameters x to x of the candidate floor and the solution f of the discriminant function which are stored in the candidate floor storage unit . Here the coefficient k is a constant determined as a result of the regression analysis when all the parameters x to x are 0. However another predetermined constant may be used as the coefficient k. The preparation unit performs the regression analysis for all the verification data IDs and calculates the coefficients k to k for all the actual measurement floor IDs. In other words the preparation unit calculates the coefficients k to k of the parameters x to x of the discriminant function for each floor ID. The preparation unit associates the calculated coefficients k to k with the floor ID and stores the coefficients k to k and the floor ID in the coefficient storage unit .

The preparation unit can determine the coefficients k to k globally not for each floor that is commonly for all the floors or can determine the coefficients k to k for each area including a plurality of floors. The preparation unit calculates the coefficients k to k by for example performing regression analysis for all the floors or for each area. The preparation unit may calculate one set of coefficients k to k by calculating the coefficients k to k for each floor and for example averaging the calculated coefficients k to k of the floors. In this way it is possible to omit change of coefficients and obtain discriminant coefficients that can be used more universally by calculating one set of coefficients k to k for a global area for all the floors or for any area.

When the floor ID of the extracted floor and the actual measurement value of radio wave strength are inputted to the discrimination unit from the determination unit the discrimination unit determines whether or not the number of the extracted floors is one. When the number of the extracted floors is not one the discrimination unit calculates the parameters x to x of the discriminant function for each floor ID of the extracted floors. Here the calculation of the parameters x to x is the same process as the calculation of the parameters x to x in the preparation unit and the calculation is performed by using the actual measurement value of radio wave strength received from the terminal device instead of the verification data so that the detailed description thereof will be omitted. When generalizing the calculation of each parameter using the actual measurement value of radio wave strength the actual measurement value of radio wave strength for each BSSIDj can be represented as Rj. Further a difference dji between the actual measurement value of radio wave strength and the maximum radio wave strength Rmax i j of the BSSIDj on the floor i can be represented as dji Rj Rmax i j . In summary the discrimination unit calculates the parameters x to x for the BSSIDj.

The discrimination unit refers to the coefficient storage unit and sets the coefficients k to k corresponding to the floor ID of each extracted floor to the discriminant function indicated by Formula 6 . The discrimination unit calculates the solution f of the discriminant function by applying the calculated parameters x to x to the discriminant function to which the coefficients k to k are set. The discrimination unit calculates the solution f of the discriminant function for all the floor IDs of the extracted floors.

The discrimination unit determines whether or not there are one or more floor IDs for which the solution f of the discriminant function is greater than or equal to a predetermined value. When there are one or more floor IDs for which the solution f of the discriminant function is greater than or equal to the predetermined value the discrimination unit identifies that the floor of the floor ID for which the solution f of the discriminant function is the greatest is the floor where the terminal device is located. When there is no floor ID for which the solution f of the discriminant function is greater than or equal to the predetermined value the discrimination unit determines that the floor cannot be identified by the discriminant function. Here for example the predetermined value can be 0.5. The solution f of the discriminant function has a value between 1 and 0 and the value may be for example 0.8 or 0.6 even for the correct floor because the parameters vary due to the radio wave environment. When the number of the extracted floors is one and when the floor is identified by the discriminant function the discrimination unit outputs the floor ID of the identified floor the BSSID and the actual measurement value of radio wave strength to the estimation unit . When the floor cannot be identified by the discriminant function the discrimination unit outputs the floor ID of a possible floor the BSSID and the actual measurement value of radio wave strength to the estimation unit .

Next a preparation process of the position identification system according to the embodiment will be described. is a flowchart illustrating an example of the preparation process of the position identification server according to the embodiment.

The preparation unit of the position identification server acquires the radio wave strength measured in advance at a plurality of points on the entire floor for each floor by using for example the terminal device step S . The preparation unit stores the acquired radio wave strength in the pre measurement storage unit as the pre measurement data.

The preparation unit determines the maximum value of radio wave strength RSSI max for each BSSID for each floor of the pre measurement data stored in the pre measurement storage unit step S .

The preparation unit acquires the radio wave strength RSSI measured for verification at a plurality of points on a floor by using for example the terminal device in a state in which the floor is known step S .

The preparation unit refers to the pre measurement storage unit and the verification data storage unit and determines a floor where at least a part of BSSIDs measured for verification corresponds with the BSSIDs of the pre measurement as a candidate floor step S . In other words the preparation unit determines floors of the pre measurement data including the BSSID of the base station measured for verification to be candidate floors.

When the preparation unit determines the candidate floors the preparation unit calculates the parameters x to x of the discriminant function indicated by Formula 6 for each candidate floor step S . When the preparation unit has calculated parameters x to x the preparation unit associates the calculated parameters with the verification data ID the actual measurement floor ID and the candidate floor ID and stores the parameters and the IDs in the candidate floor storage unit .

In the preparation unit the solution f of the discriminant function is set for each candidate floor of each verification data ID by an administrator of the position identification server step S . The preparation unit stores the set solutions f of the discriminant function in the candidate floor storage unit .

The preparation unit calculates the coefficients k to k corresponding to the parameters x to x of the discriminant function and the coefficient k by a regression analysis on the basis of the parameters x to x of the candidate floor and the solution f of the discriminant function which are stored in the candidate floor storage unit step S . The preparation unit associates the calculated coefficients k to k with the floor ID and stores the coefficients k to k and the floor ID in the coefficient storage unit .

The preparation unit determines whether or not the coefficients k to k have been calculated for all the floors step S . When the coefficients k to k have not been calculated for all the floors step S No the preparation unit returns to step S and calculates the coefficients k to k for the remaining floors. When the coefficients k to k have been calculated for all the floors step S Yes the preparation unit ends the preparation process. When the preparation unit has calculated one set of coefficients k to k for a global area for all the floors or for any area the preparation unit ends the preparation process without performing the process of step S. Thereby it is possible to calculate the coefficients of the discriminant function for each floor for a global area for all the floors or for any area.

Next a position identification process of the position identification system according to the embodiment will be described. is a flowchart illustrating the position identification process of the position identification server according to the embodiment.

First the terminal device receives the radio waves of the base stations A to C in a building . The terminal device detects the BSSIDs of the base stations A to C from the received radio waves and acquires the actual measurement value of radio wave strength of the received radio waves for each BSSID. The terminal device associates the BSSID with the actual measurement value of radio wave strength and transmits the BSSID and the actual measurement value of radio wave strength to the position identification server through the network N.

The determination unit of the position identification server receives the BSSIDs and the actual measurement values of radio wave strength from the terminal device step S . The determination unit refers to the base station storage unit and extracts and counts the number of BSSIDs of the base stations that can be received on only a certain floor from among the received BSSIDs step S . The determination unit determines whether or not there is a unique BSSID step S . When there is no unique BSSID step S no the determination unit refers to the base station storage unit for the received BSSIDs extracts a floor where radio waves can be received as a possible floor and outputs the floor ID of the extracted floor and the actual measurement value of radio wave strength to the discrimination unit step S . When there are one or more unique BSSIDs step S Yes the determination unit performs a determination process step S .

Here the determination process will be described with reference to . is a flowchart illustrating the determination process of the position identification server according to the embodiment. The determination unit determines a floor where the number of unique BSSIDs is the greatest step S . The determination unit determines whether or not the number of floors where the number of unique BSSIDs is the greatest is one step S . When the number of the floors where the number of unique BSSIDs is the greatest is one step S Yes the determination unit identifies that the determined floor is the floor where the terminal device is located step S . When the number of the floors where the number of unique BSSIDs is the greatest is two or more step S No the determination unit identifies that a floor to which a BSSID with the maximum actual measurement value of radio wave strength among the unique BSSIDs belongs is the floor where the terminal device is located step S .

The determination unit sets an initial value of the number of times n to try to extract a BSSID with the radio wave strength greater than a threshold value to step S . The determination unit extracts a BSSID with the actual measurement value of radio wave strength which is greater than a predetermined threshold value. The determination unit determines whether or not a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value can be extracted step S . When the determination unit can extract a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value step S Yes the determination unit outputs the extracted BSSID to the estimation unit and performs the position estimation process step S .

When the determination unit cannot extract a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value step S No the determination unit determines whether or not the number of times n is greater than 2 step S . When the number of times n is smaller than or equal to 2 step S No the determination unit lowers the predetermined threshold value by 10 dBm step S adds 1 to the number of times n step S returns to step S and extracts a BSSID again. When the number of times n is greater than 2 step S Yes the determination unit performs an error process and ends the process step S .

The determination unit repeats the process of steps S to S and tries to extract a BSSID by lowering the predetermined threshold value twice. At this time if the determination unit can extract a BSSID with the actual measurement value of radio wave strength which is greater than the lowered threshold value step S Yes the determination unit outputs the extracted BSSID to the estimation unit and performs the position estimation process step S .

Here the position estimation process will be described with reference to . is a flowchart illustrating the position estimation process of the position identification server according to the embodiment. When the floor ID of the possible floor is inputted to the estimation unit from the discrimination unit that is when a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value has not been extracted the estimation unit performs the same process as the determination process. Therefore the estimation unit sets the initial value of the number of times n to try to extract a BSSID with the radio wave strength greater than a threshold value to step S . When the estimation unit is inputted with the floor ID of the possible floor for example the estimation unit selects one floor ID in ascending order of floor ID. When the estimation unit is inputted with the floor ID of the identified floor the estimation unit selects the floor ID. The estimation unit determines whether or not a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value has already been extracted on the floor of the selected floor ID.

When a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value has not been extracted step S No the estimation unit extracts a BSSID with the actual measurement value of radio wave strength which is greater than a predetermined threshold value. The estimation unit determines whether or not a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value can be extracted step S . When the estimation unit can extract a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value step S Yes the estimation unit reads GMM parameters of the extracted BSSID on the floor from the GMM storage unit and sets the GMM parameters in the particle filter step S .

When the estimation unit cannot extract a BSSID with the actual measurement value of radio wave strength which is greater than the predetermined threshold value step S No the estimation unit determines whether or not the number of times n is greater than 2 step S . When the number of times n is smaller than or equal to 2 step S No the estimation unit lowers the predetermined threshold value by 10 dBm step S adds 1 to the number of times n step S returns to step S and step S and extracts a BSSID again. When the number of times n is greater than 2 step S Yes the estimation unit performs an error process and ends the process step S .

When a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value has not been extracted the estimation unit repeats the process of steps S to S and tries to extract a BSSID by lowering the predetermined threshold value twice. When the estimation unit can extract a BSSID with the actual measurement value of radio wave strength which is greater than the lowered threshold value step S Yes the estimation unit reads the GMM parameters of the extracted BSSID on the floor from the GMM storage unit and sets the GMM parameters in the particle filter step S .

The estimation unit determines whether or not the GMM parameters can be set in the particle filter step S . When the GMM parameters can be set in the particle filter step S Yes the estimation unit estimates the position of the terminal device by using the particle filter step S . When the GMM parameters cannot be set in the particle filter step S No the estimation unit proceeds to step S lowers again the threshold value to extract a BSSID and tries to extract a BSSID with the actual measurement value of radio wave strength which is greater than the threshold value.

The estimation unit determines whether or not the position of the terminal device can be estimated by the particle filter step S . When the position of the terminal device can be estimated by the particle filter step S Yes the estimation unit ends the position estimation process and returns to the original process. When the position of the terminal device cannot be estimated by the particle filter step S No the estimation unit performs the error process and ends the process step S .

After the process of step S in is completed let us return to the description of . The estimation unit transmits the estimated position of the terminal device the floor ID of the identified floor and information such as a drawing of the identified floor which is read from the floor storage unit to the terminal device through the communication unit as position information step S . The control unit of the terminal device maps the position information received from the position identification server onto for example a map to display the position information on the display unit .

Next processes after the floor ID of the floor where radio waves can be received and the actual measurement value of radio wave strength are outputted to the discrimination unit in step S when there is no unique BSSID in step S will be described.

When the floor ID of the extracted floor and the actual measurement value of radio wave strength are inputted to the discrimination unit from the determination unit the discrimination unit determines whether or not the number of the extracted floors is one step S . When the number of the extracted floors is one step S Yes the discrimination unit outputs the floor ID of the extracted floor the BSSID and the actual measurement value of radio wave strength to the estimation unit . The estimation unit performs the position estimation process for the extracted floor step S and proceeds to step S. The position estimation process in step S is the same as the position estimation process in step S so that the description thereof will be omitted.

When the number of the extracted floors is not one step S No the discrimination unit performs a discrimination process step S . Here the discrimination process will be described with reference to . is a flowchart illustrating an example of the discrimination process of the position identification server according to the embodiment. The discrimination unit calculates the parameters x to x of the discriminant function for each floor ID of the extracted floors step S . The discrimination unit refers to the coefficient storage unit and sets the coefficients k to k corresponding to the floor ID of each extracted floor to the discriminant function indicated by Formula 6 . The discrimination unit calculates the solution f of the discriminant function by applying the calculated parameters x to x to the discriminant function to which the coefficients k to k are set step S . Here the discrimination unit calculates the solution f of the discriminant function for all the floor IDs of the extracted floors.

When the discrimination unit calculates the solution f of the discriminant function for all the floor IDs of the extracted floors the discrimination unit determines whether or not there are one or more floor IDs for which the solution f of the discriminant function is greater than or equal to a predetermined value step S . When there are one or more floor IDs for which the solution f of the discriminant function is greater than or equal to the predetermined value step S Yes the discrimination unit identifies that the floor of the floor ID for which the solution f of the discriminant function is the greatest is the floor where the terminal device is located step S and returns to the original process. When there is no floor ID for which the solution f of the discriminant function is greater than or equal to the predetermined value step S No the discrimination unit determines that the floor cannot be identified by the discriminant function step S and returns to the original process.

Let us return to the description of . The discrimination unit determines whether or not the floor can be identified by the discrimination process step S . When the floor can be identified by the discrimination process step S Yes the discrimination unit outputs the floor ID of the identified floor the BSSID and the actual measurement value of radio wave strength to the estimation unit . The estimation unit performs the position estimation process for the extracted floor step S and proceeds to step S.

When the floor cannot be identified by the discrimination process step S No the discrimination unit outputs the floor ID of the possible floor the BSSID and the actual measurement value of radio wave strength to the estimation unit .

When the estimation unit is inputted with the floor ID of the possible floor for example the estimation unit selects one floor ID in ascending order of floor ID. The estimation unit performs the position estimation process for the floor of the selected floor ID step S . The position estimation process in step S is the same as the position estimation process in step S so that the description thereof will be omitted.

When the position estimation process is completed for one of the floor IDs of the possible floors the estimation unit outputs the estimated position of the terminal device and the floor ID used for the estimation to the calculation unit .

When the estimated position of the terminal device and the floor ID are inputted to the calculation unit from the estimation unit the calculation unit performs a calculation process step S . Here the calculation process will be described with reference to . is a flowchart illustrating the calculation process of the position identification server according to the embodiment.

The calculation unit refers to the base station storage unit based on the floor ID and extracts a BSSID base station that can be received on the floor indicated by the floor ID step S . The calculation unit reads the GMM of the extracted BSSID from the GMM storage unit step S calculates the radio wave strength of the BSSID at the estimated position of the terminal device and determines the calculated radio wave strength as the estimated value of the radio wave strength step S .

The calculation unit calculates a probability that the terminal device is located on the floor on the basis of a normal distribution from the actual measurement values of radio wave strength inputted from the determination unit and the estimated values of radio wave strength for each BSSID at the estimated position of the terminal device step S .

Let us return to the description of . The calculation unit determines whether or not the position of the terminal device has been estimated for all the floor IDs of the possible floors step S . When the position of the terminal device has not been estimated for all the floor IDs of the possible floors step S No the calculation unit returns to step S and performs the process of step S and step S for the next floor ID. When the position of the terminal device has been estimated for all the floor IDs of the possible floors step S Yes the calculation unit associates the floor ID of each floor with the calculated estimated position and existence probability of the terminal device on each floor and outputs the floor IDs the estimated positions and the existence probabilities to the identification unit .

When the estimated position and the existence probability of the terminal device on each floor are inputted to the identification unit from the calculation unit the identification unit compares the existence probabilities of the terminal device on the floors. The identification unit identifies that a floor where the existence probability of the terminal device is the highest among the compared floors is the floor where the terminal device is located step S . The identification unit transmits the estimated position of the terminal device the floor ID of the identified floor and information such as a drawing of the identified floor which is read from the floor storage unit to the terminal device through the communication unit as position information step S . The control unit of the terminal device maps the position information received from the position identification server onto for example a map to display the position information on the display unit .

In this way the position identification server stores the coefficients of the parameters in the discriminant function that indicates whether or not the terminal device is located on each floor and the maximum value of radio wave strength of each base station on each floor which is measured in advance in the storage unit and receives the actual measurement value of radio wave strength of the radio waves received by the terminal device from the base station . Further the position identification server calculates the parameters of the discriminant function for each floor based on the received actual measurement value of radio wave strength and the maximum value of radio wave strength stored in the storage unit calculates the solution of the discriminant function for each floor based on the calculated parameters and the coefficients of the parameters stored in the storage unit and discriminates that the floor where the solution of the discriminant function is the greatest is the floor where the terminal device is located when there are floors where the solution of the discriminant function is greater than or equal to a predetermined value. Thereby the position identification server can accurately identify the floor with a small calculation load. Further the position identification server can reduce the number of floors for which the GMM is calculated by combining the discriminant function and the positioning using the GMM so that the position identification server can reduce calculation load by reducing the amount of data. Thus the position identification server can quickly determine the floor where the terminal device is located.

Further the position identification server calculates the solution of the discriminant function by using one or more of the following parameters the maximum value of differences between the received actual measurement values of radio wave strength and the maximum value of radio wave strength stored in the storage unit the number the differences that are positive the average value of the differences and the average value of the differences that are positive and discriminates the floor where the terminal device is located. Thereby the position identification server can accurately identify the floor with a small calculation load on the basis of the maximum value of the radio wave strength on the floor.

Further the position identification server calculates the solution of the discriminant function by using the number of matched base stations between the base stations from which the terminal device receives radio waves for each floor and the base stations on each floor stored in the storage unit as a parameter and discriminates the floor where the terminal device is located. Thereby the position identification server can accurately identify the floor with a small calculation load on the basis of the number of matched base stations between the base stations from which the terminal device receives radio waves and the base stations from which radio waves can be received on each floor.

Further the position identification server calculates parameters for each floor based on the maximum value of pre measured radio wave strength of each base station on each floor and the actual measurement value of radio wave strength of each base station for which the floor is known provides the solution of the discriminant function for each floor and calculates coefficients corresponding to the parameters as the coefficients of the parameters of the discriminant function. Thereby the position identification server can identify the floor where the terminal device is located by only substituting the parameters calculated for each floor in the discriminant function.

While the embodiment of the present application has been described in detail with reference to the drawings the embodiment is an example and it is possible to implement the present invention not only in the forms described in the section of the disclosure of the invention but also in other forms variously modified and improved based on the knowledge of the person skilled in the art.

Although in the embodiment described above as the probability that the terminal device is located on each floor the average of probabilities for each base station is used in the calculation unit it is not limited to this. For example instead of the average of probabilities for each base station the calculation unit can use a value obtained by dividing a sum of probabilities for each base station by the number of base stations on a floor where the number of the base stations for which a difference of radio wave strength is calculated is the greatest among the floors as the probability that the terminal device is located on each floor. Specifically the position identification server calculates a difference between a calculated estimated value of radio wave strength and a measured actual measurement value of radio wave strength for each base station calculates a value obtained by dividing a sum of probabilities for each base station for which a difference of radio wave strength is calculated on each floor by the number of base stations on a floor where the number of the base stations for which a difference of radio wave strength is calculated is the greatest among the floors according to the calculated differences of radio wave strength as the probability that the terminal device is located on each floor and identifies the floor where the terminal device is located based on the calculated probability that the terminal device is located. Thereby the position identification server can accurately identify the floor by weighting a floor where the number of the base stations for which a difference of radio wave strength is calculated is the greatest.

Although in the embodiment described above the determination unit identifies a floor to which a BSSID with the maximum actual measurement value of radio wave strength among unique BSSIDs belongs as the floor where the terminal device is located it is not limited to this. For example when the received maximum radio wave strength of a BSSID base station unique to a floor is greater than the corresponding maximum radio wave strength of the BSSID unique to the floor stored in the base station storage unit the determination unit can exclude the floor to which the BSSID unique to the floor belongs from the candidates to be identified. Specifically the position identification server further stores floor unique base station information in which a floor unique base station received on one floor the floor and the maximum radio wave strength for each floor unique base station are associated with each other in the storage unit in advance. Further when the received maximum radio wave strength of the floor unique base station is greater than the corresponding maximum radio wave strength of the floor unique base station stored in the storage unit the determination unit excludes the floor to which the floor unique base station belongs from the candidates to be identified and determines a floor where the number of received floor unique base stations is the greatest as the floor where the terminal device is located. Further when the determination unit cannot identify the floor where the terminal device is located the position identification server identifies the floor where the terminal device is located. Thereby the position identification server can exclude the floor to which the base station having the radio wave strength greater than the radio wave strength measured in advance belongs so that the position identification server can accurately identify the floor with a small processing load.

Although in the embodiment described above the pre measurement data is stored in the pre measurement storage unit and the verification data is stored in the verification data storage unit it is not limited to this. For example if the position identification server acquires the position where the radio wave strength is measured and acquires the pre measurement data to which a verification data ID is given when measuring the pre measurement data the position identification server can calculate the coefficients of the parameters of the discriminant function by using the data acquired by one time measurement.

Although in the embodiment described above the parameters x to x are used as the parameters of the discriminant function the parameters are not limited to these. For example the position identification server may arbitrarily combine one or more of the parameters x to x to form the discriminant function. For example the position identification server may use the minimum value of differences between the actual measurement values of radio wave strength RSSI and the maximum value of radio wave strength RSSI max on the floor as another parameter. Thereby the position identification server can identify the floor more multilaterally. Further the position identification server can use the discriminant function using only necessary parameters so that it is possible to reduce the amount of data and further reduce the calculation load.

Although in the embodiment described above the parameter related to the differences between the actual measurement values of radio wave strength RSSI and the maximum value of radio wave strength RSSI max on the floor and the number of matched BSSIDs between the BSSIDs that are actually measured and the BSSIDs that can be received on the floor are used as the parameters of the discriminant function the parameters are not limited to these. For example the position identification server may define and use a radio wave condition and a shape of the building as the parameters of the discriminant function. Thereby the position identification server can calculate the coefficients of the parameters of the discriminant function which further reflect the condition of the building so that it is possible to improve the identification accuracy of the floor.

Although in the embodiment described above the preparation process and the position identification process are performed by the position identification server it is not limited to this. For example the terminal device is provided with the determination unit the estimation unit the calculation unit the identification unit the preparation unit the discrimination unit the base station storage unit the floor storage unit the GMM storage unit the pre measurement storage unit the verification data storage unit the candidate floor storage unit and the coefficient storage unit and the preparation process and the position identification process may be performed by the terminal device . Further it is possible to appropriately change the device that performs each process such as the preparation process is performed by the position identification server and the position identification process is performed by the terminal device .

Although in the embodiment described above the discrimination process is performed after the presence or absence of a unique BSSID is determined in the position identification process it is not limited to this. For example the position identification server may perform the discrimination process and the position estimation process of steps S to S instead of the process of the unique BSSID of steps S to S. Thereby it is possible to omit one stage of process.

Although in the embodiment described above whether or not there is a floor where the solution f of the discriminant function is greater than or equal to a predetermined value is determined in the discrimination process it is not limited to this. For example the position identification server may omit the process of steps S and S and when the solution f of the discriminant function is calculated the position identification server may identify a floor where the calculated solution f of the discriminant function is the greatest and identify the floor as the floor where the terminal device is located. Thereby it is possible to omit steps S and S to S which are the process of calculating the radio wave strength by using the GMM for a plurality of floors in the position identification process so that the calculation load can be reduced.

The position identification server described above may be realized by a plurality of server computers or may be realized by a single server computer. Further the configuration can be flexibly changed. For example some functions are realized by calling an external platform or the like by an API Application Programming Interface and network computing.

The position identification server according to the embodiment described above is realized by for example a computer with a configuration as illustrated in . is a hardware configuration diagram illustrating an example of a computer that realizes the function of the position identification server. The computer includes a CPU Central Processing Unit a RAM Random Access Memory a ROM Read Only Memory an HDD Hard Disk Drive a communication interface I F an input output interface I F and a media interface I F .

The CPU operates based on a program stored in the ROM or the HDD and controls each unit. The ROM stores a boot program executed by the CPU when starting up the computer and a program and the like that depend on the hardware of the computer .

The HDD stores a program executed by the CPU and data and the like used by the program. The communication interface receives data from another device through a communication line transmits the data to the CPU and transmits data generated by the CPU to another device through the communication line .

The CPU controls output devices such as a display and a printer and input devices such as a keyboard and a mouse through the input output interface . The CPU acquires data from an input device through the input output interface . Further the CPU outputs the generated data to an output device through the input output interface .

The media interface reads a program or data stored in a recording medium and provides the program or the data to the CPU through the RAM . The CPU loads the program onto the RAM from the recording medium through the media interface and executes the loaded program. The recording medium is for example an optical recording medium such as a DVD Digital Versatile Disc and a PD Phase change rewritable Disk a magneto optical recording medium such as an MO Magneto Optical disk a tape medium a magnetic recording medium or a semiconductor memory.

When the computer functions as the position identification server of the embodiment the CPU of the computer realizes the functions of the determination unit the estimation unit the calculation unit the identification unit the preparation unit and the discrimination unit by executing programs loaded onto the RAM . In the HDD data in the base station storage unit the floor storage unit the GMM storage unit the pre measurement storage unit the verification data storage unit the candidate floor storage unit and the coefficient storage unit is stored.

While the CPU of the computer reads the programs from the recording medium and executes the programs as another example the CPU may acquire the programs from another device through the communication line .

The flowcharts described in the embodiment are an example and the order of the steps may be arbitrarily changed as long as inputs and outputs of the processes do not conflict each other. For example in the preparation process step S and step S may be exchanged so that the maximum radio wave strength measured in advance may be determined after acquiring the radio wave strength measured for verification.

The means described in the claims can be replaced with unit section module circuit or the like. For example a discrimination means can be replaced with a discrimination unit or a discrimination circuit.

The position identification server according to the present application can accurately identify a floor with a small calculation load.

Although the invention has been described with respect to specific embodiments for a complete and clear disclosure the appended claims are not to be thus limited but are to be construed as embodying all modifications and alternative constructions that may occur to one skilled in the art that fairly fall within the basic teaching herein set forth.

