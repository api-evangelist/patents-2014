---

title: Apparatus with adaptive acoustic echo control for speakerphone mode
abstract: A method includes cycling through a plurality of microphone and speaker combinations in a mobile device in response to the mobile device being placed in speakerphone mode. The mobile device includes a plurality of microphones and at least one speaker. The method obtains acoustic echo data from an echo canceller for each microphone and speaker combination, calculates an acoustic isolation value for each combination and then selects a microphone and speaker combination based on the acoustic isolation value. The method may also include determining an echo spectrum for each microphone and speaker combination using the obtained acoustic echo data, and select an echo control profile based on a characteristic of the echo spectrum. The echo control profile is selected to further improve acoustic isolation for the selected microphone and speaker combination.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09584642&OS=09584642&RS=09584642
owner: GOOGLE TECHNOLOGY HOLDINGS LLC
number: 09584642
owner_city: Mountain View
owner_country: US
publication_date: 20140311
---
The present application claims priority to U.S. Provisional Patent Application No. 61 922 607 filed Dec. 31 2013 entitled APPARATUS WITH ADAPTIVE ACOUSTIC ECHO CONTROL FOR SPEAKERPHONE MODE which is incorporated in its entirety herein.

The present disclosure relates generally to mobile devices and more particularly to voice processing and to echo canceller systems for such mobile devices.

Mobile devices such as but not limited to mobile phones smart phones personal digital assistants PDAs tablets laptops or other electronic devices etc. increasingly include voice recognition systems to provide hands free voice control of the devices. Although voice recognition technologies have been improving accurate voice recognition remains a technical challenge.

A particular challenge when implementing voice recognition systems on mobile devices is that as the mobile device moves or is positioned in certain ways the acoustic environment of the mobile device changes accordingly thereby changing the sound perceived by the mobile device s voice recognition system. Voice sound that may be recognized by the voice recognition system under one acoustic environment may be unrecognizable under certain changed conditions due to mobile device motion or positioning.

More specifically the mobile device acoustic environment impacts the operation of signal processing components such as microphone arrays noise suppressors echo cancellation systems and signal conditioning that is used to improve voice recognition performance. When a mobile device is placed on or near a table or other surface the result is a change of the transfer function between the mobile device microphones the relative signal strength and phase of the microphone signals and creation of additional reflections all of which negatively impact the operation of the signal processing components rendering them sub optimal. For example where a microphone array is used changes in the acoustic environment results in undesirable changes in the array directivity and increases pick up of undesired sound sources. These considerations impact voice recognition systems and also other mobile device operations such as speaker phone operation since changes in the acoustic environment will impact the echo canceller among other things.

The present disclosure provides an apparatus and methods of operation that select a microphone and speaker combination when the apparatus is placed into speakerphone operating mode. The disclosed embodiments cycle through various microphone and speaker combinations using the available microphones and speakers of the apparatus and collect acoustic echo data from an echo canceller of the apparatus. In one embodiment an echo spectrum is measured for each microphone and speaker combination and acoustic isolation values are calculated for each combination. A microphone and speaker combination is selected based on the acoustic isolation values. The acoustic isolation value is then further improved if possible by selecting an appropriate echo control profile for the echo canceller. The echo control profile may be selected based on a characteristic of the measured echo spectrum.

One embodiment of an apparatus includes an echo control configuration manager operatively coupled to an echo canceller controller and to a configurable group of microphones and at least one speaker. In some embodiments the echo control configuration manager may also be operatively coupled to a configurable group of speakers. The echo control configuration manager is operative to control the configurable group of microphones to turn individual microphones on or off. In embodiments that include a configurable group of speakers the echo control configuration manager is also operative to control the group of speakers to turn individual speakers on or off. The echo control configuration manage may therefore configure various microphone and speaker combinations. The echo canceller controller is operative to obtain acoustic echo data from the echo canceller for the various microphone and speaker combinations to calculate acoustic isolation values and to select a microphone and speaker combination and an echo control profile.

The present disclosure also provides an apparatus and methods of operation that improve voice recognition performance of a voice recognition system in a mobile device. The voice recognition performance is improved in the various embodiments by providing adaptive adjustment of microphone configuration including adjustment of signal conditioning and beamforming parameters based on surface proximity to the mobile device the type of surface in proximity and in some embodiments the mobile device motion. The mobile device detects proximal surfaces with respect to the mobile device s orientation classifies the surfaces based on surface reflectivity or absorptivity and accordingly adjusts the various parameters. Mobile device sensors are used to obtain a signature that may be correlated to the surface type and acoustic reflectivity or acoustic absorptivity characteristics using predetermined signatures stored in memory.

The present disclosure also provides a method of operation that includes detecting a surface in proximity to a mobile device using sensor data and determining whether the surface is acoustically reflective or acoustically absorptive. The method of operation may further include compensating for the surface acoustic reflectivity or absorptivity by controlling a configurable group of microphones of the mobile device. The present disclosure provides another method of operation that includes determining that a first microphone of a group of microphones of a mobile device is impeded by a surface that is in proximity to the mobile device and turning off the first microphone. The method may include turning on a second microphone that is determined not to be impeded by the surface. The method may include detecting the surface that is in proximity to the mobile device and using sensor data obtained from at least one sensor of the mobile device to determine acoustic reflectivity or acoustic absorptivity of the surface.

The method may further include determining orientation of the mobile device and determining that the first microphone is impeded by the surface using the orientation and the first microphone s known position in the mobile device. The method may further include selecting signal conditioning parameters based on the acoustic reflectivity or acoustic absorptivity of the surface. Selection of signal conditioning parameters based on the acoustic reflectivity or acoustic absorptivity of the surface may be accomplished in some embodiments by selecting signal conditioning parameters from a memory table correlating a plurality of sets of signal conditioning parameters to surface types for predetermined conditions. De reverberation may also be applied to an output of the second microphone when the surface acoustic reflectivity or acoustic absorptivity characteristic is determined to be reflective.

The method of operation may also include turning on a third microphone that is determined not to be impeded by the surface and beamforming the outputs of the second microphone and the third microphone to create a voice recognition virtual microphone.

In some embodiments a surface that is in proximity to the mobile device may be detected by actuating a vibrator of the mobile device and obtaining data from an accelerometer of the mobile device where the data exhibits a signature of the surface s surface type.

The present disclosure provides one embodiment of an apparatus that includes a configurable group of microphones with each microphone of the group operative to be turned on or off or have gain attenuation or filtering applied to a corresponding microphone output in response to control signals. The apparatus also includes a signal conditioner that is operatively coupled to the configurable group of microphones and a surface compensator operatively coupled to the configurable group of microphones and to the signal conditioner. The surface compensator is operative to detect a surface in proximity to the apparatus and determine a surface acoustic reflectivity or acoustic absorptivity. The surface compensator may be further operative to control the configurable group of microphones or the signal conditioner to compensate for the surface acoustic reflectivity or acoustic absorptivity. The present disclosure also provides an apparatus in another embodiment that includes a group of microphones or microphone array and switch logic operatively coupled to the group of microphones. The switch logic is operative to switch each microphone of the group of microphones either on or off in response to a first control signal. A signal conditioner is operatively coupled to the switch logic and to the group of microphones and is operative to receive outputs from each microphone of the group of microphones. Voice recognition logic is operatively coupled to the signal conditioner. A surface compensator is operatively coupled to the switch logic and to the signal conditioner and is operative to determine that a first microphone of the group of microphones is impeded by a surface that is in proximity to the apparatus and accordingly turn off the first microphone by sending the first control signal to the switch logic.

The apparatus may further include a plurality of sensors operatively coupled to the surface compensator. In one embodiment the apparatus includes a vibrator and an accelerometer both operatively coupled to the surface compensator where the accelerometer is one sensor of the plurality of sensors. The surface compensator is operative to detect a surface in proximity of the apparatus by actuating the vibrator and obtaining data from the accelerometer where the data exhibits a signature of the surface s surface type. The surface compensator is also operative to select signal conditioning parameters based on the signature of the surface s surface type and adjust the signal conditioner with the selected signal conditioning parameters.

In some embodiments the apparatus includes changeover switch logic operatively coupled to the switch logic and a beamformer operatively coupled to the changeover switch logic and to the signal conditioner. The beamformer is operative to receive and beamform microphone outputs from the changeover switch logic to create a virtual microphone and to provide at least one voice recognition channel from the virtual microphone to the signal conditioner. The surface compensator is operatively coupled to changeover switch logic and is operative to send a second control signal to the changeover switch logic to control the changeover switch logic to switch each microphone of the group of microphones either to the beamformer or to the signal conditioner.

In some embodiments the apparatus includes a 3D gyroscope where the 3D gyroscope is one sensor of the plurality of sensors. The surface compensator may determine orientation of the apparatus by obtaining 3D gyroscope data and may determine that the first microphone of the group of microphones is impeded by the surface based on the orientation of the apparatus and the first microphone s know position in the apparatus.

In some embodiments the signal conditioner may include a noise suppressor and a de reverberator. Also in some embodiments the apparatus may include global positioning system logic operatively coupled to the surface compensator. The surface compensator may receive global positioning system data from the global positioning system logic and determine when the apparatus is in motion in a vehicle based on the global positioning system data. The apparatus may further include non volatile non transitory memory operatively coupled to the surface compensator. The surface compensator may access the memory to compare the observed signature of the surface s surface type to a table of stored predetermined signatures and select the signal condition parameters from the table based on a matching predetermined signature.

Turning now to the drawings illustrates a schematic block diagram of a mobile device which is an example apparatus in accordance with the embodiments. The mobile device is an example apparatus that has the features and advantages of among other things a surface compensator . It is to be understood that is limited to showing only those components useful to describe the features and advantages of the various embodiments and to describe how to make and use the various embodiments to those of ordinary skill. It is therefore to be understood that various other components circuitry and devices etc. may be present in order to implement an apparatus such as mobile device and that those various other components circuitry devices etc. are understood to be present by those of ordinary skill. For example the mobile device may include inputs for receiving power from a power source a power distribution bus a battery communication buses for sending control signals or other information between operatively coupled components etc. Thus it is to be understood that such various other components circuitry or devices are omitted for the purpose of clarity.

The various components circuitry devices etc. described with respect to the figures including but not limited to those described using the term logic may be implemented in various ways such as by software and or firmware executing on one or more programmable processors such as a central processing unit CPU or the like or by ASICs DSPs FPGAs hardwired circuitry logic circuitry or any combinations thereof.

The terminology operatively coupled as used herein refers to coupling that enables operational and or functional communication and relationships between the various components circuitry devices etc. described as being operatively coupled and may include any intervening items i.e. buses connectors other components circuitry devices etc. used to enable such communication such as for example data communication buses or any other intervening items that one of ordinary skill would understand to be present. Also it is to be understood that other intervening items may be present between operatively coupled items even though such other intervening items are not necessary to the functional communication facilitated by the operative coupling. For example a data communication bus may be present in various embodiments and may provide data to several items along a pathway along which two or more items are operatively coupled etc. Such operative coupling is shown generally in described herein.

In the mobile device is an example apparatus in accordance with the embodiments and includes a voice recognition system. The mobile device may be any of various mobile devices such as but not limited to a video camera smartphone tablet computer laptop audio recorder or some other electronic device etc. In the mobile device a group of microphones provide microphone outputs that are operatively coupled to microphone configuration logic . In some embodiments the microphone configuration logic may include switch logic front end processing and changeover switch logic . The microphone configuration logic together with the group of microphones forms a configurable group of microphones that may be each individually turned on or off or have gain attenuation or filtering applied to a corresponding microphone by the front end processing . In other words the microphone configuration logic is controllable by appropriate control signals. Although the example of shows three microphones the embodiments are not limited to three microphones and any number of microphones may be used in the embodiments. Each microphone M1 M2 and M3 of the group of microphones is operatively coupled to a corresponding switch S11 S12 and S13 of switch logic . The switches S11 S12 and S13 are operative to turn their respective microphones on or off in response to a control signal received from a surface compensator . That is the switches S11 S12 and S13 operate as single pole single throw SPST on off switches. The switches may be implemented in any suitable manner such as by tri state logic i.e. a tri state buffer as an SPST switch etc. or some other implementation as understood by those of ordinary skill. The mobile device also includes at least one speaker and may include a speaker array having multiple speakers in some embodiments. The speaker array is operatively coupled to an echo canceller which in included in the front end processing . The group of microphones are also operatively coupled to the echo canceller . The echo canceller is operatively coupled to a transceiver and provides echo cancellation between a send and receive path on a full duplex communication channel. For example the audio channels are part of the send path and the audio channels are part of the receive path of the full duplex communication channel.

The surface compensator is operatively coupled to the switch logic by for example an internal communication bus of the mobile device . The surface compensator provides control signals to the switch logic and may turn any one of the microphones M1 M2 and M3 on or off in any combination by sending the appropriate control signal to the appropriate switch S11 S12 or S13 respectively.

The outputs of switch logic are operatively coupled to front end processing which may include but is not limited to signal amplification analog to digital conversion digital audio sampling echo cancellation etc. which may be applied to the physical microphone M1 M2 M3 outputs prior to the beamformer or signal conditioner . In some embodiments the front end processing may receive a control signal from the surface compensator to adjust parameters such as for example amplifier gain.

The front end processing is further operatively coupled to changeover switch logic . Changeover switch logic is operatively coupled to the surface compensator to receive control signal and includes a switch operatively coupled and corresponding to each microphone output for example switches S21 S22 and S23. The switches S21 S22 and S23 are configured as a single pole double throw SPDT changeover switches in that each switch is operative to switch its respective microphone output to the beamformer or directly to the signal conditioner . In other words the changeover switch logic is controlled by the surface compensator to turn beamforming on or off. In other embodiments the beamformer may be turned on or off by control signal from the microphone configuration controller . Microphones may be effectively turned on or off by the beamformer by increasing gain on microphone inputs to turn microphones on and by adjusting gain to zero to turn microphones off. That is in some embodiments the beamformer bypass operation of the changeover switch logic may be performed by the beamformer and the changeover switch logic and or switch logic may not be used or may not be present in the embodiment. Instead in some embodiments the microphone configuration controller may control the beamformer by control signal to implement the operations of the microphone configuration logic switches.

The beamformer is an adjustable beamformer and receives audio signals from the microphone M1 M2 and M3 outputs and performs beamforming to create various virtual microphone audio channels that include at least one voice recognition control channel . In some embodiments the beamformer may provide other virtual microphone audio channels such as audio channels and which may be for example virtual microphone voice communication channels on a mobile phone virtual microphone voice recording channels on a video recorder or some other type of virtual microphone audio channel. In other embodiments multiple voice recognition channels may be created by beamformer in addition to voice recognition control channel .

The beamformer creates the virtual audio channels by applying appropriate filtering algorithms and using a group of adjustable filters which in some embodiments may be adaptive filters. In one example sound received by microphones M1 M2 and M3 may be combined and appropriately filtered to create a single virtual microphone that receives sound from a given direction. As mentioned above the group of microphones may include several microphones i.e. a microphone array such that one or more virtual microphones may be created using several physical microphone outputs and applying beamforming techniques. As a few examples the created virtual microphones may be used to focus on sound in any given direction or to pan a room to search for specific voices sounds etc. Therefore the beamformer may be used to create one or more virtual microphones to pick up sound coming from the direction of the controlling user while another virtual microphone may pick up sound in a direction where another speaker is located such as for example in a conference call situation where two speakers are located in different areas of a room.

The example beamformer includes various filters such as filter which provide the various other audio channels and and the voice recognition control channel . As shown in the beamformer may have any number of filters. Likewise the number of virtual audio channel outputs is not limited. The filters may be finite impulse response FIR filters in some embodiments and may also be adaptive FIR filters. Additionally in some embodiments outputs from one or more filters may be combined or summed to create a virtual audio channel. That is in accordance with the embodiments any appropriate filter configuration may be implemented within the beamformer .

The beamformer is operatively coupled to a signal conditioner and provides the virtual microphone audio channels as inputs. It is to be understood however that the signal conditioner could also be located prior to the beamformer and therefore may be operatively coupled to the microphone outputs at changeover switch logic or elsewhere such that the signal conditioner may provide conditioned microphone outputs to the beamformer in some embodiments. In the example embodiment of the various audio channels and and voice recognition control channel are input to the signal conditioner . The signal conditioner is also operatively coupled to changeover switch logic and may receive microphone inputs directly when the changeover switch logic is switched to bypass the beamformer . The signal conditioner is also operatively coupled to the voice command recognition logic to provide a conditioned control channel as an input to the voice command recognition logic . The voice command recognition logic is operatively coupled to the system control which may be any type of voice controllable system control such as but not limited to a voice controlled dialer of a mobile phone a video system control an application control of a mobile phone smartphone tablet laptop etc. or any other type of voice controllable system control. The voice command recognition logic send a control signal to the system control in response to detected command words or command phrases received on the conditioned voice recognition control channel . The signal conditioner may provide a conditioned output corresponding to each signal conditioner input. For example signal conditioner may provide conditioned audio channels to some other mobile device system such as to the transceiver . The transceiver may be a wireless transceiver using any of various wireless technologies and may implement a full duplex telecommunication channel. For example the transceiver provides audio channels to the echo canceller where the audio channels correspond to the receive path of a full duplex telecommunication channel and the audio channels correspond to the send path of the full duplex telecommunication channel. The transceiver may also operate in a Voice Over Internet Protocol VoIP system in some embodiments and may provide IP packet voice over a wireline or wireless VoIP connection. The conditioned voice recognition control channel is input to the voice command recognition logic as note above.

The surface compensator is operatively coupled to the signal conditioner to provide a control signal . The surface compensator may send the control signal when the surface compensator detects a reflective or absorptive surface in proximity to the mobile device . In response to detection of a surface and determination of a surface type the surface compensator may send the control signal to the signal conditioner and may control any of various audio attributes related to various audio enhancement functions in order to compensate for the proximate surface. The signal conditioner may include various audio enhancement functions such as but not limited to de reverberator automatic gain control AGC or noise suppressor etc.

The surface compensator is also operatively coupled to the beamformer to provide a control signal which may also be sent in response to detection of a surface and determination of a surface type. For example the control signal may control attributes of the filters to change the configuration of virtual microphones or redirect the virtual microphone beams etc. or to adjust some other audio attribute. By controlling the filters the beamformer may beamform the sound received by each of the microphones M1 M2 and M3 in any combination to create virtual microphones and particularly voice recognition control channel . That is in accordance with the embodiments sound received by various physical microphones may be combined in various ways to form virtual microphones that may be reconfigured in response to a microphone impeding surface detected by the surface compensator .

For example the surface compensator may configure virtual microphones to compensate for an impeding proximal surface by focusing on a given direction amplifying a specific voice or sound panning or etc. The surface compensator may include a microphone configuration controller that is operative to compensate for surfaces impeding any one or more microphones of the group of microphones by turning microphones on or off and by controlling audio attributes such as but not limited to audio sensitivity panning in a given direction focusing on a specified direction blocking a specified direction or reducing background noise etc.

The voice recognition control channel may be created using beamforming where the virtual microphone is configured to pick up sound from a certain position with respect to the mobile device . More particularly a virtual microphone may be created that is directed towards the operator of mobile device and that avoids an impeding surface that impedes one or more physical microphones of the mobile device . Command word utterances are detected on the voice recognition control channel by the voice command recognition logic and acted upon appropriately.

In one example embodiment the microphone configuration controller of the surface compensator controls the beamformer among other things. The example microphone configuration controller may include an internal memory table or may access a memory table stored in system memory which is operatively coupled to the surface compensator by connection . The memory table may store preconfigured beam patterns for predetermined virtual microphone configurations. The preconfigured beam patterns may be stored by storing filter coefficients or other filter parameters that may be used by the beamformer and applied to the group of filters to create the desired audio beam patterns. The microphone configuration controller is operatively coupled to the beamformer to send a control signal to adjust the beamformer settings. The control signal may include settings obtained from the memory table or may provide a pointer to a memory table location that may be accessed by the beamformer to adjust settings.

The system memory is a non volatile non transitory memory and may be operatively coupled to the signal conditioner by connection and may also be accessible by other components of the mobile device for various setting stored applications etc. In embodiments where the system memory is used to store the memory table the surface compensator is operatively coupled to the system memory to send data to and receive data from the system memory over connection which is a bi directional memory interface.

The microphone configuration controller of the surface compensator may also control the signal conditioner by using the memory table . That is the memory table may store various audio parameters for predetermined audio attributes. The stored audio parameters may include noise suppression algorithms that may be selected for a noise suppression component of signal conditioner or some other audio related algorithms to achieve the desired audio attributes to overcome voice recognition issues due to motion or an impeding surface.

It is to be understood that the various control signals described herein with respect to various components such as but not limited to the surface compensator switch logic changeover switch logic front end processing beamformer signal conditioner etc. may be implemented in various ways such as using APIs between the various components. Additionally operations involving the memory table may be implemented using pointers where the components access the memory table as directed by the microphone configuration controller . In other words control signal and control signal may be implemented such that the beamformer and the signal conditioner obtain control information such as but not limited to audio attribute parameters filter coefficients etc. from system memory and that such implementations are contemplated embodiments and in accordance with the embodiments and examples described herein.

The surface compensator may include surface detection and classification logic and device orientation and movement logic both of which are operatively coupled to each other and to the microphone configuration controller by communication bus which may be internal to the surface compensator . The communication bus may be implemented as application programming interfaces APIs between the surface compensator components in some embodiments. The mobile device includes a group of sensors that are all operatively coupled to the surface compensator by a communication bus . The group of sensors may include but is not limited to photosensor photosensor such as cameras proximity sensor 3D gyroscope vibrator and accelerometer . The surface compensator may also be operatively coupled to global positioning system GPS logic by connection to receive location data and speed information when the mobile device is in motion such as when it is located in a vehicle.

In accordance with the embodiments the surface compensator uses the group of sensors to detect a surface such as when a mobile device is placed on a table. The surface compensator is operative to enable one or more microphones of the group of microphones as appropriate to avoid the impeding surface. The surface compensator may also use mobile device orientation to select an appropriate microphone. For example microphones M1 and M2 may be located at top and bottom edges of a front side the mobile device and microphone M3 may be located somewhere on a rear side of the mobile device . The device orientation and movement logic of surface compensator uses data from accelerometer or GPS logic to determine if the mobile device is moving or is stationary such as when the mobile device is on a table top. More particularly the device orientation and movement logic may use the accelerometer or gyroscope to determine the orientation of the mobile device . For example if the mobile device is not determined to be moving and is in an orientation relatively perpendicular with respect to the ground the device orientation and movement logic may determine that the mobile device is stationary and may have been placed on a surface.

If the device is determined to have been placed on or near a surface the device orientation and movement logic may send a trigger to the surface detection and classification logic to check for surfaces. However in other embodiments the surface detection and classification logic may independently perform checks for nearby surfaces by obtaining data from the group of sensors. For example photosensor photosensor or proximity sensor may provide an indication to surface detection and classification logic of a nearby surface. The surface detection and classification logic actuates the vibrator and performs a closed loop measurement by obtaining feedback from the accelerometer or the gyroscope or both. The information obtained is used to determine if a surface is present such as when the mobile device is placed on a table chair cushion car seat next to a wall etc. and to determine a surface classification such as whether the surface is reflective or absorptive. The orientation of the mobile device may be used by the surface compensator in conjunction with the surface classification information to determine how to configure the microphones to compensate for the surface s acoustic reflectivity or acoustic absorptivity.

For example the device orientation and movement logic will inform the microphone configuration controller of the mobile device orientation and the surface detection and classification logic will provide the surface type i.e. surface classification reflective absorptive etc. . One or more microphones may be impeded by a surface due to surface reflectivity or surface absorptivity i.e. occlusion based on the surface type and the mobile device orientation with respect to the surface. For example if the mobile device is found to be oriented such that microphone M3 is facing downward the microphone configuration controller can open switch S13 to turn off microphone M3 since it may be impeded by a surface. Alternatively the microphone configuration controller may send control signal to beamformer and apply beamforming to one or more of the microphone outputs to avoid interference from the surface. Other beamforming configurations may be used when the mobile device is determined to be or is most likely to be in the user s hand. The microphone configuration controller will also control the signal conditioner to adjust various audio attributes. For example if a surface is found to be reflective the microphone configuration controller may send control signal to the signal conditioner to invoke the de reverberator . Thus the surface compensator among other features detects a surface in proximity to the mobile device and determines an acoustic reflectivity or acoustic absorptivity of the surface by using sensor data obtained from the group of sensors operatively coupled by communication bus . The surface compensator compensates for the surface acoustic reflectivity or acoustic absorptivity by controlling the configurable group of microphones controlling the signal conditioner controlling the beamformer or by combinations of each of these. Compensating for the proximate surface by the surface compensator may include among other things inferring a time delay via the speed of sound and or estimating the relative strength of the initial acoustic reflection from that surface via estimates of the surface reflectivity or absorptivity. This information may be used in some embodiments to configure the parameters of beamformer or of signal conditioner modules such as the de reverberator . Additionally such information along with the known 3D locations of the microphones can be used by the microphone configuration controller and beamformer to determine a useful orientation for a virtual microphone and configure the beamform pattern accordingly. In some embodiments compensating for the proximate surface may also include using beamforming to avoid acoustic inference by the surface i.e. reflected sound waves or sound absorption or by adjusting signal conditioning such as de reverberation gain etc. to accommodate for reflections or for signal attenuation due to absorption.

Various methods of operation of the surface compensator may be understood in view of the flowcharts of through . Beginning with a method of operation begins in operation block in which the surface compensator determines the motion status of the mobile device . In operation block the surface compensator determines the orientation of the mobile device such as for example whether the mobile device is oriented perpendicular to the ground or horizontal with respect to the ground such as when it is placed upon a flat surface such as a tabletop or chair cushion etc. In operation block the surface compensator determines if the mobile device actually is located on or near a surface. If the mobile device is actually located on or near a surface the surface compensator will determine the surface type in operation block . The surface type is a surface classification such as whether the surface is reflective or absorptive which may be determined by a sensor data signature obtained by the surface compensator . In operation block the surface compensator will configure the group of microphones and will apply appropriate signal conditioning which may include beamforming according to the determined motion status orientation and surface type. The method of operation then ends as shown.

The flowchart of provides details of a method of operation that occurs within operation block of . That is in some embodiments as shown in operation block the surface compensator may obtain location data such as but not limited to GPS data from GPS logic . The GPS data is processed by the surface compensator to determine the location of the mobile device and if the mobile device is in a moving vehicle. In some situations GPS data may not be available such as when the mobile device is unable to access the GPS signal. In those situations as shown in operation block surface compensator may obtain accelerometer data from the accelerometer . In operation block the surface compensator may determine motion status of mobile device based on the obtained location data if it was available accelerometer data or both. The motion status determination is made by the device orientation and movement logic of the surface compensator . The method of operation in the flow chart of then ends and in the flowchart of the method of operation proceeds to determine the mobile device orientation as shown in operation block . Returning briefly to operation block of the device orientation and movement logic may assess data obtained from the 3D gyroscope to determine if the mobile device is oriented horizontally or at some acute angle with respect to the ground such that it may be positioned on or near a surface.

If a determination is made by the device orientation and movement logic that mobile device is not in a moving vehicle information from any combination of the group of sensors may be combined to determine the mobile device orientation and whether the mobile device may be near a surface. The device orientation and movement logic provides an output over the communication bus to the surface detection and classification logic which includes the mobile device orientation and a flag indicating that the mobile device may be on or close to a surface. In response to the control signal the surface detection and classification logic proceeds with the method of operation shown in which also occurs in operation block of . Therefore provides further details of operation block . Thus in operation block the surface detection and classification logic activates vibrator while monitoring the accelerometer signal. That is the accelerometer data is obtained as shown in operation block . The accelerometer signal is then analyzed for characteristics such as frequency distribution level etc. and is compared to known predetermined signatures that are stored in system memory . These signatures may be stored in the memory table . In operation block the known signatures based on the accelerometer data are used to determine the surface type. The method of operation of then ends and the surface detection and classification logic then provides an output over the communication bus to the microphone configuration controller . The method of operation proceeds to operation block in further details of which are provided in .

Therefore the microphone configuration controller receives information from the surface detection and classification logic regarding the surface type. The microphone configuration controller may also receive orientation information from the device orientation and movement logic . The microphone configuration controller then uses the received information to configure a microphone array unit such as the group of microphones and determines which microphones to be activated or turned off the microphone gains at front end processing beamforming and signal conditioning based on a set of rules which may be stored in system memory . The rules are predetermined based on various surface types and signatures and orientations of the mobile device with respect to such surface types. The microphone configuration controller may therefore control the beamformer to form optimal virtual microphones for a given surface type and also sends control signal to the signal conditioner to configure the noise suppressor and also the AGC and de reverberator when needed.

These operations of the microphone configuration controller occur in operation block of further details of which are provided by the flowchart of . Thus in operation block the microphone configuration controller determines which microphones of the group of microphones are available. For example some microphones may be occluded or impeded by an absorptive surface such as a couch cushion. Additionally in some embodiments some microphones may be unavailable for voice recognition if they are being used by the mobile device for other audio activities for example audio recording voice communication etc. However such in use microphones may be used in some embodiments to form a virtual microphone and virtual voice recognition channel using beamforming. Thus in operation block the microphone configuration controller may turn some microphones on and others off accordingly. In operation block the microphone configuration controller will determine whether beamforming should be applied and will send control signal to beamformer to adjust parameters accordingly if applicable. That is the microphone configuration controller may operate changeover switch logic to turn beamforming on or off accordingly for one or more activated microphones and configure the beamformer by control signal . In operation block the microphone configuration controller will also determine what signal conditioning should be applied given the mobile device motion status orientation and surface type of any nearby surface. This determination may be made by performing a lookup operation of signal conditioning configurations for known conditions stored in system memory . In operation block the microphone configuration controller sends control signal to the signal conditioner to configure signal conditioning accordingly. The method of operation of and also of then ends.

Returning briefly to operation block and the flowchart of if a determination is made that the mobile device is inside a moving vehicle orientation and surface detection is attempted after accounting for the variability in the accelerometer and 3D gyroscope signals. The presence and characteristics of a surface is tested by the surface detection and classification logic . The statistic of the information obtained and criteria such as signal distribution variance or other statistical measures are used to determine if the attempted surface detection was successful or not. Upon a determination that the decision is un reliable a default in car configuration signal is sent to the microphone configuration controller otherwise the microphones are configured accordingly for a detected surface as described above.

The flowchart of is useful for understanding an overall method of operation of the surface compensator . The method of operation begins in operation block and the surface compensator obtains location data from the GPS logic if location data is available. In operation block the surface compensator obtains sensor data from any or all of the sensors such as but not limited to photosensor photosensor proximity sensor 3D gyroscope and accelerometer . In decision block the surface compensator checks the obtained location data as well as gyroscope and accelerometer data to determine if the mobile device is moving. If no movement is detected in decision block then the method of operation proceeds to determine orientation of the mobile device in operation block .

However if movement is detected in decision block then the surface compensator will proceed to decision block and will determine if the mobile device movement is caused by the mobile device being located in a vehicle. If not then the method of operation again proceeds to operation block to determine the mobile device orientation. However if the mobile device is determined to be in a vehicle in decision block then the surface compensator may adjust signal conditioning for the vehicle type in operation block . The surface compensator may obtain settings for the signal conditioner from system memory based on known sensor data signatures that are known for in vehicle acoustic conditions for a given vehicle type and may select settings that match the observed sensor signatures obtained in operation block .

In operation block the surface compensator determines the orientation of the mobile device by reading the sensor data obtained from 3D gyroscope . The orientation may indicate that there is a likelihood that the mobile device is placed on or near a surface such as for example when the mobile device is laid on the table or some other relatively flat surface. In response to such a determination as shown in operation block the surface compensator may proceed to actuate surface sensors and obtain sensor data to attempt to detect a nearby surface. For example the surface compensator may actuate vibrator of mobile device and monitor the response of accelerometer to determine a surface signature and thus to determine whether a surface is present. If a surface is detected in decision block then in operation block the surface compensator may determine the surface type using the sensor data. For example surface compensator may access the memory table stored in system memory to compare a measured signature to predetermined signatures that have been previously measured for known surface types and for given mobile device orientations. If no surface is detected in decision block method of operation ends as shown.

After detection of the surface in decision block and determination of surface type in operation block the surface compensator may turn off microphones impeded by the detected surface and turn on any available microphones as shown in operation block . In decision block surface compensator may determine whether to apply beamforming given the orientation of the mobile device and the detected surface type. If the surface compensator determines that beamforming should not be applied in decision block then the surface compensator may proceed to select signal conditioning for the motion status orientation and surface type as shown in operation block after which the method of operation ends as shown. If beamforming is to be applied in decision block then the surface compensator may select a beamforming configuration based on the available microphones and mobile device orientation as shown in operation block . For example the surface compensator may access the memory table or other memory tables stored in system memory and obtain a beamforming configuration based on the detected surface type and mobile device orientation. An appropriate beamforming configuration may be selected from a set of predetermined stored beamforming configurations. If beamforming is not to be applied in decision block or if a beamforming configuration selection is completed in operation block then the surface compensator proceeds to operation block and selects signal conditioning parameters appropriate for the motion status orientation and surface type. The surface compensator may also access system memory to obtain signal conditioning configurations that are stored for predetermined known orientations of the mobile device and know surface types. The surface compensator then sends appropriate control signal to the beam former if beamforming is applied and sends control signal to signal conditioner to accordingly adjust various parameters of the beamformer and signal conditioner respectively.

Therefore among other advantages of the various embodiments microphone configuration including application of beamforming and signal conditioning is adjusted by the surface compensator to improve voice recognition performance when a mobile device is placed on or near an audio impeding surface whether reflective or absorptive. The surface compensator determines among other things which microphones that are not impeded or occluded for a detected mobile device orientation. The surface compensator may utilize a single microphone and may apply noise reduction algorithms suitable for the single microphone. The surface compensator may apply a table top optimized noise reduction algorithm and or a table top optimized beamforming configuration where pre configuration information is stored in and retrieved from the memory table . The surface compensator may also apply appropriately trained de reverberation. The surface compensator may use information from the proximity sensor or from any of the group of sensors in various combinations to determine and select an optimal configuration for a microphone array such as the group of microphones in response to detection of a nearby surface which changes the mobile device acoustic environment conditions.

Among other advantages the embodiments also provide methods for determining the characteristics of the surface such as when a mobile device is lying on a hard surface or on a soft cushion such as couch or car seat . In order to accomplish this task a signal from the 3D accelerometer is examined by the surface compensator both with and without external stimulus from the vibrator . Predetermined characteristics of the signal may be stored in a database of signatures obtained in different environments and stored in system memory . For example the database of signatures may be stored in memory table in some embodiments.

Another advantage of the embodiments is that actions are taken in order to improve the signal sent to the voice command recognition logic once accurate determination is made as to the presence of interfering surfaces near by the group of microphones . These actions fall into two categories selecting which out of many available microphones are activated and how the signals from multiple microphones are combined for further processing.

For example in some situations such as where the mobile device is determined by the surface compensator to be laying upside down on a soft cushion the surface compensator may further determine that a primary microphone is occluded and can accordingly switch on a secondary microphone only for example a microphone located on the back of the mobile device may be a secondary microphone and configure the signal conditioner to apply noise reduction for a single microphone system. If multiple microphones are available the appropriate set of microphones can be identified by the surface compensator and activated. The surface compensator may then further apply beamforming and signal conditioning configured appropriately for the surface type and conditions.

Another advantage is that the presence of a very reflective surface can be mitigated by configuring the use of appropriate microphones and turning on a de reverberation processing prior to noise reduction. The type of algorithm may be selected based on the severity of the condition or based on which microphone or microphones are active for the condition observed. In situations where accurate determination about the environment condition cannot be made a safe default microphone configuration is used.

Further details of the front end processing shown in are provided in . The front end processing is operatively coupled to the group of microphones and to at least one speaker. In the example of the front end processing is operatively coupled to speaker array . In some embodiments switch logic may also be present and may provide the capability for switching microphones and speakers on or off such that various speaker and microphone combinations may be configured. That is both the microphones and speakers may be switched on or off using switch logic as shown and described in . In alternative embodiments speaker and microphone combination configurations may be accomplished by accordingly adjusting gain for specific microphones or speakers. That is lowering the gain value for a specific microphone or speaker to zero would result in that microphone or speaker being effectively turned off. This gain adjustment may be accomplished by providing a control signal to the gain and filtering logic for the speaker array to the gain and filtering logic for the group of microphones or to both in order to configure various speaker and microphone combinations. In accordance with the embodiments an echo control configuration manager that is operatively coupled to the switch logic and the front end processing may configure speaker and microphone combinations by either sending an appropriate control signal to switch logic when present in an embodiment or by sending an appropriate control signal to front end processing to appropriately adjust gain levels for the gain and filtering logic the gain and filtering logic or both in order to configure the speaker and microphone configurations. The echo control configuration manager is operative to receive a speakerphone mode select signal from an application processor not shown when the mobile device is placed in a speakerphone operating mode. The echo control configuration manager may begin to cycle through various microphone and speaker combinations in response to the presence of the speakerphone mode select signal .

The front end processing may include one or more analog to digital converters ADC on the send path and one or more digital to analog converters DAC on the receive path which are operatively coupled to corresponding receive path gain and filtering logic and send path gain and filtering logic respectively. The gain and filtering logic and gain and filtering logic are operatively coupled to echo canceller . In some embodiments the front end processing may also include fixed predetermined audio filters and fixed predetermined amplifiers that have predetermined gain levels based on assumptions made about the audio signals received by the group of microphones . The front end processing may also include other signal conditioning such as but not limited to a noise suppressor where the echo canceller is operatively coupled to the noise suppressor and provides the echo canceller audio channels as an input to the noise suppressor etc. The noise suppressor and any other signal conditioning in such embodiments are in turn operatively coupled to the transceiver . Thus it is to be understood that other intervening post processing logic components may exist between the echo canceller and the transceiver such as gain more filtering signal conditioning including a noise suppressor etc. however such components are not shown for the purpose of clarity. The echo canceller operates to monitor audio on the send path determine if any part of the receive path audio shows up on the send path and reduce or block undesirable audio from the send path accordingly. An echo canceller controller is operatively coupled to the echo canceller and to the echo control configuration manager . The echo canceller controller is also operatively coupled to the system memory by connection and is operative to access the echo control profile database . In accordance with the embodiments the echo canceller controller receives acoustic echo data from the echo canceller and provides a control signal to control the echo canceller to select an appropriate echo control profile from an echo control profile database . The echo control profile database may be stored in system memory in some embodiments as shown in or may be stored in a dedicated memory of the echo canceller .

Thus in some embodiments the echo canceller may communicate with the system memory by connection to access the echo control profile database and select and load an appropriate echo control profile. The echo control profile contains information related to echo cancellation algorithms tailored to certain observed echo conditions microphone speaker combinations or both. In accordance with the embodiments the echo canceller controller is operative to evaluate the acoustic echo data select a microphone speaker combination and send control signal to the echo canceller to command the echo canceller to load an appropriate echo control profile selected by the echo canceller controller . The echo canceller controller communicates with the echo control configuration manager by a connection .

The echo control configuration manager is operative to cycle through microphone speaker combinations in response to the mobile device being operated in speakerphone mode. When the mobile device is placed in speaker phone mode the echo control configuration manager receives the speakerphone mode select signal from an application processor not shown . Additionally the echo control configuration manager may receive microphone and speaker configuration information from the echo canceller controller . The echo control configuration manager may use such information to determine an initial microphone and speaker configuration or to limit the number of microphone and speaker combinations to be tested. The echo canceller controller may obtain the microphone and speaker configuration information from the surface compensator microphone configuration controller over the connection . Also the echo canceller controller may receive information regarding the orientation or movement of the mobile device from the device orientation and movement logic .

The echo control configuration manager may therefore utilize information obtained from the microphone configuration controller regarding how the group of microphones has been configured. In some embodiments the echo canceller controller may override operation of the surface compensator . Specifically the microphone configuration controller operations may be overridden. In one example if the mobile device is placed flat on a surface such as on a tabletop or desktop the microphone configuration controller may have configured the group of microphones such that any microphones occluded by the tabletop or desktop surface have been turned off. The echo control configuration manager can utilize this information such that it will avoid cycling through any speaker microphone combinations that utilize the occluded microphones. The echo canceller controller may provide an override signal to the microphone configuration controller over the connection in various embodiments that provide for such override control. Thus in some embodiments the echo control configuration manager may control or cycle through microphone speaker combinations that include those microphones that have been turned off by the microphone configuration controller .

Upon receiving the speakerphone mode select signal the echo control configuration manager proceeds to cycle through various microphone speaker combinations beginning with an initial default microphone speaker combination. For each microphone speaker combination the echo canceller controller will obtain acoustic echo data from the echo canceler and may measure an echo spectrum for each combination. The echo control configuration manager may provide microphone speaker combination configuration information to the echo canceler controller by way of the connection . In other words the echo configuration manager may inform the echo canceler controller which microphone speaker combination is currently in use. The echo canceler controller is operative to evaluate the acoustic echo data by applying various analyses and performing calculations for each microphone speaker combination and to select which microphone speaker combination to settle upon for use in the speakerphone mode. After the echo canceler controller selects a microphone speaker combination to use it further proceeds to evaluate the acoustic echo data to determine an appropriate echo control profile from the echo control profile database . Upon determination of an appropriate echo control profile the echo control canceler sends the control signal to the echo canceler which commands it to access system memory over the connection to retrieve and load the appropriate echo control profile.

If the surface compensator detects a change in the mobile device orientation or detects movement of the mobile device by the device orientation and movement logic in some embodiments the surface compensator will send an indication to the echo canceller controller over connection . Based on the new orientation or movement condition of the mobile device the echo canceller controller may command the echo control configuration manager to change the microphone speaker combination or the echo canceler controller may select a different more appropriate echo control profile and command the echo canceler accordingly.

It is to be understood that control signal connection control signal and control signal may be implemented in various ways in the embodiments such as by using APIs between the various components. Additionally operations involving the echo control profile database may be implemented using pointers where the echo canceller accesses the echo control profile database via a pointer provided by the echo canceller controller . The echo control configuration manager and the echo canceller controller may be implemented as software firmware or combinations of both executing on one or more processors such as a central processing unit CPU or the like or by ASICs DSPs FPGAs hardwired circuitry logic circuitry or any combinations thereof.

Further details of operation of the echo control configuration manager and the echo canceler controller in accordance with the embodiments are illustrated in the flowcharts of through . In operation block the mobile device is placed in speakerphone mode and the speaker phone mode select signal is send to the echo control configuration manager by the application processor. In block echo control configuration manager sets up an initial default microphone and speaker combination or otherwise may begin using microphone configuration information obtained from the microphone configuration controller as was described above. That is the echo control configuration manager may determine whether all microphone and speaker combinations will be tested or if only a subset will be tested based on information obtained from the surface compensator . In block as the echo control configuration manager switches among the various microphone and speaker configurations the echo canceller controller obtains acoustic echo data from the echo canceller and measures an echo spectrum for each configuration or combination.

In block the echo canceler controller will calculate an acoustic isolation value from the acoustic data for each microphone speaker combination. In operation block the echo canceler controller will select a speaker microphone combination for echo attenuation based on the acoustic isolation value. For example the echo canceller controller may search for a combination having a maximum acoustic isolation value and select the corresponding combination on that basis. The echo canceller controller may also inform the echo control configuration manager of the selected combination over the connection . The echo control configuration manager will then configure the selected microphone and speaker combination accordingly.

After selection of an appropriate microphone and speaker combination in operation block the echo canceller controller proceeds to select an echo control profile in operation block . The echo control profile is selected to improve echo attenuation for the selected microphone and speaker combination by checking and comparing a characteristic of the echo spectrum that results from applying the echo control profile to the selected combination. In other words the echo canceller controller commands the echo canceller to cycle through a set of echo control profiles applicable for the selected microphone and speaker combination.

The echo spectrum characteristic may be a calculated result obtained from the echo spectrum such as but not limited to an acoustic isolation value echo return energy a spectrum signature etc. For example in some embodiments an acoustic isolation value may be recalculated for each echo control profile of a group of echo control profiles that may be applicable for the selected microphone and speaker combination. After selection of an echo control profile in operation block the echo canceler controller sends the control signal to the echo canceller to load the selected echo control profile from the echo control profile database . The echo control profile database may be stored in system memory as was discussed above.

In decision block the echo canceller controller may communicate with the surface compensator and may determine if the orientation of the mobile device has changed. For example the echo canceller controller may receive an indication of an orientation change from the device orientation and movement logic when the user places the mobile device into a different position. In this case the method of operation may return to operation block to reevaluate the microphone and speaker combination being used the echo control profile being used or both. If the orientation change impacted the echo attenuation and cancellation performance then the echo canceller controller and echo control configuration manager may reconfigure the microphone and speaker combination accordingly and identify another echo control profile if needed. In other words during speakerphone operation the echo canceller controller will monitor the echo canceller performance and will make adjustments if needed when the mobile device is repositioned such that echo cancellation is degraded from the selected microphone and speaker combination and echo control profile.

If no change in orientation is detected in decision block the method of operation continues to use the selected microphone and speaker combination and echo control profile until the user exits speakerphone mode or terminates the call as shown in decision block at which point the method of operation ends. Otherwise the microphone and speaker combination and echo control profile continues to be used until a change is detected in decision block . The user may exit speakerphone mode or terminate the call as shown in decision block at any point during the method of operation which is then ended as shown.

The flowchart of provides a method of operation for selecting a microphone and speaker combination in accordance with an embodiment. The speakerphone mode select signal is sent from an application processor to the echo control configuration manager in operation block which begins a looping operation that continues until a predetermined number of microphone speaker combinations have been cycled through by the echo control configuration manager . Thus in operation block the echo control configuration manager configures an initial or default microphones speaker combination and the echo canceller controller obtains acoustic echo data and measures an echo return energy for that combination. The echo control configuration manager subsequently configures each additional microphones speaker combination and the echo canceller controller measures an echo return energy for each combination. In other words the echo control configuration manager cycles through one to n microphone and speaker combinations where the integer n represents the maximum possible number of combinations available given the number of microphones and speakers available to the mobile device . These combination configurations are formed using one or more of the microphones and one or more speakers when available in forming the combinations so that microphones and speakers at different physical positions within the mobile device are combined. For example if a mobile device has one speaker and four microphones the method of operation will cycle through fifteen microphone and speaker combinations.

Accordingly in operation block the echo canceler controller analyzes the acoustic echo data captured from the echo canceler for the various combinations and selects a microphone and speaker combination having a minimum echo return energy. In operation block the echo canceler controller attempts to optimize the echo control profile used for the selected microphone and speaker combination. This may be accomplished using various techniques in accordance with the embodiments one example of which is illustrated by the flowchart of .

After application of a selected echo control profile in operation block the echo canceller controller waits for a state change as shown in operation block . For example if the orientation of the mobile device is changed by the user as shown in decision block the method of operation returns to operation block and determines if the currently configured microphone and speaker combination the currently used echo control profile or both as still applicable for the new mobile device orientation. Otherwise the microphone and speaker combination and echo control profile continues to be used until a change is detected in decision block such as exiting speakerphone mode or call termination. The user may exit speakerphone mode or terminate the call as shown in decision block at any point during the method of operation which is then ended as shown.

The flowchart of provides a method of operation for selecting an echo profile in accordance with an embodiment and provides further details of operation block in some embodiments. In operation block the echo canceller loads an initial echo control profile P and the echo canceller controller then obtains acoustic echo data and determines an acoustic isolation value. The echo canceller controller commands the echo canceller to cycle through a set of echo control profiles Pto Pwhich are stored in the echo control profile database . In operation block the echo canceller controller checks the acoustic isolation values obtained for each of the echo control profiles relative to the measured raw echo. In operation block the echo canceller controller selects the echo control profile which provides the maximum acoustic isolation value. The method of operation then ends as shown.

In the methods of operation of and the selection of the microphone and speaker combination is performed to reduce or minimize acoustic echo on the full duplex communication channel. The minimization or reduction can be accomplished using various techniques in accordance with the embodiments that determine a characteristic of an echo spectrum corresponding to a given microphone and speaker combination. For example the microphone and speaker combination exhibiting the least echo loss may be selected. Further an acoustic isolation value may be used and may be determined in a variety of ways in accordance with the embodiments. The measured echo spectrum may be used accordingly to determine values such as an acoustic isolation value an echo return energy such as frequency domain energy time domain energy a root mean square value etc.

For example existing standards may be used for determining an acoustic isolation value and for making this determination in some embodiments. Some existing standards known to those of ordinary skill utilize a weighted terminal coupling loss which is referred to by the acronym TCLw as an acoustic isolation value. The TCLw value represents a weighted average of echo loss across a frequency spectrum. The 3rd Generation Partnership Project 3GPP Technical Specification TS 26.132 version 11.0.0 Release 11 Speech and Video Telephony Terminal Acoustic Test Specification October 2012 3GPP TS 26.132 among other standards discusses methods of testing mobile devices and for calculating TCLw using the trapezoidal rule. Other recommendations regarding TCLw may be found for example in 3GPP TS 26.131 version 12.0.0 Release 12 Terminal Acoustic Characteristics For Telephony June 2013 . These standards may thus be used in the embodiments to determine which microphone and speaker combination to select according to calculated TCLw values. However it is to be understood that various other techniques may be used in accordance with the embodiments. For example various different weighting functions other than the trapezoidal rule may be used such as but not limited to left rectangular estimation right rectangular estimation etc. or some other suitable weighting function. Also other values may be used as an acoustic isolation value other than TCLw in some embodiments. That is an echo return energy may be used that is not the TCLw value but that provides a basis for comparison among two or more microphone and speaker combinations or two or more echo control profiles such that a combination echo control profile or both of these may be selected having comparatively better acoustic echo attenuation. In some embodiments a signature spectrum plot or array may be generated from an echo spectrum and this signature may be used to select an echo control profile in some embodiments.

While various embodiments have been illustrated and described it is to be understood that the invention is not so limited. Numerous modifications changes variations substitutions and equivalents will occur to those skilled in the art without departing from the scope of the present invention as defined by the appended claims.

