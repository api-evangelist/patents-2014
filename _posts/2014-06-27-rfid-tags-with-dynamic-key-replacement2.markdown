---

title: RFID tags with dynamic key replacement
abstract: A cryptographically-enabled RFID tag stores a primary secret key and derives secondary keys from the primary key. A secondary key may be derived by combining the primary key with one or more other parameters using one or more algorithms. The tag uses a derived secondary key to encrypt or electronically sign a tag response sent to a verifying entity. The verifying entity does not know the derived secondary key, but knows the tag primary key and the parameters and algorithms used to derive the secondary key and can derive all of the potential secondary keys. The verifying entity can then attempt to authenticate the tag or tag response by trying potential secondary keys.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09565022&OS=09565022&RS=09565022
owner: Impinj, Inc.
number: 09565022
owner_city: Seattle
owner_country: US
publication_date: 20140627
---
This application claims the benefit of U.S. Provisional Patent Application Ser. No. 61 842 319 filed on Jul. 2 2013. The disclosures of the above application are hereby incorporated by reference for all purposes.

Radio Frequency Identification RFID systems typically include RFID readers also known as RFID reader writers or RFID interrogators and RFID tags. RFID systems can be used in many ways for locating and identifying objects to which the tags are attached. RFID systems are useful in product related and service related industries for tracking objects being processed inventoried or handled. In such cases an RFID tag is usually attached to an individual item or to its package.

In principle RFID techniques entail using an RFID reader to inventory one or more RFID tags where inventorying involves at least singulating a tag and receiving an identifier from the singulated tag. Singulated is defined as a reader singling out one tag potentially from among multiple tags for a reader tag dialog. Identifier is defined as a number identifying the tag or the item to which the tag is attached such as a tag identifier TID electronic product code EPC etc. The reader transmitting a Radio Frequency RF wave performs the interrogation. The RF wave is typically electromagnetic at least in the far field. The RF wave can also be predominantly electric or magnetic in the near or transitional near field. The RF wave may encode one or more commands that instruct the tags to perform one or more actions.

In typical RFID systems an RFID reader transmits a modulated RF inventory signal a command receives a tag reply and transmits an RF acknowledgement signal responsive to the tag reply. A tag that senses the interrogating RF wave may respond by transmitting back another RF wave. The tag either generates the transmitted back RF wave originally or by reflecting back a portion of the interrogating RF wave in a process known as backscatter. Backscatter may take place in a number of ways.

The reflected back RF wave may encode data stored in the tag such as a number. The response is demodulated and decoded by the reader which thereby identifies counts or otherwise interacts with the associated item. The decoded data can denote a serial number a price a date a time a destination an encrypted message an electronic signature other attribute s any combination of attributes and so on. Accordingly when a reader receives tag data it can learn about the item that hosts the tag and or about the tag itself.

An RFID tag typically includes an antenna system a radio section a power management section and frequently a logical section a memory or both. In some RFID tags the logical section may include a cryptographic algorithm which in many instances relies on one or more passwords or keys stored in tag memory. In earlier RFID tags the power management section included an energy storage device such as a battery. RFID tags with an energy storage device are known as battery assisted semi active or active tags. Advances in semiconductor technology have miniaturized the electronics so much that an RFID tag can be powered solely by the RF signal it receives. Such RFID tags do not include an energy storage device such as a battery and are called passive tags. Of course even passive tags typically include temporary energy and data flag storage elements such as capacitors or inductors.

Counterfeiting is a problem in many areas of global commerce. Many RFID enabled applications need to verify the authenticity of the RFID tags readers and system components used in the application. For example a retailer receiving a shipment of tagged items often needs to determine whether the tags and by implication the items to which the tags are attached are genuine or counterfeit.

This summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended as an aid in determining the scope of the claimed subject matter.

Some embodiments are directed to RFID tags using derived secondary keys for interactions with other tags or readers. A cryptographically enabled RFID tag stores a primary secret key and derives secondary keys from the primary key. A secondary key may be derived by combining the primary key with one or more other parameters using one or more algorithms. The tag uses a derived secondary key to cryptographically secure i.e. encrypt or electronically sign a tag response sent to a verifying entity or to perform some cryptographic operation on the tag. The verifying entity does not know the derived secondary key but knows the tag primary key and the parameters and algorithms used to derive the secondary key and can derive all of the potential secondary keys. The verifying entity can then attempt to authenticate the tag or tag response by trying potential secondary keys.

Other embodiments are directed to RFID tags using stored secondary keys for interactions with other tags or readers. A cryptographically enabled RFID tag stores a number of secondary keys and selects one of the stored secondary keys to cryptographically secure a tag response sent to a verifying entity. The verifying entity does not know the specific secondary key used to cryptographically secure the tag response but knows the secondary keys stored at the tag. The verifying entity then attempts to authenticate the tag or tag response by trying potential secondary keys.

These and other features and advantages will be apparent from a reading of the following detailed description and a review of the associated drawings. It is to be understood that both the foregoing general description and the following detailed description are explanatory only and are not restrictive of aspects as claimed.

In the following detailed description references are made to the accompanying drawings that form a part hereof and in which are shown by way of illustration specific embodiments or examples. These embodiments or examples may be combined other aspects may be utilized and structural changes may be made without departing from the spirit or scope of the present disclosure. The following detailed description is therefore not to be taken in a limiting sense and the scope of the present invention is defined by the appended claims and their equivalents.

As used herein memory is one of ROM RAM SRAM DRAM NVM EEPROM FLASH Fuse MRAM FRAM and other similar information storage technologies as will be known to those skilled in the art. Some portions of memory may be writeable and some not. Command refers to a reader request for one or more tags to perform one or more actions and includes one or more tag instructions preceded by a command identifier or command code that identifies the command and or the tag instructions. Instruction refers to a request to a tag to perform a single explicit action e.g. write data into memory . Program refers to a request to a tag to perform a set or sequence of instructions e.g. read a value from memory and if the read value is less than a threshold then lock a memory word . Protocol refers to an industry standard for communications between a reader and a tag and vice versa such as the Class 1 Generation 2 UHF RFID Protocol for Communications at 860 MHz 960 MHz by GS1 EPCglobal Inc. Gen2 Specification versions 1.2.0 and 2.0 of which are hereby incorporated by reference.

In some applications RFID systems are called upon to ensure the authenticity of an item to which a tag is attached. In these systems a reader challenges the tag and asks the tag to prove that it is genuine and not counterfeit. If the tag is genuine then the item to which it is attached is presumed also to be genuine especially if the tag is embedded into or onto the item and is difficult to alter or remove. In this case the task of preventing an item from being counterfeited essentially becomes a task of preventing the tag that is attached to the item from being counterfeited.

Preventing a tag from itself being counterfeited is difficult. For example one way in which a tag can be counterfeited is by using a replay attack. In a replay attack a counterfeiter listens to the communications between a reader and a legitimate tag and creates a counterfeit tag that mimics or clones the legitimate tag s response. To prevent such cloning each time a reader challenges a tag both the reader and the tag should send different and unpredictable at least unpredictable by the counterfeiter messages. Typical cryptographic systems provide such unpredictability by having the reader send a different random challenge to the tag for each authentication and having the tag generate a different response for each random challenge. In many systems the tag also adds some of its own randomness to the challenge so as to further confound attacks. Many challenge response methods are known and applicable to this use case. Some challenge response methods use what are known as symmetric cryptographic algorithms such as the Advanced Encryption Standard AES . Others use what are known as asymmetric or public key cryptographic algorithms such as the Rivest Shamir Adleman RSA algorithm.

Regardless of whether an RFID system uses a symmetric or an asymmetric cryptographic algorithm each tag contains a stored secret also known as a secret key a private key or sometimes just a key. Symmetric algorithms typically denote the stored secret as a secret key . Asymmetric algorithms typically denote the stored secret as a private key . For symmetric algorithms the secret key is known to both the tag and any verifying authorities but not to a counterfeiter. For asymmetric algorithms only the tag knows its private key but the corresponding public key may be available to verifying authorities and to potential counterfeiters alike. In either case to authenticate a tag a random challenge is sent to the tag the tag uses its cryptographic algorithm to compute a response from the challenge and its stored secret the tag sends the response and an authority verifies the response by decrypting it using the tag s secret key symmetric algorithm or public key asymmetric algorithm U.S. patent application Ser. Nos. 12 155 057 13 308 123 13 396 889 and 13 441 285 filed on Jun. 7 2011 Nov. 30 2011 Feb. 15 2012 and Apr. 6 2012 respectively describe such authentication methods and are hereby incorporated by reference in their entireties.

In some cases a tag may further protect its secret key from disclosure by using secondary keys for actual cryptographic interactions. The secondary keys may be generated from or be otherwise associated with the secret key and different secondary keys may be used for different cryptographic interactions. Using these secondary keys in cryptographic interactions provides an additional layer of protection for the secret key since the replacement secondary keys can be used and changed more frequently than an underlying secret key.

A verifying entity e.g. a reader a computer or server coupled to the reader an authority another tag or some other entity that attempts to verify a message secured with a secondary key may not know the exact identity of the secondary key. However the verifying entity knows the tag s secret key and how the tag generates secondary keys from the secret key. Accordingly the verifying entity can generate a set of potential secondary keys which includes the correct secondary key and a number of decoy secondary keys and attempt to verify the message using each of the potential keys.

Reader and tag communicate via signals and . When communicating each encodes modulates and transmits data to the other and each receives demodulates and decodes data from the other. The data can be modulated onto and demodulated from RF waveforms. The RF waveforms are typically in a suitable range of frequencies such as those near 900 MHz 13.56 MHz and so on.

The communication between reader and tag uses symbols also called RFID symbols. A symbol can be a delimiter a calibration value and so on. Symbols can be implemented for exchanging binary data such as 0 and 1 if that is desired. When symbols are processed by reader and tag they can be treated as values numbers and so on.

Tag can be a passive tag or an active or battery assisted tag i.e. a tag having its own power source . When tag is a passive tag it is powered from signal .

Tag is typically although not necessarily formed on a substantially planar inlay which can be made in many ways known in the art. Tag includes a circuit which may be implemented as an IC . In some embodiments IC is implemented in complementary metal oxide semiconductor CMOS technology. In other embodiments IC may be implemented in other technologies such as bipolar junction transistor BJT technology metal semiconductor field effect transistor MESFET technology and others as will be well known to those skilled in the art. IC is arranged on inlay .

Tag also includes an antenna for exchanging wireless signals with its environment. The antenna is often flat and attached to inlay . IC is electrically coupled to the antenna via suitable IC contacts not shown in . The term electrically coupled as used herein may mean a direct electrical connection or it may mean a connection that includes one or more intervening circuit blocks elements or devices. The electrical part of the term electrically coupled as used in this document shall mean a coupling that is one or more of ohmic galvanic capacitive and or inductive. Similarly the term electrically isolated as used herein means that electrical coupling of one or more types e.g. galvanic capacitive and or inductive is not present at least to the extent possible. For example elements that are electrically isolated from each other are galvanically isolated from each other capacitively isolated from each other and or inductively isolated from each other. Of course electrically isolated components will generally have some unavoidable stray capacitive or inductive coupling between them but the intent of the isolation is to minimize this stray coupling to a negligible level when compared with an electrically coupled path.

IC is shown with a single antenna port comprising two IC contacts electrically coupled to two antenna segments and which are shown here forming a dipole. Many other embodiments are possible using any number of ports contacts antennas and or antenna segments.

Diagram depicts top and side views of tag formed using a strap. Tag differs from tag in that it includes a substantially planar strap substrate having strap contacts and . IC is mounted on strap substrate such that the IC contacts on IC electrically couple to strap contacts and via suitable connections not shown . Strap substrate is then placed on inlay such that strap contacts and electrically couple to antenna segments and . Strap substrate may be affixed to inlay via pressing an interface layer one or more adhesives or any other suitable means.

Diagram depicts a side view of an alternative way to place strap substrate onto inlay . Instead of strap substrate s surface including strap contacts facing the surface of inlay strap substrate is placed with its strap contacts facing away from the surface of inlay . Strap contacts can then be either capacitively coupled to antenna segments through strap substrate or conductively coupled using a through via which may be formed by crimping strap contacts to antenna segments . In some embodiments the positions of strap substrate and inlay may be reversed with strap substrate mounted beneath strap substrate and strap contacts electrically coupled to antenna segments through inlay . Of course in yet other embodiments strap contacts may electrically couple to antenna segments through both inlay and strap substrate .

In operation the antenna receives a signal and communicates it to IC which both harvests power and responds if appropriate based on the incoming signal and the IC s internal state. If IC uses backscatter modulation then it responds by modulating the antenna s reflectance which generates response signal from signal transmitted by the reader. Electrically coupling and uncoupling the IC contacts of IC can modulate the antenna s reflectance as can varying the admittance of a shunt connected circuit element which is coupled to the IC contacts. Varying the impedance of a series connected circuit element is another means of modulating the antenna s reflectance.

In the embodiments of antenna segments and are separate from IC . In other embodiments the antenna segments may alternatively be formed on IC . Tag antennas according to embodiments may be designed in any form and are not limited to dipoles. For example the tag antenna may be a patch a slot a loop a coil a horn a spiral a monopole microstrip stripline or any other suitable antenna.

The components of the RFID system of may communicate with each other in any number of modes. One such mode is called full duplex. Another such mode is called half duplex and is described below.

RFID reader and RFID tag talk and listen to each other by taking turns. As seen on axis TIME when reader talks to tag the communication session is designated as R T and when tag talks to reader the communication session is designated as T R . Along the TIME axis a sample R T communication session occurs during a time interval and a following sample T R communication session occurs during a time interval . Of course interval is typically of a different duration than interval here the durations are shown approximately equal only for purposes of illustration.

According to blocks and RFID reader talks during interval and listens during interval . According to blocks and RFID tag listens while reader talks during interval and talks while reader listens during interval .

In terms of actual behavior during interval reader talks to tag as follows. According to block reader transmits signal which was first described in . At the same time according to block tag receives signal and processes it to extract data and so on. Meanwhile according to block tag does not backscatter with its antenna and according to block reader has no signal to receive from tag .

During interval tag talks to reader as follows. According to block reader transmits a Continuous Wave CW signal which can be thought of as a carrier that typically encodes no information. This CW signal serves both to transfer energy to tag for its own internal power needs and also as a carrier that tag can modulate with its backscatter. Indeed during interval according to block tag does not receive a signal for processing. Instead according to block tag modulates the CW emitted according to block so as to generate backscatter signal . Concurrently according to block reader receives backscatter signal and processes it.

Circuit shows two IC contacts suitable for coupling to antenna segments such as antenna segments of RFID tag of . When two IC contacts form the signal input from and signal return to an antenna they are often referred to as an antenna port. IC contacts may be made in any suitable way such as from metallic pads and so on. In some embodiments circuit uses more than two IC contacts especially when tag has more than one antenna port and or more than one antenna.

Circuit includes signal routing section which may include signal wiring signal routing busses receive transmit switches and so on that can route a signal to the components of circuit . In some embodiments IC contacts couple galvanically and or inductively to signal routing section . In other embodiments such as is shown in circuit includes optional capacitors and or which if present capacitively couple IC contacts to signal routing section . This capacitive coupling causes IC contacts to be galvanically decoupled from signal routing section and other circuit components.

Capacitive coupling and resultant galvanic decoupling between IC contacts and or and components of circuit is desirable in certain situations. For example in some RFID tag embodiments IC contacts and may galvanically connect to terminals of a tuning loop on the tag. In this situation capacitors and or galvanically decouple IC contact from IC contact thereby preventing the formation of a short circuit between the IC contacts through the tuning loop.

Capacitors may be implemented within circuit and or partly or completely external to circuit . For example a dielectric or insulating layer on the surface of the IC containing circuit may serve as the dielectric in capacitor and or capacitor . As another example a dielectric or insulating layer on the surface of a tag substrate e.g. inlay or strap substrate may serve as the dielectric in capacitors . Metallic or conductive layers positioned on both sides of the dielectric layer i.e. between the dielectric layer and the IC and between the dielectric layer and the tag substrate may then serve as terminals of the capacitors . The conductive layers may include IC contacts e.g. IC contacts antenna segments e.g. antenna segments or any other suitable conductive layers.

Circuit also includes a rectifier and PMU Power Management Unit that harvests energy from the RF signal received by antenna segments to power the circuits of IC during either or both reader to tag R T and tag to reader T R sessions. Rectifier and PMU may be implemented in any way known in the art.

Circuit additionally includes a demodulator that demodulates the RF signal received via IC contacts . Demodulator may be implemented in any way known in the art for example including a slicer an amplifier and so on.

Circuit further includes a processing block that receives the output from demodulator and performs operations such as command decoding memory interfacing and so on. In addition processing block may generate an output signal for transmission. Processing block may be implemented in any way known in the art for example by combinations of one or more of a processor memory decoder encoder and so on.

Circuit additionally includes a modulator that modulates an output signal generated by processing block . The modulated signal is transmitted by driving IC contacts and therefore driving the load presented by the coupled antenna segment or segments. Modulator may be implemented in any way known in the art for example including a switch driver amplifier and so on.

In one embodiment demodulator and modulator may be combined in a single transceiver circuit. In another embodiment modulator may modulate a signal using backscatter. In another embodiment modulator may include an active transmitter. In yet other embodiments demodulator and modulator may be part of processing block .

Circuit additionally includes a memory to store data . At least a portion of memory is preferably implemented as a Nonvolatile Memory NVM which means that data is retained even when circuit does not have power as is frequently the case for a passive RFID tag.

In some embodiments particularly in those with more than one antenna port circuit may contain multiple demodulators rectifiers PMUs modulators processing blocks and or memories.

In terms of processing a signal circuit operates differently during a R T session and a T R session. The different operations are described below in this case with circuit representing an IC of an RFID tag.

Version A shows as relatively obscured those components that do not play a part in processing a signal during a R T session. Rectifier and PMU may be active such as for converting RF power. Modulator generally does not transmit during a R T session and typically does not interact with the received RF signal significantly either because switching action in section of decouples modulator from the RF signal or by designing modulator to have a suitable impedance and so on.

Although modulator is typically inactive during a R T session it need not be so. For example during a R T session modulator could be adjusting its own parameters for operation in a future session and so on.

Version B shows as relatively obscured those components that do not play a part in processing a signal during a T R session. Rectifier and PMU may be active such as for converting RF power. Demodulator generally does not receive during a T R session and typically does not interact with the transmitted RF signal significantly either because switching action in section of decouples demodulator from the RF signal or by designing demodulator to have a suitable impedance and so on.

Although demodulator is typically inactive during a T R session it need not be so. For example during a T R session demodulator could be adjusting its own parameters for operation in a future session and so on.

In typical embodiments demodulator and modulator are operable to demodulate and modulate signals according to a protocol such as the Gen2 Specification mentioned above. In embodiments where circuit includes multiple demodulators and or modulators each may be configured to support different protocols or different sets of protocols. A protocol specifies in part symbol encodings and may include a set of modulations rates timings or any other parameter associated with data communications. In addition a protocol can be a variant of a stated specification such as the Gen2 Specification for example including fewer or additional commands than the stated specification calls for and so on. In such instances additional commands are sometimes called custom commands.

Local block is responsible for communicating with the tags. Local block includes a block of an antenna and its driver. Some readers like that shown in local block contain a single antenna and driver. Some readers contain multiple antennas and or drivers and a method to switch signals among them including sometimes using different antennas for transmitting and for receiving. Some readers contain multiple antennas and drivers that operate simultaneously. A demodulator decoder block demodulates and decodes waves received from the tags via antenna driver block . Modulator encoder block encodes and modulates an RF wave to be transmitted to the tags via antenna driver block .

Local block additionally includes an optional local processor . Local processor may be implemented in any number of ways known in the art. Such ways include by way of examples and not of limitation digital and or analog processors such as microprocessors and digital signal processors DSPs controllers such as microcontrollers software running in a machine such as a general purpose computer programmable circuits such as Field Programmable Gate Arrays FPGAs Field Programmable Analog Arrays FPAAs Programmable Logic Devices PLDs Application Specific Integrated Circuits ASIC any combination of one or more of these and so on. In some cases some or all of the decoding function in block the encoding function in block or both may be performed instead by local processor . In some cases local processor may implement an encryption or authorization function in some cases one or more of these functions can be distributed among other blocks such as encoding block or may be entirely incorporated in another block.

Local block additionally includes an optional local memory . Local memory may be implemented in any number of ways known in the art including by way of example and not of limitation any of the memory types described above as well as any combination thereof. Local memory can be implemented separately from local processor or in an IC with local processor with or without other components. Local memory if provided can store programs for local processor to run if needed.

In some embodiments local memory stores data read from tags or data to be written to tags such as Electronic Product Codes EPCs Tag Identifiers TIDs and other data. Local memory can also include reference data that is to be compared to the EPC or TID codes instructions and or rules for how to encode commands for the tags modes for controlling antenna secret keys key pairs and so on. In some of these embodiments local memory is provided as a database.

Some components of local block typically treat the data as analog such as the antenna driver block . Other components such as local memory typically treat the data as digital. At some point there is a conversion between analog and digital. Based on where this conversion occurs a reader may be characterized as analog or digital but most readers contain a mix of analog and digital functionality.

If remote components are provided they are coupled to local block via an electronic communications network . Network can be a Local Area Network LAN a Metropolitan Area Network MAN a Wide Area Network WAN a network of networks such as the internet or a local communication link such as a USB PCI and so on. Local block may include a local network connection for communicating with communications network . Communications on the network can be secure such as if they are encrypted or physically protected or insecure if they are not encrypted or otherwise protected.

There can be one or more remote component s . If more than one they can be located at the same location or in different locations. They can communicate with each other and with local block via communications network or via other similar networks using remote network connection s . Only one such connection is shown which is similar to local network connection .

Remote component s can also include a remote processor . Remote processor can be made in any way known in the art such as was described with reference to local processor . Remote processor may also implement an encryption function similar to local processor .

Remote component s can also include a remote memory . Remote memory can be made in any way known in the art such as was described with reference to local memory . Remote memory may include a local database or a different database of a standards organization such as one that can reference EPCs. Remote memory may also contain information associated with commands tag profiles secret keys or the like similar to local memory .

Of the above described elements it may be advantageous to consider a combination of these components designated as operational processing block . Operational processing block includes those components that are provided of the following local processor remote processor local network connection remote network connection and by extension an applicable portion of communications network that links remote network connection with local network connection . The portion can be dynamically changeable etc. In addition operational processing block can receive and decode RF waves received via antenna and cause antenna to transmit RF waves according to what it has processed.

Operational processing block includes either local processor or remote processor or both. If both are provided remote processor can be made such that it operates in a way complementary with that of local processor . In fact the two can cooperate. It will be appreciated that operational processing block as defined this way is in communication with both local memory and remote memory if both are present.

Accordingly operational processing block is location independent in that its functions can be implemented either by local processor or by remote processor or by a combination of both. Some of these functions are preferably implemented by local processor and some by remote processor . Operational processing block accesses local memory or remote memory or both for storing and or retrieving data.

RFID reader system operates by operational processing block generating communications for RFID tags. These communications are ultimately transmitted by antenna block with modulator encoder block encoding and modulating the information on an RF wave. Then data is received from the tags via antenna block demodulated and decoded by demodulator decoder block and processed by processing operational processing block .

Embodiments of an RFID reader system can be implemented as hardware software firmware or any combination. It is advantageous to consider such a system as subdivided into components or modules. A person skilled in the art will recognize that some of these components or modules can be implemented as hardware some as software some as firmware and some as a combination. An example of such a subdivision is now described together with the RFID tag as an additional module.

An RFID tag is considered here as a module by itself. RFID tag conducts a wireless communication with the remainder via air interface . It is noteworthy that air interface is only a boundary in that signals or data that pass through it are not intended to be transformed from one thing to another. Protocols as to how readers and tags are to communicate with each other for example the Gen2 Specification also properly characterize that boundary as an interface.

RFID system includes one or more reader antennas and an RF front end module for interfacing with reader antenna s . These can be made as described above.

RFID system also includes a signal processing module . In one embodiment signal processing module exchanges waveforms with RF front end module such as I and Q waveform pairs.

RFID system also includes a physical driver module which is also known as a data link module. In some embodiments physical driver module exchanges data with signal processing module . Physical driver module can be the stage associated with the framing of data.

RFID system additionally includes a media access control module . In one embodiment media access control module exchanges data packets with physical driver module . Media access control module can make decisions for sharing the medium of wireless communication which in this case is the air interface.

RFID system moreover includes an application programming library module . This module can include application programming interfaces APIs other objects etc.

All of these RFID system functionalities can be supported by one or more processors. One of these processors can be considered a host processor. Such a host processor might include a host operating system OS and or central processing unit CPU as in module . In some embodiments the processor is not considered as a separate module but one that includes some of the above mentioned modules of RFID system . In some embodiments the one or more processors may perform operations associated with retrieving identification data from a tag challenging the tag and verifying the tag response through interaction with a verifying authority. In some embodiments the one or more processors may verify an electronic signature create a tag challenge and verify a tag response.

User interface module may be coupled to application programming library module for accessing the APIs. User interface module can be manual automatic or both and can be supported by the host OS CPU module mentioned above or by a separate processor etc.

It will be observed that the modules of RFID system form a chain. Adjacent modules in the chain can be coupled by appropriate instrumentalities for exchanging signals. These instrumentalities include conductors buses interfaces and so on. These instrumentalities can be local e.g. to connect modules that are physically close to each other or over a network for remote communication.

The chain is used in one direction for transmitting RFID waveforms and in the other direction for receiving RFID waveforms. In transmitting mode waveform initiation can be in any one of the modules. Ultimately signals are routed to reader antenna s to be transmitted as wireless waves. In receiving mode reader antenna s receives wireless waves which are in turn processed successively by the various modules in the chain. Processing can terminate in any one of the modules.

The architecture of RFID system is presented for purposes of explanation and not of limitation. Its particular subdivision into modules need not be followed for creating embodiments. Furthermore the features of the present disclosure can be performed either within a single one of the modules or by a combination of them.

As mentioned previously embodiments are directed to providing secure records of RFID tag interactions using a verification tag to authenticate RFID tag interactions and or using a verification tag to authorize RFID tag operations. Embodiments additionally include programs and methods of operation of the programs. A program is generally defined as a group of steps or operations leading to a desired result due to the nature of the elements in the steps and their sequence. A program is often implemented as a sequence of steps or operations for a processor.

Performing the steps instructions or operations of a program requires manipulating physical quantities. Usually though not necessarily these quantities may be transferred combined compared and otherwise manipulated or processed according to the steps or instructions and they may also be stored in a computer readable medium. These quantities include for example electrical magnetic and electromagnetic charges or particles states of matter and in the more general case can include the states of any physical devices or elements. It is convenient at times principally for reasons of common usage to refer to information represented by the states of these quantities as bits data bits samples values symbols characters terms numbers or the like. It should be borne in mind however that all of these and similar terms are associated with the appropriate physical quantities and that these terms are merely convenient labels applied to these physical quantities individually or in groups.

Embodiments furthermore include storage media. Such media individually or in combination with others have stored thereon instructions data keys signatures and other data of a program made according to embodiments. A storage medium according to embodiments is a computer readable medium such as a memory and is read by a processor of the type mentioned above. The storage medium can be implemented in any number of ways known in the art including by way of example and not of limitation any of the memory types described above as well as any combination thereof.

Even though it is said that the program may be stored in a computer readable medium it should be clear to a person skilled in the art that it need not be a single memory or even a single machine. Various portions modules or features of it may reside in separate memories or even separate machines. The separate machines may be connected directly or through a network such as a local access network LAN or a global network such as the Internet. Often for the sake of convenience only it is desirable to implement and describe a program as software. The software can be unitary or thought of in terms of various interconnected distinct software modules.

The interactions between reader and tag in diagram begin with an optional tag subpopulation selection where the reader selects one or more tags from a tag population for inventorying and or authentication. For example the reader may broadcast a selection command that includes one or more criteria to the tag population. The criteria in the selection command may include one or more tag flag values at least a portion of a tag identifier and or at least a portion of other data that can be stored on tags. Tags in the population that meet the one or more criteria for example having tag flag values and or stored data that match the tag flag value s and or data specified in the selection command may be considered as selected . In some embodiments the selection command may be the Select command of the Gen2 Specification.

Reader then performs an inventory to singulate an individual tag from the tag population or from within a subpopulation of selected tags if the reader performed optional tag selection . In some embodiments the reader performs the inventory according to the Query ACK sequence described in the Gen2 Specification. In the Gen2 Query ACK sequence a reader first transmits a Query QueryAdj QueryRep command. A tag that meets the criteria for responding may then reply with a 16 bit random pseudorandom number RN16 0. Upon receipt of the RN16 0 the reader transmits an Acknowledge command ACK with the RN16 0 to the tag which may then respond with its EPC.

After performing the inventory the reader then performs an access in order to access and read tag information from the tag singulated in inventory . The tag may store and the reader may access an identifier ID which may be the tag s EPC or another tag identifier and optionally one or more other parameters such as a tag random number. The reader may begin the access by transmitting a REQ RN command with the RN16 0 received in inventory which requests a new random pseudorandom number from the tag for use as a tag handle. The tag then responds with a RN16 1 handle. The reader then transmits a read request to read the optional ID and or any other optional parameters. Upon receiving the read command sent by the reader the tag transmits the requested information to the reader.

The reader then challenges the tag in an authentication step . In the authentication step the reader may first optionally request a tag random number RN TAG from the tag which may be used to enhance the security of authentication step . RN TAG may have been previously stored in the tag generated in situ or generated in situ and then stored in the tag. In some embodiments the tag may generate RN TAG using its TKEY or by reading a tag random number that was previously stored in tag memory. After generating RN TAG the tag transmits it to the reader. The tag may encrypt the RN TAG before transmission. In some embodiments the tag may generate an initial value IV based on RN TAG and TKEY and transmit the IV to the reader in addition to or instead of RN TAG.

The reader then transmits a challenge to the tag. A challenge is a message that contains a random number which may be encrypted and one or more cryptographic parameters. The challenge instructs a receiving entity such as a tag or reader to determine a cryptographic response based on the random number the cryptographic parameter s and entity information such as an entity key an entity identifier or any other suitable entity information. The receiving entity may itself compute the cryptographic response using a cryptographic algorithm or may have another entity compute and provide the cryptographic response to the receiving entity. The challenge may be determined based on the random number and or a tag random number. A challenge may originate from another tag a reader or some other entity. In the situation described in diagram the challenge originates from the reader includes reader random number RN RDR and may also include the RN TAG or IV if used . Upon receiving the challenge the tag computes a response to the challenge based on the RN RDR the TKEY other cryptographic parameters included in the challenge the RN TAG or IV the tag handle RN16 1 another tag random number such as the RN16 0 and or any other suitable parameter. In some embodiments the tag may use a tag random number different from the RN TAG originally sent to the reader to generate the response. For example the tag random number used to generate the response may be derived from RN TAG based on some algorithm or may be entirely independent of RN TAG. The tag then sends the computed response to the reader. At this point the reader may be able to verify the tag s response using the RN RDR the RN TAG IV and or any other previously received or known parameter. For example the reader may itself verify the tag s response or the reader may send the challenge the received tag response and other information to a verification authority for verification. Some challenge response variants do not use a tag random number or IV others may include a command count or a message authentication code others may include the reader encrypting the random number in the reader tag challenge and yet others may include fewer or more steps than shown.

As described above embodiments include different orderings of interactions between reader and tag. For example in some embodiments the reader sends a challenge during tag selection preceding the access and the tag computes its response and stores the response in memory for subsequent reading by a reader. The tag s computation may also include a tag random number e.g. RN TAG an IV the tag handle and or RN16 0 and the tag may store the tag random number for subsequent access by the reader. Indeed in embodiments where the challenge occurs during tag selection and reading the response occurs during tag access authentication need not exist because its operations have been spread among select and access . One reason a reader may choose to send the challenge with select is for multiple tags to hear the challenge and compute their cryptographic responses in parallel. Because cryptographic computations can be time intensive enabling multiple tags to compute their responses in parallel allows more rapid authentication of a population of tags. In some embodiments the challenge itself may be sent to multiple tags simultaneously separately from select . In some embodiments a challenge that is transmitted to an individual tag may be an Authenticate command of the Gen2 Specification and a challenge that is broadcast to multiple tags may be a Challenge command of the Gen2 Specification.

As mentioned above the commands and signals in sequence do not have to be performed in the particular order shown or even grouped as shown. The commands and signals may be separated combined or interspersed among each other. For example an interrogated tag may transmit its tag ID with its response to a reader challenge instead of providing its tag ID in inventory or access . The tag may transmit its tag ID with its response as consecutive messages or may concatenate the response with the tag ID for example by prepending the response with the tag ID appending the tag ID to the tag response or otherwise combining the tag ID and the response in the same message. As another example the reader may send the request for the tag random number during the optional tag selection . Because the select signal in tag selection is broadcast to a population of tags multiple tags may receive the reader s tag random number request. In response each tag that receives the tag random number request may generate its own tag random number and then store the tag random number in tag memory. The reader may then subsequently read each tag e.g. in access to retrieve the stored tag random number.

In some embodiments the reader sends a challenge during tag selection preceding the access and the tag computes its response and stores the response in memory for subsequent reading by a reader. The tag s computation may also include a tag random number e.g. RN TAG an IV the tag handle and or RN16 0 and the tag may store the tag random number for subsequent access by the reader. Indeed in embodiments where the challenge occurs during tag selection and reading the response occurs during tag access authentication need not exist because its operations have been spread among select and access .

A reader may choose to broadcast the tag random number request and or the challenge to multiple tags in the optional select in order to allow all of the tags that hear the broadcast to simultaneously generate their tag random number and compute their responses. In contrast to the authenticate step where each tag generates its tag random number and challenge response serially i.e. one tag after another enabling multiple tags to perform these operations in parallel is faster. Due to the time intensive nature of the cryptographic computations involved in generating tag random numbers or challenge responses the time saved by allowing tags to compute in parallel instead of serially can be substantial. In some embodiments the challenge itself may be sent to multiple tags simultaneously separately from select . In some embodiments a challenge that is transmitted to an individual tag may be an Authenticate command of the Gen2 Specification and a challenge that is broadcast to multiple tags may be a Challenge command of the Gen2 Specification.

Whereas authenticate step in sequence includes a tag random number in some embodiments step may not use or include a tag random number. In some embodiments a tag authentication may include a command count e.g. a count from the reader indicating the number of commands it has transmitted or a count from the tag indicating the number of commands it has received and or an electronic signature. Other authentication steps may include more or fewer steps than the particular authenticate step shown in sequence .

As described above a cryptographically enabled RFID tag may use secondary keys when interacting with other readers or tags. For example a tag that stores multiple primary or secondary keys may select one of the primary or secondary keys for use during communications with a reader or other tag. As another example a tag may generate different secondary keys based on a primary tag key known to or stored at the tag.

Subsequently in step the tag computes a secondary key K based on a number of parameters. For example K may be computed from the tag primary key K the message C received in step the tag random number R generated in step a counter value from a tag counter a tag state and or any other suitable parameter or value. The secondary key K may be computed from the parameters based on any suitable algorithm. For example K may be computed using bitwise operations e.g. logical NOT AND OR XOR or any other suitable bitwise operation to combine the different parameters. Of course other algorithms or operations such as arithmetic or logical algorithms or operations may be used. In some embodiments different algorithms may be applied to one or more of the different parameters before being used to compute K . For example a given parameter may be truncated extended subject to a bitwise operation subject to a bit shift operation or otherwise adjusted. However a parameter does not need to be adjusted and in some embodiments a tag may use a parameter as is or apply an identity function to the parameter that leaves it unchanged. In some embodiments the computation of K may be reversible and or computationally lightweight but in other embodiments the K computation process may be irreversible and or computationally difficult. For example reversible computationally lightweight computations may include the bitwise operations previously described and irreversible computationally difficult computations may include using a hash function or other cryptographic operation to derive K .

Once K has been computed in step in step the tag forms a cryptographically secured tag response using K . A cryptographically secured tag response is a tag response that is encrypted and or electronically signed. The tag may form the cryptographically secured tag response by first computing a tag response and then encrypting and or electronically signing the tag response using K and one or more appropriate cryptographic algorithms. Further the tag response itself may be computed using a cryptographic operation and the primary or secondary key. Cryptographic algorithms that may be used include symmetric key algorithms e.g. Digital Encryption Standard DES or Advanced Encryption Standard AES asymmetric key algorithms e.g. Rivest Shamir Adleman RSA stream ciphers block ciphers or any other suitable algorithm. The tag may electronically sign the tag response by computing and attaching an electronic signature to the tag response. Electronic signatures are cryptographic structures used to verify that a particular signed message in this case the tag response originated from a particular source and has not been altered. The sender of a signed message generates an electronic signature based on a sender key and the original message and signs the message by attaching the signature. A message recipient can then cryptographically process the attached signature to determine whether it corresponds to the received message. If so the message may be presumed authentic and if not the message may be presumed counterfeit. Electronic signatures may include digital signatures generated via asymmetric cryptographic techniques and or message authentication codes generated via symmetric cryptographic techniques.

In some embodiments the tag includes some of the parameters used to compute K in the tag response. For example the tag may include the message C or parameter s included in the message C the tag random number R the counter value if used or any other parameter used to compute K in step . In other embodiments the tag may not include any of the parameters used to compute K in the tag response or may only include characteristics associated with the parameters used to compute K but not the actual parameters. For example the tag may include the length of a random number used to compute K but not the actual random number. Finally in step the tag sends the cryptographically secured tag response to the verifying entity or to the relaying entity.

The tag may store the computed K in memory as described below in for future use or reference. In other embodiments the tag may not store the computed K in memory and instead discard K after using it to form a cryptographically secured tag response. In such embodiments the tag may compute K and immediately use it to form a cryptographically secured tag response without storing K . In other embodiments the tag may replace the primary key K with the computed secondary key K by overwriting K with K in memory. The tag may use different secondary keys to cryptographically secure different responses. For example the tag may use a first K to cryptographically secure a first response and may use a second different K to cryptographically secure a second different response. The tag may also or instead change the secondary key used based on the verifying entity type of message type of response environmental parameters e.g. time RF noise reader density operating region etc. or any other suitable criterion.

In some embodiments a tag may store a number of primary keys and the secondary key K may be derived or selected from one or more of the stored primary keys. For example the exact primary key s used to derive K may be based on the tag random number R. The selected primary key or combination of primary keys may then be used as K or may be used in the computation of K as described above. In some embodiments a computed secondary key K or some value derived from a computed secondary key K may replace its corresponding primary key K.

In some embodiments as described above the tag may further adjust one or more of the parameters used to compute the secondary key. In these embodiments the verifying entity may also know the parameters that have been adjusted and or the algorithms used by the tag to adjust the parameters and can therefore compute all of the potential secondary keys the tag could have used to cryptographically secure the tag response. For example the tag may generate a relatively short random number concatenate copies of the random number together to form a longer R of arbitrary length and use the longer R to compute the secondary key. This may limit the number of potential secondary keys the verifying entity computes while further obscuring any relation between the replacement secondary key and the primary key.

As another example a tag may use the value of a tag counter to compute the secondary key in addition to the primary key K the message C and or the tag random number R . The tag counter may count the number of tag authentication attempts and may be synchronized with a corresponding counter stored by the verifying entity. When the verifying entity attempts to process i.e. verify or decrypt a response from the tag it may generate a number of potential secondary keys based on the counter value at the verifying entity and some values surrounding the counter value to account for legitimate failed authentications . In other embodiments the counter value may be included in the tag response instead of or in addition to being used to compute the secondary key.

After the potential secondary keys have been computed in step the verifying entity may then attempt to process the cryptographically secured tag response in step by iterating through the computed potential secondary keys. If the verifying entity succeeds in processing the tag response with a computed secondary key in step thereby recovering a processed tag response in step the verifying entity may compare the parameters it used to compute the secondary key with parameters also known as verification values included in the processed tag response. For example as described above in reference to step in a tag may include parameters used to generate K e.g. message C tag random number R etc. in a tag response before cryptographically securing the tag response using K . Upon processing the cryptographically secured tag response the verifying entity may compare the parameters it used to generate the secondary key with verification values in the processed tag response. If the parameters correspond to the verification values then the verifying entity may consider the tag authentic. If the parameters do not correspond to the verification values then the verifying entity may consider the tag suspect. Similarly if the verifying entity fails to process the tag response in step it may also consider the tag suspect.

In some embodiments if a tag counter value was used to compute the secondary key or otherwise included in the tag response the tag counter value may be compared with the value of the synchronized counter at the verifying entity. If the values are not sufficiently close then the verifying entity may conclude that the tag was previously attacked by being forced to repeatedly perform authentication causing its counter to increment but not causing the synchronized counter at the reader to increment .

The steps described in processes and are for illustrative purposes only. RFID cryptographic interactions using dynamic keys may be implemented using additional or fewer steps and in different orders using the principles described herein.

In another embodiment a tag may store a number of secondary keys instead of determining secondary keys from a primary key. In this embodiment a tag may select a secondary key from its multiple stored secondary keys to use in cryptographically securing a message to a verifying entity such as a reader a tag or any other suitable verifying entity. The verifying entity does not know the specific secondary key used to cryptographically secure the message but does know the secondary keys stored at the tag. The verifying entity can therefore iterate through the secondary keys known to be stored at the tag to attempt to authenticate the cryptographically secured message. If the message is authenticated then the verifying entity may consider the message and or the originating tag authentic. If the verifying entity cannot authenticate the message after all the secondary keys have been tried it may consider the message and or the originating tag suspect.

Tag memory may be partitioned into an externally readable portion and an externally unreadable portion . Data stored in the externally readable portion may be accessed by external devices e.g. readers by default and include relatively public information such as ID . In contrast data stored in the externally unreadable portion by default may not be accessible to external devices. Such data may include sensitive information such as the tag secret key TKEY .

As mentioned above tag may store or be able to dynamically generate secondary keys to use in cryptographic operations. In some embodiments the secondary keys may be generated based on a random number RN and or the value of a counter . RN and or counter may be stored or implemented in memory or elsewhere. For example counter may be implemented on tag registers e.g. linear feedback shift registers separate from tag memory . The secondary keys may be generated and used without being stored in tag memory or may be generated and stored in tag memory as SKEY .

In some embodiments SKEY RN and or counter if present may be stored in the externally unreadable portion and therefore not publicly accessible. In other embodiments RN and or counter may instead be stored in externally readable portion or be otherwise publicly accessible.

Tag memory portion as with memory portion is configured to store ID similar to ID in and be readable by an external device such as a reader. Similarly tag memory portion is akin to memory portion in that it is configured to store sensitive data and usually is unreadable by an external device. For example tag memory portion may store tag key e.g. TKEY one or more secondary keys e.g. SKEY a tag random number e.g. RN and or a counter e.g. counter . In some embodiments ID TKEY SKEY RN and or counter may be encrypted.

In some embodiments one or more memory portions may be configured to be unwriteable write locked to prevent an external device from writing to the memory portions and potentially overwriting and damaging already written data. For example tag memory portion may be write locked to prevent damage to or loss of the ID . Similarly tag memory portion may be write locked to prevent an external device from damaging TKEY SKEY RN and or counter if present. In some embodiments a tag memory portion that is write locked may still be written to by the tag itself. For example while tag memory portion may be write locked to prevent an external device from modifying SKEY RN and or counter the tag itself may still be able to modify update or delete SKEY RN and counter . In other embodiments an authorized reader may be able to modify data in write locked memory portions and may be able to update adjust delete or add to the stored identifiers keys and other data.

In some embodiments an authorized entity such as a tag manufacturer may write data into tag memory portions before rendering the memory portions unwriteable or may write data in some other way e.g. via direct physical access to the memory portions . For example a tag manufacturer may generate ID and write it into tag memory portion when the tag was manufactured or soon afterward. Similarly the tag manufacturer may write TKEY into tag memory portion either at the same time as ID or at some other time. Alternatively the tag supplier verifying authority or even another entity can perform the writing.

The foregoing detailed description has set forth various embodiments of the devices and or processes via the use of block diagrams and or examples. Insofar as such block diagrams and or examples contain one or more functions and or aspects it will be understood by those within the art that each function and or aspect within such block diagrams or examples may be implemented according to embodiments formed individually and or collectively by a wide range of hardware software firmware or virtually any combination thereof.

The present disclosure is not to be limited in terms of the particular embodiments described in this application which are intended as illustrations of various aspects. Many modifications and variations can be made without departing from its spirit and scope as will be apparent to those skilled in the art. Functionally equivalent methods and apparatuses within the scope of the disclosure in addition to those enumerated herein will be apparent to those skilled in the art from the foregoing descriptions. Such modifications and variations are intended to fall within the scope of the appended claims. The present disclosure is to be limited only by the terms of the appended claims along with the full scope of equivalents to which such claims are entitled. It is to be understood that this disclosure is not limited to particular methods configurations antennas transmission lines and the like which can of course vary. It is also to be understood that the terminology used herein is for the purpose of describing particular embodiments only and is not intended to be limiting.

With respect to the use of substantially any plural and or singular terms herein those having skill in the art can translate from the plural to the singular and or from the singular to the plural as is appropriate to the context and or application. The various singular plural permutations may be expressly set forth herein for sake of clarity.

It will be understood by those within the art that in general terms used herein and especially in the appended claims e.g. bodies of the appended claims are generally intended as open terms e.g. the term including should be interpreted as including but not limited to the term having should be interpreted as having at least the term includes should be interpreted as includes but is not limited to etc. . It will be further understood that if a specific number of an introduced claim recitation is intended such an intent will be explicitly recited in the claim and in the absence of such recitation no such intent is present. For example as an aid to understanding the following appended claims may contain usage of the introductory phrases at least one and one or more to introduce claim recitations. However the use of such phrases should not be construed to imply that the introduction of a claim recitation by the indefinite articles a or an limits any particular claim containing such introduced claim recitation to embodiments containing only one such recitation even when the same claim includes the introductory phrases one or more or at least one and indefinite articles such as a or an e.g. a and or an should be interpreted to mean at least one or one or more the same holds true for the use of definite articles used to introduce claim recitations. In addition even if a specific number of an introduced claim recitation is explicitly recited those skilled in the art will recognize that such recitation should be interpreted to mean at least the recited number e.g. the bare recitation of two recitations without other modifiers means at least two recitations or two or more recitations .

Furthermore in those instances where a convention analogous to at least one of A B and C etc. is used in general such a construction is intended in the sense one having skill in the art would understand the convention e.g. a system having at least one of A B and C would include but not be limited to systems that have A alone B alone C alone A and B together A and C together B and C together and or A B and C together etc. . Where a convention analogous to at least one of A B or C etc. is used in general such a construction is intended in the sense one having skill in the art would understand the convention e.g. a system having at least one of A B or C would include but not be limited to systems that have A alone B alone C alone A and B together A and C together B and C together and or A B and C together etc. . It will be further understood that virtually any disjunctive word and or phrase presenting two or more alternative terms whether in the description claims or drawings should be understood to contemplate the possibilities of including one of the terms either of the terms or both terms. For example the phrase A or B will be understood to include the possibilities of A or B or A and B. 

As will be understood by one skilled in the art for any and all purposes such as in terms of providing a written description all ranges disclosed herein also encompass any and all possible subranges and combinations of subranges thereof. Any listed range can be easily recognized as sufficiently describing and enabling the same range being broken down into at least equal halves thirds quarters fifths tenths etc. As a non limiting example each range discussed herein can be readily broken down into a lower third middle third and upper third etc. As will also be understood by one skilled in the art all language such as up to at least greater than less than and the like include the number recited and refer to ranges which can be subsequently broken down into subranges as discussed above. Finally as will be understood by one skilled in the art a range includes each individual member.

