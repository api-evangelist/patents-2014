---

title: Enabling direct transport layer connectivity
abstract: A technology for a user equipment (UE) that is operable to establish direct transport layer connectivity with a selected UE. An internet protocol (IP) address of the UE can be sent to a Proximity Services (ProSe) server. A user application identification (ID) and ProSe server ID of the selected UE can be requested from an application server. A user application ID and ProSe server ID can be received from the application server. A facilitation message can be sent to the ProSe server in communication with the UE, wherein the facilitation message includes a request to facilitate direct transport layer connectivity between the UE and the selected UE for a selected application.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09426836&OS=09426836&RS=09426836
owner: INTEL IP CORPORATION
number: 09426836
owner_city: Santa Clara
owner_country: US
publication_date: 20140716
---
This application claims the benefit of and hereby incorporates by reference U.S. Provisional Patent Application Ser. No. 61 859 121 filed Jul. 26 2013.

Internet Protocol IP Version 4 IPv4 is a fourth revision of internet protocols used for data communication over different kinds of networks. Primarily IPv4 is used to route traffic on the Internet and can be used to provide an Internet addressing architecture for establishing connections between network enabled devices by providing an identification ID for each device.

IPv4 uses 32 bit 4 byte IP addresses to ID each device. Accordingly the number of IP address spaces is limited to 4 294 967 296 possible unique IPv4 addresses. With an increase in the number of network enabled devices the number of unique IP addresses available for use is nearly exhausted. Additionally some IPv4 addresses have been reserved for special purposes such as private networks multicast IPv4 addresses and special organizations thereby further reducing the number of available unique IP addresses.

A private network is a network that uses private IP addresses following standards such as RFC 1918 for Internet Protocol Version 4 IPv4 to identify devices within the network. Private IP addresses can be used for home office and enterprise local area networks LANs when globally routable addresses are not required or are not available. Since private IPv4 addresses are not globally unique the private IPv4 addresses are not globally reachable by devices outside of the private network. As a result direct IP connectivity is not possible between devices with private IPv4 addresses unless they are within the same private network. Additionally direct IP connectivity is not possible between devices with public IPv4 addresses as well when the devices are behind firewalls that limit access.

Reference will now be made to the exemplary embodiments illustrated and specific language will be used herein to describe the same. It will nevertheless be understood that no limitation of the scope of the invention is thereby intended.

Before the present invention is disclosed and described it is to be understood that this invention is not limited to the particular structures process steps or materials disclosed herein but is extended to equivalents thereof as would be recognized by those ordinarily skilled in the relevant arts. It should also be understood that terminology employed herein is used for the purpose of describing particular examples only and is not intended to be limiting. The same reference numerals in different drawings represent the same element. Numbers provided in flow charts and processes are provided for clarity in illustrating steps and operations and do not necessarily indicate a particular order or sequence.

Devices using Internet Protocol version 4 IPv4 are generally given private IP addresses. Traditionally the devices with private IP addresses cannot be reached directly by other devices via the internet. Accordingly to establish direct IP connectivity between a device with a private IP address and another device the device with the private IP address must first send an IP level request to the other device in order to open a transport connection on which the other device can return an IP level response. However traditionally when both peers have non routable private IP addresses direct IP connectivity cannot be established since the initial IP level request cannot be delivered.

When a device establishes direct IP connectivity with a device that does not have a publicly routable IP address i.e. a private IP address or a public IP address blocked by a firewall a direct IP connectivity scheme can be used. In one embodiment a direct IP connectivity scheme for IPv4 can use a proximity services ProSe server such as a device to device D2D server to establish direct IP connectivity. In one embodiment the ProSe server can assist devices to discover other devices establish D2D connections and maintain D2D service continuity.

In one embodiment when access permissions of UE B permit UE A to connect to UE B the P2P application server communicates to UE A the ProSe server ID of UE B as in block . In another embodiment the UE A can send a facilitation message to the ProSe server A requesting the ProSe server A facilitate establishing a direct transport layer connection with UE B that is identified using a P2P application layer ID and ProSe server ID of UE B as in block . In another embodiment the facilitation message can include an IP address of UE A. In another embodiment when UE B is managed by the same ProSe server as UE A i.e. ProSe server A the ProSe server A can send a request for the IP address and application port of UE B directly to UE B as in block . In another embodiment if UE B is managed by a ProSe server other than ProSe server A the ProSe server A can send a request for the IP address and application port of UE B via the ProSe server of UE B i.e. ProSe server B as in block . In another embodiment ProSe server A can determine a reachable status of the IP address of UE A and or a reachable status of the IP address of UE B as in block . In another embodiment direct transport layer connectivity can be established between UE A and UE B as in block .

In status UE B does not have a globally reachable IP address e.g. UE B is behind a NAT or firewall but UE A does have a globally reachable IP address. In status a reverse connection may be established between UE A and UE B as in block . further provides details on establishing a reverse connection.

In status neither UE B nor UE A has a globally reachable IP address. In one embodiment ProSe server A can request a globally reachable IP address and port number for UE A from the firewall of UE A as in block . In another embodiment the ProSe server A can forward the IP address and port number directly to UE B when UE B is managed by ProSe server A as shown in status . In another embodiment the ProSe server A can forward the IP address and port number indirectly to UE B via a ProSe Server of UE B i.e. ProSe server B when UE B is not managed by ProSe server A as shown in status . In another embodiment UE B can then use that IP address and port number to establish IP connectivity with UE A on a selected application as in block .

In another embodiment the ProSe server A can send a request directly to a firewall of UE B UE B Firewall for a globally reachable IP address and port number for UE B when UE B is managed by ProSe server A as in status . In another embodiment the ProSe server A can send a request to indirectly to UE B Firewall via ProSe server B for a globally reachable IP address and port number for UE B when UE B is not managed by ProSe server A as in status . In another embodiment the ProSe server A can forward the globally reachable IP address and port number for UE B to UE A as in block . In another embodiment UE A can then use the globally reachable IP address and port value to establish IP connectivity with UE B on a selected application as in block . In another embodiment when the connection is terminated the firewall rule is removed.

In one embodiment the computer circuitry can be further configured to receive from the first UE a facilitation request to establish direct transport layer connectivity between the first UE and the second UE. In another embodiment the computer circuitry can be further configured to receive from the first UE a user application identification ID for a peer to peer P2P application and a device ID of the first UE. In another embodiment the computer circuitry can be further configured to identify the second UE using a user application identification ID and a ProSe server ID of a ProSe server used by the second UE.

In one embodiment the reachable status of the IP address for the first UE or IP address for the second UE includes a globally reachable IP address status and a non globally reachable IP address status. In another embodiment the non globally reachable IP address status is caused by the use of a network address translation NAT or a firewall by the first UE or the second UE. In another embodiment the computer circuitry can be further configured to send to the first UE the IP address and application port of the second UE when the reachable status of the second UE is a globally reachable IP address status. In another embodiment the computer circuitry can be further configured to determine that the first UE and the second UE support a reverse connection procedure and assist the first UE and the second UE to establish reverse connectivity between the first UE and the second UE when the reachable status of the second UE is a non globally reachable IP address status and the reachable status of the first UE is a globally reachable IP address status.

In one embodiment the computer circuitry can be further configured to assist the first UE and the second UE to establish reverse connectivity by indicating to the first UE that a reverse connectivity will be established for the application from the second UE to bypass a firewall of the second UE forwarding an IP address and a port number of the application for the first UE to the second UE and directing the second UE to establish a reverse connectivity for the application with the first UE. In another embodiment the computer circuitry can be further configured to forward the IP address and port number of the first UE to the second UE directly or forward the IP address and port number of the first UE to the second UE using a ProSe server of the second UE. In another embodiment the reverse connectivity between the first UE and the second UE is a bidirectional socket. In one embodiment the computer circuitry can be further configured to remove the firewall bypass from the second UE when the direct transport layer connectivity for the application between the first UE and the second UE is terminated.

In one embodiment the computer circuitry can be further configured to directly request a globally reachable IP address and a port number for the second UE from the second UE when the second UE is managed by the ProSe server when the reachable status of the second UE is the non globally reachable IP address status and reachable status of the first UE is the non globally reachable IP address status. In one embodiment the computer circuitry can be further configured to indirectly request a globally reachable IP address and a port number for the second UE using a ProSe server associated with the ProSe server associated with the second UE when the reachable status of the second UE is the non globally reachable IP address status and reachable status of the first UE is the non globally reachable IP address status. In another embodiment the computer circuitry can be further configured to forward the globally reachable IP address and the port number to the first UE.

In one embodiment the computer circuitry can be further configured to directly request a firewall associated with the second UE to provide the globally reachable IP address for the second UE when the second UE is managed by the ProSe server. In one embodiment the computer circuitry can be further configured to indirectly request a firewall associated with the second UE via the ProSe server of the second UE to provide the globally reachable IP address for the second UE when the second UE is managed by the ProSe server. In another embodiment the computer circuitry can be further configured to directly request a firewall associated with the second UE to provide a port through which the first UE can access the second UE for the direct transport connection between the first UE and the second UE. In one embodiment the computer circuitry can be further configured to indirectly request a firewall associated with the second UE via the ProSe server of the second UE to provide a port through which the first UE can access the second UE for the direct transport connection between the first UE and the second UE.

In one embodiment the computer circuitry can be further configured to assist the first UE and the second UE in establishing a direct transport connectivity using the globally reachable IP address and the port provided by a firewall associated with the second UE. In another embodiment the computer circuitry can be further configured to request the globally reachable IP address and the port for the second UE directly from the firewall associated with the second UE or request the globally reachable IP address and the port for the second UE from a ProSe server of the second UE. In one embodiment the ProSe server of the second UE can forward the request for the globally reachable IP address and the port for the second UE to a firewall of the second UE. In another embodiment the computer circuitry can be further configured to request the IP address of the second UE and the application port for the application operating on the second UE from the ProSe server in communication with the second UE or directly from the second UE.

In one embodiment the computer circuitry can be further configured to send to the ProSe server an application identification ID for a peer to peer P2P application and a device ID of the UE. In another embodiment the computer circuitry can be further configured to register an application ID and the ProSe server ID with a peer to peer P2P Application Server such as when the UE is configured to provide content or service using the P2P Application Server . In another embodiment the computer circuitry can be further configured to communicate to a peer to peer P2P application server access permission levels for offered content or service posted on the P2P application server. In one embodiment the server access permission levels indicate which UEs or types of UEs have access to the content service. In another embodiment the facilitation message includes an internet protocol IP address of the UE.

In one embodiment the IP address for the first UE or an IP address for the second UE has a reachable status wherein the reachable status includes a globally reachable IP address status and a non globally reachable IP address status. In another embodiment the computer circuitry can be further configured to receive information from a selected UE on a reverse direct transport layer connection between the UE and the selected UE when the reachable status of the selected UE is a non globally reachable IP address status and the reachable status of the UE is a globally reachable IP address status. In another embodiment the selected UE can be configured to receive a request to contact the UE to establish a reverse connection. In another embodiment the computer circuitry can be further configured to receive from the ProSe server a globally reachable IP address for the selected UE when the reachable status of the selected UE is the non globally reachable IP address status and reachable status of the UE is the non globally reachable IP address status.

Another example provides functionality of product including a non transitory storage medium having stored thereon instructions that are adapted to be executed to implement a method of facilitating an establishment of a peer to peer P2P connection between a first user equipment UE and a second UE as in the flow chart in . The instructions of the product can be implemented as a method or as instructions on a machine where the instructions are included on at least one computer readable medium or one non transitory machine readable storage medium. The method can comprise requesting at a Proximity Services ProSe server an internet protocol IP address used by the second UE to establish direct transport layer connectivity and an application port for an application used by the second UE as in block . The method can further comprise determining a reachable status of an IP address of the first UE or the IP address of the second UE as in block . The method can further comprise facilitating an establishment of the direct transport layer connectivity between the first UE and the second UE based on the reachable status of the IP address of the first UE or the IP address of the second UE as in block .

In one embodiment the method can further comprise receiving from the first UE the IP address used by the first UE to establish the direct transport layer connectivity with the second UE. In another embodiment the reachable status of the IP address for the first UE or the IP address for the second UE each includes a globally reachable IP address status and a non globally reachable IP address status. In another embodiment the method can further determining that the first UE and the second UE support a reverse connection procedure and facilitating an establishment of a reverse connection between the first UE and the second UE when the reachable status of the second UE is a non globally reachable IP address status and the reachable status of the first UE is a globally reachable IP address status. In another embodiment the method can further comprise requesting a globally reachable IP address for the second UE when the reachable status of the second UE is the non globally reachable IP address status and reachable status of the first UE is the non globally reachable IP address status and forwarding the globally reachable IP address to the first UE. In another embodiment the method can further comprise requesting a globally reachable IP address for the first UE when the reachable status of the first UE and the second UE are a non globally reachable IP address status and forwarding a globally reachable IP address to the second UE for establishing a reverse transport layer connection.

Various techniques or certain aspects or portions thereof may take the form of program code i.e. instructions embodied in tangible media such as floppy diskettes CD ROMs hard drives non transitory computer readable storage medium or any other machine readable storage medium wherein when the program code is loaded into and executed by a machine such as a computer the machine becomes an apparatus for practicing the various techniques. In the case of program code execution on programmable computers the computing device may include a processor a storage medium readable by the processor including volatile and non volatile memory and or storage elements at least one input device and at least one output device. The volatile and non volatile memory and or storage elements may be a RAM EPROM flash drive optical drive magnetic hard drive or other medium for storing electronic data. The base station and mobile station may also include a transceiver module a counter module a processing module and or a clock module or timer module. One or more programs that may implement or utilize the various techniques described herein may use an application programming interface API reusable controls and the like. Such programs may be implemented in a high level procedural or object oriented programming language to communicate with a computer system. However the program s may be implemented in assembly or machine language if desired. In any case the language may be a compiled or interpreted language and combined with hardware implementations.

It should be understood that many of the functional units described in this specification have been labeled as modules in order to more particularly emphasize their implementation independence. For example a module may be implemented as a hardware circuit comprising custom VLSI circuits or gate arrays off the shelf semiconductors such as logic chips transistors or other discrete components. A module may also be implemented in programmable hardware devices such as field programmable gate arrays programmable array logic programmable logic devices or the like.

Modules may also be implemented in software for execution by various types of processors. An identified module of executable code may for instance comprise one or more physical or logical blocks of computer instructions which may for instance be organized as an object procedure or function. Nevertheless the executables of an identified module need not be physically located together but may comprise disparate instructions stored in different locations which when joined logically together comprise the module and achieve the stated purpose for the module.

Indeed a module of executable code may be a single instruction or many instructions and may even be distributed over several different code segments among different programs and across several memory devices. Similarly operational data may be identified and illustrated herein within modules and may be embodied in any suitable form and organized within any suitable type of data structure. The operational data may be collected as a single data set or may be distributed over different locations including over different storage devices and may exist at least partially merely as electronic signals on a system or network. The modules may be passive or active including agents operable to perform desired functions.

Reference throughout this specification to an example means that a particular feature structure or characteristic described in connection with the example is included in at least one embodiment of the present invention. Thus appearances of the phrases in an example in various places throughout this specification are not necessarily all referring to the same embodiment.

As used herein a plurality of items structural elements compositional elements and or materials may be presented in a common list for convenience. However these lists should be construed as though each member of the list is individually identified as a separate and unique member. Thus no individual member of such list should be construed as a de facto equivalent of any other member of the same list solely based on their presentation in a common group without indications to the contrary. In addition various embodiments and example of the present invention may be referred to herein along with alternatives for the various components thereof. It is understood that such embodiments examples and alternatives are not to be construed as defacto equivalents of one another but are to be considered as separate and autonomous representations of the present invention.

Furthermore the described features structures or characteristics may be combined in any suitable manner in one or more embodiments. In the following description numerous specific details are provided such as examples of layouts distances network examples etc. to provide a thorough understanding of embodiments of the invention. One skilled in the relevant art will recognize however that the invention can be practiced without one or more of the specific details or with other methods components layouts etc. In other instances well known structures materials or operations are not shown or described in detail to avoid obscuring aspects of the invention.

While the forgoing examples are illustrative of the principles of the present invention in one or more particular applications it will be apparent to those of ordinary skill in the art that numerous modifications in form usage and details of implementation can be made without the exercise of inventive faculty and without departing from the principles and concepts of the invention. Accordingly it is not intended that the invention be limited except as by the claims set forth below.

