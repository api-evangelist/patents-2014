---

title: System and method for identifying a subscriber in a network environment
abstract: An example method is provided in one example embodiment and includes receiving, by a first Home eNodeB (HeNB), a first attach request from a user equipment (UE) for attaching a subscriber associated with the UE to a small cell network; determining whether the subscriber has transitioned into the small cell network from a macro cell network; exchanging, based on the determination, a first pair of messages between the first HeNB and the UE to determine an International Mobile Subscriber Identity (IMSI) of the subscriber; and exchanging, based on the determination, one or more second pairs of messages between the first HeNB and the UE to advance a sequence number for Non-Access Stratum (NAS) messages for the UE to a value corresponding to a received sequence number for the first attach request from the UE.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09439116&OS=09439116&RS=09439116
owner: CISCO TECHNOLOGY, INC.
number: 09439116
owner_city: San Jose
owner_country: US
publication_date: 20140519
---
This disclosure relates in general to the field of communications and more particularly to a system and method for identifying a subscriber in a network environment.

Networking architectures have grown increasingly complex in communication environments. For example small cells have gained notoriety due to their capabilities to connect wireless devices to a network. In general terms small cell access points can operate in a licensed spectrum to connect user equipment to the network often using broadband connections. For a mobile operator small cell access points can offer improvements to both coverage and capacity which is particularly applicable to indoor networking environments where macro cell networks typically suffer coverage limitations. Small cell access points can also offer an alternative networking architecture to deliver the benefits of scalable small cell deployments. However there are significant challenges in managing access to small cell access points particularly in the context of subscribers transitioning from a macro cell layer into a small cell network layer.

A method for a communication network is provided in one example embodiment and may include receiving by a first Home eNodeB HeNB a first attach request from a user equipment UE for attaching a subscriber associated with the UE to a small cell network determining whether the subscriber has transitioned into the small cell network from a macro cell network exchanging based on the determination a first pair of messages between the first HeNB and the UE to determine an International Mobile Subscriber Identity IMSI of the subscriber and exchanging based on the determination one or more second pairs of messages between the first HeNB and the UE to advance a sequence number for Non Access Stratum NAS messages for the UE to a value corresponding to a received sequence number for the first attach request from the UE. In some cases the first pair of messages and the one or more second pairs of messages can include an Evolved Packet System Mobility Management Identity EMM ID Request message and an EMM ID Response message. In one instance the determining that the subscriber has transitioned into the small cell network from the macro cell network includes determining that a source tracking area identity TAI for the subscriber does not match a corresponding TAI provisioned for the first HeNB.

In some cases the first HeNB can be provisioned at least in part to provide resources for a closed subscriber group CSG . In some instances the method may further comprise determining whether the subscriber is a member of the CSG by performing at least one of querying a service with the IMSI of the subscriber and an identifier for the CSG to determine if the subscriber is a member of the CSG querying a service with the IMSI of the subscriber and an identifier for the first HeNB to determine if the subscriber is a member of the CSG and comparing the IMSI of the subscriber to a list of authorized subscribers for the CSG. In one case the method may further comprise communicating to the first HeNB whether the subscriber is a member of the CSG to provide resources to the subscriber wherein the resources provided to the subscriber can be adjusted based on an access mode of the first HeNB and whether the subscriber is a member of the CSG. In yet other cases the method may further comprise associating the IMSI of the subscriber with a Globally Unique Mobility Management Entity Identity GUMMEI and a Mobility Management Entity UE S1AP Identity MME UE S1AP ID for the subscriber if the subscriber is a member of the CSG and storing the association of the IMSI in combination with an identifier for the CSG.

In other instances the method may further comprise receiving by a second HeNB a second attach request from the UE for attaching the subscriber to the small cell network determining whether the subscriber has transitioned to the second HeNB from another HeNB in the small cell network and retrieving by a Home eNodeB gateway HeNB GW the IMSI of the subscriber by recovering an association of the IMSI with a Globally Unique Mobility Management Entity Identity GUMMEI and a Mobility Management Entity UE S1AP Identity MME UE S1AP ID for the subscriber if the subscriber has transitioned to the second HeNB from another HeNB in the small cell network. In some cases the determining that the subscriber has transitioned to the second HeNB from another HeNB in the small cell network can include matching a source tracking area identity TAI for the subscriber to a corresponding TAI provisioned for the small cell network.

Turning to is a simplified block diagram illustrating a communication system to facilitate identifying a subscriber in a network environment according to one embodiment of the present disclosure. This particular configuration may be tied to the 3rd Generation Partnership Project 3GPP Evolved Packet System EPS architecture also sometimes referred to as the Long Term Evolution LTE EPS architecture. Alternatively the depicted architecture may be applicable to other environments equally.

The example architecture of may include user equipment UE a Home eNode B HeNB radio access point which may have a logical connection to an HeNB gateway HeNB GW a macro network an internet and a service provider network . Service provider network may include a Mobility Management Entity MME and a 3GPP Authentication Authorization and Accounting AAA element . MME may interface with HeNB GW and HeNB over an S1 application protocol S1AP interface and may further be configured to interface with AAA element typically through a Home Subscriber Server not shown . MME may further be configured with one or more logical connections to macro network . For example MME may be configured with one or more logical connections to one or more macro cells e.g. Node Bs eNode Bs etc. not shown which may be deployed in macro network in order to provide cellular mobile coverage for macro network . In various instances macro network may include access networks such as GSM EDGE radio access network GERAN UMTS terrestrial radio access network UTRAN generally referred to as 3G and or LTE access networks such as evolved UTRAN E UTRAN generally referred to as 4G or LTE. HeNB GW may also be configured to interface with AAA element .

As referred to herein in this Specification an HeNB radio access point e.g. HeNB radio access point may also be referred to interchangeably as an HeNB or an HeNB access point. As shown in HeNB HeNB GW MME and AAA element may each include a respective processor and a respective memory element . HeNB may further be configured to interface with HeNB GW via internet . HeNB and HeNB GW may each further include a respective access control module 

Although only one HeNB e.g. HeNB is shown in it should be understood that multiple HeNBs may be deployed in communication system in order to deliver contiguous service between macro network and a small cell network. The small cell network may be made up of multiple HeNBs including HeNB in order to provide 4G LTE cellular mobile coverage for the small cell network. In various embodiments the small cell network may further include one or more Home Node B HNB radio access points not shown in order to provide 3G cellular mobile coverage for the small cell network.

Service provider network may include other elements gateways etc. that may make up an Evolved Packet Core EPC for the network. For example these elements may include but not be limited to a Home Subscriber Server HSS one or more serving gateways SGWs one or more packet data network gateways PGWs one or more serving gateway support nodes SGSNs and or a policy and charging rules function PCRF . These elements may be provided in service provider network to provide various UE services and or functions to implement QoS on packet flows and to provide connectivity for UEs to external data packet networks. These elements are not shown in service provider network in order to highlight other features of communication system .

Before detailing some of the operational aspects of it is important to understand common characteristics of small cell access points APs e.g. HeNBs HNBs or more generally femotcells picocells etc. as they generally operate in commercial architectures. The following foundation is offered earnestly for teaching purposes only and therefore should not be construed in any way to limit the broad teachings of the present disclosure. In many network architectures small cell APs can be deployed as autonomous units to improve reception in areas with poor coverage or within buildings where coverage is reduced by the structure itself.

Essentially small cell APs are fully featured base stations that can provide proximate coverage in a business e.g. enterprise and or residential environment. Typically small cell APs operate at lower radio power levels as compared to macro cell radio access networks RANs . Small cell APs can be connected using a standard broadband digital subscriber line DSL internet or cable service into a service provider s network. Calls can be made and received where the signals are sent potentially encrypted from the small cell AP via the broadband IP network to one of the service provider s main switching centers. Small cell APs can be provisioned to readily handle etc. concurrent calls. Thus a small cell AP e.g. HeNB HNB etc. generally operates as a mini tower for a proximate user. As used herein in this Specification the terms user and subscriber may be used interchangeably.

Small cell APs can be provisioned to accommodate different access modes e.g. modes through which resources e.g. coverage services etc. can be provided and or limited to subscribers within range of a small cell AP. In Open Access Mode deployments resources provided by a small cell AP is generally open to anyone within range unless configurations operate to limit access to a given network to only those subscribers duly authorized for access to a given service provider network. In Closed Access Mode deployments resources provided by a small cell AP are limited to subscribers within range and that are included in a closed subscriber group CSG for the small cell AP.

In Hybrid Access Mode deployments a small cell AP may be configured to provide both Open and Closed resources for subscribers within range. For the Open portion provisioned on a Hybrid Access Mode small cell AP resources can be provided to any subscribers within range unless configurations operate to limit access to a given network to only those individuals duly authorized for access. For the Closed portion provisions for the Hybrid Access Mode small cell AP resources may be limited to subscribers within range and that are included in a CSG for the small cell AP. Resources provided by a Hybrid Access Mode small cell AP may be differentiated between the Open and Closed portions. For example subscribers attached through the Closed portion of a Hybrid access mode small cell AP may be provided increased Quality of Service QoS bandwidth and or other preferential services as compared to subscribers attached through the Open portion of the small cell AP. Other preferential services can include for example excluding attachment of subscribers to the Open portion if the number of subscribers desiring access through the Closed portion increases beyond a certain threshold. These examples are just a few of the many resources that can be differentiated between Closed and Open portions of a Hybrid Access Mode small cell AP for members nonmembers of the CSG. Virtually any other resources provided by a Hybrid access mode small cell AP can be differentiated and thus are clearly within the scope of the present disclosure.

Separately it should be noted that small cell networks can leverage International Mobile Subscriber Identity IMSI data which can uniquely identify a user e.g. the SIM card associated with a given UE. This means that an architecture can translate any entered phone number into an IMSI which can be used by a small cell AP to grant deny access to a service provider s network. An HSS can maintain a database that maps these number systems together. Additionally service providers can provision one or more whitelists at various locations in the network. Subscribers e.g. UEs can be granted denied access to the network via small cell access APs using the whitelist data provisioned in the network.

Note that there exist various obstacles for Closed Hybrid access mode deployments for LTE HeNB small cell networks. The 3GPP provides one possible solution for LTE CSG capabilities as described in technical specification 36.413 TS 36.413 release 8 but this solution impacts a lot of EPC nodes as well as impacting signaling between the MME and HeNBs over the S1AP interface. For example the solution for providing LTE CSG Hybrid cell capabilities typically requires enhanced support by the MME and the HSS in the EPC as well as a complete CSG infrastructure including a CSG List Server and a CSG Admin Server within an operator s network.

Some operators however want to deploy LTE small sells in Closed Hybrid access modes without impacting the MME interfaces to EPC or without having to deploy a complete CSG infrastructure. Additionally some operators that have deployed 3G HNBs based on an HNB gateway HNB GW using AAA whitelist determination to determine CSG membership desire to re use this investment for supporting LTE HeNB small cell networks. This is particularly relevant for dual triple stack APs that offer 3G 4G LTE and or WiFi radio access capabilities in a single unit.

In general terms for HNB small cell networks if a given UE were to seek to initiate a session flow with a given Closed Hybrid access mode HNB the HNB can coordinate with an HNB GW in order to determine e.g. using whitelist data whether a particular UE e.g. a particular IMSI was permitted to access the HNB services.

Note that there are two different registrations that typically occur in a 3G small cell network. The first registration is associated with the HNB registering with its associated HNB GW following provisioning of the HNB via an HNB Management System HMS . Through the HMS the HNB may be provisioned according to technical report 069 TR 069 protocol using the TR 196 data model. The second registration is associated with a UE that seeks to camp on an HNB. This second registration involves the HNB querying the HNB GW before allowing the UE to register for service. For the second registration non access stratum NAS messages can be used in order for the HNB to communicate with the UE. For a given UE that seeks to access services of a given HNB the HNB can communicate with the UE using one or more NAS messages to determine the IMSI of the UE.

The HNB may then coordinate with the HNB GW to determine e.g. using whitelist data whether the UE is permitted to access services at the HNB. For example the HNB GW would evaluate its whitelist which may have been suitably cached in the HNB GW and determine whether this particular UE e.g. this particular IMSI is authorized to access the HNB services.

It should be noted that NAS messages transmitted by a given UE include a send sequence number N SD which is incremented for every NAS message transmitted by the UE on a modulo 4 basis as described in TS 24.007. As used herein in the present disclosure a send sequence number may be referred to generally as a sequence number and sequence numbers for NAS message may be identified using an N SD 0 1 etc. identifier. During normal communications with a service provider network sequence numbers for NAS messages received within the EPC e.g. an SGSN within the EPC are analyzed to ensure that no out of sequence NAS messages are received from the UE.

For 3G small cell networks intercepting NAS messages by an HNB and communicating with a given UE to determine the UE IMSI causes the NAS sequence number to increment and upon determining an IMSI of a subscriber associated with the UE the sequence number for the NAS messages needs to be reset to avoid out of order messages being received by the core network CN . One technique to reset the sequence number for 3G small cell networks is to communicate a mobility management null MM null message from the HNB to the UE to reset the NAS sequence number for the UE.

In contrast for 4G LTE networks LTE MME specifications limit the ability of any HeNB to autonomously process NAS messages by definition of various NAS protection systems as described in TS 33.401. Therefore legacy 3G approaches cannot be directly re used to enable IMSI visibility at an HeNB. However to achieve enterprise small cell integration of 4G LTE the permanent identity e.g. IMSI of a user should be exposed to an HeNB HeNB GW. As noted while this is supported in 3G via HNB application part HNBAP signaling between the HNB and HNB GW it is not supported in LTE over S1AP thereby restricting the ability to integrate HeNBs into enterprise services environments.

In accordance with one embodiment communication system can overcome the aforementioned shortcomings and others by providing HeNB with the capability to communicate evolved mobility management EMM identity requests responses with UE in order to recover the IMSI of the subscriber associated with UE at HeNB which may therefore enable enterprise services integration for 4G LTE Closed Hybrid Access mode control capabilities. Following recovery of the IMSI HeNB can further include functionality to advance the NAS sequence number for UE by three 3 values according to modulo 4 N SD incrementing for UE to avoid out of sequence NAS messages being received by MME if for example UE is determined to be a member of a CSG provisioned for HeNB . By recovering the IMSI of the subscriber at HeNB LTE CSG Hybrid cell access control capabilities can be supported without impact to the EPC. Further LTE CSG Hybrid cell access control can be converged with 3G HNB access control techniques thus allowing HeNB GW to interface with a whitelist database via AAA element .

During operation for example when a given UE is within range of HeNB and is attempting to initiate a session UE may communicate a NAS EMM attach request having an N SD 0 to HeNB . HeNB may determine if UE may be transitioning to HeNB from a macro cell of macro network or if UE may be transitioning to HeNB from another HeNB in the small cell network. HeNB via access control module may include functionality to analyze a last visited tracking area identity TAI for UE to determine if the UE is moving into the HeNB small cell layer for HeNB from a macro cell in macro network or is merely moving between HeNBs in the small cell layer. HeNB may for example determine the last visited TAI for UE through a tracking area update TAU initiated by UE . In one or more embodiments TAUs can be initiated based on a UE transitioning between tracking areas timers within a UE or other similar mechanisms.

To illustrate features of communication system assume for the present example that HeNB may be provisioned in either a Closed or Hybrid access mode to provide resources for a CSG. Further assume that HeNB may be provisioned with a CSG identifier CSG ID for the CSG and access mode ID e.g. Closed Hybrid via TR 069 provisioning using an HNB HeNB management system not shown which can be provided in communication system .

In one instance HeNB may determine that UE may be moving into the HeNB small cell layer e.g. the last visited TAI for UE does not match a TAI provisioned for HeNB or the last visited TAI corresponds to a TAI for macro network . Based on this determination HeNB can communicate a NAS EMM identity request message to UE to recover the IMSI for UE e.g. for the subscriber associated with UE . UE may respond to the request with its corresponding IMSI using a NAS EMM identity response message having an N SD 1. After recovering the IMSI HeNB may need to advance or increment the N SD for UE by three back to N SD 0 to avoid any out of sequence messages being received by MME if UE may be granted access to HeNB . HeNB may include capabilities to reset the NAS message sequence number for UE to a number corresponding to the sequence number received for the initial request to attach to HeNB e.g. N SD 0 for the present example . HeNB can advance the sequence number by communicating a series of dummy NAS messages to UE . In one or more embodiments the dummy NAS messages could be NAS EMM identity request messages which will cause UE to respond with an identity response messages each including an incremented sequence number or any other NAS messages types that may elicit a response from UE .

HeNB may query HeNB GW to determine if the subscriber associated with UE should be granted resources provided by HeNB . To perform the query HeNB may append an S1AP initial UE message communicated to HeNB GW with an S1AP proprietary extension for a membership query that may include the recovered IMSI for the subscriber associated with UE the CSG ID of the CSG provisioned for HeNB and the cell access mode for HeNB for the corresponding CSG. HeNB GW via access control module may include a capability to analyze the S1AP extension in order to perform access control for HeNB . In one embodiment using an appropriate AAA interface HeNB GW may communicate an access request message to AAA element including the IMSI and the CSG ID for HeNB . AAA element may respond with an access response message including the membership status of UE for the CSG provisioned for HeNB . Based on the response HeNB GW can to determine whether the subscriber associated with UE is a member of the CSG provisioned for HeNB . In one or more embodiments communication system may include other AAA servers or AAA services which HeNB GW may query to determine the membership status of various UEs. In another embodiment HeNB GW may recover a list of authorized IMSI s for HeNB during setup of HeNB via S1AP Setup messages communicated between HeNB and MME e.g. via HeNB GW .

HeNB GW may include a capability to deliver a membership response to HeNB using an S1AP proprietary extension which can indicate whether or not UE is a member of the CSG provisioned for HeNB . The S1AP proprietary extension for the membership response may include the IMSI of the subscriber associated with UE the CSG ID of the CSG provisioned for HeNB the cell access mode provisioned for HeNB for the corresponding CSG and the membership status of the subscriber associated with UE in the CSG.

If in one example HeNB GW determines that the subscriber associated with UE is not a member of the CSG provisioned for HeNB and additionally if HeNB is provisioned in a Closed access mode then HeNB GW can autonomously indicate that the subscriber associated with UE is not a member of the CSG using an error indication message included as an S1AP proprietary extension for the membership response which may indicate that the subscriber associated with UE is not a member of the CSG for Closed access mode HeNB . In an embodiment the error indication message may be included as an S1AP proprietary extension for a downlink DL NAS transport message. HeNB may include functionality to autonomously generate a NAS EMM attach reject message for the nonmember subscriber associated with UE in such Closed CSG environments upon receiving the membership response from HeNB GW indicating that the subscriber associated with UE is not a member of the CSG.

If in another example UE is a member of the CSG provisioned for HeNB S1AP signaling between UE HeNB HeNB GW and MME may continue for EMM attach request and EMM authorization response messaging. Recall that HeNB may include capabilities to advance the NAS message sequence number for UE to a number corresponding to the sequence number received for the initial EMM attach request message communicated to HeNB e.g. N SD 0 for the present example . Thus UE may respond to an EMM authorization request message communicated from HeNB with a NAS EMM authorization response message having N SD 1. The authorization response message may be communicated back to MME through S1AP signaling and since the sequence number of N SD 1 for the EMM authorization response may be received in a sequential order MME may accept the message and location update procedures may continue normally for UE as described in TS 23.401.

Following the location update procedures MME may issue an S1AP initial context setup request message to UE . HeNB GW may receive the message and may include functionality to associate the IMSI for the subscriber associated with UE with a Globally Unique Mobility Management Entity Identity GUMMEI and a Mobility Management Entity UE S1AP Identity MME UE S1AP ID for the subscriber if the subscriber is a member of the CSG provisioned for HeNB . The GUMMEI may identify MME in service provider network and the MME UE S1AP ID may be provisioned by MME to identify UE over the S1 interface within MME . The GUMMEI and MME UE S1AP ID may be included in the S1AP message received from MME . HeNB GW may store the association together with the IMSI the CSG ID for HeNB and the member status of the subscriber associated with UE for the CSG provisioned for HeNB . This stored association may be used to facilitate subscriber identification for UE transitions between HeNBs for the small cell network layer as described in further detail below. HeNB GW may deliver a membership response to HeNB using an S1AP proprietary extension to an S1AP initial context setup request message indicating that UE is a member of the CSG provisioned for HeNB . As noted above the membership response may include the IMSI and membership status for UE e.g. UE is a member of the CSG for this example as well as the CSG ID and cell access mode for HeNB .

Upon receiving a membership response indicating that UE is a member of the CSG provisioned for HeNB HeNB may provide resources to UE . The resources may vary based on the access mode provisioned for HeNB . For example if HeNB is provisioned in a Closed access mode and the subscriber associated with UE is a member of the CSG then HeNB may provide resources to UE as determined by the CSG provisioning for the Closed access mode. In another example if HeNB is provisioned in a Hybrid access mode and the subscriber associated with UE is a member of the CSG then HeNB may provide enhanced resources if so provisioned for the CSG to UE . However if HeNB is provisioned in a Hybrid access mode and the subscriber associated with UE is not a member of the CSG then HeNB may merely provide normal or non enhanced resources to the nonmember UE . These examples are just a few of the many means and methods that may be used to differentiate resources between Closed and Open portions of a Hybrid Access Mode HeNB. Virtually any other resources may be differentiated for a Hybrid Access Mode HeNB and thus are clearly within the scope of the present disclosure.

Recall as noted above that upon receiving a request from UE to initiate a session HeNB may first determine e.g. by analyzing a last visited TAI for UE if UE is transitioning to HeNB from a macro cell of macro network or if UE is transitioning to HeNB from another HeNB in the small cell network. Thus in another instance HeNB may determine that UE may be transitioning to HeNB from another HeNB e.g. the last visited TAI matches or is equal to a TAI provisioned for HeNB or if the last visited TAI is not available then it can be assumed that UE is already known within the small cell network . Assume also for this instance that HeNB may be provisioned in either a Closed or Hybrid Access Mode to provide resources for a CSG provisioned for HeNB . Further assume that HeNB may be provisioned with a CSG identifier CSG ID for the CSG and access mode ID e.g. Closed Hybrid via TR 069 provisioning through an HNB HeNB management system not shown .

In this instance HeNB may communicate an S1AP initial UE message to HeNB GW with the S1AP proprietary extension for the membership query that may include the CSG ID for the CSG provisioned for HeNB and the cell access mode provisioned for HeNB . For the S1AP message a NAS packet data unit PDU field in the S1AP message may be embedded with the EMM attach request received from UE having an N SD 0. Note that the IMSI of UE may be unknown to HeNBs for transitions between HeNBs in the small cell network but may be known to MME as MME previously authenticated UE upon its transition into the small cell network from macro network . However the EMM attach request may include an old Globally Unique Temporary Identity GUTI comprised of a GUMMEI identifying an MME that had previously allocated the GUTI which may or may not have been MME e.g. if UE moves from another macro network or another MME within macro network and an MME Temporary Mobile Subscriber Identity M TMSI which also identifies UE within the MME that allocated the GUTI. Using the GUTI MME can determine the IMSI of UE and assuming that UE is authorized to access service provider network location update operations for UE may continue normally as described for the previous instance.

Following the location update operations MME may communicate an S1AP initial context setup request message to HeNB GW which may include the GUTI for UE . HeNB GW in turn may query the stored GUMMEI MME UE S1AP ID association of UE to recover the IMSI for UE and additionally to determine the membership status of the subscriber associated with UE in the CSG provisioned for HeNB from the recovered association. As described above resources may or may not be provided to UE based on whether UE is a member of the CSG provisioned for HeNB and the access mode e.g. Closed Hybrid provisioned for HeNB . Signaling with UE may proceed as described above based on the determination.

In one example implementation the CSG ID included in the membership query received from HeNB may not match the CSG ID for the association for UE as stored in HeNB GW which may indicate that the previous HeNB from which UE transitioned may have been provisioned with a different CSG than the one provisioned for HeNB . In one or more embodiments nonmatching CSG IDs may trigger HeNB GW to interface with AAA element or any other AAA service that may be provided in communication system to determine if UE is a member of the CSG provisioned for HeNB . Signaling operations with UE as well as storing of a new GUMMEI MME UE S1AP ID association may occur as described previously.

The solution provided by communication system may provide several advantages over the solution prescribed in TS 36.413 release 9. For example the solution provided by communication system does not require EPC changes to provide a full CSG implementation particularly changes to MME interfaces to the EPC. Further the solution provided by communication system provides a converged architecture with 3G HNB GW based access control mechanisms which are currently implemented or deployed by various equipment manufacturers and network service providers. Additionally the solution provided by communication system enables LTE enterprise controller evolution for equipment manufacturers and network service providers.

In various embodiments the capability of obtaining a subscriber s IMSI at HeNB GW may provide other uses for communication system . In some embodiments obtaining a subscriber s IMSI at HeNB GW could be used via one or more presence application programming interfaces APIs to notify a third party system about the presence of a given UE. Such presence information may allow functional parity between HeNB GW and a 3G HNB GW. In other embodiments obtaining a subscriber s IMSI at HeNB GW may provide for various UE paging optimizations which may allow HeNB GW to identify a target small cell access point a grid of small cell access points and or groups of small cell access points sharing an Over The Air OTA Tracking Area Code TAC for paging certain UEs. In yet other embodiments obtaining a subscriber s IMSI at HeNB GW may provide for various macro to small cell hand in operations. For example in a Closed access mode deployment this may enable matching an IMSI to whitelists for certain hand in operations as discussed herein in this Specification. For an Open access mode deployment this may aid in determining a small cell access point to receive a given UE based on UE WiFi presence.

In various embodiments UE can be associated with users employees clients customers etc. wishing to initiate a flow in communication system via some network. The terms user equipment mobile node end user user and subscriber are inclusive of devices used to initiate a communication such as a computer a personal digital assistant PDA a laptop or electronic notebook a cellular telephone an i Phone i Pad a Google Droid phone an IP phone or any other device component element or object capable of initiating voice audio video media or data exchanges within communication system . UE may also be inclusive of a suitable interface to a human user such as a microphone a display a keyboard or other terminal equipment.

UE may also be any device that seeks to initiate a communication on behalf of another entity or element such as a program a database or any other component device element or object capable of initiating an exchange within communication system . Data as used herein in this document refers to any type of numeric voice video media or script data or any type of source or object code or any other suitable information in any appropriate format that may be communicated from one point to another. In certain embodiments UE may have a bundled subscription for network access and application services e.g. voice etc. Once the access session is established the user can register for application services as well without additional authentication requirements. There can be two different user data repositories e.g. AAA databases whitelist databases etc. one for the access user profile and one for the application user profile. IP addresses can be assigned using dynamic host configuration protocol DHCP Stateless Address Auto configuration default bearer activation etc. or any suitable variation thereof.

HeNB can offer suitable connectivity to one or more UE using any appropriate protocol or technique. In general terms HeNB represents a radio access point device that can allow UEs to connect to a wired network using Wi Fi Bluetooth WiMAX 4G LTE or any other appropriate standard. Hence the broad term radio access point can be inclusive of a wireless access point WAP a femtocell a hotspot a picocell a WiFi array a wireless bridge e.g. between networks sharing same Service Set Identifier SSID and radio channel a wireless local area network LAN an HeNB an HNB or any other suitable access device which may be capable of providing suitable connectivity to a UE. In certain cases the access point can connect to a router via a wired network which can relay data between the UE and other UE of the network.

The EPC components of service provider network may be referred to generally as control nodes control gateways or simply gateways. The gateways may be used to provide various UE services and or functions and to implement QoS on packet flows. The services and functions may be used for example to provision voice over IP VoIP routing enhanced services such as enhanced charging stateful firewalls and or traffic performance optimization TPO . MME is the primary control element for the EPC. Among other things MME may provide for UE tracking and paging procedures including for example retransmissions tracking area list management idle mode UE tracking etc.

AAA element is a network element responsible for accounting authorization and authentication functions for UE . For AAA considerations AAA element may provide a mobile node IP address and the accounting session identification Acct Session ID and other mobile node states in appropriate messaging e.g. via access Request access Response messages . Authentication refers to the process where an entity s identity is authenticated typically by providing evidence that it holds a specific digital identity such as an identifier and the corresponding credentials. The authorization function determines whether a particular entity is authorized to perform a given activity typically inherited from authentication when logging on to an application or service. Authorization may be determined based on a range of restrictions for example time of day restrictions or physical location restrictions or restrictions against multiple accesses by the same entity or user. Accounting refers to the tracking of network resource consumption by users for the purpose of capacity and trend analysis cost allocation billing etc. In addition it may record events such as authentication and authorization failures and include auditing functionality which permits verifying the correctness of procedures carried out based on accounting data. In various embodiments communication system may be provisioned with other AAA services and or AAA servers which may provide AAA considerations for the system.

As shown in HeNB HeNB GW MME and AAA element each include respective processors and respective memory elements . Additionally HeNB and HeNB GW each further include respective access control modules . Hence appropriate software and or hardware is being provisioned in HeNB HeNB GW MME and AAA element in order to facilitate identifying a subscriber in the network environment. Note that in certain examples certain databases e.g. for storing GUMMEI MME UE S1AP ID associations with various IMSIs can be consolidated with memory elements or vice versa or the storage can overlap exist in any other suitable manner.

In one example implementation HeNB HeNB GW MME and AAA element are network elements which are meant to encompass network appliances servers routers switches gateways bridges loadbalancers firewalls processors modules or any other suitable device component element or object operable to exchange information that facilitates or otherwise helps coordinate subscriber identification activities e.g. for networks such as those illustrated in . In other embodiments these operations and or features may be provided external to these elements or included in some other network device to achieve this intended functionality. Alternatively one or more of these elements can include software or reciprocating software that can coordinate in order to achieve the operations and or features as outlined herein. In still other embodiments one or more of these devices may include any suitable algorithms hardware software components modules interfaces or objects that facilitate the operations thereof. This may be inclusive of appropriate algorithms and communication protocols that allow for the effective exchange of data or information.

In regards to the internal structure associated with communication system each of HeNB HeNB GW MME and AAA element can include memory elements for storing information to be used in achieving the subscriber identification operations as outlined herein. Additionally each of these devices may include a processor that can execute software or an algorithm to perform the subscriber identification activities as discussed in this Specification. These devices may further keep information in any suitable memory element e.g. random access memory RAM read only memory ROM an erasable programmable read only memory EPROM application specific integrated circuit ASIC etc. software hardware or in any other suitable component device element or object where appropriate and based on particular needs. Any of the memory items discussed herein should be construed as being encompassed within the broad term memory element. The information being tracked or sent to HeNB HeNB GW MME and AAA element could be provided in any database register control list cache or storage structure all of which can be referenced at any suitable timeframe. Any such storage options may be included within the broad term memory element as used herein. Similarly any of the potential processing elements modules and machines described herein should be construed as being encompassed within the broad term processor. Each of the network elements and user equipment e.g. mobile nodes can also include suitable interfaces for receiving transmitting and or otherwise communicating data or information in a network environment.

Note that in certain example implementations the subscriber identification functions as outlined herein may be implemented by logic encoded in one or more tangible media which may be inclusive of non transitory media e.g. embedded logic provided in an ASIC in DSP instructions software potentially inclusive of object code and source code to be executed by a processor or other similar machine etc. . In some of these instances memory elements as shown in can store data used for the operations described herein. This includes the memory elements being able to store software logic code or processor instructions that are executed to carry out the activities described herein. A processor can execute any type of instructions associated with the data to achieve the operations detailed herein. In one example the processors as shown in could transform an element or an article e.g. data from one state or thing to another state or thing. In another example the activities outlined herein may be implemented with fixed logic or programmable logic e.g. software computer instructions executed by a processor and the elements identified herein could be some type of a programmable processor programmable digital logic e.g. a field programmable gate array FPGA a digital signal processor DSP an EPROM EEPROM or an ASIC that includes digital logic software code electronic instructions or any suitable combination thereof.

Referring to is a simplified flow diagram that illustrates example flows and activities associated with identifying a subscriber in a network environment according to an embodiment. In the flows of data and activities represented show the flow of data between the components and activities performed by certain components within communication system as shown in including UE HeNB HeNB GW MME and AAA element . For the operations within the architecture of it is assumed unless otherwise noted that HeNB has been provisioned in either a Closed or Hybrid access mode for a particular CSG having a particular CSG ID and access mode ID for the corresponding CSG which may be provisioned for HeNB according to the TR 069 protocol using the TS 169 data model by an HNB HeNB management system.

A particular flow may begin at with UE communicating a radio resource control RRC connection request message to HeNB in order to initiate a session with HeNB . As noted above HeNB may be connected to other HeNBs in a small cell network or layer. At HeNB responds to UE with an RRC connection setup message. At an RRC connection setup complete message is communicated from UE to HeNB . The RRC connection setup complete message includes a NAS PDU field embedded with an EMM attach request having an N SD 0. The EMM attach request includes an old GUTI comprised of a GUMMEI identifying an MME that had previously allocated the GUTI which may or may not have been MME e.g. if UE moves from another macro network or another MME within macro network and an M TMSI which identifies UE within the MME that allocated the GUTI. At HeNB may receive a TAU from UE . It should be noted that the order of receiving the TAU from UE is not dependent on the sequence of flows illustrated in . A TAU can be received at any time from UE as UE seeks to initiate a session with HeNB .

At upon receiving the RRC connection setup complete message from UE HeNB may determine by performing a TAI comparison using the last visited TAI for UE if UE is transitioning to HeNB from a macro cell layer e.g. macro network or is transitioning to HeNB from another HeNB in the small cell layer. HeNB may compare the last visited TAI received from UE to TAIs for macro network and or to TAIs for the small cell network to which HeNB belongs to make the determination. The TAIs for macro network the small cell network may be cached by HeNB . Several possible alternative flows and activities may be performed based on the determination made by HeNB regarding whether UE is transitioning to HeNB from macro network or from another HeNB in the small cell network including HeNB . These various possible alternative flows and activities are discussed in further detail below.

Referring now to is a simplified flow diagram that illustrates example flows and activities associated with a possible alternative to the determination made by HeNB as shown in regarding whether UE is transitioning to HeNB from macro network or from another HeNB in the small cell network including HeNB . The possible alternative shown in the simplified flow diagram of illustrates example flows and activities corresponding to a determination by HeNB that UE has transitioned to HeNB from macro network e.g. the last visited TAI received from UE does not match or is not equal to a TAI provisioned for HeNB or the last visited TAI received from UE matches a TAI for macro network . Based on the determination HeNB can recover the subscriber s IMSI from UE through an EMM messaging exchange with UE . At HeNB can communicate an RRC downlink DL information transfer message having a NAS PDU field embedded with a request for the IMSI of the subscriber associated with UE e.g. EMM identity request IMSI . At UE can respond with an RRC uplink UL information transfer having a NAS PDU field embedded with a response to the request including the IMSI and having a sequence number N SD 1 e.g. EMM identity response IMSI . Recall the N SD for the RRC connection setup complete message was N SD 0 as shown in .

At HeNB may communicate a membership query to HeNB GW to determine if the subscriber associated with UE is a member of the CSG provisioned for HeNB . As shown at HeNB can communicate an S1AP initial UE message to HeNB GW including an S1AP proprietary extension for the membership query that may include the recovered IMSI for the subscriber associated with UE the CSG ID of the CSG provisioned for HeNB and the cell access mode for HeNB for the corresponding CSG. The S1AP message can include a NAS PDU field embedded with an EMM attach request having an N SD 0. Setting the N SD 0 for the EMM attach request can be used in instances where the UE is determined to be transitioning between HeNBs in a small cell layer in order to avoid out of sequence messages be received by the MME but may not be needed for instances where it is determined that the UE is transitioning to an HeNB from a macro network.

Returning to HeNB can advance the N SD for UE by three values at through an exchange of a series of dummy messages with UE . In one or more embodiments HeNB may communicate three additional EMM identity requests to UE and in turn UE may increment its N SD in each response to the requests according to its modulo 4 incrementing scheme e.g. N SD 2 N SD 3 N SD 0 .

HeNB GW can perform access control for HeNB upon receiving the membership query from HeNB . At HeNB GW can query AAA element with an access request message including the IMSI of the subscriber associated with UE and the CSG ID for the CSG provisioned for HeNB to determine the membership status of the subscriber in the CSG. At AAA element can communicate the membership status of the subscriber to HeNB GW in an access response message. Thus through flows HeNB GW can determine whether the subscriber associated with UE is a member or is a nonmember of the CSG provisioned for HeNB .

Referring now to are simplified flow diagrams A B respectively that illustrates example flows and activities associated with a possible alternative to the membership determination shown in regarding whether or not UE is a member of the CSG provisioned for HeNB . The possible alternative shown in the simplified flow diagrams A B of respectively illustrates example flows and activities corresponding to a determination by HeNB GW that the subscriber associated with UE is a member of the CSG provisioned for HeNB . As shown in based on the determination that the subscriber associated with UE is a member of the CSG provisioned for HeNB HeNB GW may communicate an S1AP UL NAS transport message to MME at . The NAS PDU field of the S1AP message may be embedded with the EMM attach request having an N SD 0 as received from HeNB as shown in . At MME can communicate EMM authorization request embedded an S1AP DL NAS transport message. At HeNB GW can communicate the EMM authorization request to HeNB in another S1AP DL NAS transport message. At HeNB can communicate an RRC DL information transfer message including the EMM authorization request to UE .

Recall from flows of that HeNB may communicate three dummy messages to UE to advance its N SD back to the sequence number corresponding to the sequence number for the initial EMM attach request sent from UE to HeNB . As shown in flow of this corresponds to an N SD 0. Thus when UE receives the EMM authorization request from HeNB at flow then UE can respond with an EMM authorization response having an appropriate N SD 1 as shown at . The EMM authorization response may be embedded in the NAS PDU field of an RRC UL information transfer message communicated from UE to HeNB . At HeNB may communicate the EMM authorization response to HeNB GW in an S1AP UL NAS transport message. At HeNB GW can in turn communicate the EMM authorization response to MME in another S1AP UL NAS transport message.

The flows and activities A from may continue to flows and activities B shown in . Because the EMM authorization response includes an N SD 1 which corresponds to an appropriate sequence number following the EMM attach request of flow the EMM authorization response is accepted by MME at . Following acceptance of the EMM authorization response the location update procedure for UE can continue in a normal manner at between UE and MME .

Following the location update MME can communicate an S1AP initial context setup request message to HeNB GW as shown at . The S1AP message may include the GUMMEI identifying MME and the MME UE S1AP ID identifying UE within MME . Upon receipt of the message HeNB GW at may associate a GUMMEI identifying MME and an MME UE S1AP ID identifying UE within MME with the IMSI for the subscriber associated with UE and may store the GUMMEI and MME UE S1AP ID association in relation to the IMSI the CSG ID for the CSG provisioned for HeNB and the membership status of the subscriber in the CSG. As referred to herein the GUMMEI and MME UE S1AP ID association may be referred to interchangeably as GUMMEI MME UE S1AP ID .

At HeNB GW can deliver a membership response to HeNB using an S1AP proprietary extension to an S1AP initial context setup request message indicating that UE is a member of the CSG provisioned for HeNB indicating that UE is a member of the CSG provisioned for HeNB . The S1AP proprietary extension for the membership response may include the IMSI of the subscriber associated with UE the CSG ID of the CSG provisioned for HeNB the cell access mode provisioned for HeNB for the corresponding CSG and the membership status of the subscriber associated with UE in the CSG here that the subscriber is a member of the CSG.

Based on the determination that the subscriber associated with UE is a member of the CSG provisioned for HeNB can provide resources to UE at . The resources provided may depend on the cell access mode provisioned for HeNB . For example if HeNB is provisioned in a Closed access mode and the subscriber associated with UE is a member of the CSG then HeNB may provide resources to UE as determined by the CSG provisioning for the Closed access mode. In another example if HeNB is provisioned in a Hybrid access mode and the subscriber associated with UE is a member of the CSG then HeNB may provide enhance resources if so provisioned for the CSG to UE . However if HeNB is provisioned in a Hybrid access mode and the subscriber associated with UE is not a member of the CSG then HeNB may merely provide normal resources to the nonmember UE .

At security mode control procedures between UE and HeNB may continue as normal. Following the security mode procedures HeNB can communicate an S1AP initial context setup response message to HeNB GW at . The S1AP initial context setup response message can be communicated from HeNB GW to MME at . At UE can communicate an EMM attach complete to HeNB which can communicate the message at using S1AP signaling to HeNB GW which can further communicate the message at using S1AP signaling to MME .

Referring now to is a simplified flow diagram that illustrates example flows and activities associated with another possible alternative to the membership determination shown in regarding whether or not UE is a member of the CSG provisioned for HeNB . The possible alternative shown in the simplified flow diagram of illustrates example flows and activities corresponding to a determination by HeNB GW that the subscriber associated with UE is a nonmember of the CSG provisioned for HeNB e.g. from flows of and assumes for example that HeNB is provisioned in a Closed Access mode. Based on the determination that the subscriber associated with UE is not a member of the CSG provisioned for Closed access mode HeNB in the present example HeNB GW can autonomously indicate to HeNB that the subscriber associated with UE is not a CSG member. At HeNB GW can communicate an error indication message included as an S1AP proprietary extension in a NAS transport message for the membership response which may indicate that the subscriber associated with UE is not a member of the CSG for Closed access mode HeNB . At HeNB can autonomously generate a NAS EMM attach reject for the nonmember subscriber associated with UE which may be embedded in an RRC DL information transfer message to UE .

Referring now to are simplified flow diagrams A B respectively that illustrates example flows and activities associated with another possible alternative to the determination made by HeNB as shown in regarding whether UE is transitioning to HeNB from macro network or from another HeNB in the small cell network including HeNB . The possible alternative shown in the simplified flow diagrams A B of respectively illustrates example flows and activities corresponding to a determination by HeNB that UE has transitioned to HeNB from another HeNB in the small cell network that includes HeNB e.g. the last visited TAI received from UE matches or is equal to a TAI for the small cell network . As shown in based on the determination HeNB can query HeNB GW at with a membership query to determine if the subscriber associated with UE is a member of the CSG provisioned for HeNB . The membership query can be appended to an S1AP initial UE message communicated to HeNB GW at with the S1AP proprietary extension for the membership query including the CSG ID for the CSG provisioned for HeNB and the cell access mode provisioned for HeNB . For the S1AP message a NAS PDU field in the S1AP message may be embedded with the EMM attach request received from UE having an N SD 0.

Note that the IMSI of the subscriber associated with UE may be unknown to HeNBs for transitions between HeNBs in the small cell network but may be known to MME as MME previously authenticated UE upon its transition into the small cell network from macro network . The EMM attach request may include an old GUTI including a GUMMEI identifying an MME that had previously allocated the GUTI which may or may not have been MME e.g. if UE moves from another macro network or another MME within macro network and an M TMSI which also identifies UE within the MME that allocated the GUTI.

At HeNB GW can communicate an S1AP UL NAS transport message to MME having a NAS PDU field embedded with the EMM attach request. Because the N SD is set to 0 for the EMM attach request MME may accept the attach request. At MME can communicate EMM authorization request embedded an S1AP DL NAS transport message. At HeNB GW can communicate the EMM authorization request to HeNB in another S1AP DL NAS transport message. At HeNB can communicate an RRC DL information transfer message including the EMM authorization request to UE . UE can respond to the authorization request with an EMM authorization response having an N SD 1 as shown at . The EMM authorization response may be embedded in the NAS PDU field of an RRC UL information transfer message communicated from UE to HeNB . At HeNB may communicate the EMM authorization response to HeNB GW in an S1AP UL NAS transport message. At HeNB GW can communicate the EMM authorization response to MME in another S1AP UL NAS transport message. Because the EMM authorization response includes an N SD 1 which corresponds to an appropriate sequence number following the EMM attach request of flow the EMM authorization response is accepted by MME . Following acceptance of the EMM authorization response the location update procedure for UE can continue in a normal manner at between UE and MME .

Following the location update MME can communicate an S1AP initial context setup request message to HeNB GW as shown at . The S1AP message may include the GUMMEI identifying MME and the MME UE S1AP ID identifying UE within MME . At HeNB GW can recover the GUMMEI and MME UE S1AP ID from the S1AP message and may use these identifiers to recover an association stored in HeNB GW for the GUMMEI MME UE S1AP ID associated with the IMSI of the subscriber associated with UE the CSG ID for the CSG provisioned for HeNB and membership status of the subscriber within the CSG. The recovered association can be used to determine the membership status of the subscriber associated with UE in the CSG provisioned for HeNB also shown at .

The flows and activities A from may continue to flows and activities B shown in . In another possible alternative the CSG ID included in the membership query from flow may not match the CSG ID for the stored IMSI association which may indicate that the previous HeNB from which UE transitioned was provisioned with a different CSG than the CSG provisioned for HeNB . Based on the nonmatching CSG IDs for the IMSI HeNB GW may communicate an access request message to AAA element at which may include the IMSI and the CSG ID for the CSG provisioned for HeNB . At AAA element can communicate an access response message to HeNB GW including the membership status for the IMSI e.g. the subscriber associated with UE .

At HeNB GW can deliver a membership response to HeNB using an S1AP proprietary extension to an S1AP initial context setup request message the membership response can indicate whether or not UE is a member of the CSG provisioned for HeNB . The S1AP proprietary extension for the membership response may include the IMSI of the subscriber associated with UE the CSG ID of the CSG provisioned for HeNB the cell access mode provisioned for HeNB for the corresponding CSG and the membership status of the subscriber associated with UE in the CSG.

At HeNB can provide resource to UE based on whether or not the subscriber associated with UE is a member of the CSG provisioned for HeNB and based additionally on the access mode provisioned for HeNB e.g. Closed Hybrid . Based on a determination that HeNB can provide resources to UE e.g. either on an enhanced or non enhanced basis depending on access mode security mode control procedures between UE and HeNB may continue as normal at . Following the security mode procedures HeNB can communicate an S1AP initial context setup response message to HeNB GW at . The S1AP initial context setup response message can be communicated from HeNB GW to MME at . At UE can communicate an EMM attach complete to HeNB which can communicate the message at using S1AP signaling to HeNB GW which can further communicate the message at using S1AP signaling to MME .

Although not outlined in their entirety in it should be understood that the membership determination flows and activities as discussed in can be equally applied within the flows and activities discussed in for UE transitions between HeNBs in a small cell network.

Note that with the examples provided above as well as numerous other examples provided herein interaction may be described in terms of one two three or four network elements. However this has been done for purposes of clarity and example only. In certain cases it may be easier to describe one or more of the functionalities of a given set of flows by only referencing a limited number of network elements. It should be appreciated that communication system and its teachings are readily scalable and can accommodate a large number of components as well as more complicated sophisticated arrangements and configurations. Accordingly the examples provided should not limit the scope or inhibit the broad teachings of communication system as potentially applied to a myriad of other architectures.

It is also important to note that the steps in the appended diagrams illustrate only some of the possible signaling scenarios and patterns that may be executed by or within communication system . Some of these steps may be deleted or removed where appropriate or these steps may be modified or changed considerably without departing from the scope of teachings provided herein. In addition a number of these operations have been described as being executed concurrently with or in parallel to one or more additional operations. However the timing of these operations may be altered considerably. The preceding flows and activities have been offered for purposes of example and discussion. Substantial flexibility is provided by communication system in that any suitable arrangements chronologies configurations and timing mechanisms may be provided without departing from the teachings provided herein.

Numerous other changes substitutions variations alterations and modifications may be ascertained to one skilled in the art and it is intended that the present disclosure encompass all such changes substitutions variations alterations and modifications as falling within the scope of the appended claims. In order to assist the United States Patent and Trademark Office USPTO and additionally any readers of any patent issued on this application in interpreting the claims appended hereto Applicant wishes to note that the Applicant a does not intend any of the appended claims to invoke paragraph six 6 of 35 U.S.C. section 112 as it exists on the date of the filing hereof unless the words means for or step for are specifically used in the particular claims and b does not intend by any statement in the specification to limit this disclosure in any way that is not otherwise reflected in the appended claims.

