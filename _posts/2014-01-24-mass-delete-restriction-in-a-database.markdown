---

title: Mass delete restriction in a database
abstract: In an approach for limiting mass deletions from database tables, a computer receives a deletion request corresponding to data in a database table. The computer determines whether the database table includes a restriction of a mass deletion. Responsive to determining the database table includes a restriction of a mass deletion of data from a database table, the computer determines whether the quantity of data in the deletion request exceeds the restriction of a mass deletion. Responsive to determining the quantity of data in the deletion request exceeds the restriction of a mass deletion, the computer prevents execution of the deletion request.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09405788&OS=09405788&RS=09405788
owner: International Business Machines Corporation
number: 09405788
owner_city: Armonk
owner_country: US
publication_date: 20140124
---
The present invention relates generally to the field of database management and more particularly to restricting mass deletion in a database.

Many business organizations have found that the importance and volume of business critical records is rapidly increasing. Because of this many companies are reevaluating their unstructured data strategy and are turning toward more reliable records management policies. Records management is the systematic and comprehensive control of the creation capture maintenance filing use and disposition of records. Records management aims to ensure that records contained in a database are authentic and reliable can be retrieved when needed as quickly and efficiently as possible and are not destroyed prematurely or kept longer than required. A record is any data item recorded information that is under records management control and subject to a life cycle. A record s life cycle refers to the events happening to the record during its life span from its creation or receipt to its final disposition. A record s life cycle is often described in three stages creation maintenance and use and final disposition. A set of retention rules policies are applied to the record over a defined time period.

Conventional database systems store data in the form of records or rows. Each row includes one or more related item s of information. For example a row can include the date number amount and customer for an order. Certain groups of rows are organized into tables. For example an Orders table can include all of the rows describing the characteristics of orders that have been received. Users of database systems manipulate and extract information from the tables and rows that make up the system. Such requests are conventionally referred to as queries. Queries can range in complexity from a request for the display of the information in a particular row to an accumulation of data regarding rows and tables that comprise terabytes of information. Users of database systems also insert delete and update the information stored in the tables and rows.

Embodiments of the present invention disclose a method computer program product and system for restricting mass deletions from database tables. A computer receives a deletion request corresponding to data in a database table. The computer determines whether the database table includes a restriction of a mass deletion. Responsive to determining the database table includes a restriction of a mass deletion of data from a database table the computer determines whether the quantity of data in the deletion request exceeds the restriction of a mass deletion. Responsive to determining the quantity of data in the deletion request exceeds the restriction of a mass deletion the computer prevents execution of the deletion request.

Data tables in a database management system DBMS are protected by security grants issued by the table owner. The owner can grant to a user the ability to delete records from the table. If a user has the ability to delete records from the table there is no limit to the number of rows that a user can delete in a single statement. The user executes a request using a data manipulation language DML for example a Structured Query Language SQL statement to delete records from the table. If the user makes a fairly simple error in the SQL statement the user can inadvertently delete all the records from the table.

Embodiments of the present invention recognize that data integrity can be maintained by restricting the number of rows that can be deleted from a database table by a user. Implementation of embodiments of the invention may take a variety of forms and exemplary implementation details are discussed subsequently with reference to the Figures.

As will be appreciated by one skilled in the art aspects of the present invention may be embodied as a system method or computer program product. Accordingly aspects of the present invention may take the form of an entirely hardware embodiment an entirely software embodiment including firmware resident software micro code etc. or an embodiment combining software and hardware aspects that may all generally be referred to herein as a circuit module or system. Furthermore aspects of the present invention may take the form of a computer program product embodied in one or more computer readable medium s having computer readable program code instructions embodied thereon.

Any combination of computer readable media may be utilized. Computer readable media may be a computer readable signal medium or a computer readable storage medium. A computer readable storage medium may be for example but not limited to an electronic magnetic optical electromagnetic infrared or semiconductor system apparatus or device or any suitable combination of the foregoing. More specific examples a non exhaustive list of a computer readable storage medium would include the following an electrical connection having one or more wires a portable computer diskette a hard disk a random access memory RAM a read only memory ROM an erasable programmable read only memory EPROM or Flash memory an optical fiber a portable compact disc read only memory CD ROM an optical storage device a magnetic storage device or any suitable combination of the foregoing. In the context of this document a computer readable storage medium may be any tangible medium that can contain or store a program for use by or in connection with an instruction execution system apparatus or device.

A computer readable signal medium may include a propagated data signal with computer readable program code embodied therein for example in baseband or as part of a carrier wave. Such a propagated signal may take any of a variety of forms including but not limited to electro magnetic optical or any suitable combination thereof. A computer readable signal medium may be any computer readable medium that is not a computer readable storage medium and that can communicate propagate or transport a program for use by or in connection with an instruction execution system apparatus or device.

Program code embodied on a computer readable medium may be transmitted using any appropriate medium including but not limited to wireless wireline optical fiber cable RF etc. or any suitable combination of the foregoing.

Computer program code for carrying out operations for aspects of the present invention may be written in any combination of one or more programming languages including an object oriented programming language such as Java note the term s Java may be subject to trademark rights in various jurisdictions throughout the world and are used here only in reference to the products or services properly denominated by the marks to the extent that such trademark rights may exist Smalltalk C or the like and conventional procedural programming languages such as the C programming language or similar programming languages. The program code may execute entirely on a user s computer partly on the user s computer as a stand alone software package partly on the user s computer and partly on a remote computer or entirely on the remote computer or server. In the latter scenario the remote computer may be connected to the user s computer through any type of network including a local area network LAN or a wide area network WAN or the connection may be made to an external computer for example through the Internet using an Internet Service Provider .

Aspects of the present invention are described below with reference to flowchart illustrations and or block diagrams of methods apparatus systems and computer program products according to embodiments of the invention. It will be understood that each block of the flowchart illustrations and or block diagrams and combinations of blocks in the flowchart illustrations and or block diagrams can be implemented by computer program instructions. These computer program instructions may be provided to a processor of a general purpose computer special purpose computer or other programmable data processing apparatus to produce a machine such that the instructions which execute via the processor of the computer or other programmable data processing apparatus create means for implementing the functions acts specified in the flowchart and or block diagram block or blocks.

These computer program instructions may also be stored in a computer readable medium that can direct a computer other programmable data processing apparatus or other devices to function in a particular manner such that the instructions stored in the computer readable medium produce an article of manufacture including instructions which implement the function act specified in the flowchart and or block diagram block or blocks.

The computer program instructions may also be loaded onto a computer other programmable data processing apparatus or other devices to cause a series of operational steps to be performed on the computer other programmable apparatus or other devices to produce a computer implemented process such that the instructions which execute on the computer or other programmable apparatus provide processes for implementing the functions acts specified in the flowchart and or block diagram block or blocks.

Implementation of embodiments of the invention may take a variety of forms and exemplary implementation details are discussed subsequently with reference to the figures. The embodiment illustrated in the figures describes the interaction of a relational database and query statements using SQL as the query language. Specific details disclosed herein are not to be interpreted as limiting but merely as a representative basis for teaching one skilled in the art to variously employ the methods and structures of the present disclosure. Embodiments of the present invention may apply to all database types including but not limited to relational hierarchical network and object oriented databases. Likewise embodiments of the present invention may apply to other query languages including but not limited to SQL QUEL OQL and SEQUEL.

The present invention will now be described in detail with reference to the Figures. is a functional block diagram illustrating a distributed data processing environment generally designated in accordance with one embodiment of the present invention. provides only an illustration of one implementation and does not imply any limitations with regard to the environments in which different embodiments may be implemented. Many modifications to the depicted environment may be made by those skilled in the art without departing from the scope of the invention as recited by the claims.

Distributed data processing environment includes client computing device and server computer all interconnected over network . Network can be for example a local area network LAN a wide area network WAN such as the Internet or a combination of the two and can include wired wireless or fiber optic connections. In general network can be any combination of connections and protocols that will support communications between client computing device and server computer .

Client computing device may be a desktop computer a laptop computer a tablet computer a specialized computer server a smart phone or any programmable electronic device capable of communicating with server computer via network and with various components and devices within distributed data processing environment . In general client computing device represents any programmable electronic device or combination of programmable electronic devices capable of executing machine readable program instructions and communicating with other computing devices via a network such as network . Client computing device includes client application .

Client application resides on client computing device . Client application is any application or program that a user employs to submit a query to server computer . A query is a request for data stored in tables in a database management system DBMS . Queries allow the user to describe desired data leaving the DBMS responsible for planning optimizing and performing the physical operations necessary to produce that result. A query includes a list of columns to be included in the final result. Queries are typically written in a data manipulation language such as Structured Query Language SQL a special purpose programming language designed for managing data held in a DBMS. SQL includes a data definition language DDL and a data manipulation language DML . The scope of SQL includes data insert query update and delete schema creation and modification and data access control.

Server computer may be a management server a web server or any other electronic device or computing system capable of receiving and sending data. In other embodiments server computer may represent a server computing system utilizing multiple computers as a server system such as in a cloud computing environment. In another embodiment server computer may be a laptop computer tablet computer netbook computer personal computer PC a desktop computer a personal digital assistant PDA a smart phone or any programmable electronic device capable of communicating with client computing device via network . In another embodiment server computer represents a computing system utilizing clustered computers and components to act as a single pool of seamless resources. Server computer includes database management system and database . Server computer may include internal and external hardware components as depicted and described in further detail with respect to .

Database management system DBMS resides on server computer . A DBMS is a program or group of programs that work in conjunction with the operating system to create process store retrieve control and manage data. It acts as an interface between the application program and the data stored in a database. The objective of a DBMS is to provide a convenient and effective method of defining storing and retrieving the information stored in the database. When the DBMS receives a query the query specifies the data that the user wants but not how to get to that data. DBMS includes delete restriction program .

Delete restriction program resides within DBMS . In an embodiment of the present invention delete restriction program provides a table owner with the ability to define a delete restriction for the table. When the table is created the table owner can specify that deletions from the table are restricted to a particular quantity of rows at a time. The table owner provides a threshold value that indicates the maximum quantity of rows that may be deleted by a statement or a query. For example at table create time the table owner provides a DELETION RESTRICTED TO x ROWS statement where x represents an integer value that indicates the threshold value. The x value is stored in the database metadata catalog along with all other table metadata. In the event that a user runs an SQL query that will delete more than x rows delete restriction program causes the SQL statement to fail. For example a table owner can specify that deletion of more than 1000 rows at a time is not allowed. A careless user is then prevented from deleting more than 1000 rows with one statement.

Database resides on server computer . A database is an organized collection of data. Database may be a relational or non relational database. Examples of relational databases include DB2 MySQL and Oracle . Examples of non relational databases include HBase MongoDB and OrientDB . Typically a database used by a DBMS is organized into tables with data being recognized by a row column location. Database stores the data that is accessed and managed by DBMS . In one embodiment database also includes the manual of SQLCODEs that are displayed as diagnostic messages when an SQL statement fails. In addition database may include a metadata catalog defined by a table owner for each table. The metadata catalog may include instructions and restrictions with respect to access of the table.

Delete restriction program receives a deletion request step . In one embodiment delete restriction program receives a query from client application . For example a user of client computing device may cause client application to send a query to database via an SQL statement. The query includes a request to delete a number of rows of data from a target table in database . For example a user may request that all rows that begin with the letter a are deleted from the table in database .

Delete restriction program determines whether the target table is protected by a delete restriction decision block . Delete restriction program reviews a metadata catalog for the table from which the user is requesting a deletion to determine whether the table owner has specified a limit to the number of deletions that can be made from the table at one time. In one embodiment the table owner has protected the table by providing a DELETION RESTRICTED TO x ROWS statement. If the target table is not protected no branch decision block delete restriction program allows the deletion not shown and ends execution.

If the target table is protected yes branch decision block delete restriction program determines whether the request is to delete more than x rows where x is threshold value decision block . In one embodiment the threshold value is an integer. For example if a user requests to delete all rows that begin with the letter a and the table owner has provided a statement such as DELETION RESTRICTED TO 1000 ROWS in the table metadata catalog delete restriction program determines whether the number of rows that start with the letter a exceeds 1000. In another embodiment the threshold value may be a percentage. For example if a user requests to delete all rows that begin with the letter a and the table owner has provided a statement to limit deletions to ten percent of the rows in the table delete restriction program determines whether the number of rows that start with the letter a exceeds ten percent of the rows in the table.

If the user requests to delete x rows or less no branch decision block delete restriction program allows the deletion not shown and ends execution. If the user requests to delete more than x rows yes branch decision block delete restriction program prevents the request from running step . In the previous example if delete restriction program determines that the number of rows that starts with the letter a is 2000 and the table owner has defined x as 1000 then delete restriction program prevents the deletion request from running.

Delete restriction program returns an error message for example a negative SQLCODE step . SQL Return Codes are used for the diagnosis of programming failures. The error diagnostic containing the SQL Return Code is held in the field SQLCODE within the database. The SQLCODE field contains the SQL return code. The code can be zero 0 negative or positive. If the user requests to delete more than x rows delete restriction program can return a negative SQLCODE that indicates the request has failed. The negative SQLCODE returned by delete restriction program is defined in database as part of the SQLCODE manual. In another embodiment the table owner may define a customized error message. For example the table owner may code an SQL message to read deletion request exceeds row limit so that the user understands why the deletion request failed.

In one embodiment when a user needs to delete more than x rows the user can request prior to sending a query to database via DBMS that the table owner either temporarily or permanently change the delete restriction. The table owner can change the delete restriction by issuing an ALTER command. For example a user may have a legitimate need to delete one million rows from a table however the delete restriction is set at 1000 rows. The user can contact the table owner and request that the table owner suspend the restriction for a defined brief period of time. The table owner issues an ALTER statement to allow the larger deletion. Upon completion of the user s deletion the table owner returns the delete restriction to the original setting.

In another embodiment when the table owner needs to delete more than x rows the table owner can remove the restriction by executing a DDL command such as ALTER TABLE mytable REMOVE DELETE RESTRICTION . Once the DDL command is complete the table owner can run the delete via SQL. Once the delete is complete the table owner uses another DDL command to put the restriction back on the table. Due to the process of taking two separate actions the table owner is less likely to make a mass delete error.

Server computer includes communications fabric which provides communications between computer processor s memory persistent storage communications unit and input output I O interface s . Communications fabric can be implemented with any architecture designed for passing data and or control information between processors such as microprocessors communications and network processors etc. system memory peripheral devices and any other hardware components within a system. For example communications fabric can be implemented with one or more buses.

Memory and persistent storage are computer readable storage media. In this embodiment memory includes random access memory RAM and cache memory . In general memory can include any suitable volatile or non volatile computer readable storage media.

Database management system delete restriction program and database are stored in persistent storage for execution and or access by one or more of the respective computer processors via one or more memories of memory . In this embodiment persistent storage includes a magnetic hard disk drive. Alternatively or in addition to a magnetic hard disk drive persistent storage can include a solid state hard drive a semiconductor storage device read only memory ROM erasable programmable read only memory EPROM flash memory or any other computer readable storage media that is capable of storing program instructions or digital information.

The media used by persistent storage may also be removable. For example a removable hard drive may be used for persistent storage . Other examples include optical and magnetic disks thumb drives and smart cards that are inserted into a drive for transfer onto another computer readable storage medium that is also part of persistent storage .

Communications unit in these examples provides for communications with other data processing systems or devices including client computing device . In these examples communications unit includes one or more network interface cards. Communications unit may provide communications through the use of either or both physical and wireless communications links. Database management system delete restriction program and database may be downloaded to persistent storage through communications unit .

I O interface s allows for input and output of data with other devices that may be connected to server computer . For example I O interface may provide a connection to external devices such as a keyboard keypad a touch screen and or some other suitable input device. External devices can also include portable computer readable storage media such as for example thumb drives portable optical or magnetic disks and memory cards. Software and data used to practice embodiments of the present invention e.g. database management system delete restriction program and database can be stored on such portable computer readable storage media and can be loaded onto persistent storage via I O interface s . I O interface s also connects to display .

The programs described herein are identified based upon the application for which they are implemented in a specific embodiment of the invention. However it should be appreciated that any particular program nomenclature herein is used merely for convenience and thus the invention should not be limited to use solely in any specific application identified and or implied by such nomenclature.

The flowchart and block diagrams in the Figures illustrate the architecture functionality and operation of possible implementations of systems methods and computer program products according to various embodiments of the present invention. In this regard each block in the flowchart or block diagrams may represent a module segment or portion of code which comprises one or more executable instructions for implementing the specified logical function s . It should also be noted that in some alternative implementations the functions noted in the block may occur out of the order noted in the figures. For example two blocks shown in succession may in fact be executed substantially concurrently or the blocks may sometimes be executed in the reverse order depending upon the functionality involved. It will also be noted that each block of the block diagrams and or flowchart illustration and combinations of blocks in the block diagrams and or flowchart illustration can be implemented by special purpose hardware based systems that perform the specified functions or acts or combinations of special purpose hardware and computer instructions.

