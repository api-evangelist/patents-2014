---

title: Apparatus and method for controlling access to a disk apparatus in an information processing system
abstract: An information processing apparatus including plural operation processing apparatuses and plural disk apparatuses, which are connected to each other via a switch. A management apparatus provides, in response to a loan request from a terminal, a first operation resource and a first storage resource of a first processing apparatus in which a first operation processing apparatus and a first disk apparatus are connected with each other through the switch, to the terminal through a network. The management apparatus releases the connection between the first operation processing apparatus and the first disk apparatus through the switch in response to a return request from the terminal and provides the first storage resource and a second operation resource of a second processing apparatus in which a second operation processing apparatus and the first disk apparatus are connected with each other through the switch, to the terminal through the network.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09363316&OS=09363316&RS=09363316
owner: FUJITSU LIMITED
number: 09363316
owner_city: Kawasaki
owner_country: JP
publication_date: 20140424
---
This application is based upon and claims the benefit of priority of the prior Japanese Patent Application 2013 117527 filed on Jun. 4 2013 the entire contents of which are incorporated herein by reference.

The embodiments discussed herein are related to apparatus and method for controlling access to a disk apparatus in an information processing system.

SIP Session Initiation Protocol servers have been distributed interconnecting the IP Internet Protocol phones serving as clients. Further a method for connecting storage devices to a network using a protocol called an Internet Small Computer Systems Interface iSCSI is being distributed. For example a method has been proposed improving the connectibility between a terminal connected to another local address system and an iSCSI storage device by using a protocol conversion apparatus which converts between the SIP and the iSCSI protocol See for example Japanese Patent Application Laid Open No. 2011 257793.

When a server connected to a security ensured network storage through a switch fails a method for connecting another server to the storage has been suggested by switching the switch to take over an existing security settings. See for example Japanese Patent Application Laid Open No. 2007 164394.

According to an aspect of the embodiments an information processing system includes an information processing apparatus and a management apparatus. The information processing apparatus includes a plurality of operation processing apparatuses a plurality of disk apparatuses and a switch apparatus which connects any one of the plurality of operation processing apparatuses to any one of the plurality of disk apparatuses. The management apparatus is configured to provide a first operation resource and a first storage resource of a first processing apparatus in which a first operation processing apparatus among the plurality of operation processing apparatuses and a first disk apparatus among the plurality of disk apparatuses are connected with each other through the switch apparatus to a terminal apparatus through a network in response to a loan request from the terminal apparatus connected to the plurality of operation processing apparatuses through the network and release the connection between the first operation processing apparatus and the first disk apparatus through the switch apparatus in response to a return request from the terminal apparatus and provide the first storage resource and a second operation resource of a second processing apparatus in which a second operation processing apparatus among the plurality of operation processing apparatuses and the first disk apparatus are connected with each other through the switch apparatus to the terminal apparatus through the network.

According to another aspect of the embodiments a management apparatus manages an information processing apparatus including a plurality of operation processing apparatuses a plurality of disk apparatuses and a switch apparatus which connects any one of the plurality of operation processing apparatuses to any one of the plurality of disk apparatuses. The management apparatus provide a first operation resource and a first storage resource of a first processing apparatus in which a first operation processing apparatus among the plurality of operation processing apparatuses and a first disk apparatus among the plurality of disk apparatuses are connected with each other through the switch apparatus to a terminal apparatus through a network in response to a loan request from the terminal apparatus connected to the plurality of operation processing apparatuses through the network. The management apparatus releases the connection between the first operation processing apparatus and the first disk apparatus through the switch apparatus in response to a return request from the terminal apparatus and provide the first storage resource and a second operation resource of a second processing apparatus in which a second operation processing apparatus among the plurality of operation processing apparatuses and the first disk apparatus are connected with each other through the switch apparatus to the terminal apparatus through the network.

According to yet another aspect of the embodiments a control method of an information processing system is provided which includes an information processing apparatus including a plurality of operation processing apparatuses a plurality of disk apparatuses and a switch apparatus which connects any of the plurality of operation processing apparatuses to any of the plurality of disk apparatuses and a management apparatus managing the information processing apparatus. The control method includes providing by the management apparatus a first operation resource and a first storage resource of a first processing apparatus in which a first operation processing apparatus among the plurality of operation processing apparatuses and a first disk apparatus among the plurality of disk apparatuses are connected with each other through the switch apparatus to the terminal apparatus through a network in response to a loan request from the terminal apparatus connected to the plurality of operation processing apparatuses through the network releasing by the management apparatus the connection between the first operation processing apparatus and the first disk apparatus through the switch apparatus in response to a return request from the terminal apparatus and providing by the management apparatus the first storage resource and a second operation resource of the second processing apparatus in which the second operation processing apparatus among the plurality of operation processing apparatuses and the first disk apparatus are connected with each other through the switch apparatus to the terminal apparatus through the network.

The object and advantages of the disclosure will be realized and attained by means of the elements and combinations particularly pointed out in the claims. It is to be understood that both the foregoing general descriptions and the following detailed descriptions are exemplary and explanatory and are not restrictive of the invention as claimed.

The information processing system the management apparatus and the control method of the information processing system which are disclosed in the present specification may access the disk apparatus during the return of the operation processing apparatus.

In the information processing system having a plurality of servers shared by multiple users in time division it is difficult to refer to data stored in a disk apparatus connected to the server during a period of time from the server is returned until the server is loaned again.

The management apparatus MNG connects for example an empty operation processing apparatus PSV1 to an empty disk apparatus DISK1 through the switch apparatus SW in response to a loan request from a terminal apparatus TM which is connected to the operation processing apparatus PSV through a network SNW. A processing apparatus PE1 which is loaned to the terminal apparatus TM is built by the connection between the operation processing apparatus PSV1 with the disk apparatus DISK1. Further the management apparatus MNG provides via the built processing apparatus PE1 an operation resource of the operation processing apparatus PSV1 and a storage resource of the disk apparatus DISK1 to the terminal apparatus TM through the network SNW. The bold line in indicates a state in which the management apparatus MNG has loaned an operation processing apparatus PSV0 and a disk apparatus DISK0 as a processing apparatus PE0 to the terminal apparatus TM and loaned the operation processing apparatus PSV1 and the disk apparatus DISK1 as the processing apparatus PE1 to the terminal apparatus TM. For example the terminal apparatus TM is connected to the network SNW through a network NW and a gateway GW and operated by a user US who borrows the processing apparatuses PE0 and PE1.

As illustrated in the control apparatus CNT serves to provide the disk apparatus DISK1 loaned as the processing apparatus PE1 to the terminal apparatus TM in the state in which the processing apparatus PE1 loaned to the terminal apparatus TM has been returned. The control apparatus CNT is an example of the operation processing apparatus. Meanwhile the control apparatus CNT may be configured using any one of the operation processing apparatuses PSVs within the information processing apparatus IPE. In this case the management apparatus MNG may manage the control apparatus CNT in the same way as the operation processing apparatus PSV and thus may easily manage the information processing system SYS1.

After the loan of the operation processing apparatus PSV1 to the terminal apparatus TM is stopped the management apparatus MNG connects the control apparatus CNT and the disk apparatus DISK1 through the switch apparatus SW to build a processing apparatus PE2. Further the management apparatus MNG provides the operation resource of the control apparatus CNT of and the storage resource of the disk apparatus DISK1 via the built processing apparatus PE2 to the terminal apparatus TM through the network SNW. Therefore the terminal apparatus TM may access the disk apparatus DISK1 using the operation resource of the control apparatus CNT after returning the processing apparatus PE1.

For example the storage resource of the disk apparatus DISK may become accessible by another operation processing apparatus PSV0 through the network NW by the control of the operation resource of the control apparatus CNT. In the bold line in the processing apparatus PE2 indicates a state in which the storage resource of the disk apparatus DISK1 within the processing apparatus PE1 returned from the terminal apparatus TM in is provided to the terminal apparatus TM without using the operation resource of the operation processing apparatus PSV1.

In the state illustrated in when again receiving the loan request for the processing apparatus PE1 which is being returned from the terminal apparatus TM the management apparatus MNG releases the connection between the control apparatus CNT and the disk apparatus DISK1 through the switch apparatus SW. Therefore the provision of the storage resource of the disk apparatus DISK1 to the terminal apparatus TM via the processing apparatus PE2 is stopped. Next the management apparatus MNG connects the operation processing apparatus PSV1 and the disk apparatus DISK1 through the switch apparatus SW to build the processing apparatus PE1 as illustrated in . Further the management apparatus MNG provides an operation resource of the operation processing apparatus PSV1 and a storage resource of the disk apparatus DISK1 via the built processing apparatus PE1 to the terminal apparatus TM through the network SNW. That is the connection within the information processing system SYS1 returns to the state illustrated in .

Meanwhile when the loan request for the processing apparatus PE1 being returned is issued from the terminal apparatus TM there may be a case in which the operation processing apparatus PSV1 is being loaned to another terminal apparatus TM. In this case the management apparatus MNG connects another empty operation processing apparatus PSV for example PSV2 and the disk apparatus DISK1 through the switch apparatus SW to build the processing apparatus PE1 illustrated in . Therefore the terminal apparatus TM may execute the data processing and the like by using the environment of the processing apparatus PE1 that is similar to that before the processing apparatus PE1 was returned. Further for example even when the information stored in the disk apparatus DISK1 is updated in a state of the processing apparatus PE1 being returned the operation processing apparatus PSV newly operated as the processing apparatus PE1 may refer to updated information of the disk apparatus DISK1. That is the reliability of the information stored in the disk apparatus DISK1 may be secured.

For example the control apparatus CNT may be configured to serve as a storage gateway and to provide the disk apparatus DISK1 as the iSCSI target by using the iSCSI protocol to the operation processing apparatus PSV and the terminal apparatus TM on the network SNW.

As described above in the embodiment illustrated in after returning the processing apparatus PE1 the terminal apparatus TM may access the disk apparatus DISK1 without using the operation processing apparatus PSV1. That is after returning the processing apparatus PE1 the terminal apparatus TM may access the information that was recorded in the disk apparatus DISK1 during a time period when the processing apparatus PE1 was loaned. Further the terminal apparatus TM may receive the loan of the processing apparatus PE1 again and then refer to for example the data which was updated and stored in the disk apparatus DISK1 during a time period when the processing apparatus PE1 was being returned.

For example there may be a case in which the processing apparatus PE1 is returned from the terminal apparatus TM and then all the operation processing apparatuses PSVs within the information processing apparatus IPE are loaned to a plurality of other terminal apparatuses TMs as the processing apparatus PE along with the disk apparatus DISK. In this case even though the loan request is issued from the terminal apparatus TM the terminal apparatus TM fails to receive the loan of the processing apparatus PE1. However the terminal apparatus TM may access the disk apparatus DISK through the processing apparatus PE2 which is built by the control apparatus CNT. In other words in the physical IaaS using the processing apparatus PE1 on demand the terminal apparatus TM user US may access the data that was used in the processing apparatus PE1 even when the previously loaned processing apparatus PE1 is being returned.

In an information processing system SYS2 includes a server pool SVP a disk pool DSKP the switch apparatus SW and the management apparatus MNG. The server pool SVP the disk pool DSKP and the switch apparatus SW serve as the information processing apparatus IPE which independently executes data processing from each other in response to requests from the terminal apparatuses TMs TM1 and TM2 corresponding to multiple users USs US1 and US2 . Although not especially limited the information processing system SYS2 may be configured to realize a service called a physical IaaS providing a physical server not a virtual machine for example among types of IaaS.

The server pool SVP has a plurality of servers PSVs. For example each server PSV includes a central processing unit CPU and a memory e.g. a main storage such as a memory module and is an example of the operation processing apparatus. The disk pool DSKP has a plurality of disk apparatuses DISKs. Meanwhile instead of the CPU each server PSV may have a processor such as a digital signal processor DSP and a graphics processing unit GPU which are operated by executing programs.

For example the disk apparatus DISK may be a hard disk drive HDD and a silicon disk apparatus such as a solid state drive SSD . Numerals attached to the end of labels PSVs and DISKs denoting the server PSV and the disk apparatus DISK indicate numbers identifying the server PSV and the disk apparatus DISK respectively. In the following description the numbers identifying the server PSV and the disk apparatus DISK are called identification ID . Meanwhile the number of servers PSVs to be accommodated in the server pool SVP is not limited to 64 and the number of disk apparatuses DISKs to be accommodated in the disk pool DSKP may not be limited to 256.

The switch apparatus SW has ports respectively connected to the servers PSV and ports respectively connected to the disk apparatuses DISKs. The switch apparatus SW connects a server PSV to a predetermined disk apparatus DISK or blocks a connection between a server PSV and a disk apparatus DISK under the control of the management apparatus MNG.

The server PSV and the management apparatus MNG are connected to the network SNW. For example the network SNW is connected to the terminal apparatuses TMs e.g. TM1 and TM2 that are used respectively by the users USs e.g. US1 and US2 of the information processing system SYS2 through the gateway GW and the network NW. The number of users USs and the number of terminal apparatuses TMs may not be limited to two 2 . The user US carries out or breaks a contract for using the information processing system SYS2 by inputting predetermined information to the terminal apparatuses TMs and carries out loan or return of the server PSV and the disk apparatus DISK during the contract period.

A predetermined number of servers PSVs e.g. three including PSV31 and PSV63 may not be loaned to the user US but operated as the storage gateway SGW under the control of the management apparatus MNG. For example a server PSV operated as the storage gateway SGW and a server PSV loaned to the user US are differentiated in advance. When the management apparatus MNG receives the return requests of the server PSV and the disk apparatus DISK from the terminal apparatus TM the storage gateway SGW allows the terminal apparatus TM to access the returned disk apparatus DISK as the network disk.

The rectangular frame depicted by the bold dashed line illustrates an example of a logical platform LPSGW which includes a logical server LSV operated as the storage gateway SGW. For example the management apparatus MNG allocates the logical platform LPSGW to a logical platform LP255 and sets the ID of the logical platform LPSGW at 255 .

The bold broken line shows a correspondence relationship between the logical server LSV which is defined within the logical platforms LP and LPSGW and the server PSV. In the following description the server PSV is called as the physical server PSV. For example the logical server LSV within the logical platforms LP and LPSGW is a processor which performs data processing a memory and a disk apparatus.

In each logical platform LP the logical server LSV e.g. the rectangular frame illustrated by the solid line which is connected by the bold broken line represents a logical server which is loaned by a request from the user US and thus is in a loaned state. The logical server LSV which is illustrated by the solid line rectangular frame within the logical platform LP and built by the server PSV and the disk apparatus DISK which are connected to each other by the bold solid line represents a processing apparatus and thus is being loaned to the terminal apparatus TM. In other words the logical server LSV which is illustrated by the solid line rectangular frame represents an operation resource of the processing apparatus. The disk apparatus listed in the logical server LSV which is illustrated by the solid line rectangular frame represents a storage resource of the processing apparatus and the numerals attached to the disk apparatus within the logical server LSV represent the numbers of the disk apparatuses DISKs which are being loaned among the disk apparatuses within the disk pool DSKP.

In each logical platform LP the logical server LSV which is illustrated by the broken line rectangular frame represents a processing apparatus which is returned by the request from the user US and thus is in the returned state. The processing apparatus being in the returned state is not made associated with the server PSV not connected by the solid broken line . In a logical platform LP2 a thin dashed line which connects the logical server LSV to the disk apparatus DISK points to the disk apparatus DISK which was accessible by the logical server LSV before the logical server LSV is returned from the user US2.

The bold dashed line represents that the disk apparatus DISK which was accessible by the logical server LSV returned by the user US is made accessible through the storage gateway SGW. For example the use of the disk apparatus DISK as a logical disk LDISK is registered in advance such that the disk apparatus DISK may be accessed from the terminal apparatus TM through the storage gateway SGW even after the user US has returned the logical server LSV.

The disk apparatus DISK returned from the user US is a logical disk LDISK LDISK1 within a logical storage apparatus LSTRG LSTRG2 and may be accessed by another logical server LSV LSV3 which is being loaned. It is illustrated that a logical storage apparatus LSTRG1 illustrated by the broken line frame does not include the mounted logical disk LDISK and is deleted from the logical platform LP1.

In the logical platform LPSGW it is illustrated that the logical server LSV solid line rectangular frame connected by the bold broken line is being operated as the storage gateway SGW. For example the storage gateway SGW logical server LSV0 which is depicted by the solid line rectangular frame represents a processing apparatus which is built by a server PSV31 and a disk apparatus DISK127 which are connected to each other by the bold solid line. In other words the storage gateway SGW which is depicted by the solid line rectangular frame represents an operation resource of the processing apparatus. The disk apparatus listed in the storage gateway SGW which is depicted by the solid line rectangular frame represents a storage resource of the processing apparatus and numerals attached to the disk apparatus within the logical server LSV represents a number of the disk apparatus DISK which is being returned among disk apparatuses within the disk pool DSKP.

In the logical platform LPSGW it is illustrated that the logical server LSV depicted by the broken line rectangular frame is not being operated as the storage gateway SGW. For example the physical server PSV corresponding to the storage gateway SGW which is not being operated is shut down and thus does not consume power.

In the example illustrated in the terminal apparatus TM1 of the user US1 is connected to the information processing system SYS2 through the logical servers LSV0 and LSV1 which are defined in the logical platform LP1. For example the logical server LSV0 represents a processing apparatus which is built by a physical server PSV10 and a disk apparatus DISK10 which are connected to each other through the switch apparatus SW. The logical server LSV1 represents a processing apparatus which is built by the physical server PSV2 and disk apparatuses DISK12 DISK64 and DISK126 which are connected to each other through the switch apparatus SW.

The terminal apparatus TM2 of the user US2 is connected to the information processing system SYS2 through the logical servers LSV1 and LSV3 which are defined in the logical platform LP2. For example the logical server LSV1 represents a processing apparatus which is built by the physical server PSV0 and disk apparatuses DISK0 and DISK65 which are connected to each other through the switch apparatus SW. The logical server LSV3 represents a processing apparatus which is built by a physical server PSV11 and a disk apparatus DISK62 which are connected to each other through the switch apparatus SW.

The logical servers LSV0 and LSV2 which are defined in the logical platform LP2 are being returned by the user US2. During the loan period of the logical server LSV0 the disk apparatus DISK127 which is defined as the storage resource of the logical server LSV0 may be accessed as the logical disk LDISK1 mounted in the logical storage apparatus LSTRG2. For example the logical disk LDISK1 which is mounted in the logical storage apparatus LSTRG2 may be accessed by the logical server LSV3 which is being loaned. For example the disk apparatus DISK2 that was accessed from the logical server LSV2 during the loan period of the logical server LSV2 is not connected to the storage gateway SGW since the use as the logical disk LDISK is not registered.

The server LSV0 which is defined in the logical platform LPSGW operated as the storage gateway SGW provides the disk apparatus DISK127 on the logical platform LP2 as the logical disk LDISK1. For example the logical storage apparatus LSTRG is allocated into the logical platform LP as the iSCSI target by using the iSCSI protocol. The logical disk LDISK is allocated with a logical unit number LUN within the iSCSI target and is identified by the LUN.

Each rack RCK is installed with a switch Top of Rack TOR SW TOR SW0 TOR SW1 . . . TOR SWn which is connected to the servers PSVs within the rack RCK. Each switch TOR SW is connected to the network SNW through a switch End of Rack EOR SW .

When the physical server PSV is allocated as the logical server LSV of the logical platform LP the switch TOR SW changes the setting of the network SNW of VLAN and the like based on the instruction from a network control unit NWCNT of the management apparatus MNG.

When the network SNW is the VLAN the VLAN setting between the physical server PSV which is loaned to the user US and the switch TOR SW is set in a port VLAN. Further the switch TOR SW communicates with the server PSV by using a packet without a tag.

Meanwhile the VLAN setting between the physical server PSV which is operated as the storage gateway SGW and the switch TOR SW is set in a tag VLAN. Further the switch TOR SW communicates with the server PSV by using a packet for example tag VLAN with a tag. The switch TOR SW communicates with the switch EOR SW using the packet with the tag.

The user management unit USMNG manages the user US and the logical platform LP defined based on the request from the user US by using a database USDB. For example the user management unit USMNG registers the setting information of the logical platform LP in the database USDB based on the operation of the user US on a portal screen displayed on a display of the terminal apparatus TM. An example of the database USDB is illustrated in .

The resource management unit RSMNG includes a physical server management unit PSVM a disk pool management unit DSKPM and a logical server management unit LSVM.

The physical server management unit PSVM manages the physical disposition and the like of the server PSV that is installed in the rack RCK illustrated in by using a database PSVDB. Further the physical server management unit PSVM manages the loan of the server PSV to the user US and the return of the server PSV from the user US by using the database PSVDB. An example of the database PSVDB is illustrated in .

The disk pool management unit DSKPM manages the specifications of the disk apparatus DISK stored in the disk pool DSKP and manages the connection state between each disk apparatus DISK and the server PSV by using a database DSKDB. An example of the database DSKDB is illustrated in .

The logical server management unit LSVM manages the ID of the logical server LSV defined in the logical platform LP and manages the loan and the return of the logical server LSV defined in the logical platform LP by using a database LSVDB. For example the logical server management unit LSVM manages the connection state between the logical server LSV and the server PSV and manages the mapping of the disk apparatus DISK accessed by the logical server LSV. An example of the database LSVDB is illustrated in .

The resource control unit RSCNT includes a network control unit NWCNT a switch control unit SWCNT and a storage gateway control unit SGWCNT.

The network control unit NWCNT controls the setting of the switches TOR SW and EOR SW on the network SNW by using a database NSWDB to allocate the physical server PSV as the logical server LSV on the logical platforms LP and LPSGW. An example of the database NSWDB is illustrated in .

The switch control unit SWCNT controls the connection and the disconnection between disk apparatuses DISKs within the disk pool DSKP and servers PSVs including a storage gateway SGW within the server pool SVP.

The storage gateway control unit SGWCNT controls the storage gateway SGW based on the setting of the logical platform LP by the user US. The storage gateway SGW generates the logical storage apparatus LSTRG on the logical platform LP based on the control by the storage gateway control unit SGWCNT to generate the logical disk LDISK within the logical storage apparatus LSTRG. Further the storage gateway SGW deletes the logical storage disk LDISK within the logical storage apparatus LSTRG based on the control by the storage gateway control unit SGWCNT and deletes the logical storage apparatus LSTRG on the logical platform LP.

The user ID indicates an ID of the user US US1 and US2 that uses the information processing system SYS2 and an ID of the storage gateway SGW. The LPID indicates a number identifying the logical platform LP. The NWID LP indicates an ID network number identifying a network segment that is obtained by dividing the network SNW in association with the logical platforms LP and SPSGW for example an ID of the virtual local area network VLAN . The logical platforms LP and SPSGW may be identified by the NWID LP .

The IP address range LP indicates a range of the IP address that is allocatable to the logical platforms LP and LPSGW. The LSV list indicates the numbers of all of the logical servers LSVs which are defined e.g. contracted by the user US. The IP address LSTRG is an IP address of the logical storage apparatus LSTRG e.g iSCSI target which is generated in the logical platform LP. The logical storage apparatus LSTRG is each generated for each logical platform LP. The LSTRG name is a name e.g. an iSCSI target name of the logical storage apparatus LSTRG which is generated in the logical platform LP.

For example the model indicates the kind of physical server PSV and the serial number indicates a manufacturing number of the physical server PSV. The state flag indicates whether the physical server PSV is being loaned or empty. For example the state flag is set at 1 when the physical server PSV is being loaned and is reset at 0 when the physical server PSV is empty.

The rack number indicates a number of the rack RCK in which the physical server PSV is accommodated and the slot number indicates a slot number within the rack RCK in which the physical server PSV is accommodated. The TOR number indicates a number of a switch TOR SW number to which the physical server PSV is connected and the TOR port number indicates a port number of the switch TOR SW to which the physical server PSV is connected. The SW port number indicates a port number of the switch apparatus SW to which the physical server PSV is connected.

The unique address indicates an address uniquely allocated to each disk apparatus DISK and the model represents the type and the capacity of the disk apparatus DISK. The connection PSV indicates an ID of the physical server PSV which is connected to the disk apparatus DISK. The number 1 stored in the field of the connection PSV indicates that the corresponding disk apparatus DISK is not connected to any physical server PSV.

The allocation LP indicates an ID of the logical platform LP which is allocated to the disk apparatus DISK. The number 1 stored in the region of the allocation LP indicates that the corresponding disk apparatus DISK is not allocated to any logical platform LP. The allocation LSV indicates an ID of the logical server LSV which is allocated to the disk apparatus DISK. The number 1 stored in the field of the allocation LSV indicates that the corresponding disk apparatus DISK is not allocated to any logical server LSV.

The connection LDISK indicates a number of the logical disk LDISK which is allocated for each logical platform LP in association with each disk apparatus DISK. The number 1 stored in the field of the connection LDISK indicates that the corresponding disk apparatus DISK is not generated in the logical platform LP as the logical disk LDISK. For example when the logical storage apparatus LSTRG is connected to the logical platform LP as the iSCSI target the numerical value stored in the field of the connection LDISK is LUN.

The LPID indicates the number allocated to the logical platform LP and the LSVID indicates the number of the logical server LSV which is allocated to each logical platform LP. The OS type indicates the type of operating system which is installed in the logical server LSV and the allocation PSV indicates the number of physical server PSV which is allocated to each logical server LSV. The number 1 stored in the region of the allocation PSV indicates that the corresponding logical server LSV is not connected e.g. being returned to any physical server PSV.

The DISK list indicates the list of numbers of the disk apparatuses DISKs which are linked to each logical server LSV. The LSTRG name list indicates the list of names of logical storage apparatuses LSTRGs which are being executed by the logical server LSV operated as the storage gateway SGW. In the example illustrated in the storage gateway SGW corresponding to the logical server LSV of which the number is zero 0 is allocating the logical storage apparatus LSTRG which is defined within the logical platforms LP1 and LP2 e.g. users US1 and US2 .

Meanwhile in this example since the logical storage apparatus LSTRG is allocated using the plurality of storage gateways SGWs the LSTRG name list is added to the database LSVDB. To the contrary when the logical storage apparatus LSTRG is implemented using one storage gateway SGW the database LSVDB does not have a field of the LSTRG name list. None represented in the field in which the DISK list and the LSTRG name list are stored indicates a non used field.

The switch ID indicates the number for identifying each switch the switch type indicates a differentiation between switches TOR SW and EOR SW and the rack number indicates the number of the rack RCK in which the switch TOR SW is installed. None depicted in the field in which the rack number is to be stored indicates that the rack number is not present. The IP address is used for management and used when the management apparatus MNG accesses the switches TOR SW and EOR SW.

The LSTRG control unit generates the logical storage apparatus LSTRG based on the NWID LP the IP address of the logical storage apparatus LSTRG and the LSTRG name which are received from the management apparatus MNG along with the instruction for generating the logical storage apparatus LSTRG. The management apparatus MNG reads the NWID LP the IP address of the logical storage apparatus LSTRG and the LSTRG name from the database USDB illustrated in and notifies the LSTRG control unit of the read contents.

The LSTRG control unit deletes the logical storage apparatus LSTRG based on the NWID LP and the IP address of the logical storage apparatus LSTRG which are received from the management apparatus MNG along with the instruction for deleting the logical storage apparatus LSTRG.

The LDISK control unit registers the logical disk LDISK in the instructed logical storage apparatus LSTRG based on the LSTRG name and the ID of the disk apparatus DISK which are received from the management apparatus MNG along with the instruction for adding the logical disk LDISK.

After the logical disk LDISK is registered the terminal apparatus TM user US logs in the IP address of the logical storage apparatus LSTRG through the logical server LSV which is being loaned and thus may access the returned disk apparatus DISK as the logical disk LDISK. That is even after returning the physical server PSV and the disk apparatus DISK which is linked to the physical server PSV the terminal apparatus TM may access the disk apparatus DISK without using the logical server LSV on the physical server PSV e.g. the logical server LSV on the logical platform LP .

The LDISK control unit deletes the logical disk LDISK from the logical storage apparatus LSTRG for which the deletion is instructed based on the LSTRG name and the number of the connection LDISK which are received from the management apparatus MNG along with the instruction for deleting the logical disk LDISK. Meanwhile illustrates a state in which all the accessible logical disks LDISKs are registered in the logical storage apparatuses LSTRG1 and LSTRG2 respectively.

The storage gateway SGW has a virtual network interface for each NWID LP which identifies each logical platform LP. For example when the NWID LP is a VLAN ID a physical network interface eth0 is distributed to virtual network interfaces eth0.1001 eth0.1002 and eth0.1255 which correspond to the VLAN IDs respectively. The VLAN ID is a value of the NWD LP illustrated in .

The switch TOR SW of the rack RCK in which the storage gateway SGW is installed communicates with the storage gateway SGW by using the packet for example tag VLAN with a tag. Therefore for example the logical storage apparatus LSTRG belonging to the logical platform LP1 is not referenced from another logical platform LP2. Therefore the logical storage apparatuses LSTRGs defined in the plurality of logical platforms LPs may be independently provided by one storage gateway SGW. That is a storage system complying with a multi tenant may be built by one storage gateway SGW.

In plural pieces of software for the logical storage apparatus LSTRG such as an iSCSI target is executed on a storage gateway SGW. However a virtual machine monitor is executed on the storage gateway SGW and the plural pieces of software for the logical storage apparatus LSTRG may be executed on a plurality of virtual machines each connected to the network of the user US.

In the logical server LSV0 defined in the logical platform LP1 is returned in response to a request from the terminal apparatus TM1 user US1 of which the state is illustrated by the broken line frame. The management apparatus MNG causes the switch apparatus SW to release the connection between the operation processing apparatus PSV10 and the disk apparatus DISK10 based on the return request for the logical server LSV0. For this reason a bold broken line which represents the correspondence between the physical server PSV10 and the logical server LSV0 on the logical platform LP1 and a bold solid line which represents the connection between the physical server PSV10 and the disk apparatus DISK10 are deleted in . Further the returned logical server LSV0 and the disk apparatus DISK10 which was connected to the logical server LSV0 prior to the return are connected to each other by a thin dashed line.

Meanwhile the management apparatus MNG connects the operation processing apparatus PSV63 and the disk apparatus DISK10 to each other through the switch apparatus SW to build the logical server LSV1 storage gateway SGW processing apparatus on the logical platform LPSGW. The logical server LSV1 on the logical platform LPSGW represents the operation resource of the processing apparatus. The disk apparatus listed in the logical server LSV1 represents the storage resource of the processing apparatus and numerals attached to the disk apparatus within the logical server LSV shows the number of the disk apparatus DISK which is returned within the disk pool DSKP. Further the management apparatus MNG provides the operation resource and the storage resource of the logical server LSV1 processing apparatus on the logical platform LPSGW to the terminal apparatus TM1 through the network SNW.

For example the returned disk apparatus DISK10 is defined in the logical platform LP1 as the logical disk LDISK1 of the logical storage apparatus LSTRG1. For this reason in a bold sold line is added which represents the connection between the disk apparatus DISK10 and the physical server PSV63 operated as the storage gateway SGW. Further a bold broken line is added which represents that the physical server PSV63 is allocated as the logical server LSV1 of the logical platform LPSGW. Further a bold dashed line is added which represents that the logical server LSV1 operated as the storage gateway SGW allocates the disk apparatus DISK10 as the logical disk LDISK1. A line of the logical storage apparatus LSTRG1 and the logical disk LDISK1 is changed from the broken line of to a solid line which represents that they are being used.

Allocation of the disk apparatus DISK10 as the logical disk LDISK1 by the logical server LSV1 is determined by the value stored in the connection LDISK field of the database DSKDB illustrated in . Further realization of the storage gateway SGW for the disk apparatus DISK10 by the physical server PSV63 is determined by the value stored in the allocation PSV field of the database LSVDB illustrated in .

Meanwhile when the terminal apparatus TM1 e.g. user US1 again requests the loan of the logical server LSV0 the connection state of the information processing system SYS2 is changed from the state illustrated in FIG. 13 to the state illustrated in . The information stored in the disk apparatus DISK separated from the physical server PSV by the return process is kept without being cleared. In this way the user US may again request the loan of the logical server LSV to use the returned disk apparatus DISK. Further even after returning the logical server LSV the user may access the returned disk apparatus DISK through the storage gateway SGW.

When the logical server LSV0 that is when the physical server PSV10 of the logical platform LP1 is returned the management apparatus MNG changes the content of the field of the state flag corresponding to the physical server PSV10 from a loan state to an empty state. Further the management apparatus MNG changes the field of the state flag corresponding to the physical server PSV63 from the empty state to the loan state. The states of other fields of the database PSVDB are the same as those of .

Meanwhile the management apparatus MNG determines whether the logical server LSV0 of the logical platform LP1 corresponds to the physical server PSV10 based on the values stored in the fields for a LPID a LSVID and an allocation PSV of the database LSVDB illustrated in . Further the management apparatus MNG determines whether the logical server LSV1 of the logical platform LPSGW LP255 corresponds to the physical server PSV63 based on the values stored in the fields for a LPID a LSVID and an allocation PSV of the database LSVDB illustrated in .

When the loan request for the logical server LSV is received from the terminal apparatus TM user US at step S the management apparatus MNG refers to the database LSVDB illustrated in to read the information stored in the field corresponding to the logical server LSV which is requested to be loaned. For example the value stored in the field of the allocation PSV is read.

Next at step S the management apparatus MNG determines whether the logical server LSV which is requested to be loaned is being allocated to the physical server PSV based on the value read from the field of the allocation PSV of the database LSVDB. When it is determined that the logical server LSV is not being allocated to the physical server PSV the processing proceeds to step S. When the logical server LSV is being allocated to the physical server PSV the process proceeds to step S.

At step S the management apparatus MNG determines whether the disk apparatus DISK linked to the logical server LSV which is requested to be loaned is present based on the information read from the database DSKDB. Further when it is determined that the disk apparatus DISK linked to the logical server LSV is present the management apparatus MNG determines whether the physical server PSV is being connected to the disk apparatus DISK based on the value stored in the field of the connection PSV of the database DSKDB. When it is determined that the physical server PSV is being connected to the disk apparatus DISK the process proceeds to step S. When the disk apparatus DISK linked to the logical server LSV which is requested to be loaned is not present or when the physical server PSV is not connected to the disk apparatus DISK the process proceeds to step S.

At step S the management apparatus MNG determines whether the disk apparatus DISK linked to the logical server LSV which is requested to be loaned is being connected to the storage gateway SGW based on the value stored in the field of the connection PSV of the database DSKDB. When it is determined that the disk apparatus DISK is being connected to the storage gateway SGW the processing proceeds to step S. When the disk apparatus DISK is not connected to the storage gateway SGW the process proceeds to step S.

At step S the management apparatus MNG determines whether the logical disk LDISK allocating the disk apparatus DISK linked to the logical server LSV which is requested to be loaned is being used in a logical server LSV other than a logical server LSV which is requested to be loaned. For example the management apparatus MNG inquires the storage gateway SGW whether the logical disk LDISK allocating the disk apparatus DISK is being used and receives a reply from the storage gateway SGW. When it is determined that the logical disk LDISK is being used the process proceeds to step S to avoid the occurrence of a problem due to the deletion of the logical disk LDISK from the logical storage apparatus LSTRG. Meanwhile when the disk apparatus DISK is not used as the logical disk LDISK the process proceeds to step S and thus the processing for deleting the logical disk LDISK is executed.

At step S the management apparatus MNG reads the name of the logical storage apparatus LSTRG from the LSTRG name field of the database USDB illustrated in . Further in the database DSKDB illustrated in the management apparatus MNG reads the unique address of the disk apparatus DISK linked to the logical server LSV which is requested to be loaned and a number assigned to the logical disk LDISK connection LDISK .

The management apparatus MNG instructs the storage gateway SGW to delete the logical disk LDISK by notifying the storage gateway SGW of the name of the logical storage apparatus LSTRG the unique address of the disk apparatus DISK and the number of the logical disk LDISK. The storage gateway SGW deletes the logical disk LDISK based on the instruction from the management apparatus MNG.

Next at step S the management apparatus MNG determines the number of other logical disks LDISKs allocated to the logical storage apparatus LSTRG from which the logical disk LDISK is deleted. When the other logical disks LDISKs allocated to the logical storage apparatus LSTRG are not present the process proceeds to step S and thus the processing which deletes the logical storage apparatus LSTRG is executed. When the other logical disks LDISs allocated to the logical storage apparatus LSTRG are present the process proceeds to step S.

At step S the management apparatus MNG reads the name LSTRG name of a logical storage apparatus LSTRG to be deleted from the database USDB illustrated in . Further the management apparatus MNG instructs the storage gateway SGW to delete the logical storage apparatus LSTRG by notifying the storage gateway SGW of the name of the logical storage apparatus LSTRG. The storage gateway SGW deletes the logical storage apparatus LSTRG from the logical platform LP providing the logical server LSV which is requested to be loaned based on the instruction from the management apparatus MNG.

Meanwhile when the logical storage apparatus LSTRG to which the logical disk LDISK is not allocated is allowed to be present on the logical platform LP the processing of steps S and S may be omitted.

At step S the management apparatus MNG reads the number of the physical server PSV allocated to the storage gate SGW which has deleted the logical disk LDISK from the allocation PSV field of the database LSVDB illustrated in . Further the management apparatus MNG determines the number of the disk apparatus DISK connected to the physical server PSV allocated to the storage gate SGW from the database DSKDB illustrated in .

The management apparatus MNG instructs the switch apparatus SW to separate the disk apparatus DISK allocated to the logical disk LDISK from the physical server PSV by notifyings the switch apparatus SW of the number of the physical server PSV and the number of the disk apparatus DISK. For example the instruction to separate the disk apparatus DISK from the physical server PSV is executed by the switch control unit SWCNT illustrated in . The switch apparatus SW separates the disk apparatus DISK from the physical server PSV based on the instruction from the switch control unit SWCNT. That is the disk apparatus DISK corresponding to the deleted logical disk LDISK is separated from the storage gateway SGW.

Meanwhile when it is determined that the logical disk LDISK is being used the management apparatus MNG notifies the terminal apparatus TM of the user US of a stop request for stopping the use of the logical disk LDISK at step S. For example the terminal apparatus TM notified of the stop request from the management apparatus MNG causes another logical server LSV accessing the logical disk LDISK to stop access to the logical disk LDISK. Therefore it is possible to avoid an occasion that the logical disk LDISK which another logical server LSV is accessing is being suddenly blocked and thus it is possible to improve the reliability of data processing which are executed by the logical server LSV loaned from the information processing system SYS2.

Next at step S the management apparatus MNG notifies the terminal apparatus TM of the user US that the loan of the logical server LSV fails and ends the loan process.

Meanwhile at step S the management apparatus MNG refers to the database PSVDB illustrated in to investigate the use situation of the physical server PSV. For example the physical server PSV of which the state flag is the empty state is searched.

At step S the management apparatus MNG determines whether the empty physical server PSV is present based on the search result of the state flag of the database PSVDB. When the empty physical server PSV is present the process proceeds to step S and thus the processing for loaning the empty physical server PSV as the logical server LSV is executed. When the empty physical server PSV is not present the process proceeds to step S and thus the processing for notifying the user US of the loan failure of the logical server LSV is executed.

At step S the management apparatus MNG instructs the switch apparatus SW to connect the empty physical server PSV and the disk apparatus DISK by notifying the switch apparatus SW of the number assigned to the empty physical server PSV and the number assigned to the disk apparatus DISK linked to the logical server LSV which is requested to be loaned. The switch apparatus SW connects the empty physical server PSV and the disk apparatus DISK based on the instruction from the management apparatus MNG.

Next at step S the management apparatus MNG refers to the database USDB illustrated in the database PSVDB illustrated in and the database NSWDB illustrated in . For example the management apparatus MNG reads the information stored in the field of the IP address range LP which corresponds to the user US who has requested a loan in the database USDB. The management apparatus MNG reads a TOR number corresponding to the empty physical server PSV a number of the switch TOR SW stored in the field of the TOR port number and a port number of the switch TOR SW in the database PSVDB. Further the management apparatus MNG reads an IP address corresponding to the number of the switch TOR SW read from the database PSVDB in the database NSWDB.

At step S the management apparatus MNG accesses the switch TOR SW connected to the empty physical server PSV to change the network setting of the switch TOR SW based on the information read at step S. As a result the empty physical server PSV is loaned to the user US as the logical server LSV and the loan process ends.

When the return request for the logical server LSV is received from the terminal apparatus TM user US the management apparatus MNG refers to the database LSVDB illustrated in to read the information stored in the field corresponding to the logical server LSV which is requested to be returned at step S. For example the value stored in the field of the allocation PSV is read.

Next at step S the management apparatus MNG determines whether the logical server LSV which is requested to be returned is being allocated to the physical server PSV based on the value read from the field of the allocation PSV of the database LSVDB. When it is determined that the logical server LSV is being allocated to the physical server PSV the process proceeds to step S. When the logical server LSV is not being allocated to the physical server PSV the processing proceeds to step S.

At step S the management apparatus MNG refers to the database DSKDB illustrated in the database USDB illustrated in and the database NSWDB illustrated in .

At step S the management apparatus MNG determines whether the physical server PSV allocated as the logical server LSV which is requested to be returned and the disk apparatus DISK connected to the physical server PSV are present based on the information read from the database DSKDB. When it is determined that the physical server PSV and the disk apparatus DISK are present the process proceeds to step S. When the physical server PSV and the disk apparatus DISK are not present the processing proceeds to step S.

At step S the management apparatus MNG changes the network setting of the switch TOR SW connected to the physical server PSV allocated as the logical server LSV which is requested to be returned based on the information read at step S. As a result a network path to the physical server PSV allocated as the logical server LSV which is requested to be returned is blocked.

Next at step S the management apparatus MNG reads a number of the physical server PSV allocated as the logical server LSV which is requested to be returned from the allocation PSV field of the database LSVDB illustrated in . Further the management apparatus MNG reads a number of the disk apparatus DISK connected to the logical server LSV which is requested to be returned from the field of the DISK list of the database LSVDB.

The management apparatus MNG notifies the switch apparatus SW of a number of the physical server PSV and a number of the disk apparatus DISK to instruct the separation of the disk apparatus DISK allocated to the logical disk LDISK from the physical server PSV. For example the instruction to separate the disk apparatus DISK from the physical server PSV is executed by the switch control unit SWCNT illustrated in . The switch apparatus SW separates the disk apparatus DISK from the physical server PSV based on the instruction from the switch control unit SWCNT.

Next at step S the management apparatus MNG determines whether the disk apparatus DISK corresponding to the logical server LSV which is requested to be returned is being used as the logical disk LDISK. When it is determined that the logical disk LDISK is being used the process proceeds to step S. Otherwise when the disk apparatus DISK is not being used as the logical disk LDISK the processing proceeds to step S.

Next at step S the management apparatus MNG reads a number of the physical server PSV from the field of the allocation PSV of the storage gateway SGW corresponding to the logical server LSV which is requested to be returned in the database LSVDB illustrated in . Further the management apparatus MNG notifies the switch apparatus SW of the number of the physical server PSV and the number of the disk apparatus DISK notified at step S to instruct the connection between the disk apparatus DISK and the physical server PSV operated as the storage gateway SGW. For example the instruction to connect the physical server PSV and the disk apparatus DISK is executed by the switch control unit SWCNT illustrated in . The switch apparatus SW connects the disk apparatus DISK and the physical server PSV based on the instruction from the switch control unit SWCNT.

At step S the management apparatus MNG determines whether the logical storage apparatus LSTRG is present on the logical platform LP corresponding to the logical server LSV which is requested to be returned. For example the management apparatus MNG determines that the storage apparatus LSTRG is present when the state flag of the physical server PSV corresponding to the storage gateway SGW indicates that the PSV is being loaned in the database PSVDB illustrated in . When it is determined that the logical storage apparatus LSTRG is present the process proceeds to step S. Otherwise when the logical storage apparatus LSTRG is not present the process proceeds to step S and thus the processing to set the logical storage apparatus LSTRG on the logical platform LP is executed.

At step S the management apparatus MNG reads a name of the logical storage apparatus LSTRG to be set from the LSTRG name of the database USDB illustrated in . Further the management apparatus MNG notifies the storage gateway SGW which corresponds to the logical platform providing the logical server LSV which is requested to be returned of the information within the database USDB illustrated in to instruct setting of the logical storage apparatus LSTRG.

For example the management apparatus MNG notifies the name LSTRG name of the LSTRG the IP address LSTRG and the NWID LP for example VLANID representing the logical platform LP . The storage gateway SGW sets the logical storage apparatus LSTRG on the logical platform LP on which the logical server LSV which is requested to be returned is defined based on the instruction from the management apparatus MNG.

Next at step S the management apparatus MNG reads the name of the logical storage apparatus LSTRG from the field of the LSTRG name of the database USDB illustrated in . Further in the database DSKDB illustrated in the management apparatus MNG reads a unique address of the disk apparatus DISK linked to the logical server LSV which is requested to be returned and a number of the logical disk LDISK connection LDISK .

The management apparatus MNG notifies the storage gateway SGW which corresponds to the logical platform LP providing the logical server LSV which is requested to be returned of the name of the logical storage apparatus LSTRG and the number of the logical disk LDISK and the unique address of disk apparatus DISK. Further the management apparatus MNG instructs the storage gateway SGW to set the logical disk LDISK. The storage gateway SGW sets the logical disk LDISK based on the instruction from the management apparatus MNG and the return process ends.

Meanwhile at step S the management apparatus MNG notifies the terminal apparatus TM of the user US that the return of the logical server LSV fails and ends the return process. It is possible to detect for example errors and the like of the programs which the terminal apparatus TM executes by using the logical server LSV by notifying the terminal apparatus TM user US that the return of the logical server LSV fails.

In Target and LUN or lun represent the logical storage apparatus LSTRG and the logical disk LDISK respectively and disk represents the disk apparatus DISK. Parameters targetname ipaddress and vlanid represent the LSTRG name the IP address LSTRG and the NWID LP respectively which are illustrated in . Parameters lunnumber and diskid represent the connection LDISK and the unique address respectively which are illustrated in .

First at step S the management apparatus MNG refers to the LSTRG name list of the database LSVDB illustrated in to read the name of the logical storage apparatus LSTRG which is being executed by each of the storage gateways SGWs.

Next at step S the management apparatus MNG determines whether the storage gateway SGW which is providing the logical storage apparatus LSTRG is present based on the name of the logical storage apparatus LSTRG read at step S. That is the management apparatus MNG determines whether the logical storage apparatus LSTRG is present in the logical platform LP to which the return request for the logical server LSV is submitted.

When it is determined that the storage gateway SGW which is providing the logical storage apparatus LSTRG is present the process proceeds to step S. Otherwise when the storage gateway SGW which is providing the logical storage apparatus LSTRG is not present the processing proceeds to step S. Meanwhile the process of step S is executed in the processing of step S illustrated in and step S and the subsequent processing are executed in the processing of step S illustrated in .

At step S the management apparatus MNG selects the logical server LSV allocated to the storage gateway SGW which is providing the logical storage apparatus LSTRG and ends the process illustrated in . Next the management apparatus MNG instructs the storage gateway SGW corresponding to the logical platform LP which provides the logical server LSV which is requested to be returned to set the logical disk LDISK at step S illustrated in .

When the storage gateway SGW which is providing the logical storage apparatus LSTRG is not present at step S the management apparatus MNG determines whether the storage gateway SGW which is capable of providing a logical storage apparatus LSTRG is present. That is the management apparatus MNG determines whether there exists a storage gateway SGW providing logical storage apparatuses LSTRGs whose number is less than an upper limit value among the storage gateways SGWs which are allocating the physical server PSV.

When it is determined that there exists a storage gateway SGW capable of providing a logical storage apparatus LSTRG the processing proceeds to step S. Otherwise when there exists no storage gateway SGW capable of providing the logical storage apparatus LSTRG the process proceeds to step S.

At step S the management apparatus MNG selects for example the storage gateway SGW of which the ID is the smallest number among the storage gateways SGWs capable of providing the logical storage apparatus LSTRG. Meanwhile the management apparatus MNG may select a storage gateway SGW providing the LSTRGs whose number is less than those provided by the other storage gateways SGWs.

Meanwhile when there exists no storage gateway SGW capable of providing the logical storage apparatus LSTRG the management apparatus MNG selects the empty logical server LSV which is not allocated as the storage gateway SGW at step S. When the plurality of empty logical servers LSVs which are not allocated as the storage gateway SGW are present the management apparatus MNG selects the logical server LSV having a number smaller than the numbers of the other logical servers LSVs. Further the management apparatus MNG starts a physical server PSV to which the logical server LSV is allocated and allocates the physical server PSV as a new storage gateway SGW. When a logical server LSV for allocating the storage gateway SGW becomes insufficient a new physical server PSV corresponding to a new logical server LSV is started thereby allowing the power consumption of the information processing system SYS2 to be more reduced than the case in which a physical server PSV is started at all times.

Next at step S the management apparatus MNG selects a logical server LSV corresponding to the storage gateway SGW which is allocated at step S and ends the process illustrated in . Next at step S illustrated in the management apparatus MNG instructs the storage gate SGW corresponding to the logical server LSV selected at step S to set the logical storage apparatus LSTRG.

Step S is executed after the processing of step S. At step S the management apparatus MNG determines whether the number of logical storage apparatuses LSTRGs present on the corresponding storage gateway SGW becomes 0 by the loan process of the logical server LSV. For example when the storage apparatus LSTRG is deleted from the storage gateway SGW in which one storage apparatus LSTRG is set the number of logical storage apparatuses LSTRGs present on the storage gateway SGW becomes 0 .

When it is determined that the number of logical storage apparatuses LSTRGs present on the storage gateway SGW becomes 0 the process proceeds to step S. Otherwise when the number of logical storage apparatuses LSTRGs present on the storage gateway SGW is not 0 the process proceeds to step S.

At step S the management apparatus MNG instructs shut down of the storage gateway SGW in which a logical storage apparatus LSTRG is not present. The storage gateway SGW executes the shut down processing based on the instruction from the management apparatus MNG to stop the operation. When the logical server LSV allocating the storage gateway SGW remains the physical server PSV corresponding to the remaining logical server LSV is stopped thereby allowing the power consumption of the information processing system SYS2 to be more reduced than the case in which a physical server PSV is started at all times.

At step S the management apparatus MNG changes the network setting of the switch TOR SW connected to the physical server PSV operated as the storage gateway SGW similar to step S illustrated in . Therefore the network path to the physical server PSV operated as the storage gateway SGW is blocked.

The operation of the storage gateway SGW in which a logical storage apparatus LSTRG is not present is stopped by the loan process of the logical server LSV. As a result the power consumption of the information processing system SYS2 may be reduced.

As described above similar to the embodiments illustrated in even in the embodiments illustrated in for example after returning the logical server LSV0 corresponding to the physical server PSV10 the terminal apparatus TM1 may access the disk apparatus DISK10. That is the terminal apparatus TM1 may refer to the information which is recorded in the disk apparatus DISK10 during the loan of the logical server LSV0 while the logical server LSV0 is being returned. Further the terminal apparatus TM1 may refer to data and the like which are stored in the disk apparatus DISK1 logical disk LDISK1 during the return of the logical server LSV1 after receiving the loan of the logical server LSV1 again.

In the embodiments illustrated in the physical server PSV corresponding to the logical server LSV which allocates the storage gateway SGW is started or stopped depending on the state of providing the logical storage apparatus LSTRG. Therefore the power consumption of the information processing system SYS2 may be more reduced than the case in which the physical server PSV is started all the times. Further the logical storage apparatuses LSTRGs defined in the plurality of logical platforms LP may be independently provided by each of the storage gateways SGWs.

All examples and conditional language recited herein are intended for pedagogical purposes to aid the reader in understanding the invention and the concepts contributed by the inventor to furthering the art and are to be construed as being without limitation to such specifically recited examples and conditions nor does the organization of such examples in the specification relate to a showing of the superiority and inferiority of the invention. Although the embodiments of the present invention have been described in detail it should be understood that the various changes substitutions and alterations could be made hereto without departing from the spirit and scope of the invention.

