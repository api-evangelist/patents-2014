---

title: Device and method for clock signal loss detection
abstract: A device, comprises a first counter and a second counter, a control unit and a comparing unit. The first counter and the second counter are configured to alternately count a cycle number of a monitoring clock signal. The control unit is configured to generate, based on an input clock, both a first counter enable signal and a second counter enable signal that enable or disable the first and the second counters respective, and the first counter enable signal and the second counter enable signal are inverted. The comparing unit is coupled to both the first counter and the second counter and configured to detect a loss fault of the input clock if the cycle number of the monitoring signal counted by one of the first and the second counters exceed a predetermined threshold.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09231576&OS=09231576&RS=09231576
owner: MONTAGE TECHNOLOGY (SHANGHAI) CO., LTD.
number: 09231576
owner_city: Shanghai
owner_country: CN
publication_date: 20140722
---
This application claims priority to Chinese application No. 201410307669.5 entitled device and method for clock signal loss detection filed on Jun. 30 2014 by Montage Technology Shanghai Co. Ltd. which is incorporated herein by reference.

The present invention relates to clock signal loss detection and more particularly but not limited to a device and method for clock signal loss detection.

The conventional method of clock loss detection tests average frequency during a predetermined period therefore it may not promptly detect input clock loss fault. Further there may be one cycle sampling error in start and stop point. Further in order for the method to work input clock duty cycle should meet Nyquist sampling theory to find an edge transition. Due to the above disadvantage of existing clock loss detection method it is desirable to have a new device and method of detecting input clock loss.

According to an embodiment of the present invention a device comprises a first counter and a second counter wherein the first counter and the second counter are configured to alternately count a cycle number of a monitoring clock signal a control unit configured to generate based on an input clock both a first counter enable signal and a second counter enable signal that enable or disable the first and the second counters respectively wherein the first counter enable signal and the second counter enable signal are inverted and a comparing unit coupled to both the first counter and the second counter and configured to detect a loss fault of the input clock if the cycle number of the monitoring clock signal counted by one of the first and the second counters exceed a predetermined threshold.

According to another embodiment of the invention a method in a device comprises alternately counting a cycle number of a monitoring clock signal respectively by a first counter and a second counter generating by a control unit based on an input clock both a first counter enable signal and a second counter enable signal that enable or disable the first and the second counters respectively wherein the first counter enable signal and the second counter enable signal are inverted and detecting by a comparing unit a loss fault of the input clock if the cycle number of the monitoring clock signal counted by one of the first and the second counters exceed a predetermined threshold.

Various aspects and examples of the invention will now be described. The following description provides specific details for a thorough understanding and enabling description of these examples. Those skilled in the art will understand however that the invention may be practiced without many of these details. Additionally some well known structures or functions may not be shown or described in detail so as to avoid unnecessarily obscuring the relevant description.

The comparing unit CMP is coupled to both the first counter CNT and the second counter CNT and the comparing unit CMP is configured to detect a loss fault of the input clock if the cycle number of the monitoring clock signal mck counted by one of the first and the second counters CNT CNT exceed a predetermined threshold. For example an input clock loss threshold can be quantized by the monitoring clock signal mck s period and the result is set as the first and second counters CNT and CNT s predetermined threshold. Assume the loss threshold is 1000 ns and the monitoring clock signal mck s period is 100 ns then counter predetermined threshold is 10. 10 is obtained from the loss threshold value 1000 ns divided by mck s period 100 ns. It means during 10 mck period the in ck must toggle at least one time. That is if the comparing unit CMP detects any one of counters CNT or CNT counts more than 10 the compare unit CMP detects the input clock is lost. In another embodiment if the loss threshold remains 1000 ns and the monitoring clock signal mck s period is 65 ns the predetermined threshold can be 15 or 16. Note the predetermined threshold can be different based on the cycle number of loss threshold.

The compare unit CMP in can be implemented by a first comparator COMPARE and a second comparator COMPARE in . The first comparator COMPARE is configured to generate a first loss signal loss and the second comparator COMPARE is configured to generate a second loss signal loss. The details of first comparator COMPARE and the second comparator COMPARE will be described with the following .

Both Q ports of the first D type flip flop D and the third D type flip flop D are connected to input ports of the first OR gate OR. An output port of the first OR gate OR is connected to the control unit CTRL. Both Q ports of the second D type flip flop D and the fourth D type flip flop D are connected to input ports of the second OR gate OR. An output port of the second OR gate OR is connected to the control unit CTRL.

Both clock ports of the third D type flip flop D and the fourth D type flip flop D are configured to receive an inversion of the input clock in ck. As shown in both clock ports of the third D type flip flop D and the fourth D type flip flop D are connected to an output of the second inverter INV and an input of the second inverter INV is configured to receive the input clock in ck. The output port of the control unit CTRL is connected to a clear port CLR of the fourth D type flip flop D and the output port of the control unit CTRL is further connected to a clear port CLR of the third D type flip flop D via the first inverter INV wherein all D ports of the first D type flip flop D second D type flip flop D third D type flip flop D and fourth D type flip flops D are connected to a logic high 1 .

The comparing unit comprises a first comparator COMPARE a second comparator COMPARE and a third OR gate OR. The first comparator COMPARE is connected to the first counter CNT and an output port which outputs signal loss of the first comparator COMPARE is connected to a first input port of the third OR gate OR. The first comparator COMPARE is also configured to receive the monitoring clock signal mck and compare the cycle number counted by the first counter CNT with the cycle number of mck. The second comparator COMPARE is connected to the second counter CNT. An output port which outputs signal loss of the second comparator COMPARE is connected to a second input port of the third OR gate OR. The second comparator COMPARE is also configured to receive the monitoring clock signal mck and compare the cycle number counted by the second counter CNT with the cycle number of mck. The output of the third OR gate OR is configured to indicate the loss fault of the input clock in ck if the cycle number of the monitoring clock signal mck counted by one of the first and the second counters CNT and CNT exceed a predetermined threshold.

The device further comprises a third inverter INV. The control unit CTRL is configured to output the first counter enable signal cnt en. The control unit CTRL is also configured to output the second counter enable signal cnt en through a third inverter INV. With the third inverter INV the unexpected data relationship always inverted between the first counter enable signal cnt en and the second counter enable signal cnt en that caused by metastability can be reduced or avoided.

Two pairs of D flip flop the pair of D type flip flops D D the pair of D type flip flops D D generate cnt clr and cnt clr respectively and each pair only works with its corresponding counter. One of the D flip flops in a pair is triggered by the rising edge of in ck and the other in the pair is triggered by the falling edge of in ck . Taken the pair comprising D and D as an example the first D type flip flop D is triggered by a rising edge of the input clock in ck and the second D type flip flop D is triggered by a falling edge of the input clock in ck. The D port also called as data in port of each of the four D flip flops is connected to constant high. With two D type flip flops in a pair even if the counter set up time and counter hold time do not meet with each other which will cause for example the first D type flip flop to fail to detect a rising edge of the input clock in ck the third D type flip flop can then detect a falling edge of the input clock so as to guarantee an accurate count cycle number of counters.

Referring back to if the device can tolerate one sample error then the third D type flip flop D and the fourth D type flip flop D can be omitted. In other words the device only detects rising edge of the input clock in ck by the first or second D type flip flop D or D.

As shown in the control unit comprises a combination logic and a fifth D type flip flop D. A first and a second port of the combination logic are respectively connected to both an output of the first OR gate OR and an output of the second OR gate OR. The combination logic is configured to output to the fifth D gate D a different value for detecting a high of the output of the first OR gate OR or the second OR gate OR respectively. For example if High of the first OR gate OR is detected then the combination logic outputs 1 if High of the second OR gate OR is detected then the combination logic outputs 0. A Q port of the fifth D type flip flop D is configured to output the first counter enable signal crd en and the NOT Q port of the fifth D type flip flop D is configured to output the second counter enable signal cnt en. The Q port of the fifth D type flip flop D is connected to the clear ports of both the first D type flip flop D and the third D type flip flop D via the first inverter INV. The not Q port of the fifth D type flip flop D is connected to the clear ports of both the second D type flip flop D and the fourth D type flip flop D via the fourth inverter INV. Note different from in which the clear port CLR of all of the D type flip flop D D D and D are connected to a same output port of the control unit CTRL in the clear port of the pair of D type flip flops D and D receive Q port output of the fifth D type flip flop D while clear port of the pair of D type flip flops D and D receive NOT Q port output of the fifth D type flip flop D. Note the CLR port of D to D can be SET RESET SETB RESTB port and inverters may need to be inserted or removed accordingly. The function of the CLR port is to allow the D type flip flops DFFs to be back to their initial value. For example if CLR ports of D to D are all CLRB or RESETB which means the logic low on the port will set the Q port to 0 then inverters INV and INV can be omitted.

The device further comprises a frequency divider . The frequency divider is configured to divide the input clock in ck by N before the input clock in ck is input to the control unit .

The compare unit COMPARE is an implementation of the compare unit CMP shown in . As the first counter CNT and the second counter CNT works alternately one COMPARE unit is sufficient to detect whether the cycle number counted by one of the counters exceed the threshold value and generates a loss signal to indicate loss of input clock in ck.

Both Q ports of the first D type flip flop D and the third D type flip flop D are connected to input ports of the first AND gate AND. An output port of the first AND gate AND is connected to the control unit CTRL. Both Q ports of the second D type flip flop D and the fourth D type flip flop D are connected to input ports of the second AND gate AND. An output port of the second AND gate AND is connected to the control unit CTRL. The output port of the control unit CTRL is connected to a clear port CLR of the second D type flip flop D and the output port of the control unit CTRL is further connected to a clear port CLR of the first D type flip flop D through a first inverter INV.

Both clock ports of the third D type flip flop D and the fourth D type flip flop D are configured to receive an inversion of the input clock in ck through a second inverter INV. The output port of the control unit CTRL is connected to a clear port CLR of the fourth D type flip flop D and the output port of the control unit CTRL is further connected to a clear port CLR of the third D type flip flop through the first inverter INV wherein all D ports of the first second third and fourth D type flip flops D D D and D are connected to a logic low 0 . Also taking the device shown in into consideration the D ports of each of D type flip flops D D D and D can be configured to receive either 0 or 1. If each of the D ports are configured to receive 0 instead of 1 then the OR gates OR OR in should be changed to AND gates AND and AND shown in .

As the first and second comparators COMPARE and COMPARE in are similar to that shown in details are omitted for elements already described with respect to .

Both clock ports of the first latch D and the second latch D are configured to receive the input clock in ck. The output port of the control unit CTRL is connected to a clear port CLR of the second latch D and the output port of the control unit CTRL is further connected to a clear port CLR of the first latch D through a first inverter INV.

Both Q ports of the first latch D and the third latch D are connected to input ports of the third AND gate AND. An output port of the third AND gate AND is connected to the control unit CTRL.

Both Q ports of the second D type flip flop D and the fourth D type flip flop D are connected to input ports of the fourth AND gate AND. An output port of the fourth AND gate AND is connected to the control unit CTRL.

Both clock ports of the third D type flip flop D and the fourth D type flip flop D are configured to receive an inversion of the input clock in ck via the second inverter INV. The output port of the control unit CTRL is connected to a clear port of the fourth D type flip flop D and the output port of the control unit CTRL is further connected to a clear port of the third D type flip flop D through the first inverter INV.

As the comparator COMPARE in is similar to that shown in details are omitted for elements already described with respect to .

In an embodiment the predetermined threshold is programmable. For example the predetermined threshold may be adjusted based on the ratio of frequency of input clock in ck and the frequency of monitoring clock signal mck.

Referring to the situation that the numbers in the parenthesis should be ignored is considered. First the monitoring clock signal mck domain is considered. In block initially cnt en changes from logic 0 to logic 1 and cnt are counting while cnt en changes from logic 1 to logic 0 cnt reset. In other words CNT works with cnt en changes from logic 0 to logic 1 and CNT does not work.

To be specific if CNT reaches a max value the method goes to blocks and in block a signal loss is detected.

If cnt clr 1 time b in then the method proceed to block . In block cnt en is from logic 1 to logic 0 cnt reset time c in cnt en is from logic 0 to 1 cnt starts counting. Then in block the method detects whether CNT reaches a max value or cnt clr 1.

If CNT does not reach a max value and cnt clr does not equal 1 in block the method goes back to block .

If yes to CNT reaches a max value in the determining of block the method goes to blocks and and block in block a signal loss is detected and in block the first counter CNT and second counter CNT continuously count alternatively.

If yes to cnt clr 1 time B in in the determining of block then the method proceeds to block cnt en changes from logic 0 to logic 1 cnt counting time D in cnt en changes from logic 1 to logic 0 cnt reset time C in .

Then the in ck domain is considered in block D D are working while D D reset therefore a cnt clr signal is generated and sent to block in mck domain.

If yes the method proceeds to block wherein D D are reset and D D work. Meanwhile a cnt clr signal is generated and fed to block in the mck domain. Then the method proceeds to block and the block determines whether cnt en changes from logic 1 to logic 0. If yes to block the method goes back to block . If no to block the method goes back to block .

Also note that the block also generates a cnt en signal and the signal is fed to block . Block generates a cnt en signal and the signal is fed to block . Note that the numbering of blocks across different domains does not indicate specific orders. For example block in mck domain and block in in ck domain do not have to be performed in order recited. Block and block can be implemented in different order. Note that the above method also works for the signals illustrated in the parenthesis.

Referring to during operation the first counter CNT and the second counter CNT both are synchronous step counters. The two counters CNT CNT the two comparators COMPARE COMPARE and control unit CTRL work on monitor clock signal mck domain. mck domain is a complete synchronous circuit. The four D Flip Flops work with either rising edge or falling edge of input clock in ck.

If cnt clr is active for example time point a after sampled by mck for example the rising edge of monitoring clock signal such as time point b the cnt en is pulled low for example time point c and at the same time the cnt en is pulled high for example time point d note that time point c and time point d are substantially simultaneous . As cnt en is pulled down the first counter CNT ceases count and the second counter CNT starts count. The cnt en is also feed to the clear port CLR of first and third D type flip flops D and D via the first inverter INV therefore D and D are reset and stop work when D and D are reset that means the Q output always equal to 0 and the Q output ignores the D port and clock inputs while the second and fourth D type flip flops D and D start work.

Similarly if the cnt clr is active for example time point A after sampled by mck for example the rising edge of monitoring clock signal such as time point B the cnt en is pulled high for example time point D . At the same time the cnt en is pulled low for example time point C note that time point C and time point D are substantially simultaneous . As cnt en is pulled high the first counter CNT starts count and the second counter CNT ceases count. If the high of the cnt clr cnt clr is detected by mck current counter is reset and another counter starts counting immediately.

The cnt en is also feed to the clear port of first and third D type flip flops D and D via the first inverter INV therefore D and D are reset and stop work while the first and third D type flip flops D and D start work. In other words at the same time as the reset of one counter and start counting of the other counter after some delay that guaranteed by causal control system the previous working D flip flop pair goes into reset status and another pair starts to work. Here the causal control system means the assertion of one bit signal cnt en is changed through the sampling on one bit signal cnt clr on mck domain. The asynchronous reset action on cnt clr for example time point e by cnt en is only after the cnt en is asserted by the effective sampling on cnt cir for example time point c . The same mechanism also works for cnt en and cnt clr .

During normal operation cnt en and cnt en control two counters CNT and CNT to work in turns. For example when the first counter CNT works the second counter CNT ceases work. When the first counter CNT ceases work the second counter CNT works.

During signal loss the working counter continuously steps forward to its maximum value which equals the quantized programmable threshold if the corresponding enable signal keeps high. Loss indication signal loss can be detected as soon as the counter s value equals this programmable threshold value. Signal cnt clr from in ck domain is sampled by mck to generate single bit counter enable signal cnt en. Signal in ck is always run at two edge of in ck. Signal cnt en is used as asynchronous reset signal and the reset recovery timing of DFF is not cared. Similarly signal cnt clr from in ck domain is sampled by mck to generate single bit counter enable signal cnt en. Signal in ck is always run at two edge of in ck. Signal cnt en is used as asynchronous reset signal and the reset recovery timing of DFF is not cared.

See for another example. The first counter CNT is counting with D type flip flops D and D on working status. At the same time the second counter CNT is standby with the D type flip flops D and D is in reset status. During the first counter CNT counting stage one falling edge of in ck leads cnt clr to high at time a. When mck detects the high of cnt clr at time b it will reset the first counter CNT also signal cnt through pulling low its enable signal cnt en at time c and start the second counter CNT also signal cnt through pulling high the cnt en at time d. Because cnt en is only generated after the cnt clr has been sampled correctly at time b cnt en can reset D type flip flops D and D safely at time e. The high level of cnt clr may be narrow but can always meet the hold timing requirement. The same treatment occurs that during the second counter CNT counts 1 2 . . . until m 2 the second counter CNT is reset and the first counter CNT starts counting by rising edge of in ck time point A to E .

With the embodiments of the invention clock loss fault can be checked out immediately so as to prevent the system using this clock to crash without waiting for several periods to obtain an average value. In the embodiments input clock loss fault can be detected as soon as the count exceeds the threshold.

In some embodiments the monitor clock frequency does not need to be too high and only equals to a minimum threshold. Here minimum threshold indicates the lowest frequency of the mck to make sure this loss detection circuit can work. The minimum threshold may equal the frequency of CLK port of D D in ck or the divided in ck by the frequency divider. The threshold can be as long as possible or even as small as one monitoring clock period based on different monitoring clock frequency and input clock frequency.

In some embodiments the fully digital synchronous circuit leads the threshold to be programmed easily.

In some embodiments the duty cycle requirement on input clock for the synchronous circuit sampling is not needed because the circuit use input clock edge trigger directly instead of voltage level trigger.

Further as the two comparators work seamlessly that is if one stops counting the other one resumes counting immediately seamless checking can be obtained.

Causal control system leads communication between two clock domains in ck domain and mck domain simply and safely as the causal control system according to the embodiments does not need to exchange handshaking signal between different domains.

With the frequency divider shown in the embodiment of the embodiments also works for the situation with the input clock frequency faster than or equal to the monitoring clock signal s.

Although the present invention has been described with reference to specific exemplary embodiments the present invention is not limited to the embodiments described herein and it can be implemented in form of modifications or alterations without deviating from the spirit and scope of the appended claims. Accordingly the description and the drawings are to be regarded in an illustrative rather than a restrictive sense.

From the foregoing it will be appreciated that specific embodiments of the technology have been described herein for purposes of illustration however various modifications can be made without deviating from the spirit and scope of the present invention. Accordingly the present invention is not restricted except in the spirit of the appended claims.

Other variations to the disclosed embodiments can be understood and effected by those skilled in the art in practicing the claimed invention from a study of the drawings the disclosure and the appended claims. In the claims the word comprising does not exclude other elements or steps and the indefinite article a or an does not exclude a plurality. Even if particular features are recited in different dependent claims the present invention also relates to the embodiments including all these features. Any reference signs in the claims should not be construed as limiting the scope.

Features and aspects of various embodiments may be integrated into other embodiments and embodiments illustrated in this document may be implemented without all of the features or aspects illustrated or described. One skilled in the art will appreciate that although specific examples and embodiments of the system and methods have been described for purposes of illustration various modifications can be made without deviating from the spirit and scope of the present invention. Moreover features of one embodiment may be incorporated into other embodiments even where those features are not described together in a single embodiment within the present document. Accordingly the invention is described by the appended claims.

