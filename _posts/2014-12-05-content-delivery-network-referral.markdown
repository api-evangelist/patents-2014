---

title: Content delivery network referral
abstract: In general, techniques are described for managing content request referrals by keying content requests to a composite key data structure that maps end-user address prefixes and content identifiers to content delivery network servers of downstream CDNs. In one example, a CDN exchange includes a communication module to receive first network prefixes and first content identifiers from a first secondary content delivery network and to receive second network prefixes and second content identifiers from a second secondary content delivery network. A request router of the CDN exchange redirects the content request to the first secondary content delivery network or to the second secondary content delivery network according to a network address of the end user device and a content identifier for the content request.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09253255&OS=09253255&RS=09253255
owner: Juniper Networks, Inc.
number: 09253255
owner_city: Sunnyvale
owner_country: US
publication_date: 20141205
---
This application is a continuation of U.S. patent application Ser. No. 13 547 917 filed Jul. 12 2012 the entire content of which is being incorporated herein by reference.

The invention relates to computer networks and more specifically to content delivery using computer networks.

Content providers increasingly rely on content delivery networks CDNs to distribute content requested by a geographically diverse clientele. Content delivery networks reduce delivery costs improve performance and robustness and enhance a quality of experience for end users by caching copies of content in numerous locations to reduce the distance between end users and a given copy of the content.

In general a CDN includes a distribution system made up of content serving nodes or surrogates that cache copies of content and deliver the content in response to requests from end user devices. The distribution system also distributes content within the CDN with content typically originating at an origin server and being distributed among the surrogates that are closer both topologically and geographically to a service provider edge and therefore to the end users. A request router of the CDN functions as a request reference point for the CDN to end user devices. An end user device sends a content request or resource request to the request router which selects a capable surrogate to handle the content request and then redirects the end user device to the selected surrogate. The end user device reissues the content request directly to the selected surrogate which delivers the requested content to the end user device.

A content service provider CSP like a CDN provider provides to end users a content service that includes delivery of content identified by a content identifier to the end users in response to content requests. In some cases a CSP or CDN provider may elect to delegate content request handling for a subset of end users to another CDN thereby creating a hierarchical relationship between the CSP or CDN provider that is delegating content delivery the upstream entity and the delegated downstream CDN that then either selects a surrogate for content delivery or delegates content request handling for the subset of users to a still further downstream CDN.

In some instances a CSP may be associated through contractual or other arrangements with a particular CDN that is responsible for delivering content in responsive to content requests directed to the content service of the CSP. This CDN the authoritative or primary CDN of the CSP may elect to delegate content request handling for subsets of end users to respective secondary CDNs. Secondary CDNs thus maintain a transitive relationship for delivery of CSP content via the primary CDN. When an end user device associated with a secondary CDN issues a content request to a CSP the CSP redirects the content request to the primary CDN which in turn refers the content request to the secondary CDN for still further redirection to a local media cache of the secondary CDN that stores a copy of the content.

In general techniques are described for managing content request referrals by keying content requests to a composite key space or tuple space data structure that maps tuples of end user address prefixes and content identifiers e.g. Uniform Resource Identifiers URIs to CDN servers of downstream CDNs or another referring entity. A referring entity may generate this data structure referred to hereinafter as a CDN referral table by receiving from secondary CDNs address prefixes in association with respective CDN servers of secondary CDNs or by the respective secondary CDNs at large and URIs for content served by the respective CDN servers. The address prefixes identify end user devices announced by respective secondary CDNs as reachable by the secondary CDNs. The referring entity consolidates the address prefixes and content URIs into composite keys that make up a CDN referral tuple space and maps the composite keys to an appropriate CDN server. The referring entity that stores a CDN referral table such as a primary CDN may subsequently receive a content request sourced by an end user device associated with a network address key the combination of the URI of the content request and network address to the CDN referral tuple space of the CDN referral table and redirect the content request to the mapped CDN server of a secondary CDN or another referring entity. Use of a CDN referral table may enable reduction in the number of content request redirections by exposing content availability on individual media caches of secondary CDNs for owned prefixes and thus refining the granularity of the lookup data structure on which redirection is based.

The referring entity to which a primary CDN redirects a content request may include a CDN exchange that consolidates the upstream propagation of CDN referral tuples from various secondary CDNs to one or more primary CDNs. In some instances the CDN exchange operates as an intermediary between the secondary CDNs and primary CDNs by conducting CDN referral tuples upstream. Secondary CDNs upload their CDN referral tuples to a CDN exchange which formulates respective CDN referral tables for the secondary CDNs for forwarding to a primary CDN. In some instances a trusted CDN exchange aggregates CDN referral tables from multiple secondary CDNs replaces the CDN referral entity with its own CDN referral servers and publishes the aggregated CDN referral table to the primary CDN. As a result the primary CDN redirects content requests keyed to the aggregated CDN referral table to the CDN exchange which then uses the granular CDN referral tuples for the multiple secondary CDNs to identify a satisfactory secondary CDN for further redirection and content request handling. The CDN exchange may therefore act as a trusted third party intermediary between secondary CDNs and the primary CDN where as in some cases the various secondary CDNs prefer to obfuscate their customer prefix information or tertiary CDN server information i.e. their CDN footprint . In addition the aggregated CDN referral table may reduce operational overhead for the primary CDN for whenever the primary CDN receives a content request from a non customer the primary CDN may redirect the request to the CDN exchange rather than searching for a satisfactory secondary CDN. In some instances a content service provider may contract directly with a CDN exchange to provide content request redirection to terminal CDNs capable of delivering the requested content.

The various CDNs and the CDN exchange may communicate according to a CDN Interconnection CDNI interface that defines a set of interfaces for CDN functionality and information exchange including a control interface logging interface request routing interface CDNI metadata interface and so on. CDN applications executing on devices of CDNs described herein may implement the CDNI interface by dynamically extending a Multi Protocol Border Gateway Protocol MP BGP implementation using an Application Programming Interface API of a routing protocol process also executing on the devices. The API provides methods and parameters by which the CDN applications may 1 define a new code point e.g. Address Family Identifier Subsequent Address Family Identifier AFI SAFI for distributing CDNI related information 2 utilize a community e.g. a BGP extended community by the CDNI partners to define the appropriate distribution graph from one CDN to one or more other CDNs and 3 inject extract CDNI related information with the newly defined code point into from the routing plane of a newly defined or existing community. As a consequence developers may rapidly develop new functionality independently of the network router vendor to extend operations of a CDN for CDNI information exchange including CDN referral tuple propagation. By utilizing an existing routing protocol having an exposed API to distribute CDNI related information the techniques may facilitate reliable scalable loop free and generalized data distribution according to a specified distribution graph defined by client routers that advertise the community spaces in which they are interested and ingest routes associated with the such community spaces.

In one aspect a method includes receiving first network prefixes and first content identifiers from a first secondary content delivery network. The method also includes receiving second network prefixes and second content identifiers from a second secondary content delivery network and receiving with a request router device a content request from an end user device. The method further includes redirecting the content request to the first secondary content delivery network when a network address of the end user device matches one of the first network prefixes and a content identifier for the content request matches one of the first content identifiers and redirecting the content request to the second secondary content delivery network when a network address of the end user device matches one of the second network prefixes and a content identifier for the content request matches one of the second content identifiers.

In another aspect a non transitory computer readable medium contains instructions. The instructions cause one or more programmable processors to receive first network prefixes and first content identifiers from a first secondary content delivery network. The instructions cause also cause the processors to receive second network prefixes and second content identifiers from a second secondary content delivery network. The instructions cause also cause the processors to receive with a request router device a content request from an end user device. The instructions cause also cause the processors to redirect the content request to the first secondary content delivery network when a network address of the end user device matches one of the first network prefixes and a content identifier for the content request matches one of the first content identifiers. The instructions cause also cause the processors to redirect the content request to the second secondary content delivery network when a network address of the end user device matches one of the second network prefixes and a content identifier for the content request matches one of the second content identifiers.

A content delivery network exchange includes a control unit having a processor. The content delivery network exchange also includes a communication module of the control unit to receive first network prefixes and first content identifiers from a first secondary content delivery network and to receive second network prefixes and second content identifiers from a second secondary content delivery network. The content delivery network exchange also includes a request router of the control unit to receive a content request from an end user device. The request router redirects the content request to the first secondary content delivery network when a network address of the end user device matches one of the first network prefixes and a content identifier for the content request matches one of the first content identifiers. The request router redirects the content request to the second secondary content delivery network when a network address of the end user device matches one of the second network prefixes and a content identifier for the content request matches one of the second content identifiers.

A content delivery network interconnection device includes a control unit having a processor. The content delivery network interconnection device also includes an application executing on the control unit. The content delivery network interconnection device also includes a routing protocol process executing on the control unit to execute a routing protocol to exchange routing protocol advertisements with a peer network device of one of a content delivery network exchange or a primary content delivery network in accordance with the routing protocol. The content delivery network interconnection device also includes an interface of the routing protocol process. The application invokes the interface to dynamically extend the routing protocol process to register transmit and receive interfaces for a code point of the routing protocol. The application invokes the interface of the routing protocol process to inject application data comprising first network prefixes and first content identifiers into the routing protocol. The routing protocol process transmits routing protocol advertisements with the transmit interface by transmitting routing protocol advertisements that comprise the application data and further comprise an application identifier associated with the transmit interface.

The details of one or more embodiments of the invention are set forth in the accompanying drawings and the description below. Other features objects and advantages of the invention will be apparent from the description and drawings and from the claims.

Secondary CDNs and primary CDN each represent a network of interconnected devices that cooperate at layers four through seven L4 L7 of the Open Systems Interconnection OSI model i.e. the transport layer through the application layer to deliver content items to end user devices using one or more services. Such content items hereinafter content may include for instance streaming media files data files software domain name system information documents database query results among others. Accordingly examples of services offered by secondary CDNs and primary CDN may include hyper text transfer protocol HTTP media streaming advertising file transfer protocol FTP and others. Each of secondary CDNs and primary CDN operates over a network infrastructure network infrastructure not shown in that transports content requests content data and content metadata among between secondary CDNs and primary CDN .

Network service providers NSPs CDN providers and CSPs deploy CDNs to more efficiently deliver network services such as Internet Protocol television IPTV video on demand VoD audio on demand bulk data download and other forms of content delivery. A CSP may contract the primary CDN to offer a content service to one or more of end user devices . A content service in general encompasses the content delivery functionality of a CDN partially provided in this example by primary CDN but may also provide additional services such as key distribution and TV program guides. The CSP may own or license content and stores such content on origin server for delivery by origin server or replication to secondary CDNs for delivery by any of surrogates A D collectively surrogates . In some examples a CDN provider deploys primary CDN for use by one or more CSPs. In some examples the CSP may deploy origin server or other content serving entity without deploying a full CDN e.g. primary CDN . The CSP may contract with a primary CDN provider or the CSP may deploy administer primary CDN itself. Primary CDN may alternatively be referred to as authoritative for the CSP.

Origin server is a master repository for the CSP and hence for primary CDN to store all content made available to end user devices as part of the content service provided by the CSP. Origin server may include one or more data servers web servers application servers databases computer clusters mainframe computers and any other type of server computing element and or database that may be employed by the CSP to facilitate the delivery of content from origin server to surrogates and or directly to end user devices . In examples where a CDN provider other than the CSP deploys primary CDN the CDN provider may operate primary CDN by receiving and storing content provided by the CSP to origin server .

While all of secondary CDNs and primary CDN may in fact offer content delivery to each of prefixes in that it is generally desirable that a given content item can be delivered to any of end user devices from any of the CDNs of network system the network reachability of primary CDN for example may not expand close enough to the location of end user devices to realize the cost benefit and improved user experience that is provided by secondary CDNs . Consequently primary CDN contracts with secondary CDNs to delegate content delivery for some or all of the content for prefixes A B collectively prefixes and each of secondary CDNs advertises those of prefixes for which it seeks to provide a delegated content delivery service on behalf of primary CDN . The example of network system is illustrative and various examples may include fewer or additional elements arranged in various configurations.

In the illustrated example while secondary CDN A advertises itself as offering content delivery for prefix A and prefix B secondary CDN B advertises itself as offering content delivery for prefix A alone. A network address of end user A is a member of prefix A and a network address of end user B is a member of prefix B.

Each of secondary CDNs includes at least one of surrogates and one of CDN Interconnection CDNI devices A C collectively CDNI devices . Primary CDN includes CDNI device C and origin server . In some examples primary CDN includes one or more surrogates. Surrogates store content made available by primary CDN or secondary CDNs to end user devices to other devices of within CDN and or from primary CDN to secondary CDNs . Surrogates serve the content to requesting devices using for example a transmission control protocol TCP or user datagram protocol UDP session operating over intermediate devices of CDNs and other network infrastructure connecting end user devices to surrogates intermediate devices not shown for simplicity . CDN providers administer surrogates to optimize content delivery using load balancing techniques caching request routing and or content services. Each of surrogates may include one or more data servers web servers application servers databases computer clusters mainframe computers and any other type of server computing element and or database that may be employed by the respective CDN provider to facilitate the provision of content. In some examples the servers and or databases may include blades or other cards that are inserted into large racks. The racks may provide a common backplane or switch fabric to interconnect the various servers and or databases to one another as well as to a router or other network device. That is any of surrogates may be a service blade insertable within an associated router of an autonomous system associated with the respective one of primary CDN or secondary CDNs . Any of surrogates may aggregate or otherwise represent multiple caches that store content for different content providers or vendors.

Each of CDNI devices may represent a server router other computing element or component thereof that distributes content delivery reachability information and or performs request routing in accordance with techniques described herein. CDNI devices may include DNS servers other application layer protocol e.g. HTTP servers or protocol speakers application layer traffic optimization servers and or clients and may in some instances execute routing protocols to receive process and advertise routing and content delivery reachability information.

As intimated above secondary CDNs may cache content closer to the edge of a network i.e. closer to end user devices to reduce transit delivery time and also to reduce network bandwidth usage for content delivery. In various examples each of CDNs may include a plurality of surrogates geographically dispersed to serve end user devices that may be geographically diverse e.g. located a significant distance from one another . Accordingly costs to various surrogates may differ by end user devices . Surrogates may thus mirror a subset of the content available from origin server where the set of content available from origin server refers to the content files available to end user devices from primary CDN in this example though each of surrogates may provide different services and data content than that provided by the other surrogates. For example surrogate C may store a different set of content items e.g. different video music or other files than is stored by surrogates A B or D.

End user devices issue content requests to receive application related content for applications hosted by end user devices . Each of end user devices may represent for example a workstation desktop computer laptop computer cellular or other mobile device Personal Digital Assistant PDA gaming console video or music console television set top box or any other device capable of accessing a computer network via a wireless and or wired connection. Each of end user devices may be associated with a subscriber e.g. a human that contracts with a CSP to receive content . Applications that access content services provided by CSP CDN providers operating primary CDN and secondary CDNs may alternatively be referred to as user agents. 

Primary CDN and secondary CDNs use application layer protocols for content distribution and make use of request routing techniques to direct application layer content requests from end user devices to associated surrogates where request routing refers to selecting one of surrogates with which to service a client request and directing the client request to the selected surrogate. The task of directing end user requests to cache nodes is alternately referred to as request routing content routing or content redirection hereinafter request routing . Primary CDN and secondary CDNs may employ one or more of a variety of request routing techniques including Domain Name Service DNS request routing and other forms of application layer request routing.

In the case of DNS request routing when one of end user devices requests a content file through its network not shown the network forwards a DNS request to a domain name server that is configured to operate as a redirector or request router for one of CDNs . In the illustrated example CDN Interconnection CDNI devices operate as request routers for associated primary CDN or secondary CDNs . For example CDNI device C operates as a request router for primary CDN and CDNI device B operates as a request router for secondary CDN B. The DNS based request router receives and resolves the domain name to select one of surrogates or origin server to serve the requested content then returns the network address for the selected one of surrogates or origin server to the requesting one of end user devices typically via a local DNS server of the network not shown that provides network access to the requesting one of end user devices which requests and receives the content from the selected one of surrogates or origin server . In some cases however as described in further detail below CDNI device C of primary CDN may delegate the content request to one of secondary CDNs . In some examples providers of primary CDN and secondary CDNs deploy one or more request routers in separate appliances to use request routing information received by CDNI devices for the respective CDNs.

In instances of other forms of application layer request routing when one of end user devices requests a content file through a network using for example Hyper Text Transfer Protocol HTTP or Real Time Streaming Protocol RTSP the network forwards the request to a request router of one of CDNs . Again CDNI devices operate as request routers for associated CDNs. The request router selects one of surrogates or origin server to satisfy the request. The request router returns the network address for the selected one of surrogates or origin server to the requesting one of end user devices which requests and receives the content from the selected one of surrogates or origin server . As in the case of DNS based request routing the request router of primary CDN may in some cases delegate the content request to one of secondary CDNs .

As described above a provider of primary CDN may enter into agreements with other providers of secondary CDNs to delegate content delivery in accordance with a content service to a subset of end user devices that engage the content service offered by the primary CDN provider. For example a delegating provider which administers primary CDN provides a content service to some or all of end user devices . The delegating provider may delegate the responsibility to serve at least a portion of content requests to a provider that deploys a delegated one of CDNs . The agreements may specify contractual duties of participating providers in what is known as a service level agreement SLA which may define a requisite service level that is to be applied by the delegated provider and other requisites.

Delegation in this manner defines a hierarchical relationship among CDNs . Primary CDN that delegates content requests is an upstream entity to the downstream entity that may be one of secondary CDNs and is delegated content requests from the upstream entity. The terms upstream entity and downstream entity may alternatively refer to the associated CSP CDN provider or NSP associated with the network that is the entity e.g. one of primary CDN or secondary CDNs . A content serving entity refers to any of primary CDN and secondary CDNs or in some examples a CSP network or data center that serves content to end user devices . Downstream entities and upstream entities may be content serving entities. The upstream entity can be a CSP or primary CDN . In some instances not shown a secondary CDN may be both a downstream CDN and an upstream CDN for a tertiary CDN that servers one or more end user devices . That is there may be a chain of delegation agreements cascading from top level providers to intermediate level CDN providers to lower level network service providers. In this way downstream entities may deliver content on behalf of upstream entities that receive corresponding content requests.

In accordance with techniques of this disclosure secondary CDNs advertise reachable prefixes to primary CDN using CDNI interfaces A B to advertise surrogates offering content delivery reachability to prefixes as well as content availability information for content items stored by the surrogates. As a result the downstream entities may expose to primary CDN those prefixes and content items as specified e.g. by a Uniform Resource Identifier for which particular surrogates may serve the content items to the prefixes. In some instances secondary CDNs may advertise themselves as a whole for example by specifying a request router identifier rather than a particular surrogate. The request router may then receive redirected content requests for delegation for an associated one of surrogates .

CDNI devices A B receive lists of prefixes and list of content items served by respective secondary CDNs . CDNI devices A B may in some instances be configured with such lists of prefixes and content items by an administrator or may in some instances receive this information dynamically by executing routing protocols to receive the lists of prefixes and routing or other protocols extended to carry content item information issued by surrogates . That is surrogates may themselves advertise their individual prefix reachability and or content items availability footprint to associated CDNI devices for advertisement upstream to primary CDN . In some instances all surrogates of a given secondary CDN have the same prefix reachability and thus advertise only content items availability. In some instances all surrogates of a given secondary CDN have the same prefix reachability and content availability. In the illustrated example surrogate sends advertisement to CDNI device B to advertise its prefix reachability and content availability information. Advertisement includes at least one prefix and one content identifier and may represent for instance a routing protocol or application layer message.

Pairs of CDNI devices implement and use CDNI interfaces to communicate content delivery reachability and content availability information and in some cases route content requests to downstream entities according to techniques described herein. For example CDNI device B of secondary CDN B sends message B to communicate a representation of prefix B in combination with a list of content items to CDNI device C using CDNI interface B to indicate secondary CDN B provides content delivery reachability to devices having a network address that is within a range defined by prefix B e.g. end user device B for the listed content items. In addition CDNI device A of secondary CDN A sends message A to communicate a representation of prefix A and prefix B in combination with a list of content items to CDNI device C using CDNI interface A to indicate secondary CDN A provides content delivery reachability to devices having a network address that is within the ranges defined by prefixes A B for the listed content items. Both secondary CDNs therefore provide prefix reachability to prefix B in this instance. Messages A B may also include an identifier for an entity of respective secondary CDNs A B that serves or further redirects content requests issued by one of end user devices . Messages A B may represent for instance a routing protocol or application layer message or an administrator entering the specified information to a web page provided by a web server of CDNI device C for upload to CDNI device C upon submission.

In accordance with techniques described herein CDNI device C processes prefix reachability and content availability information received in CDNI interfaces to generate a CDN referral table a data structure that maps a CDN referral tuple space of composite keys each including at least a prefix and a content item identifier to respective surrogates or request routers of secondary CDNs e.g. CDNI devices A B . Each of the tuples in the CDN referral table thus uniquely identifies a combination of prefix and content identifier combination and maps the combination to a logical identifier e.g. a URI or network address for a referred to entity. Content identifiers may identify aggregations of content identifiers. For example a URI of www.domain.com may identify every URI that includes a www.domain.com prefix substring e.g. www.domain.com home.html . Multiple tuples in the CDN referral table may match a content request yet map to different referred to entities in the same or different secondary CDNs .

CDNI device C may implement the CDN referral table using one or more tables trees radix trees databases or other structures. Example implementations of a CDN referral table are described with respect to below.

CDNI device C may route content requests issued by end user devices using the generated CDN referral table. For example CDNI device C having received a representation of prefix B and a list of content items in CDNI interface B and having accordingly generated a CDN referral table may redirect content requests issued by end user device B for any of the list of content items to secondary CDN B more specifically to CDNI device B or one of surrogates AC D. Alternatively CDNI device C may determine the requested content item is not available from secondary CDN B and therefore redirect the content request to secondary CDN A. Alternatively CDNI device C may determine the requested content item though available from both secondary CDNs along with end user B may be better served by secondary CDN A for reasons of cost user experience and so forth as determined by topological and cost information known to CDNI device C. Additional details regarding downstream CDN selection based on topological and cost information are found in Medved et al. U.S. patent application Ser. No. 13 341 662 ADVERTISING END USER REACHABILITY FOR CONTENT DELIVERY ACROSS MULTIPLE AUTONOMOUS SYSTEMS filed Dec. 30 2011 the entire contents of which being incorporated herein.

In the illustrated example end user device B issues content request A to CDNI device C deployed by as part of primary CDN . CDNI device C matches the network address for end user device B in combination with an identifier for the requested content to a tuple in the CDN referral table and uses the matched tuple to determine a referred to entity. In this case the matching tuple specifies surrogate D of secondary CDN B. Accordingly CDNI device C delegates content request A to surrogate B using redirect message B to end user B. In some examples redirect message B may represent a DNS A AAAA record toward surrogate D. In the illustrated example redirect message B represents an HTTP redirect message or DNS reply to end user device B. Upon receiving redirect message B end user device B may connect directly to surrogate D to request and receive the requested content directly from surrogate D.

In some examples CDNI devices implement prefix reachability and content availability information advertisements for CDNI interfaces using Multi Protocol Border Gateway Protocol MP BGP or another exterior routing protocol. For example CDNI devices may establish BGP peering sessions with one another. A CDNI device for a downstream entity may then send one or more BGP UPDATE messages that include prefixes reachable and a list of content available by the downstream entity to a peer CDNI device for an upstream entity. BGP peering sessions for CDNI interfaces may be established out of band from the routing plane of network system to mitigate the possibility of leaking content delivery information for CDNs into BGP routing tables for the network. In this way CDNI devices may maintain a separation between the network layer layer three L3 of the OSI model and content delivery network layers i.e. L4 L7 . In some examples however one or more of CDNI devices may represent network routers and send BGP UPDATE messages in band with a flag application specific Network Layer Reachability Information NLRI or other indicator that the BGP UPDATE messages include prefix reachability and content availability information for content delivery network content request delegation. As a result the receiving CDNI devices or any routers that receive the BGP messages do not install the routes for the reachable prefixes to the BGP routing tables.

The generation and use of a CDN referral table by CDNI device C based on advertised CDN referral tuples may enable reduction in the number of content request redirections by exposing content availability on individual media caches of secondary CDNs for prefixes and thus increasing the granularity of the lookup data structure on which redirection is based. For example although each of secondary CDNs provides prefix reachability to prefix B including end user B there may be some cases in which only secondary CDN B includes a surrogate that stores the requested content. To reduce latency and generally improve a user experience CDNI device C may therefore use the techniques described above to look up a composite key of the CDN referral tuple space that maps to surrogate D and accordingly redirect the content request to surrogate D.

CDN exchange may include one or more data servers web servers application servers databases computer clusters mainframe computers and any other type of server computing element and or database that may be employed by a CDN exchange provider to facilitate upstream prefix reachability and content availability information propagation. CDNI device B of secondary CDN B sends message B using CDNI interface B to communicate a representation of prefix B in combination with a list of content items to CDN exchange to indicate secondary CDN B provides content delivery reachability to devices having a network address that is within a range defined by prefix B e.g. end user device B for the listed content items. CDNI device A of secondary CDN A sends message A using CDNI interface A to communicate a representation of prefix A and prefix B in combination with a list of content items to CDN exchange to indicate secondary CDN A provides content delivery reachability to devices having a network address that is within the ranges defined by prefixes A B for the listed content items. Messages A B may also include an identifier for an entity of respective secondary CDNs A B that serves or further redirects content requests issued by one of end user device . Messages A B may represent for instance a routing protocol or application layer message or an administrator entering the specified information to a web page provided by a web server of CDNI device C for upload to CDNI device C upon submission.

CDN exchange and CDNI device C exchange at least control information and or request routing information using CDNI interface C. In some examples CDN exchange operates as a conduit for CDN referral tuples to be propagated to primary CDN . CDNI devices A B use respective CDNI interfaces A B to upload their respective prefix spaces and content item availability information to CDN exchange which processes the uploaded information to generate a CDN referral table. CDN exchange issues CDN referral table upload message to forward the CDN referral table to CDNI device C of primary CDN . CDNI device C may then respond to content requests issued by end user devices in the manner described above with respect to .

In some examples CDN exchange obfuscates prefix or tertiary CDN reachability and or content information availability information provided by secondary CDNs via CDNI interfaces A B. CDN exchange in such examples rather than merely propagating CDN referral tuples as a CDN referral table upstream toward CDNI device C replaces the referred to entity in the CDN referral tuples with an identifier for itself i.e. for CDN exchange . As a result CDNI device C redirects content requests that match on any of the CDN referral tuples of the CDN referral table to CDN exchange rather than to secondary CDNs .

CDN exchange operating as an obfuscator may maintain separate CDN referral tables a first table including aggregated prefix reachability and content availability information that CDN exchange publishes to upstream devices of primary CDNs e.g. CDNI device C of primary CDN and a second table including internal CDN referral tuples received from secondary CDNs that maintains the unmodified referred to entities i.e. surrogates or CDNI devices of secondary CDNs . To produce the aggregate table CDN exchange processes CDN referral tuples into aggregated ranges where possible and replaces the referred to entity with an identifier for CDN exchange . An identifier for CDN exchange may include a network address or URI. CDN exchange issues CDN referral table upload message to forward the aggregate CDN referral table to CDNI device C of primary CDN . CDNI device C may then respond to content requests issued by end user devices in the manner described above with respect to which leads CDNI device C to redirect content requests to CDN exchange .

In the illustrated example end user device B issues content request A to CDNI device C operating as a request router for primary CDN . CDNI device keys the request content identifier and end user device B network address to the composite key of the aggregate CDN referral table received from CDN exchange which maps to CDN exchange and CDNI device returns content redirect message B specifying CDN exchange to end user B. End user B issues content request C to CDN exchange which keys the content request to a matching internal CDN referral tuple in the internal CDN referral table. The matching internal CDN referral tuple specifies surrogate D of secondary CDN B and CDN exchange returns content redirect message D to end user B. Upon receiving content redirect message D end user device B may connect directly to surrogate D to request and receive the requested content directly from surrogate D.

CDN exchange operating as an obfuscator may in some instances assume a role of a primary CDN vis vis a content service provider. For example a CSP that operates origin server may mirror content to surrogates and contract request routing to CDN exchange . In effect the CSP provides origin server to deliver content to secondary CDNs and primary CDN would not exist in such instances.

CDN exchange may operate as a clearinghouse for information exchange for CDN Interconnections between multiple secondary CDNs and multiple primary CDNs thus reducing a burden on each of the CDNs for advertising and or receiving prefix reachability and content availability information to from multiple CDNs. Rather each of the CDNs may interface with CDN exchange which processes upstream advertisements to maintain an up to date CDN referral table for publication to upstream primary CDNs.

Although aggregating prefixes may increase a complexity of a distributed CDN system to map a given end user device to one of secondary CDNs or specific surrogates the CDN exchange may significantly reduce the operational overhead for primary CDN by offloading responsibility for managing potentially tens or even hundreds of CDNI interfaces to secondary CDNs to CDN exchange . In addition because CDN exchange operating as an obfuscator of secondary CDNs may have increased trust with the secondary CDNs versus a secondary CDN primary CDN relationship secondary CDNs may provide finer granularity CDN referral tuples to CDN exchange than would be provided to primary CDN . For example secondary CDN B may provide CDN referral tuples specifying individual surrogates C D rather than CDNI device acting as a route reflector. As a result content redirection may be handled by network system with the same number of request redirect steps as with network system of that does not incorporate CDN exchange .

Communication module of control unit receives prefix reachability and content availability information in advertisements from secondary CDNs for processing and forwarding upstream in a representation to one or more primary CDNs. Communication module stores the received information as CDN referral tuples to CDN referral table . In this instance aggregation module of control unit aggregates prefix reachability and content availability information and stores the aggregated information to a separate table i.e. aggregate CDN referral table . Aggregation module may replace referred to entities of CDN referral tuples taken from CDN referral table with an identifier for CDN exchange when generating aggregate CDN referral table . The identifier may include a URI or a network address of CDN exchange for instance.

Communication module publishes aggregate CDN referral table by sending CDN referral table upload message to upstream entities such as primary CDNs. CDN referral table upload message may represent an example of CDN referral table upload message of .

In some instances as described in further detail with respect to below communication module represents a routing protocol module that executes a routing protocol such as MP BGP to send receive routing protocol advertisements represented by advertisements and CDN referral table upload message that are extended in accordance with the techniques of this disclosure to carry prefix reachability and content availability information. In some instances communication module includes a web server that serves a web page to a web browser by which an administrator for a secondary CDN may upload prefix reachability and content availability information to CDN exchange . In some instances communication module includes a management interface that presents a command line or other interface by which an administrator for a secondary CDN may upload prefix reachability and content availability information to CDN exchange .

In some examples communication module executes an application layer traffic optimization protocol such as the Application Layer Traffic Optimization ALTO protocol. Secondary CDN providers may provide an Application Layer Traffic Optimization ALTO protocol service to provide guidance to CDN exchange regarding selection of an origin server a particular surrogate or a downstream entity such as one of CDNI devices for secondary CDNs of for content request delegation. The ALTO service may provide information that incorporates provider preferences with regard to network resources to influence network resource consumption patterns while maintaining or improving application performance.

In some examples an ALTO server of the CDNI device of one of secondary CDNs receives prefix reachability and content availability information for the entity which the ALTO server uses to generate a network map. The ALTO server also generates a corresponding cost map for the network map using for example topology information that may include traffic engineering TE information and SLAs with other providers. The ALTO service and ALTO protocol is described in further detail in J. Seedorf et al. RFC 5693 Application Layer Traffic Optimization ALTO Problem Statement Network Working Group the Internet Engineering Task Force draft October 2009 and R. Alimi et al. ALTO Protocol draft ietf alto protocol 06.txt ALTO Working Group the Internet Engineering Task Force draft October 2010 each of which is incorporated herein by reference in its entirety. In some instances CDNI devices may receive topology and or traffic engineering information for the network in BGP routing advertisements. One example of this techniques is described in Gredler et al. North Bound Distribution of Link State and TE Information using BGP draft gredler idr ls distribution 01 Mar. 12 2012 which is incorporated by reference herein in its entirety.

For example an ALTO server of the CDNI device for the entity may be configured by a secondary CDN provider with prefixes or may receive prefixes in a prefix reachability advertisement e.g. a BGP UPDATE message or IGP advertisement . The ALTO server arranges the prefixes into a network map that specifies a set of topological groupings or PIDs defined by the ALTO server for at least a portion of the network. A particular PID within a network map may represent a single device or device component a collection of devices such as a network subnet identified by a network address prefix. A cost map for a corresponding network map may reflect a combination of topological costs and or provider preferences. The cost map specifies costs respecting inter PID content delivery costs for connections among the various PIDs of the network map. That is for each pair of PIDs in the network map the cost map specifies a content delivery cost between respective devices represented in each of the member PIDs of the PID pair. In some instances where a first member PID of a PID pair in the network map represents devices that are not reachable from the second member PID of the PID pair the cost specified in the cost map from the first member PID to the second member PID may be infinite or in some cases empty. Provider preferences may correspond to SLAs with other providers or may be received from other providers in an ALTO cost map received from a downstream entity. Accordingly provider preferences may include price per megabyte or other transport costs for example. Topological costs may include traffic engineering information such as bandwidth availability delay latency and path bandwidth among other cost types.

In some instances the ALTO server may generate a supplemental content cost map for the network map where PIDs of the network map are associated with nodes of the cost map. For the content cost map where a particular content item is unavailable from a particular PID the cost map specified in the cost map to this PID from any of the other PIDs is infinite to signify the content item s unavailability to this PID.

Communication module sends ALTO requests to the ALTO server of secondary CDNs to obtain the network map and the cost map. Using the network map and cost map provided by an ALTO server of a downstream CDNI device CDN exchange or a CDNI device of an upstream entity such as primary CDN of may select serving resources to minimize costs as specified by the ALTO maps between content requesting end user devices and available resources of the upstream entity or downstream CDNs. CDN exchange may consolidate ALTO network maps cost maps and content cost maps from multiple secondary CDNs and output the master ALTO maps as a CDN referral table to primary CDN by CDN referral table upload message . When for instance CDNI device C of primary CDN receives a DNS query from one of end user devices the CDNI device C uses one or more cost maps provided by secondary CDNs and or CDN exchange to select a lowest cost as determined by provider preferences node at which to direct the DNS query for the requesting end user where the determined node may be a CDNI device of one of secondary CDNs which may perform additional redirection one of surrogates or origin server . CDNI device C redirects the DNS query to the determined node for the subscriber and returns a network address for the determined node. In this manner the techniques may allow CDN providers and CSPs to improve content delivery and serving node selection among CDNs.

Additional information regarding generation and use of ALTO network and cost maps are found in Medved et al. U.S. patent application Ser. No. 12 861 671 entitled APPLICATION LAYER TRAFFIC OPTIMIZATION SERVICE ENDPOINT TYPE ATTRIBUTE filed Aug. 23 2010 Penno et al. U.S. patent application Ser. No. 12 861 645 entitled APPLICATION LAYER TRAFFIC OPTIMIZATION SERVICE SPANNING MULTIPLE NETWORKS filed Aug. 23 2010 R. Penno et al. ALTO and Content Delivery Networks draft penno alto cdn 03 Network Working Group the Internet Engineering Task Force draft March 2011 and Medved et al. U.S. patent application Ser. No. 12 982 153 entitled DYNAMICALLY GENERATING APPLICATION LAYER TRAFFIC OPTIMIZATION PROTOCOL ENDPOINT ATTRIBUTES filed Dec. 30 2010 the entire contents of each of which are incorporated herein by reference.

Request router of CDN exchange receives content requests . In response request router queries CDN referral table having the finer granularity tuples specifying referred to entities of secondary or tertiary CDNs using the composite keys of content requests which include the issuing device and an identifier for the requested content to identify the referred to entities mapped to the composite keys in CND referral table . Request router issues content redirect messages specifying the referred to entities identified for content requests . In some instances request router and communication module of CDN exchange may be executed by separate devices deployed by a CDN exchange provider.

For example an end user device with a network address that is a member of prefix P may request a content item with a URI of www.domain.com video 12345. The request router receives and maps the content request to CDN referral table row B and redirects the content request to a surrogate having a URI of www.cdn.secondary B.1.com as indicated by the value of the cache URI column C for CDN referral table row B. Although CDN referral table row A also matches CDN referral table row A the request router in this instance selects the finer granularity URI value of CDN referral table row B. The secondary CDN that includes the surrogate having a URI of www.cdn.secondary B.1.com is better suited to serve content for the finer granularity URI value.

In some examples a device utilizing CDN referral table may implement CDN referral table using radix trees or other similar trees e.g. Patricia trees . The main prefix tree includes prefix nodes for values of prefix column A. The value of a prefix node maps to a URI tree that includes URI nodes for values of URIs for the prefix node key. The value of a URI node is the value of the cache URI column C for the matching composite key corresponding to the URI node value and the prefix node value. In the example of CDN referral table a prefix node keyed to prefix P may map to a URI tree having URI nodes keyed to www.domain.com video and www.domain.com respectively. In this way a request router may efficiently drill down to the value of the referred to entity by walking the prefix tree to identify the finest granularity matching prefix node then walking the URI tree to identify the finest granularity matching URI node.

A CDN exchange such as CDN exchange of generates aggregate CDN referral table from CDN referral table . In this instance the CDN exchange merges CDN referral table rows A C into aggregate CDN referral table row A on both dimensions of the composite key. The CDN exchange merges prefixes P and P into an aggregate range P P and further merges www.domain.com video and www.domain.com into the aggregate range of the broader URI prefix that is www.domain.com . In addition the CDN exchange replaces the cache URI values with its own URI of www.cdn.exchange.com. As a result aggregate CDN referral table row A refers all content requests that match any of CDN referral table row A C to the CDN exchange which effectively masks the granular prefix reachability and content availability information that is included in CDN referral table .

Autonomous system runs one or more interior gateway protocols IGPs such as Open Shortest Path First OSPF Routing Information Protocol RIP Intermediate System to Intermediate System IS IS Interior Gateway Routing Protocol IGRP Enhanced IGRP EIGRP and Interior Border Gateway Protocol iBGP and AS includes a set of one or more routers operating within a single administrative domain according to a routing policy interior routers not shown for ease of illustration . Autonomous system has an identification number provided by an Internet registry or by an Internet service provider ISP that uniquely identifies the autonomous system to other autonomous systems. In various embodiments AS may represent a service provider network an enterprise or campus network or a content access network CAN for example. In addition a service providers content provider or enterprise campus network administrator may administer AS .

Routers of AS implement a routing protocol to route packets from source network addresses to destination network addresses and AS may offer network packet delivery to a network or subnet of one or more endpoints identified by a network address prefix that encompasses the network address range defined by the network addresses of endpoints. Although the techniques of this disclosure may be applied with respect to multiple different routing protocols the techniques are generally described hereinafter with respect to Multiprotocol BGP MP BGP a routing protocol that defines extensions to BGP for IPv4 i.e. BGP 4 for carrying routing information for multiple different network layer protocols. MP BGP overloads BGP routing protocol advertisements with attributes that define Network Layer Reachability Information NLRI that routers of AS may use to advertise routing information associated with multiple different network layer protocols. Network layer protocols may include Internet Protocol version 4 IPv4 Internet Protocol version 6 IPv6 Layer Two Virtual Private Networking L2VPN Layer Three VPN L3VPN and BGP with Traffic Engineering extensions BGP TE .

Routers of AS specify for each multiprotocol NRLI included in a BGP routing protocol advertisement a code point that is associated with a network layer protocol. For example a multiprotocol NLRI carried in a BGP routing protocol advertisement may specify a code point for IPv4 in which case the multiprotocol NLRI carries routing information e.g. routes for IPv4. An example description of a type of MP BGP is included in T. Bates et al. Multiprotocol Extensions for BGP 4 Request for Comments 4760 Network Working Group Internet Engineering Task Force January 2007 which is incorporated by reference herein in its entirety hereinafter referred to as RFC 4760 . Multiprotocol NLRI may include the Multiprotocol Reachable NLRI MP REACH NLRI and Multiprotocol Unreachable NLRI MP UNREACH NLRI described in Bates et al. referenced above. A code point may be identified by a combination of an AFI and a Subsequent AFI SAFI in Multiprotocol Reachable and Multiprotocol Unreachable NLRI as described in RFC 4760.

CDNI devices A C of primary CDN and secondary CDNs may represent the corresponding entities of . CDNI devices A C are BGP speakers that each execute MP BGP and establish BGP peering sessions with route reflector to advertise CDNI information using MP BGP to implement aspects of CDNI interfaces A B. Route reflector is a BGP speaker that re advertises or reflects routes received from other BGP speakers to enable the BGP speakers to avoid forming a mesh of peering sessions . In some instances CDNI devices A C and CDNI devices B C peer with one another to advertise CDNI information and implement CDNI interfaces A B directly rather than indirectly via route reflector . CDNI information may refer to prefix reachability and content availability information advertised by secondary CDNs upstream to primary CDN .

Routing protocol advertisements issued by CDNI devices and route reflector may represent for example BGP UPDATE messages. In conventional BGP a BGP UPDATE message associates a network layer protocol prefix with a NEXT HOP for the prefix and a list of autonomous systems that must be traversed to reach the prefix AS PATH in BGP UPDATE messages .

In accordance with techniques described herein CDNI devices A C include respective BGP interfaces A C illustrated as BGP IFs A C and collectively referred to herein as BGP interfaces that enable respective CDNI applications A C collectively applications to modify the operation of MP BGP by CDNI devices to effect dynamic CDNI information distribution for CDNI applications as well as for other applications.

BGP interface A for example includes methods and parameters that permit CDNI application A executing on CDNI device A to dynamically create new transmit and receive interfaces associated with new or existing code points for MP BGP for use by the CDNI application A for CDNI information distribution. A new code point may represent an AFI SAFI combination that is not previously associated in CDNI device A with an application and or with a network layer protocol. Put another way the new code point is not pre defined in the implementation of MP BGP developed by the vendor of CDNI devices A. Such an implementation may for instance pre define code points for well known network layer protocols e.g. IPv4 IPv6 L2VPN and so on and provide well defined interfaces to applications executing on CDNI device A that seek to make use of network layer information exchanged by CDNI device A in accordance with those protocols. Furthermore although the new code point refers to an AFI SAFI combination in keeping with the conventional uses of BGP i.e. distributing network layer reachability information e.g. routes to network layer endpoints CDNI application A may register the new code point and or transmit receive interfaces for use in distributing application data that may be more loosely related or even unrelated to network layer protocols.

Upon creating the new transmit and receive interfaces CDNI application A may invoke BGP interface A to inject CDNI information into the MP BGP process of CDNI device A which then distributes the injected application data to BGP peers in attributes in a BGP UPDATE message that specifies the code point for the interfaces created by CDNI application A. The BGP UPDATE message may further include an application identification tag that is associated with the new interfaces for the code point and that identifies application defined NLRI within the message. That is CDNI devices seeking to advertise CDNI information may inject a custom application defined NLRI according to a data definition associated with a code point into MP BGP. CDNI devices use BGP interfaces to receive CDNI information by extract the custom application defined NRLI from MP BGP and passing the NLRI to CDNI applications . In addition upon creating new transmit and receive interfaces for CDNI applications CDNI devices trigger BGP capability negotiation for the new NLRI such that the existing vendor implemented MP BGP process can support the application defined NLRI and signal to one another their support for the application defined NLRI for CDNI applications .

In some cases one or more of the path attributes of the BGP UPDATE message may be transmitted received via BGP interfaces as opaque Type Length Value objects for distribution along with the network layer prefixes. In this way intermediate routers of AS and route reflector may accept and distribute path attributes that are not comprehensible to their respective BGP implementations. A vendor of CDNI applications may elect to register any of the path attributes with the Internet Assigned Numbers Authority IANA .

CDNI applications may invoke respective BGP interfaces to associate newly defined transmit and receive interfaces with one or more pre existing or newly defined BGP communities. The BGP communities define the distribution graphs for CDNI information injected into MP BGP. In the illustrated example CDNI applications may associate their respective transmit and receive interfaces with BGP communities to cause CDNI device C to ingest CDNI information advertised by CDNI devices A B but not vice versa. In this way CDNI devices A B of secondary CDNs advertise CDNI information upstream to CDNI device C of primary CDN . Some examples of network system may include a CDN exchange as in the example of network system of .

In the illustrated example CDNI application A invokes BGP interface A to inject CDNI information in the MP BGP process of CDNI device A which responsively issues BGP UPDATE message A to route reflector that includes NLRI that specifies the code point associated with by CDNI application A. Route reflector reflects BGP UPDATE message A as BGP UPDATE message B to CDNI device C. CDNI device by BGP interface C may then deliver the CDNI information to CDNI application for processing. As indicated above route reflector may be unable to interpret the CDNI information included in BGP UPDATE messages A B for use in routing or other applications. Nevertheless route reflector reflects the application defined application data which it is unable to interpret.

BGP interfaces thus exposes MP BGP to enable any application including CDNI applications executing on CDNI devices to dynamically utilize the routing plane of network system to distribute application specific data to one another in the network without requiring offline modification by the vendor to the software code that implements MP BGP for CDNI devices . In addition the techniques may be applied without requiring offline modification by the vendor to other BGP speakers of network system including route reflector or in some instances to ASBRs. CDNI applications may represent a vendor supplied or a third party application executing on respective software platforms of CDNI devices that present respective BGP interfaces . In other examples of the applied techniques application data exchanged by various applications executing on CDNI devices or other BGP speakers that present BGP interfaces may include device information such as operational data including available bandwidth for interfaces CPU utilization temperature device identifiers and failure information network layer protocol information for network layer protocols topology information such as Application Layer Traffic Optimization ALTO network and cost maps traffic engineering data or any other data usable by the applications to improve the operation of network system for packet content delivery or provide information to operators of AS . In other words the techniques for distributing application defined NLRI are applicable to contexts other than content delivery network information exchange.

For a vendor the techniques may enable the MP BGP process and application development teams to improve innovation and time to market by reducing the resources and team coordination required to produce a stable application that uses a pre defined extension to MP BGP by decoupling at least to some extent development for the MP BGP process and for the application. Similarly third party developers may use the techniques to develop custom applications independently of the network router vendor to improve and or extend operations of a third party network for example without having to enlist the vendor to perform offline application specific modifications to the MP BGP process thus improving the scalability of the network system routing plane for third party developers. In addition by utilizing an existing and well documented routing protocol having a large base of knowledgeable users to distribute application specific data the techniques may facilitate reliable loop free and generalized data distribution throughout network system .

Operating system of control unit provides a run time environment for multiple different processes. Operating system may represent for example a UNIX operating system derivative such as Linux or Berkeley Software Distribution BSD . Operating system offers libraries and drivers by which processes may interact with one another and with components of CDNI device including a file system and main memory. Libraries and drivers of operating system may include Application Programming Interfaces APIs that provide standard interfaces for developers to invoke the functionality of operating system and CDNI device exposed by the libraries and drivers.

Processes executed by control unit include vendor supplied processes that implement routing functionality. Here vendor refers to a manufacturer of CDNI device and or operating system . CDNI device and or operating system may be distributed in conjunction with vendor supplied processes to provide turn key routing functionality with the CDNI device hardware.

In the illustrated example vendor supplied routing protocol module RP module represents a routing protocol process that executes MP BGP by which routing information stored to one or more routing information bases A K collectively RIBs for respective address families may be determined. Routing information bases stored to a computer readable storage medium of control unit not shown in may include information defining a topology of a network such as network system of . Each of RIBs may be associated with a different one of network layer protocols illustrated as NW layer protocols . In such instances because each of network layer protocols is associated with a different code point identified e.g. by an AFI SAFI combination each of RIBs is likewise associated with a different code point recognized by MP BGP a BGP implementation included in vendor supplied RP module . For example RIB A may be associated with IPv4 and the address family identifier thereof RIB B may be associated with IPv6 and the address family identifier thereof RIB C may be associated with L3VPN and the address family identifier thereof and so on. RIBs thus define a set of predefined databases each associated with a different one of a set of predefined address family identifiers for respective network layer protocols . In this context predefined refers to a static implementation of RIBs and a static association of address family identifiers with network layer protocols respective RIBs within the version of RP module developed by the vendor of CDNI device and or operating system . In other words RIBs and the association between network layer protocols respective address family identifiers and respective RIBs is hard coded within the version of RP module distributed by the vendor. While described herein as constituting separate data structures RIBs may be implemented by control unit as any one of a number of suitable data structures such as a single table with an AFI SAFI field specifying the AFI SAFI for each table row a set of tables or databases for each of RIBs linked lists trees tries and so on. Because RP module uses MP BGP for routing information distribution one or more of RIBs may each include a set of one or more NLRI for the corresponding address family. In some instances CDNI device does not route packets through the network for any of network layer protocols and thus routing protocol module may not store any of RIBs .

In accordance with techniques of this disclosure RP module executes BGP interface by which CDNI application modifies the operation of MP BGP to facilitate generalized distribution of application specific data. BGP interface may include a user level library invocable by CDNI application for directing RP module to register new code points and or receive transmit interfaces and to exchange with other routers using MP BGP application data using the new code points and or receive transmit interfaces on behalf of CDNI application . BGP interface may use a sockets library shared memory files message passing such as Common Object Request Broker Architecture CORBA techniques message queuing or other inter process communication IPC mechanism for communication between CDNI application and RP module . In some instances aspects of BGP interface may be implemented as a kernel level library of operating system . A manufacturer of RP module may provide an API description for BGP interface to enable third party developers or other manufacturer software development teams to develop user applications that programmatically manipulate RP module and dynamically make use of BGP extensibility techniques described herein.

CDNI application is a user level process executing on the software environment provided by operating system of control unit . CDNI application may represent an application developed by a third party such as a vendor customer or partner an Original Equipment Manufacturer OEM or a research institution that manipulates vendor supplied components of CDNI device including operating system RP module to facilitate third party purposes that in this case primary involve content delivery network information exchange but may in some instances involve network operations and management processing data into business information running network experiments to further research goals among others. The third party developers may use a vendor supplied software development kit SDK that provides the tools APIs and libraries to develop user applications that use BGP interface . The vendor supplied SDK may for example provide APIs for C C Perl Python Ruby Scala Java and or Javascript among other programming languages. CDNI application may alternatively represent an application developed by the vendor but nevertheless making use of BGP interface . For the vendor this may enable the RP module and CDNI application development teams to decouple at least to some extent their respective development processes and improve innovation and time to market by reducing the resources and team coordination required to produce a stable application that exchanges application data with other routers using MP BGP .

BGP interface provides CDNI application with a registration interface hereinafter register method for registering a new code point and or new transmit receive interface by specifying a corresponding AFI SAFI and application identifier. In the illustrated example when invoked by CDNI application with a register method invocation message specifying a code point and application identifier BGP interface dynamically creates routing information base RIB to store NLRI associated with the code point. BGP interface additionally configures the code point in address family configuration data illustrated as AF Config. . CDNI application may use one of the IPC mechanisms described above to send register method invocation message .

Dynamically created routing information base stored to a computer readable storage medium of control unit not shown in may store application data associated with multiple different applications each associated with a different application identifier. RIB may in some instances be predefined and associated with a magic carpet code point for MP BGP that carries application defined NLRI for multiple different applications. MP BGP may exchange opaque NLRI with the magic carpet code point but does not necessarily comprehend the application defined NLRI. Rather an embedded application identifier in NLRI on the magic carpet identifies to RP module the application that processes the NLRI.

Application data stored to RIB may but does not necessarily include routing information for network layer protocols such as IPv4 IPv6 and L3VPN. Application data may include any data including CDNI information that user applications including CDNI application distribute or obtain by operation of RP module executing MP BGP to exchange BGP UPDATE messages that include attributes carrying the application data.

Address family configuration data includes a data structure to associate code points with RIBs and . As described in further detail below address family configuration data may additionally associate each of the code points with a callback function or other reference provided by applications that register the code point that RP module invokes upon receiving application data associated with the address family in a BGP UPDATE message.

The register method of BGP interface may include an optional callback parameter by which applications may register a callback function a reference to a shared memory location or other IPC object or some other reference that manipulates the operation of RP module upon receiving BGP UPDATE messages that specify an address family identifier and application identifier registered with the register method as used herein a callback . When an application invokes the register method including the optional callback parameter BGP interface associates the code point and application identifier provided in the register method with the value of the callback parameter in address family configuration data . When RP module receives a BGP UPDATE message specifying a code point RP module may extract the application data e.g. the NLRI and associated path attributes and look up the specified code point and application identifier in address family configuration data . If the code point and application identifier are associated with a callback parameter value RP module provides the extracted application data to an application using the value of the callback parameter. In the illustrated example BGP interface invokes a callback function to send callback message including extracted application data to CDNI application .

BGP interface additionally includes a distribute interface hereinafter distribute method by which applications may specify a code point and application identifier registered in address family configuration data and direct RP module to encapsulate application data to send to other network devices in BGP UPDATE messages that specify the address family identifier. In the illustrated example CDNI application sends distribute method invocation message including application data a code point and an application identifier to invoke the distribute method of BGP interface . If the address family identifier is registered RP module sends the application data in BGP UPDATE messages to BGP peer devices of CDNI device that have advertised a capability to handle the code point and application defined NLRI. In some instances the distribute method receives application data as a struct or class.

BGP interface may store application data for a code point received from applications and from BGP peer routers in BGP UPDATE messages to the associated one of RIBs or RIP . RP module may perform a capability advertisement exchange to determine whether a peer BGP speaker for CDNI device supports a code point and application defined NLRI according to the above described techniques. Before distributing application data for a registered code point and application identifier to a peer BGP speaker RP module may in some cases require receipt of a BGP Capability Advertisement issued by the peer BGP speaker and having a Capabilities Optional Parameter having a value set to the code point and an additional parameter set to the application identifier. In some examples this Capability Value field separately specifies the AFI and SAFI for the registered address family. Upon receiving assurances in the form of a suitable BGP Capability Advertisement RP module may then replicate in whole or in part RIB for the code point to the peer BGP speaker using BGP. RP module may likewise issue a BGP Capability Advertisement specifying a code point to indicate to peer BGP speakers that CDNI device supports the code point. The code point may be dynamically announced without needing to terminate existing BGP sessions.

CDNI application includes a request router CDN referral table and CDN referral tuples . CDNI application may advertise CDN referral tuples of CDN referral tuples to other CDNI devices by injecting the CDN referral tuples into MP BGP using the above described techniques. That is CDNI application may encapsulate the one or more CDN referral tuples into an application defined NLRI that include an application identifier for CDNI applications and direct RP module via BGP interface to advertise the NLRI in a specified code point. Similarly CDNI application may receive NLRI from MP BGP advertised to CDNI device extract CDN referral tuples included therein and generate CDN referral table from the extracted CDN referral tuples. Request router may route content requests based on CDN referral table . Various instances of CDNI device of may not include request router CDN referral table and or CDN referral tuples .

MP REACH NLRI of extended BGP UPDATE message specifies an Address Family Identifier AFI of 1 in this example to indicate IPv4 network addresses along with a value for the Subsequent AFI SAFI of 129 to identify opaque NLRI as carrying application defined information in a magic carpet code point defined by the AFI SAFI combination 1 129. AFI and SAFI may in some instances have different values as assigned by a private party or by IANA.

Opaque Network Layer Reachability Information NLRI is illustrated and described as a Type Length Value TLV object with the type indicated by application identifier illustrated as APP ID field A a length indicated by length field B and value field indicated by application data illustrated as APP DATA field C. Application identifier field A is associated in RP module with CDNI application executing on CDNI device . Application data in application data field C may be formatted in an application defined format specified by CDNI application . The application data for CDNI application may include prefix reachability and or content availability information such as URIs for one or more content items. While illustrated and described with respect to CDNI information opaque NLRI may carry application information for many different applications in corresponding application defined formats.

Extended communities attribute includes fields A D that define a distribution graph for BGP UPDATE in combination with route target configurations on BGP speakers of a network system. CDNI application may configure extended communities using BGP interface to define and control opaque NLRI distribution policies. The value of the route target e.g. a combination of administrator illustrated as ADMIN field C and assigned number illustrated as ASSIGNED NO field D may be associated in address family configuration data with the application identifier rather than the AFI SAFI values. In this way application identifiers for multiple different applications and corresponding application defined NLRI may have distinct distribution graphs that conform to application specific distribution requirements.

CDNI application and application execute on control unit on which routing protocol module also executes. Each of the applications invokes a register method exposed by BGP interface and supplies an AFI a SAFI an application identifier and a callback parameter value. The combination of the AFI and SAFI define in this example a code point for MP BGP. The callback parameter value identifies a mechanism by which RP module may provide application data to the associated application.

BGP interface responsively executes the register method invoked by the applications to register the combination of the code point application and callback by inserting one of table entries A N collectively table entries into address family configuration data . In the illustrated example address family configuration data is a table that includes table entries each having values for CALLBACK AFI SAFI APP ID and RIB fields. For each of table entries the CALLBACK field stores a callback value the AFI and SAFI fields define a code point the APP ID specifies an application identifier for NLRI for the code point and the RIB field includes a reference to RIB . In this example the code point defined by the AFI SAFI of 1 129 is a magic carpet that carries application data multiplexed into opaque NRLI carried by MP REACH NLRI specifying the code point and distinguishable by the application identifier. Here table entry A specifies an application identifier having value 1 associated with CDNI application . Table entry N specifies an application identifier having value 15 associated with application .

RIB stores in this example opaque NLRI A K containing application defined application data for CDN application and application . For instance opaque NLRI B specifies an application identifier having value 15 and contains application data for application . Opaque NLRI C as another instance specifies an application identifier having value 1 and contains application data for CDNI application .

CDN exchange subsequently receives content request C redirected by primary CDN toward CDN exchange . CDN exchange queries the internal CDN referral table that retains the original referred to secondary CDNs using a composite key made up of an identifier for the requested content and a network address of the requesting end user device . Upon matching the composite key to a CDN referral tuple of the CDN referral table CDN exchange redirects the content request to the referred to one of secondary CDNs in the matching tuple by sending content redirect message D .

The techniques described herein may be implemented in hardware software firmware or any combination thereof. Various features described as modules units or components may be implemented together in an integrated logic device or separately as discrete but interoperable logic devices or other hardware devices. In some cases various features of electronic circuitry may be implemented as one or more integrated circuit devices such as an integrated circuit chip or chipset.

If implemented in hardware this disclosure may be directed to an apparatus such a processor or an integrated circuit device such as an integrated circuit chip or chipset. Alternatively or additionally if implemented in software or firmware the techniques may be realized at least in part by a computer readable data storage medium comprising instructions that when executed cause a processor to perform one or more of the methods described above. For example the computer readable data storage medium may store such instructions for execution by a processor.

A computer readable medium may form part of a computer program product which may include packaging materials. A computer readable medium may comprise a computer data storage medium such as random access memory RAM read only memory ROM non volatile random access memory NVRAM electrically erasable programmable read only memory EEPROM Flash memory magnetic or optical data storage media and the like. In some examples an article of manufacture may comprise one or more computer readable storage media.

In some examples the computer readable storage media may comprise non transitory media. The term non transitory may indicate that the storage medium is not embodied in a carrier wave or a propagated signal. In certain examples a non transitory storage medium may store data that can over time change e.g. in RAM or cache .

The code or instructions may be software and or firmware executed by processing circuitry including one or more processors such as one or more digital signal processors DSPs general purpose microprocessors application specific integrated circuits ASICs field programmable gate arrays FPGAs or other equivalent integrated or discrete logic circuitry. Accordingly the term processor as used herein may refer to any of the foregoing structure or any other structure suitable for implementation of the techniques described herein. In addition in some aspects functionality described in this disclosure may be provided within software modules or hardware modules.

Various embodiments have been described. These and other embodiments are within the scope of the following examples.

