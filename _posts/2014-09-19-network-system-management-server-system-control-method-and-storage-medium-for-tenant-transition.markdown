---

title: Network system, management server system, control method, and storage medium for tenant transition
abstract: Provided is a management server system that accepts a transition instruction for transition between tenants of an agent device, generates symmetric keys consisting of a first key and a second key, responds the second key to the agent device, and verifies signature information included in a transition request using the first key when the agent device makes a tenant transition request. Upon successful verification of signature information, the management server system transmits new authentication information for communication between the management server system and the agent device to the agent device. After transition of the tenant, the agent device communicates with the management server system using the new authentication information.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09407611&OS=09407611&RS=09407611
owner: CANON KABUSHIKI KAISHA
number: 09407611
owner_city: Tokyo
owner_country: JP
publication_date: 20140919
---
The present invention relates to a network system including a management server system that manages a plurality of devices registered in tenant units and a device management agent that relays the devices and the management server system.

There have been proposed device management services that register a device such as a peripheral device or a printer manage the registered peripheral device via a network and provide services. Some device management services are used by a service provider device management service provider to manage devices of a plurality of customers individual people and companies . Such device management services secure a data region for each customer and register and manage devices for each customer.

There have been proposed systems in which a server for providing a device management service is disposed in the cloud of Internet. In such systems a device management agent is disposed in a customer network environment or a device management agent function is implemented in a device so as to enable a relay between the device management server and the device. For example the device management service and the device management agent communicate with the device management server via HTTP HTTPS or the like. The device management agent communicates with the device management server receives work instructions and transmits device information.

The device management agent is managed in association with a customer which is managed by the device management server. The device management agent receives an authentication key for the device management agent upon registration processing for registering a device into the device management server and uses the authentication key for authentication when communicating with the device management server. In the device management server the device management agent authentication key is managed for each customer and is managed in a data region for each customer.

For example Japanese Patent Laid Open No. 2006 99741 discloses a document management server that associates each of devices and documents with a group to which each of the devices and documents belongs and manages them so as to restrict the devices which are capable of outputting the documents. For example Japanese Patent Laid Open No. 2004 54633 discloses a system which associates IP addresses of a plurality of terminals such as mobile phones PDAs PCs automobiles and the like with user identification information and manages them so as to enable a terminal switching operation by information synchronization via Internet.

In the device management services described above two or more customers may be integrated into one customer due to an integration of customer companies or the like. In this case device management information managed by the device management agent which is the transition source needs to be transitioned from a transition source customer to a transition destination customer and the device management agent needs to be redisposed reset. For example in order to register the device management agent into the transition destination customer software for the device management agent needs to be reinstalled so as to perform a re registration operation for the transition destination customer. Thus a service provider SE needs to visit a customer company to perform an operation.

Upon transition of the device management agent between customers the device management agent authentication key held by the device management agent needs to be newly issued so as to safely realize a key exchange between the transition destination customer and the device management agent.

The present invention provides a network system that realizes safe transition between agent s customers only when the user specifies the transition destination to the device management server without operating the device management agent which is in a customer s network environment.

According to an aspect of the present invention a network system is provided that includes a management server system that manages a plurality of network devices and an agent device that is provided in a site network including the plurality of network devices and communicates with the management server system. The management server system includes an accepting unit configured to accept a transition instruction for transition from a first tenant to a second tenant of the agent device a generating unit configured to generate symmetric keys consisting of a first key and a second key in response to the transition instruction a managing unit configured to manage identification information about the agent device and the generated first key by associating them with the second tenant serving as a transition destination a responding unit configured to respond information about the second tenant serving as the transition destination and the generated second key to a query from the agent device a verifying unit configured to upon reception of a transition request for transition to the second tenant verify signature information included in the transition request using the first key which is managed in association with the second tenant and a transmitting unit configured to upon successful verification of the signature information transmit new authentication information for communication between the management server system and the agent device to the agent device. The agent device includes a querying unit configured to send a query to the management server system a receiving unit configured to receive a response a requesting unit configured to transmit a transition request for transition to the second tenant which includes signature information using the second key included in the response to the management server system in accordance with the response and a storing unit configured to store new authentication information which has been transmitted from the management server system in accordance with successful verification of the signature information in association with the second tenant.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

The network system shown in according to one embodiment of the present invention includes a management terminal a peripheral device a device management server and a device management agent hereinafter also simply referred to as agent . A network is a network configured by a known technique such as Internet. The management terminal is a personal computer or the like operated by a service provider user and is connected to the network . Although there are a customer network and a firewall between the management terminal and the network the customer network and firewall are not illustrated in .

The device management server manages the peripheral device for each of a plurality of customers or in tenant units. The device management server is disclosed on the network and is communicable with the management terminal the peripheral device and the device management agent . While only one device management server is shown in the device management server functions as a device management server system that is constituted by a management server a storage server and the like on the Internet.

The peripheral device is network device that is communicable with a host computer not shown and the agent device . The peripheral device is a multi function peripheral a printer or the like that receives print data from for example a host computer via a customer network and then prints the print data on a sheet using a known printing technique such as an electrophotographic technique an inkjet technique or the like. The peripheral device may also be a multi function peripheral having functions of reading a paper original via for example a scanner copying the paper original and transmitting image data via an Email or the like by converting the paper original into image data.

The device management agent is an agent device that communicates with the peripheral device instead of the device management server and collects information such as a job log from the peripheral device so as to control the peripheral device . The device management agent is provided in a site network including one or a plurality of peripheral devices . The peripheral device and the device management agent are connected to the customer network such as LAN and are connected to the network via a firewall . Thus communication transmitted from the management terminal and the device management server which are connected to the network is rejected by the firewall . Thus the communication to the peripheral device and the device management agent cannot be established from the management terminal and the device management server .

In the above network system the service provider user operates the management terminal accesses the device management server and registers and manages the peripheral device which is managed for each customer. Then the service provider user refers to information about the peripheral device which is managed for each customer and instructs the peripheral device to execute a control command. The device management agent communicates with the device management server at regular intervals checks whether or not the service provider user has instructed the peripheral device to execute the control command and receives the control command if there is an instruction. Upon execution of the control command the device management agent collects information about the peripheral device or changes the operational settings of the peripheral device using the SNMP protocol or the like.

The Web server unit includes a Web UI unit and a Web service unit . The Web UI unit receives the HTTP request from a Web browser of the management terminal and associates with the user authentication unit . When the user authentication unit performs a successful user authentication the Web UI unit responds HTML data to the Web browser . The Web service unit receives a Web service request such as SOAP or REST from the agent and returns a response such as XML data to the agent .

When no authentication token is set to the HTTP request made from the Web browser the user authentication unit determines that an access is made from an unauthenticated user and returns HTML of a log in screen. The Web browser displays the log in screen. When authentication information such as a user ID a password or the like is input by a user s operation the Web browser transmits authentication information to the device management server . When the combination of a user ID and his password is correct upon reception of authentication information the user authentication unit determines that authentication has succeeded issues and sets an authentication token to a cookie or the like and instructs the Web UI unit to redirect to the requested screen. Upon being redirected to the requested screen the Web UI unit generates HTML of the requested screen and transmits the HTML back to the Web browser .

The device management unit includes a customer management unit a device management unit an agent management unit and a job history collection unit . The customer management unit manages customers registered in the device management server . The device management unit manages information about the peripheral device registered for each customer. The agent management unit controls registration processing for registering the agent in the device management server and transition processing for transition to another customer of the agent. Upon registration of the agent the agent management unit also performs control for safely passing an authentication key to the agent . When the Web service unit receives a request from the agent the agent management unit performs agent authentication processing.

The job history collection unit receives job history from the agent via the Web service unit and stores the received job history in a job history information table to be described below with reference to . Upon reception of job history the Web service unit acquires a customer ID an agent ID and signature information which are added to the HTTP header portion of the HTTP request and passes them to the agent management unit . The agent management unit acquires an authentication key which is in association with the acquired customer ID and agent ID from the agent management table to be described below with reference to and then creates signature information about the HTTP message. When the created signature information matches the signature information acquired from the HTTP header the request is authenticated as a request made from a correct agent. Then when the agent management unit transfers the HTTP message to the job history collection unit the job history collection unit acquires job history information from the HTTP message and stores the job history information in the job history information table .

The database includes a customer management table a device management table an agent management table a job history information table a first transition management table and a second transition management table . A description will be given of information managed by the tables with reference to .

For example a row indicates the fact that the customer having the customer ID of AA is registered with the peripheral device which is associated with the agent having the agent ID of QWE and has the device ID of QWE1234 . Information about peripheral devices registered in customers having the customer ID of BB is registered in rows and . When a table is separately managed for each customer the row having the customer ID of AA and the rows and having the customer ID of BB are stored in different tables having the same structure.

When the agent belonging to the customer having the customer ID of BB shown in is transitioned to the customer having the customer ID of AA the table shown in is updated to the table shown in . As shown in the agent having the agent ID of ASD and the agent having the agent ID of RTY are transitioned to the customer having the customer ID of AA . The device management server generates a new authentication key for each agent upon transition of an agent stores the new authentication key in the agent management table and transmits the generated authentication key to the agent. Upon reception of a successful transition notification from the agents ASD RTY the device management server deletes customer information about the transition source and its authentication key. In the example shown in the table shown in is deleted.

A transition destination customer ID is an ID of the transition destination customer to which an agent is transitioned. A transition key A and a transition key B are symmetric keys for encryption. Upon generation of the symmetric keys the agent management unit stores the symmetric keys in the transition source customer table i.e. the first transition management table . Data encrypted with the transition key A can be decrypted with the transition key B and data encrypted with the transition key B can be decrypted with the transition key A. Upon performing transition processing the transition source customer distributes the transition key A to the transition destination customer and the transition key B to the agent targeted for transition and the transition destination customer and the agent targeted for transition use the transition key A and the transition key A respectively for authentication.

An expiration date indicates the expiration date of transition processing. When the agent transition processing is not succeeded before the expiration date it is judged that agent transition has failed. A successful transition time is a time at which transition to the transition destination customer of the agent has been succeeded and the successful transition notification has been received from the agent . A transition time indicates a time at which the agent switches a transmission destination to which device information job history information and the like from the transition source customer to the transition destination customer after successful transition to the transition destination customer of the agent .

For example a row indicates the fact that the agent having the agent ID of ASD registered in the customer having the customer ID of BB has been transitioned to the customer having the customer ID of AA . The row also indicates the fact that the transition key A is 1qaz2wsx the transition key B is bgt5nhy6 the expiration date is 2012 07 01 12 01 the successful transition time is 2012 07 03 03 41 and the transition time is 2012 07 04 03 41 .

The panel controller PanelC controls an instruction input from the operation panel provided in the peripheral device . The display controller DISPC controls display of the display module DISPLAY constituted by for example a liquid crystal display. The disk controller DKC controls the hard disk HD which is a mass storage device. The network interface card NIC exchanges data with another node via the network . The scanner controller SCANC controls the optical scanner provided in the peripheral device to read a paper original. The printer controller PRNC controls the printer provided in the peripheral device to print data on a sheet using a known printing technique such as the electrophotographic technique or the inkjet technique.

The job control unit receives a print job received by the interface unit and a copy job generated by the UI control unit to execute the jobs. The job control unit controls the printer controller or the scanner controller depending on the content of a job to execute the job. Upon start or end of execution of a job the job content and the results of execution are recorded as history in the job history management unit . The device information management unit manages setting information and configuration information about the peripheral device and responds the specified information in response to the information acquisition request made from another configuration module. An example of information managed by the device information management unit includes a serial number.

The input device INPUT is a keyboard a mouse a touch panel a button and or the like and provides an input unit to a user s operation. The display module DISPLAY is a display module constituted by a liquid crystal display or the like. The network interface card NIC bi directionally exchanges data with another node via the network .

The HTTP communication unit receives a communication request from the web browser communicates with a web server via an image processing apparatus and the like and the NIC with use of a protocol such as HTTP or HTTPS requests a web page and receives Web page data. The service provider user specifies the URL of the device management server on the Web browser of the management terminal and accesses the Web server so that the service provider user can use the functions of the device management server .

The agent control unit includes an authentication key transition information storage unit and controls registration of the agent in the device management server and agent transition processing between customers. When the UI control unit detects that the user has provided an agent registration instruction to the device management server the UI control unit notifies the agent control unit of the detection. The device management unit acquires a list of peripheral devices to be managed by the relevant agent from the device management server via the interface unit . The device management unit collects information from the acquired peripheral devices to be managed via the interface unit and transmits the collected information to the device management server . A device information management unit acquires setting information and configuration information from the device information management unit of the peripheral device and transmits the setting information and configuration information to the device management server . A job history management unit acquires job history information managed by the job history management unit of the peripheral device and transmits the job history information to the device management server .

A transition key B is an encryption key which is passed when a customer transition instruction has received from the device management server and is used for transition processing. The transition key B is used for verifying a transition destination customer and for verifying an agent targeted for transition. A post transition authentication key is an authentication key which is passed from a transition destination customer upon successful transition processing for transition to the transition destination customer. A transition date and time is a date and time at which transition instructed by a transition source customer is performed upon successful transition processing for transition to the transition destination customer. The agent control unit is connected to the transition source customer before the transition date and time and is connected to the transition destination customer after the transition date and time .

The authentication key is generated by the device management server for each agent and is passed to the agent . When the agent acquires an authentication key after successful registration in the device management server the agent creates signature data using the authentication key upon subsequent communication and transmits communication data to which signature data and an agent s identifier agent ID have been appended to the device management server . Upon reception of communication data from the agent the device management server creates signature data using an authentication key of the relevant agent and it is judged that authentication has succeeded when the created signature data matches the signature data appended to the communication data.

Next a description will be given of the flow of processing for registering an agent in the device management server after installation of the agent with reference to . Firstly in step S the agent communicates with the device management server by a user s operation receives a menu screen not shown and displays it on the display . In step S the user selects an agent registration menu on the displayed menu screen using the input device such as a mouse or a keyboard. When the agent detects that the agent registration menu has been selected by the input device the agent displays an agent registration screen not shown on the display module in step S. The agent registration screen has an agent registration code input control and a register button for instructing agent registration.

Next in step S the user confirms the agent registration code of a customer to which an agent is to be registered from the customer management table managed by the device management server . Then the user inputs the agent registration code to an agent registration code input code and presses the register button. In step S the agent control unit of the agent generates an agent ID such as GUID and transmits an authentication key acquisition request including the agent ID and the input agent registration code to the device management server . In the case of a configuration in which the agent manages one peripheral device the agent ID may be the serial No. of the peripheral device. The device management server may also generate an installer for a software module of an agent to which an agent ID being unique in the system is assigned so as to download the software module.

Upon reception of an authentication key acquisition request by the device management server the agent management unit searches for a customer in which the agent registration code in the customer management table shown in matches the received agent registration code. When a customer who matches the received agent registration code is present the agent management unit generates an authentication key for the relevant agent and registers a record in the agent management table for the relevant customer. For example when the agent having the agent ID of ASD is registered for the customer having the customer ID of BB and the authentication key is cde34rfv the record is as shown in the row in . Then the device management server transmits a successful registration notification together with the generated authentication key and the customer ID to the agent . When the agent registration key which matches the received agent registration key is not found in the customer management table the device management server transmits a registration failed notification to the agent .

In step S the agent control unit of the agent judges whether or not the authentication key has been successfully acquired. If unsuccessful the processing returns to step S and the agent control unit requests the user to input the agent registration key again. If successful the processing proceeds to step S and the agent control unit stores the received authentication key in the authentication key transition information storage unit and the agent registration processing ends. When the customer ID of the customer to which the agent has been registered is BB the agent ID is ASD and the authentication key is cde34rfv the report registered in the authentication key transition information storage unit is as shown in the row in .

The job history management unit of the agent acquires and stores job history information executed by the peripheral device and transmits the job history information to the device management server via the interface unit at regular intervals. Upon transmission of a job history the job history management unit acquires the authentication key from the authentication key transition information storage unit generates signature information about the HTTP message for job history transmission using the authentication key and adds the signature information to the HTTP header together with the customer ID and the agent ID. Signature information is generated by using an algorithm such as SHA.

When the device management server receives a job history transmission message from the job history management unit of the agent the agent management unit performs agent authentication processing using the HTTP message and information about the HTTP header. During agent authentication processing the agent management unit firstly acquires the customer ID the agent ID and signature information from the HTTP header. Next a row which matches the agent ID specified by the HTTP header is searched from the agent management table for the customer specified by the customer ID of the HTTP header so as to acquire the authentication key for the relevant row. When the relevant row is absent it is judged that authentication has failed.

Next the agent management unit generates signature information about the HTTP message using the authentication key for the relevant row and compares it with signature information acquired from the HTTP header. If matched it is judged that authentication has succeeded whereas if not matched it is judged that authentication has failed. If authentication has succeeded the job history collection unit of the device management server stores the received job history in the job history information table for the customer specified by the customer ID of the HTTP header.

Next a description will be given of processing for transition of an agent from the registered customer to another customer with reference to . Firstly a description will be given of the agent transition request processing shown in . In step S the service provider user activates the Web browser on the management terminal . In step S the service provider user specifies the URL of the device management server and transmits an agent transition screen display request to the device management server .

Upon reception of the screen display request the device management server verifies the request. If the request is in an unauthenticated state the device management server generates HTML of the user authentication screen and transmits the HTML back to the Web browser in step S. The Web browser draws the HTML of the received user authentication screen.

In step S when the service provider user inputs user authentication information on the displayed user authentication screen the Web browser transmits the input user authentication information to the device management server . The user authentication unit of the device management server verifies the received user authentication information so as to verify whether or not the user is legitimate. If authentication has succeeded the device management server acquires a customer information list from the customer management table generates the agent transition screen HTML including the customer information list and transmits the agent transition screen HTML to the Web browser . The Web browser displays the agent transition screen including the customer list received in step S.

In step S when the service provider user selects a customer including an agent targeted for transition from the customer list on the agent transition screen the Web browser transmits the selected customer to the device management server . The device management server acquires an agent information list from the agent management table for the specified customer generates HTML of the transition destination customer transition agent specification screen shown in and transmits the HTML to the Web browser . Next in step S the Web browser displays the transition destination customer transition agent specification screen.

Reference numerals and indicate control for selecting whether all the agents registered to the transition source customer are transitioned or an agent targeted for transition is selected. Reference numeral indicates control for selecting an agent targeted for transition if a selection has been made by the control to select an agent targeted for transition. A button is an apply button for confirming the input. Upon pressing the apply button the agent transition request is transmitted to the device management server .

Referring back to in step S the service provider user inputs the customer ID of the transition destination customer to the transition destination customer ID and inputs the transition confirmation code to the transition confirmation code . Next in step S an agent targeted for transition is selected via controls and . Upon pressing the apply button in step S the Web browser transmits the agent transition request to the device management server based on the input information.

Next in step S the agent management unit generates a transition key for each agent targeted for transition. When the transition all agents has been selected on the transition destination customer transition agent specification screen the agent management unit acquires a list of agents for the transition source customer of interest from the agent management table and generates transition keys for each agent. The transition keys are a pair of keys consisting of symmetric keys. Data encrypted with one transition key A can be decrypted with the other transition key B. Data encrypted with the transition key B can be decrypted with the transition key A.

Next in step S the agent management unit creates transition sending information for each agent targeted for transition and stores the transition sending information in the first transition management table . When the transition all agents has been selected as shown in the agent management unit sets transition sending information as the row and the row shown in . The agent management unit specifies the transition source customer ID as BB the agent ID as ASD and the transition destination customer ID as AA . The agent management unit sets the transition keys A and B generated in step S to the transition key A and the transition key B respectively and sets a time which is obtained by adding a predetermined time to a time at which the transition instruction has been received as the expiration date .

In step S the agent management unit transmits transition information to the transition destination customer AA. Next in step S the agent management unit receives transition acceptance information from the transition destination customer AA and in step S the agent management unit stores the transition acceptance information in the second transition management table for the transition destination customer. Transition information transmitted to the transition destination includes a transition destination customer ID an agent ID targeted for transition a transition source customer ID a transition key A and an expiration date which are stored by associating them with items corresponding to reference numerals to in the second transition management table . Here while in the present embodiment transition information is transmitted to a terminal or the like used by the transition destination customer and the table shown in is stored upon reception of transition acceptance information the present invention is not limited thereto. Transmission to the transition destination customer may also be logically performed in the agent management unit . When the device management server is present in plural transition information may also be transmitted to the agent management unit of the device management server on which the transition destination customer is managed via the network.

A description will be given of transition request processing executed by the agent with reference to . In steps S and S the agent control unit of the agent acquires a transition request from the device management server at regular intervals. When there is no transition request the agent control unit makes an attempt to acquire a transition request again after waiting for a predetermined time. When there is a transition request the processing proceeds to step S and the transition request processing is performed.

Upon reception of the transition request acquisition request from the agent the device management server acquires transition information in which the agent ID matches the agent ID of the acquisition request source from the first transition management table . Then the device management server transmits the acquired transition information to the agent . The transition information includes a transition destination customer ID and a transition key B. In other words the device management server responds information about the transition destination customer and the generated one key to a query from the agent .

In step S upon reception of transition information the agent stores the transition information i.e. the transition destination customer ID and the transition key in the authentication key transition information storage unit . In the example shown in when the agent having the belonging customer ID of BB and having the agent ID of ASD receives transition information having the transition destination customer ID of AA the authentication key transition information storage table is in the state shown in the row in .

Next in step S a transition request message to the transition destination customer is generated based on the received transition information. The transition request message includes the transition source customer ID and the agent ID of the agent itself. Next in step S the generated transition request message is encrypted with the transition key B received from the device management server and in step S the encrypted transition request message is transmitted to the device management server .

Upon reception of the transition request message from the agent the device management server executes transition request acceptance processing so as to judge whether or not the transition request is accepted. When the transition request is accepted the device management server transmits a transition acceptance message back to the agent . Details about the transition request acceptance processing will be described below with reference to . Next when the agent judges in step S that the transition acceptance message has been received from the device management server the processing proceeds to step S whereas when the agent judges in step S that a transition request acceptance error has been received the processing proceeds to step S.

In step S the transition acceptance message is decrypted with the transition key B. If the decrypted transition acceptance message is in the predefined format the transition destination customer is judged to be an authorized customer in step S and the processing proceeds to step S. On the other hand if the transition acceptance message fails to be decrypted or is not in the predefined format the transition destination customer is judged to be an unauthorized customer and the processing proceeds to step S. In step S an authentication key for an agent for the transition destination customer is acquired from the decrypted transition acceptance message and is stored in the post transition authentication key of the authentication key transition information storage unit .

Next in step S the agent transmits a successful transition notification to the device management server . Successful transition notification reception processing performed by the device management server will be described below with reference to . After the agent transmits the successful transition notification to the device management server the transition processing is executed in step S. Details of the transition processing will be described below with reference to . If transition has failed the agent transmits a transition failure notification to the device management server in step S. Next in step S the agent deletes transition information such as the transition destination customer ID the transition key B and the like stored in the authentication key transition information storage table . Thus the agent ends the transition request processing.

A description will be given of the transition request acceptance processing executed by the device management server after reception of the transition request transmitted from the agent in step S shown in with reference to . Firstly in step S upon reception of the transition request transmitted from the agent the device management server acquires the transition destination customer ID the agent ID and the encrypted transition request message from the transition request message.

Next in step S the agent management unit acquires the transition key A for the relevant agent from the second transition management table for the transition destination customer. In step S the agent management unit decrypts the encrypted transition request message with the transition key A acquired in step S. If the decrypted transition request message is in the predefined format and the transition destination customer ID and the agent ID included in the decrypted transition request message match those included in the transition request the agent targeted for transition is judged to be an authorized agent.

When the agent management unit judges in step S that the agent which has transmitted the transition request in step S is an authorized agent targeted for transition the processing proceeds to step S. On the other hand if the encrypted transition request message fails to be decrypted or is not in the predefined format the agent is judged to be an unauthorized agent targeted for transition and the processing proceeds to step S.

In step S the agent management unit further confirms whether or not the transition request is within a transition expiration date. The transition expiration date is stored in the expiration date of the second transition management table . The transition expiration date is determined by the transition source customer and is transmitted to the transition destination customer. If the current time is before the expiration date the request is judged to be within the expiration date and the processing proceeds to step S. If otherwise the processing proceeds to step S.

Next in step S the agent management unit newly generates an authentication key for an agent device targeted for transition in the transition destination customer. In step S the agent management unit registers agent information including the generated authentication key as new authentication information in the agent management table . For example when the agent having the agent ID of ASD is transitioned to the customer having the customer ID of AA agent information is registered as shown in the row in . The customer ID is set to AA the agent ID is set to ASD and the authentication key is set to zse4xdr5 which is the generated authentication key.

Next in step S the agent management unit creates a transition acceptance message including the authentication key. In step S the generated transition acceptance message is encrypted with the transition key A. The transition key A is stored in the transition key A of the second transition management table shown in and the transition key A in the row where the agent targeted for transition matches the agent ID is used. Next in step S the agent management unit transmits the encrypted transition acceptance message back to the agent . When the agent is judged to be an unauthorized agent targeted for transition or has expired on the transition expiration date the agent management unit transmits a transition request acceptance error back to the agent in step S.

Next a description will be given of the successful transition notification reception processing executed by the device management server after reception of a successful transition notification transmitted from the agent in step S shown in by the agent management unit of the device management server with reference to . Firstly upon reception of a successful transition notification from the agent in step S the device management server sets a current time to the successful transition time in the row of the relevant agent in the first transition management table for the relevant transition source customer in step S.

Next in step S the device management server judges whether or not all the agents requested for transition have been successfully transitioned. When the successful transition times in all the rows in the first transition management table are set it is meant that all the agents have been successfully transitioned. If all the agents have been successfully transitioned the processing proceeds to step S whereas if there are some agents of which transition is not successful the processing ends.

In step S the device management server determines a transition time and sets the transition time to the transition time in the first transition management table . The transition time can be determined depending on the transition time acquisition interval upon the transition processing by the agent . For example if the agent acquires a transition time once per day the transition time can be set to one day after the day of the current time at the shortest.

A description will be given of the transition processing executed by the agent control unit of the agent in step S shown in with reference to . Firstly in step S the agent control unit requests a transition time from the device management server . The device management server acquires a transition time for the agent targeted for transition from the transition time in the first transition management table and then transmits the transition time back to the agent . When a transition request is made for a plurality of agents the transition time is set if a successful transition notification has been sent from all the agents whereas the transition time is not set if a successful transition notification has not been sent from at least one of the agents .

The agent judges in step S whether or not the transition time has been acquired. If the transition time has been acquired the processing proceeds to step S whereas if the transition time could not be acquired the processing proceeds to step S again after a predetermined interval to acquire the transition time.

Next if the transition time is acquired the agent judges in step S whether or not the current time exceeds the transition time. If the current time does not exceed the transition time judgment is made again in step S after waiting for a predetermined time. If the current time exceeds the transition time in step S the transmission destination to which device information job history and the like are transmitted is switched to the transition destination customer. Here the belonging customer ID stored in the authentication key transition information storage unit is replaced with the customer ID stored in the transition destination customer ID and the authentication key is replaced with the authentication key stored in the post transition authentication key . Furthermore the agent deletes data such as the transition destination customer ID the transition key B the post transition authentication key and the transition date and time . The processing enables the connection destination to which the agent is connected to be switched to the transition destination customer. In the flow the connection destination is switched to the transition destination customer when the current time exceeds the transition time and then old authentication information is deleted. However in order to ensure successful transition after the connection destination is switched to the transition destination customer the agent may also attempt communication with the device management server using a new authentication key so as to judge whether or not communication is possible.

As described above the network system of the present invention can realize safe transition between agent s customers only when the user specifies the transition destination to the device management server without operating the device management agent which is in a customer s network environment.

In the first embodiment the device management server generates a transition key A and a transition key B at an occurrence of transition request step S and transmits the transition key A and the transition key B to the transition destination customer and the agent targeted for transition. In the second embodiment the authentication key for the agent targeted for transition is used as the transition key A and the transition key B. The device management server transmits the authentication key for the agent targeted for transition as the transition key A to the transition destination customer steps S and S and then stores the authentication key in the transition key A in the agent acceptance management table step S .

Since the agent targeted for transition holds the authentication key there is no need to transmit the transition key B to the transition destination customer but the transition key B may also be transmitted thereto step S . Upon encryption of the transition request message in step S of the transition request processing the agent uses the authentication key instead of the transition key B. Upon decryption of the transition acceptance message in step S the agent uses the authentication key for verification. The authentication key for the agent targeted for transition stored instead of the transition key A is used in steps S and S of the transition request acceptance processing for the transition destination customer by the agent management unit of the device management server .

Embodiments of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions recorded on a storage medium e.g. non transitory computer readable storage medium to perform the functions of one or more of the above described embodiment s of the present invention and by a method performed by the computer of the system or apparatus by for example reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above described embodiment s . The computer may comprise one or more of a central processing unit CPU micro processing unit MPU or other circuitry and may include a network of separate computers or separate computer processors. The computer executable instructions may be provided to the computer for example from a network or the storage medium. The storage medium may include for example one or more of a hard disk a random access memory RAM a read only memory ROM a storage of distributed computing systems an optical disk such as a compact disc CD digital versatile disc DVD or Blu ray Disc BD a flash memory device a memory card and the like.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2013 202264 filed on Sep. 27 2013 which is hereby incorporated by reference herein in its entirety.

