---

title: Capacity forecasting for a deduplicating storage system
abstract: A system for managing a storage system comprises a processor and a memory. The processor is configured to receive storage system information from a deduplicating storage system. The processor is further configured to determine a capacity forecast based at least in part on the storage system information. The processor is further configured to provide a compression forecast. The memory is coupled to the processor and configured to provide the processor with instructions.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09558200&OS=09558200&RS=09558200
owner: EMC IP Holding Company LLC
number: 09558200
owner_city: Hopkinton
owner_country: US
publication_date: 20140501
---
This application is a continuation of co pending U.S. patent application Ser. No. 13 174 504 entitled CAPACITY FORECASTING FOR A DEDUPLICATING STORAGE SYSTEM filed Jun. 30 2011 which is incorporated herein by reference for all purposes.

Organizations are generating and accumulating increasingly large amounts of electronic data that needs to be properly retained and promptly accessible when needed. Given the large volume of data involved and the extended retention period for much of this data it is critical that a storage system have adequate storage capacity. One way of having adequate storage capacity is to use an efficient storage system such as a deduplicating storage system. However even with a deduplicating system it is possible to run out of storage space. If storage space is filled up in an unplanned manner users are not able to store any new data and the system will not be able to fulfill the user s needs.

The invention can be implemented in numerous ways including as a process an apparatus a system a composition of matter a computer program product embodied on a computer readable storage medium and or a processor such as a processor configured to execute instructions stored on and or provided by a memory coupled to the processor. In this specification these implementations or any other form that the invention may take may be referred to as techniques. In general the order of the steps of disclosed processes may be altered within the scope of the invention. Unless stated otherwise a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. As used herein the term processor refers to one or more devices circuits and or processing cores configured to process data such as computer program instructions.

A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention. The invention is described in connection with such embodiments but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives modifications and equivalents. Numerous specific details are set forth in the following description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.

Capacity forecasting for a deduplicating storage system is disclosed. A system for managing a storage system comprises a processor and a memory. The processor is configured to receive storage system information of a deduplicating storage system to determine a capacity forecast based at least in part on the storage system information and to provide a capacity forecast. In various embodiments the storage information comprises one or more of the following total capacity amount of capacity used date information and any other appropriate storage information or performance parameter. The memory is coupled to the processor and configured to provide the processor with instructions.

In some embodiments a management tool is able to determine likely failure points of the system by predicting capacity or compression factors. This prediction can be used to make sure that the system will not fail because action can be taken before failure to prevent the failure. For example more storage units can be added to the system or the existing storage units of the system can be purged of older or less desired files or files can be migrated to other tiers of a storage hierarchy e.g. tape off site storage off line storage etc. .

In some embodiments a storage system is able to be cost effectively and energy efficiently used to store files. To efficiently store the files the file or any input data stream is broken into segments. For example a hash function is used to determine a segment boundary by evaluating that hash function over a window of data in the file and looking for a location associated with a minimum or maximum value that will make a segment with a length longer than a minimum length but shorter than a maximum length. Or for another example a fixed length is used to break up the file into segments. The files are stored as one or more segments where the segments are deduplicated e.g. the system targets having only one copy stored and this one copy is can be used to reconstruct more than one file that each have the segment as part of their original content in the storage system e.g. deduplicated across one storage unit of the system .

In some embodiments segments are stored in a main storage unit and periodically e.g. every week are transferred to a second storage unit. The transfer is based on a transfer protocol e.g. storage unit is above a capacity limit a number of segments every hour when inactive etc. on when the storage unit is full or on when the system meets one or more conditions e.g. is 80 full is less than 20 active has had no accesses in last hour etc. . In some embodiments the transfer comprises copying and storing segments belonging to files identified based on a migration policy e.g. files of a certain file type that have not been modified or accessed for a predetermined period of time are to be migrated etc. on a second storage unit from a primary system. As the second storage unit is filled e.g. the segments are transferred over metadata is transferred to the second storage unit so that the second storage unit has all the necessary information to access files based solely on information stored in the second storage unit. The metadata enables the system to reconstruct files that are stored in the system e.g. in the whole system in a storage unit etc. and or associated files that are stored in the system with their file names. This also allows the system to power down a storage unit for energy conservation or to take a storage unit off line to upgrade a storage unit or to enable the system to be fault tolerant in that the system can operate if any given storage unit fails. When a storage unit fills the system transfers segments from the main storage unit to another storage unit.

In some embodiments the system can be expanded by adding storage units incrementally. Files are accessed using the single name space providing an easy to use interface. Hardware is efficiently used as only one deduplicating engine is used for multiple storage units.

In some embodiments the system does not have a main storage unit and stores segments in a first storage unit and then when the first storage unit is full the system stores segments in a second storage unit.

In some embodiments a file is identified by a name that is independent of the storage unit the file is stored in. When a file is received to be stored a name is also received to be associated with the file. When a request to read a file is received a name is also received. The system looks up the metadata associated with the files in the system to identify the file associated with the received name. It then looks up the metadata associated with the identified file to determine the storage unit the identified file is stored in. In various embodiments the metadata associated with the files in the system is maintained in a main storage unit is maintained in each storage unit where the files associated with the metadata are stored is maintained in a distributed and or redundant manner across many storage units e.g. for fault tolerance is maintained in a separated storage unit or storage unit or any other appropriate storage location.

In some embodiments when a next available storage unit is identified e.g. selected as the active storage unit the metadata associated with the files in the system is copied to the active storage unit. This allows the metadata associated with the files in the system to be available when only the storage unit is powered up. In some embodiments subsequent updates to the metadata associated with the files are made only to the copy of the metadata stored in the active storage unit.

In some embodiments if the active storage unit is full all metadata updates are flushed to the active storage unit so that each storage unit contains at least enough metadata to provide access to the files it contains. When the active storage unit fails the system uses the metadata contained in other attached storage units e.g. a previously active storage unit to provide access to the files still in the system. In some embodiments when a storage unit is unavailable e.g. the storage unit has failed is being upgraded etc. the system remains up to provide access to any file not stored in the failed storage unit.

In some embodiments the system includes a power management unit. In the event that a storage unit is predicted to be idle for some time the system powers down the storage unit. The system is still able to access files on any other storage unit that is not powered down. Subsequently when the system receives a request directed at the storage unit the system powers up the storage unit. Powering down a storage unit may include powering off some of the electronics in the disks in the storage unit spinning down the disks powering down the disks and or powering down the electronics in the storage unit or any other appropriate power saving step. The power down action may depend on how long the storage unit is predicted to be idle. In some embodiments the length of time a storage unit is predicted to be idle is based on how long the storage unit has been idle. For example if a storage unit has not received any request for a predetermined period of time the disks in the storage unit are spun down. In the event that the storage unit has not received any request for a further predetermined period of time the disks in the storage unit are powered off. In some embodiments the system tracks the number of times a disk has been power cycled and uses the power cycling information to determine the appropriate power down action. For example when the number of power cycles exceeds a predetermined threshold the system may decide not to power down the disk any more.

In some embodiments in the event that a file is deleted the metadata associated with the files in the system is updated to reflect that the file is deleted. Subsequently a space reclamation process is performed to compact the remaining files to fill up entire storage units by transferring files that have not been deleted from a storage unit e.g. a container drive array of drives etc. to a new storage unit and deduplicating segments stored in the new storage unit. Once files have been transferred from the old storage unit the storage unit can be made available to store new files.

In some embodiments the system comprises a backup storage system. In some embodiments the system is a deduplicating storage system e.g. a storage system such as the Data Domain product of EMC Corporation of Hopkinton Mass. . Each storage unit is a deduplication domain meaning that duplicate chunks of data e.g. segments are identified only within each storage unit and not across different storage units. Each storage unit contains a segment index that can be used to determine whether a segment already exists in the storage unit. In some embodiments the segment index uses fingerprints to index segments.

In some embodiments the system described is used as a tier of storage in a storage hierarchy that comprises other tiers of storage. One or more tiers of storage in this hierarchy may utilize different kinds of storage devices and or may be optimized for different characteristics such as random update performance. Files are periodically moved among the tiers based on data management policies to achieve a cost effective match to the current storage requirements of the files. For example a file may initially be stored in a tier of storage that offers high performance for reads and writes. As the file ages it may be moved into a tier of storage according to this invention. In various embodiments tiers comprise different storage technologies e.g. tape hard drives semiconductor based memories optical drives etc. different locations e.g. local computer storage local network storage remote network storage distributed storage cloud storage archive storage vault storage etc. or any other appropriate storage for a tiered data storage system.

In some embodiments the storage system follows a retention policy where files of different ages are retained or not retained e.g. files older than 7 years are removed . In some embodiments the retention policy is dependent on type of file e.g. financial information is retained indefinitely email is retained for 1 year tax information is retained 7 years etc. .

In some embodiments diagnostic data comprises total storage capacity total storage capacity used precompression size cumulative compressed size metadata size index size associated date and or time stamp of the diagnostic data or any other appropriate diagnostic data. In some embodiments precompression size comprises a size of storage capacity of a deduplicating storage system prior to compression performed by the deduplicating storage system. In some embodiments cumulative compressed size comprises physical used space of a deduplicating storage system. In some embodiments metadata size comprises total size of metadata stored in a deduplicating storage system. In some embodiments index size comprises total size of indices stored in a deduplicating storage system. In various embodiments total storage capacity total storage capacity used precompression size cumulative compressed size metadata size and or index size are measured in gigabytes or any other appropriate unit.

In some embodiments a storage unit stores performance data associated with a deduplicating storage system. In various embodiments performance data comprises diagnostic data associated with a deduplicating storage system statistical measures capacity forecasting data or any other appropriate performance data. In various embodiments performance data comprises a capacity threshold date total storage capacity total storage capacity used percentage of total storage capacity used space usage rate per day a date a most recent diagnostic data summary was received a date a most recent Autosupport was received a hostname associated with a deduplicating storage system compression factor a version of operating system software operating on a deduplicating storage system or any other appropriate performance data. In some embodiments an Autosupport comprises a summary of diagnostic data associated with a deduplicating storage system. In various embodiments a summary of diagnostic data associated with a deduplicating storage system is received by a local client deduplicating storage management system remote server deduplicating storage management system or any appropriate deduplicating storage management system. In various embodiments a storage unit comprises a storage device multiple storage devices a portion of a storage device a hard drive an array of drives a semiconductor memory or any other appropriate storage unit.

In some embodiments a statistical modeler determines statistical modeling. In some embodiments statistical modeling comprises determining statistical measures of a set of data associated with a deduplicating storage system. In some embodiments a set of data associated with a deduplicating storage system is received from a storage unit. In some embodiments the set of data is historical data associated with the deduplicating storage system. In some embodiments the set of data is observed data associated with the deduplicating storage system. In various embodiments statistical measures comprise a standard deviation an average or any other appropriate statistical measures. For example determining a 14 day average of total storage capacity used comprises selecting a set of 14 dates. 14 total storage capacity used data points are selected from a storage unit where each of the total storage capacity used data points corresponds to the total storage capacity used on one of the selected 14 dates. The 14 data points are averaged to determine a 14 day average of total storage capacity used. In some embodiments determined statistical measures are stored to a storage unit. For example the standard deviation of a total storage capacity used data point with respect to a determined mean and or estimate of total storage capacity used is stored to a storage unit. In another example the number of standard deviations an n day average of total storage capacity used is away from a m day average of total storage capacity used where n and m are different numbers is determined. The number of standard deviations indicates a divergence of recent behavior from historical behavior.

In some embodiments a capacity forecaster determines capacity forecasting. In some embodiments capacity forecasting comprises predicting total storage capacity used by a deduplicating storage system at a specified date and or time. In some embodiments capacity forecasting comprises determining a forecasted capacity threshold date. For example a forecasted capacity threshold date or some other appropriate criteria comprises a forecasted date on which a threshold amount of total storage capacity of a deduplicating storage system will be used. In some embodiments a capacity threshold comprises a threshold amount of total storage capacity used. In some embodiments a capacity threshold comprises a threshold percentage of total storage capacity used. In some embodiments the threshold amount is the full storage capacity of a deduplicating storage system. In some embodiments capacity forecasting comprises regression analysis. In various embodiments regression analysis comprises linear regression analysis logistic regression analysis ensemble regression analysis or any other appropriate form and or type of analysis. In some embodiments regression analysis comprises fitting a predictive model to an observed data set of input and output values. In some embodiments an observed data set of values is received from a storage unit. In some embodiments an observed data set comprises data based at least in part on data received from a deduplicating storage system. In some embodiments an observed data set comprises a subset of all observed historical data stored in a storage unit. In various embodiments total storage capacity used is received or total storage capacity used is calculated or any other appropriate manner of obtaining total storage capacity used. In some embodiments fitting a predictive model to an observed data set of input and output values comprises determining a function relating a set of input variables and an output variable associated with the observed input and output values. In some embodiments determining a function comprises determining parameters of the function. In various embodiments an input variable comprises a date and an output variable comprises total storage capacity used. In some embodiments a date comprises a number of time steps away from a first date. For example a date is represented by a number of days a number of months a number of years or any other appropriate number of time steps away from a first date. In various embodiments an observed data set of input values comprises a data set of observed dates and an observed data set of output values comprises a data set of observed total storage capacity used on each of the observed dates. In some embodiments a fitted predictive model is used to predict and or estimate total storage capacity used on a specified date where the specified date is an input to the fitted predictive model and the total storage capacity used is an output of the fitted predictive model. In some embodiments an inverse of the fitted predictive model is used to determine a date on which an inputted total storage capacity used will be reached.

In some embodiments linear regression analysis comprises fitting a linear predictive model to an observed data set of input and output values. For example a linear predictive model is fitted to an observed data set of selected dates and total storage capacity used on each of the selected dates. The dates and total storage capacity used on each of the selected dates comprise data selected from a storage unit. Observed input values comprise the selected dates. Observed output values comprise the total storage capacity used on each of the selected dates. In some embodiments a linear function relating dates and total storage capacity used is determined based at least in part on the observed data set of selected dates and total storage capacity used on each of the selected dates. For example piece wise linear regression is determined for a set of recent data. In some embodiments a plurality of linear regressions are fitted to a set of data. The linear regression with the best fit e.g. having the lowest error or the greatest R squared value is chosen for forecasting. For example a linear function such as that shown in equation 1 is determined. In some embodiments parameters associated with the linear function are determined. In some embodiments a parameter associated with the linear function comprises a slope of the linear function an intercept point or any other appropriate parameter. total storage capacity used date 1 For example in equation 1 parameter corresponds to an intercept point corresponds to a slope and corresponds to an error term.

A forecasted total storage capacity used on a selected input date is predicted based at least in part on the determined linear function or for example fitted predicted model . In some embodiments a forecasted total storage capacity threshold used date is predicted based at least in part on a linear function where the linear function determines an output total storage capacity used based at least in part on an input date. In some embodiments an inverse function of the linear function is used to determine the forecasted total storage capacity used threshold date. For example a threshold total storage capacity used of a deduplicating storage system is inputted to the inverse linear function and a storage capacity threshold date is outputted. For example equation 2 is an inverse function of linear function equation 1 .

In some embodiments logistic regression analysis comprises fitting a logistic predictive model to a set of data. In some embodiments ensemble regression analysis comprises fitting a plurality of predictive models to a plurality of subsets of a set of data. For example a set of data comprising total storage capacity used on a plurality of days is grouped by day of the week. For example a subset of data corresponding to total storage capacity used on Mondays is determined. A subset of data corresponding to total storage capacity used on Tuesdays is further determined. A first predictive model is fitted to the subset of data corresponding to Mondays. A second predictive model is fitted to the subset of data corresponding to Tuesdays. In some embodiments data determined using capacity forecasting is stored to a storage unit. In various embodiments data determined using capacity forecasting comprise a capacity threshold date a plurality of projected total storage capacity used corresponding to a plurality of dates or any other appropriate data determined using capacity forecasting. In some embodiments a fitted predictive model is stored to a storage unit.

In some embodiments an interface receives capacity forecast generation criteria. In some embodiments a capacity forecaster comprises default capacity forecast generation criteria. In various embodiments generation criteria comprise a plurality of threshold values. For example capacity forecasting is not determined in the event that insufficient historical and or observed data is available. For example if less than 10 data points are available capacity forecasting is not determined. In some embodiments capacity forecasting is not determined in the event that deduplicating storage system capacity usage is below a specified percentage. For example if a deduplicating storage system is less than 10 percent full e.g. a threshold for not forecasting or predicting full date a capacity forecast is not determined. Or for another example a capacity forecast is determined in the event that a storage system capacity is above a threshold for determining a forecast e.g. if the system is 80 full then a capacity forecast is determined and the predicted full date is determined .

In some embodiments an interface receives capacity forecast model validation criteria from a user. In some embodiments a capacity forecaster comprises default capacity forecast model validation criteria. In some embodiments capacity forecast model validation criteria comprise criteria for validating a capacity forecast model. In some embodiments a capacity forecast model comprises a determined fitted predictive model for regression analysis for capacity forecasting. In various embodiments validation criteria comprise a plurality of threshold values. Validity of the fitted predictive model is determined based at least in part on whether values associated with the fitted predictive model exceed or do not exceed the plurality of threshold values. In various embodiments capacity forecast model validation criteria comprise a threshold R squared value a threshold number of data points in a set of data a threshold number of standard deviations of data points from a mean and or expected value of a set of data points or any other appropriate capacity forecast model validation criteria. For example in the event that linear regression analysis is determined capacity forecast model validation criteria comprise criteria determining whether the fitted linear predictive model comprises a positive slope. In some embodiments an R squared value comprises a measure of goodness of fit of a predictive model to a set of observed data.

In some embodiments statistical modeling and or capacity forecasting are determined on a scheduled basis e.g. daily weekly monthly etc. .

In some embodiments a diagnostic data storage engine receives a summary of diagnostic data associated with a deduplicating storage system. In some embodiments the summary is provided by a deduplicating storage system via a phone home system. In some embodiments the phone home system comprises a system for transmitting a summary of diagnostic data from a deduplicating storage system to a deduplicating storage management system. In some embodiments a diagnostic data storage engine receives an Autosupport. In some embodiments a summary of diagnostic data associated with a deduplicating storage system comprises a summary based at least in part on a simple network management protocol SNMP . In some embodiments a summary based at least in part on SNMP is configured to provide data associated with a deduplicating storage system using a custom application programming interface API . In some embodiments a summary of diagnostic data for a deduplicating storage system based at least in part on SNMP comprises CPU information system load network bandwidth or any other appropriate diagnostic data. In some embodiments the summary comprises an Autosupport. In some embodiments a parser parses a summary diagnostic data. In some embodiments parsing a summary of diagnostic data comprises extracting diagnostic data from the summary of diagnostic data.

In some embodiments a notification is generated using a notification generator. In some embodiments a notification is provided to a client user server user web user or any other appropriate user associated with a deduplicating storage system.

In some embodiments an interface receives notification inclusion exclusion critera. In some embodiments a notification generator comprises default notification inclusion exclusion criteria. In some embodiments notification inclusion exclusion criteria comprise criteria for including excluding a deduplicating storage system from a notification. In various embodiments inclusion criteria comprise a plurality of threshold values. In various embodiments inclusion criteria are based at least in part on diagnostic data statistical data performance data or any other appropriate data. In various embodiments inclusion criteria comprise a request for inclusion of a deduplicating system by a client user server user web user or any other appropriate user. For example a user may want to be notified of an existing state or predicted threshold date regardless of whether a threshold is reached within a short time. In some embodiments inclusion is determined based at least in part on whether values associated with a deduplicating storage system exceed or do not exceed the plurality of threshold values. In some embodiments inclusion criteria comprise a number of days determined as the number of days between a current date and a forecasted capacity threshold date. For example if a deduplicating storage system is forecasted to reach a threshold storage capacity within 60 days of the current date an inclusion criteria has been met. In some embodiments inclusion criteria comprise a threshold number of standard deviations. In some embodiments in the event that an observed total capacity storage used data point is greater than a determined average and or estimated total capacity storage used by the threshold number of standard deviations an inclusion criteria has been met.

In various embodiments exclusion criteria comprise a plurality of threshold values. In some embodiments exclusion criteria comprise a request for exclusion of a deduplicating system by a client user server user web user or any other appropriate user. In some embodiments exclusion of a deduplicating storage system from a notification is determined based at least in part on whether values associated with a deduplicating storage system exceed or do not exceed the plurality of threshold values. In various embodiments inclusion criteria are based at least in part on diagnostic data statistical data performance data or any other appropriate data. In various embodiments exclusion criteria comprise a number of days in which total storage capacity used has not changed a number of days in which an autosupport has not been received a percentage decrease in the percentage of total storage capacity used a number of standard deviations of a total storage capacity used data point away from a determined total storage capacity used average across a specified number of days.

In some embodiments a deduplicating storage system is included in a notification in the event that at least one inclusion criteria are met and not one of the exclusion criteria is met. In some embodiments a deduplicating storage system is excluded from a notification in the event that at least one exclusion criteria is met. In some embodiments a notification comprises a list of one more than one or zero deduplicating storage systems. In some embodiments a notification comprises a list of a plurality of deduplicating storage systems associated with a client user server user and or web user. In some embodiments the list of deduplicating storage systems comprises a ranked list. For example a list of deduplicating storage systems is ranked by earliest forecasted capacity threshold date.

In some embodiments notification is provided based at least in part on data stored in a storage unit. In some embodiments a notification engine provides notification based at least in part on notification inclusion exclusion criteria. In some embodiments notification is provided to a client user server user web user or any other appropriate user.

In some embodiments reporting is generated using a reporting generator. In some embodiments reporting is provided based at least in part on a request from a client user server user and or web user associated with a deduplicating storage system. In various embodiments reporting comprises a graph a report or any appropriate reporting. In some embodiments reporting comprises data associated with one or more deduplicating storage systems. In some embodiments data for reporting is received from a deduplicating storage system a storage unit of a client deduplicating storage management system and or a storage unit of a server deduplicating storage management. In some embodiments a report comprises a summary of performance metrics.

In some embodiments an interface receives an indication to provide reporting. In the event that an indication to provide reporting is received reporting is generated and provided. In some embodiments a reporting generator provides reporting automatically e.g. daily weekly monthly etc. . In some embodiments an interface receives reporting preferences. In some embodiments reporting preferences are provided by a client user server user web user or any other appropriate user or a client system a server system a web system or any other appropriate system e.g. an automated providing of a preference or a providing of a default preference or a providing of a preference generated by a system using an automated engine . In some embodiments a reporting generator comprises default reporting preferences. In some embodiments report preferences comprise preferences for generating reporting. In some embodiments reporting preferences comprise a set of deduplicating storage systems to be included in reporting. In some embodiments reporting comprises reporting information associated with a set of deduplicating storage systems specified in reporting preferences. In some embodiments reporting comprises reporting aggregate information. In some embodiments information is aggregated across a set of storage systems specified by reporting preferences. In various embodiments aggregate information comprises information aggregrated across a set of deduplicating storage systems associated with an industry. In some embodiments information for reporting comprises aggregate information across a specified subset of client deduplicating storage systems where the specified subset of client deduplicating storage system comprises a site or any other appropriate subset of deduplicating storage systems. In some embodiments information for report is aggregated across deduplicating storage systems associated with a server and or client deduplicating storage management system.

In some embodiments reporting is provided based at least in part on data stored in a storage unit. In some embodiments reporting is provided based at least in part on reporting preferences. In some embodiments reporting is provided to a client user server user web user or any other appropriate user.

Although the foregoing embodiments have been described in some detail for purposes of clarity of understanding the invention is not limited to the details provided. There are many alternative ways of implementing the invention. The disclosed embodiments are illustrative and not restrictive.

