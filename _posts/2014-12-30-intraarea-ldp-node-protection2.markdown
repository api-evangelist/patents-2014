---

title: Intra-area LDP node protection
abstract: Techniques are described for providing fast reroute intra-area node protection for label switched paths (LSPs) using label distribution protocol (LDP). In one example, a network device may be configured to use network topology information, obtained by an Interior Gateway Protocol (IGP) executing on the network device, to identify a next next hop merge point to which to automatically establish a bypass LSP, and to which to establish a targeted LDP session for obtaining a label advertised by the next next hop merge point.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09590844&OS=09590844&RS=09590844
owner: Juniper Networks, Inc.
number: 09590844
owner_city: Sunnyvale
owner_country: US
publication_date: 20141230
---
The disclosure relates to packet based computer networks and more particularly to forwarding packets within computer networks.

Routing devices within a network often referred to as routers maintain routing information that describe available routes through the network. Upon receiving an incoming packet the routers examine information within the packet and forward the packet in accordance with the routing information. In order to maintain an accurate representation of the network routers exchange routing information in accordance with one or more defined routing protocols such as a link state protocol Interior Gateway Protocol IGP .

The connection between two devices on a network is generally referred to as a link. A link state protocol as one type of IGP allows routers to exchange and accumulate information describing the various links within the network. With a typical link state routing protocol the routers exchange information related to available interfaces metrics and other variables associated with network links. This allows a router to construct its own topology or map of the network. Some examples of link state protocols include the Open Shortest Path First OSPF protocol and the Intermediate System to Intermediate System IS IS protocol.

Upon failure of a link or failure of a node interfacing with the link routers in the network transmit new connectivity information to neighboring devices allowing each device to update its local routing table. When a link or node in the network fails routers using traditional link state protocols may take a long time to adapt their forwarding tables in response to the topological change resulting from link and node failures in the network. The process of adapting the forwarding tables is known as convergence. This time delay occurs because recovery from a failure requires each router to re compute the shortest path algorithm to calculate the next hop for the affected routers in the network. Until the next hops are re computed traffic being sent toward the failed link or node may be dropped.

In general this disclosure describes techniques for providing fast reroute intra area node protection for label switched paths LSPs using label distribution protocol LDP . This disclosure also describes techniques for providing inter area node protection for LSPs using LDP. In one example a point of local repair PLR network device may be configured to use network topology information obtained by an IGP executing on the network device to identify a next next hop merge point to which to automatically establish a bypass LSP and to which to establish a targeted LDP session for obtaining a label advertised by the next next hop merge point. This can allow the PLR network device to provide intra area node protection. In another example the PLR network device may be configured such that when the PLR determines that a protected node is an area border router the PLR network device is configured to use network topology information obtained by the IGP executing on the network device to identify a second area border router in the same IGP area as the protected node to which to automatically establish a bypass LSP and a targeted LDP session. This can allow the PLR network device to provide inter area node protection.

The techniques of this disclosure may provide one or more advantages. For example the techniques of this disclosure allow network devices to provide node protection using LDP in most network topologies including in network topologies in which LDP node protection would not otherwise be available. The techniques of this disclosure enable node protection to be used for fast reroute of LSP traffic until a convergence process completes for a new path through the network. The techniques may therefore reduce packet loss that might otherwise occur while a routing protocol on the routers from the PLR network device to an egress router of the LSP converge on a new path in the new network topology. The techniques can be used by network devices without requiring extensions to LDP.

In one example a method includes by a network device identifying based on network topology information obtained by an interior gateway protocol IGP executed by the network device a potential next next hop merge point network device that is i in an IGP area in which the PLR network device is positioned and ii along a path that avoids a given protected node within the IGP area by the network device automatically establishing a bypass label switched path LSP to the potential next next hop merge point network device wherein the bypass LSP follows a path that avoids the protected node and by the network device automatically establishing a targeted label distribution protocol LDP session to the potential next next hop merge point network device. The method also includes by the network device obtaining a label mapping from the potential next next hop merge point network device using the targeted LDP session and by the network device programming forwarding information to include a backup path to the potential next next hop merge point network device with a label stack having an inner label from the obtained label mapping for the potential next next hop merge point network device and an outer label for the bypass LSP to the potential next next hop merge point network device.

In another example aspect a network device includes a hardware based processor an interior gateway protocol IGP executing on the hardware based processor wherein the IGP is configured to obtain network topology information and a Resource Reservation Protocol with Traffic Engineering extensions RSVP TE module executing on the hardware based processor wherein the RSVP TE module is configured to identify based on the network topology information a potential next next hop merge point network device that is i in an IGP area in which the PLR network device is positioned and ii along a path that avoids a given protected node within the IGP area. The RSVP TE module is configured to automatically establish a bypass label switched path LSP to the potential next next hop merge point network device wherein the bypass LSP follows a path that avoids the protected node. The network device also includes a label distribution protocol LDP module executing on the hardware based processor wherein the LDP module is configured to automatically establish a targeted label distribution protocol LDP session to the potential next next hop merge point network device obtain a label mapping from the potential next next hop merge point network device using the targeted LDP session and program forwarding information to include a backup path to the potential next next hop merge point network device with a label stack having an inner label from the obtained label mapping for the potential next next hop merge point network device and an outer label for the bypass LSP to the potential next next hop merge point network device.

In a further example aspect a computer readable storage medium includes instructions for causing a programmable processor of a network device to identify based on network topology information obtained by an interior gateway protocol IGP executed by the network device a potential next next hop merge point network device that is i in an IGP area in which the PLR network device is positioned and ii along a path that avoids a given protected node within the IGP area automatically establish a bypass label switched path LSP to the potential next next hop merge point network device wherein the bypass LSP follows a path that avoids the protected node automatically establish a targeted label distribution protocol LDP session to the potential next next hop merge point network device obtain a label mapping from the potential next next hop merge point network device using the targeted LDP session and program forwarding information to include a backup path to the potential next next hop merge point network device with a label stack having an inner label from the obtained label mapping for the potential next next hop merge point network device and an outer label for the bypass LSP to the potential next next hop merge point network device.

In another example a method includes by a network device determining based on network topology information obtained by an interior gateway protocol IGP executed by the network device that a protected node along a primary LSP is a first area border router wherein the protected node is in an IGP area in which the network device is positioned and in response to determining that the protected node is a first area border router by the network device identifying a second area border router in the IGP area in which the network device and the protected node are positioned. The method also includes by the network device automatically establishing a bypass label switched path LSP to the second area border router wherein the bypass LSP follows a path that avoids the protected node by the network device automatically establishing a targeted label distribution protocol LDP session to the second area border router by the network device obtaining a label mapping from the second area border router using the targeted LDP session and by the network device programming stored forwarding information to include a backup path to the second area border router with a label stack having an inner label from the obtained label mapping for the second area border router and an outer label for the bypass LSP to the second area border router.

In another example aspect a network device includes a hardware based processor an interior gateway protocol IGP module executing on the hardware based processor wherein the IGP module is configured to obtain network topology information and a Resource Reservation Protocol with Traffic Engineering extensions RSVP TE module executing on the hardware based processor wherein the RSVP TE module is configured to determine based on the network topology information that a protected node along a primary LSP is a first area border router wherein the protected node is in an IGP area in which the network device is positioned and in response to determining that the protected node is a first area border router identify a second area border router in the IGP area in which the network device and the protected node are positioned. The RSVP TE module is configured to automatically establish a bypass label switched path LSP to the second area border router wherein the bypass LSP follows a path that avoids the protected node. The network device also includes a label distribution protocol LDP module executing on the hardware based processor wherein the LDP module is configured to automatically establish a targeted label distribution protocol LDP session to the second area border router obtain a label mapping from the second area border router using the targeted LDP session and program stored forwarding information to include a backup path to the second area border router with a label stack having an inner label from the obtained label mapping for the second area border router and an outer label for the bypass LSP to the second area border router.

In a further example aspect a computer readable storage medium includes instructions for causing a programmable processor of a network device to determine based on network topology information obtained by an interior gateway protocol IGP executed by the network device that a protected node along a primary LSP is a first area border router wherein the protected node is in an IGP area in which the network device is positioned in response to determining that the protected node is a first area border router identify a second area border router in the IGP area in which the network device and the protected node are positioned automatically establish a bypass label switched path LSP to the second area border router wherein the bypass LSP follows a path that avoids the protected node automatically establish a targeted label distribution protocol LDP session to the second area border router obtain a label mapping from the second area border router using the targeted LDP session and program stored forwarding information to include a backup path to the second area border router with a label stack having an inner label from the obtained label mapping for the second area border router and an outer label for the bypass LSP to the second area border router.

The details of one or more examples are set forth in the accompanying drawings and the description below. Other features objects and advantages will be apparent from the description and drawings and from the claims.

Each of routers in area executes at least one Interior Gateway Protocol to exchange routing information within the IGP area . Interior Gateway Protocols include for example link state routing protocols such as Open Shortest Path First OSPF or Intermediate System to Intermediate System IS IS and distance vector routing protocols such as Routing Information Protocol RIP or Interior Gateway Routing Protocol IGRP . The IGP area s in which each of routers resides may be specified as a field in route tables maintained by each of routers . Some routers may reside within two IGP areas these routers are called area border routers ABRs . In the example of routers D E or F could be ABRs although for simplicity no areas besides area are shown in .

In some examples network may be a service provider network. For example network may represent one or more networks owned and operated by a service provider which is commonly a private entity that offer one or more services for consumption by subscriber networks. In this context network is typically a layer three L3 packet switched network that provides L3 connectivity between a public network and one or more subscriber networks not shown . Often this L3 connectivity provided by a service provider network is marketed as a data service or Internet service and subscribers may subscribe to this data service. Network may represent a L3 packet switched network that provides data voice television and any other type of service for purchase by subscribers and subsequent consumption by subscriber networks.

Each of routers represents a network device that routes or otherwise forwards traffic through network . Typically routers represent a L3 packet switching device that operates at L3 to exchange routing information using a routing protocol such as an Interior Gateway Protocol IGP describing a current topology of network . Routers may locally store network topology information in a link state database and or traffic engineering database TED . Routers then process this routing information selecting paths through its representation of the topology of network to reach all available destinations to generate forwarding information. In other words routers reduce these paths to so called next hops which identify interfaces to which to forward traffic destined for a particular destination where the forwarding information includes this list of next hops. Routers then install the forwarding information in a forwarding plane of the router and the forwarding plane forwards received traffic in accordance with the forwarding information.

Multi protocol Label Switching MPLS is a mechanism used to engineer traffic patterns within Internet Protocol IP networks. By using MPLS a source device can request a path through a network i.e. a Label Switched Path LSP . An LSP defines a distinct path through the network to carry MPLS packets from the source device to a destination device. A short label associated with a particular LSP is affixed to packets that travel through the network via the LSP. Routers along the path cooperatively perform MPLS operations to forward the MPLS packets along the established path. LSPs may be used for a variety of traffic engineering purposes including bandwidth management and quality of service QoS . A packet may be a formatted set of data.

A variety of protocols exist for establishing LSPs. For example one such protocol is the label distribution protocol LDP . Another type of protocol is a resource reservation protocol such as the Resource Reservation Protocol with Traffic Engineering extensions RSVP TE . RSVP TE uses constraint information such as bandwidth availability to compute paths and establish LSPs along the paths within a network. RSVP TE may use bandwidth availability information accumulated by a link state interior routing protocol such as the Intermediate System Intermediate System ISIS protocol or the Open Shortest Path First OSPF protocol.

Head end routers of an LSP are commonly known as ingress routers while routers at the tail end of the LSP are commonly known as egress routers. Ingress and egress routers as well as intermediate routers along the LSP that support MPLS are referred to generally as label switching routers LSRs . In the example of routers are LSRs and router D is the ingress router to LSP . Router F is the egress router to LSP . A set of packets to be forwarded along the LSP is referred to as a forwarding equivalence class FEC . In general each router along the LSP maintains a context that associates a FEC with an incoming label and an outgoing label. This association is referred to as a FEC label binding. The ingress label edge router LER uses routing information propagated from the egress LER to determine the LSP assign labels for the LSP and affix a label to each packet of the FEC.

The LSRs use MPLS protocols to receive MPLS label mappings from downstream LSRs and to advertise MPLS label mappings to upstream LSRs. Using MPLS mechanisms data packets are assigned labels to identify the FEC to which the packets belong and forwarding decisions are made for the data packets based on the labels. The labels are included in MPLS headers used to encapsulate the packets for transport along the LSP. In some examples the labels are stacked to establish segmented LSP tunnels in which multiple LSPs are nested together in order to reach an egress router of the last LSP on the label stack. When an LSR receives an MPLS packet from an upstream router the LSR performs a lookup in the context and swaps the MPLS label s according to the information in its forwarding table based on the lookup and forwards the packet to the appropriate downstream LSR or LER. The egress LER or in some cases the penultimate router on the LSP removes the label s from the packet and the egress LSR forwards the packet to its destination in accordance with non label based packet forwarding techniques.

The LSRs may use LDP to distribute labels to other routers along hop by hop paths to establish LSPs. More specifically the routers may distribute LDP label mapping messages indicating assigned labels and associated FECs for the LSPs. Two routers that use LDP to exchange label mapping information are referred to as LDP peer routers. Directly connected neighbor routers may be LDP peer routers with a direct LDP session. In the case where non neighbor routers i.e. routers that are not directly connected at the link level but which are reachable at the network level want to be LDP peer routers such as routers A and C the non neighbor routers may use the LDP extended discovery mechanism and establish a targeted LDP session as described in further detail below. More information on LDP and targeted LDP sessions is described in Anderson L. LDP Specification RFC 5036 October 2007 the entire contents of which are incorporated by reference herein. More information on MPLS is described in Rosen E. Multiprotocol Label Switching Architecture RFC 3031 January 2001 the entire contents of which are incorporated by reference herein.

When an LSP such as LSP is established LSRs along the LSP may also establish one or more bypass LSPs to provide link and or node protection for the LSP. Router A is a point of local repair PLR router along the path of LSP . In the example of PLR router A is a transit router i.e. an intermediate router along LSP and is neither an ingress router nor an egress router of LSP . In other examples PLR router A may be both the PLR and the ingress router of LSP . Router C is the merge point MP for bypass LSP . Bypass LSP is an LSP that provides node protection for protected router B between PLR router A and MP router C along LSP such that if protected router B should become unresponsive PLR router A send the network traffic received on existing LSP through the bypass LSP . Bypass LSP follows a path from PLR router A to router E to MP router C avoiding the protected resource in this case protected router B . When PLR router A detects that protected router B is unresponsive PLR router A begins forwarding network traffic received from router D on LSP on to bypass LSP . MP router C receives the network traffic on bypass LSP from router B and forwards the traffic on the path of LSP to router F. In some examples PLR router A may have previously computed and signaled bypass LSP as a backup path for protected router B using the Resource Reservation Protocol with Traffic Engineering extensions RSVP TE prior to detecting any failure of protected router B. Router A may establish and use bypass LSP in accordance with MPLS fast reroute techniques as described in P. Pan Fast Reroute Extensions to RSVP TE for LSP Tunnels Network Working Group RFC 4090 May 2005 the entire contents of which are incorporated by reference herein. RFC 4090 describes a facility backup method which provides link or node protection by pre calculating a bypass path for the set of LSPs traversing a link.

In some examples router A may establish bypass LSP upon receiving from ingress router D of LSP a resource reservation request message that specifies a need for node protection. For example during initial RSVP TE signaling for establishing LSP router A may receive an RSVP TE PATH request from ingress router D that includes a fast reroute object in which a node protection desired flag or other fast reroute flag is set. In general a router that receives a node protection desired flag will attempt to establish a bypass LSP. After router A establishes bypass LSP router A maintains forwarding information in a data plane of router A that allows router A to send traffic through bypass LSP if protected router B fails. Upon link failure PLR router A redirects traffic over bypass LSP from PLR router A to MP router C.

In some network topologies it may not be possible for some LSRs to provide node protection using conventional LDP. In network shown in each of links A F has an associated weight based on some metric . Links A E each have weight of 1 and link F has a weight of 10. In network PLR router A can provide link protection for LSP with respect to link A by sending traffic on the path PLR router A router E router B MP router B. However because the weight associated with link F is much higher than the other link weights in the absence of the techniques of this disclosure LSRs would select a path that goes through protected router B and would not be able send traffic on a path that avoids protected router B.

In accordance with the techniques of this disclosure PLR router A is configured to discover MP router C as a next next hop and learn a label advertised by the next next hop MP router C to use for forwarding traffic along a path that bypasses protected router B. PLR router A is locally configured to determine whether a next hop neighbor node needs node protection based on local configuration. For example one or more interfaces of PLR router A can be configured for node protection under an LDP hierarchy level. PLR router A may be configured to discover all possible next next hops NNHs of PLR router A that are in the same IGP area as PLR router A and that avoid the protected router B. These possible next next hops are potential merge points for RSVP TE LSPs that would serve as bypass LSPs to avoid protected router B. PLR router A may be configured to obtain these next next hops from a topology database e.g. its stored TED or link state database populated with topology information obtained via IGP link state advertisements LSAs exchanged by PLR router A with IGP peer routers. In the example of PLR router A identifies MP router C as a potential next next hop in IGP area on a path that avoids protected router B i.e. the path from PLR router A to router E to MP router C . In other network topologies PLR router A may discover multiple possible next next hop MPs.

PLR router A automatically establishes a bypass LSP to each of the discovered next next hops if a bypass LSP is not yet established. For example PLR router A automatically establishes RSVP TE bypass LSP to MP router C such as by sending an RSVP TE PATH message to router E via link D. Router E reserves bandwidth in accordance with the bandwidth reservation request specified in the PATH message and router E sends a resource reservation reply message e.g. a RSVP TE RESV message to PLR router A indicating that the requested bandwidth has been reserved and specifying a label e.g. L for PLR router A to use in subsequently forwarding network traffic over bypass LSP . Router E also sends a RSVP TE path message to MP router C via link F. MP router C reserves bandwidth in accordance with the bandwidth reservation request specified in the PATH message and MP router C sends a resource reservation reply message e.g. a RSVP TE RESV message to router E indicating that the requested bandwidth has been reserved and specifying a label e.g. L for router E to use in subsequently forwarding network traffic on bypass LSP .

In some examples when establishing RSVP TE bypass LSP PLR router A may take into account a Shared Risk Link Group SRLG associated with the link between itself and the protected node. Specifically when selecting a path on which to establish a bypass LSP PLR router A may select a path that avoids traversing links that share one or more SRLGs with the link between itself and the protected node e.g. link A .

PLR router A also signals a targeted LDP session to each of the identified next next hops. In some examples PLR router A may establish the bypass LSP and signal the targeted LDP session to each of the identified next next hops in parallel. In the example of PLR router A in network uses the extended discovery mechanism of LDP to establish a targeted adjacency and subsequent targeted LDP session . PLR router A may initiate extended discovery by sending a targeted Hello message to a specific address e.g. to the address of the identified next next hop MP router C to establish a targeted adjacency. PLR router A can obtain the address e.g. an IP address for MP router C from the link state database of PLR router A. After establishing the targeted adjacency PLR router A may send an LDP initialization message to MP router C along an IGP primary path to initiate establishment of targeted LDP session between PLR router A and MP router C for example. The IGP primary path may avoid the protected router for example. PLR router A then obtains an LDP label advertised by MP router C from MP router C via targeted LDP session . For example the LDP label advertised by MP router C may be label L. MP router C automatically provides PLR router A with the label mapping after establishment of targeted LDP session . PLR router A stores the label information received from MP router C to its FIB.

Responsive to detecting a failed resource between PLR router A and MP router C e.g. failure of protected router B in the example of PLR router A may perform a soft reroute action to reroute the traffic from LSP onto the previously established bypass LSP . For example PLR router A may update its stored forwarding state to change the primary next hops for LSP such as by setting a next hop for bypass LSP as the primary next hop for traffic received for LSP . PLR router A can subsequently send traffic received on LSP onto bypass LSP and in accordance with its stored forwarding information PLR router A will use a label stack that includes the LDP label learned from its next next hop MP router C via the targeted LDP session . The label stack may include an inner label L and an outer label L. The outer RSVP TE LSP label L may be used by the LSRs in network for forwarding traffic on the RSVP TE bypass LSP to router E.

When router E receives traffic from PLR router A bearing the label stack outer label L inner label L router E may swap the outer label L for a different label say L advertised by MP router C when RSVP bypass LSP was established and router E leaves the inner LDP label L untouched. When MP router C receives the traffic from router E bearing the label stack outer label L inner label L MP router C pops off the outer label L and uses inner label L to do a lookup in its forwarding table and swaps the inner label L for a label L for example which was advertised by router F e.g. using LDP as its loopback address.

In this manner the techniques of this disclosure allow routers to provide node protection using LDP in most network topologies including in network topologies in which LDP node protection would not otherwise be available. The techniques of this disclosure enable node protection to be used for fast reroute of LSP traffic until a convergence process completes for a new path through the network. The techniques may therefore reduce packet loss that might otherwise occur while a routing protocol converges on each of the routers along the path of LSP .

In some examples PLR router A may be configured to retain only mappings for intra area FECs from its targeted LDP session with its next next hop here targeted LDP session with next next hop MP router C without retaining all FEC mappings. This may be done by adding an intra area node protection application type to the approach described in S. Esale Application aware Targeted LDP MPLS Working Group Internet Draft draft esale mpls app aware tldp 02 Nov. 22 2014 the entire contents of which are incorporated by reference herein. See also U.S. Ser. No. 14 320 242 entitled APPLICATIONS AWARE TARGETED LDP SESSIONS filed Jun. 30 2014 the entire contents of which are incorporated by reference herein. For example PLR router A may be configured to initiate a targeted LDP session in a manner that includes information specifying one or more application for which the targeted LDP session is being initiated. LSRs may establish targeted LDP sessions to be used for various purposes referred to herein as applications. The applications may be forwarding functions used for forwarding network communications over the targeted LDP sessions.

For example a sending LSR can send an LDP initialization message that includes a new type length value TLV referred to as a Targeted Application Capability TAC TLV that specifies one or more applications for which a targeted LDP session is proposed to be established. For example when signaling the targeted LDP session with the next next hop PLR router A may be configured to include within an LDP initialization message a targeted application capability TAC type length value TLV specifying intra area node protection. Enabling LSRs to advertise Targeted Application Capability during session initialization can provide the receiver LSR with information about the targeted applications so the receiver LSR can control the acceptance of this session. If the receiving LSR determines that the initiated targeted LDP session is acceptable the receiving LSR can reply with an LDP initialization message specifying one or more applications for which the receiving LSR is willing to establish the targeted LDP session. In this manner the sending and receiving LSR peers can during the LDP session initialization process negotiate a set of Targeted Application Elements indicating a set of one or more applications for which both LSRs are willing to advertise state information over the resulting targeted LDP session.

The techniques described with respect to work well when the protected node is not an ABR for a given LSP bound to an IPv4 IPv6 prefix FEC. If protected router B is an ABR as in and protected router B advertises into IGP area A in which PLR router A is positioned that this prefix is reachable via some other IGP area B that the ABR protected router B is in then the above techniques described above may not work as the next next hop to PLR router A for this prefix resides in a different IGP area B than PLR router A itself and thus a Shortest Path First SPF calculation performed by PLR router A cannot determine the next next hop.

To provide node protection for an ABR such as protected router B in accordance with some aspects of the techniques of this disclosure PLR router A is configured to identify all the LSPs bound to IPv4 IPv6 prefix FECs for which the ABR is the next hop. For each such prefix the ABR using the information provided by the link state database finds some other ABR that is in the same area as PLR router A and the protected ABR such that this other ABR advertises inter area reachability to the prefix. The other ABR is generally referred to herein as other ABR. In the example of the other ABR in the same area A as PLR router A and ABR protected router B is router E. Whether a router is an ABR may be indicated in an LSA advertised on an IGP session between routers so PLR router A can determine whether a protected node is an ABR by consulting its link state database for example. In some examples the IGP area s in which each of routers resides may be specified as a field in route tables maintained by each of routers .

After identifying the other ABR E PLR router A establishes an RSVP TE auto bypass LSP to that other ABR E if a bypass LSP is not yet established and also establishes a targeted LDP session to that other ABRE to learn a label advertised by the other ABR E. PLR router A can automatically establish the RSVP TE bypass LSP in a manner similar to that described with respect to establishing RSVP TE bypass LSP of e.g. by sending PATH messages and receiving RESV messages.

When selecting a path on which to establish RSVP TE bypass LSP PLR router A may take into account Shared Risk Link Group SRLG associated with the link between itself and the protected node. Specifically the bypass LSP should avoid traversing links that share one or more SRLGs with the link between itself and the protected node. Also PLR router A should avoid the protected node for node protection. During the SPF calculation PLR router A uses the auto bypass LSP s to protect all the prefixes that reside behind the protected ABR. Thus if the protected ABR B fails PLR router A of the protected ABR B will re direct packets on RSVP TE auto bypass LSP to other ABR E.

PLR router A also establishes a targeted LDP session to the identified other ABR here router E . PLR router A receives an LDP label mapping advertised by the other ABR E via the targeted LDP session and stores the LDP label mapping to its FIB.

In response to PLR router A detecting a failure of protected ABR router B PLR router A can subsequently send traffic received on LSP onto bypass LSP and in accordance with its stored forwarding information PLR router A will use a label stack that includes the LDP label learned from the other ABR E via the targeted LDP session . PLR router A relies on the other ABR E to forward the traffic to MP router C by some path determined by other ABR E. The label stack may include an inner label from the LDP label mapping received via the targeted LDP session and an outer label for the RSVP TE bypass LSP . The outer RSVP TE LSP label L may be used by the LSRs in network for forwarding traffic on the RSVP TE bypass LSP to other ABR E. Although shown in as only being one hop away from PLR router A in some examples the other ABR may be multiple hops away from PLR router A.

In some examples PLR router A may be configured to provide one or more additional features. In some examples a even if PLR router A may receive label mappings from the other ABR E for both inter area FECs and intra area FECs PLR router A may retain only the mapping for the inter area FECs and may discard all other mappings and or b even if PLR router A receives label mapping from its next next hops for both inter area FECs and intra area FECs PLR router A may retain only the mapping for the intra area FECs and may discard all other mappings . However there can be an exception for rule a . For instance if the other ABR is also the next next hop merge point for a few intra area FECs then PLR router A should retain from the other ABR the label mapping for those intra area FECs.

Further in some examples PLR router A may always use other ABR E for inter area prefix node protection. That is PLR router A may be configured to automatically determine an other ABR for each ABR in area A that needs node protection. In these examples each node discovers and establishes RSVP TE bypass LSPs and targeted LDP sessions to all the ABRs in the area. Moreover PLR router A calculates a respective other ABR for each of the inter area prefixes. Thus if the prefix primary next hop takes a path via ABR B PLR router A sets up the backup next hop to take a path via other ABR E. Once PLR router A sets up the backup next hop PLR router A constructs the backup next hop label stack with a top label as RSVP TE bypass LSP label and a bottom label as the prefix s label learned over the targeted LDP session with other ABR router E.

In some examples PLR router A may retain only mappings for intra area FECs from its next next hop targeted LDP session e.g. targeted LDP session from and only inter area FECs from the other ABR targeted LDP session and may discard all other mappings. For example PLR router A may always use other ABR to protect inter area traffic. In such a case LDP executing on PLR router A does not have to learn all the FECs over a targeted LDP session such as session . For instance LDP needs to learn only intra area FECs over the targeted LDP session to the next next hop and inter area FECs over the targeted LDP session to the other ABR E. This can be achieved by adding two more application types a Intra area node protection and b Inter area node protection to the approach described in S. Esale Application aware Targeted LDP referenced above.

However for ABR node protection there may be instances when LDP executing on PLR router A has to negotiate both the Intra area node protection and Inter area node protection application types over the targeted LDP session to the other ABR which is also a next next hop for some intra area FECs. In this case both application types can be specified in the negotiation of targeted LDP session .

Routing component primarily provides an operating environment for control plane protocols . For example one or more IGP routing protocols such as Intermediate System to Intermediate System ISIS routing protocol A or the Open Shortest Path First OSPF routing protocol B maintains Traffic Engineering Database TED and or link state database to reflect the current topology of a network and other network entities to which PLR router is connected. In particular IGPs update TED and or link state database to accurately reflect the topology of the network and other entities.

Routing component generates and programs forwarding component with FIB that associates network destinations with specific next hops and corresponding interfaces ports of IFCs in accordance with TED and or link state database . Routing component may generate FIB in the form of a radix tree having leaf nodes that represent destinations within the network for example. FIB may include label mappings for MPLS LSPs including next hops with label stacks for bypass LSPs as described below.

Based on FIB forwarding component forwards packets received from inbound links A N to outbound links A N that correspond to next hops associated with destinations of the packets. U.S. Pat. No. 7 184 437 provides details on an exemplary embodiment of a router that utilizes a radix tree for route resolution. The entire contents of U.S. Pat. No. 7 184 437 are incorporated herein by reference.

In one example forwarding component is a rich and dynamic shared forwarding plane optionally distributed over a multi chassis router. Moreover forwarding component may be provided by dedicated forwarding integrated circuits normally associated with high end routing components of a network router. Further details of one example embodiment of PLR router can be found in U.S. Pat. No. 8 339 959 issued Dec. 25 2012 entitled STREAMLINED PACKET FORWARDING USING DYNAMIC FILTERS FOR ROUTING AND SECURITY IN A SHARED FORWARDING PLANE the entire contents of which are incorporated herein by reference.

PLR router also includes management interface by which an administrator ADMIN script or network management system can configure PLR router . In some examples management interface may be presented locally or may be used for receiving information by way of an Application Programming Interface API from a Software Defined Network SDN controller or Path Computation Element PCE for example.

As shown in protocols executing within routing component include one or more MPLS protocols for establishing a LSP. For example RSVP TE module may generate and maintain a traffic engineering database TED including bandwidth reservations for paths associated with MPLS LSPs. Constrained Shortest Path First CSPF process computes a shortest path or paths for an MPLS LSP based on specified constraints and bandwidth availability information associated with the links within the network. The constraints and bandwidth availability information associated with the links may have been obtained by IGPs . IGPs may in turn advertise the calculated bandwidth availability information in TED to other peer routers.

PLR router receives RSVP TE PATH messages from PE routers A and C for setting up LSPs A and B respectively. In response RSVP TE module of router forwards the RSVP TE PATH messages to router B and also sends RSVP TE RESV messages back to the ingress routers confirming the reservation of the requested bandwidth. RSVP TE module may also inform IGPs which in turn can update TED with current available bandwidth information. IGPs may also forward the updated current available bandwidth information to other IGP peers. RSVP TE module may also store MPLS labels to FIB for LSPs.

In accordance with the techniques of this disclosure RSVP TE module includes automatic node protection module AUTO NP MODULE which is configured to perform the techniques described herein with respect to for providing intra area node protection and inter area node protection. For providing intra area node protection automatic node protection module in response to determining that node protection is requested obtains the network address of each of one or more potential next next hop merge points e.g. the advertised loopback address obtained via one of IGPs from TED or link state database . RSVP TE module can automatically establish RSVP TE bypass LSPs along a path computed by CSPF to the next next hop merge points by sending PATH messages and receiving RESV messages.

For inter area node protection automatic node protection module of RSVP TE module determines that a protected node is an ABR on an LSP being established for which node protection is requested. For example automatic node protection module can determine whether a protected node is an ABR by consulting link state database for example. In some examples the IGP areas in which network routers reside may be specified as a field in route tables maintained by router . In response to determining that the protected node is an ABR RSVP TE module can identify at least one area border router in the same area as router and the protected node and automatically establish an RSVP TE auto bypass LSP to that other ABR if a bypass LSP is not yet established.

Label Distribution Protocol LDP may send and receive label mapping messages for establishing LSPs and store learned label mappings to FIB . For intra area node protection in some examples LDP module may learn all RSVP TE bypass LSPs from RSVP TE module and targeted adjacency module signals a targeted LDP adjacency and targeted LDP session for each next next hop for the RSVP TE bypass LSPs. For inter area node protection in some examples LDP module learns the RSVP TE bypass LSP to the other ABR from RSVP TE module and targeted adjacency module signals a targeted LDP adjacency and targeted LDP session to the identified other ABR.

Subsequent to a protected LSP being established router may in some examples detect a failure condition of a protected node along the LSP such as protected router B on LSP . In some examples connectivity fault detection module may run a session to a neighboring node and can detect when the neighboring node fails. In some examples the session is managed by the kernel of router not shown and a routing protocol daemon RPD and or RSVP TE module is informed by the kernel if there is any change. RSVP TE module will react depending on its configuration. Otherwise routing component may do fault detection. For example one of IGPs of routing component may detect that a neighboring node has failed e.g. based on the IGP no longer receiving Hello messages on an IGP session with the neighboring node. In some examples in response to detecting a failure condition of a protected resource between router and a merge point router connectivity fault detection module informs RSVP TE module in the control plane of router of the detected condition.

Although illustrated for purposes of example as being positioned in the forwarding component e.g. in the forwarding plane of router connectivity fault detection module could alternatively be located in the control plane of router such as within routing component . In the case of connectivity fault detection module being located in the control plane connectivity fault detection module may poll the forwarding component for statistics and information and compare the data received from forwarding component to configured thresholds for example. In one example connectivity fault detection module may comprise a software application programming interface API in the control plane of router that requests the status of aspects of forwarding component such as next hop utilization statistics and forwarding component responds by providing the requested statistics. In this case connectivity fault detection module might perform bookkeeping accounting of bandwidth in the control plane for example.

Subsequently when RSVP TE module is notified that a protected node has failed RSVP TE module may also update FIB to set a next hop along a bypass LSP as the primary next hop such as by changing weights associated with the next hops in the forwarding information. In some examples PLR router may also then delete the next hop along the primary LSP from the forwarding state. Examples of updating forwarding state for fast reroute are described in U.S. Pat. No. 8 077 726 entitled FAST REROUTE FOR MULTIPLE LABEL SWITCHED PATHS SHARING A SINGLE INTERFACE issued Dec. 13 2011 the entire contents of which are incorporated by reference herein.

In response to detecting failure of the protected node router can subsequently send traffic received on the primary LSP onto a bypass LSP and router will use a label stack in FIB that includes an LDP label learned C via the targeted LDP session. The label stack may be stored in label stacks and may include an inner LDP label and an outer RSVP TE label for example.

In the example of PLR router A discovers all possible next next hops NNHs of PLR router A that are in the same IGP area as PLR router A and that avoid the protected router B . An automatic node protection module of PLR router A may be configured to obtain these next next hops from a topology database e.g. its stored TED or link state database populated with topology information obtained via IGP link state advertisements LSAs exchanged by PLR router A with IGP peer routers.

PLR router A automatically establishes a bypass LSP to each of the discovered next next hops if a bypass LSP is not yet established . An LDP module of PLR router A also signals a targeted LDP session to each of the identified next next hops . In some examples PLR router A may establish the bypass LSP and signal the targeted LDP session in parallel. PLR router A then obtains an LDP label mapping advertised by MP router C via targeted LDP session . PLR router A stores the label mapping received from MP router C to its FIB and programs its FIB with a backup path with a label stack having an outer label as the label for the bypass LSP and an inner label based on the label mapping received via the targeted LDP session .

In response to PLR router A detecting a failed resource between PLR router A and MP router C e.g. failure of protected router B in the example of PLR router A can subsequently send traffic received on LSP onto the backup path programmed to its FIB. PLR router A will use the label stack that includes the RSVP TE bypass LSP label and LDP label L learned from its next next hop MP router C via the targeted LDP session . The label stack may include an inner label L and an outer label L. The outer RSVP TE LSP label L may be used by the LSRs in network for forwarding traffic on the backup path via RSVP TE bypass LSP .

PLR router A identifies a protected node based on local configuration of PLR router A and in the example of PLR router A determines that a protected node is an area border router . In response to determining that the protected node is an ABR PLR router A is configured to identify a second ABR other ABR in the same IGP area as the protected node and PLR router A . Whether a router is an ABR may be indicated in an LSA advertised on an IGP session between routers so automatic node protection module of PLR router A can determine whether a protected node is an ABR and identify the second ABR by consulting link state database for example.

PLR router A automatically establishes a bypass LSP to the identified second area border router E . PLR router A also automatically establishes a targeted LDP session with the second area border router E . In some examples PLR router A may establish the bypass LSP and signal the targeted LDP session in parallel. PLR router A receives an LDP label mapping advertised by the second ABR E via the targeted LDP session and stores the LDP label mapping to its FIB . PLR router A programs its FIB with a backup path with a label stack having an outer label as the label for the bypass LSP and an inner label based on the label mapping received via the targeted LDP session .

In response to PLR router A detecting a failed resource between PLR router A and MP router C e.g. failure of protected router B in the example of PLR router A can subsequently send traffic received on LSP onto the backup path using the label stack that includes the LDP label L learned from its next next hop MP router C via the targeted LDP session . The label stack may include an inner label L and an outer label L. The outer RSVP TE LSP label L may be used by the LSRs in network for forwarding traffic on the backup path via RSVP TE bypass LSP .

In other examples LDP may be extended to set up next next hop targeted sessions. For example LDP may be extended to advertise next next hop neighbors allowing PLR router A to learn next next hop neighbors by these advertisements e.g. learned from router B . Subsequently PLR router A may establish targeted sessions between PLR router A and all the neighbor s neighbors. Further PLR router A may advertise IPv4 and IPv6 label bindings on these targeted sessions for LDP node protection. In addition PLR router A signals RSVP TE auto bypass LSP to neighbor s neighbor excluding the neighbor. PLR router A calculates next next hop for each route with the help of either IGP SPF or TED database. So during the programming of route PLR router A uses the next next hop label as an inner label and RSVP TE auto bypass label as an outer tunnel.

In another example LDP may be extended to learn all neighbors neighbors. Also PLR router A signals RSVP TE auto bypass LSPs to neighbors neighbors as backup LSPs. IGP executing on the PLR router A uses this backup LSP for node protection during SPF calculation. LDP uses the same IGP backup next hop as RSVP TE auto bypass LSP to program its backup next hop. This would require few LDP protocol extensions and either only changes to MPLS or to MPLS and IGP. LDP may have good number of targeted session for node protection. The application aware targeted LDP techniques can be used to control the types of FECs exchanges over the targeted sessions. Inter area node protection needs either BGP TE or some other mechanism.

An example of extending LDP for fast reroute in multicast LSPs is described in U.S. Ser. No. 13 467 610 entitled FAST REROUTE USING LOOP FREE ALTERNATE NEXT HOPS FOR MULTIPOINT LABEL SWITCHED PATHS filed May 9 2012 the entire contents of which is incorporated by reference herein.

The techniques described in this disclosure may be implemented at least in part in hardware software firmware or any combination thereof. For example various aspects of the described techniques may be implemented within one or more processors including one or more microprocessors digital signal processors DSPs application specific integrated circuits ASICs field programmable gate arrays FPGAs or any other equivalent integrated or discrete logic circuitry as well as any combinations of such components. The term processor or processing circuitry may generally refer to any of the foregoing logic circuitry alone or in combination with other logic circuitry or any other equivalent circuitry. A control unit comprising hardware may also perform one or more of the techniques of this disclosure.

Such hardware software and firmware may be implemented within the same device or within separate devices to support the various operations and functions described in this disclosure. In addition any of the described units modules or components may be implemented together or separately as discrete but interoperable logic devices. Depiction of different features as modules or units is intended to highlight different functional aspects and does not necessarily imply that such modules or units must be realized by separate hardware or software components. Rather functionality associated with one or more modules or units may be performed by separate hardware or software components or integrated within common or separate hardware or software components.

The techniques described in this disclosure may also be embodied or encoded in a computer readable medium such as a computer readable storage medium containing instructions. Instructions embedded or encoded in a computer readable medium may cause a programmable processor or other processor to perform the method e.g. when the instructions are executed. Computer readable media may include non transitory computer readable storage media and transient communication media. Computer readable storage media which is tangible and non transitory may include random access memory RAM read only memory ROM programmable read only memory PROM erasable programmable read only memory EPROM electronically erasable programmable read only memory EEPROM flash memory a hard disk a CD ROM a floppy disk a cassette magnetic media optical media or other computer readable storage media. It should be understood that the term computer readable storage media refers to physical storage media and not signals carrier waves or other transient media.

Various aspects of this disclosure have been described. These and other aspects are within the scope of the following claims.

