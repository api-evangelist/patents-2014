---

title: Third party interface for provisioning bearers according to a quality of service subscription
abstract: A provisioning system may receive requests, such as from third party service providers, to provision dedicated bearers for traffic associated with the service providers. For example, a service provider may request a particular quality of service (“QoS”) level for traffic sent between the service provider and one or more user devices. This QoS level may be higher than a “normal” QoS level that is ordinarily provided. The provisioning system may establish a bearer, such as a dedicated non-guaranteed bitrate (“non-GBR”) bearer between a packet data network (“PDN”) gateway (“PGW”) and the user device, and may transmit traffic, associated with the service provider, via the dedicated non-GBR bearer. A QoS agent, installed at the user device, may ensure that traffic, associated with the service provider, is sent from the user device via the dedicated non-GBR bearer (e.g., as opposed to another bearer with a lower QoS level).
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09642032&OS=09642032&RS=09642032
owner: Verizon Patent and Licensing Inc.
number: 09642032
owner_city: Basking Ridge
owner_country: US
publication_date: 20140919
---
This application is a continuation in part of and claims the benefit of priority of U.S. patent application Ser. No. 14 061 514 titled INTER LAYER QUALITY OF SERVICE PRESERVATION filed Oct. 23 2013 the contents of which are incorporated herein in their entirety.

Networks such as wireless telecommunications networks allow for communication between user devices such as cellular telephones and other devices such as servers other user devices etc. . Traffic to and or from user devices may traverse multiple different network devices such as base stations and or gateways and links between the network devices. These network devices may each employ different techniques for ensuring quality of service QoS for traffic associated with the user devices. These QoS techniques may be applied at different layers of the Open Systems Interconnection OSI model. For example an application may specify a level of QoS at the network layer e.g. OSI layer 3 . While a network may enforce the requested QoS at the network layer a transport network may not necessarily apply a link layer e.g. OSI layer 2 QoS that appropriately corresponds to the requested network layer QoS.

The following detailed description refers to the accompanying drawings. The same reference numbers in different drawings may identify the same or similar elements.

User devices such as wireless telephones may send and receive traffic such as traffic associated with voice calls video calls file transfer control signaling etc. Based on the type of application that traffic is associated with a user device and or a router via which the traffic is transmitted may mark the traffic with a QoS marking such as a network layer e.g. OSI layer 3 QoS marking which may specify how the traffic should be treated at the network level by devices via which the traffic is routed. Even though some traffic may be marked with a desired network layer QoS existing systems may fail to apply appropriate QoS treatment at other layers e.g. at the link layer or OSI layer 2 .

Some implementations described herein may allow for the identification of network layer QoS markings of traffic and the application of link layer QoS treatment of the traffic based on the network layer QoS markings. For example as shown in user device may be communicatively coupled to packet data network PDN via router and RAN core network . Router may include for example a mobile enterprise router which communicates wirelessly with RAN core network which may include a Long Term Evolution LTE network. Upon initial attachment of router with RAN core network and or at another time multiple bearers between router and one or more devices of RAN core network e.g. PDN gateway PGW may be established. These multiple bearers may each correspond to different link layer QoS levels. In the context of an LTE network a link layer QoS level may be referred to as a QoS Class Identifier QCI . As illustrated one bearer may correspond to QCI 1 one bearer may correspond to QCI 7 and one bearer may correspond to QCI 8.

As described further below router may receive and or store information that correlates network layer QoS levels to link layer QoS levels e.g. QCIs . As also described further below PGW may receive and or store information that correlates link layer QoS levels to Multiprotocol Label Switching MPLS QoS levels e.g. MPLS traffic classes .

As shown in user device may output traffic to PDN via router and RAN core network . The traffic may include a network layer QoS marking such as for example a Differentiated Service DiffServ Code Point DSCP value in an Internet Protocol IP header of the traffic. Router may identify a QCI level associated with the DSCP value associated with the traffic and may output the traffic via the appropriate bearer. For example as shown in router may identify that the network layer QoS marking of the traffic is associated with QCI level 8 and may output the traffic to RAN core network via the associated bearer QCI 8 bearer in .

PGW may identify an MPLS QoS level e.g. MPLS traffic class associated with the QCI level of the bearer via which the traffic was received. PGW may mark the received traffic with an MPLS traffic class such as by encapsulating the received traffic in one or more MPLS packets and marking a Traffic Class field of a header of the MPLS packet s with the identified traffic class. PGW may forward the MPLS packet s to PDN . One or more components of PDN such as Label Edge Router LER may receive the MPLS packet s and may extract the original traffic e.g. as outputted by user device . Elements of PDN such as LER and or other devices associated with PDN may treat the extracted traffic according to the network layer QoS marking originally specified by user device .

In some implementations inter layer QoS treatment may be provided on a subscription basis. For example router may be an enterprise router owned by an enterprise level customer who may have purchased a subscription to the inter layer QoS treatment described above. As another example in some implementations individual user devices may be associated with such a subscription and may perform inter layer QoS functions similar to those described above with respect to router . In some implementations a provider of RAN core network may provide an application programming interface API which may allow a subscriber to specify correlations between network layer QoS levels e.g. DSCP values and link layer QoS levels e.g. QCI levels .

By providing QoS treatment on a different layer than is specified by traffic itself some implementations may allow for more consistent predictable and accurate end to end QoS treatment of traffic. Further by providing the opportunity for subscribers to specify lower layer QoS levels that are associated with network layer QoS levels some implementations described herein may provide a way for subscribers to have enhanced levels of access to lower layer QoS treatment mechanisms which were not previously available. Some implementations described herein do not rely on the interworking between applications running on user devices and the associated application servers and or application functions with or without the use of Application Layer Gateways and or APIs residing inside or outside of the service provider s IMS infrastructure to allow the applications to invoke link QoS levels. Instead some implementations provide an application independent method of mapping between network layer QoS levels and link layer QoS levels.

The quantity of devices and or networks illustrated in is provided for explanatory purposes only. In practice there may be additional devices and or networks fewer devices and or networks different devices and or networks or differently arranged devices and or networks than illustrated in . Alternatively or additionally one or more of the devices of environment may perform one or more functions described as being performed by another one or more of the devices of environment . Devices of environment may interconnect via wired connections wireless connections or a combination of wired and wireless connections.

Environment may include an evolved packet system EPS that includes an LTE network and or an evolved packet core EPC network that operate based on a third generation partnership project 3GPP wireless communication standard. The LTE network may be or may include a radio access network RAN that includes one or more base stations some or all of which may take the form of an eNodeB eNB via which user device may communicate with the EPC network. The EPC network may include one or more SGWs MMEs and or PGWs and may enable user device to communicate with network and or an IP multimedia subsystem IMS core network. The IMS core network may include HSS SPR and may manage authentication session initiation account information a user profile etc. associated with user device .

User device may include any computation and communication device such as a wireless mobile communication device that is capable of communicating with one or more networks e.g. network and or the IMS core . For example user device may include a radiotelephone a personal communications system PCS terminal e.g. a device that combines a cellular radiotelephone with data processing and data communications capabilities a personal digital assistant PDA e.g. that can include a radiotelephone a pager Internet intranet access etc. a smart phone a laptop computer a tablet computer a camera a personal gaming system or another type of mobile computation and communication device. User device may send traffic to and or receive traffic from network and or application server via router base station SGW PGW and or edge router .

Router may include a network device that routes traffic received from user device to an intended destination e.g. to network and or routes traffic e.g. traffic received from network to user device . In some implementations router may communicate with base station via for example a wireless connection e.g. via one or more wireless bearers such as LTE bearers . In some implementations router may communicate with user device via a wireless connection such as via a Bluetooth connection an IEEE 802.11 connection sometimes referred to as Wi Fi or another type of wireless connection. Router may alternatively or additionally communicate with user device via a wired connection.

Base station may include one or more network devices that receive process and or transmit traffic such as calls audio video text and or other data destined for and or received from user device . In one example base station may be an eNB device and may be part of the LTE network. Base station may receive traffic from and or send traffic to network via SGW and PGW . Base station may send traffic to and or receive traffic from user device via an air interface.

SGW may include one or more network devices that gather process search store and or provide information. For example SGW may include a gateway a router a modem a switch a firewall a network interface card NIC a hub a bridge a proxy server and or some other type of device that processes and or transfers traffic. SGW may for example aggregate traffic received from one or more base stations and may send the aggregated traffic to network via PGW .

MME may include one or more computation and communication devices that gather process search store and or provide information. For example MME may perform operations to register user device with the EPS to establish bearer channels associated with a session with user device to hand off user device from the EPS to another network to hand off user device from the other network to the EPS and or to perform other operations. MME may perform policing operations on traffic destined for and or received from user device .

PGW may include one or more network devices or other types of computation and communication devices that gather process search store and or provide information in a manner described herein. For example PGW may include a gateway a router a modem a switch a firewall a network interface card NIC a hub a bridge a proxy server an optical add drop multiplexer OADM and or some other type of device that processes and or transfers traffic. PGW may aggregate traffic received from one or more SGWs and may send the aggregated traffic to network . PGW may also or alternatively receive traffic from network and may send the traffic toward user device via SGW and or base station .

HSS SPR may include one or more server devices or other types of devices that gather process search store and or provide information. For example HSS SPR may manage update and or store in a memory associated with HSS SPR profile information associated with a subscriber. The profile information may identify applications and or services that are permitted for and or accessible by the subscriber a mobile directory number MDN associated with the subscriber bandwidth or data rate thresholds associated with the applications and or services information associated with the subscriber e.g. a username a password etc. rate information minutes allowed for a subscriber and or other information. The subscriber may be associated with for example user device . Additionally or alternatively HSS SPR may perform authentication authorization and or accounting operations associated with the subscriber and or a communication session with user device .

PCRF may include one or more server devices or other types of devices that aggregate information sent to and received from the EPC network and or other sources. PCRF may receive information regarding policies and or subscriptions from one or more sources such as subscriber databases and or from one or more users such as for example an administrator associated with PCRF and may output policy information to one or more devices that enforce the policies such as PGW .

ILQ engine may include one or more server devices or other types of devices that store receive and or output information that correlates QoS levels regarding various layers of the OSI model. The information stored by ILQ engine may facilitate the application of various QoS techniques by user device router PGW and or other devices. In some implementations ILQ engine may include an API via which an administrator third party application developers and or other users may provide information that correlates network layer QoS levels to link layer QoS levels and or link layer QoS levels to MPLS classes of service. ILQ engine may in some implementations provide some or all of the stored and or received information to PCRF .

Network may include one or more wired and or wireless networks. For example network may include a cellular network a public land mobile network PLMN a second generation 2G network a third generation 3G network a fourth generation 4G network a fifth generation 5G network and or another network. Additionally or alternatively network may include a wide area network WAN a metropolitan area network MAN a telephone network e.g. the Public Switched Telephone Network PSTN an ad hoc network an intranet PDN e.g. the Internet a fiber optic based network and or a combination of these or other types of networks. In some implementations network may include a private enterprise network and or a private portion of a provider s back end network.

Network may include one or more edge routers which may include one or more network devices act as ingress and egress points for traffic into and out of network . In some implementations edge router may include a label edge router which operates using MPLS IP and or other protocols. For example edge router may receive MPLS packets from outside of network extract IP packets from the MPLS packets and may forward the extracted IP packets within network . Further edge router may receive IP packets from within network encapsulate the IP packets in MPLS packets and forward the MPLS packets to a destination outside of network .

Application server may include one or more communication and computation devices such as one or more server devices. Application server may in some implementations be implemented as a cloud system in which multiple distributed physical devices may be virtualized as a single device and or in which resources of one device may be virtualized as multiple devices. In some implementations application server may be implemented within a private or enterprise network which may be connected to network via one or more edge routers that are implemented within the private or enterprise network. Application server may in some implementations be associated with a content provider that provides content e.g. streaming content such as streaming video streaming audio streaming game content etc. to one or more user devices .

In some implementations application server may include or may be communicatively coupled with one or more content delivery networks CDNs which may include multiple storage devices located at geographically diverse locations that cache copies of content for fast delivery to user devices . Application server may in some implementations be owned and or operated by an entity that has a relationship or agreement with an owner and or an operator of the EPS and or may be owned and or operated by the owner and or operator of the EPS. For instance application server may be associated with an allocated amount of usage of the EPS e.g. allocated amounts of throughput latency etc. and or application server may be associated with a billing model whereby the owner and or operator of application server is charged for specific usage of the EPS. Application server may communicate with one or more components of the EPS or the IMS core or with a device that is communicatively coupled to the EPS or the IMS core e.g. HSS SPR and or provisioning interface in order to request the provisioning of bearers on behalf of one or more user devices .

As described below application server may request the provisioning of bearers on the behalf of particular user devices . The requested bearers may be associated with particular QoS levels which may correspond to better levels of service than would ordinarily be provided to user devices . As an example application server may be associated with a streaming video content provider and may offer premium subscriptions or content to certain users. User devices that access the premium content or are associated with a premium subscription may receive the content via bearers that provide higher throughput and or lower latency than other users.

Provisioning interface may include one or more communication and computation devices that serve as an interface for receiving requests to provision bearers according to particular QoS levels from devices outside of the EPS. For example provisioning interface may implement an application programming interface API an IP interface and or another type of interface via which provisioning interface may receive such requests from application server . Provisioning interface may also serve as a decision point at which requests may be granted or denied. For example provisioning interface may grant or deny provisioning requests based on subscriptions and or billing information associated with requesting application servers and or may receive manual input e.g. from an owner administrator and or operator of the EPS regarding whether to grant or deny provisioning requests. In some implementations provisioning interface may communicate with HSS SPR e.g. via an API and or another type of interface in order to notify HSS SPR regarding bearers associated with user devices and or application servers that should be provisioned.

In some implementations data structures and or may be maintained on a per subscriber or per set of subscribers basis. For example one user device or router or set of user devices or routers may be associated with one instance of data structure while another user device or router may be associated with another instance of data structure . In some implementations data structures and or may be maintained on a system wide basis where the information stored therein may be indiscriminately applicable to any user device or router .

As shown in data structure may store information that correlates network layer QoS levels e.g. the DSCP value s column to link layer QoS levels e.g. the QCI s column . The DSCP value s column may include DSCP values which denote a level of QoS at the network layer associated with traffic marked with particular DSCP values. For example the values stored in these fields may correspond to values according to one or more standards or Requests for Comment RFCs that describe possible DSCP values e.g. RFCs 2474 2475 3246 3260 and 4594 . As shown a field in this column may include the value 0 which may be a catch all value in that DSCP values in traffic which do not correspond to the values in the other fields may be considered to correspond to the catch all value.

As further shown the QCI s field may include one or more QCIs which denote a level of QoS at the link layer associated with traffic sent or received via a bearer associated with a particular QCI. In some implementations a particular DSCP value or set of DSCP values may be associated with multiple QCIs. For instance as shown in the DSCP value EF is associated with QCIs 1 and 7. The asterisk in this QCIs field may conceptually denote that traffic marked with the EF DSCP value from a particular subscriber is associated with QCI 1 if a QCI 1 bearer is available for the subscriber. For example a QCI 1 bearer may be available for the subscriber if the subscriber has subscribed to a service whereby a QCI 1 bearer is available for the subscriber if network resources allow for a QCI 1 bearer to be available etc. If a QCI 1 bearer is not available for the subscriber then the information in this field denotes that traffic marked with the EF DSCP value should be associated with a QCI 7 bearer.

While an example was presented above in which two QCIs are present in the same field in some implementations more than two QCIs may be present in a particular field. In some such implementations the association of a QCI with a DSCP value may be made in a hierarchical or rule based fashion.

As further shown data structure may also include a description field. The description field may include for example human readable descriptions of types of traffic associated with DSCP values and or QCIs.

As described further below the information stored in data structures and may be stored and or utilized by user device and or router . For example when outputting traffic user device and or router may identify a DSCP value associated with the traffic and based on the information stored in data structure output the traffic via an appropriate bearer e.g. a bearer having a QCI that matches the information indicated in data structure .

As described further below the information stored in data structure may be stored and or utilized by PGW . For example PGW may identify a QCI associated with received traffic e.g. a QCI associated with a bearer via which traffic was received . Based on the information in data structure PGW may identify an MPLS traffic class e.g. class of service EXP bits traffic class 802.1p bits etc. associated with the traffic and may encapsulate the traffic in one or more MPLS packets. The MPLS packets may include header information that specifies the corresponding MPLS traffic class and PGW may forward the MPLS packets e.g. to network .

As shown in router and PGW may perform at an attachment procedure. The attachment procedure may include for example an attachment procedure according to an LTE standard. While not shown in the figure for the sake of conciseness the attachment procedure may involve one or more other devices e.g. base station SGW and MME . In this sense the signal flow shown in this figure and or in other figures may be considered to be a simplified representation of actual signal flows via which the attachment procedure may occur in practice. For example the attachment procedure may include an attach request not shown sent by router via base station . The attachment procedure may allow router to be registered with PGW to facilitate connectivity between PGW and router .

PGW may send at an IP Connectivity Access Network IP CAN request to PCRF . This request may be sent via for example a Gx interface e.g. as described in the documents 3GPP TS Technical Specification 29.211 V6.4.0 Technical Specification Group Core Network and Terminals Rx Interface and Rx Gx Signalling Flows Release 6 June 2007 and 3GPP TS 29.212 V12.1.0 Technical Specification Group Core Network and Terminals Policy and Charging Control PCC Reference Points Release 12 June 2013 .

The IP CAN request may be made so that an IP CAN session associated with router may be subsequently established. The IP CAN session once established may facilitate IP connectivity between router and PGW . In some implementations PCRF may perform policy enforcement or other functionality in order to determine whether an IP CAN session should be permitted to be established.

PCRF may request at subscription information associated with router . The request may be sent to for example HSS SPR . As described above HSS SPR may store subscriber information which may indicate whether router is subscribed to a service associated with inter layer QoS enforcement. The subscriber information may also in some implementations indicate parameters for the service e.g. which QoS levels of one layer are associated with which QoS levels of another layer .

HSS SPR may output at the requested subscription information to PCRF . Although not shown if the requested subscription information is not present e.g. if router is not associated with a subscription to a service whereby inter layer QoS is enforced HSS SPR may output an indication to PCRF indicating that router is not associated with such a subscription.

At an IP CAN session associated with router may be established. Further PCRF may output at inter layer QoS information associated with router . This information may indicate for instance that router is associated with a subscription to a service associated with inter layer QoS enforcement. This information may also include parameters for the service e.g. which QoS levels of one layer are associated with which QoS levels of another layer .

At multiple LTE bearers may be established between router and PGW . Although not shown other devices e.g. base station SGW and MME may be involved in the establishment of the bearers. The established bearers may each be associated with different QoS levels e.g. QCIs . As described above the different QoS levels of the bearers may be indicated by the inter layer QoS information provided by PCRF .

PGW may also output at some or all of the inter layer QoS information to router . For example PGW may output this information to router before after or during the LTE bearer establishment at . This information may be used by router to facilitate inter layer QoS enforcement for traffic sent to and or received by traffic .

While signals correspond to an example of the initiation of inter layer QoS enforcement functionality for router signals correspond to inter layer QoS enforcement being performed. For instance router may receive at traffic from user device which may have previously registered with and or attached to router . The traffic may include a QoS marking at the network layer such as a DSCP value in a header of the traffic.

In the example shown in the traffic outputted by user device includes the network layer QoS marking. In practice router may additionally or alternatively apply a network layer QoS marking to the traffic e.g. may add or modify a DSCP value associated with the received traffic .

Router may identify a bearer via which the traffic should be transmitted based on the DSCP value associated with the received traffic. For example router may use the inter layer QoS information received at to identify a QCI based on the DSCP value of the traffic. Router may identify one of the bearers established at associated with the QCI and may output at the traffic via the identified bearer.

PGW may receive the traffic e.g. via one or more other devices such as base station and SGW not shown and may identify an MPLS CoS which should be applied to the traffic. For example the subscription information received at may indicate a correlation between one or more CoSs and one or more QCIs. Using this information PGW may determine based on the QCI of the bearer via which the traffic was received which MPLS CoS should be applied to the traffic for subsequent forwarding. For example PGW may encapsulate the traffic in one or more MPLS packets and may set header information e.g. a CoS field an EXP bit a p bit etc. of the MPLS packets to indicate the desired CoS.

PGW may output at the one or more MPLS packets to for example network . As described above network may include a set of edge routers one of which may receive the one or more MPLS packets and may extract the original traffic e.g. the traffic outputted by user device at and or the traffic outputted by router at . In this manner the original network layer QoS specified by user device and or may be preserved within network and or during subsequent communications to other destinations .

Although not shown similar techniques may be used for traffic sent to user device from network . For example network may output e.g. via edge router traffic having a particular DSCP value and encapsulated in one or more MPLS packets according to a particular CoS to user device . PGW may receive the one or more MPLS packets and may identify a QCI associated with the particular CoS and or the particular DSCP value. PGW may extract the traffic from the MPLS packets e.g. may remove some or all MPLS header information and may forward the traffic to user device via an established bearer that is associated with the identified QCI.

User device may identify traffic to be outputted to for example network . User device may identify an application and or a network layer QoS level e.g. a DSCP value associated with the traffic to be outputted. Based on the application and or the network layer QoS level user device may determine via which bearer of the bearers established at the traffic should be outputted. User device may output at the traffic via the selected bearer. Based on via which bearer the traffic was received PGW may determine an MPLS CoS associated with the traffic and may encapsulate the traffic in one or more MPLS packets that are associated with the appropriate MPLS CoS. PGW may forward at the MPLS packets to network e.g. to edge router . When traffic is sent from network to user device similar techniques may be used to ensure inter layer enforcement.

User device may output at traffic to router . The traffic may include a DSCP value. Additionally or alternatively router may add or modify a DSCP value associated with the traffic. Based on the DSCP value router may determine via which bearer of the bearers established at the traffic should be outputted. Router may output at the traffic via the selected bearer. Based on via which bearer the traffic was received PGW may determine an MPLS CoS associated with the traffic and may encapsulate the traffic in one or more MPLS packets that are associated with the appropriate MPLS CoS. PGW may forward at the MPLS packets to network e.g. to edge router . When traffic is sent from network to router similar techniques may be used to ensure inter layer enforcement.

User device may identify traffic to be outputted to for example network . User device may identify an application and or a network layer QoS level e.g. a DSCP value associated with the traffic to be outputted. Based on the application and or the network layer QoS level user device may determine via which bearer of the bearers established at the traffic should be outputted. User device may output at the traffic via the selected bearer. Based on via which bearer the traffic was received PGW may determine an MPLS CoS associated with the traffic and may encapsulate the traffic in one or more MPLS packets that are associated with the appropriate MPLS CoS. PGW may forward at the MPLS packets to network e.g. to edge router . When traffic is sent from network to user device similar techniques may be used to ensure inter layer enforcement.

As shown user device may identify at traffic to be outputted e.g. to network . User device may determine a network layer QoS level associated with the traffic e.g. based on a DSCP value in a header of the traffic based on a type of the traffic based on an application associated with the traffic etc. . User device may identify a link layer QoS level e.g. a QCI associated with the network layer QoS level. For example user device may store inter layer QoS information that correlates DSCP values to QCIs. User device may have received the inter layer QoS information as part of an attachment procedure with PGW or at another time e.g. during a configuration or update process performed by a network service provider associated with PGW .

User device may request at that a bearer associated with the identified QCI be established between user device and PGW . In some implementations PGW may perform policy or rule enforcement to determine whether the bearer should be established e.g. whether network resources are available whether user device is subscribed to or otherwise approved for the requested QCI etc. . Assuming that PGW determines that the bearer is permissible to be established the bearer may be established at between user device and PGW . Although not shown in the figure if PGW does not determine that the bearer with the requested QCI should be established PGW may notify user device that the request was rejected and or may indicate to user device an alternate QCI that would be permissible. User device may output at the traffic over the established LTE bearer and PGW may apply MPLS level QoS treatment to the traffic when forwarding at the traffic to edge router . In some situations a bearer with the appropriate QCI may have already been previously established. In these situations user device may forgo requesting that a new bearer be established and may output at the traffic via the existing bearer.

The request made at may be received by MME e.g. via base station . Based on receiving the request MME may send at a bearer resource command to PGW . The bearer resource command may identify among other information the QCI level indicated in the request sent at from user device .

The bearer resource command sent at may be received by PCRF e.g. via SGW . Based on the bearer resource command PCRF may request at the establishment of an IP CAN session or the modification of an existing IP CAN session. In some implementations based on the IP CAN session request PCRF may verify whether user device is authorized for the requested QCI level. For instance PCRF may request at subscription information from HSS SPR . HSS SPR may in some implementations store subscription information which may indicate whether user device is authorized for the requested QCI level.

HSS SPR may output at the requested subscription information to PCRF . Although not shown if the requested subscription information is not present e.g. if user device is not authorized for the QCI level and or is not associated with a subscription that allows user device to request specific QCI levels HSS SPR may output an indication to PCRF indicating that user is not associated with such a subscription and or is not authorized for the requested QCI level.

At PCRF may output an IP CAN session acknowledgement and an IP CAN session may be established or an existing IP CAN session may be modified based on the QCI level . PGW may output at a request to create a bearer that is associated with the requested QCI level. MME may receive the request e.g. via SGW and may output at a bearer setup request to base station . The bearer setup request may indicate the QCI level specified in the request sent at . In some implementations the bearer setup request sent at may be a request to establish an Evolved Universal Terrestrial Radio Access Network Radio Access Bearer E RAB and may indicate the requested QCI level.

Based on the bearer setup request sent at base station may establish an LTE bearer e.g. by establishing a Radio Resource Control RRC channel associated with the specified QCI level with user device . In some implementations base station may modify an existing set of RRC channels when establishing the LTE bearer associated with the specified QCI level.

Once the bearer has been established at user device may proceed to output traffic via the bearer. For example user device may store inter layer QoS information that correlates DSCP values to QCI levels. Assume that the bearer established at is associated with a QCI level of 1 and that inter layer QoS information stored by user device indicates that a DSCP value of EF is correlated to QCI level 1. Further assume that user device identifies that traffic having a DSCP value of EF is to be outputted by user device . Based on the stored inter layer QoS information user device may output this traffic over the established bearer that is associated with QCI level 1.

Process may include performing a mobile device attachment procedure block . For example as described above PGW may perform an attachment procedure with user device and or router .

Process may also include determining inter layer QoS information associated with the mobile device block . For example PGW may determine an instance of data structure and or associated with the mobile device in order to determine a set of QCIs of bearers that should be established for the mobile device. As described above the inter layer QoS information may be received from PCRF and or from ILQ engine .

Process may further include establishing bearers with the mobile device based on the inter layer QoS information block . For example referring to the example information shown in PGW may establish three bearers with the mobile device where the bearers each correspond to a different one of QCI 1 QCI 7 and QCI 8.

Process may also include providing some or all of the inter layer QoS information to the mobile device block . For instance PGW may output some or all of the contents of data structure or to the mobile device. This inter layer QoS information may aid the mobile device in performing inter layer QoS enforcement e.g. may indicate which QCIs of the established bearers are associated with which DSCP values .

With respect to process is described below in the context of being performed by user device . However as mentioned above process may be performed by router and or another device.

Process may include performing an attachment procedure block . For example user device may send an attach request to PGW and perform other signaling associated with attachment.

Process may also include receiving information regarding established bearers block . For instance as described above a set of bearers corresponding to different link layer QoS levels may be established between user device and PGW based on the attachment procedure performed at block . User device may receive information regarding the bearers e.g. bearer identifiers from PGW .

Process may further include receiving inter layer QoS information block . For example user device may receive information that correlates network layer QoS levels e.g. DSCP values to link layer QoS levels e.g. QCIs . User device may receive the inter layer QoS information from PGW and or from another source. The inter layer QoS information may be received in conjunction with before or after the attachment procedure at .

Process may additionally include identifying traffic to output block . For instance an application e.g. a voice call application a video call application a file transfer application a gaming application etc. associated with user device may indicate that traffic should be outputted to network .

Process may also include identifying a DSCP QoS marking of the traffic block . For instance the application from which the traffic is outputted may include a DSCP value in a header of the traffic. Additionally or alternatively user device may add or modify a DSCP value in a header of the traffic e.g. based on the traffic type an identity of the application the application type and or another factor . In some implementations the traffic may include encryption or encapsulation techniques such as Generic Routing Encapsulation GRE or IP Security IPSec . These techniques may hide some or all of the content of the traffic but may retain the DSCP QoS markings of the traffic. Thus techniques described herein may be applicable even to encrypted or encapsulated traffic.

Process may further include determining which bearer of the established bearers the traffic should be outputted based on the inter layer QoS information and the DSCP QoS marking block . For example user device may use the inter layer QoS information received at block to determine a QCI associated with the DSCP value of the traffic and may identify a bearer of the established bearers that is associated with the identified QCI. Process may additionally include outputting the traffic over the bearer that was determined based on the DSCP QoS marking block .

Referring to process may include receiving inter layer QoS information block . For example PGW may receive inter layer QoS information from PCRF and or ILQ engine . The inter layer QoS information may correlate link layer QoS levels to MPLS traffic classes and may in some implementations be in a format similar to data structure . PGW may receive the inter layer QoS information in conjunction with an attachment process between PGW and a mobile device and or at another time e.g. independent of any such attachment process .

Process may further include receiving traffic from a mobile device via an established bearer block . For example PGW may receive traffic from a mobile device via one of a group of bearers associated with the mobile device e.g. as established at block of or via a bearer established upon a request by the mobile device e.g. as requested at signal of .

Process may also include identifying a QCI associated with the bearer via which the traffic was received block and determining using the inter layer QoS information an MPLS traffic class e.g. a CoS associated with the QCI block . For example PGW may use the information in data structure to determine an MPLS CoS associated with the QCI of the bearer via which the traffic was received.

Process may additionally include encapsulating the traffic using the MPLS CoS block . For example PGW may encapsulate the traffic in one or more MPLS packets and may mark a header of the packets with the MPLS CoS determined at block .

Process may also include outputting the encapsulated traffic block . For instance PGW may forward the encapsulated traffic to network . At the MPLS layer the encapsulated traffic may receive QoS treatment at the MPLS layer according to the marked CoS. As described above an edge router associated with network may receive the encapsulated traffic and extract the original traffic e.g. the traffic received at block . The extracted traffic may subsequently receive QoS treatment at the network layer according to a network layer QoS marking e.g. a DSCP value associated with the traffic.

As further shown application server may output subscription information to RAN core network . The subscription information may include information identifying user device and application server . In some implementations the subscription information may specify one or more requested QoS levels e.g. link layer QoS levels such as QCI values . As described further below one or more components of RAN core network e.g. a provisioning interface may based on the subscription information provision one or more bearers e.g. a non guaranteed bitrate non GBR LTE bearer corresponding to the requested QoS levels e.g. QCI values for traffic sent between user device and application server . RAN core network may also enable MPLS QoS treatment within RAN core network of traffic sent between user device and application server e.g. in a manner similar to that described above with respect to for example signals and of .

By establishing dedicated bearers for traffic between particular user devices and application servers some implementations may allow for customized QoS treatment to be offered by content providers. For example third party content providers e.g. entities that are external to a RAN core network may be able to offer particular levels of QoS treatment thereby enhancing the service options provided by the content providers. Further since some implementations provide a provisioning interface that is accessible to third party content providers the concept of providing levels of service may be extended to third party content providers instead of being exclusively handled by a RAN core network. Additionally since the established bearers are non GBR bearers according to some implementations the bearers may easily be put into an idle state when not in use e.g. without consuming excessive resources and may be dynamically reactivated when needed to send and or receive traffic to and or from particular user devices.

As shown data structure may include the following example fields User Device ID Application Server ID and QCI. The User Device ID field may include identifying information for a particular user device such as an International Mobile Station Equipment Identity IMEI value an International Mobile Subscriber Identity IMSI value a media access control MAC address a proprietary e.g. non standard identifier and or other identifying information. The Application Server ID field may include identifying information for a particular application server such as an IP address a MAC address a proprietary e.g. non standard identifier and or other identifying information. The QCI field may include a QCI value that indicates a link layer QoS level that should apply to bearers e.g. LTE bearers that carry traffic between user device and application server .

As shown device may include a set of applications which may be applications that send and or receive traffic to and or from an external source e.g. one or more networks such as a RAN a core network and or a PDN . For instance a particular application may output traffic that is destined for one or more application servers and may be indicated as the destination for traffic received from one or more application servers . For instance a particular application may be a voice call application a video conferencing application a video streaming application a gaming application a web browsing application an instant messaging application and or another type of application.

Some applications may be provided as part of an application suite . A particular application suite may be provided by for example one entity e.g. an owner and or operator of a particular application server . When registering for a QoS subscription with the particular application server QoS treatment may be applied to traffic sent and or received by multiple applications in an application suite associated with the particular application server . Thus in some such implementations one QoS agent may be associated with one application suite . In some implementations one QoS agent may be associated with one particular application . In other implementations QoS agent may process traffic outputted by all applications installed on device in a manner described below. In some implementations QoS agent may throttle the traffic associated with one or more applications in order to ensure a particular QoS level of one or more other applications .

A particular QoS agent may intercept traffic outputted by one or more applications and may perform QoS policing operations on the traffic. For example QoS agent may mark traffic with DSCP markings in order to cause the traffic to be outputted via an LTE bearer according to a particular QCI. In some implementations QoS agent may replace existing DSCP values with different DSCP values. QoS agent may store information that links particular applications and or traffic types to particular DSCP values and may use the information on intercepted traffic to mark the traffic with the DSCP values. This information may be useful in situations where a particular application does not mark outgoing traffic with DSCP values and or when a particular application either mistakenly or maliciously marks outgoing traffic with an incorrect DSCP value e.g. in an attempt to obtain better QoS than is authorized .

Additionally or alternatively QoS agent may perform policing queuing buffering and or prioritization operations based on one or more other factors e.g. one or more factors other than DSCP values . For example QoS agent may prioritize traffic to and or from multiple applications . For example a first application may have a higher priority than a second application . Assuming that both the first application and the second application output traffic at approximately the same time QoS agent may forward the traffic from the first application before the traffic from the second application and or may cause the traffic associated with the first application to be processed before the traffic from the second application . In some implementations this policing queuing buffering prioritization etc. may be performed for applications within a particular application suite and or may be performed on a per application suite basis e.g. one application suite may be associated with a higher priority than another application suite .

Data structure for example may include application identifiers which may be an application name and or another identifier. The application identifier may be used by QoS agent to determine whether a particular DSCP value should be applied to traffic. For example assume that QoS agent inspects traffic outputted by an application called Mall of Duty. QoS agent may identify that the traffic has been outputted by the particular application based on inspecting header and or payload information in the traffic. For instance the header and or the payload may include an application ID and or other information which may be used to identify the application. QoS agent may determine that the information in the third row of data structure is applicable to the traffic i.e. the row that includes the Mall of Duty application identifier . That is QoS agent may determine that the traffic should be marked with the DSCP value AF31 and may mark the traffic accordingly.

Data structure may include traffic types which may be used by QoS agent to determine whether a particular DSCP value should be applied to traffic. For example assume that QoS agent inspects traffic e.g. a header and or a payload of the traffic . The traffic may include identifiers and or other information based on which QoS agent may identify the traffic type. For example traffic having indicators regarding particular video codecs may be identified as video conferencing traffic. As another example traffic including HTTP requests may be identified as web browsing traffic. As yet another example traffic may include explicit identifiers e.g. standard identifiers and or proprietary non standard identifiers that indicate the type of the traffic. QoS agent may in some implementations mark traffic with DSCP values according to the identified traffic type.

Data structure may include traffic types as well as application identifiers which may be used by QoS agent to determine whether a particular DSCP value should be applied to traffic. Using the information in data structure QoS agent may apply different DSCP values to different traffic types outputted by the same application. On the other hand QoS agent may apply different DSCP values to the same traffic type outputted by different applications. For example as shown QoS agent may apply a DSCP value of EF to voice calls outputted by the application Skipe but may apply a DSCP value of AF41 to instant messaging traffic outputted by the application Skipe. 

Returning to traffic associated with some applications e.g. application may not be inspected by a particular QoS agent . For instance application may be a native application associated with device may not be specifically associated with a particular QoS agent etc. In some implementations application may mark traffic with a DSCP value.

DSCP QCI component may include and or may be communicatively coupled to hardware circuitry and or logic that outputs traffic from DSCP QCI component . For example DSCP QCI component may include and or may be communicatively coupled to one or more LTE radio transceivers.

DSCP QCI component may receive DSCP marked traffic e.g. from one or more QoS agents and or applications and may determine a QCI associated with the DSCP values in the DSCP marked traffic. For instance DSCP QCI component may store information similar to data structures and described above with respect to . DSCP QCI component may in some implementations perform functionality similar to that described above in conjunction with with respect to user device . For instance DSCP QCI component may select a particular LTE bearer via which to output traffic based on the LTE bearer being associated with the appropriate QCI value.

For example assume that two LTE bearers have been established between device and a RAN core network e.g. between device and PGW one having a QCI value of 1 and the other having a QCI value of 7. Further assume that DSCP QCI component receives DSCP marked traffic from QoS agent and determines that the DSCP value associated with the traffic corresponds to a QCI value of 1. Based on this determination DSCP QCI component may output the traffic over the LTE bearer having the QCI value of 1 e.g. in a similar fashion as described above with respect to for example .

As shown process may include receiving subscription information from an application server block . For example as discussed above provisioning interface may receive subscription information from application server regarding a subscribed QoS level associated with traffic sent and or received to and or from application server by a particular user device . In some implementations the subscription information may specify a link layer QoS e.g. a QCI value and or another QoS value e.g. an MPLS CoS value . In some implementations the subscription information may include another QoS identifier or description based on which provisioning interface may identify a link layer QoS and or an MPLS CoS value.

For example the subscription information may specify a gold level based on which provisioning interface may identify a relatively low QCI value where lower QCI values generally relate to better or more desirable levels of service such as lower latency higher throughput lower packet drop rates etc. . As another example the subscription information may specify a silver level based on which provisioning interface may identify a higher QCI value than would be associated with the gold level.

As also described above the subscription request sent by application server may also coincide with the providing of one or more QoS agents to user device to which the subscription applies. For example application server or another device may provide the QoS agent to user device when outputting the subscription information to provisioning interface . Additionally or alternatively application server or another device may provide the QoS agent to user device upon receiving confirmation from provisioning interface that the subscription has been approved.

Process may also include verifying the application server and or the subscription information block . For example provisioning interface may verify whether application server has been authorized to request the provisioning of bearers on behalf of user devices and or whether the application server has been authorized to request the specified QoS levels indicated in the subscription information received at block . For instance provisioning interface may verify whether application server is a trusted device and or is associated with a trusted owner and or operator. Provisioning interface may for instance request and or receive authentication information such as a password an encrypted key etc. from application server in order to verify application server and or the subscription information.

Process may further include outputting the subscription information to an HSS SPR block . For instance provisioning interface may output the subscription information to HSS SPR and or information derived from the subscription information. Specifically for instance provisioning interface may output information identifying user device application server and the QoS level s e.g. QCI value s that should be applied to traffic sent between user device and application server . The information stored by HSS SPR may be used by other network devices e.g. PGW and or PCRF in order to identify which bearer s should be used to send and or receive traffic to and or from user device . Examples of how this information may be used are discussed above with respect to for instance .

Process may additionally include outputting a provisioning instruction to provision one or more bearers for the user device based on the subscription information block . For instance provisioning interface may output an instruction to PGW which may cause PGW to provision one or more bearers that correspond to the specified QCI values. Additionally or alternatively one or more other devices may cause PGW to provision the one or more bearers and or PGW may communicate with one or more devices in addition to or in lieu of PGW in order to provision the one or more bearers. For example PGW may communicate with MME HSS SPR and or PCRF as part of the bearer establishment procedure. In some such implementations the information provided to HSS SPR at block may cause HSS SPR to output subscription information PCRF e.g. using DIAMETER messaging over an Sh interface which may provide an instruction e.g. using DIAMETER messaging over a Gx interface to PGW to establish the one or more bearers. PGW may signal SGW using GPRS Tunneling Protocol C GTP C over an S5 S8 interface SGW may signal MME over an S11 interface and MME may signal base station e.g. over an S1 MME interface and user device e.g. over an S1 AP NAS interface to complete the bearer establishment.

In some implementations the provisioning of the bearer s may be similar to some aspects of the signal flow shown in for example . As mentioned above the one or more bearers provisioned at block may be dedicated non GBR bearers. PGW may maintain information regarding the established bearers and may use the bearers when user device attaches to a RAN associated with PGW .

As shown process may include receiving an attach request from a user device block . For example as described above PGW may perform an attachment procedure with user device .

Process may also include identifying one or more bearers that have been previously established based on a QoS subscription that are associated with the user device block . For instance as mentioned above PGW may maintain information regarding previously provisioned dedicated non GBR bearers that have been established on behalf of user device e.g. bearers provisioned at block .

Process may further include outputting information regarding the one or more established bearers to the user device block . For example PGW may output the information to user device in order to set up the bearers for use by user device . In some implementations PGW may change a status of the one or more bearers from an idle mode to an active mode based on the attachment.

Process may also include sending and or receiving traffic to and or from the user device via the established one or more bearers block . For instance as described above PGW may receive traffic from user device via a particular bearer that user device selected based on a DSCP value associated with the traffic e.g. as marked by a QoS agent or other application associated with user device and or based on other criteria e.g. an identity of an application that outputted the traffic a type of the traffic etc. . PGW may in some implementations apply an MPLS CoS to the traffic and may forward the traffic toward application server in a manner similar to that described above e.g. with respect to .

In some situations a provisioned dedicated bearer e.g. as established by way of block may be de provisioned e.g. after a particular period of time has elapsed since traffic has been sent and or received over the bearer . After the bearer is de provisioned a default bearer may remain between user device and PGW . In some implementations when DSCP marked traffic is to be sent from user device a bearer establishment procedure may be initiated in order to establish a dedicated non GBR bearer associated with a QCI that corresponds to the DSCP marking of the traffic. However before the dedicated non GBR bearer is established user device may output the traffic over the default bearer. Once the dedicated non GBR bearer is established user device may output the traffic over the dedicated non GBR bearer.

PGW may select at a particular LTE bearer based on subscription information that indicates a particular QCI value for traffic sent to user device from application server . For example PGW may inspect the traffic to identify that the sender of the traffic is application server and that the intended recipient is user device and may determine that user device and application server are associated with an established LTE bearer. Additionally or alternatively PGW may identify based on subscription information that the type of traffic e.g. voice traffic streaming video traffic etc. should be sent via a bearer associated with a particular QCI value. PGW may output at the traffic via the selected LTE bearer to user device .

Bus may include one or more communication paths that permit communication among the components of device . Processor may include a processor microprocessor or processing logic that may interpret and execute instructions. Memory may include any type of dynamic storage device that may store information and instructions for execution by processor and or any type of non volatile storage device that may store information for use by processor .

Input component may include a mechanism that permits an operator to input information to device such as a keyboard a keypad a button a switch etc. Output component may include a mechanism that outputs information to the operator such as a display a speaker one or more light emitting diodes LEDs etc.

Communication interface may include any transceiver like mechanism that enables device to communicate with other devices and or systems. For example communication interface may include an Ethernet interface an optical interface a coaxial interface or the like. Communication interface may include a wireless communication device such as an infrared IR receiver a Bluetooth radio or the like. The wireless communication device may be coupled to an external device such as a remote control a wireless keyboard a mobile telephone etc. In some embodiments device may include more than one communication interface . For instance device may include an optical interface and an Ethernet interface.

Device may perform certain operations relating to one or more processes described above. Device may perform these operations in response to processor executing software instructions stored in a computer readable medium such as memory . A computer readable medium may be defined as a non transitory memory device. A memory device may include space within a single physical memory device or spread across multiple physical memory devices. The software instructions may be read into memory from another computer readable medium or from another device. The software instructions stored in memory may cause processor to perform processes described herein. Alternatively hardwired circuitry may be used in place of or in combination with software instructions to implement processes described herein. Thus implementations described herein are not limited to any specific combination of hardware circuitry and software.

The foregoing description of implementations provides illustration and description but is not intended to be exhaustive or to limit the possible implementations to the precise form disclosed. Modifications and variations are possible in light of the above disclosure or may be acquired from practice of the implementations. For example while series of blocks and or signals have been described with regard to the order of the blocks may be modified in other implementations. Further non dependent blocks may be performed in parallel.

Further while examples above describe network layer QoS levels in terms of DSCP values and link layer QoS levels in terms of QCIs in practice other techniques of identifying QoS levels may be used. Additionally while examples above describe inter layer QoS enforcement in terms of the network layer the link layer and MPLS in practice QoS levels of other layers may be enforced from layer to layer using similar techniques.

The actual software code or specialized control hardware used to implement an embodiment is not limiting of the embodiment. Thus the operation and behavior of the embodiment has been described without reference to the specific software code it being understood that software and control hardware may be designed based on the description herein.

Even though particular combinations of features are recited in the claims and or disclosed in the specification these combinations are not intended to limit the disclosure of the possible implementations. In fact many of these features may be combined in ways not specifically recited in the claims and or disclosed in the specification. Although each dependent claim listed below may directly depend on only one other claim the disclosure of the possible implementations includes each dependent claim in combination with every other claim in the claim set.

Further while certain connections or devices are shown e.g. in in practice additional fewer or different connections or devices may be used. For example while a direct connection is not shown in between ILQ engine and PGW in some implementations ILQ engine and PGW may communicate without the intervention of PCRF . Furthermore while various devices and networks are shown separately in practice the functionality of multiple devices may be performed by a single device or the functionality of one device may be performed by multiple devices. Further multiple ones of the illustrated networks may be included in a single network or a particular network may include multiple networks. Further while some devices are shown as communicating with a network some such devices may be incorporated in whole or in part as a part of the network.

No element act or instruction used in the present application should be construed as critical or essential unless explicitly described as such. An instance of the use of the term and as used herein does not necessarily preclude the interpretation that the phrase and or was intended in that instance. Similarly an instance of the use of the term or as used herein does not necessarily preclude the interpretation that the phrase and or was intended in that instance. Also as used herein the article a is intended to include one or more items and may be used interchangeably with the phrase one or more. Where only one item is intended the terms one single only or similar language is used. Further the phrase based on is intended to mean based at least in part on unless explicitly stated otherwise.

