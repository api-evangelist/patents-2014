---

title: Server mediated peer-to-peer communication offloading from network infrastructure
abstract: The disclosure generally relates to offloading communication from a network infrastructure to direct peer-to-peer communication. In particular, a server may receive peer-to-peer status information over the network infrastructure from at least two client devices that intend to communicate, wherein the peer-to-peer status information may include at least coarse or precise location information associated with the client devices. The server may then instruct the client devices to communicate over a direct peer-to-peer connection that bypasses the network infrastructure in response to determining that the location information received from the client devices and other conditions permit offloading the communication from the network infrastructure. For example, the server may determine whether the communication can be offloaded based at least in part on whether an estimated distance between the client devices falls within a maximum range associated with one or more peer-to-peer interfaces supported on one or more of the client devices.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09350662&OS=09350662&RS=09350662
owner: QUALCOMM Incorporated
number: 09350662
owner_city: San Diego
owner_country: US
publication_date: 20140718
---
The disclosure generally relates to offloading network infrastructure communication to peer to peer P2P communication between endpoints in a server mediated manner.

Wireless communication systems have developed through various generations including a first generation analog wireless phone service 1G a second generation 2G digital wireless phone service including interim 2.5G and 2.75G networks and third generation 3G and fourth generation 4G high speed data Internet capable wireless services. There are presently many different types of wireless communication systems in use including Cellular and Personal Communications Service PCS systems. Exemplary cellular systems include the cellular Analog Advanced Mobile Phone System AMPS digital cellular systems based on Code Division Multiple Access CDMA Frequency Division Multiple Access FDMA Time Division Multiple Access TDMA the Global System for Mobile access GSM variation of TDMA and newer hybrid digital communication systems using both TDMA and CDMA technologies. More recently Long Term Evolution LTE has been developed as a wireless communications protocol for mobile phones and other terminals to communicate data at high speeds. LTE is based on GSM and includes contributions from various GSM related protocols such as Enhanced Data rates for GSM Evolution EDGE and Universal Mobile Telecommunications System UMTS protocols such as High Speed Packet Access HSPA .

Accordingly communications systems and devices are becoming increasingly diverse with new technological advancements. Communications devices are now able to support various different communications technologies and protocols. Indeed not only can various communications devices operate in a communications system e.g. over a network infrastructure many communications device may communicate with one another using direct peer to peer P2P communications and or using infrastructure elements where devices communicate through signals communicated via one or more base stations access points or other network infrastructure entities. For example communications devices that support the Wi Fi Direct standard may connect to each other via direct P2P connections and communicate at typical Wi Fi speeds with minimal setup and without requiring any wireless access point. Furthermore the LTE Direct standard uses licensed spectrum and the LTE physical layer to provide a scalable and universal framework through which equipped communications devices can discover and connect to proximate peers and thereby establish direct P2P connections within ranges up to approximately 500 meters whereas Wi Fi direct tends to require the devices to be in closer proximity.

As noted above one or more intermediate base stations access points or other infrastructure elements typically facilitate communication between two or more wireless devices or other endpoints over a network infrastructure e.g. through uplink and downlink channels between the endpoints and the infrastructure elements . However at times the loading conditions on the infrastructure elements e.g. at a base station serving one or more wireless devices may become excessive and thereby degrade communications quality. Furthermore in certain cases direct P2P communication may be faster more efficient more private or otherwise advantageous to end users. Accordingly network operators and end users can realize substantial benefits from using different P2P technologies to offload traffic from the network infrastructure especially when two or more devices seeking to communicate are located in proximity to one another and can establish a direct P2P connection with reasonably good quality. However direct P2P communication may be undesirable under other circumstances because always having P2P interfaces on may impact battery life raise privacy or security concerns e.g. where an end user does not want to be discoverable to third parties that may be unknown or otherwise untrusted and or interfere with enforcing lawful intercept requests among other things.

Accordingly in view of the above discussion it should be appreciated that a need exists for systems that can determine appropriate conditions where traffic between two or more wireless devices seeking to communicate can be offloaded from a network infrastructure to direct P2P communications and vice versa.

The following presents a simplified summary relating to one or more aspects and or embodiments disclosed herein. As such the following summary should not be considered an extensive overview relating to all contemplated aspects and or embodiments nor should the following summary be regarded to identify key or critical elements relating to all contemplated aspects and or embodiments or to delineate the scope associated with any particular aspect and or embodiment. Accordingly the following summary has the sole purpose to present certain concepts relating to one or more aspects and or embodiments disclosed herein in a simplified form to precede the detailed description presented below.

According to one exemplary aspect a method for offloading communication from a network infrastructure may comprise among other things receiving location information from a first wireless device and location information from a second wireless device over the network infrastructure determining whether communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure based at least in part on the location information received from the first wireless device and the location information received from the second wireless device and instructing the first wireless device and the second wireless device to communicate over a peer to peer connection that bypasses the network infrastructure in response to determining that the communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure. For example in one embodiment determining whether the communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure may comprise estimating a distance between the first wireless device and the second wireless device based on the received location information identifying one or more peer to peer technologies supported on the first wireless device and the second wireless device based on one or more peer to peer status reports received from the first wireless device and the second wireless device and determining that the communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure in response to the estimated distance falling within a range associated with the one or more peer to peer technologies supported on the first wireless device and the second wireless device. Additionally where the estimated distance falls within the range associated with multiple peer to peer technologies supported on the first wireless device and the second wireless device the peer to peer technology that the first wireless device and the second wireless device use to establish the peer to peer connection may be selected according to one or more user specific device specific operator specific and or other preferences.

According to another exemplary aspect the method may further comprise updating the estimated distance between the first wireless device and the second wireless device based on subsequent location updates that are provided in one or more intermittent reports received from the first and second wireless devices and instructing the first and second wireless devices to communicate over the network infrastructure in response to the updated distance falling outside the range associated with the peer to peer technologies supported thereon. Alternatively and or additionally the wireless devices may be instructed to communicate over the network infrastructure in response to one or more metrics indicating that the peer to peer connection fails to satisfy certain conditions e.g. performance criteria billing criteria etc. . In other use cases the wireless devices may be instructed to communicate over the network infrastructure in response to receiving a lawful intercept request that identifies a subscriber with either or both wireless devices or in the alternative one or more keys used to encrypt the communication over the peer to peer connection may be transmitted to a law enforcement agency in order to enable the law enforcement agency to conduct surveillance on the communication over the peer to peer connection and thereby enforce the lawful intercept request.

According to another exemplary aspect an apparatus may comprise a receiver configured to receive location information from a first wireless device and location information from a second wireless device over a network infrastructure one or more processors configured to determine whether communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure based at least in part on the location information received from the first wireless device and the location information received from the second wireless device and a transmitter configured to transmit a message instructing the first wireless device and the second wireless device to communicate over a peer to peer connection that bypasses the network infrastructure in response to determining that the communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure e.g. when an estimated a distance between the first wireless device and the second wireless device falls within a range associated with one or more peer to peer technologies supported on the first wireless device and or the second wireless device .

According to another exemplary aspect an apparatus may comprise means for receiving location information from a first wireless device and location information from a second wireless device over a network infrastructure means for determining whether communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure based at least in part on the location information received from the first wireless device and the location information received from the second wireless device and means for instructing the first wireless device and the second wireless device to communicate over a peer to peer connection that bypasses the network infrastructure in response to determining that the communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure.

According to another exemplary aspect a computer readable storage medium may have computer executable instructions recorded thereon wherein executing the computer executable instructions on a server may cause the server to receive location information from a first wireless device and location information from a second wireless device over a network infrastructure determine whether communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure based at least in part on the location information received from the first wireless device and the location information received from the second wireless device and instruct the first wireless device and the second wireless device to communicate over a peer to peer connection that bypasses the network infrastructure in response to determining that the communication between the first wireless device and the second wireless device can be offloaded from the network infrastructure.

Other objects and advantages associated with the various aspects and or embodiments disclosed herein will be apparent to those skilled in the art based on the accompanying drawings and detailed description.

Various aspects are disclosed in the following description and related drawings to show specific examples relating to exemplary embodiments. Alternate embodiments will be apparent to those skilled in the pertinent art upon reading this disclosure and may be constructed and practiced without departing from the scope or spirit of the disclosure. Additionally well known elements will not be described in detail or may be omitted so as to not obscure the relevant details of the aspects and embodiments disclosed herein.

The word exemplary is used herein to mean serving as an example instance or illustration. Any embodiment described herein as exemplary is not necessarily to be construed as preferred or advantageous over other embodiments. Likewise the term embodiments does not require that all embodiments include the discussed feature advantage or mode of operation.

The terminology used herein describes particular embodiments only and should be construed to limit any embodiments disclosed herein. As used herein the singular forms a an and the are intended to include the plural forms as well unless the context clearly indicates otherwise. It will be further understood that the terms comprises comprising includes and or including when used herein specify the presence of stated features integers steps operations elements and or components but do not preclude the presence or addition of one or more other features integers steps operations elements components and or groups thereof.

Further many aspects are described in terms of sequences of actions to be performed by for example elements of a computing device. It will be recognized that various actions described herein can be performed by specific circuits e.g. an application specific integrated circuit ASIC by program instructions being executed by one or more processors or by a combination of both. Additionally these sequence of actions described herein can be considered to be embodied entirely within any form of computer readable storage medium having stored therein a corresponding set of computer instructions that upon execution would cause an associated processor to perform the functionality described herein. Thus the various aspects of the disclosure may be embodied in a number of different forms all of which have been contemplated to be within the scope of the claimed subject matter. In addition for each of the aspects described herein the corresponding form of any such aspects may be described herein as for example logic configured to perform the described action.

A client device referred to herein as a user equipment UE may be mobile or stationary and may communicate with a radio access network RAN . As used herein the term UE may be referred to interchangeably as an access terminal or AT a wireless device a subscriber device a subscriber terminal a subscriber station a user terminal or UT a mobile terminal a mobile station and variations thereof. Generally UEs can communicate with a core network via the RAN and through the core network the UEs can be connected with external networks such as the Internet. Of course other mechanisms of connecting to the core network and or the Internet are also possible for the UEs such as over wired access networks Wi Fi networks e.g. based on IEEE 802.11 etc. and so on. UEs can be embodied by any of a number of types of devices including but not limited to PC cards compact flash devices external or internal modems wireless or wireline phones and so on. A communication link through which UEs can send signals to the RAN is called an uplink channel e.g. a reverse traffic channel a reverse control channel an access channel etc. . A communication link through which the RAN can send signals to UEs is called a downlink or forward link channel e.g. a paging channel a control channel a broadcast channel a forward traffic channel etc. . As used herein the term traffic channel TCH can refer to either an uplink reverse traffic channel or a downlink forward traffic channel.

Referring to UEs . . . N are configured to communicate with an access network e.g. the RAN an access point etc. over a physical communications interface or layer shown in as air interfaces and or a direct wired connection. The air interfaces and can comply with a given cellular communications protocol e.g. CDMA EV DO eHRPD GSM EDGE W CDMA LTE etc. while the air interface can comply with a wireless IP protocol e.g. IEEE 802.11 . The RAN includes a plurality of access points that serve UEs over air interfaces such as the air interfaces and . The access points in the RAN can be referred to as access nodes or ANs access points or APs base stations or BSs Node Bs Evolved Node Bs eNodeBs or eNBs and so on. These access points can be terrestrial access points or ground stations or satellite access points. The RAN is configured to connect to a core network that can perform a variety of functions including bridging circuit switched CS calls between UEs served by the RAN and other UEs served by the RAN or a different RAN altogether and can also mediate an exchange of packet switched PS data with external networks such as Internet . The Internet includes a number of routing agents and processing agents not shown in for the sake of convenience . In UE N is shown as connecting to the Internet directly i.e. separate from the core network such as over an Ethernet connection of Wi Fi or 802.11 based network . The Internet can thereby function to bridge packet switched data communications between UE N and UEs . . . N via the core network . Also shown in is the access point that is separate from the RAN . The access point may be connected to the Internet independent of the core network e.g. via an optical communication system such as FiOS a cable modem etc. . The air interface may serve UE or UE over a local wireless connection such as IEEE 802.11 in an example. UE N is shown as a desktop computer with a wired connection to the Internet such as a direct connection to a modem or router which can correspond to the access point itself in an example e.g. a Wi Fi router with wired and or wireless connectivity may correspond to the access point .

Referring to an application server is shown as connected to the Internet the core network or both. The application server can be implemented as a plurality of structurally separate servers or alternately may correspond to a single server. As will be described below in more detail the application server is configured to support one or more communication services for UEs that can connect to the application server via the core network and or the Internet e.g. Voice over Internet Protocol VoIP sessions Voice over LTE VoLTE sessions Push to Talk PTT sessions group communication sessions sessions that involve Rich Communication Services RCS sessions social networking services etc. .

Examples of protocol specific implementations for the RAN and the core network are provided below with respect to to help explain the wireless communications system in more detail. In particular the components of the RAN and the core network corresponds to components associated with supporting packet switched PS communications whereby legacy circuit switched CS components may also be present in these networks but any legacy CS specific components are not shown explicitly in .

In the core network includes the above noted SGSN B and potentially a number of other SGSNs as well and a GGSN B. Generally GPRS is a protocol used in GSM for routing IP packets. The GPRS core network e.g. the GGSN B and one or more SGSNs B is the centralized part of the GPRS system and also provides support for W CDMA based 3G access networks. The GPRS core network is an integrated part of the GSM core network i.e. the core network that provides mobility management session management and transport for IP packet services in GSM and W CDMA networks.

The GPRS Tunneling Protocol GTP is the defining IP protocol of the GPRS core network. The GTP is the protocol which allows end users e.g. UEs of a GSM or W CDMA network to move from place to place while continuing to connect to the Internet as if from one location at the GGSN B. This is achieved by transferring the respective UE s data from the UE s current SGSN B to the GGSN B which is handling the respective UE s session.

Three forms of GTP are used by the GPRS core network namely i GTP U ii GTP C and iii GTP GTP Prime . GTP U is used for transfer of user data in separated tunnels for each packet data protocol PDP context. GTP C is used for control signaling e.g. setup and deletion of PDP contexts verification of GSN reach ability updates or modifications such as when a subscriber moves from one SGSN to another etc. . GTP is used for transfer of charging data from GSNs to a charging function.

Referring to the GGSN B acts as an interface between a GPRS backbone network not shown and the Internet . The GGSN B extracts packet data with associated a packet data protocol PDP format e.g. IP or PPP from GPRS packets coming from the SGSN B and sends the packets out on a corresponding packet data network. In the other direction the incoming data packets are directed by the GGSN connected UE to the SGSN B which manages and controls the Radio Access Bearer RAB of a target UE served by the RAN . Thereby the GGSN B stores the current SGSN address of the target UE and its associated profile in a location register e.g. within a PDP context . The GGSN B is responsible for IP address assignment and is the default router for a connected UE. The GGSN B also performs authentication and charging functions.

The SGSN B is representative of one of many SGSNs within the core network in an example. Each SGSN is responsible for the delivery of data packets from and to the UEs within an associated geographical service area. The tasks of the SGSN B includes packet routing and transfer mobility management e.g. attach detach and location management logical link management and authentication and charging functions. The location register of the SGSN B stores location information e.g. current cell current VLR and user profiles e.g. IMSI PDP address es used in the packet data network of all GPRS users registered with the SGSN B for example within one or more PDP contexts for each user or UE. Thus SGSNs B are responsible for i de tunneling downlink GTP packets from the GGSN B ii uplink tunnel IP packets toward the GGSN B iii carrying out mobility management as UEs move between SGSN service areas and iv billing mobile subscribers. As will be appreciated by one of ordinary skill in the art aside from i iv SGSNs configured for GSM EDGE networks have slightly different functionality as compared to SGSNs configured for W CDMA networks.

The RAN e.g. or UTRAN in UMTS system architecture communicates with the SGSN B via a Radio Access Network Application Part RANAP protocol. RANAP operates over an Iu interface Iu ps with a transmission protocol such as Frame Relay or IP. The SGSN B communicates with the GGSN B via a Gn interface which is an IP based interface between SGSN B and other SGSNs not shown and internal GGSNs not shown and uses the GTP protocol defined above e.g. GTP U GTP C GTP etc. . In the embodiment of the Gn between the SGSN B and the GGSN B carries both the GTP C and the GTP U. While not shown in the Gn interface is also used by the Domain Name System DNS . The GGSN B is connected to a Public Data Network PDN not shown and in turn to the Internet via a Gi interface with IP protocols either directly or through a Wireless Application Protocol WAP gateway.

In the core network includes a plurality of Mobility Management Entities MMEs D and D a Home Subscriber Server HSS D a Serving Gateway S GW D a Packet Data Network Gateway P GW D and a Policy and Charging Rules Function PCRF D. Network interfaces between these components the RAN and the Internet are illustrated in and are defined in Table 1 below as follows 

A high level description of the components shown in the RAN and core network of will now be described. However these components are each well known in the art from various 3GPP TS standards and the description contained herein is not intended to be an exhaustive description of all functionalities performed by these components.

Referring to the MMEs D and D are configured to manage the control plane signaling for the EPS bearers. MME functions include Non Access Stratum NAS signaling NAS signaling security Mobility management for inter and intra technology handovers P GW and S GW selection and MME selection for handovers with MME change.

Referring to the S GW D is the gateway that terminates the interface toward the RAN . For each UE associated with the core network for an EPS based system at a given point of time there is a single S GW. The functions of the S GW D for both the GTP based and the Proxy Mobile IPv6 PMIP based S5 S8 include Mobility anchor point Packet routing and forwarding and setting the DiffSery Code Point DSCP based on a QoS Class Identifier QCI of the associated EPS bearer.

Referring to the P GW D is the gateway that terminates the SGi interface toward the Packet Data Network PDN e.g. the Internet . If a UE is accessing multiple PDNs there may be more than one P GW for that UE however a mix of S5 S8 connectivity and Gn Gp connectivity is not typically supported for that UE simultaneously. P GW functions include for both the GTP based S5 S8 Packet filtering by deep packet inspection UE IP address allocation setting the DSCP based on the QCI of the associated EPS bearer accounting for inter operator charging uplink UL and downlink DL bearer binding as defined in 3GPP TS 23.203 UL bearer binding verification as defined in 3GPP TS 23.203. The P GW D provides PDN connectivity to both GSM EDGE Radio Access Network GERAN UTRAN only UEs and E UTRAN capable UEs using any of E UTRAN GERAN or UTRAN. The P GW D provides PDN connectivity to E UTRAN capable UEs using E UTRAN only over the S5 S8 interface.

Referring to the PCRF D is the policy and charging control element of the EPS based core network . In a non roaming scenario there is a single PCRF in the HPLMN associated with a UE s Internet Protocol Connectivity Access Network IP CAN session. The PCRF terminates the Rx interface and the Gx interface. In a roaming scenario with local breakout of traffic there may be two PCRFs associated with a UE s IP CAN session A Home PCRF H PCRF is a PCRF that resides within a HPLMN and a Visited PCRF V PCRF is a PCRF that resides within a visited VPLMN. PCRF is described in more detail in 3GPP TS 23.203 and as such will not be described further for the sake of brevity. In the application server e.g. which can be referred to as the AF in 3GPP terminology is shown as connected to the core network via the Internet or alternatively to the PCRF D directly via an Rx interface. Generally the application server or AF is an element offering applications that use IP bearer resources with the core network e.g. UMTS PS domain GPRS domain resources LTE PS data services . One example of an application function is the Proxy Call Session Control Function P CSCF of the IP Multimedia Subsystem IMS Core Network subsystem. The AF uses the Rx reference point to provide session information to the PCRF D. Any other application server offering IP data services over cellular network can also be connected to the PCRF D via the Rx reference point.

In the eHRPD RAN includes a plurality of base transceiver stations BTSs E E and E which are connected to an enhanced BSC eBSC and enhanced PCF ePCF E. The eBSC ePCF E can connect to one of the MMEs D or D within the EPS core network A over an S101 interface and to an HRPD serving gateway HSGW E over A10 and or A11 interfaces for interfacing with other entities in the EPS core network A e.g. the S GW D over an S103 interface the P GW D over an S2a interface the PCRF D over a Gxa interface a 3GPP AAA server not shown explicitly in over an STa interface etc. . The HSGW E is defined in 3GPP2 to provide the interworking between HRPD networks and EPS LTE networks. As will be appreciated the eHRPD RAN and the HSGW E are configured with interface functionality to EPC LTE networks that is not available in legacy HRPD networks.

Turning back to the eHRPD RAN in addition to interfacing with the EPS LTE network A the eHRPD RAN can also interface with legacy HRPD networks such as HRPD network B. As will be appreciated the HRPD network B is an example implementation of a legacy HRPD network such as the EV DO network from . For example the eBSC ePCF E can interface with an authentication authorization and accounting AAA server E via an A12 interface or to a PDSN FA E via an A10 or A11 interface. The PDSN FA E in turn connects to HA A through which the Internet can be accessed. In certain interfaces e.g. A13 A16 H1 H2 etc. are not described explicitly but are shown for completeness and would be understood by one of ordinary skill in the art familiar with HRPD or eHRPD.

Referring to it will be appreciated that LTE core networks e.g. and HRPD core networks that interface with eHRPD RANs and HSGWs e.g. can support network initiated Quality of Service QoS e.g. by the P GW GGSN SGSN etc. in certain cases.

According to one aspect of the disclosure and illustrate exemplary wireless communications systems A and B where an application server e.g. the application server in etc. may mediate offloading communication between endpoints from a network infrastructure to a peer to peer P2P connection. More particularly referring to the wireless communications system A shown therein includes a first cell having a first base station a second cell having a second base station and the application server coupled to the first base stations and the second base station via a network link . The coverage area of a given base station is represented by the cell in which the given base station is located whereby for purposes of discussion the first cell includes the coverage area corresponding to the first base station and the second cell includes the coverage area corresponding to the second base station . Each the cells in the wireless communications system A include various UEs that communicate with the respective base stations and with the application server via the respective base stations . For example in the embodiment illustrated in the first cell includes UE UE and UE while the second cell includes UE UE and UE wherein one or more of the UEs in the wireless communications system A may be mobile or other wireless devices. Although not shown in in some embodiments the base stations may be connected to one another via a backhaul link.

In accordance with various exemplary embodiments described herein one or more of UE UE UE UE UE and UE may support direct P2P communications whereby such UEs may support communicating with one another directly without having to communicate through another device or a network infrastructure element such as the first base station and the second base station and also support communications through the network infrastructure elements such as the first base station and or the second base station . In communications that involve network infrastructure signals may generally be transmitted and received through uplink and downlink connections between various UEs and the base stations such as link in the first cell and link in the second cell . Each of the base stations generally serve as the attachment point for the UEs in the corresponding cells and facilitate communications between the UEs served therein. In accordance with one aspect when two or more UEs such as UE and UE wish to communicate with one another and are located in sufficient proximity to each other then a direct P2P link can be established therebetween which may offload traffic from the base station serving the UEs allow UEs to communicate more efficiently or provide other advantages that will be apparent to those skilled in the art.

Accordingly in one embodiment the application server may generally determine whether communication between the UEs seeking to communicate can be offloaded from the network infrastructure to a P2P connection in which case the application server may instruct the UEs to communicate via the P2P connection as shown by link in . Similarly as shown in the UE can communicate with UE through intermediate base station via link or as shown in UE and UE may further communicate via a P2P link . Furthermore for inter cell communications where the participating UEs are in different nearby cells a direct P2P communications link is still a possibility which is illustrated in where UE and UE may communicate using direct P2P communications illustrated by dashed link .

In various embodiments the application server may mediate whether to offload communications between two or more UEs in the wireless communications system A to a direct P2P link as in and or have the two or more UEs communicate through an infrastructure element such as base stations . In particular the application server may direct two or more UEs seeking to communicate to turn on P2P interfaces based on coarse or precise location information associated with the UEs a prediction or inference that the two or more UEs intend to communicate resource status associated with the UEs operator and or user preferences and or other suitable criteria. In one embodiment in response to the application server determining that communications between two or more UEs can be offloaded to a direct P2P link the application server can coordinate having the UEs turn on P2P interfaces and instruct the UEs to use the P2P interfaces to transfer data or otherwise communicate. The application server may then maintain connectivity with the UEs communicating via the P2P connection in parallel periodically check the status associated with the P2P communication session and direct the UEs to move the communication to a 3G 4G cellular network or other network infrastructure if needed e.g. in response to receiving a lawful intercept request in response to the P2P signal between the UEs degrading etc. . Furthermore the P2P offloading concept can be extended to group calls wherein the application server may mediate multi hop communication among various UEs communicating over P2P connections. For example as shown in UEs and may be participating in a group call wherein the application server may relay communication involving UEs that are communicating P2P via link to UEs over the network infrastructure and similarly relay communication involving UEs that are communicating P2P via link to UEs over the network infrastructure while communications between UEs and communications between UEs may be offloaded from the network infrastructure.

In one embodiment as noted above the application server may determine whether to offload communication between two or more UEs seeking to communicate from the network infrastructure based on various criteria. In one example the application server may receive dynamic periodic or event triggered location reports from the various UEs using the wireless communications systems A B whereby the application server may know coarse or precise locations associated with the various UEs. As such when a particular UE e.g. UE seeks to initiate a call or another suitable communication session with another UE e.g. UE the caller UE may transmit a call request that includes current P2P status information associated therewith to the application server wherein the current P2P status information provided in the call request may include a P2P identifier coarse or precise location information status information indicating whether P2P power saving features P2P discovery features and or P2P interfaces are on or off and or other suitable information that may be relevant to P2P communication. Furthermore as used herein the call request which may be alternatively and or interchangeably referred to as a call origination message may generally refer to any suitable signaling that an originating client e.g. the caller UE may transmit to the application server to initiate an intended communication with another client e.g. the called UE . For example the call request may be used to initiate a traditional voice call to initiate a media transfer to initiate a media exchange session or to initiate any other suitable type of media exchange as will be apparent to those skilled in the art e.g. for IMS the call request may comprise a SIP INVITE message . In any case in response to receiving the call request from the caller UE the application server may check the last known P2P status from the called UE and assess whether P2P offloading is possible if the last known P2P status was received within a certain time interval or alternatively query the called UE to request an updated P2P status from the called UE if the last known P2P status received therefrom was not received within the time interval e.g. was received before a predetermined time and is therefore considered stale . In another example the application server may infer that UE intends to communicate with UE based on information in periodic or event triggered reports that the UEs provide to the application server which may indicate that the UE is browsing a chat log with UE viewing a calendar event that involves UE and or otherwise describe activity that may be conducted on the UEs .

In one embodiment once the application server has obtained the most recent P2P status associated with the caller UE and the called UE the application server may then determine whether P2P offloading is possible. More particularly based on the coarse or precise location information associated with each UE the application server may determine a coarse or precise distance between the UEs determine P2P interfaces supported on the UEs and determine whether the UEs can suitably communicate P2P based thereon. For example if the UEs are located within approximately 300 meters of each other and supported P2P interfaces on each UE include LTE Direct the UEs may be within sufficient proximity to communicate P2P using LTE Direct which has a range of about 500 meters. In another example if the UEs are determined to be co located within a building or other smaller vicinity and each supports Wi Fi Direct the UEs may communicate via Wi Fi Direct. However in contrary examples if a first UE and a second UE are located approximately 300 meters from one another and only one supports LTE Direct the UEs may not be within the range necessary to communicate using LTE Direct and in a similar respect if one or both UEs co located within a building do not support Wi Fi Direct but both support LTE Direct the UEs may communicate via LTE Direct but not via Wi Fi Direct. Furthermore in one embodiment the decision about whether to prefer one P2P or another may be determined according to network operator and or user preferences resource status e.g. if one UE has a low battery or a low link speed switching P2P interfaces on may be undesirable .

In one embodiment in response to determining that communication between two or more UEs can be suitably offloaded from the network infrastructure to a P2P connection the application server may then state which P2P interface the UEs should use e.g. based on reported capabilities resources etc. state billing criteria that will be used e.g. based on location the P2P interfaces that will be used etc. and transmit keys to the UEs that may be used to encrypt the private P2P communication associated with the offloaded session until a time to live TTL associated with the keys expires. The UEs may then turn on the appropriate P2P interfaces and start to communicate directly bypassing the network infrastructure and the UEs may continue to send periodic or event triggered reports to the application server . Accordingly the application server may monitor the P2P communication between the UEs to determine whether to terminate the P2P offloading and or appropriately bill the call once completed. For example in one embodiment the application server may terminate the P2P offloading based on performance metrics e.g. in response to the signal quality associated with the P2P link degrading based on billing metrics e.g. a cost per minute constraint in response to changes in the locations associated with the UEs e.g. the call may be moved to network infrastructure if the UEs are moving away from each other and approaching the maximum range associated with their supported P2P interfaces and or in response to changes in the resource status associated with the UEs e.g. the battery on one UE has become low and may not have enough life left to support continued P2P communication . In another example the application server may receive a lawful intercept request from appropriate authorities in which case the application server may find a local CALEA Commission on Accreditation for Law Enforcement Agencies proxy and specify a catchword to terminate the P2P offloading and move to an infrastructure hosted call. In that case the application server may provide the encryption keys given to the UEs to the CALEA proxy which may thereby snoop on the P2P traffic as a relay node and or via querying the UEs to provide intermittent reports on the offloaded P2P session.

According to one exemplary aspect illustrates an exemplary signaling flow in which an application server may mediate offloading communication between two or more endpoints from a network infrastructure to a direct P2P connection. More particularly in the exemplary signaling flow shown in the application server may mediate various functions to control whether a caller UE and a called UE should communicate over the network infrastructure or communicate with one another over a direct P2P connection wherein the mediated functions may include authentication and authorization media and signaling plane control accounting control and or handling lawful intercept requests among other things. Accordingly having the application server mediate whether to offload communication from the network infrastructure to direct P2P connections may allow an operator associated with the network infrastructure and end users e.g. the caller UE the called UE etc. to realize various benefits from using different P2P technologies to offload communication that involves certain services that the operator may otherwise offer over the network infrastructure e.g. Voice over Internet Protocol VoIP sessions Voice over LTE VoLTE sessions Push to Talk PTT sessions group communication sessions sessions that involve Rich Communication Services RCS sessions social networking services etc. .

In one embodiment the signaling flow shown in may generally operate in a context where client endpoints e.g. caller UE called UE etc. report locations associated therewith to the application server over the network infrastructure. For example in one embodiment the locations reported to the application server may comprise coarse location information that estimates the location associated with the caller UE the called UE etc. according to a rough accuracy e.g. within approximately 10 meters based on Wi Fi measurements cellular measurements and other data available to the client endpoints. In another example the reported locations may comprise precise location information obtained from GPS measurements or other data sources that can estimate the location associated with the caller UE the called UE etc. according to a fine grained accuracy e.g. within a few meters or less . Accordingly at and the caller UE and the called UE may each report a location associated therewith to the application server in a dynamic periodic and or event triggered manner. For example in one embodiment the caller UE and the called UE may report the locations associated therewith to the application server at periodic intervals e.g. every few minutes according to dynamic criteria e.g. in response to estimating a change in the location that exceeds a threshold distance in response to a handover from one base station to another etc. and or according to event triggered criteria e.g. during an initial network registration procedure browsing a location dependent calendar entry etc. . As such the application server may generally know coarse or precise locations associated with the caller UE and the called UE from the location reports received at and and furthermore the location reports received at and may provide the application server with contextual knowledge about the locations and or communication intent associated with the caller UE and the called UE in certain circumstances e.g. where an event triggered location report indicates that the caller UE was browsing a calendar entry that involves a meeting with the called UE or that the caller UE was browsing a chat log with the called UE the application server may infer that the caller UE intends to communicate with the called UE .

In one embodiment at the application server may receive a call request from the caller UE at some point in time subsequent to receiving the one or more location reports at and wherein the call request may indicate an intent to initiate a call with Bob i.e. the end user associated with called UE and include P2P information associated with the caller UE . For example the P2P information that the caller UE includes in the call request received at may include a P2P identifier associated therewith e.g. a Universally Unique Identifier UUID a Globally Unique Identifier GUID etc. P2P status information e.g. P2P interfaces supported on the caller UE operating status indicating whether P2P power saving P2P discovery and supported P2P interfaces etc. are turned ON or OFF and a coarse or precise location update associated with the caller UE . For example as shown in the call request transmitted at may indicate that the caller UE has P2P power saving turned ON P2P discovery turned OFF and P2P interfaces turned OFF. Furthermore in one embodiment the P2P information received at may include resource status information associated with the caller UE e.g. available battery processor speed link speeds or other interface capabilities etc. . In one embodiment at the application server may then determine whether any P2P information has been received from the called UE and if so further check whether the P2P information was received within a certain time period. Accordingly at the application server may query the latest P2P status from the called UE in response to determining that P2P information has not been received from the called UE or alternatively that the latest P2P information from the called UE was not received within the time period and is therefore considered stale. At the called UE may then return the latest P2P status associated therewith to the application server wherein the latest P2P status associated with the called UE may similarly include a P2P identifier P2P operating status a coarse or precise location update and resource status information associated with the called UE . On the other hand in response to determining that P2P information has been received from the called UE within the time period the application server may not have any need to query the latest P2P status from the called UE in which case the messages exchanged at and may be omitted from the signaling flow.

In either case at the application server may know the latest P2P status associated with the caller UE and the called UE such that the application server may then ascertain whether the call that was requested can be offloaded from the network infrastructure to a direct P2P connection. In particular at the application server may estimate a distance between the caller UE and the called UE according to the most recent coarse or precise locations that were reported to the application server and further determine whether the estimated distance falls within a range associated with one or more supported P2P interfaces on the caller UE and the called UE . For example Wi Fi Direct generally allows device to device connectivity within approximately 100 meters or less whereas LTE Direct has a range up to approximately 500 meters and Bluetooth has an approximately 10 meter range. Accordingly the application server may ascertain whether or not offloading the call to a direct P2P connection may be possible based at least on the estimated distances between the caller UE and the called UE and the supported P2P interfaces on the caller UE and the called UE . For example in a scenario where the caller UE and the called UE are more than approximately 100 meters apart and less than approximately 500 meters apart P2P offloading may only be possible if the caller UE and the called UE each support LTE Direct. In another example where the caller UE and the called UE each lack P2P interfaces that support Wi Fi Direct and each have P2P interfaces that support LTE Direct any P2P offloading would similarly have to employ LTE Direct i.e. even if the caller UE and the called UE are less than 100 meters apart because neither supports Wi Fi Direct . In still another example where the caller UE and the called UE are approximately 50 meters apart each have a P2P interface that supports LTE Direct and one or the other have a P2P interface that supports Wi Fi Direct P2P offloading may be possible over both LTE Direct and Wi Fi Direct because Wi Fi Direct devices can form groups with legacy Wi Fi devices that do not have Wi Fi Direct support. As such in the use cases where P2P offloading may be possible using more than one P2P technology e.g. LTE Direct and Wi Fi Direct the particular P2P technology to use in the offloaded communication may be selected depending on end user preferences device specific preferences operator preferences and or other suitable criteria e.g. end users may prefer to use Wi Fi Direct to communicate faster or more efficiently than may be possible with LTE Direct or avoid incurring charges against a cellular data plan whereas an operator may prefer LTE Direct in order to collect data plan charges while a device may configure a default preference to use LTE Direct to preserve battery life or a dynamic preference to use LTE Direct when available battery drops below a threshold because LTE Direct offers substantial power savings relative to Wi Fi Direct etc. .

Accordingly in response to determining that the requested call can be offloaded from the network infrastructure to a direct P2P connection the application server may declare the appropriate parameters associated with the direct P2P connection e.g. the selected P2P technology and instruct the caller UE and the called UE to offload the call to the direct P2P connection according to the declared parameters. For example the declared P2P parameters may include at least the P2P interface that the caller UE and the called UE should use to communicate over the direct connection which may depend on the estimated distance between the caller UE and the called UE the P2P interfaces that are supported on the caller UE and or the called UE and resource status information associated with the caller UE and the called UE in addition to any applicable user preferences device specific preferences and or operator preferences. Furthermore in one embodiment the declared P2P parameters may include billing criteria associated with the offloaded P2P call based on the locations associated with the caller UE and the called UE and the P2P interfaces to be used and encryption keys that can be used to protect private communication and a time to live TTL associated with the encryption keys and or other suitable parameters. Accordingly at the caller UE and the called UE may establish a direct P2P connection according to the parameters that the application server declared and therefore communicate in a manner that bypasses the network infrastructure and at and periodically report statistics associated with the call to the application server which may maintain connectivity in parallel and periodically check whether to allow the P2P offloading to continue or terminate the P2P offloading and move to a server hosted call over the network infrastructure e.g. in response to the call quality failing to satisfy one or more performance metrics the call exceeding a cost per minute metric or other cost constraint the estimated distance between the caller UE and the called UE exceeding the maximum range associated with the P2P interfaces supported thereon a lawful intercept request etc. .

According to one exemplary aspect illustrates an exemplary method that the application server may perform to determine whether to offload communication between endpoints from a network infrastructure to a P2P connection and mediate the communication over the network infrastructure and the P2P connection. In particular as described in further detail above one or more wireless devices may initially report coarse or precise locations associated therewith to the application server over a network infrastructure in a dynamic periodic and or event triggered manner whereby the application server may generally know at least coarse or precise locations associated with the wireless devices from the received location reports. Furthermore in one embodiment the location reports received from the one or more wireless devices may include contextual information that may indicate a communication intent associated with the wireless devices e.g. where an event triggered location report indicates that a wireless device was browsing a calendar entry that involves a meeting with another wireless device . Accordingly at block the application server may receive a call request from a caller wireless device at some point in time wherein the call request may indicate an intent to communicate with another wireless device and include P2P information associated with the caller wireless device. Alternatively in certain circumstances the application server may predict that the caller wireless device will originate the call with the caller wireless device at block prior to and or without receiving the call request based on the contextual information provided in the location reports received therefrom in which case the prediction that that the caller wireless device will originate the call with the caller wireless device may trigger the process in which the application server determines whether the call can be offloaded from the network infrastructure.

In one embodiment at block the application server may then determine locations P2P capabilities and P2P preferences associated with the caller wireless device and the called wireless device. For example the call request received at block may include a P2P identifier the P2P capabilities and the P2P preferences associated with the caller wireless device in which case the location P2P capabilities and P2P preferences associated with the caller wireless device may be determined from the call request. Alternatively in the circumstances where the application server predicts that the caller wireless device will originate the call with the caller wireless device prior to and or without receiving a call request the application server may determine whether the most recent report from the caller wireless device that included the location P2P capabilities and P2P preference information associated therewith was received within a certain time period in which case the location P2P capabilities and P2P preferences associated with the caller wireless device may be determined from the most recent report provided from the caller wireless device. In a similar respect the application server may determine the location P2P capabilities and P2P preferences associated with the called wireless device from the most recent report provided from the caller wireless device in response to determining that the most recent report was received within the defined time period. Otherwise the application server may query the caller wireless device and or the called wireless device at block to obtain the latest P2P status from the caller wireless device and or the called wireless device.

Accordingly at block the application server may know the latest locations P2P capabilities and P2P preferences associated with the caller wireless device and the called wireless device and then determine whether communication between the caller wireless device and the called wireless device can be offloaded from the network infrastructure to a direct P2P connection. In particular at block the application server may estimate the distance between the wireless devices according to the most recent coarse or precise locations reported to the application server and further determine whether the estimated distance falls within a range associated with one or more supported P2P interfaces associated with the wireless devices. As such the application server may determine whether the wireless devices have one or more interfaces that can support P2P communication over the estimated distance between the wireless devices and if so the application server may further determine whether available resources and preferences permit P2P communication e.g. based on link speeds available battery etc. . In response to determining that the call cannot be offloaded to a direct P2P connection e.g. because the distance between the wireless devices exceeds the maximum range associated with the supported P2P interfaces the application server may then handle the call over the network infrastructure and bill the call accordingly at block . However the application server may continue to receive dynamic periodic and or event triggered updates from the wireless devices at block and check whether the call can be subsequently offloaded to a direct P2P connection based thereon e.g. based on whether the wireless devices move to within the maximum range associated with the supported P2P interfaces .

In one embodiment in response to block resulting in a determination that the call can be offloaded to a direct P2P connection the application server may declare the appropriate parameters associated with the direct P2P connection and instruct the caller wireless device and the called wireless device to offload communicate over a P2P connection according to the declared parameters at block . For example the declared P2P parameters may include at least the P2P interface that the caller wireless device and the called wireless device should use to communicate over the direct connection which may depend on the estimated distance between the caller wireless device and the called wireless device the P2P interfaces that are supported on the caller wireless device and the called wireless device and resource status information associated with the caller wireless device and the called wireless device in addition to any applicable preferences. Furthermore in one embodiment the declared P2P parameters may include billing criteria associated with the offloaded P2P call wherein the billing criteria may depend on the locations associated with the wireless devices and the P2P interfaces to be used and the declared P2P parameters may further include encryption keys that can be used to protect the communication between the wireless devices.

Accordingly at block the application server may continue to receive dynamic periodic and or event triggered updates from the wireless devices in the manner described above except that the updates received at block may further include statistics associated with the P2P offloaded call. In one embodiment the application server may then determine whether the P2P offloaded call has terminated at block in which case the application server may process accounting associated with the call at block according to the P2P statistics and or network usage metrics e.g. minutes that involved cellular data usage . Otherwise in response to determining that the P2P offloaded call has not ended the application server may determine whether to terminate the P2P offloading at block . For example the application server may generally maintain connectivity with the caller and the called wireless devices in parallel and periodically check whether to allow the P2P offloading to continue or move to a server hosted call over the network infrastructure which may occur in response to degraded call quality in response to the call exceeding a cost per minute metric in response to the estimated distance between the caller wireless device and the called wireless device exceeding the maximum range associated with the supported P2P interfaces in response to receiving a lawful intercept request or based on other suitable conditions. In one embodiment in response to determining that the P2P offloading should be offloaded the method may return to block where the application server may handle the call over the network infrastructure. Otherwise the application server may allow the P2P offloading to continue and periodically check whether the call has ended and or whether to move to a server hosted call in the manner described above.

According to one exemplary aspect illustrates an exemplary method that the application server may perform to determine whether communication between two or more wireless devices can be offloaded from a network infrastructure to a P2P connection wherein the method shown in may provide further detail relating to block in . More particularly in response to appropriately determining locations P2P capabilities and P2P preferences associated with a caller wireless device and a called wireless device at block the application server may determine whether an estimated distance between the wireless devices falls within the maximum range associated with one or more P2P interfaces that the caller wireless device and the called wireless device each support. For example if either the caller wireless device or the called wireless device support Wi Fi Direct the wireless devices may be within sufficient range to communicate over a direct P2P connection if the estimated distance between the wireless devices is approximately 100 meters or less because only one Wi Fi Direct device may be needed to form a P2P communication group. Furthermore if the caller wireless device and the called wireless device each support LTE Direct the wireless devices may be within sufficient range to communicate over a direct P2P connection if the estimated distance between the wireless devices is approximately 500 meters or less. Accordingly the application server may make a threshold determination as to whether communication between the caller wireless device and the called wireless device can be offloaded to a direct P2P connection based on the estimated distance between the wireless devices and the P2P interfaces supported thereon wherein the call may be handled over the network infrastructure at block if the distance between the wireless devices exceeds the maximum range associated with the supported P2P interfaces associated with the wireless devices e.g. if the estimated distance exceeds approximately 500 meters the estimated distance exceeds approximately 100 meters and at least one wireless device does not support LTE Direct etc. .

However in the event that the estimated distance between the wireless devices falls within the maximum range associated with the P2P interfaces that the wireless devices support the application server may then determine whether sufficient resources to support P2P communication are available at block . For example the resources considered at block may comprise available battery life link speed processor speed or other suitable resources e.g. available minutes in a cellular data plan to the extent that P2P offloading over LTE Direct may be possible . In response to determining that the caller wireless device and the called wireless device each have sufficient resources to communicate over a direct P2P connection the application server may then determine whether any applicable user device specific and or operator preferences permit P2P offloading and or whether any such preferences should be used to control the specific P2P interface that the wireless devices should use to establish the direct connection. For example as described in further detail above end users may prefer to use Wi Fi Direct to communicate faster or more efficiently than may be possible with LTE Direct or to avoid incurring charges against a cellular data plan whereas an operator may prefer LTE Direct in order to collect data plan charges. In another example a device may configure a default preference to use LTE Direct to preserve battery life or a dynamic preference to use LTE Direct when available battery drops below a threshold because LTE Direct offers substantial power savings relative to Wi Fi Direct. In still another example an operator preference may prohibit P2P offloading when a lawful intercept request has been received from appropriate authorities. At block any applicable user device specific and or operator preferences may therefore be consulted to determine whether P2P offloading is permitted and or the parameters that should be used in the P2P offloading if permitted.

Accordingly in response to determining that the estimated distance between the wireless devices falls within the maximum range associated with the P2P interfaces supported on the wireless devices and further determining that the wireless devices have sufficient resources to communicate P2P and applicable user device specific and or operator preferences permit P2P offloading the application server may then instruct the caller wireless device and the called wireless device to activate the appropriate P2P interfaces and communicate over a direct P2P connection. Otherwise the application server may handle the call over the network infrastructure at block if the distance between the wireless devices falls outside the maximum range associated with any supported P2P interfaces the caller wireless device and or the called wireless device lack sufficient resources to communicate over a direct P2P connection or if any applicable user device specific and or operator preferences do not permit P2P offloading.

According to one exemplary aspect illustrates an exemplary method A that the application server may perform to determine whether to terminate P2P offloading based on one or more performance and or billing metrics associated with a P2P connection wherein the method A shown in may provide further detail relating to block in . More particularly subsequent to instructing a caller wireless device and a called wireless device to establish a direct P2P connection the application server may receive periodic statistics and or other reports from the wireless devices at block . As such the application server may maintain connectivity with the wireless devices communicating over the direct P2P connection and monitor performance metrics and or billing metrics associated with the P2P offloaded call to determine whether or not to terminate the P2P offloading. For example in one embodiment the application server may determine whether quality associated with the P2P call has degraded or will likely degrade at block wherein the determination made at block may depend on measurement reports received from the wireless devices available link speeds or other resources changes in the locations associated with the wireless devices or other suitable criteria that may indicate the performance associated with the call. In particular the quality associated with the P2P offloaded call may generally depend on performance metrics that are based on the network connection between the caller and the called wireless device whereby the reports received from the caller and the called wireless device may be analyzed to monitor the performance metrics associated with the call. For example in various embodiments and or use cases the performance metrics may comprise a maximum jitter e.g. variations in the delay at which packets are received a maximum latency e.g. the time that packets take to travel from one wireless device to another a maximum packet loss e.g. a lost packet percentage and or other suitable performance metrics e.g. a R Factor quality rating derived from the jitter latency packet loss and or other metrics to produce a value that typically falls in a range between 50 100 a Mean Opinion Score MOS that measures subjective call quality in a scale from 1 to 5 based on ITU T Recommendation P.800 etc. .

Furthermore in one embodiment the application server may evaluate any changes in the locations and or the P2P capabilities and preferences that control the P2P offloading at block in a substantially similar manner to how the application server initially determines whether the call can be offloaded from the network infrastructure as described in further detail above. For example if the caller and the called wireless devices were initially determined to be less than 100 meters apart and therefore instructed to establish a Wi Fi Direct connection and the caller and or the called wireless device change locations such that the estimated distance falls in a range between 100 500 meters the application server may terminate the P2P offloading if either or both wireless devices do not have P2P interfaces that support LTE Direct or if any applicable preferences do not permit changing the P2P connection to LTE Direct even if both wireless devices support LTE Direct. In another example if the reports received from the caller and or the called wireless device indicate that one or the another has a low battery the P2P offloading may be determined if communicating over the network infrastructure would consume less power.

Accordingly in response to determining that the call quality has degraded or will likely degrade soon at block e.g. based on the monitored performance metrics changes in the locations P2P capabilities preferences and or other criteria that control the P2P offloading etc. the application server may terminate the P2P offloading and handle the call over the network infrastructure at block . Otherwise in response to determining that the call quality has not degraded and will likely continue satisfy the criteria that control the P2P offloading the application server may determine whether any applicable cost metrics have been exceeded at block . For example in one embodiment the cost metrics may specify a maximum cost per minute a maximum total cost or another suitable constraint that may limit the amount that the wireless devices will be charged to communicate over the direct P2P connection which may generally be greater when using LTE Direct because the call may be charges against a cellular data plan whereas devices communicating over Wi Fi Direct may have a smaller administration overhead because the devices can connect to one another without requiring a wireless access point.

As such in response to determining that any applicable cost thresholds have been exceeded the application server may terminate the P2P offloading and handle the call over the network infrastructure at block . Alternatively in response to determining that the call quality has not degraded and that any applicable cost thresholds have not been exceeded the application server may allow the P2P offloading to continue at block wherein the method A may then return to block to monitor the performance metrics and billing metrics associated with the offloaded P2P call based on periodic reports received from the wireless devices and or other suitable criteria.

For example according to one exemplary aspect illustrates another exemplary method B that the application server may perform to determine whether to terminate P2P offloading wherein the criteria used therein to trigger terminating the P2P offloading may include a lawful intercept request rather than performance and or billing metrics. In particular various nations and localities have passed laws and regulations requiring network operators and telecommunications equipment manufacturers to configure equipment facilities and services in a manner that may allow law enforcement agencies to conduct surveillance to monitor telephone broadband and VoIP traffic in real time. For example in the United States the Communications Assistance for Law Enforcement Act CALEA specifies requirements to add CALEA compliant interfaces to telecommunications equipment and the European Union has accepted a resolution mandating similar measures to CALEA.

Accordingly in response to receiving a lawful intercept request at block the application server may then initiate appropriate procedures to comply with the lawful intercept request. In particular under CALEA a lawful intercept request must generally identify a subscriber named in an intercept warrant whereby the application server may determine whether the lawful intercept request received at block identifies the subscriber associated with at least one wireless device engaged in the P2P offloaded communication. In the affirmative the application server may then find a local law enforcement proxy e.g. a CALEA proxy in sufficient proximity to eavesdrop on the offloaded communication. More particularly at block the application server may transmit the encryption keys and any other appropriate P2P session parameters associated with the offloaded P2P communication to the local law enforcement proxy and thereby enable the local law enforcement proxy to snoop on the P2P offloaded traffic. For example in one embodiment the local law enforcement proxy may operate as a session border controller SBC or other relay node between the P2P parties such that the law enforcement proxy may snoop on the P2P offloaded traffic that passes through the SBC or other relay node. In another example the local law enforcement proxy may query the P2P parties to receive intermittent reports that can be analyzed to conduct the appropriate surveillance. Furthermore in one embodiment the lawful intercept request may specify a catchword or other triggering conditions to terminate the P2P offloading and move to a server hosted call. Accordingly at block the application server may further send appropriate instructions to trigger terminating the P2P offloading to the wireless devices communicating over the direct P2P connection typically in a manner that the end users cannot detect so as to not make the end users aware of the fact that the communication is subject to surveillance .

In one embodiment the application server may optionally further terminate the P2P offloading according to the criteria in the lawful intercept request at block . For example the law enforcement agency may express a preference to have the call routed over the network infrastructure to avoid the need to intervene in what the end users may believe to be a private P2P communication and thereby raise suspicions that surveillance may be ongoing. In another example the P2P offloading may be terminated in response to the calling parties speaking the catchword that was specified to trigger moving to a server hosted call. In the event that the application server terminates the P2P offloading at block the application server may further employ any appropriate measures that may be needed to comply with the lawful intercept request e.g. sending the intermittent reports from the calling parties some or all content exchanged between the parties etc. to the law enforcement agency .

While internal components of UEs such as the UEs A and B can be embodied with different hardware configurations a basic high level UE configuration for internal hardware components is shown as platform in . The platform can receive and execute software applications data and or commands transmitted from the RAN that may ultimately come from the core network the Internet and or other remote servers and networks e.g. application server web URLs etc. . The platform can also independently execute locally stored applications without RAN interaction. The platform can include a transceiver operably coupled to an application specific integrated circuit ASIC or other processor microprocessor logic circuit or other data processing device. The ASIC or other processor executes the application programming interface API layer that interfaces with any resident programs in the memory of the wireless device. The memory can be comprised of read only or random access memory RAM and ROM EEPROM flash cards or any memory common to computer platforms. The platform also can include a local database that can store applications not actively used in memory as well as other data. The local database is typically a flash memory cell but can be any secondary storage device as known in the art such as magnetic media EEPROM optical media tape soft or hard disk or the like.

Accordingly one embodiment disclosed herein can include a UE e.g. UE A B etc. including the ability to perform the functions described herein. As will be appreciated by those skilled in the art the various logic elements can be embodied in discrete elements software modules executed on a processor or any combination of software and hardware to achieve the functionality disclosed herein. For example ASIC memory API and local database may all be used cooperatively to load store and execute the various functions disclosed herein and thus the logic to perform these functions may be distributed over various elements. Alternatively the functionality could be incorporated into one discrete component. Therefore the features of the UEs A and B in are to be considered merely illustrative and the disclosure is not limited to the illustrated features or arrangement.

The wireless communication between the UEs A and or B and the RAN can be based on different technologies such as CDMA W CDMA time division multiple access TDMA frequency division multiple access FDMA Orthogonal Frequency Division Multiplexing OFDM GSM or other protocols that may be used in a wireless communications network or a data communications network. As discussed in the foregoing and known in the art voice transmission and or data can be transmitted to the UEs from the RAN using a variety of networks and configurations. Accordingly the illustrations provided herein are not intended to limit the embodiments disclosed herein and are merely to aid in describing aspects of the embodiments disclosed herein.

Referring to the communication device includes logic configured to receive and or transmit information . In an example if the communication device corresponds to a wireless communications device e.g. UE A or B one of BSs A through A one of Node Bs B through B one of eNodeBs D through D etc. the logic configured to receive and or transmit information can include a wireless communications interface e.g. Bluetooth Wi Fi 2G CDMA W CDMA 3G 4G LTE etc. such as a wireless transceiver and associated hardware e.g. an RF antenna a MODEM a modulator and or demodulator etc. . In another example the logic configured to receive and or transmit information can correspond to a wired communications interface e.g. a serial connection a USB or Firewire connection an Ethernet connection through which the Internet can be accessed etc. . Thus if the communication device corresponds to some type of network based server e.g. PDSN SGSN GGSN S GW P GW MME HSS PCRF the application etc. the logic configured to receive and or transmit information can correspond to an Ethernet card in an example that connects the network based server to other communication entities via an Ethernet protocol. In a further example the logic configured to receive and or transmit information can include sensory or measurement hardware by which the communication device can monitor its local environment e.g. an accelerometer a temperature sensor a light sensor an antenna for monitoring local RF signals etc. . The logic configured to receive and or transmit information can also include software that when executed permits the associated hardware of the logic configured to receive and or transmit information to perform its reception and or transmission function s . However the logic configured to receive and or transmit information does not correspond to software alone and the logic configured to receive and or transmit information relies at least in part upon hardware to achieve its functionality.

Referring to the communication device further includes logic configured to process information . In an example the logic configured to process information can include at least a processor. Example implementations of the type of processing that can be performed by the logic configured to process information includes but is not limited to performing determinations establishing connections making selections between different information options performing evaluations related to data interacting with sensors coupled to the communication device to perform measurement operations converting information from one format to another e.g. between different protocols such as .wmv to .avi etc. and so on. For example the processor included in the logic configured to process information can correspond to a general purpose processor a digital signal processor DSP an ASIC a field programmable gate array FPGA or other programmable logic device discrete gate or transistor logic discrete hardware components or any combination thereof designed to perform the functions described herein. A general purpose processor may be a microprocessor but in the alternative the processor may be any conventional processor controller microcontroller or state machine. A processor may also be implemented as a combination of computing devices e.g. a combination of a DSP and a microprocessor a plurality of microprocessors one or more microprocessors in conjunction with a DSP core or any other such configuration. The logic configured to process information can also include software that when executed permits the associated hardware of the logic configured to process information to perform its processing function s . However the logic configured to process information does not correspond to software alone and the logic configured to process information relies at least in part upon hardware to achieve its functionality.

Referring to the communication device further includes logic configured to store information . In an example the logic configured to store information can include at least a non transitory memory and associated hardware e.g. a memory controller etc. . For example the non transitory memory included in the logic configured to store information can correspond to RAM memory flash memory ROM memory EPROM memory EEPROM memory registers hard disk a removable disk a CD ROM or any other form of storage medium known in the art. The logic configured to store information can also include software that when executed permits the associated hardware of the logic configured to store information to perform its storage function s . However the logic configured to store information does not correspond to software alone and the logic configured to store information relies at least in part upon hardware to achieve its functionality.

Referring to the communication device further optionally includes logic configured to present information . In an example the logic configured to present information can include at least an output device and associated hardware. For example the output device can include a video output device e.g. a display screen a port that can carry video information such as USB HDMI etc. an audio output device e.g. speakers a port that can carry audio information such as a microphone jack USB HDMI etc. a vibration device and or any other device by which information can be formatted for output or actually outputted by a user or operator of the communication device . For example if the communication device corresponds to UE A or UE B as shown in the logic configured to present information can include the display A of UE A or the touchscreen display B of UE B. In a further example the logic configured to present information can be omitted for certain communication devices such as network communication devices that do not have a local user e.g. network switches or routers remote servers etc. . The logic configured to present information can also include software that when executed permits the associated hardware of the logic configured to present information to perform its presentation function s . However the logic configured to present information does not correspond to software alone and the logic configured to present information relies at least in part upon hardware to achieve its functionality.

Referring to the communication device further optionally includes logic configured to receive local user input . In an example the logic configured to receive local user input can include at least a user input device and associated hardware. For example the user input device can include buttons a touchscreen display a keyboard a camera an audio input device e.g. a microphone or a port that can carry audio information such as a microphone jack etc. and or any other device by which information can be received from a user or operator of the communication device . For example if the communication device corresponds to UE A or UE B as shown in the logic configured to receive local user input can include the keypad A any of the buttons A or B through B the touchscreen display B etc. In a further example the logic configured to receive local user input can be omitted for certain communication devices such as network communication devices that do not have a local user e.g. network switches or routers remote servers etc. . The logic configured to receive local user input can also include software that when executed permits the associated hardware of the logic configured to receive local user input to perform its input reception function s . However the logic configured to receive local user input does not correspond to software alone and the logic configured to receive local user input relies at least in part upon hardware to achieve its functionality.

Referring to while the configured logics of through are shown as separate or distinct blocks in it will be appreciated that the hardware and or software by which the respective configured logic performs its functionality can overlap in part. For example any software used to facilitate the functionality of the configured logics of through can be stored in the non transitory memory associated with the logic configured to store information such that the configured logics of through each performs their functionality i.e. in this case software execution based in part upon the operation of software stored by the logic configured to store information . Likewise hardware that is directly associated with one of the configured logics can be borrowed or used by other configured logics from time to time. For example the processor of the logic configured to process information can format data into an appropriate format before being transmitted by the logic configured to receive and or transmit information such that the logic configured to receive and or transmit information performs its functionality i.e. in this case transmission of data based in part upon the operation of hardware i.e. the processor associated with the logic configured to process information .

Generally unless stated otherwise explicitly the phrase logic configured to as used throughout this disclosure is intended to invoke an embodiment that is at least partially implemented with hardware and is not intended to map to software only implementations that are independent of hardware. Also it will be appreciated that the configured logic or logic configured to in the various blocks are not limited to specific logic gates or elements but generally refer to the ability to perform the functionality described herein either via hardware or a combination of hardware and software . Thus the configured logics or logic configured to as illustrated in the various blocks are not necessarily implemented as logic gates or logic elements despite sharing the word logic. Other interactions or cooperation between the logic in the various blocks will become clear to those skilled in the art from a review of the embodiments described above in more detail.

The various embodiments disclosed herein may be implemented on any of a variety of commercially available server devices such as server illustrated in . In an example the server may correspond to one example configuration of the application server described above. In the server includes a processor coupled to volatile memory and a large capacity nonvolatile memory such as a disk drive . The server may also include a floppy disc drive compact disc CD or DVD disc drive coupled to the processor . The server may also include network access ports coupled to the processor for establishing data connections with a network such as a local area network coupled to other broadcast system computers and servers or to the Internet. In context with it will be appreciated that the server of illustrates one example implementation of the communication device whereby the logic configured to transmit and or receive information may correspond to the network access points used by the server to communicate with the network the logic configured to process information may correspond to the processor and the logic configuration to store information may correspond to any combination of the volatile memory the disk drive and or the disc drive . The optional logic configured to present information and the optional logic configured to receive local user input are not shown explicitly in and may or may not be included therein. Thus helps to demonstrate that the communication device described above in connection with may be implemented as a server in addition to a UE implementation such as the UE A or B shown in .

Those skilled in the art will appreciate that information and signals may be represented using any of a variety of different technologies and techniques. For example data instructions commands information signals bits symbols and chips that may be referenced throughout the above description may be represented by voltages currents electromagnetic waves magnetic fields or particles optical fields or particles or any combination thereof.

Further those skilled in the art will appreciate that the various illustrative logical blocks modules circuits and algorithm steps described in connection with the aspects disclosed herein may be implemented as electronic hardware computer software or combinations of both. To clearly illustrate this interchangeability of hardware and software various illustrative components blocks modules circuits and steps have been described above generally in terms of their functionality. Whether such functionality is implemented as hardware or software depends upon the particular application and design constraints imposed on the overall system. Skilled artisans may implement the described functionality in varying ways for each particular application but such implementation decisions should not be interpreted to depart from the scope of the present disclosure.

The various illustrative logical blocks modules and circuits described in connection with the aspects disclosed herein may be implemented or performed with a general purpose processor a digital signal processor DSP an application specific integrated circuit ASIC a field programmable gate array FPGA or other programmable logic device discrete gate or transistor logic discrete hardware components or any combination thereof designed to perform the functions described herein. A general purpose processor may be a microprocessor but in the alternative the processor may be any conventional processor controller microcontroller or state machine. A processor may also be implemented as a combination of computing devices e.g. a combination of a DSP and a microprocessor a plurality of microprocessors one or more microprocessors in conjunction with a DSP core or any other such configuration .

The methods sequences and or algorithms described in connection with the aspects disclosed herein may be embodied directly in hardware in a software module executed by a processor or in a combination of the two. A software module may reside in RAM flash memory ROM EPROM EEPROM registers hard disk a removable disk a CD ROM or any other form of storage medium known in the art. An exemplary storage medium is coupled to the processor such that the processor can read information from and write information to the storage medium. In the alternative the storage medium may be integral to the processor. The processor and the storage medium may reside in an ASIC. The ASIC may reside in an IoT device. In the alternative the processor and the storage medium may reside as discrete components in a user terminal.

In one or more exemplary aspects the functions described may be implemented in hardware software firmware or any combination thereof. If implemented in software the functions may be stored on or transmitted over as one or more instructions or code on a computer readable medium. Computer readable media includes both computer storage media and communication media including any medium that facilitates transfer of a computer program from one place to another. A storage media may be any available media that can be accessed by a computer. By way of example and not limitation such computer readable media can comprise RAM ROM EEPROM CD ROM or other optical disk storage magnetic disk storage or other magnetic storage devices or any other medium that can be used to carry or store desired program code in the form of instructions or data structures and that can be accessed by a computer. Also any connection is properly termed a computer readable medium. For example if the software is transmitted from a website server or other remote source using a coaxial cable fiber optic cable twisted pair DSL or wireless technologies such as infrared radio and microwave then the coaxial cable fiber optic cable twisted pair DSL or wireless technologies such as infrared radio and microwave are included in the definition of medium. Disk and disc as used herein includes CD laser disc optical disc DVD floppy disk and Blu ray disc where disks usually reproduce data magnetically and or optically with lasers. Combinations of the above should also be included within the scope of computer readable media.

While the foregoing disclosure shows illustrative aspects of the disclosure it should be noted that various changes and modifications could be made herein without departing from the scope of the disclosure as defined by the appended claims. The functions steps and or actions of the method claims in accordance with the aspects of the disclosure described herein need not be performed in any particular order. Furthermore although elements of the disclosure may be described or claimed in the singular the plural is contemplated unless limitation to the singular is explicitly stated.

