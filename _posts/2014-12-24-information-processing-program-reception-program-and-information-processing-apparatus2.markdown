---

title: Information processing program, reception program, and information processing apparatus
abstract: An information processing program causes a computer to execute: encoding information to be transmitted, to determine a luminance change frequency; and outputting a signal of the determined luminance change frequency to cause a light emitter to change in luminance according to the determined luminance change frequency to transmit the information. In the encoding, each of a first frequency and a second frequency different from the first frequency is determined as the luminance change frequency. In the outputting, each of a signal of the first frequency and a signal of the second frequency is output as the signal of the determined luminance change frequency, to cause the light emitter to change in luminance according to the first frequency during a first time and change in luminance according to the second frequency during a second time different from the first time after the first time elapses.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09608725&OS=09608725&RS=09608725
owner: PANASONIC INTELLECTUAL PROPERTY CORPORATION OF AMERICA
number: 09608725
owner_city: Torrance
owner_country: US
publication_date: 20141224
---
The present application claims the benefit of U.S. Provisional Patent Application No. 62 019 515 filed on Jul. 1 2014 U.S. Provisional Patent Application No. 62 028 991 filed on Jul. 25 2014 Japanese Patent Application No. 2014 192032 filed on Sep. 19 2014 and Japanese Patent Application No. 2014 232187 filed on Nov. 14 2014 is a continuation in part of U.S. Non Provisional patent application Ser. No. 14 142 413 filed on Dec. 27 2013 which claims benefit of U.S. Provisional Patent Application No. 61 904 611 filed on Nov. 15 2013 U.S. Provisional Patent Application No. 61 896 879 filed on Oct. 29 2013 U.S. Provisional Patent Application No. 61 895 615 filed on Oct. 25 2013 U.S. Provisional Patent Application No. 61 872 028 filed on Aug. 30 2013 U.S. Provisional Patent Application No. 61 859 902 filed on Jul. 30 2013 U.S. Provisional Patent Application No. 61 810 291 filed on Apr. 10 2013 U.S. Provisional Patent Application No. 61 805 978 filed on Mar. 28 2013 U.S. Provisional Patent Application No. 61 746 315 filed on Dec. 27 2012 Japanese Patent Application No. 2013 242407 filed on Nov. 22 2013 Japanese Patent Application No. 2013 237460 filed on Nov. 15 2013 Japanese Patent Application No. 2013 224805 filed on Oct. 29 2013 Japanese Patent Application No. 2013 222827 filed on Oct. 25 2013 Japanese Patent Application No. 2013 180729 filed on Aug. 30 2013 Japanese Patent Application No. 2013 158359 filed on Jul. 30 2013 Japanese Patent Application No. 2013 110445 filed on May 24 2013 Japanese Patent Application No. 2013 082546 filed on Apr. 10 2013 Japanese Patent Application No. 2013 070740 filed on Mar. 28 2013 and Japanese Patent Application No. 2012 286339 filed on Dec. 27 2012. The entire disclosures of the above identified applications including the specifications drawings and claims are incorporated herein by reference in their entirety.

The present disclosure relates to a method of communication between a mobile terminal such as a smartphone a tablet terminal or a mobile phone and a home electric appliance such as an air conditioner a lighting device or a rice cooker.

In recent years a home electric appliance cooperation function has been introduced for a home network with which various home electric appliances are connected to a network by a home energy management system HEMS having a function of managing power usage for addressing an environmental issue turning power on off from outside a house and the like in addition to cooperation of AV home electric appliances by internet protocol IP connection using Ethernet or wireless local area network LAN . However there are home electric appliances whose computational performance is insufficient to have a communication function and home electric appliances which do not have a communication function due to a matter of cost.

In order to solve such a problem Patent Literature PTL discloses a technique of efficiently establishing communication between devices among limited optical spatial transmission devices which transmit information to a free space using light by performing communication using plural single color light sources of illumination light.

However the conventional method is limited to a case in which a device to which the method is applied has three color light sources such as an illuminator. One non limiting and exemplary embodiment provides an information processing program or a reception program that solves this problem and enables communication between various devices including a device with low computational performance.

An information processing program according to an aspect of the present disclosure is an information processing program for causing a computer to process information to be transmitted in order for the information to be transmitted by way of luminance change and causes the computer to execute encoding the information to determine a luminance change frequency and outputting a signal of the luminance change frequency determined to cause a light emitter to change in luminance according to the luminance change frequency determined to transmit the information wherein in the encoding each of a first frequency and a second frequency different from the first frequency is determined as the luminance change frequency and in the outputting each of a signal of the first frequency and a signal of the second frequency is output as the signal of the luminance change frequency determined to cause the light emitter to change in luminance according to the first frequency during a first time and change in luminance according to the second frequency during a second time after the first time elapses the second time being different from the first time.

These general and specific aspects may be implemented using a system a method an integrated circuit a computer program or a computer readable recording medium such as a CD ROM or any combination of systems methods integrated circuits computer programs or computer readable recording media.

Additional benefits and advantages of the disclosed embodiments will be apparent from the Specification and Drawings. The benefits and or advantages may be individually obtained by the various embodiments and features of the Specification and Drawings which need not all be provided in order to obtain one or more of such benefits and or advantages.

An information communication method and a reception program disclosed herein provide an information processing program and a reception program that enable communication between various devices including a device with low computational performance.

An information processing program according to an aspect of the present disclosure is an information processing program for causing a computer to process information to be transmitted in order for the information to be transmitted by way of luminance change and causes the computer to execute encoding the information to determine a luminance change frequency and outputting a signal of the luminance change frequency determined to cause a light emitter to change in luminance according to the luminance change frequency determined to transmit the information wherein in the encoding each of a first frequency and a second frequency different from the first frequency is determined as the luminance change frequency and in the outputting each of a signal of the first frequency and a signal of the second frequency is output as the signal of the luminance change frequency determined to cause the light emitter to change in luminance according to the first frequency during a first time and change in luminance according to the second frequency during a second time after the first time elapses the second time being different from the first time. For example the first time is a duration corresponding to one period of the first frequency and the second time is a duration corresponding to one period of the second frequency.

With this information to be transmitted can be appropriately transmitted in the form of visible light signals of the first and second frequencies as illustrated in . Furthermore with the first time and the second time being different the transmission can be adapted to various situations. As a result communication between various devices becomes possible.

Furthermore in the outputting at least one of the signal of the first frequency and the signal of the second frequency may be repeatedly output to make a total number of times the signal of the first frequency is output and a total number of times the signal of the second frequency is output different from each other.

Furthermore in the outputting at least one of the signal of the first frequency and the signal of the second frequency may be repeatedly output to make a total number of times one of the signal of the first frequency and the signal of the second frequency that has a lower frequency is output greater than a total number of times a remaining one of the signal of the first frequency and the signal of the second frequency that has a higher frequency is output.

With this in the case where the light emitter changes in luminance according to the frequency specified by each output signal the light emitter can transmit with high luminance the information to be transmitted. For example suppose the duration for which low luminance lasts is the same in the change in luminance according to a low frequency namely the first frequency and the change in luminance according to a high frequency namely the second frequency. In this case the duration for which high luminance lasts is longer in the change in luminance according to the first frequency that is a low frequency than in the change in luminance according to the second frequency that is a high frequency . Therefore when many signals of the first frequency are output the light emitter can transmit with high luminance the information to be transmitted.

Furthermore in the outputting at least one of the signal of the first frequency and the signal of the second frequency may be repeatedly output to make a total number of times one of the signal of the first frequency and the signal of the second frequency that has a higher frequency is output greater than a total number of times a remaining one of the signal of the first frequency and the signal of the second frequency that has a lower frequency is output.

With this in the case where the light emitter changes in luminance according to the frequency specified by each output signal the reception efficiency of the information to be transmitted by such a change in luminance can be higher. For example when the information to be transmitted is transmitted to the receiver in the form of visible light signals represented by a plurality of frequencies the receiver performs frequency analysis such as the Fourier transform on a captured image to detect a frequency peak included in the visible light signal. Here with a higher frequency such peak detection is more difficult. Therefore the signal of the first frequency and the signal of the second frequency are output so that the number of times one of the signals having a higher frequency is output becomes greater than the number of times one of the signals having a lower frequency is output as described above so that the peak detection with a high frequency can be facilitated. As a result the reception efficiency can be improved.

Furthermore in the outputting at least one of the signal of the first frequency and the signal of the second frequency may be repeatedly output to avoid continuous output of a signal of a same frequency.

With this in the case where the light emitter changes in luminance according to the frequency specified by each output signal it can make it harder for human eyes or cameras to catch flicker of light from the light emitter.

Furthermore a reception program for receiving information from a light emitter changing in luminance according to a signal output using the above image processing program may cause a computer to execute setting a first exposure time for a plurality of imaging elements which are a part of K imaging elements included in an image sensor and setting a second exposure time for a plurality of imaging elements which are a remainder of the K imaging elements where K is an integer of 4 or more the second exposure time being shorter than the first exposure time causing the image sensor to capture a subject with the set first exposure time and the set second exposure time to obtain a normal image according to output from the plurality of the imaging elements for which the first exposure time is set and obtain a bright line image according to output from the plurality of the imaging elements for which the second exposure time is set the subject being the light emitter changing in luminance the bright line image including a plurality of bright lines each of which corresponds to a different one of a plurality of exposure lines included in the image sensor and obtaining the information by decoding a pattern of the plurality of the bright lines included in the obtained bright line image.

With this imaging is performed by the plurality of the imaging elements for which the first exposure time is set and the plurality of the imaging elements for which the second exposure time is set as illustrated in with the result that a normal image and a bright line image can be obtained in a single imaging operation by the image sensor. That is it is possible to capture a normal image and obtain information by visible light communication at the same time.

Furthermore it may be that in the setting the first exposure time is set for a plurality of imaging element lines which are a part of L imaging element lines included in the image sensor where L is an integer of 4 or more the second exposure time is set for a plurality of imaging element lines which are a remainder of the L imaging element lines and each of the L imaging element lines includes a plurality of imaging elements included in the image sensor and arranged in a line. For example each of the L imaging element lines is a different one of the plurality of the exposure lines included in the image sensor. Alternatively each of the L imaging element lines includes a plurality of imaging elements included in the image sensor and arranged along a direction perpendicular to the plurality of the exposure lines.

With this it is possible to set an exposure time for each imaging element line which is a large unit without individually setting an exposure time for each imaging element which is a small unit so that the processing load can be reduced.

Furthermore it may be that in the setting one of the first exposure time and the second exposure time is set for each of odd numbered imaging element lines of the L imaging element lines included in the image sensor to set a same exposure time for each of the odd numbered imaging element lines and a remaining one of the first exposure time and the second exposure time is set for each of even numbered imaging element lines of the L imaging element lines to set a same exposure time for each of the even numbered imaging element lines and when the setting the causing and the obtaining are repeated in a current round of the setting an exposure time for each of the odd numbered imaging element lines is set to an exposure time set for each of the even numbered imaging element lines in an immediately previous round of the setting and an exposure time for each of the even numbered imaging element lines is set to an exposure time set for each of the odd numbered imaging element lines in the immediately previous round of the setting.

With this at every operation to obtain a normal image the plurality of the imaging element lines that are to be used in the obtainment can be switched between odd numbered imaging element lines and even numbered imaging element lines. As a result each of the sequentially obtained normal images can be displayed in an interlaced format. Furthermore by interpolating two continuously obtained normal images with each other it is possible to generate a new normal image that includes an image obtained by the odd numbered imaging element lines and the even numbered imaging element lines.

Furthermore it may be that in the setting a preset mode is switched between a normal imaging priority mode and a visible light imaging priority mode when the preset mode is switched to the normal imaging priority mode a total number of the imaging elements for which the first exposure time is set is greater than a total number of the imaging elements for which the second exposure time is set and when the preset mode is switched to the visible light imaging priority mode a total number of the imaging elements for which the first exposure time is set is less than a total number of the imaging elements for which the second exposure time is set.

With this when the preset mode is switched to the normal imaging priority mode the quality of the normal image can be increased and when the preset mode is switched to the visible light imaging priority mode the reception efficiency for information from the light emitter can be increased.

Furthermore in the setting an exposure time may be set for each imaging element included in the image sensor to distribute in a checkered pattern the plurality of the imaging elements for which the first exposure time is set and the plurality of the imaging elements for which the second exposure time is set.

This results in uniform distribution of the plurality of the imaging elements for which the first exposure time is set and the plurality of the imaging elements for which the second exposure time is set so that it is possible to obtain the normal image and the bright line image the quality of which is not unbalanced between the horizontal direction and the vertical direction.

These general and specific aspects may be implemented using an apparatus a system a method an integrated circuit a computer program or a computer readable recording medium such as a CD ROM or any combination of apparatuses systems methods integrated circuits computer programs or computer readable recording media.

Each of the embodiments described below shows a general or specific example. The numerical values shapes materials structural elements the arrangement and connection of the structural elements steps the processing order of the steps etc. shown in the following embodiments are mere examples and therefore do not limit the scope of the present disclosure. Therefore among the structural elements in the following embodiments structural elements not recited in any one of the independent claims representing the broadest concepts are described as arbitrary structural elements.

The following proposes an imaging method in which when capturing one image all imaging elements are not exposed simultaneously but the times of starting and ending the exposure differ between the imaging elements. illustrates an example of imaging where imaging elements arranged in a line are exposed simultaneously with the exposure start time being shifted in order of lines. Here the simultaneously exposed imaging elements are referred to as exposure line and the line of pixels in the image corresponding to the imaging elements is referred to as bright line .

In the case of capturing a blinking light source shown on the entire imaging elements using this imaging method bright lines lines of brightness in pixel value along exposure lines appear in the captured image as illustrated in . By recognizing this bright line pattern the luminance change of the light source at a speed higher than the imaging frame rate can be estimated. Hence transmitting a signal as the luminance change of the light source enables communication at a speed not less than the imaging frame rate. In the case where the light source takes two luminance values to express a signal the lower luminance value is referred to as low LO and the higher luminance value is referred to as high HI . The low may be a state in which the light source emits no light or a state in which the light source emits weaker light than in the high.

In the case where the number of exposure lines whose exposure times do not overlap each other is 20 in one captured image and the imaging frame rate is 30 fps it is possible to recognize a luminance change in a period of 1.67 millisecond. In the case where the number of exposure lines whose exposure times do not overlap each other is 1000 it is possible to recognize a luminance change in a period of 1 30000 second about 33 microseconds . Note that the exposure time is set to less than 10 milliseconds for example.

In this situation when transmitting information based on whether or not each exposure line receives at least a predetermined amount of light information transmission at a speed of fl bits per second at the maximum can be realized where f is the number of frames per second frame rate and l is the number of exposure lines constituting one image.

Note that faster communication is possible in the case of performing time difference exposure not on a line basis but on a pixel basis.

In such a case when transmitting information based on whether or not each pixel receives at least a predetermined amount of light the transmission speed is firm bits per second at the maximum where m is the number of pixels per exposure line.

If the exposure state of each exposure line caused by the light emission of the light emitting unit is recognizable in a plurality of levels as illustrated in more information can be transmitted by controlling the light emission time of the light emitting unit in a shorter unit of time than the exposure time of each exposure line.

In the case where the exposure state is recognizable in Elv levels information can be transmitted at a speed of flElv bits per second at the maximum.

Moreover a fundamental period of transmission can be recognized by causing the light emitting unit to emit light with a timing slightly different from the timing of exposure of each exposure line.

In this situation the exposure time is calculated from the brightness of each exposure line to recognize the light emission state of the light emitting unit.

Note that in the case of determining the brightness of each exposure line in a binary fashion of whether or not the luminance is greater than or equal to a threshold it is necessary for the light emitting unit to continue the state of emitting no light for at least the exposure time of each line to enable the no light emission state to be recognized.

As described with reference to in the structure in which each exposure line is sequentially exposed so that the exposure times of adjacent exposure lines partially overlap each other the communication speed can be dramatically improved by using for signal transmission the bright line pattern generated by setting the exposure time shorter than in the normal imaging mode. Setting the exposure time in visible light communication to less than or equal to 1 480 second enables an appropriate bright line pattern to be generated. Here it is necessary to set exposure time 

Here the structure in which the exposure times of adjacent exposure lines partially overlap each other does not need to be applied to all exposure lines and part of the exposure lines may not have the structure of partially overlapping in exposure time. Moreover the structure in which the predetermined non exposure blank time predetermined wait time is provided from when the exposure of one exposure line ends to when the exposure of the next exposure line starts does not need to be applied to all exposure lines and part of the exposure lines may have the structure of partially overlapping in exposure time. This makes it possible to take advantage of each of the structures. Furthermore the same reading method or circuit may be used to read a signal in the normal imaging mode in which imaging is performed at the normal frame rate 30 fps 60 fps and the visible light communication mode in which imaging is performed with the exposure time less than or equal to 1 480 second for visible light communication. The use of the same reading method or circuit to read a signal eliminates the need to employ separate circuits for the normal imaging mode and the visible light communication mode. The circuit size can be reduced in this way.

The information communication method in this embodiment is an information communication method of obtaining information from a subject and includes Steps SK to SK.

In detail the information communication method includes a first exposure time setting step SK of setting a first exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a plurality of bright lines corresponding to a plurality of exposure lines included in the image sensor appear according to a change in luminance of the subject a first image obtainment step SK of obtaining a bright line image including the plurality of bright lines by capturing the subject changing in luminance by the image sensor with the set first exposure time and an information obtainment step SK of obtaining the information by demodulating data specified by a pattern of the plurality of bright lines included in the obtained bright line image wherein in the first image obtainment step SK exposure starts sequentially for the plurality of exposure lines each at a different time and exposure of each of the plurality of exposure lines starts after a predetermined blank time elapses from when exposure of an adjacent exposure line adjacent to the exposure line ends.

An information communication device K in this embodiment is an information communication device that obtains information from a subject and includes structural elements K to K.

In detail the information communication device K includes an exposure time setting unit K that sets an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a plurality of bright lines corresponding to a plurality of exposure lines included in the image sensor appear according to a change in luminance of the subject an image obtainment unit K that includes the image sensor and obtains a bright line image including the plurality of bright lines by capturing the subject changing in luminance with the set exposure time and an information obtainment unit K that obtains the information by demodulating data specified by a pattern of the plurality of bright lines included in the obtained bright line image wherein exposure starts sequentially for the plurality of exposure lines each at a different time and exposure of each of the plurality of exposure lines starts after a predetermined blank time elapses from when exposure of an adjacent exposure line adjacent to the exposure line ends.

In the information communication method and the information communication device K illustrated in the exposure of each of the plurality of exposure lines starts a predetermined blank time after the exposure of the adjacent exposure line adjacent to the exposure line ends for instance as illustrated in . This eases the recognition of the change in luminance of the subject. As a result the information can be appropriately obtained from the subject.

It should be noted that in the above embodiment each of the constituent elements may be constituted by dedicated hardware or may be obtained by executing a software program suitable for the constituent element. Each constituent element may be achieved by a program execution unit such as a CPU or a processor reading and executing a software program stored in a recording medium such as a hard disk or semiconductor memory. For example the program causes a computer to execute the information communication method illustrated in the flowchart of .

This embodiment describes each example of application using a receiver such as a smartphone which is the information communication device D and a transmitter for transmitting information as a blink pattern of the light source such as an LED or an organic EL device in Embodiment 1 described above.

In the normal imaging mode a receiver performs imaging at a shutter speed of 1 100 second as an example to obtain a normal captured image and displays the normal captured image on a display. For example a subject such as a street lighting or a signage as a store sign and its surroundings are clearly shown in the normal captured image.

In the visible light communication mode the receiver performs imaging at a shutter speed of 1 10000 second as an example to obtain a visible light communication image. For example in the case where the above mentioned street lighting or signage is transmitting a signal by way of luminance change as the light source described in Embodiment 1 that is a transmitter one or more bright lines hereafter referred to as bright line pattern are shown in the signal transmission part of the visible light communication image while nothing is shown in the other part. That is in the visible light communication image only the bright line pattern is shown and the part of the subject not changing in luminance and the surroundings of the subject are not shown.

In the intermediate mode the receiver performs imaging at a shutter speed of 1 3000 second as an example to obtain an intermediate image. In the intermediate image the bright line pattern is shown and the part of the subject not changing in luminance and the surroundings of the subject are shown too. By the receiver displaying the intermediate image on the display the user can find out from where or from which position the signal is being transmitted. Note that the bright line pattern the subject and its surroundings shown in the intermediate image are not as clear as the bright line pattern in the visible light communication image and the subject and its surroundings in the normal captured image respectively but have the level of clarity recognizable by the user.

In the following description the normal imaging mode or imaging in the normal imaging mode is referred to as normal imaging and the visible light communication mode or imaging in the visible light communication mode is referred to as visible light imaging visible light communication . Imaging in the intermediate mode may be used instead of normal imaging and visible light imaging and the intermediate image may be used instead of the below mentioned synthetic image.

The receiver switches the imaging mode in such a manner as normal imaging visible light communication normal imaging . . . . The receiver synthesizes the normal captured image and the visible light communication image to generate a synthetic image in which the bright line pattern the subject and its surroundings are clearly shown and displays the synthetic image on the display. The synthetic image is an image generated by superimposing the bright line pattern of the visible light communication image on the signal transmission part of the normal captured image. The bright line pattern the subject and its surroundings shown in the synthetic image are clear and have the level of clarity sufficiently recognizable by the user. Displaying such a synthetic image enables the user to more distinctly find out from which position the signal is being transmitted.

The receiver includes a camera Ca and a camera Ca. In the receiver the camera Ca performs normal imaging and the camera Ca performs visible light imaging. Thus the camera Ca obtains the above mentioned normal captured image and the camera Ca obtains the above mentioned visible light communication image. The receiver synthesizes the normal captured image and the visible light communication image to generate the above mentioned synthetic image and displays the synthetic image on the display.

In the receiver including two cameras the camera Ca switches the imaging mode in such a manner as normal imaging visible light communication normal imaging . . . . Meanwhile the camera Ca continuously performs normal imaging. When normal imaging is being performed by the cameras Ca and Ca simultaneously the receiver estimates the distance hereafter referred to as subject distance from the receiver to the subject based on the normal captured images obtained by these cameras through the use of stereoscopy triangulation principle . By using such estimated subject distance the receiver can superimpose the bright line pattern of the visible light communication image on the normal captured image at the appropriate position. The appropriate synthetic image can be generated in this way.

The receiver includes three cameras cameras Ca Ca and Ca as an example. In the receiver two cameras cameras Ca and Ca continuously perform normal imaging and the remaining camera camera Ca continuously performs visible light communication. Hence the subject distance can be estimated at any timing based on the normal captured images obtained by two cameras engaged in normal imaging.

The receiver includes three cameras cameras Ca Ca and Ca as an example. In the receiver each camera switches the imaging mode in such a manner as normal imaging visible light communication normal imaging . . . . The imaging mode of each camera is switched per period so that in one period two cameras perform normal imaging and the remaining camera performs visible light communication. That is the combination of cameras engaged in normal imaging is changed periodically. Hence the subject distance can be estimated in any period based on the normal captured images obtained by two cameras engaged in normal imaging.

In the case where the receiver includes two cameras Ca and Ca the two cameras Ca and Ca are positioned away from each other as illustrated in . The subject distance can be accurately estimated in this way. In other words the subject distance can be estimated more accurately when the distance between two cameras is longer.

In the case where the receiver includes three cameras Ca Ca and Ca the two cameras Ca and Ca for normal imaging are positioned away from each other as illustrated in and the camera Ca for visible light communication is for example positioned between the cameras Ca and Ca. The subject distance can be accurately estimated in this way. In other words the subject distance can be accurately estimated by using two farthest cameras for normal imaging.

The receiver switches the imaging mode in such a manner as visible light communication normal imaging visible light communication . . . as mentioned above. Upon performing visible light communication first the receiver starts an application program. The receiver then estimates its position based on the signal received by visible light communication. Next when performing normal imaging the receiver displays AR Augmented Reality information on the normal captured image obtained by normal imaging. The AR information is obtained based on for example the position estimated as mentioned above. The receiver also estimates the change in movement and direction of the receiver based on the detection result of the 9 axis sensor the motion detection in the normal captured image and the like and moves the display position of the AR information according to the estimated change in movement and direction. This enables the AR information to follow the subject image in the normal captured image.

When switching the imaging mode from normal imaging to visible light communication in visible light communication the receiver superimposes the AR information on the latest normal captured image obtained in immediately previous normal imaging. The receiver then displays the normal captured image on which the AR information is superimposed. The receiver also estimates the change in movement and direction of the receiver based on the detection result of the 9 axis sensor and moves the AR information and the normal captured image according to the estimated change in movement and direction in the same way as in normal imaging. This enables the AR information to follow the subject image in the normal captured image according to the movement of the receiver and the like in visible light communication as in normal imaging. Moreover the normal image can be enlarged or reduced according to the movement of the receiver and the like.

For example the receiver may display the synthetic image in which the bright line pattern is shown as illustrated in a in . As an alternative the receiver may superimpose instead of the bright line pattern a signal specification object which is an image having a predetermined color for notifying signal transmission on the normal captured image to generate the synthetic image and display the synthetic image as illustrated in b in .

As another alternative the receiver may display as the synthetic image the normal captured image in which the signal transmission part is indicated by a dotted frame and an identifier e.g. ID ID etc. as illustrated in c in . As another alternative the receiver may superimpose instead of the bright line pattern a signal identification object which is an image having a predetermined color for notifying transmission of a specific type of signal on the normal captured image to generate the synthetic image and display the synthetic image as illustrated in d in . In this case the color of the signal identification object differs depending on the type of signal output from the transmitter. For example a red signal identification object is superimposed in the case where the signal output from the transmitter is position information and a green signal identification object is superimposed in the case where the signal output from the transmitter is a coupon.

For example in the case of receiving the signal by visible light communication the receiver may output a sound for notifying the user that the transmitter has been discovered while displaying the normal captured image. In this case the receiver may change the type of output sound the number of outputs or the output time depending on the number of discovered transmitters the type of received signal the type of information specified by the signal or the like.

For example when the user touches the bright line pattern shown in the synthetic image the receiver generates an information notification image based on the signal transmitted from the subject corresponding to the touched bright line pattern and displays the information notification image. The information notification image indicates for example a coupon or a location of a store. The bright line pattern may be the signal specification object the signal identification object or the dotted frame illustrated in . The same applies to the below mentioned bright line pattern.

For example when the user touches the bright line pattern shown in the synthetic image the receiver generates an information notification image based on the signal transmitted from the subject corresponding to the touched bright line pattern and displays the information notification image. The information notification image indicates for example the current position of the receiver by a map or the like.

For example the receiver receives signals from two street lightings which are subjects as transmitters. The receiver estimates the current position of the receiver based on these signals in the same way as above. The receiver then displays the normal captured image and also superimposes an information notification image an image showing latitude longitude and the like indicating the estimation result on the normal captured image. The receiver may also display an auxiliary information notification image on the normal captured image. For instance the auxiliary information notification image prompts the user to perform an operation for calibrating the 9 axis sensor particularly the geomagnetic sensor i.e. an operation for drift cancellation. As a result of such an operation the current position can be estimated with high accuracy.

When the user touches the displayed information notification image the receiver may display the map showing the estimated position instead of the normal captured image.

For example when the user swipes on the receiver on which the synthetic image is displayed the receiver displays the normal captured image including the dotted frame and the identifier like the normal captured image illustrated in c in and also displays a list of information to follow the swipe operation. The list includes information specified by the signal transmitted from the part transmitter identified by each identifier. The swipe may be for example an operation of moving the user s finger from outside the display of the receiver on the right side into the display. The swipe may be an operation of moving the user s finger from the top bottom or left side of the display into the display.

When the user taps information included in the list the receiver may display an information notification image e.g. an image showing a coupon indicating the information in more detail.

For example when the user swipes on the receiver on which the synthetic image is displayed the receiver superimposes an information notification image on the synthetic image to follow the swipe operation. The information notification image indicates the subject distance with an arrow so as to be easily recognizable by the user. The swipe may be for example an operation of moving the user s finger from outside the display of the receiver on the bottom side into the display. The swipe may be an operation of moving the user s finger from the left top or right side of the display into the display.

For example the receiver captures as a subject a transmitter which is a signage showing a plurality of stores and displays the normal captured image obtained as a result. When the user taps a signage image of one store included in the subject shown in the normal captured image the receiver generates an information notification image based on the signal transmitted from the signage of the store and displays an information notification image . The information notification image is for example an image showing the availability of the store and the like.

A transmitter as a television transmits a signal to a receiver by way of luminance change. The signal includes information prompting the user to buy content relating to a program being viewed. Having received the signal by visible light communication the receiver displays an information notification image prompting the user to buy content based on the signal. When the user performs an operation for buying the content the receiver transmits at least one of information included in a SIM Subscriber Identity Module card inserted in the receiver a user ID a terminal ID credit card information charging information a password and a transmitter ID to a server . The server manages a user ID and payment information in association with each other for each user. The server specifies a user ID based on the information transmitted from the receiver and checks payment information associated with the user ID. By this check the server determines whether or not to permit the user to buy the content. In the case of determining to permit the user to buy the content the server transmits permission information to the receiver . Having received the permission information the receiver transmits the permission information to the transmitter . Having received the permission information the transmitter obtains the content via a network as an example and reproduces the content.

The transmitter may transmit information including the ID of the transmitter to the receiver by way of luminance change. In this case the receiver transmits the information to the server . Having obtained the information the server can determine that for example the television program is being viewed on the transmitter and conduct television program rating research.

The receiver may include information of an operation e.g. voting performed by the user in the above mentioned information and transmit the information to the server to allow the server to reflect the information on the television program. An audience participation program can be realized in this way. Besides in the case of receiving a post from the user the receiver may include the post in the above mentioned information and transmit the information to the server to allow the server to reflect the post on the television program a network message board or the like.

Furthermore by the transmitter transmitting the above mentioned information the server can charge for television program viewing by paid broadcasting or on demand TV. The server can also cause the receiver to display an advertisement or the transmitter to display detailed information of the displayed television program or an URL of a site showing the detailed information. The server may also obtain the number of times the advertisement is displayed on the receiver the price of a product bought from the advertisement or the like and charge the advertiser according to the number of times or the price. Such price based charging is possible even in the case where the user seeing the advertisement does not buy the product immediately. When the server obtains information indicating the manufacturer of the transmitter from the transmitter via the receiver the server may provide a service e.g. payment for selling the product to the manufacturer indicated by the information.

For example the user points a camera of a receiver at a plurality of transmitters to as lightings. Here the receiver is moved so that the transmitters to are sequentially captured as a subject. By performing visible light communication during the movement the receiver receives a signal from each of the transmitters to . The signal includes information indicating the position of the transmitter. The receiver estimates the position of the receiver using the triangulation principle based on the positions indicated by the signals received from the transmitters to the detection result of the 9 axis sensor included in the receiver and the movement of the captured image. In this case the drift of the 9 axis sensor particularly the geomagnetic sensor is canceled by moving the receiver so that the position can be estimated with higher accuracy.

For example a receiver is a head mounted display including a camera. When a start button is pressed the receiver starts imaging in the visible light communication mode i.e. visible light communication. In the case of receiving a signal by visible light communication the receiver notifies the user of information corresponding to the received signal. The notification is made for example by outputting a sound from a speaker included in the receiver or by displaying an image. Visible light communication may be started not only when the start button is pressed but also when the receiver receives a sound instructing the start or when the receiver receives a signal instructing the start by wireless communication. Visible light communication may also be started when the change width of the value obtained by a 9 axis sensor included in the receiver exceeds a predetermined range or when a bright line pattern even if only slightly appears in the normal captured image.

The receiver displays an alignment image upon initial setting. The alignment image is used to align the position pointed by the user in the image captured by the camera of the receiver and the image displayed on the receiver . When the user places his or her fingertip at the position of a circle shown in the alignment image the receiver associates the position of the fingertip and the position of the circle and performs alignment. That is the position pointed by the user is calibrated.

The receiver specifies a signal transmission part by visible light communication and displays a synthetic image in which a bright line pattern is shown in the part. The user performs an operation such as a tap or a double tap on the bright line pattern. The receiver receives the operation specifies the bright line pattern subjected to the operation and displays an information notification image based on a signal transmitted from the part corresponding to the bright line pattern.

The receiver displays the synthetic image in the same way as above. The user performs an operation of moving his or her fingertip so as to encircle the bright line pattern in the synthetic image . The receiver receives the operation specifies the bright line pattern subjected to the operation and displays an information notification image based on a signal transmitted from the part corresponding to the bright line pattern.

The receiver displays the synthetic image in the same way as above. The user performs an operation of placing his or her fingertip at the bright line pattern in the synthetic image for a predetermined time or more. The receiver receives the operation specifies the bright line pattern subjected to the operation and displays an information notification image based on a signal transmitted from the part corresponding to the bright line pattern.

The receiver displays the synthetic image in the same way as above. The user performs an operation of moving his or her fingertip toward the bright line pattern in the synthetic image by a swipe. The receiver receives the operation specifies the bright line pattern subjected to the operation and displays an information notification image based on a signal transmitted from the part corresponding to the bright line pattern.

The receiver displays the synthetic image in the same way as above. The user performs an operation of continuously directing his or her gaze to the bright line pattern in the synthetic image for a predetermined time or more. Alternatively the user performs an operation of blinking a predetermined number of times while directing his or her gaze to the bright line pattern. The receiver receives the operation specifies the bright line pattern subjected to the operation and displays an information notification image based on a signal transmitted from the part corresponding to the bright line pattern.

The receiver displays the synthetic image in the same way as above and also displays an arrow associated with each bright line pattern in the synthetic image . The arrow of each bright line pattern differs in direction. The user performs an operation of moving his or her head along one of the arrows. The receiver receives the operation based on the detection result of the 9 axis sensor and specifies the bright line pattern associated with the arrow corresponding to the operation i.e. the arrow in the direction in which the head is moved. The receiver displays the information notification image based on the signal transmitted from the part corresponding to the bright line pattern.

A pen includes a transmitter for transmitting a signal by way of luminance change and buttons and . When the button is pressed the transmitter transmits a predetermined first signal. When the button is pressed the transmitter transmits a predetermined second signal different from the first signal.

The pen is used instead of the user s finger mentioned above like a stylus pen. By selective use of the buttons and the pen can be used like a normal pen or an eraser.

The receiver includes a first touch sensor and a second touch sensor . These touch sensors are attached to the frame of the receiver . For example when the user places his or her fingertip on the first touch sensor and moves the fingertip the receiver moves the pointer in the image displayed to the user according to the movement of the fingertip. When the user touches the second touch sensor the receiver selects the object pointed by the pointer in the image displayed to the user.

The receiver includes a touch sensor . The touch sensor is attached to the frame of the receiver . For example when the user places his or her fingertip on the touch sensor and moves the fingertip the receiver moves the pointer in the image displayed to the user according to the movement of the fingertip. When the user presses the touch sensor the receiver selects the object pointed by the pointer in the image displayed to the user. The touch sensor is thus realized as a clickable touch sensor.

The receiver displays the synthetic image in the same way as above and also displays a pointer in the synthetic image . In the case where the receiver includes the first touch sensor and the second touch sensor the user places his or her fingertip on the first touch sensor and moves the fingertip to move the pointer to the object as the bright line pattern. The user then touches the second touch sensor to cause the receiver to select the bright line pattern. Having selected the bright line pattern the receiver displays the information notification image based on the signal transmitted from the part corresponding to the bright line pattern.

In the case where the receiver includes the touch sensor the user places his or her fingertip on the touch sensor and moves the fingertip to move the pointer to the object as the bright line pattern. The user then presses the touch sensor to cause the receiver to select the bright line pattern. Having selected the bright line pattern the receiver displays the information notification image based on the signal transmitted from the part corresponding to the bright line pattern.

The receiver displays a gesture confirmation image based on a signal obtained by visible light communication. The gesture confirmation image prompts the user to make a predetermined gesture to provide a service to the user as an example.

A user carrying the receiver is in a shop or the like. Here the receiver displays the above mentioned gesture confirmation image to the user . The user makes the predetermined gesture according to the gesture confirmation image . A staff in the shop carries a receiver . The receiver is a head mounted display including a camera and may have the same structure as the receiver . The receiver displays the gesture confirmation image based on a signal obtained by visible light communication too. The staff determines whether or not the predetermined gesture indicated by the displayed gesture confirmation image and the gesture made by the user match. In the case of determining that the predetermined gesture and the gesture made by the user match the staff provides the service associated with the gesture confirmation image to the user .

The receiver displays a gesture confirmation image based on a signal obtained by visible light communication. The gesture confirmation image prompts the user to make a predetermined gesture to permit wireless communication as an example.

The user carries the receiver . Here the receiver displays the above mentioned gesture confirmation image to the user . The user makes the predetermined gesture according to the gesture confirmation image . A person around the user carries the receiver . The receiver is a head mounted display including a camera and may have the same structure as the receiver . The receiver captures the predetermined gesture made by the user to obtain authentication information such as a password included in the gesture. In the case where the receiver determines that the authentication information matches predetermined information the receiver establishes wireless connection with the receiver . Subsequently the receivers and can wirelessly communicate with each other.

The transmitter alternately transmits signals and for example in a predetermined period. The transmission of the signal and the transmission of the signal are each carried out by way of luminance change such as blinking of visible light. A luminance change pattern for transmitting the signal and a luminance change pattern for transmitting the signal are different from each other.

The transmitter may transmit the signals and intermittently with a buffer time instead of continuously transmitting the signals and as mentioned above. In the buffer time the transmitter does not change in luminance. Alternatively in the buffer time the transmitter may transmit a signal indicating that the transmitter is in the buffer time by way of luminance change or perform a luminance change different from the luminance change for transmitting the signal or the luminance change for transmitting the signal . This enables the receiver to appropriately receive the signals and without interference.

The transmitter repeatedly transmits a signal sequence made up of a preamble a block a block a block and a check signal by way of luminance change. The block includes a preamble an address data and a check signal. The blocks and each have the same structure as the block . Specific information is obtained by using data included in the blocks and .

In detail in the above mentioned signal sequence one set of data or information is stored in a state of being divided into three blocks. Accordingly even when a receiver that needs a blanking time for imaging cannot receive all data of the blocks and from one signal sequence the receiver can receive the remaining data from another signal sequence. As a result even a receiver that needs a blanking time can appropriately obtain the specific information from at least one signal sequence.

In the above mentioned signal sequence a preamble and a check signal are provided for a set of three blocks. Hence a receiver capable of receiving light without needing a blanking time such as a receiver including an illuminance sensor can receive one signal sequence at one time through the use of the preamble and the check signal provided for the set thus obtaining the specific information in a short time.

When repeatedly transmitting the signal sequence including the blocks and as described above the transmitter may change for each signal sequence the order of the blocks included in the signal sequence. For example the blocks and are included in this order in the first signal sequence and the blocks and are included in this order in the next signal sequence. A receiver that requires a periodic blanking time can therefore avoid obtaining only the same block.

A receiver may receive signals visible light transmitted from transmitters and as lightings and reflected by a reflection surface. The receiver can thus receive signals from many transmitters all together. In this case the transmitters and transmit signals of different frequencies or protocols. As a result the receiver can receive the signals from the transmitters without interference.

One of the transmitters and may monitor the signal transmission state of the other transmitter and transmit a signal to avoid interference with a signal of the other transmitter. For instance one transmitter receives a signal transmitted from the other transmitter and transmits a signal of a protocol different from the received signal. Alternatively one transmitter detects a time period during which no signal is transmitted from the other transmitter and transmits a signal during the time period.

The transmitters and may transmit signals of the same frequency or protocol. In this case the receiver specifies the strength of the signal transmitted from each of the transmitters i.e. the edge strength of the bright line included in the captured image. The strength is lower when the distance between the receiver and the transmitter is longer. In the case where the distance between the receiver and the transmitter and the distance between the receiver and the transmitter are different from each other the difference in distance can be exploited in this way. Thus the receiver can separately receive the signals transmitted from the transmitters and appropriately according to the specified strengths.

The receiver receives a signal transmitted from the transmitter and reflected by a reflection surface. Here the receiver may estimate the position of the transmitter based on the strength distribution of luminance the difference in luminance between a plurality of positions in the captured image.

A receiver such as a smartphone captures a light source by a back camera out camera to receive a signal transmitted from the light source and obtains the position and direction of the light source from the received signal. The receiver estimates the position and direction of the receiver from the state of the light source in the captured image and the sensor value of the 9 axis sensor included in the receiver . The receiver captures a user by a front camera face camera in camera and estimates the position and direction of the head and the gaze direction the position and direction of the eye of the user by image processing. The receiver transmits the estimation result to the server. The receiver changes the behavior display content or playback sound according to the gaze direction of the user . The imaging by the back camera and the imaging by the front camera may be performed simultaneously or alternately.

Receivers and such as smartphones respectively receive signals from light sources and estimate the positions and directions of the receivers and and estimate the gaze directions of users and as in the above mentioned way. The receivers and respectively obtain information of surrounding objects to and to from a server based on the received data. The receivers and change their display contents as if the users can see the objects on the opposite side through the receivers and . The receivers and display an AR Augmented Reality object such as according to the display contents. When the gaze of the user exceeds the imaging range of the camera the receiver displays that the range is exceeded as in . As an alternative the receiver displays an AR object or other information in the area outside the range. As another alternative the receiver displays a previously captured image in the area outside the range in a state of being connected to the current image.

A receiver such as a smartphone receives a signal from a light source estimates the position and direction of the receiver and estimates the gaze direction of a user as in the above mentioned way. The receiver performs a process relating to an object in the gaze direction of the user . For example the receiver displays information about the object on the screen. When the gaze direction of a user moves from an object to a receiver the receiver determines that the user is interested in the object and continues the process relating to the object . For example the receiver keeps displaying the information of the object on the screen.

A transmitter such as a lighting is high in luminance. Regardless of whether the luminance is high or low as a transmission signal the transmitter captured by a receiver exceeds an upper limit of brightness and as a result no bright line appears as in . Accordingly a transmitter includes a part such as a diffusion plate or a prism for diffusing or weakening light to reduce the luminance. As a result the receiver can capture bright lines as in

A transmitter such as a lighting does not have a uniform light source and so the luminance is not uniform in a captured image causing a reception error. Accordingly a transmitter includes a part such as a diffusion plate or a prism for diffusing light to attain uniform luminance as in . A reception error can be prevented in this way.

Transmitters and are each high in luminance in the center part so that bright lines appear not in the center part but in the peripheral part in an image captured by a receiver. Since the bright lines are discontinuous the receiver cannot receive a signal from a part but can receive a signal from a part . By reading bright lines along a path the receiver can receive a signal from more bright lines than in the part

Transmitters and such as lightings are high in luminance like and bright lines tend not to appear when captured by a receiver. Accordingly a diffusion plate prism a reflection plate a reflection plate half mirror a reflection plate or a diffusion plate prism is included to diffuse light with it being possible to widen the part where bright lines appear. These transmitters are each captured with bright lines appearing in the periphery like . Since the receiver estimates the distance between the receiver and the transmitter using the size of the transmitter in the captured image the part where light is diffused is set as the size of the light source and stored in a server or the like in association with the transmission ID as a result of which the receiver can accurately estimate the distance to the transmitter.

A transmitter such as a lighting is high in luminance like and bright lines tend not to appear when captured by a receiver. Accordingly a reflection plate is included to diffuse light with it being possible to widen the part where bright lines appear.

A transmitter reflects light from a light source by a reflection plate as a result of which a receiver can capture bright lines in a wide range. A transmitter directs a light source toward a diffusion plate or prism as a result of which a receiver can capture bright lines in a wide range.

A receiver displays a bright line pattern using the above mentioned synthetic image intermediate image or the like. Here the receiver may be incapable of receiving a signal from a transmitter corresponding to the bright line pattern. When the user performs an operation e.g. a tap on the bright line pattern to select the bright line pattern the receiver displays the synthetic image or intermediate image in which the bright line pattern is enlarged by optical zoom. Through such optical zoom the receiver can appropriately receive the signal from the transmitter corresponding to the bright line pattern. That is even when the captured image is too small to obtain the signal the signal can be appropriately received by performing optical zoom. In the case where the displayed image is large enough to obtain the signal too faster reception is possible by optical zoom.

An information communication method in this embodiment is an information communication method of obtaining information from a subject the information communication method including setting an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a bright line corresponding to an exposure line included in the image sensor appears according to a change in luminance of the subject obtaining a bright line image by capturing the subject that changes in luminance by the image sensor with the set exposure time the bright line image being an image including the bright line displaying based on the bright line image a display image in which the subject and surroundings of the subject are shown in a form that enables identification of a spatial position of a part where the bright line appears and obtaining transmission information by demodulating data specified by a pattern of the bright line included in the obtained bright line image.

In this way a synthetic image or an intermediate image illustrated in for instance is displayed as the display image. In the display image in which the subject and the surroundings of the subject are shown the spatial position of the part where the bright line appears is identified by a bright line pattern a signal specification object a signal identification object a dotted frame or the like. By looking at such a display image the user can easily find the subject that is transmitting the signal through the change in luminance.

For example the information communication method may further include setting a longer exposure time than the exposure time obtaining a normal captured image by capturing the subject and the surroundings of the subject by the image sensor with the longer exposure time and generating a synthetic image by specifying based on the bright line image the part where the bright line appears in the normal captured image and superimposing a signal object on the normal captured image the signal object being an image indicating the part wherein in the displaying the synthetic image is displayed as the display image.

In this way the signal object is for example a bright line pattern a signal specification object a signal identification object a dotted frame or the like and the synthetic image is displayed as the display image as illustrated in . Hence the user can more easily find the subject that is transmitting the signal through the change in luminance.

For example in the setting of an exposure time the exposure time may be set to 1 3000 second in the obtaining of a bright line image the bright line image in which the surroundings of the subject are shown may be obtained and in the displaying the bright line image may be displayed as the display image.

In this way the bright line image is obtained and displayed as an intermediate image for instance as illustrated in . This eliminates the need for a process of obtaining a normal captured image and a visible light communication image and synthesizing them thus contributing to a simpler process.

For example the image sensor may include a first image sensor and a second image sensor in the obtaining of the normal captured image the normal captured image may be obtained by image capture by the first image sensor and in the obtaining of a bright line image the bright line image may be obtained by image capture by the second image sensor simultaneously with the first image sensor.

In this way the normal captured image and the visible light communication image which is the bright line image are obtained by the respective cameras for instance as illustrated in . As compared with the case of obtaining the normal captured image and the visible light communication image by one camera the images can be obtained promptly contributing to a faster process.

For example the information communication method may further include presenting in the case where the part where the bright line appears is designated in the display image by an operation by a user presentation information based on the transmission information obtained from the pattern of the bright line in the designated part. Examples of the operation by the user include a tap a swipe an operation of continuously placing the user s fingertip on the part for a predetermined time or more an operation of continuously directing the user s gaze to the part for a predetermined time or more an operation of moving a part of the user s body according to an arrow displayed in association with the part an operation of placing a pen tip that changes in luminance on the part and an operation of pointing to the part with a pointer displayed in the display image by touching a touch sensor.

In this way the presentation information is displayed as an information notification image for instance as illustrated in . Desired information can thus be presented to the user.

For example the image sensor may be included in a head mounted display and in the displaying the display image may be displayed by a projector included in the head mounted display.

For example an information communication method of obtaining information from a subject may include setting an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a bright line corresponding to an exposure line included in the image sensor appears according to a change in luminance of the subject obtaining a bright line image by capturing the subject that changes in luminance by the image sensor with the set exposure time the bright line image being an image including the bright line and obtaining the information by demodulating data specified by a pattern of the bright line included in the obtained bright line image wherein in the obtaining of a bright line image the bright line image including a plurality of parts where the bright line appears is obtained by capturing a plurality of subjects in a period during which the image sensor is being moved and in the obtaining of the information a position of each of the plurality of subjects is obtained by demodulating for each of the plurality of parts the data specified by the pattern of the bright line in the part and the information communication method may further include estimating a position of the image sensor based on the obtained position of each of the plurality of subjects and a moving state of the image sensor.

In this way the position of the receiver including the image sensor can be accurately estimated based on the changes in luminance of the plurality of subjects such as lightings for instance as illustrated in .

For example an information communication method of obtaining information from a subject may include setting an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a bright line corresponding to an exposure line included in the image sensor appears according to a change in luminance of the subject obtaining a bright line image by capturing the subject that changes in luminance by the image sensor with the set exposure time the bright line image being an image including the bright line obtaining the information by demodulating data specified by a pattern of the bright line included in the obtained bright line image and presenting the obtained information wherein in the presenting an image prompting to make a predetermined gesture is presented to a user of the image sensor as the information.

In this way user authentication and the like can be conducted according to whether or not the user makes the gesture as prompted for instance as illustrated in . This enhances convenience.

For example an information communication method of obtaining information from a subject may include setting an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a bright line corresponding to an exposure line included in the image sensor appears according to a change in luminance of the subject obtaining a bright line image by capturing the subject that changes in luminance by the image sensor with the set exposure time the bright line image being an image including the bright line and obtaining the information by demodulating data specified by a pattern of the bright line included in the obtained bright line image wherein in the obtaining of a bright line image the bright line image is obtained by capturing a plurality of subjects reflected on a reflection surface and in the obtaining of the information the information is obtained by separating a bright line corresponding to each of the plurality of subjects from bright lines included in the bright line image according to a strength of the bright line and demodulating for each of the plurality of subjects the data specified by the pattern of the bright line corresponding to the subject.

In this way even in the case where the plurality of subjects such as lightings each change in luminance appropriate information can be obtained from each subject for instance as illustrated in .

For example an information communication method of obtaining information from a subject may include setting an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a bright line corresponding to an exposure line included in the image sensor appears according to a change in luminance of the subject obtaining a bright line image by capturing the subject that changes in luminance by the image sensor with the set exposure time the bright line image being an image including the bright line and obtaining the information by demodulating data specified by a pattern of the bright line included in the obtained bright line image wherein in the obtaining of a bright line image the bright line image is obtained by capturing the subject reflected on a reflection surface and the information communication method may further include estimating a position of the subject based on a luminance distribution in the bright line image.

In this way the appropriate position of the subject can be estimated based on the luminance distribution for instance as illustrated in .

For example an information communication method of transmitting a signal using a change in luminance may include determining a first pattern of the change in luminance by modulating a first signal to be transmitted determining a second pattern of the change in luminance by modulating a second signal to be transmitted and transmitting the first signal and the second signal by a light emitter alternately changing in luminance according to the determined first pattern and changing in luminance according to the determined second pattern.

In this way the first signal and the second signal can each be transmitted without a delay for instance as illustrated in .

For example in the transmitting a buffer time may be provided when switching the change in luminance between the change in luminance according to the first pattern and the change in luminance according to the second pattern.

In this way interference between the first signal and the second signal can be suppressed for instance as illustrated in .

For example an information communication method of transmitting a signal using a change in luminance may include determining a pattern of the change in luminance by modulating the signal to be transmitted and transmitting the signal by a light emitter changing in luminance according to the determined pattern wherein the signal is made up of a plurality of main blocks each of the plurality of main blocks includes first data a preamble for the first data and a check signal for the first data the first data is made up of a plurality of sub blocks and each of the plurality of sub blocks includes second data a preamble for the second data and a check signal for the second data.

In this way data can be appropriately obtained regardless of whether or not the receiver needs a blanking time for instance as illustrated in .

For example an information communication method of transmitting a signal using a change in luminance may include determining by each of a plurality of transmitters a pattern of the change in luminance by modulating the signal to be transmitted and transmitting by each of the plurality of transmitters the signal by a light emitter in the transmitter changing in luminance according to the determined pattern wherein in the transmitting the signal of a different frequency or protocol is transmitted.

In this way interference between signals from the plurality of transmitters can be suppressed for instance as illustrated in .

For example an information communication method of transmitting a signal using a change in luminance may include determining by each of a plurality of transmitters a pattern of the change in luminance by modulating the signal to be transmitted and transmitting by each of the plurality of transmitters the signal by a light emitter in the transmitter changing in luminance according to the determined pattern wherein in the transmitting one of the plurality of transmitters receives a signal transmitted from a remaining one of the plurality of transmitters and transmits an other signal in a form that does not interfere with the received signal.

In this way interference between signals from the plurality of transmitters can be suppressed for instance as illustrated in .

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED an organic EL device or the like in Embodiment 1 or 2 described above.

First a receiver receives a signal by an illuminance sensor Step . Next the receiver obtains information such as position information from a server based on the received signal Step . The receiver then activates an image sensor capable of capturing the light reception direction of the illuminance sensor Step . The receiver receives all or part of a signal by the image sensor and determines whether or not all or part of the signal is the same as the signal received by the illuminance sensor Step . Following this the receiver estimates the position of the receiver from the position of the transmitter in the captured image information from a 9 axis sensor included in the receiver and the position information of the transmitter Step . Thus the receiver activates the illuminance sensor of low power consumption and in the case where the signal is received by the illuminance sensor activates the image sensor. The receiver then performs position estimation using image capture by the image sensor. In this way the position of the receiver can be accurately estimated while saving power.

A receiver recognizes a periodic change of luminance from the sensor value of an illuminance sensor Step . The receiver then activates an image sensor capable of capturing the light reception direction of the illuminance sensor and receives a signal Step . Thus the receiver activates the illuminance sensor of low power consumption and in the case where the periodic change of luminance is received by the illuminance sensor activates the image sensor in the same way as above. The receiver then receives the accurate signal using image capture by the image sensor. In this way the accurate signal can be received while saving power.

A transmitter includes a power supply unit a signal control unit a light emitting unit and a light emitting unit . The power supply unit supplies power to the signal control unit . The signal control unit divides the power supplied from the power supply unit into the light emitting units and and controls the luminance changes of the light emitting units and

A transmitter includes a power supply unit a signal control unit a light emitting unit and a light emitting unit . The power supply unit supplies power to the light emitting units and . The signal control unit controls the power supplied from the power supply unit thereby controlling the luminance changes of the light emitting units and . The power use efficiency can be enhanced by the signal control unit controlling the power supply unit that supplies power to each of the light emitting units and

The system includes a centralized control unit a transmitter and a transmitter . The centralized control unit controls signal transmission by a change in luminance of each of the transmitters and . For example the centralized control unit causes the transmitters and to transmit the same signal at the same time or causes one of the transmitters to transmit a signal unique to the transmitter.

The transmitter includes two transmission units and a signal change unit a signal storage unit a synchronous signal input unit a synchronous control unit and a light receiving unit .

The two transmission units and each have the same structure as the transmitter illustrated in and transmits a signal by changing in luminance. In detail the transmission unit includes a power supply unit a signal control unit a light emitting unit and a light emitting unit . The transmission unit includes a power supply unit a signal control unit a light emitting unit and a light emitting unit

The signal change unit modulates a signal to be transmitted to a signal indicating a luminance change pattern. The signal storage unit stores the signal indicating the luminance change pattern. The signal control unit in the transmission unit reads the signal stored in the signal storage unit and causes the light emitting units and to change in luminance according to the signal.

The synchronous signal input unit obtains a synchronous signal according to control by the centralized control unit . The synchronous control unit synchronizes the luminance changes of the transmission units and when the synchronous signal is obtained. That is the synchronous control unit controls the signal control units and to synchronize the luminance changes of the transmission units and . Here the light receiving unit detects light emission from the transmission units and . The synchronous control unit feedback controls the signal control units and according to the light detected by the light receiving unit .

A transmitter includes a transmission unit that transmits a signal by changing in luminance and a non transmission unit that emits light without transmitting a signal.

The transmission unit has the same structure as the transmitter illustrated in and includes a power supply unit a signal control unit and light emitting units to . The non transmission unit includes a power supply unit and light emitting units to but does not include a signal control unit. In other words in the case where there are a plurality of units each including a power supply and luminance change synchronous control cannot be performed between the plurality of units a signal control unit is provided in only one of the plurality of units to cause the unit to change in luminance as in the structure illustrated in .

In the transmitter the light emitting units to in the transmission unit are continuously arranged in a line. That is none of the light emitting units to in the non transmission unit is mixed in the set of the light emitting units to . This makes the light emitter that changes in luminance larger in size so that the receiver can easily receive the signal transmitted using the change in luminance.

A transmitter such as a signage includes three light emitting units light emitting areas to . Light from these light emitting units to do not interfere with each other. In the case where only one of the light emitting units to can be changed in luminance to transmit a signal it is desirable to change in luminance the light emitting unit at the center as illustrated in a in . In the case where two of the light emitting units to can be changed in luminance it is desirable to change in luminance the light emitting unit at the center and the light emitting unit or at either edge as illustrated in b in . Changing in luminance the light emitting units at such positions enables the receiver to appropriately receive the signal transmitted using the change in luminance.

A transmitter such as a signage includes three light emitting units to . Light from adjacent light emitting units of these light emitting units to interferes with each other. In the case where only one of the light emitting units to can be changed in luminance to transmit a signal it is desirable to change in luminance the light emitting unit or at either edge as illustrated in a in . This prevents light from another light emitting unit from interfering with the luminance change for signal transmission. In the case where two of the light emitting units to can be changed in luminance it is desirable to change in luminance the light emitting unit at the center and the light emitting unit or at either edge as illustrated in b in . Changing in luminance the light emitting units at such positions contributes to a larger luminance change area and so enables the receiver to appropriately receive the signal transmitted using the change in luminance.

In the case where two of the light emitting units to can be changed in luminance in the transmitter the light emitting units and at both edges may be changed in luminance as illustrated in . In this case the imaging range in which the luminance change part is shown can be widened in the image capture by the receiver.

A transmitter such as a signage transmits a signal by a character part A Shop and a light emitting unit changing in luminance. For example the light emitting unit is formed like a horizontally long rectangle and uniformly changes in luminance. The uniform change in luminance of the light emitting unit enables the receiver to appropriately receive the signal transmitted using the change in luminance.

A transmitter such as a signage transmits a signal by a character part A Shop and a light emitting unit changing in luminance. For example the light emitting unit is formed like a frame along the edges of the signage and uniformly changes in luminance. That is the light emitting unit is formed so that when the light emitting unit is projected onto an arbitrary straight line the length of the continuous projection part is at the maximum. The uniform change in luminance of the light emitting unit enables the receiver to more appropriately receive the signal transmitted using the change in luminance.

A receiver such as a smartphone obtains position information indicating the position of the receiver and transmits the position information to a server . For example the receiver obtains the position information when using a GPS or the like or receiving another signal. The server transmits an ID list associated with the position indicated by the position information to the receiver . The ID list includes each ID such as abcd and information associated with the ID.

The receiver receives a signal from a transmitter such as a lighting device. Here the receiver may be able to receive only a part e.g. b of an ID as the above mentioned signal. In such a case the receiver searches the ID list for the ID including the part. In the case where the unique ID is not found the receiver further receives a signal including another part of the ID from the transmitter . The receiver thus obtains a larger part e.g. bc of the ID. The receiver again searches the ID list for the ID including the part e.g. bc . Through such search the receiver can specify the whole ID even in the case where the ID can be obtained only partially. Note that when receiving the signal from the transmitter the receiver receives not only the part of the ID but also a check portion such as a CRC Cyclic Redundancy Check .

A receiver such as a smartphone obtains position information indicating the position of the receiver . For example the receiver obtains the position information when using a GPS or the like or receiving another signal. The receiver also receives a signal from a transmitter such as a lighting device. The signal includes only a part e.g. b of an ID. The receiver transmits the position information and the part of the ID to a server .

The server searches an ID list associated with the position indicated by the position information for the ID including the part. In the case where the unique ID is not found the server notifies the receiver that the specification of the ID has failed.

Following this the receiver receives a signal including another part of the ID from the transmitter . The receiver thus obtains a large part e.g. be of the ID. The receiver transmits the part e.g. be of the ID and the position information to the server .

The server searches the ID list associated with the position indicated by the position information for the ID including the part. When the unique ID is found the server notifies the receiver that the ID e.g. abef has been specified and transmits information associated with the ID to the receiver .

The receiver may transmit not the part of the ID but the whole ID to the server together with the position information. In the case where the complete ID e.g. wxyz is not included in the ID list the server notifies the receiver of an error.

Transmitters and transmit a signal by changing in luminance. Here the transmitter transmits a synchronous signal to the transmitter thereby changing in luminance synchronously with the transmitter . Further the transmitters and each obtain a signal from a source and change in luminance according to the signal. There is a possibility that the time first delay time taken for the signal transmission from the source to the transmitter and the time second delay time taken for the signal transmission from the source to the transmitter are different. In view of this the signal round trip time between each of the transmitters and and the source is measured and of the round trip time is specified as the first or second delay time. The transmitter transmits the synchronous signal so as to cancel out the difference between the first and second delay times thereby changing in luminance synchronously with the transmitter

A light receiving sensor detects light from the transmitters and and outputs the result to the transmitters and as a detection signal. Having received the detection signal from the light receiving sensor the transmitters and change in luminance synchronously or adjust the signal strength based on the detection signal.

A transmitter such as a television obtains an image and an ID ID associated with the image from a control unit . The transmitter displays the image and also transmits the ID ID to a receiver by changing in luminance. The receiver captures the transmitter to receive the ID ID and displays information associated with the ID ID . The control unit then changes the image output to the transmitter to another image. The control unit also changes the ID output to the transmitter . That is the control unit outputs the other image and the other ID ID associated with the other image to the transmitter . The transmitter displays the other image and transmits the other ID ID to the receiver by changing in luminance. The receiver captures the transmitter to receive the other ID ID and displays information associated with the other ID ID .

A transmitter such as a signage displays images by switching between them. When displaying an image the transmitter transmits to a receiver ID time information indicating the ID corresponding to the displayed image and the time at which the image is displayed by changing in luminance. For example at time t the transmitter displays an image showing a circle and transmits ID time information indicating the ID ID corresponding to the image and the time TIME t at which the image is displayed.

Here the transmitter transmits not only the ID time information corresponding to the currently displayed image but also ID time information corresponding to at least one previously displayed image. For example at time t the transmitter displays an image showing a square and transmits ID time information indicating the ID ID corresponding to the image and the time TIME t at which the image is displayed. At this time the transmitter also transmits the ID time information indicating the ID ID 1000 corresponding to the image showing the circle and the time TIME t at which the image is displayed. Likewise at time t the transmitter displays an image showing a triangle and transmits ID time information indicating the ID ID 1002 corresponding to the image and the time TIME t at which the image is displayed. At this time the transmitter also transmits the ID time information indicating the ID ID 1001 corresponding to the image showing the square and the time TIME t at which the image is displayed. Thus the transmitter transmits a plurality of sets of ID time information at the same time.

Suppose to obtain information related to the image showing the square the user points an image sensor of the receiver at the transmitter and starts image capture by the receiver at the time t at which the image showing the square is displayed.

Even when the receiver starts capturing at time t the receiver may not be able to obtain the ID time information corresponding to the image showing the square while the image is displayed on the transmitter . Even in such a case since the ID time information corresponding to the previously displayed image is also transmitted from the transmitter as mentioned above at time t the receiver can obtain not only the ID time information ID 1002 TIME t corresponding to the image showing the triangle but also the ID time information ID 1001 TIME t corresponding to the image showing the square. The receiver selects from these ID time information the ID time information ID 1001 TIME t indicating the time t at which the receiver is pointed at the transmitter and specifies the ID ID 1001 indicated by the ID time information. As a result at time t the receiver can obtain from a server or the like information related to the image showing the square based on the specified ID ID 1001 .

The above mentioned time is not limited to an absolute time and may be a time relative time between the time at which the receiver is pointed at the transmitter and the time at which the receiver receives the ID time information. Moreover though the transmitter transmits the ID time information corresponding to the previously displayed image together with the ID time information corresponding to the currently displayed image the transmitter may transmit ID time information corresponding to an image to be displayed in the future. Furthermore in a situation where the reception by the receiver is difficult the transmitter may transmit more sets of previous or future ID time information.

In the case where the transmitter is not a signage but a television the transmitter may transmit information indicating a channel corresponding to a displayed image instead of ID time information. In detail in the case where an image of a television program being broadcasted is displayed on the transmitter in real time the display time of the image displayed on the transmitter can be uniquely specified for each channel. Accordingly the receiver can specify the time at which the receiver is pointed at the transmitter i.e. the time at which the receiver starts capturing based on the captured image and the channel. The receiver can then obtain from a server or the like information related to the captured image based on the channel and the time. Here the transmitter may transmit information indicating the display time of the displayed image instead of ID time information. In such a case the receiver searches all television programs being broadcasted for a television program including the captured image. The receiver can then obtain from a server or the like information related to the image based on the channel and display time of the television program.

As illustrated in a in a receiver captures a transmitter to obtain an image including a bright line and specifies obtains the ID of the transmitter from the image. The receiver transmits the ID to a server and obtains information associated with the ID from the server .

On the other hand as illustrated in b in the receiver may capture the transmitter to obtain the image including the bright line and transmit the image to the server as captured data. The receiver may also perform on the image including the bright line such preprocessing that reduces the amount of information of the image and transmit the preprocessed image to the server as captured data. The preprocessing is for instance image binarization. Having received the captured data the server specifies obtains the ID of the transmitter from the image indicated by the captured data. The server then transmits the information associated with the ID to the receiver .

When the user is located at position A a receiver specifies the position of the receiver by obtaining a signal transmitted from a transmitter that changes in luminance. The receiver displays a point indicating the specified position together with an error range of the position.

Next when the user moves from position A to position B the receiver cannot obtain a signal from the transmitter . The receiver accordingly estimates the position of the receiver using a 9 axis sensor and the like included in the receiver . The receiver displays the point indicating the estimated position together with the error range of the position. Since this position is estimated by the 9 axis sensor a larger error range is displayed.

Next when the user moves from position B to position C the receiver specifies the position of the receiver by obtaining a signal transmitted from another transmitter that changes in luminance. The receiver displays the point indicating the specified position together with the error range of the position. Here the receiver does not instantly switch the display from the point indicating the position estimated using the 9 axis sensor and its error range to the position specified as mentioned above and its error range but smoothly switches the display with movement. The error range becomes smaller as a result.

The receiver such as a smartphone advanced mobile phone includes an image sensor an illuminance sensor and a display on its front surface as illustrated in a in . The image sensor obtains an image including a bright line by capturing a subject that changes in luminance as mentioned above. The illuminance sensor detects the change in luminance of the subject. Hence the illuminance sensor can be used in place of the image sensor depending on the state or situation of the subject. The display displays an image and the like. The receiver may also have a function as a subject that changes in luminance. In this case the receiver transmits a signal by causing the display to change in luminance.

The receiver also includes an image sensor an illuminance sensor and a flash light emitting unit on its back surface as illustrated in b in . The image sensor is the same as the above mentioned image sensor and obtains an image including a bright line by capturing a subject that changes in luminance as mentioned above. The illuminance sensor is the same as the above mentioned illuminance sensor and detects the change in luminance of the subject. Hence the illuminance sensor can be used in place of the image sensor depending on the state or situation of the subject. The flash light emitting unit emits a flash for imaging. The receiver may also have a function as a subject that changes in luminance. In this case the receiver transmits a signal by causing the flash light emitting unit to change in luminance.

A transmitter such as a smartphone transmits information indicating Coupon 100 yen off as an example by causing a part of a display except a barcode part to change in luminance i.e. by visible light communication. The transmitter also causes the barcode part to display a barcode without changing in luminance. The barcode indicates the same information as the above mentioned information transmitted by visible light communication. The transmitter further causes the part of the display except the barcode part to display the characters or pictures e.g. the characters Coupon 100 yen off indicating the information transmitted by visible light communication. Displaying such characters or pictures allows the user of the transmitter to easily recognize what kind of information is being transmitted.

A receiver performs image capture to obtain the information transmitted by visible light communication and the information indicated by the barcode and transmits these information to a server . The server determines whether or not these information match or relate to each other. In the case of determining that these information match or relate to each other the server executes a process according to these information. Alternatively the server transmits the determination result to the receiver so that the receiver executes the process according to these information.

The transmitter may transmit a part of the information indicated by the barcode by visible light communication. Moreover the URL of the server may be indicated in the barcode. Furthermore the transmitter may obtain an ID as a receiver and transmit the ID to the server to thereby obtain information associated with the ID. The information associated with the ID is the same as the information transmitted by visible light communication or the information indicated by the barcode. The server may transmit an ID associated with information visible light communication information or barcode information transmitted from the transmitter via the receiver to the transmitter .

The transmitter such as a smartphone transmits a signal by causing the display to change in luminance. A receiver includes a light resistant cone shaped container and an illuminance sensor . The illuminance sensor is contained in the container and located near the tip of the container . When the signal is transmitted from the transmitter by visible light communication the opening bottom of the container in the receiver is directed to the display . Since no light other than the light from the display enters the container the illuminance sensor in the receiver can appropriately receive the light from the display without being affected by any light which is noise. As a result the receiver can appropriately receive the signal from the transmitter .

A transmitter such as a bus stop sign transmits operation information indicating a bus operation state and the like to the receiver by changing in luminance. For instance the operation information indicating the destination of a bus the arrival time of the bus at the bus stop the current position of the bus and the like is transmitted to the receiver . Having received the operation information the receiver displays the contents of the operation information on its display.

For example suppose buses with different destinations stop at the bus stop. The transmitter transmits operation information about these buses with the different destinations. Having received these operation information the receiver selects operation information of a bus with a destination that is frequently used by the user and displays the contents of the selected operation information on the display. In detail the receiver specifies the destination of each bus used by the user through a GPS or the like and records a history of destinations. With reference to this history the receiver selects operation information of a bus with a destination frequently used by the user. As an alternative the receiver may display the contents of operation information selected by the user from these operation information on the display. As another alternative the receiver may display with priority operation information of a bus with a destination frequently selected by the user.

A transmitter such as a signage transmits information of a plurality of shops to the receiver by changing in luminance. This information summarizes information about the plurality of shops and is not information unique to each shop. Accordingly having received the information by image capture the receiver can display information about not only one shop but the plurality of shops. The receiver selects information about a shop e.g. B shop within the imaging range from the information about the plurality of shops and displays the selected information. When displaying the information the receiver translates the language for expressing the information to a language registered beforehand and displays the information in the translated language. Moreover a message prompting for image capture by an image sensor camera of the receiver may be displayed on the transmitter using characters or the like. In detail a special application program is started to display on the transmitter a message e.g. Get information with camera informing that information can be provided if the transmitter is captured by camera.

For example the receiver captures a subject including a plurality of persons and a street lighting . The street lighting includes a transmitter that transmits information by changing in luminance. By capturing the subject the receiver obtains an image in which the image of the transmitter appears as the above mentioned bright line pattern. The receiver obtains an AR object associated with an ID indicated by the bright line pattern from a server or the like. The receiver superimposes the AR object on a normal captured image obtained by normal imaging and displays the normal captured image on which the AR object is superimposed.

For example information transmitted by a transmitter is made up of a preamble unit a data unit of fixed length and a check unit. A receiver checks the data unit using the check unit thus successfully receiving the information made up of these units. When the receiver receives the preamble unit and the data unit but cannot receive the check unit the receiver omits the check using the check unit. Even in such a case where the check is omitted the receiver can successfully receive the information made up of these units.

For example information transmitted by a transmitter is made up of a preamble unit a check unit and a data unit of variable length. The next information transmitted by the transmitter is equally made up of the preamble unit the check unit and the data unit of variable length. When a receiver receives one preamble unit and the next preamble unit the receiver recognizes information from the preamble unit to immediately before the next preamble unit as one set of significant information. The receiver may also use the check unit to specify the end of the data unit received following the check unit. In this case even when the receiver cannot receive the above mentioned next preamble unit all or part of the preamble unit the receiver can appropriately receive one set of significant information transmitted immediately before.

A transmitter modulates a transmission signal signal to be transmitted to a luminance change pattern by a 4 value PPM modulation scheme. When doing so the transmitter can maintain the brightness of light that changes in luminance constant regardless of the transmission signal.

For instance in the case of maintaining the brightness at 75 the transmitter modulates each of the transmission signals 00 01 10 and 11 to a luminance change pattern in which luminance L Low is represented in one of four consecutive slots and luminance H High is represented in the other three slots. In detail the transmitter modulates the transmission signal 00 to a luminance change pattern L H H H in which luminance L is represented in the first slot and luminance H is represented in the second to fourth slots. In this luminance change the luminance rises between the first and second slots. Likewise the transmitter modulates the transmission signal 01 to a luminance change pattern H L H H in which luminance L is represented in the second slot and luminance H is represented in the first third and fourth slots. In this luminance change the luminance rises between the second and third slots.

In the case of maintaining the brightness at 50 the transmitter modulates each of the transmission signals 00 01 10 and 11 to a luminance change pattern in which luminance L Low is represented in two of the four slots and luminance H High is represented in the other two slots. In detail the transmitter modulates the transmission signal 00 to a luminance change pattern L H H L in which luminance L is represented in the first and fourth slots and luminance H is represented in the second and third slots. In this luminance change the luminance rises between the first and second slots. Likewise the transmitter modulates the transmission signal 01 to a luminance change pattern L L H H in which luminance L is represented in the first and second slots and luminance H is represented in the third and fourth slots. Alternatively the transmitter modulates the transmission signal 01 to a luminance change pattern H L H L in which luminance L is represented in the second and fourth slots and luminance H is represented in the first and third slots. In this luminance change the luminance rises between the second and third slots.

In the case of maintaining the brightness at 25 the transmitter modulates each of the transmission signals 00 01 10 and 11 to a luminance change pattern in which luminance L Low is represented in three of the four slots and luminance H High is represented in the other slot. In detail the transmitter modulates the transmission signal 00 to a luminance change pattern L H L L in which luminance L is represented in the first third and fourth slots and luminance H is represented in the second slot. In this luminance change the luminance rises between the first and second slots. Likewise the transmitter modulates the transmission signal 01 to a luminance change pattern L L H L in which luminance L is represented in the first second and fourth slots and luminance H is represented in the third slot. In this luminance change the luminance rises between the second and third slots.

By the above mentioned 4 value PPM modulation scheme the transmitter can suppress flicker and also easily adjust the brightness in levels. Moreover a receiver can appropriately demodulate the luminance change pattern by specifying the position at which the luminance rises. Here the receiver does not use but ignores whether or not the luminance rises at the boundary between one slot group made up of four slots and the next slot group when demodulating the luminance change pattern.

A transmitter modulates a transmission signal to a luminance change pattern as in the 4 value PPM modulation scheme illustrated in . Here the transmitter may perform PPM modulation without switching the luminance between L and H per slot. In detail the transmitter performs PPM modulation by switching the position at which the luminance rises in the duration time width hereafter referred to as unit duration of four consecutive slots illustrated in depending on the transmission signal. For example the transmitter modulates the transmission signal 00 to a luminance change pattern in which the luminance rises at the position of 25 in the unit duration as illustrated in . Likewise the transmitter modulates the transmission signal 01 to a luminance change pattern in which the luminance rises at the position of 50 of the unit duration as illustrated in .

In the case of maintaining the brightness at 75 the transmitter modulates the transmission signal 00 to a luminance change pattern in which luminance L is represented in the position of 0 to 25 and luminance H is represented in the position of 25 to 100 in the unit duration. In the case of maintaining the brightness at 99 the transmitter modulates the transmission signal 00 to a luminance change pattern in which luminance L is represented in the position of 24 to 25 and luminance H is represented in the position of 0 to 24 and the position of 25 to 100 in the unit duration. Likewise in the case of maintaining the brightness at 1 the transmitter modulates the transmission signal 00 to a luminance change pattern in which luminance L is represented in the position of 0 to 25 and the position of 26 to 100 and luminance H is represented in the position of 25 to 26 in the unit duration.

By such switching the luminance between L and H at an arbitrary position in the unit duration without switching the luminance between L and H per slot it is possible to adjust the brightness continuously.

A transmitter performs modulation in the same way as in the PPM modulation scheme illustrated in . Here regardless of the transmission signal the transmitter modulates the signal to a luminance change pattern in which luminance H is represented at the start of the unit duration and luminance L is represented at the end of the unit duration. Since the luminance rises at the boundary between one unit duration and the next unit duration a receiver can appropriately specify the boundary. Therefore the receiver and the transmitter can correct clock discrepancies.

For example in the case of transmitting the header preamble unit illustrated in a transmitter changes in luminance according to a pattern illustrated in . In detail in the case where the header is made up of 7 slots the transmitter changes in luminance according to the pattern L H L H L H H . In the case where the header is made up of 8 slots the transmitter changes in luminance according to the pattern H L H L H L H H . These patterns are distinguishable from the luminance change patterns illustrated in with it being possible to clearly inform a receiver that the signal indicated by any of these patterns is the header.

In the 4 value PPM modulation scheme in the case of modulating the transmission signal 01 included in the data unit while maintaining the brightness at 50 the transmitter modulates the signal to one of the two patterns as illustrated in . In detail the transmitter modulates the signal to the first pattern L L H H or the second pattern H L H L .

Here suppose the luminance change pattern corresponding to the header is such a pattern as illustrated in . In this case it is desirable that the transmitter modulates the transmission signal 01 to the first pattern L L H H . For instance in the case of using the first pattern the transmission signal 11 01 11 included in the data unit is modulated to the pattern H H L L L L H H H H L L . In the case of using the second pattern on the other hand the transmission signal 11 01 11 included in the data unit is modulated to the pattern H H L L H L H L H H L L . The pattern H H L L H L H L H H L L includes the same pattern as the pattern of the header made up of 7 slots illustrated in . For clear distinction between the header and the data unit it is desirable to modulate the transmission signal 01 to the first pattern.

In the 4 value PPM modulation scheme in the case of modulating the transmission signal 11 the transmitter modulates the signal to the pattern H H H L the pattern H H L L or the pattern H L L L so as not to cause a rise in luminance as illustrated in . However the transmitter may modulate the transmission signal 11 to the pattern H H H H or the pattern L L L L in order to adjust the brightness as illustrated in .

In the 4 value PPM modulation scheme in the case of modulating the transmission signal 11 00 while maintaining the brightness at 75 the transmitter modulates the signal to the pattern H H H L L H H H as illustrated in . However if luminance L is consecutive each of the consecutive values of luminance L other than the last value may be changed to H so that luminance L is not consecutive. That is the transmitter modulates the signal 11 00 to the pattern H H H H L H H H .

Since luminance L is not consecutive the load on the transmitter can be reduced. Moreover the capacitance of the capacitor included in the transmitter can be reduced enabling a reduction in control circuit capacity. Furthermore a lighter load on the light source of the transmitter facilitates the production of the light source. The power efficiency of the transmitter can also be enhanced. Besides since it is ensured that luminance L is not consecutive the receiver can easily demodulate the luminance change pattern.

An information communication method in this embodiment is an information communication method of transmitting a signal using a change in luminance the information communication method including determining a pattern of the change in luminance by modulating the signal to be transmitted and transmitting the signal by a light emitter changing in luminance according to the determined pattern wherein the pattern of the change in luminance is a pattern in which one of two different luminance values occurs in each arbitrary position in a predetermined duration and in the determining the pattern of the change in luminance is determined so that for each of different signals to be transmitted a luminance change position in the duration is different and an integral of luminance of the light emitter in the duration is a same value corresponding to preset brightness the luminance change position being a position at which the luminance rises or a position at which the luminance falls.

In this way the luminance change pattern is determined so that for each of the different signals 00 01 10 and 11 to be transmitted the position at which the luminance rises luminance change position is different and also the integral of luminance of the light emitter in the predetermined duration unit duration is the same value corresponding to the preset brightness e.g. 99 or 1 for instance as illustrated in . Thus the brightness of the light emitter can be maintained constant for each signal to be transmitted with it being possible to suppress flicker. In addition a receiver that captures the light emitter can appropriately demodulate the luminance change pattern based on the luminance change position. Furthermore since the luminance change pattern is a pattern in which one of two different luminance values luminance H High or luminance L Low occurs in each arbitrary position in the unit duration the brightness of the light emitter can be changed continuously.

For example the information communication method may include sequentially displaying a plurality of images by switching between the plurality of images wherein in the determining each time an image is displayed in the sequentially displaying the pattern of the change in luminance for identification information corresponding to the displayed image is determined by modulating the identification information as the signal and in the transmitting each time the image is displayed in the sequentially displaying the identification information corresponding to the displayed image is transmitted by the light emitter changing in luminance according to the pattern of the change in luminance determined for the identification information.

In this way each time an image is displayed the identification information corresponding to the displayed image is transmitted for instance as illustrated in . Based on the displayed image the user can easily select the identification information to be received by the receiver.

For example in the transmitting each time the image is displayed in the sequentially displaying identification information corresponding to a previously displayed image may be further transmitted by the light emitter changing in luminance according to the pattern of the change in luminance determined for the identification information.

In this way even in the case where as a result of switching the displayed image the receiver cannot receive the identification signal transmitted before the switching the receiver can appropriately receive the identification information transmitted before the switching because the identification information corresponding to the previously displayed image is transmitted together with the identification information corresponding to the currently displayed image for instance as illustrated in .

For example in the determining each time the image is displayed in the sequentially displaying the pattern of the change in luminance for the identification information corresponding to the displayed image and a time at which the image is displayed may be determined by modulating the identification information and the time as the signal and in the transmitting each time the image is displayed in the sequentially displaying the identification information and the time corresponding to the displayed image may be transmitted by the light emitter changing in luminance according to the pattern of the change in luminance determined for the identification information and the time and the identification information and a time corresponding to the previously displayed image may be further transmitted by the light emitter changing in luminance according to the pattern of the change in luminance determined for the identification information and the time.

In this way each time an image is displayed a plurality of sets of ID time information information made up of identification information and a time are transmitted for instance as illustrated in . The receiver can easily select from the received plurality of sets of ID time information a previously transmitted identification signal which the receiver cannot be received based on the time included in each set of ID time information.

For example the light emitter may have a plurality of areas each of which emits light and in the transmitting in the case where light from adjacent areas of the plurality of areas interferes with each other and only one of the plurality of areas changes in luminance according to the determined pattern of the change in luminance only an area located at an edge from among the plurality of areas may change in luminance according to the determined pattern of the change in luminance.

In this way only the area light emitting unit located at the edge changes in luminance for instance as illustrated in a in . The influence of light from another area on the luminance change can therefore be suppressed as compared with the case where only an area not located at the edge changes in luminance. As a result the receiver can capture the luminance change pattern appropriately.

For example in the transmitting in the case where only two of the plurality of areas change in luminance according to the determined pattern of the change in luminance the area located at the edge and an area adjacent to the area located at the edge from among the plurality of areas may change in luminance according to the determined pattern of the change in luminance.

In this way the area light emitting unit located at the edge and the area light emitting unit adjacent to the area located at the edge change in luminance for instance as illustrated in b in . The spatially continuous luminance change range has a wide area as compared with the case where areas apart from each other change in luminance. As a result the receiver can capture the luminance change pattern appropriately.

An information communication method in this embodiment is an information communication method of obtaining information from a subject the information communication method including transmitting position information indicating a position of an image sensor used to capture the subject receiving an ID list that is associated with the position indicated by the position information and includes a plurality of sets of identification information setting an exposure time of the image sensor so that in an image obtained by capturing the subject by the image sensor a bright line corresponding to an exposure line included in the image sensor appears according to a change in luminance of the subject obtaining a bright line image including the bright line by capturing the subject that changes in luminance by the image sensor with the set exposure time obtaining the information by demodulating data specified by a pattern of the bright line included in the obtained bright line image and searching the ID list for identification information that includes the obtained information.

In this way since the ID list is received beforehand even when the obtained information bc is only a part of identification information the appropriate identification information abcd can be specified based on the ID list for instance as illustrated in .

For example in the case where the identification information that includes the obtained information is not uniquely specified in the searching the obtaining of a bright line image and the obtaining of the information may be repeated to obtain new information and the information communication method may further include searching the ID list for the identification information that includes the obtained information and the new information.

In this way even in the case where the obtained information b is only a part of identification information and the identification information cannot be uniquely specified with this information alone the new information c is obtained and so the appropriate identification information abcd can be specified based on the new information and the ID list for instance as illustrated in .

An information communication method in this embodiment is an information communication method of obtaining information from a subject the information communication method including setting an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a bright line corresponding to an exposure line included in the image sensor appears according to a change in luminance of the subject obtaining a bright line image including the bright line by capturing the subject that changes in luminance by the image sensor with the set exposure time obtaining identification information by demodulating data specified by a pattern of the bright line included in the obtained bright line image transmitting the obtained identification information and position information indicating a position of the image sensor and receiving error notification information for notifying an error in the case where the obtained identification information is not included in an ID list that is associated with the position indicated by the position information and includes a plurality of sets of identification information.

In this way the error notification information is received in the case where the obtained identification information is not included in the ID list for instance as illustrated in . Upon receiving the error notification information the user of the receiver can easily recognize that information associated with the obtained identification information cannot be obtained.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED an organic EL device or the like in Embodiments 1 to 3 described above according to situation.

An example of application in a situation where a user carrying a receiver is in front of a store bearing an advertisement sign which functions as a transmitter is described first with reference to .

For example when a user carrying a receiver terminal device such as a smartphone is walking the user finds a sign of a store. The sign is a transmitter subject that transmits a signal using a change in luminance like the transmitter in any of Embodiments 1 to 3 described above. The user is interested in the store and upon determining that the sign is transmitting a signal by changing in luminance operates the receiver to start visible light communication application software hereafter referred to as communication application of the receiver .

The receiver may automatically start the communication application without being operated by the user. For example the receiver detects the current position of the receiver using a GPS a 9 axis sensor or the like and determines whether or not the current position is in a predetermined specific area for the sign . The specific area is an area near the sign . In the case of determining that the current position of the receiver is in the specific area the receiver starts the communication application. The receiver may also start the communication application upon detecting through its 9 axis sensor or the like the user sticking the receiver out or turning the receiver . This saves the user operation and provides ease of use.

After starting the communication application as described above the receiver captures visible light imaging the sign that functions as a transmitter for transmitting a signal using a change in luminance. That is the receiver performs visible light communication with the sign .

The receiver obtains an image including a bright line as a result of capturing the sign . The receiver obtains a device ID of the sign by demodulating data specified by the pattern of the bright line. That is the receiver obtains the device ID from the sign by visible light imaging or visible light communication in Embodiments 1 to 3. The receiver transmits the device ID to a server and obtains advertisement information service information associated with the device ID from the server.

The receiver may obtain the advertisement information associated with the device ID from a plurality of sets of advertisement information held beforehand. In this case when determining that the current position of the receiver is in the above mentioned specific area the receiver notifies the server of the specific area or the current position and obtains all device IDs corresponding to the specific area and advertisement information associated with each of the device IDs from the server and holds caches them beforehand. By doing so upon obtaining the device ID of the sign in the specific area the receiver can promptly obtain the advertisement information associated with the device ID of the sign from the pre stored advertisement information associated with each device ID with no need to request the advertisement information associated with the device ID from the server.

Upon obtaining the advertisement information associated with the device ID of the sign the receiver displays the advertisement information. For instance the receiver displays a coupon and availability of the store shown by the sign and a barcode indicating the same contents.

The receiver may obtain not only the device ID but also privilege data from the sign by visible light communication. For example the privilege data indicates a random ID random number the time at which or period during which the privilege data is transmitted or the like. In the case of receiving the privilege data the receiver transmits the privilege data to the server together with the device ID. The receiver then obtains advertisement information associated with the device ID and the privilege data. The receiver can thus receive different advertisement information according to the privilege data. As an example if the sign is captured early in the morning the receiver can obtain and display advertisement information indicating an early bird discount coupon. In other words the advertisement by the same sign can be varied according to the privilege data e.g. hours . As a result the user can be provided with a service suitable for hours and the like. In this embodiment the presentation display of information such as service information to the user is referred to as service provision .

The receiver may also obtain by visible light communication 3D information indicating the spatial placement of the sign with high accuracy within a tolerance of 1 m from the sign together with the device ID. Alternatively the receiver may obtain the 3D information associated with the device ID from the server. The receiver may obtain size information indicating the size of the sign instead of or together with the 3D information. In the case of receiving the size information the receiver can calculate the distance from the receiver to the sign based on the difference between the size of the sign indicated by the size information and the size of the sign shown in the captured image.

Moreover when transmitting the device ID obtained by visible light communication to the server the receiver may transmit retention information ancillary information retained in the receiver to the server together with the device ID. For instance the retention information is personal information e.g. age sex or a user ID of the user of the receiver . Having received the retention information together with the device ID the server transmits advertisement information associated with the retention information the personal information or user ID from among one or more sets of advertisement information associated with the device ID to the receiver . The receiver can thus receive store advertisement information suitable for the personal information and the like store advertisement information corresponding to the user ID or the like. As a result the user can be provided with a more valuable service.

As an alternative the retention information indicates a reception condition set in the receiver beforehand. For example in the case where the store is a restaurant the reception condition is the number of customers. Having received such retention information together with the device ID the server transmits advertisement information associated with the reception condition the number of customers from among one or more sets of advertisement information associated with the device ID to the receiver . The receiver can thus receive store advertisement information suitable for the number of customers such as availability information for the number of customers. The store can achieve customer attraction and profit optimization by displaying advertisement information with a different discount rate according to the number of customers the day of the week or the time of day.

As another alternative the retention information indicates the current position detected by the receiver beforehand. Having received such retention information together with the device ID the server transmits not only advertisement information associated with the device ID but also one or more other device IDs corresponding to the current position the current position and its surroundings indicated by the retention information and advertisement information associated with each of the other device IDs to the receiver . The receiver can cache the other device IDs and the advertisement information associated with each of the other device IDs. Accordingly when the receiver performs visible light communication with another transmitter in the current position the current position and its surroundings the receiver can promptly obtain advertisement information associated with the device ID of this other transmitter with no need to access the server.

Upon obtaining the advertisement information from the server as described above the receiver displays for example the Seats available button as the availability indicated by the advertisement information. When the user performs an operation of touching the Seats available button with his or her finger the receiver notifies the server of the operation. When notified of the operation the server makes a provisional reservation at the store of the sign and notifies the receiver of the completion of the provisional reservation. The receiver receives the notification from the server and displays the character string Provisional reservation indicating the completion of the provisional reservation instead of the Seats available button. The receiver stores an image including the coupon of the store shown by the sign the character string Provisional reservation proving the provisional reservation at the store and a barcode indicating the same contents in a memory as a prior obtainment image.

Here the server can log information relating to visible light communication performed between the sign and the receiver by the operation described with reference to . In detail the server can log the device ID of the transmitter sign performing visible light communication the location where visible light communication is performed the current position of the receiver the privilege data indicating for example the time when visible light communication is performed the personal information of the user of the receiver performing visible light communication and so on. Through the use of at least one of these logged sets of information the server can analyze the value of the sign i.e. the contribution of the sign to the advertisement of the store as advertising effectiveness.

An example of application in a situation where the user carrying the receiver enters the store corresponding to the displayed advertisement information service information is described next with reference to .

For example the user of the receiver that has performed visible light communication with the above mentioned sign enters the store corresponding to the displayed advertisement information. At this time the receiver detects the user entering the store corresponding to the advertisement information displayed using visible light communication i.e. detects the entrance . For instance after performing visible light communication with the sign the receiver obtains store information indicating the location of the store associated with the device ID of the sign from the server. The receiver then determines whether or not the current position of the receiver obtained using the GPS the 9 axis sensor or the like enters the location of the store indicated by the store information. The receiver detects the above mentioned entrance by determining that the current position enters the location of the store.

Upon detecting the entrance the receiver notifies a display device of the entrance via the server or the like. Alternatively the receiver notifies the display device of the entrance by visible light communication or wireless communication. When notified of the entrance the display device obtains product service information indicating for example a menu of products or services provided in the store and displays the menu indicated by the product service information. The display device may be a mobile terminal carried by the user of the receiver or the store staff or a device installed in the store.

The user selects a desired product from the menu displayed on the display device . In detail the user performs an operation of touching the part of the menu where the name of the desired product is displayed. The display device receives the product selection operation result.

Upon receiving the product selection operation result the display device displays an image representing the selected product and the price of the product. The display device thus prompts the user to confirm the selected product. The image representing the product information indicating the price of the product and the like are included for example in the above mentioned product service information.

When prompted to confirm the selected product the user performs an operation for ordering the product. After the operation is performed the receiver notifies payment information necessary for electronic payment to a POS Point of Sale system of the store via the display device or the server. The receiver also determines whether or not there is the above mentioned prior obtainment image which is obtained using visible light communication with the sign of the store and stored. In the case of determining that there is the prior obtainment image the receiver displays the prior obtainment image.

Though the display device is used in this situation the receiver may perform the processes by the display device instead without using the display device . In this case upon detecting the entrance the receiver obtains from the server the product service information indicating for example the menu of products or services provided in the store and displays the menu indicated by the product service information. Moreover upon receiving the operation for ordering the product the receiver notifies the ordered product and the payment information necessary for electronic payment to the POS system of the store via the server.

The store staff applies a barcode scanner of the POS system to the barcode in the prior obtainment image displayed on the receiver . The barcode scanner reads the barcode in the prior obtainment image. As a result the POS system completes the electronic payment according to the coupon indicated by the barcode. The barcode scanner of the POS system then transmits to the receiver payment completion information indicating the completion of the electronic payment by changing in luminance. Thus the barcode scanner also has a function as a transmitter in visible light communication. The receiver receives the payment completion information by visible light communication and displays the payment completion information. For example the payment completion information indicates the message Thank you for your purchase and the amount paid. As a result of such electronic payment the POS system the server and the receiver can determine that in the store corresponding to the advertisement information service information displayed in front of the store the user uses the service indicated by the advertisement information.

As described above the product in the store is ordered through the operation of the receiver the POS system and the like as illustrated in . Accordingly the user who has entered the store can order the product from the menu of the store automatically displayed on the display device or the receiver . In other words there is no need for the store staff to show the menu to the user and directly receive the order for the product from the user. This significantly reduces the burden on the store staff. Though the barcode scanner reads the barcode in the above example the barcode scanner may not be used. For instance the receiver may transmit the information indicated by the barcode to the POS system via the server. The receiver may then obtain the payment completion information from the POS system via the server. This further reduces the store staff s workload and allows the user to order the product without the store staff. Alternatively the display device and the receiver may transfer the order and charging data with each other by visible light communication or transfer the data by wireless communication using a key exchanged by visible light communication.

There is the case where the sign is displayed by one of a plurality of stores belonging to a chain. In such a case the advertisement information obtained from the sign using visible light communication can be used in all stores of the chain. Here the service provided to the user may be different between a store advertisement store displaying the sign and a store non advertisement store not displaying the sign even though they belong to the same chain. For example in the case where the user enters the non advertisement store the user receives the service of the discount rate e.g. 20 according to the coupon indicated by the prior obtainment image. In the case where the user enters the advertisement store the user receives the service of a higher discount rate e.g. 30 than the discount rate of the coupon. In detail in the case of detecting the entrance into the advertisement store the receiver obtains additional service information indicating an additional discount of 10 from the server and displays an image indicating a discount rate of 30 20 10 instead of the prior obtainment image illustrated in . Here the receiver detects whether the user enters the advertisement store or the non advertisement store based on the above mentioned store information obtained from the server. The store information indicates the location of each of the plurality of stores belonging to the chain and whether the store is the advertisement store or the non advertisement store.

In the case where a plurality of non advertisement stores are included in the chain the service provided to the user may be different in each of the non advertisement stores. For instance the service according to the distance from the position of the sign or the current position of the receiver when performing visible light communication with the sign to the non advertisement store is provided to the user entering the non advertisement store. Alternatively the service according to the difference time difference between the time at which the receiver and the sign perform visible light communication and the time at which the user enters the non advertisement store is provided to the user entering the non advertisement store. That is the receiver obtains from the server additional service information indicating an additional discount that differs depending on the above mentioned distance the position of the sign and time difference and displays an image indicating a discount rate e.g. 30 on which the additional discount has been reflected instead of the prior obtainment image illustrated in . Note that such a service is determined by the server or the POS system or by cooperation between the server and the POS system. The service may be applied to every store belonging to the chain regardless of whether the store is the advertisement store or the non advertisement store.

In the case where the user enters the non advertisement store and makes the order using the advertisement information the POS system of the non advertisement store may pass part of the amount earned as a result of the order to the POS system of the advertisement store.

Each time the advertisement information is displayed the server may determine whether or not the advertisement information is used. By collecting the determination results the server can easily analyze the advertising effectiveness of the sign . Moreover by collecting at least one of the position of the sign the time at which the advertisement information is displayed the position of the store in which the advertisement information is used the time at which the advertisement information is used and the time at which the user enters the store the server can improve the accuracy of analyzing the advertising effectiveness of the sign and find the position of the sign highest in advertising effectiveness.

The receiver may also obtain from the server additional service information indicating an additional discount corresponding to the number of times the advertisement information is used to order the product the number of uses and display an image indicating a discount rate e.g. 30 on which the additional discount corresponding to the number of uses has been reflected instead of the prior obtainment image illustrated in . For example the server may provide such a service that sets a higher discount rate when the number of uses is larger in cooperation with the POS system.

In the case where the receiver receives advertisement information associated with each of the device IDs of all signs displayed by the store i.e. in the case where the obtainment of all advertisement information is completed the server may provide a good value service to the user entering the store of the sign . Examples of the good value service include a service of a very high discount rate and a service of offering a product other than the ordered product free of charge. When the receiver detects the entrance of the user into the store the server determines whether or not the receiver has performed the process including visible light communication and the like on each of all signs associated with the store. In the case where the server determines that the receiver has performed the process the receiver obtains additional service information indicating an additional discount from the server as the above mentioned good value service and displays an image indicating a discount rate e.g. 50 on which the additional discount has been reflected instead of the prior obtainment image illustrated in .

The receiver may also obtain from the server additional service information indicating an additional discount that differs depending on the difference between the time at which the receiver performs visible light communication with the sign and displays the advertisement information and the time at which the user enters the store and display an image indicating a discount rate e.g. 30 on which the additional discount has been reflected instead of the prior obtainment image illustrated in . For instance the receiver obtains additional service information indicating a higher discount rate when the difference is smaller from the server.

Having completed the order and the electronic payment the receiver receives a signal transmitted from a transmitter such as a lighting device in the store by changing in luminance and transmits the signal to the server thus obtaining an in store guide map indicating the seat position e.g. black circle of the user. The receiver also specifies the position of the receiver using the received signal as in any of Embodiments 1 to 3 described above. The receiver displays the specified position e.g. star of the receiver in the guide map. This enables the user to easily find the way to his or her seat.

While the user is moving too the receiver frequently specifies the position of the receiver by performing visible light communication with a nearby transmitter such as a lighting device in the store. Hence the receiver sequentially updates the displayed position e.g. start of the receiver . The user can be appropriately guided to the seat in this manner.

When the user is seated the receiver specifies the position of the receiver by performing visible light communication with a transmitter such as a lighting device and determines that the position is the seat position of the user. The receiver notifies together with the user name or nickname that the user is seated to a terminal in the store via the server. This enables the store staff to recognize which seat the user is in.

The transmitter transmits a signal including a customer ID and a message informing that the ordered product is ready by changing in luminance. Note that for example when obtaining the product service information indicating the product menu and the like from the server the receiver also obtains the customer ID from the server and holds it. The receiver receives the signal by performing visible light imaging on the transmitter . The receiver determines whether or not the customer ID included in the signal matches the customer ID held beforehand. In the case of determining that they match the receiver displays the message e.g. Your order is ready included in the signal.

The store staff having delivered the ordered product to the user s seat directs a handheld terminal to the receiver in order to prove that the ordered product has been delivered. The handheld terminal functions as a transmitter. The handheld terminal transmits to the receiver a signal indicating the delivery of the ordered product by changing in luminance. The receiver captures the handheld terminal to receive the signal and displays a message e.g. Please enjoy your meal indicated by the signal.

An example of application in a situation where the user carrying the receiver is searching for a store of interest is described below with reference to .

The user finds a signage showing restaurants of interest. Upon determining that the signage is transmitting a signal by changing in luminance the user operates the receiver to start the communication application of the receiver as in the example illustrated in . Alternatively the receiver may automatically start the communication application as in the example illustrated in .

The receiver captures the entire signage or a part of the signage showing a restaurant of the user s interest to receive an ID for identifying the signage or the restaurant.

Upon receiving the ID mentioned above the receiver transmits the ID to the server and obtains advertisement information service information associated with the ID from the server and displays it. Here the receiver may notify the number of people ancillary information who are about to enter the restaurant to the server together with the ID. As a result the receiver can obtain advertisement information corresponding to the number of people. For example the receiver can obtain advertisement information indicating that seats are available in the restaurant for the notified number of people.

An example of application in a situation where the user carrying the receiver is in front of a signage including a movie advertisement of interest is described below with reference to .

The user finds a signage including a movie advertisement of interest and a signage such as a liquid crystal display for displaying movie advertisement video. The signage includes for example a transparent film on which an image representing the movie advertisement is drawn and a plurality of LEDs arranged on the back side of the film and lights the film. That is the signage brightly displays the image drawn on the film by the light emission from the plurality of LEDs as a still image. The signage is a transmitter for transmitting a signal by changing in luminance.

Upon determining that the signage is transmitting a signal by changing in luminance the user operates the receiver to start the communication application of the receiver as in the example illustrated in . Alternatively the receiver may automatically start the communication application as in the example illustrated in .

The receiver captures the signage to obtain the ID of the signage . The receiver transmits the ID to the server downloads movie advertisement video data associated with the ID from the server as service information and reproduces the video.

Video displayed by reproducing the downloaded video data as mentioned above is the same as the video displayed by the signage as an example. Accordingly in the case where the user wants to watch the movie advertisement video the user can watch the video in any location without stopping in front of the signage .

The receiver may download not only the video data but also showing information indicating the showtimes of the movie and the like together with the video data as service information. The receiver can then display the showing information to inform the user and also share the showing information with other terminals e.g. other smartphones .

An example of application in a situation where the user carrying the receiver enters a museum to appreciate each exhibit in the museum is described below with reference to .

For example when entering the museum the user finds a signboard on the entrance of the museum. Upon determining that the signboard is transmitting a signal by changing in luminance the user operates the receiver to start the communication application of the receiver as in the example illustrated in . Alternatively the receiver may automatically start the communication application as in the example illustrated in .

The receiver captures the signboard to obtain the ID of the signboard . The receiver transmits the ID to the server downloads a guide application program of the museum hereafter referred to as museum application from the server as service information associated with the ID and starts the museum application.

After the museum application starts the receiver displays a museum guide map according to the museum application. The receiver also specifies the position of the receiver in the museum as in any of Embodiments 1 to 3 described above. The receiver displays the specified position e.g. star of the receiver in the guide map.

To specify the position as mentioned above the receiver obtains form information indicating the size shape and the like of the signboard from the server for example when downloading the museum application. The receiver specifies the relative position of the receiver to the signboard by triangulation or the like based on the size and shape of the signboard indicated by the form information and the size and shape of the signboard shown in the captured image.

When the user enters the museum the receiver which has started the museum application as mentioned above frequently specifies the position of the receiver by performing visible light communication with a nearby transmitter such as a lighting device in the museum. For example the receiver captures a transmitter such as a lighting device to obtain the ID of the transmitter from the transmitter . The receiver then obtains position information indicating the position of the transmitter and form information indicating the size shape and the like of the transmitter which are associated with the ID from the server. The receiver estimates the relative position of the receiver to the transmitter by triangulation or the like based on the size and shape of the transmitter indicated by the form information and the size and shape of the transmitter shown in the captured image. The receiver also specifies the position of the receiver in the museum based on the position of the transmitter indicated by the position information obtained from the server and the estimated relative position of the receiver .

Each time the position of the receiver is specified the receiver moves the displayed star to the specified new position. The user who has entered the museum can easily know his or her position in the museum from the guide map and the star displayed on the receiver .

The user who has entered the museum upon finding an exhibit of interest performs an operation of pointing the receiver at the exhibit so that the receiver can capture the exhibit . Here the exhibit is lit by light from a lighting device . The lighting device is used exclusively for the exhibit and is a transmitter for transmitting a signal by changing in luminance. Accordingly the exhibit which is lit by the light changing in luminance is indirectly transmitting the signal from the lighting device .

Upon detecting the operation of pointing the receiver at the exhibit based on the output from the internal 9 axis sensor or the like the receiver captures the exhibit to receive the signal from the lighting device . The signal indicates the ID of the exhibit as an example. The receiver then obtains introduction information service information of the exhibit associated with the ID from the server. The introduction information indicates a figure for introducing the exhibit and text for introduction in the language of each country such as Japanese English and French.

Having obtained the introduction information from the server the receiver displays the figure and the text indicated by the introduction information. When displaying the text the receiver extracts text of a language set by the user beforehand from among text of each language and displays only the text of the language. The receiver may change the language according to a selection operation by the user.

After the display of the figure and the text in the introduction information ends according to a user operation the receiver again specifies the position of the receiver by performing visible light communication with a nearby transmitter such as a lighting device e.g. a lighting device . Upon specifying the new position of the receiver the receiver moves the displayed star to the specified new position. Hence the user who has appreciated the exhibit can easily move to the next exhibit of interest by referring to the guide map and the star displayed on the receiver .

An example of application in a situation where the user carrying the receiver is at a bus stop is described below with reference to .

For example the user goes to the bus stop to ride a bus. Upon determining that a sign at the bus stop is transmitting a signal by changing in luminance the user operates the receiver to start the communication application of the receiver as in the example illustrated in . Alternatively the receiver may automatically start the communication application as in the example illustrated in .

The receiver captures the sign to obtain the ID of the bus stop where the sign is placed. The receiver transmits the ID to the server and obtains operation state information associated with the ID from the server. The operation state information indicates the traffic state and is service information indicating a service provided to the user.

Here the server collects information from each bus operating in an area including the bus stop to manage the operation state of each bus. Hence upon obtaining the ID of the bus stop from the receiver the server estimates the time at which a bus arrives at the bus stop of the ID based on the managed operation state and transmits the operation state information indicating the estimated time to the receiver .

Having obtained the operation state information the receiver displays the time indicated by the operation state information in a form such as Arriving in 10 minutes . This enables the user to easily recognize the operation state of the bus.

In the case where the scan direction on the imaging side is the vertical direction up down direction of a mobile terminal when an LED lighting device is captured with a shorter exposure time bright lines of a black and white pattern can be captured in the same direction as the scan direction for ON OFF of the entire LED lighting device as illustrated in a in . In a in a vertically long LED lighting device is captured so that its longitudinal direction is perpendicular to the scan direction on the imaging side the left right direction of the mobile terminal and therefore many bright lines of the black and white pattern can be captured in the same direction as the scan direction. In other words a larger amount of information can be transmitted and received. On the other hand in the case where the vertically long LED lighting device is captured so as to be parallel to the scan direction on the imaging side the up down direction of the mobile terminal as illustrated in b in the number of bright lines of the black and white pattern that can be captured decreases. In other words the amount of information that can be transmitted decreases.

Thus depending on the direction of the LED lighting device with respect to the scan direction on the imaging side many bright lines of the black and white pattern can be captured in the case where the vertically long LED lighting device is captured so that its longitudinal direction is perpendicular to the scan direction on the imaging side or only a few bright lines of the black and white pattern can be captured in the case where the vertically long LED lighting device is captured so that its longitudinal direction is parallel to the scan direction on the imaging side .

This embodiment describes a lighting device control method capable of capturing many bright lines even in the case where only a few bright lines of the black and white pattern can be captured.

 c and d in illustrate an example of generating the black and white pattern and turning each LED element ON or OFF for lighting. When the lighting device lights as the black and white pattern the light may become not uniform even in a short time. In view of this an example of generating a reverse phase pattern and performing lighting alternately between the two patterns is illustrated in c and d in . Each element that is ON in c in is OFF in d in whereas each element that is OFF in c in is ON in d in . By lighting in the black and white pattern alternately between the normal phase pattern and the reverse phase pattern in this way a lot of information can be transmitted and received in visible light communication without causing the light to become not uniform and without being affected by the relation between the scan direction on the imaging side and the direction of the lighting device. The present disclosure is not limited to the case of alternately generating two types of patterns i.e. the normal phase pattern and the reverse phase pattern for lighting as three or more types of patterns may be generated for lighting. illustrates an example of lighting in four types of patterns in sequence.

A structure in which usually the entire LED lighting blinks b in and only for a predetermined time the black and white pattern is generated to perform lighting on an LED element basis is also available. As an example the entire LED lighting blinks for a transmission and reception time of a predetermined data unit and subsequently lighting is performed in the black and white pattern on an LED element basis for a short time. The predetermined data unit is for instance a data unit from the first header to the next header. In this case when the LED lighting is captured in the direction in a in a signal is received from bright lines obtained by capturing the blink of the entire LED lighting. When the LED lighting is captured in the direction in b in a signal is received from a light emission pattern on an LED element basis.

This embodiment is not limited to an LED lighting device and is applicable to any device whose ON OFF can be controlled in units of small elements like LED elements. Moreover this embodiment is not limited to a lighting device and is applicable to other devices such as a television a projector and a signage.

Though an example of lighting in the black and white pattern is described in this embodiment colors may be used instead of the black and white pattern. As an example in RGB blink may be performed using only B while R and G are constantly ON. The use of only B rather than R or G prevents recognition by humans and therefore suppresses flicker. As another example additive complementary colors e.g. a red and cyan pattern a green and magenta pattern a yellow and blue pattern may be used to display ON OFF instead of the black and white pattern. The use of additive complementary colors suppresses flicker.

Though an example of one dimensionally arranging LED elements is described in this embodiment LED elements may be arranged not one dimensionally but two dimensionally so as to be displayed like a 2D barcode.

A service provision method in this embodiment is a service provision method of providing using a terminal device that includes an image sensor having a plurality of exposure lines a service to a user of the terminal device the service provision method including obtaining image data by starting exposure sequentially for the plurality of exposure lines in the image sensor each at a different time and capturing a subject with an exposure time less than or equal to 1 480 second so that an exposure time of each of the plurality of exposure lines partially overlaps an exposure time of an adjacent one of the plurality of exposure lines obtaining identification information of the subject by demodulating a bright line pattern that appears in the image data the bright line pattern corresponding to the plurality of exposure lines and presenting service information associated with the identification information of the subject to the user.

In this way through the use of communication between the subject and the terminal device respectively as a transmitter and a receiver the service information relating to the subject can be presented to the user of the terminal device. The user can thus be provided with information variable to the user in various forms as a service. For example in the presenting at least one of information indicating an advertisement availability or reservation status of a store relating to the subject information indicating a discount rate of a product or a service movie advertisement video information indicating a showtime of a movie information for guiding in a building information for introducing an exhibit and information indicating a traffic state may be presented as the service information.

For example the service provision method may further include transmitting by the terminal device the identification information of the subject to a server and obtaining by the terminal device the service information associated with the identification information of the subject from the server wherein in the presenting the terminal device presents the obtained service information to the user.

In this way the service information can be managed in the server in association with the identification information of the subject which contributes to ease of maintenance such as service information update.

For example in the transmitting ancillary information may be transmitted to the server together with the identification information of the subject and in the obtaining of the service information the service information associated with the identification information of the subject and the ancillary information may be obtained.

In this way a more suitable service for the user can be provided according to the ancillary information. For example in the transmitting personal information of the user identification information of the user number information indicating the number of people of a group including the user or position information indicating a position of the terminal device may be transmitted as the ancillary information as in the operation described with reference to .

For example the service provision method may further include transmitting by the terminal device position information indicating a position of the terminal device to the server and obtaining by the terminal device one or more sets of identification information of respective one or more devices located in a predetermined range including the position indicated by the position information and one or more sets of service information respectively associated with the one or more sets of identification information from the server and holding the one or more sets of identification information and the one or more sets of service information wherein in the presenting the terminal device selects service information associated with the identification information of the subject from the one or more sets of service information held in the obtaining of the identification information and presents the service information to the user.

In this way when the terminal device obtains the identification information of the subject the terminal device can obtain the service information associated with the identification information of the subject from the one or more sets of service information held beforehand and present the service information without communicating with the server or the like as in the operation described with reference to as an example. Faster service provision can therefore be achieved.

For example the service provision method may further include determining whether or not the user enters a store corresponding to the service information presented in the presenting by specifying a position of the user and in the case of determining that the user enters the store obtaining by the terminal device product service information relating to a product or a service of the store from the server and presenting the product service information to the user.

In this way when the user enters the store the menu of the store or the like can be automatically presented to the user as the product service information as in the operation described with reference to as an example. This saves the need for the store staff to present the menu or the like to the user and enables the user to make an order to the store in a simple manner.

For example the service provision method may further include determining whether or not the user enters a store corresponding to the service information presented in the presenting by specifying a position of the user and in the case of determining that the user enters the store presenting by the terminal device additional service information of the store to the user the additional service information being different depending on at least one of the position of the subject and a time at which the service information is presented.

In this way when the subject is closer to the store which the user enters or when the time at which the user enters the store and the time at which the service information is presented or the time at which the subject is captured are closer to each other service information more valuable to the user can be presented to the user as the additional service information as in the process described with reference to as an example. Suppose each of a plurality of stores belonging to a chain is a store corresponding to the presented service information and a sign which is the subject is displayed by one advertisement store of the plurality of stores. In such a case the advertisement store is usually closest to the subject sign from among the plurality of stores belonging to the chain. Accordingly when the subject is closer to the store which the user enters or when the time at which the user enters the store and the time at which the service information is presented are closer to each other there is a high possibility that the store which the user enters is the advertisement store. In the case where there is a high possibility that the user enters the advertisement store service information more valuable to the user can be presented to the user as the additional service information.

For example the service provision method may further include determining whether or not the user enters a store corresponding to the service information presented in the presenting by specifying a position of the user and in the case of determining that the user enters the store presenting by the terminal device additional service information of the store to the user the additional service information being different depending on the number of times the user uses a service indicated by the service information in the store.

In this way when the number of times the service is used is larger service information more valuable to the user can be presented to the user as the additional service information as in the operation described with reference to as an example. For instance when the number of uses of service information indicating 20 product price discount exceeds a threshold additional service information indicating additional 10 discount can be presented to the user.

For example the service provision method may further include determining whether or not the user enters a store corresponding to the service information presented in the presenting by specifying a position of the user in the case of determining that the user enters the store determining whether or not a process including the obtaining of image data the obtaining of identification information and the presenting is also performed for all subjects associated with the store other than the subject and presenting by the terminal device additional service information of the store to the user in the case of determining that the process is performed.

In this way for instance in the case where the store displays several subjects as signs and the obtaining of image data the obtaining of identification information and the presenting have been performed for all of these signs service information most valuable to the user can be presented to the user as the additional service information as in the operation described with reference to as an example.

For example the service provision method may further include determining whether or not the user enters a store corresponding to the service information presented in the presenting by specifying a position of the user and in the case of determining that the user enters the store presenting by the terminal device additional service information of the store to the user the additional service information being different depending on a difference between a time at which the service information is presented and a time at which the user enters the store.

In this way when the difference between the time at which the service information is presented or the time at which the subject is captured and the time at which the user enters the store is smaller service information more valuable to the user can be presented to the user as the additional service information as in the operation described with reference to as an example. That is the time from when the service information is presented to the user as a result of capturing the subject to when the user enters the store is shorter the user is additionally provided with a more valuable service.

For example the service provision method may further include determining whether or not the user uses a service indicated by the service information in a store corresponding to the service information presented in the presenting and accumulating each time the service information is presented a determination result in the determining and analyzing an advertising effect of the subject based on an accumulation result.

In this way in the case where the service information indicates a service such as 20 product price discount or the like it is determined whether or not the service is used by electronic payment or the like as in the operation described with reference to as an example. Thus each time the service is provided to the user upon capturing the subject whether or not the service is used is determined. As a result the advertising effect of the subject is analyzed as high in the case where for example it is frequently determined that the service is used. Hence the advertising effect of the subject can be appropriately analyzed based on the use result.

For example in the analyzing at least one of a position of the subject a time at which the service information is presented a position of the store and a time at which the user enters the store may be accumulated together with the determination result in the determining to analyze the advertising effect of the subject based on an accumulation result.

In this way the advertising effect of the subject can be analyzed in more detail. For instance in the case where the position of the subject is changed it is possible to compare the advertising effect between the original position and the changed position as a result of which the subject can be displayed at a position with higher advertising effectiveness.

For example the service provision method may further include determining whether or not the user uses a service indicated by the service information in a store corresponding to the service information presented in the presenting in the case of determining that the user uses the service determining whether or not a used store which is the store where the service is used is a specific store associated with the subject and in the case of determining that the used store is not the specific store returning at least a part of an amount paid for using the service in the store to the specific store using electronic commerce.

In this way even in the case where the service is not used in the specific store e.g. the advertisement store displaying the sign which is the subject the specific store can earn a profit for the cost of installing the sign which is the subject as in the operation described with reference to as an example.

For example in the presenting the terminal device may present the service information for introducing the subject to the user in the case where the subject lit by light changing in luminance is captured in the obtaining of the image data and the terminal device may present the service information for guiding in a building in which the subject is placed in the case where a lighting device changing in luminance is captured as the subject in the obtaining of the image data.

In this way a guide service in a building such as a museum and an introduction service for an exhibit which is the subject can be appropriately provided to the user as in the operation described with reference to as an example.

An information communication method in this embodiment is an information communication method of obtaining information from a subject having a plurality of light emitting elements the information communication method including setting an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a bright line corresponding to an exposure line included in the image sensor appears according to a change in luminance of the subject obtaining a bright line image by capturing by the image sensor with the set exposure time the subject in which the plurality of light emitting elements all change in luminance in the same manner according to a pattern of the change in luminance for representing first information the bright line image being an image including the bright line obtaining the first information by demodulating data specified by a pattern of the bright line included in the obtained bright line image and obtaining second information by capturing the subject in which each of the plurality of light emitting elements emits light with one of two different luminance values and demodulating data specified by a light and dark sequence of luminance along a direction parallel to the exposure line the light and dark sequence being shown in an image obtained by capturing the subject.

Alternatively an information communication method in this embodiment is an information communication method of transmitting a signal using a change in luminance the information communication method including determining a pattern of the change in luminance by modulating a first signal to be transmitted transmitting the first signal by all of a plurality of light emitting elements in a light emitter changing in luminance in the same manner according to the determined pattern of the change in luminance and transmitting a second signal to be transmitted by each of the plurality of light emitting elements emitting light with one of two different luminance values so that a light and dark sequence of luminance appears in a space where the light emitter is placed.

In this way even when a lighting device which is the subject or the light emitter has a long and thin shape including a plurality of LEDs arranged in a line the receiver can appropriately obtain the information or signal from the lighting device regardless of the imaging direction as in the operation described with reference to as an example. In detail in the case where the exposure line the operation direction on the imaging side of the image sensor included in the receiver is not parallel to the arrangement direction of the plurality of LEDs the receiver can appropriately obtain the information or signal from the luminance change of the entire lighting device. Even in the case where the exposure line is parallel to the arrangement direction the receiver can appropriately obtain the information or signal from the light and dark sequence of luminance along the direction parallel to the exposure line. In other words the dependence of information reception on the imaging direction can be reduced.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED an organic EL device or the like in Embodiments 1 to 4 described above.

Transmitters and each have the same function as the transmitter in any of Embodiments 1 to 4 described above and is a lighting device that transmits a signal by changing in luminance visible light communication . The transmitters to each transmit a signal by changing in luminance at a different frequency. For example the transmitter transmits the ID 1000 of the transmitter by changing in luminance at frequency a e.g. 9200 Hz . The transmitter transmits the ID 2000 of the transmitter by changing in luminance at frequency b e.g. 9600 Hz . The transmitter transmits the ID 3000 of the transmitter by changing in luminance at frequency c e.g. 10000 Hz .

A receiver captures visible light imaging the transmitters to so that the transmitters to are all included in the angle of view in the same way as in Embodiments 1 to 4. A bright line pattern corresponding to each transmitter appears in an image obtained as a result of image capture. It is possible to specify from the bright line pattern the luminance change frequency of the transmitter corresponding to the bright line pattern.

Suppose the frequencies of the transmitters to are the same. In such a case the same frequency is specified from the bright line pattern corresponding to each transmitter. In the case where these bright line patterns are adjacent to each other it is difficult to distinguish between the bright line patterns because the frequency specified from each of the bright line patterns is the same.

In view of this the transmitters to each change in luminance at a different frequency as mentioned above. As a result the receiver can easily distinguish between the bright line patterns and by demodulating data specified by each bright line pattern appropriately obtain the ID of each of the transmitters to . Thus the receiver can appropriately distinguish between the signals from the transmitters to .

The frequency of each of the transmitters to may be set by a remote control and may be set randomly. Each of the transmitters to may communicate with its adjacent transmitter and automatically set the frequency of the transmitter so as to be different from the frequency of the adjacent transmitter.

In the above example each transmitter changes in luminance at a different frequency. In the case where there are at least five transmitters however each transmitter need not change in luminance at a different frequency. In detail each of the at least five transmitters may change in luminance at any one of four types of frequencies.

For example as illustrated in even in a situation where the bright line patterns rectangles in respectively corresponding to the at least five transmitters are adjacent the same number of types of frequencies as the number of transmitters are not needed. So long as there are four types frequencies a b c and d it can be ensured that the frequencies of adjacent bright line patterns are different. This is reasoned by the four color theorem or the four color problem.

In detail in this embodiment each of the plurality of transmitters changes in luminance at any one of at least four types of frequencies and two or more light emitters of the plurality of transmitters change in luminance at the same frequency. Moreover the plurality of transmitters each change in luminance so that the luminance change frequency is different between all transmitters bright line patterns as transmitter images which in the case where the plurality of transmitters are projected on the light receiving surface of the image sensor of the receiver are adjacent to each other on the light receiving surface.

A transmitter changes in luminance to output high luminance light H or low luminance light L per predetermined time unit slot thereby transmitting a signal. Here the transmitter transmits a signal for each block made up of a header and a body. The header is expressed as L H L H L H H using seven slots as illustrated in as an example. The body is made up of a plurality of symbols 00 01 10 or 11 where each symbol is expressed using four slots 4 value PPM . The block is expressed using a predetermined number 19 in the example in of slots. For instance an ID is obtained by combining the body included in each of four blocks. The block may instead be expressed using 33 slots.

A bright line pattern obtained by image capture by a receiver includes a pattern header pattern corresponding to the header and a pattern data pattern corresponding to the body. The data pattern does not include the same pattern as the header pattern. Accordingly the receiver can easily find the header pattern from the bright line pattern and measure the number of pixels between the header pattern and the next header pattern the number of exposure lines corresponding to the block . Since the number of slots per block 19 in the example in is set to a fixed number regardless of the frequency the receiver can specify the frequency the inverse of the duration of one slot of the transmitter according to the measured number of pixels. That is the receiver specifies a lower frequency when the number of pixels is larger and a higher frequency when the number of pixels is smaller.

Thus by capturing the transmitter the receiver can obtain the ID of the transmitter and also specify the frequency of the transmitter. Through the use of the specified frequency the receiver can determine whether or not the obtained ID is correct that is perform error detection on the ID. In detail the receiver calculates a hash value for the ID and compares the hash value with the specified frequency. In the case where the hash value and the frequency match the receiver determines that the obtained ID is correct. In the case where the hash value and the frequency do not match the receiver determines that the obtained ID is incorrect error . For instance the receiver uses the remainder when dividing the ID by a predetermined divisor as the hash value. Conversely the transmitter transmits the ID by changing in luminance at the frequency the inverse of the duration of one slot of the same value as the hash value for the ID.

The transmitter may change in luminance using an arbitrary frequency instead of using the frequency of the same value as the hash value as mentioned above. In this case the transmitter transmits a signal indicating a value different from the ID of the transmitter. For example in the case where the ID of the transmitter is 100 and the transmitter uses 2 kHz as an arbitrary frequency the transmitter transmits the signal 1002 that combines the ID and the frequency. Likewise in the case where the ID of another transmitter is 110 and this other transmitter uses 1 kHz as an arbitrary frequency the other transmitter transmits the signal 1101 that combines the ID and the frequency.

In such a case the receiver uses the value of the last digit of the signal obtained from the transmitter for error detection and extracts the value of the other digits as the ID of the transmitter. The receiver compares the frequency specified from the luminance pattern and the value of the last digit of the obtained signal. In the case where the value of the last digit and the frequency match the receiver determines that the extracted ID is correct. In the case where the value of the last digit and the frequency do not match the receiver determines that the extracted ID is incorrect error .

In this way the degree of freedom in setting the luminance change frequency in the transmitter can be increased while enabling error detection in the receiver.

As illustrated in there is the case where in an image obtained by image capture visible light imaging by the receiver a part of a bright line pattern and a part of a bright line pattern overlap each other. In such a case the receiver does not demodulate data from an overlapping part of the bright line patterns and and demodulates data from the parts of the bright line patterns and other than the part . By doing so the receiver can obtain an appropriate ID from each of the bright line patterns and

The transmitter switches for each block as an example the luminance change frequency for transmitting the block as illustrated in a in . This enables the receiver to detect the block boundary more easily.

Moreover the transmitter uses different frequencies as the luminance change frequency for transmitting the header of the block and the luminance change frequency for transmitting the body of the block as an example as illustrated in b in . This prevents the same pattern as the header from occurring in the body. As a result the receiver can distinguish between the header and the body more appropriately.

The system in this embodiment includes a transmitter a receiver and a server . The transmitter has the same function as the transmitter in any of Embodiments 1 to 4 described above and is a lighting device that transmits the ID of the transmitter by changing in luminance visible light communication . The receiver has the same function as the receiver in any of Embodiments 1 to 4 described above and obtains the ID of the transmitter from the transmitter by capturing the transmitter visible light imaging . The server communicates with the transmitter and the receiver via a network such as the Internet.

Note that in this embodiment the ID of the transmitter is fixed without a change. Meanwhile the frequency used for the luminance change visible light communication of the transmitter can be arbitrarily changed by setting.

In such a system first the transmitter registers the frequency used for the luminance change visible light communication in the server . In detail the transmitter transmits the ID of the transmitter registered frequency information indicating the frequency of the transmitter and related information relating to the transmitter to the server . Upon receiving the ID registered frequency information and related information of the transmitter the server records them in association with each other. That is the ID of the transmitter the frequency used for the luminance change of the transmitter and the related information are recorded in association with each other. The frequency used for the luminance change of the transmitter is registered in this way.

Next the transmitter transmits the ID of the transmitter by changing in luminance at the registered frequency. The receiver captures the transmitter to obtain the ID of the transmitter and specifies the luminance change frequency of the transmitter as mentioned above.

The receiver then transmits the obtained ID and specified frequency information indicating the specified frequency to the server . Upon receiving the ID and the specified frequency information transmitted from the receiver the server searches for the frequency the frequency indicated by the registered frequency information recorded in association with the ID and determines whether or not the recorded frequency and the frequency indicated by the specified frequency information match. In the case of determining that the frequencies match the server transmits the related information data recorded in association with the ID and the frequency to the receiver .

If the frequency specified by the receiver does not match the frequency registered in the server the related information is not transmitted from the server to the receiver . Therefore by changing the frequency registered in the server according to need it is possible to prevent a situation where once the receiver has obtained the ID from the transmitter the receiver can receive the related information from the server at any time. In detail by changing the frequency registered in the server i.e. the frequency used for the luminance change the transmitter can prohibit the receiver that has obtained the ID before the change from obtaining the related information. In other words by changing the frequency it is possible to set a time limit for the obtainment of the related information. As an example in the case where the user of the receiver stays at a hotel in which the transmitter is installed an administrator in the hotel changes the frequency after the stay. Hence the receiver can obtain the related information only on the date when the user stays at the hotel and is prohibited from obtaining the related information after the stay.

The server may register a plurality of frequencies in association with one ID. For instance each time the server receives the registered frequency information from the receiver the server registers the frequencies indicated by four latest sets of registered frequency information in association with the ID. This allows even the receiver which obtained the ID in the past to obtain the related information from the server until the frequency is changed three times. The server may also manage for each registered frequency the time at which or period during which the frequency is set in the transmitter . In such a case upon receiving the ID and the specified frequency information from the receiver the server can specify the period during which the receiver obtains the ID by referring to the time period and the like managed for the frequency indicated by the specified frequency information.

A transmitter has the same function as the transmitter in any of Embodiments 1 to 4 described above and includes a frequency storage unit an ID storage unit a check value storage unit a check value comparison unit a check value calculation unit a frequency calculation unit a frequency comparison unit a transmission unit and an error reporting unit .

The frequency storage unit stores the frequency used for the luminance change visible light communication . The ID storage unit stores the ID of the transmitter . The check value storage unit stores a check value for determining whether or not the ID stored in the ID storage unit is correct.

The check value calculation unit reads the ID stored in the ID storage unit and applies a predetermined function to the ID to calculate a check value calculated check value for the ID. The check value comparison unit reads the check value stored in the check value storage unit and compares the check value with the calculated check value calculated by the check value calculation unit . In the case of determining that the calculated check value is different from the check value the check value comparison unit notifies an error to the error reporting unit . For example the check value storage unit stores the value 0 indicating that the ID stored in the ID storage unit is an even number as the check value. The check value calculation unit reads the ID stored in the ID storage unit and divides it by the value 2 to calculate the remainder as the calculated check value. The check value comparison unit compares the check value 0 and the calculated check value which is the remainder of the division mentioned above.

The frequency calculation unit reads the ID stored in the ID storage unit via the check value calculation unit and calculates the frequency calculated frequency from the ID. For instance the frequency calculation unit divides the ID by a predetermined value to calculate the remainder as the frequency. The frequency comparison unit compares the frequency stored frequency stored in the frequency storage unit and the calculated frequency. In the case of determining that the calculated frequency is different from the stored frequency the frequency comparison unit notifies an error to the error reporting unit .

The transmission unit transmits the ID stored in the ID storage unit by changing in luminance at the calculated frequency calculated by the frequency calculation unit .

The error reporting unit when notified of the error from at least one of the check value comparison unit and the frequency comparison unit reports the error by buzzer sound blink or lighting. In detail the error reporting unit includes a lamp for error reporting and reports the error by lighting or blinking the lamp. Alternatively when the power switch of the transmitter is turned on the error reporting unit reports the error by blinking at a frequency perceivable by humans a light source that changes in luminance to transmit a signal such as an ID for a predetermined period e.g. 10 seconds .

Thus whether or not the ID stored in the ID storage unit and the frequency calculated from the ID are correct is checked with it being possible to prevent erroneous ID transmission and luminance change at an erroneous frequency.

A receiver has the same function as the receiver in any of Embodiments 1 to 4 described above and includes a light receiving unit a frequency detection unit an ID detection unit a frequency comparison unit and a frequency calculation unit .

The light receiving unit includes an image sensor as an example and captures visible light imaging a transmitter that changes in luminance to obtain an image including a bright line pattern. The ID detection unit detects the ID of the transmitter from the image. That is the ID detection unit obtains the ID of the transmitter by demodulating data specified by the bright line pattern included in the image. The frequency detection unit detects the luminance change frequency of the transmitter from the image. That is the frequency detection unit specifies the frequency of the transmitter from the bright line pattern included in the image as in the example described with reference to .

The frequency calculation unit calculates the frequency of the transmitter from the ID detected by the ID detection unit for example by dividing the ID as mentioned above. The frequency comparison unit compares the frequency detected by the frequency detection unit and the frequency calculated by the frequency calculation unit . In the case where these frequencies are different the frequency comparison unit determines that the detected ID is an error and causes the ID detection unit to detect the ID again. Obtainment of an erroneous ID can be prevented in this way.

The transmitter may transmit each of the symbols 00 01 10 11 separately by making the luminance change position in a predetermined time unit different.

For example when transmitting the symbol 00 the transmitter transmits the symbol 00 by changing in luminance only for a first section which is the first section in the time unit. When transmitting the symbol 01 the transmitter transmits the symbol 01 by changing in luminance only for a second section which is the second section in the time unit. Likewise when transmitting the symbol 10 the transmitter transmits the symbol 10 by changing in luminance only for a third section which is the third section in the time unit. When transmitting the symbol 11 the transmitter transmits the symbol 11 by changing in luminance only for a fourth section which is the fourth section in the time unit.

Thus in this embodiment the luminance changes in one section regardless of which symbol is transmitted so that flicker can be suppressed as compared with the above mentioned transmitter that causes one entire section slot to be low in luminance.

The transmitter may transmit each of the symbols 0 1 separately by making whether or not the luminance changes in a predetermined time unit different. For example when transmitting the symbol 0 the transmitter transmits the symbol 0 by not changing in luminance in the time unit. When transmitting the symbol 1 the transmitter transmits the symbol 1 by changing in luminance in the time unit.

The transmitter may transmit each of the symbols 00 01 10 11 separately by making the luminance change frequency in a predetermined time unit different. For example when transmitting the symbol 00 the transmitter transmits the symbol 00 by not changing in luminance in the time unit. When transmitting the symbol 01 the transmitter transmits the symbol 01 by changing in luminance changing in luminance at a low frequency in the time unit. When transmitting the symbol 10 the transmitter transmits the symbol 10 by changing in luminance sharply changing in luminance at a high frequency in the time unit. When transmitting the symbol 11 the transmitter transmits the symbol 11 by changing in luminance more sharply changing in luminance at a higher frequency in the time unit.

The transmitter may transmit each of the symbols 0 1 separately by making the phase of the luminance change in a predetermined time unit different. For example when transmitting the symbol 0 the transmitter transmits the symbol 0 by changing in luminance in a predetermined phase in the time unit. When transmitting the symbol 1 the transmitter transmits the symbol 1 by changing in luminance in the reverse phase of the above mentioned phase in the time unit.

When transmitting a signal such as an ID the transmitter changes in luminance according to color such as red green and blue. The transmitter can therefore transmit a signal of a larger amount of information to a receiver capable of recognizing the luminance change according to color. The luminance change of any of the colors may be used for clock synchronization. For example the luminance change of red color may be used for clock synchronization. In this case the luminance change of red color serves as a header. Since there is no need to use a header for the luminance change of each color green and blue other than red redundant data transmission can be avoided.

The transmitter may express the luminance of synthetic color e.g. white by synthesizing a plurality of colors such as red green and blue. In other words the transmitter expresses the luminance change of synthetic color by changing in luminance according to color such as red green and blue. A signal is transmitted using this luminance change of synthetic color as in the above mentioned visible light communication. Here the luminance of one or more colors of red green and blue may be used for adjustment when expressing predetermined luminance of synthetic color. This enables the signal to be transmitted using the luminance change of synthetic color and also enables the signal to be transmitted using the luminance change of any two colors of red green and blue. The transmitter can therefore transmit a signal even to a receiver capable of recognizing only the luminance change of the above mentioned synthetic color e.g. white and also transmit more signals as ancillary information to a receiver capable of recognizing each color such as red green and blue.

The transmitter includes four light sources. The four light sources e.g. LED lights emit light of the colors expressed by different positions and in a CIExy chromaticity diagram illustrated in .

The transmitter transmits each signal by switching between first lighting transmission and second lighting transmission. The first lighting transmission is a process of transmitting the signal 0 by turning on the light source for emitting light of the color of the position and the light source for emitting the light of the color of the position from among the four light sources. The second lighting transmission is a process of transmitting the signal 1 by turning on the light source for emitting light of the color of the position and the light source for emitting the light of the color of the position . The image sensor in the receiver can identify the color expressed by each of the positions and and so the receiver can appropriately receive the signal 0 and the signal 1 .

During the first lighting transmission the color expressed by the intermediate position between the positions and in the CIExy chromaticity diagram is seen by the human eye. Likewise during the second lighting transmission the color expressed by the intermediate position between the positions and in the CIExy chromaticity diagram is seen by the human eye. Therefore by appropriately adjusting the color and luminance of each of the four light sources it is possible to match the intermediate position between the positions and and the intermediate position between the positions and to each other to a position . As a result even when the transmitter switches between the first lighting transmission and the second lighting transmission to the human eye the light emission color of the transmitter appears to be fixed. Flicker perceived by humans can thus be suppressed.

The transmitter includes an ID storage unit a random number generation unit an addition unit an encryption unit and a transmission unit . The ID storage unit stores the ID of the transmitter. The random number generation unit generates a different random number at regular time intervals. The addition unit combines the ID stored in the ID storage unit with the latest random number generated by the random number generation unit and outputs the result as an edited ID. The encryption unit encrypts the edited ID to generate an encrypted edited ID. The transmission unit transmits the encrypted edited ID to the receiver by changing in luminance.

The receiver includes a reception unit a decryption unit and an ID obtainment unit . The reception unit receives the encrypted edited ID from the transmitter by capturing the transmitter visible light imaging . The decryption unit decrypts the received encrypted edited ID to restore the edited ID. The ID obtainment unit extracts the ID from the edited ID thus obtaining the ID.

For instance the ID storage unit stores the ID 100 and the random number generation unit generates a new random number 817 example 1 . In this case the addition unit combines the ID 100 with the random number 817 to generate the edited ID 100817 and outputs it. The encryption unit encrypts the edited ID 100817 to generate the encrypted edited ID abced . The decryption unit in the receiver decrypts the encrypted edited ID abced to restore the edited ID 100817 . The ID obtainment unit extracts the ID 100 from the restored edited ID 100817 . In other words the ID obtainment unit obtains the ID 100 by deleting the last three digits of the edited ID.

Next the random number generation unit generates a new random number 619 example 2 . In this case the addition unit combines the ID 100 with the random number 619 to generate the edited ID 100619 and outputs it. The encryption unit encrypts the edited ID 100619 to generate the encrypted edited ID difia . The decryption unit in the receiver decrypts the encrypted edited ID difia to restore the edited ID 100619 . The ID obtainment unit extracts the ID 100 from the restored edited ID 100619 . In other words the ID obtainment unit obtains the ID 100 by deleting the last three digits of the edited ID.

Thus the transmitter does not simply encrypt the ID but encrypts its combination with the random number changed at regular time intervals with it being possible to prevent the ID from being easily cracked from the signal transmitted from the transmission unit . That is in the case where the simply encrypted ID is transmitted from the transmitter to the receiver a plurality of times even though the ID is encrypted the signal transmitted from the transmitter to the receiver is the same if the ID is the same so that there is a possibility of the ID being cracked. In the example illustrated in however the ID is combined with the random number changed at regular time intervals and the ID combined with the random number is encrypted. Therefore even in the case where the same ID is transmitted to the receiver a plurality of times if the time of transmitting the ID is different the signal transmitted from the transmitter to the receiver is different. This protects the ID from being cracked easily.

The transmitter includes an ID storage unit a timer unit an addition unit an encryption unit and a transmission unit . The ID storage unit stores the ID of the transmitter. The timer unit counts time and outputs the current date and time the current year month day and time . The addition unit combines the ID stored in the ID storage unit with the current date and time output from the timer unit as a transmission date and time and outputs the result as an edited ID. The encryption unit encrypts the edited ID to generate an encrypted edited ID. The transmission unit transmits the encrypted edited ID to the receiver by changing in luminance.

The receiver includes a reception unit a decryption unit a validity determination unit and a timer unit . The reception unit receives the encrypted edited ID from the transmitter by capturing the transmitter visible light imaging . The decryption unit decrypts the received encrypted edited ID to restore the edited ID. The timer unit counts time and outputs the current date and time the current year month day and time . The validity determination unit extracts the ID from the restored edited ID thus obtaining the ID. The validity determination unit also extracts the transmission date and time from the restored edited ID and compares the transmission date and time with the current date and time output from the timer unit to determine the validity of the ID. For example in the case where the difference between the transmission date and time and the current date and time is longer than a predetermined time or in the case where the transmission date and time is later than the current date and time the validity determination unit determines that the ID is invalid.

For instance the ID storage unit stores the ID 100 and the timer unit outputs the current date and time 201305011200 2013 5 1 12 00 as the transmission date and time example 1 . In this case the addition unit combines the ID 100 with the transmission date and time 201305011200 to generate the edited ID 100201305011200 and outputs it. The encryption unit encrypts the edited ID 100201305011200 to generate the encrypted edited ID ei39ks . The decryption unit in the receiver decrypts the encrypted edited ID ei39ks to restore the edited ID 100201305011200 . The validity determination unit extracts the ID 100 from the restored edited ID 100201305011200 . In other words the validity determination unit obtains the ID 100 by deleting the last 12 digits of the edited ID. The validity determination unit also extracts the transmission date and time 201305011200 from the restored edited ID 100201305011200 . If the transmission date and time 201305011200 is earlier than the current date and time output from the timer unit and the difference between the transmission date and time and the current date and time is within for example 10 minutes the validity determination unit determines that the ID 100 is valid.

On the other hand the ID storage unit stores the ID 100 and the timer unit outputs the current date and time 201401011730 2014 1 1 17 30 as the transmission date and time example 2 . In this case the addition unit combines the ID 100 with the transmission date and time 201401011730 to generate the edited ID 100201401011730 and outputs it. The encryption unit encrypts the edited ID 100201401011730 to generate the encrypted edited ID 002jflk . The decryption unit in the receiver decrypts the encrypted edited ID 002jflk to restore the edited ID 100201401011730 . The validity determination unit extracts the ID 100 from the restored edited ID 100201401011730 . In other words the validity determination unit obtains the ID 100 by deleting the last 12 digits of the edited ID. The validity determination unit also extracts the transmission date and time 201401011730 from the restored edited ID 100201401011730 . If the transmission date and time 201401011730 is later than the current date and time output from the timer unit the validity determination unit determines that the ID 100 is invalid.

Thus the transmitter does not simply encrypt the ID but encrypts its combination with the current date and time changed at regular time intervals with it being possible to prevent the ID from being easily cracked from the signal transmitted from the transmission unit . That is in the case where the simply encrypted ID is transmitted from the transmitter to the receiver a plurality of times even though the ID is encrypted the signal transmitted from the transmitter to the receiver is the same if the ID is the same so that there is a possibility of the ID being cracked. In the example illustrated in however the ID is combined with the current date and time changed at regular time intervals and the ID combined with the current date and time is encrypted. Therefore even in the case where the same ID is transmitted to the receiver a plurality of times if the time of transmitting the ID is different the signal transmitted from the transmitter to the receiver is different. This protects the ID from being cracked easily.

Moreover whether or not the obtained ID is valid is determined by comparing the transmission date and time of the encrypted edited ID and the current date and time. Thus the validity of the ID can be managed based on the transmission reception time.

Note that the receiver illustrated in each of may upon obtaining the encrypted edited ID transmit the encrypted edited ID to the server and obtain the ID from the server.

Upon receiving the transmission stop signal the transmitter such as a lighting stops signal transmission or operates so that the ripple luminance change from 100 Hz to 100 kHz is smaller. As an alternative the transmitter continues signal transmission while reducing the luminance change of the signal pattern. As another alternative the transmitter makes the carrier wave period longer than the barcode read time of the barcode reader or makes the carrier wave period shorter than the exposure time of the barcode reader . Malfunction of the barcode reader can be prevented in this way.

As illustrated in a transmitter such as a lighting detects by a motion sensor or a camera that there is a person near a barcode reader and stops signal transmission. As an alternative the transmitter performs the same operation as the transmitter when receiving the transmission stop signal. The transmitter restarts signal transmission upon detecting that no one is present near the barcode reader any longer. The transmitter may detect the operation sound of the barcode reader and stop signal transmission for a predetermined time.

A transmitter such as a personal computer transmits a visible light signal through a display device such as a display included in the transmitter a display connected to the transmitter or a projector. The transmitter transmits an URL of a website displayed by a browser information of a clipboard or information defined by a focused application. For example the transmitter transmits coupon information obtained in a website.

The database includes an ID data table holding data provided in response to an inquiry using an ID as a key and an access log table holding each record of inquiry using an ID as a key. The ID data table includes an ID transmitted from a transmitter data provided in response to an inquiry using the ID as a key a data provision condition the number of times access is made using the ID as a key and the number of times the data is provided as a result of clearing the condition. Examples of the data provision condition include the date and time the number of accesses the number of successful accesses terminal information of the inquirer terminal model application making inquiry current position of terminal etc. and user information of the inquirer age sex occupation nationality language religion etc. . By using the number of successful accesses as the condition a method of providing such a service that 1 yen per access though no data is returned after 100 yen as upper limit is possible. When access is made using an ID as a key the log table records the ID the user ID of the requester the time other ancillary information whether or not data is provided as a result of clearing the condition and the provided data.

A user sticks out a receiver such as a smartphone and turns his or her wrist right and left to start reception. The receiver detects these operations from the measurement of a 9 axis sensor and starts reception. The receiver may start reception in the case of detecting at least one of these operations. The operation of sticking out the receiver has the effect of enhancing the reception speed and accuracy because the receiver comes closer to a transmitter and so captures the transmitter in a larger size. The operation of turning the wrist right and left has the effect of stabilizing reception because the angle dependence of the scheme is resolved by changing the angle of the receiver.

Note that these operations may be performed only when the receiver s home screen is in the foreground. This can prevent the communication from being launched despite the user s intension while the user is using another application.

The following modification is also possible an image sensor is activated upon detection of the operation of sticking out the receiver and if the operation of turning the wrist right and left is not conducted the reception is canceled. Since activating the image sensor takes about several hundred milliseconds to 2 seconds the responsiveness can be enhanced in this way.

A signal control unit controls the transmission state the contents of a transmission signal whether or not to transmit the signal the intensity of luminance change used for transmission etc. of a transmitter . The signal control unit transmits the details of control of the transmitter to a power distribution control unit . The power distribution control unit changes the voltage or current supplied to a power supply unit of the transmitter or its frequency thereby notifying the details of control in the form of the magnitude of the change or the time of the change. The power supply unit produces constant output without being affected by a slight change in voltage current or frequency. Accordingly the signal is transmitted by being expressed by such a change that exceeds the stabilizing ability of the power supply unit e.g. a timing or duration that cuts power supply. A luminance control unit receives the signal transmitted from the power distribution control unit while taking into account the conversion by the power supply unit and changes the luminance change pattern of a light emitting unit.

This coding scheme has the advantage that flicker is unlikely to be perceived by humans because black and white are substantially equal in proportion and so the normal phase image and the reverse phase image are substantially equal in average luminance.

 Coding Scheme Capable of Light Reception Even in the Case of Capturing Image from Diagonal Direction 

An image is an image displayed with black and white lines of uniform width. In an image obtained by capturing the image from a diagonal direction left lines appear thinner and right lines appear thicker. In an image obtained by capturing the image in a manner of projecting the image on a curved surface lines that differ in thickness appear.

In view of this a visible light communication image is generated by the following coding scheme. A visible light communication image is made up of a white line a black line whose thickness is three times that of the white line and a white line whose thickness is that of the black line from left. A preamble is coded as such an image in which a line whose thickness is three times that of its left adjacent line is followed by a line whose thickness is that of its left adjacent line. As in visible light communication images and a line whose thickness is equal to that of its left adjacent line is coded as 0 . As in visible light communication images and a line whose thickness is twice that of its left adjacent line or that of its left adjacent line is coded as 1 . That is a line whose thickness is different from that of its left adjacent line is coded as 1 . As an example using this coding scheme a signal including 010110001011 following the preamble is expressed by an image such as a visible light communication image . Though the line whose thickness is equal to that of its left adjacent line is coded as 0 and the line whose thickness is different from that of its left adjacent line is coded as 1 in this example the line whose thickness is equal to that of its left adjacent line may be coded as 1 and the line whose thickness is different from that of its left adjacent line as 0 . Moreover the reference thickness is not limited to the thickness of the left adjacent line and may be the thickness of the right adjacent line. In detail 1 or 0 may be coded depending on whether the thickness of the line to be coded is equal to or different from the thickness of its right adjacent line. Thus a transmitter codes 0 by setting the line to be coded to be equal in thickness to the line that is different in color from and adjacent to the line to be coded and codes 1 by setting the line to be coded to be different in thickness from the line that is different in color from and adjacent to the line to be coded.

A receiver captures the visible light communication image and detects the thickness of the white or black line in the captured visible light communication image. The receiver compares the thickness of the line to be decoded with the thickness of the line that is different in color from and adjacent left adjacent or right adjacent to the line to be decoded. The line is decoded as 0 in the case where the thicknesses are equal and 1 in the case where the thicknesses are different. Alternatively the line may be decoded as 1 in the case where the thicknesses are equal and 0 in the case where the thicknesses are different. The receiver lastly decodes the data based on the decoded data sequence of 1 and 0.

This coding scheme employs the local line thickness relation. Since the thickness ratio between neighboring lines does not change significantly as seen in the images and the visible light communication image generated by this coding scheme can be properly decoded even in the case of being captured from a diagonal direction or being projected on a curved surface.

This coding scheme has the advantage that flicker is unlikely to be perceived by humans because black and white are substantially equal in proportion and so the normal phase image and the reverse phase image are substantially equal in average luminance. This coding scheme also has the advantage that the visible light communication images of both the normal phase signal and the reverse phase signal are decodable by the same algorithm because the coding scheme does not depend on the distinction between black and white.

This coding scheme further has the advantage that a code can be added easily. As an example a visible light communication image is a combination of a line whose thickness is four times that of its left adjacent line and a line whose thickness is that of its left adjacent line. Like this many unique patterns such as five times that of its left adjacent line and that of its left adjacent line and three times that of its left adjacent line and that of its left adjacent line are available enabling definition as a signal having a special meaning. For instance given that one set of data can be expressed by a plurality of visible light communication images the visible light communication image may be used as a cancel signal indicating that since the transmission data is changed part of the previously received data is no longer valid. Note that the colors are not limited to black and white and any colors may be used so long as they are different. For instance complementary colors may be used.

As in a 1 in when a 2 bit signal is expressed in a form that one part of an image divided by four is black and the other parts are white the average luminance of the image is 75 where white is 100 and black is 0 . As in a 2 in when black and white are reversed the average luminance is 25 .

An image is a visible light communication image in which the white part of the visible light communication image generated by the coding scheme in is expressed by the image in a 1 in and the black part is expressed by the image in a 2 in . This visible light communication image represents signal A coded by the coding scheme in and signal B coded by a 1 and a 2 in . When a nearby receiver captures the visible light communication image a fine image is obtained and both of signals A and B can be received. When a distant receiver captures the visible light communication image a small image is obtained. In the image the details are not recognizable and the part corresponding to a 1 in is white and the part corresponding to a 2 in is black so that only signal A can be received. Thus more information can be transmitted when the distance between the visible light communication image and the receiver is shorter. The scheme for coding signal B may be the combination of b 1 and b 2 or the combination of c 1 and c 2 in .

The use of signals A and B enables basic important information to be expressed by signal A and additional information to be expressed by signal B. In the case where the receiver transmits signals A and B to a server as ID information and the server transmits information corresponding to the ID information to the receiver the information transmitted from the server may be varied depending on whether or not signal B is present.

A transmission signal is divided into a plurality of data segments and . Frame data and are generated by adding to each data segment an address indicating the position of the data segment a preamble an error detection correction code a frame type description and the like. The frame data are coded to generate visible light communication images and and the visible light communication images and are displayed. In the case where the display area is sufficiently large a visible light communication image obtained by concatenating the plurality of visible light communication images is displayed.

A method of inserting the visible light communication image in video as in is described below. In the case of a display device including a solid state light source the visible light communication image is displayed in normal time and the solid state light source is on only during the period for displaying the visible light communication image and off during the other period. This method is applicable to a wide range of display devices including a projector using a DMD a projector using a liquid crystal such as LCOS and a display device using MEMS. The method is also applicable to display devices that divide image display into subframes e.g. a display device such as a PDP or an EL display that does not use a light source such as a backlight by replacing part of the subframes with the visible light communication image. Examples of the solid state light source include a semiconductor laser and an LED light source.

As in in a transmitter inserts a black image between video and a visible light communication image normal phase image . An image obtained by capturing this by a receiver is as illustrated in in . Since it is easy to search for a part where a simultaneously exposed pixel line is all black the receiver can easily specify the position where the visible light communication image is captured as the pixel position exposed at the next timing.

As in in after displaying a visible light communication image normal phase image the transmitter displays a visible light communication image of reverse phase with black and white being inverted. The receiver calculates the difference in pixel value between the normal phase image and the reverse phase image thus attaining an SN ratio that is twice as compared with the case of using only the normal phase image. Conversely when ensuring the same SN ratio the luminance difference between black and white can be reduced to half with it being possible to suppress flicker perceived by humans. As in and in the moving average of the expected value of the luminance difference between the video and the visible light communication image is canceled out by the normal phase image and the reverse phase image. Since the temporal resolution of human vision is about 1 60 second by setting the time for displaying the visible light communication image to less than or equal to this it is possible to make humans perceive as if the visible light communication image is not being displayed.

As in in the transmitter may further insert a black image between the normal phase image and the reverse phase image. In this case an image illustrated in in is obtained as a result of image capture by the receiver. In the image illustrated in in the pattern of the normal phase image and the pattern of the reverse phase image are adjacent to each other which might cause averaging of pixel values at the boundary. In the image illustrated in in no such problem occurs.

In a in in the case where video data and signal data transmitted by visible light communication are separated a superresolution process is performed on the video data and the visible light communication image is superimposed on the obtained superresolution image. That is the superresolution process is not performed on the visible light communication image. In b in in the case where a visible light communication image is already superimposed on video data the superresolution process is performed so that 1 the edges parts indicating data by the difference between colors such as black and white of the visible light communication image are maintained sharp and 2 the average image of the normal phase image and the reverse phase image of the visible light communication image is of uniform luminance. By changing the process for the visible light communication image depending on whether or not the visible light communication image is superimposed on the video data in this way visible light communication can be performed more appropriately with reduced error rate .

A transmitter displays information indicating that the transmitter is capable of visible light communication by superimposing the information on a projected or displayed image. The information is displayed for example only for a predetermined time after the transmitter is activated.

The transmitter transmits the information indicating that the transmitter is capable of visible light communication to a connected device . The device displays that the transmitter is capable of visible light communication. As an example the device displays that the transmitter is capable of visible light communication on a display of the device . In the case where the connected transmitter is capable of visible light communication the device transmits visible light communication data to the transmitter . The information that the transmitter is capable of visible light communication may be displayed when the device is connected to the transmitter or when the visible light communication data is transmitted from the device to the transmitter . In the case of displaying the information when the visible light communication data is transmitted from the device the transmitter may obtain identification information indicating visible light communication from the data and if the identification information indicates that the visible light communication data is included in the data display that the transmitter is capable of visible light communication.

By displaying that the transmitter lighting projector video display device etc. is capable of visible light communication or whether or not the transmitter is capable of visible light communication on the projection screen or the display of the device in this way the user can easily recognize whether or not the transmitter is capable of visible light communication. This prevents a failure of visible light communication even though visible light communication data is transmitted from the device to the transmitter.

A transmitter receives video data and signal data from a device and displays a visible light communication image . A receiver captures the visible light communication image to receive a signal included in the visible light communication image. The receiver communicates with the device based on information address password etc. included in the received signal and receives the video displayed by the transmitter and its ancillary information video ID URL password SSID translation data audio data hash tag product information purchase information coupon availability information etc. . The device may transmit to a server the status of transmission to the transmitter so that the receiver may obtain the information from the server

Data illustrated in a in has a video address table indicating the position of video data in a storage area and a position address table indicating the position of signal data transmitted by visible light communication. A video display device not capable of visible light communication refers only to the video address table and therefore video display is not affected even when the signal address table and signal data are included in the input. Backward compatibility with the video display device not capable of visible light communication is maintained in this manner.

In a data format illustrated in b in an identifier indicating that data which follows is video data is positioned before video data and an identifier indicating that data which follows is signal data is positioned before signal data. Since the identifier is inserted in the data only when there is video data or signal data the total amount of code can be reduced. Alternatively identification information indicating whether data is video data or signal data may be provided. Moreover program information may include identification information indicating whether or not the program information includes visible light communication data. The inclusion of the identification information indicating whether or not the program information includes visible light communication data allows the user to determine upon program search whether or not visible light communication is possible. The program information may include an identifier indicating that the program information includes visible light communication data. Furthermore adding an identifier or identification information on a data basis makes it possible to switch the luminance or switch the process such as superresolution on a data basis which contributes to a lower error rate in visible light communication.

The data format illustrated in a in is suitable for a situation of reading data from a storage medium such a an optical disc and the data format illustrated in b in is suitable for streaming data such as television broadcasting. Note that the signal data includes information such as the signal value transmitted by visible light communication the transmission start time the transmission end time the area used for transmission on a display or a projection surface the luminance of the visible light communication image the direction of barcode of the visible light communication image and so on.

As illustrated in a transmitter such as a projector projects not only video and a visible light communication image but also a distance measurement image. A dot pattern indicated by the distance measurement image is a dot pattern in which the position relation between a predetermined number of dots near an arbitrary dot is different from the position relation between other arbitrary combination of dots. A receiver captures the distance measurement image to specify a local dot pattern with it being possible to estimate the stereoscopic shape of a projection surface . The receiver restores the visible light communication image distorted due to the stereoscopic shape of the projection surface to a 2D image thereby receiving a signal. The distance measurement image and the visible light communication image may be projected by infrared which is not perceivable by humans.

As illustrated in a transmitter such as a projector includes an infrared projection device for projecting a distance measurement image by infrared. A receiver estimates the stereoscopic shape of a projection surface and restores a distorted visible light communication image to receive a signal. The transmitter may project video by visible light and a visible light communication image by infrared. The infrared projection device may project a visible light communication image by infrared.

In the case of performing stereoscopic projection or in the case of displaying a visible light communication image on a cylindrical display surface displaying visible light communication images to as illustrated in enables reception from a wide angle. Displaying the visible light communication images and enables reception from a horizontally wide angle. By combining the visible light communication images and reception is possible even when a receiver is tilted. The visible light communication images and may be displayed alternately or the visible light communication image obtained by synthesizing these images may be displayed. Moreover adding the visible light communication images and enables reception from a vertically wide angle. The visible light communication image boundary may be expressed by providing a part projected in an intermediate color or an unprojected part as in the visible light communication image . Rotating the visible light communication images to enables reception from a wider angle. Though the visible light communication image is displayed on the cylindrical display surface in the visible light communication image may be displayed on a columnar display surface.

In the case of performing stereoscopic projection or in the case of displaying a visible light communication image on a spherical display surface displaying visible light communication images to as illustrated in enables reception from a wide angle. In the visible light communication image the receivable area in the horizontal direction is wide but the receivable area in the vertical direction is narrow. Hence the visible light communication image is combined with the visible light communication image having the opposite property. The visible light communication images and may be displayed alternately or the visible light communication image obtained by synthesizing these images may be displayed. The part where barcodes concentrate as in the upper part of the visible light communication image is fine in display and there is a high possibility of a signal reception error. Such a reception error can be prevented by displaying this part in an intermediate color as in the visible light communication image or by not projecting any image in this part.

A receiver receives zone information form a base station recognizes in which position the receiver is located and selects a reception protocol. The base station is for example a mobile phone communication base station a W Fi access point an IMES transmitter a speaker or a wireless transmitter Bluetooth ZigBee specified low power radio station etc. . The receiver may specify the zone based on position information obtained from GPS or the like. As an example it is assumed that communication is performed at a signal frequency of 9.6 kHz in zone A and communication is performed at a signal frequency of 15 kHz by a ceiling light and at a signal frequency of 4.8 kHz by a signage in zone B. At a position the receiver recognizes that the current position is zone A from information from the base station and performs reception at the signal frequency of 9.6 kHz thus receiving signals transmitted from transmitters and . At a position the receiver recognizes that the current position is zone B from information from a base station and also estimates that a signal from a ceiling light is to be received from the movement of directing the in camera upward. The receiver performs reception at the signal frequency of 15 kHz thus receiving signals transmitted from transmitters and . At a position the receiver recognizes that the current position is zone B from information from the base station and also estimates that a signal transmitted from a signage is to be received from the movement of sticking out the out camera. The receiver performs reception at the signal frequency of 4.8 kHz thus receiving a signal transmitted from a transmitter . At a position the receiver receives signals from both of the base stations and and cannot determine whether the current position is zone A or zone B. The receiver accordingly performs reception at both 9.6 kHz and 15 kHz. The part of the protocol different according to zone is not limited to the frequency and may be the transmission signal modulation scheme the signal format or the server inquired using an ID. The base station or may transmit the protocol in the zone to the receiver or transmit only the ID indicating the zone to the receiver so that the receiver obtains protocol information from a server using the zone ID as a key.

Transmitters to each receive the zone ID or protocol information from the base station or and determine the signal transmission protocol. The transmitter that can receive the signals from both the base stations and uses the protocol of the zone of the base station with a higher signal strength or alternately use both protocols.

A receiver recognizes a zone to which the position of the receiver belongs from a received signal. The receiver provides a service coupon distribution point assignment route guidance etc. determined for each zone. As an example the receiver receives a signal transmitted from the left of a transmitter and recognizes that the receiver is located in zone A. Here the transmitter may transmit a different signal depending on the transmission direction. Moreover the transmitter may through the use of a signal of the light emission pattern such as transmit a signal so that a different signal is received depending on the distance to the receiver. The receiver may recognize the position relation with the transmitter from the direction and size in which the transmitter is captured and recognize the zone in which the receiver is located.

Signals indicating the same zone may have a common part. For example the first half of an ID indicating zone A which is transmitted from each of the transmitters and is common. This enables the receiver to recognize the zone where the receiver is located merely by receiving the first half of the signal.

An information communication method in this embodiment is an information communication method of transmitting a signal using a change in luminance the information communication method including determining a plurality of patterns of the change in luminance by modulating each of a plurality of signals to be transmitted and transmitting by each of a plurality of light emitters changing in luminance according to any one of the plurality of determined patterns of the change in luminance a signal corresponding to the pattern wherein in the transmitting each of two or more light emitters of the plurality of light emitters changes in luminance at a different frequency so that light of one of two types of light different in luminance is output per a time unit determined for the light emitter beforehand and that the time unit determined for each of the two or more light emitters is different.

In this way two or more light emitters e.g. transmitters as lighting devices each change in luminance at a different frequency as in the operation described with reference to . Therefore a receiver that receives signals e.g. light emitter IDs from these light emitters can easily obtain the signals separately from each other.

For example in the transmitting each of the plurality of light emitters may change in luminance at any one of at least four types of frequencies and the two or more light emitters of the plurality of transmitters may change in luminance at the same frequency. For example in the transmitting the plurality of light emitters each change in luminance so that a luminance change frequency is different between all light emitters which in the case where the plurality of light emitters are projected on a light receiving surface of an image sensor for receiving the plurality of signals are adjacent to each other on the light receiving surface.

In this way as long as there are at least four types of frequencies used for luminance changes even in the case where two or more light emitters change in luminance at the same frequency i.e. in the case where the number of types of frequencies is smaller than the number of light emitters it can be ensured that the luminance change frequency is different between all light emitters adjacent to each other on the light receiving surface of the image sensor based on the four color problem or the four color theorem as in the operation described with reference to . As a result the receiver can easily obtain the signals transmitted from the plurality of light emitters separately from each other.

For example in the transmitting each of the plurality of light emitters may transmit the signal by changing in luminance at a frequency specified by a hash value of the signal.

In this way each of the plurality of light emitters changes in luminance at the frequency specified by the hash value of the signal e.g. light emitter ID as in the operation described with reference to . Accordingly upon receiving the signal the receiver can determine whether or not the frequency specified from the actual change in luminance and the frequency specified by the hash value match. That is the receiver can determine whether or not the received signal e.g. light emitter ID has an error.

For example the information communication method may further include calculating from a signal to be transmitted which is stored in a signal storage unit a frequency corresponding to the signal according to a predetermined function as a first frequency determining whether or not a second frequency stored in a frequency storage unit and the calculated first frequency match and in the case of determining that the first frequency and the second frequency do not match reporting an error wherein in the case of determining that the first frequency and the second frequency match in the determining a pattern of the change in luminance is determined by modulating the signal stored in the signal storage unit and in the transmitting the signal stored in the signal storage unit is transmitted by any one of the plurality of light emitters changing in luminance at the first frequency according to the determined pattern.

In this way whether or not the frequency stored in the frequency storage unit and the frequency calculated from the signal stored in the signal storage unit ID storage unit match is determined and in the case of determining that the frequencies do not match an error is reported as in the operation described with reference to . This eases abnormality detection on the signal transmission function of the light emitter.

For example the information communication method may further include calculating a first check value from a signal to be transmitted which is stored in a signal storage unit according to a predetermined function determining whether or not a second check value stored in a check value storage unit and the calculated first check value match and in the case of determining that the first check value and the second check value do not match reporting an error wherein in the case of determining that the first check value and the second check value match in the determining a pattern of the change in luminance is determined by modulating the signal stored in the signal storage unit and in the transmitting the signal stored in the signal storage unit is transmitted by any one of the plurality of light emitters changing in luminance at the first frequency according to the determined pattern.

In this way whether or not the check value stored in the check value storage unit and the check value calculated from the signal stored in the signal storage unit ID storage unit match is determined and in the case of determining that the check values do not match an error is reported as in the operation described with reference to . This eases abnormality detection on the signal transmission function of the light emitter.

An information communication method in this embodiment is an information communication method of obtaining information from a subject the information communication method including setting an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a plurality of bright lines corresponding to a plurality of exposure lines included in the image sensor appear according to a change in luminance of the subject obtaining a bright line image including the plurality of bright lines by capturing the subject that changes in luminance by the image sensor with the set exposure time obtaining the information by demodulating data specified by a pattern of the plurality of bright lines included in the obtained image and specifying a luminance change frequency of the subject based on the pattern of the plurality of bright lines included in the obtained bright line image. For example in the specifying a plurality of header patterns that are included in the pattern of the plurality of bright lines and are a plurality of patterns each determined beforehand to indicate a header are specified and a frequency corresponding to the number of pixels between the plurality of header patterns is specified as the luminance change frequency of the subject.

In this way the luminance change frequency of the subject is specified as in the operation described with reference to . In the case where a plurality of subjects that differ in luminance change frequency are captured information from these subjects can be easily obtained separately from each other.

For example in the obtaining of a bright line image the bright line image including a plurality of patterns represented respectively by the plurality of bright lines may be obtained by capturing a plurality of subjects each of which changes in luminance and in the obtaining of the information in the case where the plurality of patterns included in the obtained bright line image overlap each other in a part the information may be obtained from each of the plurality of patterns by demodulating the data specified by a part of each of the plurality of patterns other than the part.

In this way data is not demodulated from the overlapping part of the plurality of patterns the plurality of bright line patterns as in the operation described with reference to . Obtainment of wrong information can thus be prevented.

For example in the obtaining of a bright line image a plurality of bright line images may be obtained by capturing the plurality of subjects a plurality of times at different timings from each other in the specifying for each bright line image a frequency corresponding to each of the plurality of patterns included in the bright line image may be specified and in the obtaining of the information the plurality of bright line images may be searched for a plurality of patterns for which the same frequency is specified the plurality of patterns searched for may be combined and the information may be obtained by demodulating the data specified by the combined plurality of patterns.

In this way the plurality of bright line images are searched for the plurality of patterns the plurality of bright line patterns for which the same frequency is specified the plurality of patterns searched for are combined and the information is obtained from the combined plurality of patterns. Hence even in the case where the plurality of subjects are moving information from the plurality of subjects can be easily obtained separately from each other.

For example the information communication method may further include transmitting identification information of the subject included in the obtained information and specified frequency information indicating the specified frequency to a server in which a frequency is registered for each set of identification information and obtaining related information associated with the identification information and the frequency indicated by the specified frequency information from the server.

In this way the related information associated with the identification information ID obtained based on the luminance change of the subject transmitter and the frequency of the luminance change is obtained as in the operation described with reference to . By changing the luminance change frequency of the subject and updating the frequency registered in the server with the changed frequency a receiver that has obtained the identification information before the change of the frequency is prevented from obtaining the related information from the server. That is by changing the frequency registered in the server according to the change of the luminance change frequency of the subject it is possible to prevent a situation where a receiver that has previously obtained the identification information of the subject can obtain the related information from the server for an indefinite period of time.

For example the information communication method may further include obtaining identification information of the subject by extracting a part from the obtained information and specifying a number indicated by the obtained information other than the part as a luminance change frequency set for the subject.

In this way the identification information of the subject and the luminance change frequency set for the subject can be included independently of each other in the information obtained from the pattern of the plurality of bright lines as in the operation described with reference to . This contributes to a higher degree of freedom of the identification information and the set frequency.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as an LED blink pattern in Embodiments 1 to 5 described above.

A transmission signal D is divided into data segments Dx e.g. Dx D D D of a predetermined size and a header Hdr and an error detection correction frame check sequence FCS calculated from each data segment are added to the data segment. A header Hdr and an error detection correction frame check sequence FCS calculated from the original data are added too. Data made up of Hdr Dx and FCS is a structure for reception by an image sensor. Since the image sensor is suitable for reception of continuous data in a short time Hdr Dx and FCS are transmitted continuously. Data made up of Hdr Dx and FCS is a structure for reception by an illuminance sensor. While Hdr and FCS received by the image sensor are desirably short Hdr and FCS received by the illuminance sensor may each be a longer signal sequence. The use of a longer signal sequence for Hdr enhances the header detection accuracy. When FCS is longer a code capable of detecting and correcting many bit errors can be employed which leads to improved error detection correction performance. Note that instead of transmitting Hdr and FCS Hdr and FCS may be received by the illuminance sensor. The illuminance sensor may receive both Hdr and Hdr or both FCS and FCS.

FCS is a long signal. Frequently inserting such FCS causes a decrease in reception efficiency of the image sensor. In view of this the insertion frequency of FCS is reduced and a signal PoFCS indicating the location of FCS is inserted instead. For example in the case of using 4 value PPM having 2 bit information per unit time for signal representation 16 transmission time units are necessary when CRC is used for FCS whereas PoFCS with a range of 0 to 3 can be transmitted in one time unit. Since the transmission time is shortened as compared with the case of inserting only FCS the reception efficiency of the image sensor can be improved. The illuminance sensor receives PoFCS following the transmission signal D specifies the transmission time of FCS from PoFCS and receives FCS. The illuminance sensor further receives PoFCS following FCS specifies the transmission time of the next FCS and receives the next FCS. If FCS received first and FCS received next are the same the receiver estimates that the same signal is being received.

In the captured image illustrated in a transmitter is shown small and so the number of bright lines is small. Only a small amount of data can be received at one time from this captured image. The captured image illustrated in is an image captured using zoom where the transmitter is shown large and so the number of bright lines is large. Thus a large amount of data can be received at one time by using zoom. In addition data can be received from far away and a signal of a small transmitter can be received. Optical zoom or Ex zoom is employed as the zoom method. Optical zoom is realized by increasing the focal length of a lens. Ex zoom is a zoom method in which in the case of performing imaging with a lower resolution than the imaging element capacity not all but only a part of the imaging elements is used to thereby enlarge a part of the captured image. The captured image illustrated in is an image captured using electronic zoom image enlargement . Though the transmitter is shown large bright lines are thicker in the enlargement by electronic zoom and the number of bright lines is unchanged from pre zoom. Hence the reception characteristics are unchanged from pre zoom.

The captured image illustrated in is an image captured with focus on a subject. The captured image illustrated in is an image captured out of focus. In the captured image illustrated in bright lines can be observed even in the surroundings of the actual transmitter because the image is captured out of focus so that more bright lines can be observed. Thus more data can be received at one time and also data can be received farther away by out of focus imaging. Imaging in macro mode can produce the same image as the captured image illustrated in .

The image illustrated in is obtained by setting the exposure time to be longer than that in the visible light communication mode and shorter than that in the normal imaging mode. The imaging mode for obtaining such an image is referred to as bright line detection mode intermediate mode . In the image illustrated in bright lines of a transmitter are observed at the center left while a darker normal captured image appears in the other part. When this image is displayed on the receiver the user can easily point the receiver at the intended transmitter and capture the transmitter. In the bright line detection mode an image is captured darker than in the normal imaging mode. Accordingly imaging is performed in a high sensitivity mode to capture an image having brightness easily visible by humans i.e. an image similar to that in the normal imaging mode. Since excessively high sensitivity causes the darker parts of the bright lines to become brighter the sensitivity is set to such a level that allows the bright lines to be observed. The receiver switches to the visible light communication mode and receives the transmission signal of the transmitter captured in the part designated by for example the user touching the image. The receiver may automatically switch to the visible light communication mode and receive the signal in the case where any bright line transmission signal is found in the captured image.

The receiver detects the transmission signal from the bright lines in the captured image and highlights the detected part as illustrated in . The receiver can thus present the signal transmission part clearly to the user. The bright lines may be observed with regard to not only the transmission signal but also the pattern of the subject. Therefore instead of determining whether or not there is the transmission signal from the bright lines in one image it may be determined that there is the transmission signal in the case where the positions of the bright lines change in a plurality of images.

The image captured in the bright line detection mode is darker than the image captured in the normal imaging mode and is not easily visible. Hence the image with visibility increased by image processing may be displayed. The image illustrated in is an example of an image in which the edges are extracted and the boundary of the imaging object is enhanced.

The upper limit of the exposure time that enables signal reception differs depending on the method of signal representation. The use of such a signal representation rule in which the number of bright lines is smaller and the interval between the bright lines is longer enables signal reception with a longer exposure time and also enables observation of bright lines with a longer exposure time though the transmission efficiency is lower.

As illustrated in clear bright lines are observable when the exposure time is up to about 3 times the modulation period. Since the modulation frequency is greater than or equal to 480 Hz the exposure time in the intermediate imaging mode intermediate mode is desirably less than or equal to 1 160 second.

If the exposure time is less than or equal to 1 10000 second an object not emitting light is hard to be seen under illumination light even when captured in the high sensitivity mode. Accordingly the exposure time in the intermediate imaging mode is desirably greater than or equal to 1 10000 second. This limitation is however expected to be eased by future improvement in sensitivity of imaging elements.

A receiver receives a series of signals by combining a plurality of received data segments. Therefore if a transmission signal is abruptly changed data segments before and after the change are mixed with each other making it impossible to accurately combine the signals. In view of this upon changing the transmission signal a transmitter performs normal illumination for a predetermined time as a buffer zone while transmitting no signal as in a in . In the case where no signal can be received for a predetermined time T shorter than the above mentioned predetermined time T the receiver abandons previously received data segments thus avoiding mixture of data segments before and after the change. As an alternative upon changing the transmission signal the transmitter repeatedly transmits a signal X for notifying the change of the transmission signal as in b in . Such repeated transmission prevents a failure to receive the transmission signal change notification X. As another alternative upon changing the transmission signal the transmitter repeatedly transmits a preamble as in c in . In the case of receiving the preamble in a shorter period than the period in which the preamble appears in the normal signal the receiver abandons previously received data segments.

An image illustrated in a in is an image obtained by capturing a transmitter in just focus. By out of focus imaging a receiver can capture an image illustrated in b in . Further out of focus leads to a captured image illustrated in c in . In c in bright lines of a plurality of transmitters overlap each other and the receiver cannot perform signal reception. Hence the receiver adjusts the focus so that the bright lines of the plurality of transmitters do not overlap each other. In the case where only one transmitter is present in the imaging range the receiver adjusts the focus so that the size of the transmitter is maximum in the captured image.

The receiver may compress the captured image in the direction parallel to the bright lines but do not perform image compression in the direction perpendicular to the bright lines. Alternatively the receiver reduces the degree of compression in the perpendicular direction. This prevents a reception error caused by the bright lines being blurred by compression.

By capturing a plurality of transmitters a receiver can estimate the position of the receiver using triangulation from position information of each transmitter and the position size and angle of each transmitter in the captured image. Accordingly in the case where only one transmitter is captured in a receivable state the receiver instructs the imaging direction or the moving direction by displaying an image including an arrow or the like to cause the user to change the direction of the receiver or move backward so as to capture a plurality of transmitters. a in illustrates a display example of an instruction to turn the receiver to the right to capture a transmitter on the right side. b in illustrates a display example of an instruction to move backward to capture a transmitter in front. illustrates a display example of an instruction to shake the receiver or the like to capture another transmitter because the position of another transmitter is unknown to the receiver. Though it is desirable to capture a plurality of transmitters in one image the position relation between transmitters in a plurality of images may be estimated using image processing or the sensor value of the 9 axis sensor. The receiver may inquire of a server about position information of nearby transmitters using an ID received from one transmitter and instruct the user to capture a transmitter that is easiest to capture.

The receiver detects that the user is moving the receiver from the sensor value of the 9 axis sensor and after a predetermined time from the end of the movement displays a screen based on the last received signal. This prevents a situation where when the user points the receiver to the intended transmitter a signal of another transmitter is received during the movement of the receiver and as a result a process based on the transmission signal of the unintended transmitter is accidentally performed.

The receiver may continue the reception process during the movement and perform a process based on the received signal e.g. information obtainment from the server using the received signal as a key. In this case after the process the receiver still continues the reception process and performs a process based on the last received signal as a final process.

The receiver may process a signal received a predetermined number of times or notify the signal received the predetermined number of times to the user. The receiver may process a signal received a largest number of times during the movement.

The receiver may include notification means for notifying the user when signal reception is successful or when a signal is detected in a captured image. The notification means performs notification by sound vibration display update e.g. popup display or the like. This enables the user to recognize the presence of a transmitter.

A plurality of transmitters such as displays are arranged adjacent to each other. In the case of transmitting the same signal the plurality of transmitters synchronize the signal transmission timing and transmit the signal from the entire surface as in a in . This allows a receiver to observe the plurality of displays as one large transmitter so that the receiver can receive the signal faster or from a longer distance. In the case where the plurality of transmitters transmit different signals the plurality of transmitters transmit the signals while providing a buffer zone non transmission area where no signal is transmitted as in b in . This allows the receiver to recognize the plurality of transmitters as separate transmitters with the buffer zone in between so that the receiver can receive the signals separately.

As illustrated in a in a liquid crystal display provides a backlight off period and changes the liquid crystal state during backlight off to make the image in the state change invisible thus enhancing dynamic resolution. On the liquid crystal display performing such backlight control a signal is superimposed according to the backlight on period as illustrated in b in . Continuously transmitting the set of data Hdr Data FCS contributes to higher reception efficiency. The light emitting unit is in a bright state Hi in the first and last parts of the backlight on period. This is because if the dark state Lo of the light emitting unit is continuous with the backlight off period the receiver cannot determine whether Lo is transmitted as a signal or the light emitting unit is in a dark state due to the backlight off period.

Signal superimposition causes the average luminance to change as compared with the case where no signal is superimposed. Hence adjustment such as increasing decreasing the backlight off period or increasing decreasing the luminance during backlight on is performed so that the average luminance is equal.

A liquid crystal display can reduce the luminance change of the entire screen by performing backlight control at a different timing depending on position. This is called backlight scan. Backlight scan is typically performed so that the backlight is turned on sequentially from the end as in a in . A captured image is obtained as a result. In the captured image however the part including the bright lines is divided and there is a possibility that the entire screen of the display cannot be estimated as one transmitter. The backlight scan order is accordingly set so that all light emitting parts signal superimposition parts are connected when the vertical axis is the spatial axis in the backlight scan division direction and the horizontal axis is the time axis as in b in . A captured image is obtained as a result. In the captured image all bright line parts are connected facilitating estimation that this is a transmission signal from one transmitter. Besides since the number of continuously receivable bright lines increases faster or longer distance signal reception is possible. Moreover the size of the transmitter is easily estimated and therefore the position of the receiver can be accurately estimated from the position size and angle of the transmitter in the captured image.

In time division backlight scan in the case where the backlight on period is short and the light emitting parts signal superimposition parts cannot be connected on the graph in which the vertical axis is the spatial axis in the backlight scan division direction and the horizontal axis is the time axis signal superimposition is performed in each light emitting part according to the backlight illumination timing in the same way as in . Here by controlling the backlight so that the distance from another backlight on part on the graph is maximum it is possible to prevent mixture of bright lines in adjacent parts.

This embodiment is intended to save through the use of visible light communication the user s trouble when shopping in a store thereby reducing the time for shopping. Conventionally when the user buys a product in a store the user needs to search for the site of the store and obtain coupon information beforehand. There is also a problem that it takes time to search the store for the product for which the coupon is available.

As illustrated in the lighting fixture periodically transmits lighting ID information of the lighting fixture using visible light communication in front of the store an electronics retail store is assumed as an example . The wearable device of the user receives the lighting ID information and transmits the lighting ID information to the smartphone using near field communication. The smartphone transmits information of the user and the lighting ID information to the server using a mobile line or the like. The smartphone receives point information coupon information and the like of the store in front of the user from the server . The user views the information received from the server on the wearable device or the smartphone . Thus the user can buy displayed product information of the store on the spot or be guided to an exhibit in the store. This is described in detail below with reference to drawings.

The smartphone further transfers the information received from the server to the wearable device Step S . If the notification setting of the wearable device is ON the wearable device displays the information Step S . When the wearable device displays the information it is desirable to alert the user by vibration or the like for the following reason. Since the user does not always enter the store even when the coupon information or the like is transmitted the user might be unaware of it.

Visible light communication in the present disclosure allows the position of the user to be specified accurately. Therefore for example in the case where the user is likely to enter a dangerous area in a factory as in a warning can be issued to the user. Whether or not to issue a warning may be determined by the wearable device. It is thus possible to create such a warning system with a high degree of freedom that warns children of a specific age or below.

First a company A ex managing a server ex is requested to distribute information to a mobile terminal by another company B or individual ex. For example the distribution of detailed advertisement information coupon information map information or the like to the mobile terminal that performs visible light communication with a signage is requested. The company A ex managing the server manages information distributed to the mobile terminal in association with arbitrary ID information. A mobile terminal ex obtains ID information from a subject ex by visible light communication and transmits the obtained ID information to the server ex. The server ex transmits the information corresponding to the ID information to the mobile terminal and counts the number of times the information corresponding to the ID information is transmitted. The company A ex managing the server charges the fee corresponding to the count to the requesting company B or individual ex. For example a larger fee is charged when the count is larger.

In Step ex the company A managing the server receives the request for information distribution from another company B. In Step ex the information requested to be distributed is managed in association with the specific ID information in the server managed by the company A. In Step ex the mobile terminal receives the specific ID information from the subject by visible light communication and transmits it to the server managed by the company A. The visible light communication method has already been described in detail in the other embodiments and so its description is omitted here. The server transmits the information corresponding to the specific ID information received from the mobile terminal to the mobile terminal. In Step ex the number of times the information is distributed is counted in the server. Lastly in Step ex the fee corresponding to the information distribution count is charged to the company B. By such charging according to the count the appropriate fee corresponding to the advertising effect of the information distribution can be charged to the company B.

In Step ex whether or not a predetermined time has elapsed from the start of the information distribution is determined. In the case of determining that the predetermined time has not elapsed no fee is charged to the company B in Step ex. In the case of determining that the predetermined time has elapsed the number of times the information is distributed is counted in Step ex. In Step ex the fee corresponding to the information distribution count is charged to the company B. Since the information distribution is performed free of charge within the predetermined time the company B can receive the accounting service after checking the advertising effect and the like.

In Step ex the number of times the information is distributed is counted. In the case of determining that the predetermined time has not elapsed from the start of the information distribution in Step ex no fee is charged in Step ex. In the case of determining that the predetermined time has elapsed on the other hand whether or not the number of times the information is distributed is greater than or equal to a predetermined number is determined in Step ex. In the case where the number of times the information is distributed is less than the predetermined number the count is reset and the number of times the information is distributed is counted again. In this case no fee is charged to the company B regarding the predetermined time during which the number of times the information is distributed is less than the predetermined number. In the case where the count is greater than or equal to the predetermined number in Step ex the count is reset and started again in Step ex. In Step ex the fee corresponding to the count is charged to the company B. Thus in the case where the count during the free distribution time is small the free distribution time is provided again. This enables the company B to receive the accounting service at an appropriate time. Moreover in the case where the count is small the company A can analyze the information and for example when the information is out of season suggest the change of the information to the company B. In the case where the free distribution time is provided again the time may be shorter than the predetermined time provided first. The shorter time than the predetermined time provided first reduces the burden on the company A. Further the free distribution time may be provided again after a fixed time period. For instance if the information is influenced by seasonality the free distribution time is provided again after the fixed time period until the new season begins.

Note that the charge fee may be changed according to the amount of data regardless of the number of times the information is distributed. Distribution of a predetermined amount of data or more may be charged while distribution is free of charge within the predetermined amount of data. The charge fee may be increased with the increase of the amount of data. Moreover when managing the information in association with the specific ID information a management fee may be charged. By charging the management fee it is possible to determine the fee upon requesting the information distribution.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED or an organic EL device in each of the embodiments described above.

A transmission signal is made up of a header H and a body Body . The header includes a unique signal pattern. A receiver finds this unique pattern from a received signal recognizes which part of the received signal represents the header or the body based on the position of the unique pattern and receives data.

In the case where the transmission signal is modulated in a pattern a in the receiver can receive data when successively receiving the header and the body that follows the header. The duration in which the receiver can continuously receive the signal depends on the size of a transmitter shown in a captured image taken image . In the case where the transmitter is small or the transmitter is captured from a distance the duration in which the receiver can continuously receive the signal is short. In the case where the duration continuous reception time in which the receiver can continuously receive the signal is the same as the time taken for transmitting one block including the header and the body the receiver can receive data only when the transmission start point and the reception start point of the header are the same. a in illustrates the case where the continuous reception time is a little longer than the transmission time for one block including the header and the body. Each arrow indicates the continuous reception time. The receiver can receive data when receiving the signal at the timings indicated by the thick arrows but cannot receive data when receiving the signal at the timings indicated by the thin arrows because the header and the body are not completely contained in the received signal.

In the case where the transmission signal is modulated in a pattern b in the receiver can receive data at more reception timings. The transmitter transmits the signal modulated with body header body as one set. The two bodies in the same set represent the same signal. The receiver does not need to continuously receive the whole signal included in the body but can restore the body by concatenating the body parts before and after the header. Hence the receiver can receive data so long as it can continuously receive the whole signal included in the header. In the reception timings at which data can be received are indicated by the thick lines. As illustrated in data reception is possible at more reception timings in b than in a .

In the modulation scheme b in the receiver can restore the body in the case where the body signal length is fixed. The receiver can also restore the body in the case where information of the body signal length is included in the header.

In detail as illustrated in the receiver first detects the header having a unique bright line pattern from the captured image bright line image including bright lines. The receiver then sequentially reads each signal of the body following the header in the direction in . Each time the receiver reads a signal the receiver determines whether or not the signal of the body has been read for the body signal length. That is the receiver determines whether or not the whole signal included in the body has been read. In the case of determining that the whole signal has not been read the receiver reads a signal following the read signal. If there is no following signal the receiver sequentially reads each signal of the body preceding the header in the direction in . The whole signal included in the body is read in this way. Here in the case where the body signal length is fixed the receiver holds the body signal length beforehand and makes the above mentioned determination using the body signal length. Alternatively the receiver specifies the body signal length from the header and makes the above mentioned determination using the body signal length.

Even in the case where the body signal length is variable if the modulation scheme is defined so that the body modulated by the same transmitter has the same signal length the receiver can restore the body by estimating the body signal length from the signal length between two headers. In this case in the modulation scheme b in a signal corresponding to two headers and two bodies needs to be received at one time. In a modulation scheme illustrated in on the other hand merely receiving a signal corresponding to two headers and one body enables the body signal length to be estimated. illustrates the modulation scheme in which body header body header H constitute one set where the receiver can receive data so long as it can continuously receive the whole signal included in the header.

Thus the transmitter in this embodiment determines a first luminance change pattern corresponding to a body which is a part of a signal to be transmitted and a second luminance change pattern indicating a header for specifying the body and transmits the header and the body by changing in luminance according to the first luminance change pattern the second luminance change pattern and the first luminance change pattern in this order. The transmitter may also determine a third luminance change pattern indicating another header different from the header and transmit the header the body and the other header by changing in luminance according to the first luminance change pattern the second luminance change pattern the first luminance change pattern and the third luminance change pattern in this order.

A receiver can not only read a signal from bright lines in the captured image but also analyze a part other than the bright lines by image processing. For instance the receiver receives a signal from a transmitter such as a digital signage. Even in the case where the receiver receives the same signal the receiver can display a different advertisement depending on an image displayed on a screen of the transmitter.

Since the bright lines are noise in image processing image processing may be performed after interpolating pixel values in the bright line part from pixels right and left of the bright lines. Alternatively image processing may be performed on an image except the bright line part.

The receiver includes an imaging element as illustrated in . The imaging element includes effective pixels which constitute a part for capturing an image optical black for measuring noise such as dark current and an ineffective area . The optical black includes VOB for measuring vertical noise and HOB for measuring horizontal noise. Since bright lines appear in a direction horizontal direction during exposure of the VOB or the ineffective area bright lines are not obtained and signal reception is impossible. The time during which signal reception is possible can be increased by switching upon visible light communication to such an imaging mode that does not use the VOB and the ineffective area or minimally uses the VOB and the ineffective area

As illustrated in the exposure time in an effective pixel area which is an area including the effective pixels can be increased by not using the VOB and the ineffective area . In detail in normal imaging one captured image is obtained in each of time t to t time t to t and time t to t as illustrated in a in . Since the VOB and the ineffective area are also used when obtaining each captured image the exposure time the time during which electric charge is read the shaded part in in the effective pixel area is time t to t time t to t and time t to t.

In visible light communication by not using the VOB and the ineffective area the exposure time in the effective pixel area can be increased by the time during which the VOB and the ineffective area are used as illustrated in b in . That is the time during which reception is possible in visible light communication can be increased. This enables reception of more signals.

In normal imaging the exposure of each exposure line in the effective pixel area starts after a predetermined time m elapses from when the exposure of its adjacent exposure line starts as illustrated in a in . In visible light communication on the other hand since the exposure time in the effective pixel area is increased the exposure of each exposure line in the effective pixel area starts after a predetermined time n n m elapses from when the exposure of its adjacent exposure line starts as illustrated in b in .

Thus in normal imaging the receiver in this embodiment performs electric charge reading on each of a plurality of exposure lines in an area including optical black in the image sensor after a predetermined time elapses from when electric charge reading is performed on an exposure line adjacent to the exposure line. In visible light communication the receiver performs electric charge reading on each of a plurality of exposure lines in an area other than the optical black in the image sensor after a time longer than the predetermined time elapses from when electric charge reading is performed on an exposure line adjacent to the exposure line the optical black not being used in electric charge reading.

The time during which signal reception is possible can be further increased by switching upon visible light communication to such an imaging mode that does not reduce the number of vertical pixels by a process such as demosaicing or clipping.

When an image is captured in such a mode that does not use the VOB and the ineffective area and does not reduce the number of vertical pixels the timing of exposing the bottom edge of the captured image and the timing of exposing the top edge of the captured image at the next frame are continuous so that continuous signal reception is possible. Even in the case where the VOB and the like cannot be completely disabled by modulating the transmission signal by an error correctable scheme continuous signal reception is possible.

In photodiodes in the horizontal direction are exposed simultaneously as a result of which horizontal bright lines appear. In visible light communication this exposure mode and an exposure mode of exposing photodiodes in the vertical direction simultaneously are alternately applied to obtain horizontal bright lines and vertical bright lines. Thus the signal can be stably received regardless of the shape of the transmitter.

An imaging element includes effective pixels which are pixels for converting received light intensity to an image and ineffective pixels for not converting received light intensity to an image but using it as for example reference intensity of dark current. In the normal imaging mode there is the time during which only the ineffective pixels receive light i.e. the time during which signal reception is impossible as illustrated in a . In the visible light communication mode the time during which reception is possible is increased by minimizing the time during which only the ineffective pixels receive light as illustrated in b or by setting the effective pixels to constantly receive light as illustrated in c . This also enables continuous reception. Though there is the time during which reception is impossible in the case of b the use of error correction code in the transmission data allows the whole signal to be estimated even when a part of the signal cannot be received.

As illustrated in the process starts in Step . In Step a receiver receives a signal. In Step the receiver detects a header. In Step the receiver determines whether or not the data size of a body following the header is known. In the case of Yes the process proceeds to Step . In the case of No the process proceeds to Step and the receiver reads the data size of the body following the header from the header. The process then proceeds to Step . In Step the receiver determines whether or not the signal indicating the body is all successively received following the header. In the case of Yes the process proceeds to Step and the receiver reads the body part from the signal received following the header. In Step the process ends. In the case of No the process proceeds to Step and the receiver determines whether or not the total data length of the part received following the header and the part received before the header is sufficient for the data length of the body. In the case of Yes the process proceeds to Step and the receiver reads the body part by concatenating the part received following the header and the part received before the header. In Step the process ends. In the case of No the process proceeds to Step and the receiver determines whether or not means for capturing many bright lines from a transmitter is available. In the case of Yes the process proceeds to Step and the receiver changes to a setting capable of capturing many bright lines. The process then returns to Step . In the case of No the process proceeds to Step and the receiver notifies that a transmitter is present but the image capture size is insufficient. In Step the receiver notifies the direction toward the transmitter and that reception is possible if moving closer to the transmitter. In Step the process ends.

With this method the signal can be stably received even in the case where the number of exposure lines passing through the transmitter in the captured image is small.

In the case where an effective pixel area of an imaging element is 4 3 if an image is captured at 16 9 top and bottom parts of the image are clipped. When horizontal bright lines appear bright lines are lost due to this clipping and the time during which signal reception is possible is shortened. Likewise in the case where the effective pixel area of the imaging element is 16 9 if an image is captured at 4 3 right and left parts of the image are clipped. When vertical bright lines appear the time during which signal reception is possible is shortened. In view of this an aspect ratio that involves no clipping i.e. 4 3 in and 16 9 in is set as an aspect ratio for imaging in the visible light communication mode. This contributes to a longer time during which reception is possible.

Thus the receiver in this embodiment further sets an aspect ratio of an image obtained by the image sensor. In visible light communication the receiver determines whether or not an edge of the image perpendicular to the exposure lines bright lines is clipped in the set aspect ratio and changes the set aspect ratio to a non clipping aspect ratio in which the edge is not clipped in the case of determining that the edge is clipped. The image sensor in the receiver obtains the bright line image in the non clipping aspect ratio by capturing the subject changing in luminance.

This reception method sets an imaging aspect ratio for increasing the reception time and receiving a signal from a small transmitter.

As illustrated in the process starts in Step Ba. In Step Bb the receiver changes the imaging mode to the visible light communication mode. In Step Bc the receiver determines whether or not the captured image aspect ratio is set to be closest to the effective pixel aspect ratio. In the case of Yes the process proceeds to Step Bd and the receiver sets the captured image aspect ratio to be closest to the effective pixel aspect ratio. In Step Be the process ends. In the case of No the process ends in Step Be. Setting the aspect ratio in the visible light communication mode in this way reduces the time during which reception is impossible and also enables signal reception from a small transmitter or a distant transmitter.

This reception method sets an imaging aspect ratio for increasing the number of samples per unit time.

As illustrated in the process starts in Step Ca. In Step Cb the receiver changes the imaging mode to the visible light communication mode. In Step Cc the receiver determines whether or not though bright lines of exposure lines can be recognized signal reception is impossible because the number of samples per unit time is small In the case of Yes the process proceeds to Step Cd and the receiver sets the captured image aspect ratio to be most different from the effective pixel aspect ratio. In Step Ce the receiver increases the imaging frame rate. The process then returns to Step Cc. In the case of No the process proceeds to Step Cf and the receiver receives a signal. The process then ends.

Setting the aspect ratio in the visible light communication mode in this way enables reception of a high frequency signal and also enables reception even in an environment with a large amount of noise.

A receiver finds an area where bright lines are present in a captured image and performs zoom so that as many bright lines as possible appear. The number of bright lines can be maximized by enlarging the bright line area in the direction perpendicular to the bright line direction until the bright line area lies over the top and bottom edges of the screen as in a captured image

The receiver may find an area where bright lines are displayed clearly and perform zoom so that the area is shown in a large size as in a captured image

In the case where a plurality of bright line areas are present in a captured image the above mentioned process may be performed for each of the bright line areas or performed for a bright line area designated by a user from the captured image.

In the case where the image data size needs to be reduced when sending a captured image a from an imaging unit to an image processing unit or from an imaging terminal receiver to a server reduction or pixel omission in the direction parallel to bright lines as in c enables the data size to be reduced without decreasing the amount of information of bright lines. When reduction or pixel omission is performed as in b or d on the other hand the number of bright lines decreases or it becomes difficult to recognize bright lines. Upon image compression too a decrease in reception efficiency can be prevented by not performing compression in the direction perpendicular to bright lines or by setting the compression rate in the perpendicular direction lower than that in the parallel direction. Note that a moving average filter is applicable to any of the parallel and perpendicular directions and is effective in both data size reduction and noise reduction.

Thus the receiver in this embodiment further compresses the bright line image in a direction parallel to each of the plurality of bright lines included in the bright line image to generate a compressed image and transmits the compressed image.

Error detection by a parity bit detects a 1 bit reception error and so cannot detect a mix up between 01 and 10 and a mix up between 00 and 11 . In a modulation scheme a 01 and 10 tend to be mixed up because the L position differs only by one between 01 and 10 . In a modulation scheme b on the other hand the L position differs by two between 01 and 10 and between 00 and 11 . Hence a reception error can be detected with high accuracy through the use of the modulation scheme b . The same applies to the modulation schemes in .

Thus in this embodiment luminance change patterns between which the timing at which a predetermined luminance value e.g. L occurs is different are assigned to different signal units beforehand to prevent two luminance change patterns from being assigned to signal units of the same parity e.g. 01 and 10 the timing at which the predetermined luminance value occurs in one of the two luminance change patterns being adjacent to the timing at which the predetermined luminance value occurs in the other one of the two luminance change patterns. The transmitter in this embodiment determines for each signal unit included in the transmission signal a luminance change pattern assigned to the signal unit.

A receiver operates differently according to a situation in which reception starts. For instance in the case of being activated in Japan the receiver receives a signal modulated by phase shift keying at 60 kHz and downloads data from a server using the received ID as a key. In the case of being activated in the US the receiver receives a signal modulated by frequency shift keying at 50 kHz and downloads data from a server using the received ID as a key. The situation according to which the operation of the receiver changes includes a location country or building where the receiver is present a base station or a wireless access point Wi Fi Bluetooth IMES etc. in communication with the receiver a time of day and so on.

For example the receiver transmits to a server position information information of a last accessed wireless base station a base station of a carrier communication network Wi Fi Bluetooth IMES etc. or an ID last received by visible light communication. The server estimates the position of the receiver based on the received information and transmits a reception algorithm capable of receiving transmission signals of transmitters near the position and information e.g. URI of an ID management server managing IDs of transmitters near the position. The receiver receives a signal of a transmitter or using the received algorithm and inquires of an ID management server or indicated by the received information using the ID as a key.

With this method communication can be performed by a scheme that differs depending on country region building or the like. The receiver in this embodiment may upon receiving a signal switch the server to be accessed the reception algorithm or the signal modulation method illustrated in according to the frequency used for modulating the signal.

A light emitting unit in a transmitter repeatedly performs blinking visually recognizable by humans and visible light communication as illustrated in a in . Blinking visually recognizable by humans can notify humans that visible light communication is possible. Upon seeing that the transmitter is blinking a user notices that visible light communication is possible. The user accordingly points a receiver at the transmitter to perform visible light communication and conducts user registration of the transmitter

Thus the transmitter in this embodiment repeatedly alternates between a step of a light emitter transmitting a signal by changing in luminance and a step of the light emitter blinking so as to be visible to the human eye.

The transmitter may include a visible light communication unit and a blinking unit communication state display unit separately as illustrated in b in .

The transmitter may operate as illustrated in c in using the modulation scheme in thereby making the light emitting unit appear blinking to humans while performing visible light communication. In detail the transmitter repeatedly alternates between high luminance visible light communication with brightness 75 and low luminance visible light communication with brightness 1 . As an example by operating as illustrated in c in when an abnormal condition or the like occurs in the transmitter and the transmitter is transmitting a signal different from normal the transmitter can alert the user without stopping visible light communication.

A receiver is in a normal mode in a in and in a visible light communication mode in b in . The receiver includes a diffusion plate in front of an imaging unit. In the visible light communication mode the receiver moves the diffusion plate to be in front of the imaging unit so that a light source is captured wider. Here the position of the diffusion plate is adjusted to prevent light from a plurality of light sources from overlapping each other. A macro lens or a zoom lens may be used instead of the diffusion plate . This enables signal reception from a distant transmitter or a small transmitter.

An area of an image sensor where the diffusion plate is shown may be used only in the visible light communication mode and not in the normal imaging mode. In this way the above mentioned advantageous effect can be achieved without moving the diffusion plate or the imaging unit.

In the case of using a plurality of projectors for projection mapping or the like for projection onto one part there is a need to transmit a signal only from one projector or synchronize the signal transmission timings of the plurality of projectors in order to avoid interference. illustrates a mechanism for synchronization of transmission.

Projectors A and B that project onto the same projection surface transmit signals as illustrated in . A receiver captures the projection surface for signal reception calculates the time difference between signals a and b and adjusts the signal transmission timing of each projector.

Since the projectors A and B are not synchronous at the operation start a time total pause time during which both the projectors A and B transmit no signal is provided to prevent the signals a and b from overlapping and being unable to be received. The signal transmitted from each projector may be changed as the timing adjustment for the projector progresses. For example efficient timing adjustment can be made by taking a longer total pause time at the operation start and shortening the total pause time as the timing adjustment progresses.

For accurate timing adjustment it is desirable that the signals a and b are contained in one captured image. The imaging frame rate of the receiver tends to be 60 fps to 7.5 fps. By setting the signal transmission period to less than or equal to 1 7.5 second the signals a and b can be contained in an image captured at 7.5 fps. By setting the signal transmission period to less than or equal to 1 60 second the signals a and b can be reliably contained in an image captured at 30 fps.

An image sensor consumes more power than an illuminance sensor. Accordingly when a signal is detected by an illuminance sensor a receiver activates an image sensor to receive the signal. As illustrated in a in the receiver receives a signal transmitted from a transmitter by the illuminance sensor . After this the receiver activates the image sensor receives the transmission signal of the transmitter by the image sensor and also recognizes the position of the transmitter . At the time when the image sensor receives a part of the signal if the part is the same as the signal received by the illuminance sensor the receiver provisionally determines that the same signal is received and performs a subsequent process such as displaying the current position. The determination is completed once the image sensor has successfully received the whole signal.

Upon the provisional determination information that the determination is not completed may be displayed. For instance the current position is displayed semi transparently or a position error is displayed.

The part of the signal may be for example 20 of the total signal length or an error detection code portion.

In a situation as illustrated in b in the receiver cannot receive signals by the illuminance sensor due to interference but can recognize the presence of signals. For example the receiver can estimate that signals are present in the case where a peak appears in transmission signal modulation frequency when the sensor value of the illuminance sensor is Fourier transformed. Upon estimating that signals are present from the sensor value of the illuminance sensor the receiver activates the image sensor and receives signals from transmitters and

Power is consumed while an image sensor or an illuminance sensor hereafter collectively referred to as light receiving sensor is on. Stopping the light receiving sensor when not needed and activating it when needed contributes to improved power consumption efficiency. Here since the illuminance sensor consumes less power than the image sensor only the image sensor may be controlled while the illuminance sensor is always on.

In a in a receiver detects movement from a sensor value of a 9 axis sensor and activates a light receiving sensor to start reception.

In b in the receiver detects an operation of tilting the receiver horizontally from the sensor value of the 9 axis sensor and activates a light receiving sensor pointed upward to start reception.

In c in the receiver detects an operation of sticking the receiver out from the sensor value of the 9 axis sensor and activates a light receiving sensor in the stick out direction to start reception.

In d in the receiver detects an operation of directing the receiver upward or shaking the receiver from the sensor value of the 9 axis sensor and activates a light receiving sensor pointed upward to start reception.

Thus the receiver in this embodiment further determines whether or not the receiver reception device is moved in a predetermined manner and activates the image sensor in the case of determining that the reception device is moved in the predetermined manner.

A receiver such as a smartphone detects an operation of setting the receiver upright and sliding the receiver in the horizontal direction or repeatedly sliding the receiver in the horizontal direction from a sensor value of a 9 axis sensor. The receiver then starts reception and obtains the position of each transmitter based on the received ID. The receiver obtains the position of the receiver from the relative position relations between the receiver and the plurality of transmitters . The receiver can stably capture the plurality of transmitters by being slid and estimate the position of the receiver with high accuracy by triangulation.

This operation may be performed only when the receiver s home screen is in the foreground. This can prevent the communication from being launched despite the user s intension while the user is using another application.

A transmitter such as a car navigation system transmits information for wirelessly connecting to the transmitter such as Bluetooth pairing information Wi Fi SSID and password or an IP address. A receiver such as a smartphone establishes wireless connection with the transmitter based on the received information and performs subsequent communication via the wireless connection.

As an example a user inputs a destination store information to be searched for or the like to the smartphone . The smartphone transmits the input information to the car navigation system via the wireless connection and the car navigation system displays route information. As another example the smartphone operates as a controller of the car navigation system to control music or video reproduced in the car navigation system . As another example music or video held in the smartphone is reproduced in the car navigation system . As another example the car navigation system obtains nearby store information or road congestion information and has the smartphone display the information. As another example upon receiving a call the smartphone uses a microphone and a speaker of the wirelessly connected car navigation system for a conversation process. The smartphone may establish wireless connection and performs the above mentioned operation upon receiving a call.

In the case where the car navigation system is set in an automatic connection mode for wireless connection the car navigation system is wirelessly connected to a registered terminal automatically. In the case where the car navigation system is not in the automatic connection mode the car navigation system transmits connection information using visible light communication and waits for connection. The car navigation system may transmit connection information using visible light communication and wait for connection even in the automatic connection mode. In the case where the car navigation system is manually connected the automatic connection mode may be cleared and a terminal automatically connected to the car navigation system may be disconnected.

A transmitter such as a television transmits content protection information held in the transmitter or a device connected to the transmitter . A receiver such as a smartphone receives the content protection information and performs content protection for a predetermined time afterward so that content protected by the content protection information in the transmitter or the device can be reproduced. Thus content held in another device possessed by the user can be reproduced in the receiver.

The transmitter may store the content protection information in a server and the receiver may obtain the content protection information from the server using a received ID of the transmitter as a key.

A receiver receives an ID transmitted from a transmitter and transmits the ID to a server . When receiving the ID of the transmitter from the receiver the server unlocks a door opens an automatic door or calls an elevator for moving to a floor registered in the receiver to a floor on which the receiver is present. The receiver thus functions as a key allowing the user to unlock the door before reaching the door as an example.

Thus the receiver in this embodiment obtains a first bright line image which is an image including a plurality of bright lines by capturing a subject e.g. the above mentioned transmitter changing in luminance and obtains first transmission information e.g. the ID of the subject by demodulating data specified by a pattern of the plurality of bright lines included in the obtained first bright line image. After the first transmission information is obtained the receiver causes an opening and closing drive device of a door to open the door by transmitting a control signal e.g. the ID of the subject .

To prevent malicious operation the server may verify that the device in communication is the receiver through the use of security protection such as a secure element of the receiver . Moreover to make sure that the receiver is near the transmitter the server may upon receiving the ID of the transmitter issue an instruction to transmit a different signal to the transmitter and in the case where the signal is transmitted from the receiver unlock the door

In the case where a plurality of transmitters as lighting devices are arranged along a passageway to the door the receiver receives IDs from these transmitters to determine whether or not the receiver is approaching the door . For example in the case where the values indicated by the IDs decrease in the order in which the IDs are obtained the receiver determines that the receiver is approaching the door. Alternatively the receiver specifies the position of each transmitter based on the corresponding ID and estimates the position of the receiver based on the position of each transmitter and the position of the transmitter shown in the captured image. The receiver then compares the position of the door held beforehand and the estimated position of the receiver as needed to determine whether or not the receiver is approaching the door . Upon determining that the receiver is approaching the door the receiver transmits any of the obtained IDs to the server . The server responsively performs a process for opening the door as an example.

Thus the receiver in this embodiment obtains a second bright line image which is an image including a plurality of bright lines by capturing another subject changing in luminance and obtains second transmission information e.g. the ID of the other subject by demodulating data specified by a pattern of the plurality of bright lines included in the obtained second bright line image. The receiver determines whether or not the receiver is approaching the door based on the obtained first transmission information and second transmission information. In the case of determining that the receiver is approaching the door the receiver transmits the control signal e.g. the ID of any of the subjects .

An information communication method in this embodiment is an information communication method of obtaining information from a subject and includes steps SK to SK.

In detail the information communication method includes a first exposure time setting step SK of setting a first exposure time of an image sensor so that in an image obtained by capturing a first subject by the image sensor a plurality of bright lines corresponding to exposure lines included in the image sensor appear according to a change in luminance of the first subject the first subject being the subject a first bright line image obtainment step SK of obtaining a first bright line image which is an image including the plurality of bright lines by capturing the first subject changing in luminance by the image sensor with the set first exposure time a first information obtainment step SK of obtaining first transmission information by demodulating data specified by a pattern of the plurality of bright lines included in the obtained first bright line image and a door control step SK of causing an opening and closing drive device of a door to open the door by transmitting a control signal after the first transmission information is obtained.

An information communication device K in this embodiment is an information communication device that obtains information from a subject and includes structural elements K to K.

In detail the information communication device K includes an exposure time setting unit K that sets an exposure time of an image sensor so that in an image obtained by capturing the subject by the image sensor a plurality of bright lines corresponding to exposure lines included in the image sensor appear according to a change in luminance of the subject a bright line image obtainment unit K that includes the image sensor and obtains a bright line image which is an image including the plurality of bright lines by capturing the subject changing in luminance with the set exposure time an information obtainment unit K that obtains transmission information by demodulating data specified by a pattern of the plurality of bright lines included in the obtained bright line image and a door control unit K that causes an opening and closing drive device of a door to open the door by transmitting a control signal after the transmission information is obtained.

In the information communication method and the information communication device K illustrated in the receiver including the image sensor can be used as a door key thus eliminating the need for a special electronic lock for instance as illustrated in . This enables communication between various devices including a device with low computational performance.

It should be noted that in the above embodiments each of the constituent elements may be constituted by dedicated hardware or may be obtained by executing a software program suitable for the constituent element. Each constituent element may be achieved by a program execution unit such as a CPU or a processor reading and executing a software program stored in a recording medium such as a hard disk or semiconductor memory. For example the program causes a computer to execute the information communication method illustrated in the flowchart of .

A receiver transmits an ID transmitted from a transmitter to a server . The server notifies a store staff of order information associated with the receiver . The store staff prepares a product or the like based on the order information. Since the order has already been processed when the user enters the store the user can promptly receive the product or the like.

A receiver displays a screen allowing an order only when a transmission signal of a transmitter is received. In this way a store can avoid taking an order from a customer who is not nearby.

Alternatively the receiver places an order by transmitting an ID of the transmitter in addition to order information. This enables the store to recognize the position of the orderer and recognize the position to which a product is to be delivered or estimate the time by which the orderer is likely to arrive at the store. The receiver may add the travel time to the store calculated from the moving speed to the order information. Regarding suspicious purchase based on the current position e.g. purchase of a ticket of a train departing from a station other than the current position the receiver may reject the purchase.

A receiver receives a transmission ID of a transmitter such as a guide sign obtains data of a map displayed on the guide sign from a server and displays the map data. Here the server may transmit an advertisement suitable for the user of the receiver so that the receiver displays the advertisement information too. The receiver displays the route from the current position to the location designated by the user.

A receiver receives an ID transmitted from a transmitter such as a home or school lighting and transmits position information obtained using the ID as a key to a terminal . A parent having the terminal can thus be notified that his or her child having the receiver has got back home or arrived at the school. As another example a supervisor having the terminal can recognize the current position of a worker having the receiver

A receiver receives an ID transmitted from a transmitter such as a sign obtains coupon information from a server and displays the coupon information. The receiver stores the subsequent behavior of the user such as saving the coupon moving to a store displayed in the coupon shopping in the store or leaving without saving the coupon in the server . In this way the subsequent behavior of the user who has obtained information from the sign can be analyzed to estimate the advertisement value of the sign

A transmitter such as a projector or a display transmits information an SSID a password for wireless connection an IP address a password for operating the transmitter for wirelessly connecting to the transmitter or transmits an ID which serves as a key for accessing such information. A receiver such as a smartphone a tablet a notebook computer or a camera receives the signal transmitted from the transmitter to obtain the information and establishes wireless connection with the transmitter . The wireless connection may be made via a router or directly made by Wi Fi Direct Bluetooth Wireless Home Digital Interface or the like. The receiver transmits a screen to be displayed by the transmitter . Thus an image on the receiver can be easily displayed on the transmitter.

When connected with the receiver the transmitter may notify the receiver that not only the information transmitted from the transmitter but also a password is needed for screen display and refrain from displaying the transmitted screen if a correct password is not obtained. In this case the receiver displays a password input screen or the like and prompts the user to input the password.

The above mentioned operation may be performed only in the case where the difference between the time at which the receiver receives the signal transmitted from the transmitter and the time at which the receiver receives the signal transmitted from the transmitter is within a predetermined time.

The transmitter may transmit the image to the transmitter only in the case where the transmitter receives a correct password from the receiver

A receiver such as a smartphone receives an ID transmitted from a transmitter . The receiver obtains position information of the transmitter using the received ID as a key and estimates the position of the receiver based on the position and direction of the transmitter in the captured image. The receiver also receives a signal from a radio wave transmitter such as a Wi Fi access point. The receiver estimates the position of the receiver based on position information and radio wave transmission direction information of the radio wave transmitter included in the signal. The receiver estimates the position of the receiver by a plurality of means in this manner and so can estimate its position with high accuracy.

A method of estimating the position of the receiver using the information of the radio transmitter is described below. The radio transmitter transmits synchronous signals in different directions from a plurality of antennas. The radio transmitter also changes the signal transmission direction in sequence. The receiver estimates that a radio wave transmission direction in which the radio field intensity is highest is the direction from the radio transmitter to the receiver . Moreover the receiver calculates path differences from the differences in arrival time of radio waves transmitted from the different antennas and respectively passing through paths and and calculates the distance between the radio transmitter and the receiver from radio wave transmission angle differences and . By further using surrounding electric field information and radio wave reflector information the receiver can estimate its position with higher accuracy.

A mobile terminal a smartphone terminal performs visible light communication with a light emitting unit to obtain an ID of the light emitting unit. The mobile terminal inquires of a server using the obtained ID and obtains position information of the light emitting unit. By doing so the mobile terminal obtains an actual distance L and an actual distance L which are respective distances in the x axis direction and in the y axis direction between a multiple input and multiple output access point MIMO and the light emitting unit. Furthermore the mobile terminal detects a tilt of the mobile terminal using a gyroscope or the like as already described in other embodiments.

In the case where beamforming is performed from an MIMO access point toward the mobile terminal a beamforming angle is set by the MIMO access point and is a known value. Accordingly the mobile terminal obtains the beamforming angle by wireless communication or the like.

As a result using the actual distance L the actual distance L the tilt of the mobile terminal and the beamforming angle the mobile terminal is capable of calculating a coordinate position x y of the mobile terminal which is based on the MIMO access point. The MIMO access point is capable of forming a plurality of beams and so a plurality of beamformings may be used for position estimation of higher accuracy.

As described above according to this embodiment the position estimation accuracy can be enhanced by employing both the position estimation by visible light communication and the position estimation by wireless communication.

Though the information communication method according to one or more aspects has been described by way of the embodiments above the present disclosure is not limited to these embodiments. Modifications obtained by applying various changes conceivable by those skilled in the art to the embodiments and any combinations of structural elements in different embodiments are also included in the scope of one or more aspects without departing from the scope of the present disclosure.

An information communication method according to an aspect of the present disclosure may also be applied as illustrated in .

A camera serving as a receiver in the visible light communication captures an image in a normal imaging mode Step 1 . Through this imaging the camera obtains an image file in a format such as an exchangeable image file format EXIF . Next the camera captures an image in a visible light communication imaging mode Step 2 . The camera obtains based on a pattern of bright lines in an image obtained by this imaging a signal visible light communication information transmitted from a subject serving as a transmitter by visible light communication Step 3 . Furthermore the camera accesses a server by using the signal reception information as a key and obtains from the server information corresponding to the key Step 4 . The camera stores each of the following as metadata of the above image file the signal transmitted from the subject by visible light communication visible light reception data the information obtained from the server data indicating a position of the subject serving as the transmitter in the image represented by the image file data indicating the time at which the signal transmitted by visible light communication is received time in the moving image and others. Note that in the case where a plurality of transmitters are shown as subjects in a captured image an image file the camera stores for each of the transmitters pieces of the metadata corresponding to the transmitter into the image file.

When displaying an image represented by the above described image file a display or projector serving as a transmitter in the visible light communication transmits by visible light communication a signal corresponding to the metadata included in the image file. For example in the visible light communication the display or the projector may transmit the metadata itself or transmit as a key the signal associated with the transmitter shown in the image.

The mobile terminal the smartphone serving as the receiver in the visible light communication captures an image of the display or the projector thereby receiving a signal transmitted from the display or the projector by visible light communication. When the received signal is the above described key the mobile terminal uses the key to obtain from the display the projector or the server metadata of the transmitter associated with the key. When the received signal is a signal transmitted from a really existing transmitter by visible light communication visible light reception data or visible light communication information the mobile terminal obtains information corresponding to the visible light reception data or the visible light communication information from the display the projector or the server.

First upon detection of pressing of an image capture button Step S the camera captures an image in the normal imaging mode Step S . The camera then increases its shutter speed to a predetermined speed or greater that is sets a shorter exposure time than that set in the normal imaging mode and captures an image in a visible light imaging mode Step S . Thus the camera obtains a signal transmitted from the subject by visible light communication.

Subsequently the camera uses as a key a signal information obtained by visible light communication thereby obtaining information associated with the key from the server Step S . Next the camera stores the signal and each piece of information and data into a metadata area e.g. an area into which EXIF metadata is stored of an image file obtained by imaging in the normal imaging mode Step S . In detail the camera stores a signal obtained by visible light communication information obtained from the server position data indicating a position in an image an image captured in the normal imaging mode of a transmitter which is a subject that has transmitted the signal in the visible light communication and the like.

The camera then determines whether to capture moving images Step S and when determining to capture moving images Step S Y repeats the processes following Step S and when determining to not capture moving images Step S N ends the imaging process.

First the display checks the metadata area of the image file to determine whether the number of transmitters shown in the image represented by the image file is one or more than one Step S . Here when determining that the number of transmitters is more than one Step S more than 1 the display further determines whether or not a divided transmission mode has been set as a mode in the visible light communication Step S . When determining that the divided transmission mode has been set Step S Y a display area a transmission part of the display is divided into display areas and the display transmits a signal from each of the display areas Step S . Specifically for each transmitter the display handles as a display area an area in which the transmitter is shown or an area in which the transmitter and surroundings thereof are shown and transmits a signal corresponding to the transmitter from the display area by visible light communication.

When determining in Step S that the divided transmission mode has not been set Step S N the display transmits a signal corresponding to each of the transmitters from the entire display area of the display by visible light communication Step S . In short the display transmits from the entire screen a key associated with a plurality of pieces of information.

When determining in Step S that the number of transmitters is one Step S the display transmits a signal corresponding to the one transmitter from the entire display area of the display by visible light communication Step S . In short the display transmits the signal from the entire screen.

Furthermore when a mobile terminal a smartphone accesses the display by using the signal transmitted by visible light communication the transmission information as a key after any one of Steps S to for example the display provides the access source i.e. the mobile terminal with metadata of the image file that is associated with the key Step S .

An information communication method in this embodiment is an information communication method of obtaining information from a subject the information communication method including setting a first exposure time of an image sensor so that in an image obtained by capturing a first subject by the image sensor a plurality of bright lines corresponding to exposure lines included in the image sensor appear according to a change in luminance of the first subject the first subject being the subject obtaining a first bright line image which is an image including the plurality of bright lines by capturing the first subject changing in luminance by the image sensor with the set first exposure time obtaining first transmission information by demodulating data specified by a pattern of the plurality of bright lines included in the obtained first bright line image and causing an opening and closing drive device of a door to open the door by transmitting a control signal after the first transmission information is obtained.

In this way the receiver including the image sensor can be used as a door key thus eliminating the need for a special electronic lock for instance as illustrated in . This enables communication between various devices including a device with low computational performance.

For example the information communication method may further include obtaining a second bright line image which is an image including a plurality of bright lines by capturing a second subject changing in luminance by the image sensor with the set first exposure time obtaining second transmission information by demodulating data specified by a pattern of the plurality of bright lines included in the obtained second bright line image and determining whether or not a reception device including the image sensor is approaching the door based on the obtained first transmission information and second transmission information wherein in the causing of an opening and closing drive device the control signal is transmitted in the case of determining that the reception device is approaching the door.

In this way the door can be opened at appropriate timing i.e. only when the reception device receiver is approaching the door for instance as illustrated in .

For example the information communication method may further include setting a second exposure time longer than the first exposure time and obtaining a normal image in which a third subject is shown by capturing the third subject by the image sensor with the set second exposure time wherein in the obtaining of a normal image electric charge reading is performed on each of a plurality of exposure lines in an area including optical black in the image sensor after a predetermined time elapses from when electric charge reading is performed on an exposure line adjacent to the exposure line and in the obtaining of a first bright line image electric charge reading is performed on each of a plurality of exposure lines in an area other than the optical black in the image sensor after a time longer than the predetermined time elapses from when electric charge reading is performed on an exposure line adjacent to the exposure line the optical black not being used in electric charge reading.

In this way electric charge reading exposure is not performed on the optical black when obtaining the first bright line image so that the time for electric charge reading exposure on an effective pixel area which is an area in the image sensor other than the optical black can be increased for instance as illustrated in . As a result the time for signal reception in the effective pixel area can be increased with it being possible to obtain more signals.

For example the information communication method may further include determining whether or not a length of the pattern of the plurality of bright lines included in the first bright line image is less than a predetermined length the length being perpendicular to each of the plurality of bright lines changing a frame rate of the image sensor to a second frame rate lower than a first frame rate used when obtaining the first bright line image in the case of determining that the length of the pattern is less than the predetermined length obtaining a third bright line image which is an image including a plurality of bright lines by capturing the first subject changing in luminance by the image sensor with the set first exposure time at the second frame rate and obtaining the first transmission information by demodulating data specified by a pattern of the plurality of bright lines included in the obtained third bright line image.

In this way in the case where the signal length indicated by the bright line pattern bright line area included in the first bright line image is less than for example one block of the transmission signal the frame rate is decreased and the bright line image is obtained again as the third bright line image for instance as illustrated in . Since the length of the bright line pattern included in the third bright line image is longer one block of the transmission signal is successfully obtained.

For example the information communication method may further include setting an aspect ratio of an image obtained by the image sensor wherein the obtaining of a first bright line image includes determining whether or not an edge of the image perpendicular to the exposure lines is clipped in the set aspect ratio changing the set aspect ratio to a non clipping aspect ratio in which the edge is not clipped in the case of determining that the edge is clipped and obtaining the first bright line image in the non clipping aspect ratio by capturing the first subject changing in luminance by the image sensor.

In this way in the case where the aspect ratio of the effective pixel area in the image sensor is 4 3 but the aspect ratio of the image is set to 16 9 and horizontal bright lines appear i.e. the exposure lines extend along the horizontal direction it is determined that top and bottom edges of the image are clipped i.e. edges of the first bright line image is lost for instance as illustrated in . In such a case the aspect ratio of the image is changed to an aspect ratio that involves no clipping for example 4 3. This prevents edges of the first bright line image from being lost as a result of which a lot of information can be obtained from the first bright line image.

For example the information communication method may further include compressing the first bright line image in a direction parallel to each of the plurality of bright lines included in the first bright line image to generate a compressed image and transmitting the compressed image.

In this way the first bright line image can be appropriately compressed without losing information indicated by the plurality of bright lines for instance as illustrated in .

For example the information communication method may further include determining whether or not a reception device including the image sensor is moved in a predetermined manner and activating the image sensor in the case of determining that the reception device is moved in the predetermined manner.

In this way the image sensor can be easily activated only when needed for instance as illustrated in . This contributes to improved power consumption efficiency.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED or an organic EL device in each of the embodiments described above.

A robot has a function as for example a self propelled vacuum cleaner and a function as a receiver in each of the above embodiments. Lighting devices and each have a function as a transmitter in each of the above embodiments.

For instance the robot cleans a room and also captures the lighting device illuminating the interior of the room while moving in the room. The lighting device transmits the ID of the lighting device by changing in luminance. The robot accordingly receives the ID from the lighting device and estimates the position self position of the robot based on the ID as in each of the above embodiments. That is the robot estimates the position of the robot while moving based on the result of detection by a 9 axis sensor the relative position of the lighting device shown in the captured image and the absolute position of the lighting device specified by the ID.

When the robot moves away from the lighting device the robot transmits a signal turn off instruction instructing to turn off to the lighting device . For example when the robot moves away from the lighting device by a predetermined distance the robot transmits the turn off instruction. Alternatively when the lighting device is no longer shown in the captured image or when another lighting device is shown in the image the robot transmits the turn off instruction to the lighting device . Upon receiving the turn off instruction from the robot the lighting device turns off according to the turn off instruction.

The robot then detects that the robot approaches the lighting device based on the estimated position of the robot while moving and cleaning the room. In detail the robot holds information indicating the position of the lighting device and when the distance between the position of the robot and the position of the lighting device is less than or equal to a predetermined distance detects that the robot approaches the lighting device . The robot transmits a signal turn on instruction instructing to turn on to the lighting device . Upon receiving the turn on instruction the lighting device turns on according to the turn on instruction.

In this way the robot can easily perform cleaning while moving by making only its surroundings illuminated.

For example a plurality of light emitting areas A to F are arranged in a display and each of the light emitting areas A to F changes in luminance to transmit a signal as illustrated in a in . In the example illustrated in a in the light emitting areas A to F are each a rectangle and are aligned along the horizontal and vertical directions. In such a case a non luminance change area that does not change in luminance extends across the display along the horizontal direction of the display between the light emitting areas A B and C and the light emitting areas D E and F. Another non luminance change area that does not change in luminance also extends across the display along the vertical direction of the display between the light emitting areas A and D and the light emitting areas B and E. Another non luminance change area that does not change in luminance also extends across the display along the vertical direction of the display between the light emitting areas B and E and the light emitting areas C and F.

When a receiver in each of the above embodiments captures the display in a state where the exposure lines of the receiver are in the horizontal direction no bright line appears in the part of the image obtained by image capture captured image corresponding to the non luminance change area along the horizontal direction. That is the area bright line area where bright lines appear is discontinuous in the captured image. When the receiver captures the display in a state where the exposure lines of the receiver are in the vertical direction no bright line appears in the parts of the captured image corresponding to the two non luminance change areas along the vertical direction. In this case too the bright line area is discontinuous in the captured image. When the bright line area is discontinuous it is difficult to receive the signal transmitted by luminance change.

In view of this a display in this embodiment has a function as a transmitter in each of the above embodiments and has each of the plurality of light emitting areas A to F shifted in position so that the bright line area is continuous.

For example the upper light emitting areas A B and C and the lower light emitting areas D E and F are shifted in position from each other in the horizontal direction in the display as illustrated in b in . Alternatively the light emitting areas A to F that are each a parallelogram or a rhombus are arranged in the display as illustrated in c in . This eliminates a non luminance change area lying across the display along the vertical direction of the display between the light emitting areas A to F. As a result the bright line area is continuous in the captured image even when the receiver captures the display in a state where the exposure lines are in the vertical direction.

The light emitting areas A to F may be shifted in position in the vertical direction in the display as illustrated in d and e in . This eliminates a non luminance change area lying across the display along the horizontal direction of the display between the light emitting areas A to F. As a result the bright line area is continuous in the captured image even when the receiver captures the display in a state where the exposure lines are in the horizontal direction.

The light emitting areas A to F that are each a hexagon may be arranged in the display so that the sides of the areas are parallel to each other as illustrated in f in . This eliminates a non luminance change area lying across the display along any of the horizontal and vertical directions of the display between the light emitting areas A to F as in the above mentioned cases. As a result the bright line area is continuous in the captured image even when the receiver captures the display in a state where the exposure lines are in the horizontal direction or captures the display in a state where the exposure lines are in the vertical direction.

An information communication method in this embodiment is an information communication method of transmitting a signal by a change in luminance and includes steps SK and SK.

In detail the information communication method includes a determination step SK of determining a pattern of the change in luminance by modulating the signal to be transmitted and a transmission step SK of transmitting the signal by a plurality of light emitters changing in luminance according to the determined pattern of the change in luminance. The plurality of light emitters are arranged on a surface so that a non luminance change area does not extend across the surface between the plurality of light emitters along at least one of a horizontal direction and a vertical direction of the surface the non luminance change area being an area in the surface outside the plurality of light emitters and not changing in luminance.

An information communication device K in this embodiment is an information communication device that transmits a signal by a change in luminance and includes structural elements K and K.

In detail the information communication device K includes a determination unit K that determines a pattern of the change in luminance by modulating the signal to be transmitted and a transmission unit K that transmits the signal by a plurality of light emitters changing in luminance according to the determined pattern of the change in luminance. The plurality of light emitters are arranged on a surface so that a non luminance change area does not extend across the surface between the plurality of light emitters along at least one of a horizontal direction and a vertical direction of the surface the non luminance change area being an area in the surface outside the plurality of light emitters and not changing in luminance.

In the information communication method and the information communication device K illustrated in the bright line area can be made continuous in the captured image obtained by capturing the surface display by the image sensor included in the receiver for instance as illustrated in . This eases the reception of the transmission signal and enables communication between various devices including a device with low computational performance.

It should be noted that in the above embodiments each of the constituent elements may be constituted by dedicated hardware or may be obtained by executing a software program suitable for the constituent element. Each constituent element may be achieved by a program execution unit such as a CPU or a processor reading and executing a software program stored in a recording medium such as a hard disk or semiconductor memory. For example the program causes a computer to execute the information communication method illustrated in the flowchart of .

A receiver is a smartphone having a function as a receiver in each of the above embodiments. As illustrated in a in the receiver captures a display and tries to read bright lines appearing in the captured image. In the case where the display is dark the receiver may not be able to read the bright lines and receive the signal from the display . In such a case the receiver flashes in a predetermined rhythm as illustrated in b in . Upon receiving the flash the display increases the luminance and produces bright display as illustrated in c in . As a result the receiver can read the bright lines appearing in the captured image and receive the signal from the display .

First the receiver determines whether or not an operation or gesture by the user to start reception is received Step S . In the case of determining that the operation or gesture is received Step S Y the receiver starts reception by image capture using an image sensor Step S . The receiver then determines whether or not a predetermined time has elapsed from the reception start without completing the reception Step S . In the case of determining that the predetermined time has elapsed Step S Y the receiver flashes in a predetermined rhythm Step S and repeats the process from Step S. In the case of repeating the process from Step S the receiver determines whether or not a predetermined time has elapsed from the flash without completing the reception. In Step S instead of flashing the receiver may output a predetermined sound of a frequency inaudible to humans or transmit to the transmitter which is the display a signal indicating that the receiver is waiting for reception.

A lighting device has a function as a transmitter in each of the above embodiments. The lighting device illuminates for example a line guide sign in a train station while changing in luminance. A receiver pointed at the line guide sign by the user captures the line guide sign . The receiver thus obtains the ID of the line guide sign and obtains information associated with the ID i.e. detailed information of each line shown in the line guide sign . The receiver displays a guide image indicating the detailed information. For example the guide image indicates the distance to the line shown in the line guide sign the direction to the line and the time of arrival of the next train on the line.

When the user touches the guide image the receiver displays a supplementary guide image . For instance the supplementary guide image is an image for displaying any of a train timetable information about lines other than the line shown by the guide image and detailed information of the station according to selection by the user.

Lighting devices to each have a function as a transmitter in each of the above embodiments and illuminate a store sign . As illustrated in a in the lighting devices to may transmit the same ID by changing in luminance synchronously. As illustrated in b in the lighting devices and located at both ends may transmit the same ID by changing in luminance synchronously while the lighting device located between these lighting devices illuminates the sign without transmitting an ID by luminance change. As illustrated in c in the lighting devices and located at both ends may transmit different IDs by changing in luminance in a state where the lighting device does not transmit an ID. In this case since the lighting device between the lighting devices and does not change in luminance for ID transmission the signals from the lighting devices and can be kept from interfering with each other. Though the ID transmitted from the lighting device and the ID transmitted from the lighting device are different these IDs may be associated with the same information.

A lighting device has a function as a transmitter in each of the above embodiments and constantly transmits a signal by changing in luminance as illustrated in in .

A receiver in this embodiment captures the lighting device . Here an imaging range of the receiver includes the lighting device and a part other than the lighting device as illustrated in . In detail a part other than the lighting device is included in each of an upper area a and a lower area c in the imaging range and the lighting device is included in a center area b in the imaging range .

The receiver captures the lighting device to obtain a captured image bright line image including a plurality of bright lines that appear according to the change in luminance of the lighting device as illustrated in and in . In the bright line image bright lines appear only in the part corresponding to the center area b while no bright line appears in the parts corresponding to the upper area a and the lower area c.

In the case where the receiver captures the lighting device at a frame rate of 30 fps as an example the length b of the bright line area in the bright line image is short as illustrated in in . In the case where the receiver captures the lighting device at a frame rate of 15 fps as an example the length b of the bright line area in the bright line image is long as illustrated in in . Note that the length of the bright line area bright line pattern is the length perpendicular to each bright line included in the bright line area.

Hence the receiver in this embodiment captures the lighting device at a frame rate of 30 fps as an example and determines whether or not the length b of the bright line area in the bright line image is less than a predetermined length. For example the predetermined length is the length corresponding to one block of signal transmitted by luminance change by the lighting device . In the case where the receiver determines that the length b is less than the predetermined length the receiver changes the frame rate to 15 fps as an example. Thus the receiver can receive one block of signal from the lighting device at one time.

First the receiver determines whether or not bright lines are included in a captured image i.e. whether or not stripes by exposure lines are captured Step S . In the case of determining that the stripes are captured Step S Y the receiver determines in which imaging mode image capture mode the receiver is set Step S . In the case of determining that the imaging mode is the intermediate imaging mode intermediate mode or the normal imaging mode normal image capture mode the receiver changes the imaging mode to the visible light imaging mode visible light communication mode Step S .

The receiver then determines whether or not the length perpendicular to the bright lines in the bright line area bright line pattern is greater than or equal to a predetermined length Step S . That is the receiver determines whether or not there is a stripe area greater than or equal to a predetermined size in the direction perpendicular to the exposure lines. In the case of determining that the length is not greater than or equal to the predetermined length Step S N the receiver determines whether or not optical zoom is available Step S . In the case of determining that optical zoom is available Step S Y the receiver performs optical zoom to lengthen the bright line area i.e. to enlarge the stripe area Step S . In the case of determining that optical zoom is not available Step S N the receiver determines whether or not Ex zoom Ex optical zoom is available Step S . In the case of determining that Ex zoom is available Step S Y the receiver performs Ex zoom to lengthen the bright line area i.e. to enlarge the stripe area Step S . In the case of determining that Ex zoom is not available Step S N the receiver decreases the imaging frame rate Step S . The receiver then captures the lighting device at the set frame rate to receive a signal Step S .

Though the frame rate is decreased in the case where optical zoom and Ex zoom are not available in the example illustrated in the frame rate may be decreased in the case where optical zoom and Ex zoom are available. Ex zoom is a function of limiting the use area of the image sensor and reducing the imaging angle of view so that the apparent focal length is telephoto.

In the case where a lighting device which is a transmitter is shown in a small size in a captured image the receiver can obtain a captured image in which the lighting device is shown in a larger size through the use of optical zoom or Ex zoom. Thus the use of optical zoom or Ex zoom enables the receiver to obtain a bright line image captured image having a bright line area that is long in the direction perpendicular to bright lines.

A transmitter has a function as a transmitter in each of the above embodiments and communicates with an operation panel as an example. The operation panel includes a transmission switch and a power switch

When the transmission switch is turned on the operation panel instructs the transmitter to perform visible light communication. Upon receiving the instruction the transmitter transmits a signal by changing in luminance. When the transmission switch is turned off the operation panel instructs the transmitter to stop visible light communication. Upon receiving the instruction the transmitter stops signal transmission without changing in luminance.

When the power switch is turned on the operation panel instructs the transmitter to turn on the power of the transmitter . Upon receiving the instruction the transmitter turns its power on. For example in the case where the transmitter is a lighting device the transmitter turns its power on to illuminate the surroundings. In the case where the transmitter is a television the transmitter turns its power on to display video and the like. When the power switch is turned off the operation panel instructs the transmitter to turn off the power of the transmitter . Upon receiving the instruction the transmitter turns its power off and enters a standby state.

For example a receiver as a smartphone has a function as a transmitter in each of the above embodiments and obtains an authentication ID and an expiration date from a server . In the case where the current time is within the expiration date the receiver transmits the authentication ID to a peripheral device by changing for example its display in luminance. Examples of the peripheral device include a camera a barcode reader and a personal computer.

Having received the authentication ID from the receiver the peripheral device transmits the authentication ID to the server and requests verification. The server compares the authentication ID transmitted from the peripheral device and the authentication ID held in the server and transmitted to the receiver . When they match the server notifies the peripheral device of the match. Having received the notification of the match from the server the peripheral device releases a lock set therein executes electronic payment or performs a login process or the like.

The transmitter in this embodiment has a function as a transmitter in each of the above embodiments and is a lighting device or a display as an example. For instance the transmitter determines whether or not the light control level brightness level is less than a predetermined level Step S . In the case of determining that the light control level is less than the predetermined level Step S Y the transmitter stops signal transmission by luminance change Step S .

The transmitter in this embodiment determines whether or not the light control level brightness level is greater than a predetermined level Step S . In the case of determining that the light control level is greater than the predetermined level Step S Y the transmitter starts signal transmission by luminance change Step S .

The transmitter in this embodiment determines whether or not a predetermined mode is selected Step S . For example the predetermined mode is eco mode or power saving mode. In the case of determining that the predetermined mode is selected Step S Y the transmitter stops signal transmission by luminance change Step S . In the case of determining that the predetermined mode is not selected Step S N the transmitter starts signal transmission by luminance change Step S .

The imaging device in this embodiment is a video camera as an example and determines whether or not the imaging device is in a recording process Step S . In the case of determining that the imaging device is in a recording process Step S Y the imaging device transmits a visible light transmission stop instruction to a transmitter transmitting a signal by luminance change Step S . Upon receiving the visible light transmission stop instruction the transmitter stops signal transmission by luminance change visible light transmission . In the case of determining that the imaging device is not in a recording process Step S N the imaging device further determines whether or not recording has been stopped i.e. the imaging device has just stopped recording Step S . In the case of determining that recording has been stopped Step S Y the imaging device transmits a visible light transmission start instruction to the transmitter Step S . Upon receiving the visible light transmission start instruction the transmitter starts signal transmission by luminance change visible light transmission .

The imaging device in this embodiment is a digital still camera as an example and determines whether or not an imaging button shutter button is being half pressed or whether or not focus is being adjusted Step S . The imaging device then determines whether or not a light and dark area appears in the direction along exposure lines in an image sensor included in the imaging device Step S . In the case of determining that the light and dark area appears Step S Y there is a possibility that a transmitter transmitting a signal by luminance change is near the imaging device. The imaging device accordingly transmits a visible light transmission stop instruction to the transmitter Step S . After this the imaging device performs imaging to obtain a captured image Step S . The imaging device then transmits a visible light transmission start instruction to the transmitter Step S . Thus the imaging device can obtain the captured image without being affected by the luminance change by the transmitter. Moreover since the time during which signal transmission by luminance change is stopped is a very short period of time when the imaging device performs imaging the time during which visible light communication is disabled can be reduced.

The transmitter in this embodiment has a function as a transmitter in each of the above embodiments and outputs high luminance light Hi or low luminance light Lo per slot thereby transmitting a signal. In detail the slot is a time unit of 104.2 s. The transmitter outputs Hi to transmit a signal indicating 1 and outputs Lo to transmit a signal indicating 0.

The above mentioned transmitter outputs Hi or Lo per slot thereby transmitting each PHY physical layer frame which is a signal unit in sequence. The PHY frame includes a preamble made up of 8 slots an FCS Frame Check Sequence made up of 2 slots and a body made up of 20 slots. The parts included in the PHY frame are transmitted in the order of the preamble the FCS and the body.

The preamble corresponds to the header of the PHY frame and includes 01010111 as an example. The preamble may be made up of 7 slots. In this case the preamble includes 0101011 . The FCS includes 01 in the case where the number of 1s included in the body is an even number and 11 in the case where the number of 1s included in the body is an odd number. The body includes 5 symbols each of which is made up of 4 slots. In the case of 4 value PPM the symbol includes 0111 1011 1101 or 1110 .

The above mentioned symbol is converted to a 2 bit value by a receiver. For example the symbols 0111 1011 1101 and 1110 are respectively converted to 00 01 10 and 11 . Accordingly the body 20 slots of the PHY frame is converted to a 10 bit signal. The 10 bit body includes 3 bit TYPE indicating the type of the PHY frame 2 bit ADDR indicating the address of the PHY frame or the body and 5 bit DATA indicating the entity of data. For example in the case where the type of the PHY frame is TYPE1 TYPE indicates 000 . ADDR indicates 00 01 10 or 11 .

The receiver concatenates DATA included in the respective bodies of 4 PHY frames. ADDR mentioned above is used in this concatenation. In detail the receiver concatenates DATA included in the body of the PHY frame having ADDR 00 DATA included in the body of the PHY frame having ADDR 01 DATA included in the body of the PHY frame having ADDR 10 and DATA included in the body of the PHY frame having ADDR 11 thus generating 20 bit data. The four PHY frames are decoded in this way. The generated data includes 16 bit effective DATA and 4 bit CRC Cyclic Redundancy Check .

The type of the PHY frame mentioned above includes TYPE1 TYPE2 TYPE3 and TYPE4. The body length the ADDR length the DATA length the number of DATA concatenated concatenation number the effective DATA length and the CRC type differ between these types.

For example in TYPE1 TYPE TYPEBIT indicates 000 the body length is 20 slots the ADDR length is 2 bits the DATA length is 5 bits the concatenation number is 4 the effective DATA length is 16 bits and the CRC type is CRC 4. In TYPE2 on the other hand TYPE TYPEBIT indicates 001 the body length is 24 slots the ADDR length is 4 bits the DATA length is 5 bits the concatenation number is 8 the effective DATA length is 32 bits and the CRC type is CRC 8.

The use of such a signal illustrated in enables visible light communication to be performed appropriately.

The system in this embodiment includes a transmitter having the same function as a transmitter in each of the above embodiments a receiver such as a smartphone a content sharing server and an ID management server .

For instance a content creator uploads to the content sharing server content such as audio video data representing a still image or a moving image for introducing a product and product information indicating the manufacturer area of production material specifications etc. of the product. The content sharing server registers the product information in the ID management server in association with a content ID for identifying the content.

Following this the transmitter downloads the content and the content ID from the content sharing server displays the content and transmits the content ID by changing in luminance i.e. by visible light communication according to an operation by the user. The user views the content. In the case where the user is interested in the product introduced in the content the user points the receiver at the transmitter to capture the transmitter . The receiver captures the content displayed on the transmitter thus receiving the content ID.

The receiver then accesses the ID management server and inquires of the ID management server for the content ID. As a result the receiver receives the product information associated with the content ID from the ID management server and displays the product information. When the receiver receives an operation requesting to buy the product corresponding to the product information the receiver accesses the manufacturer of the product and executes a process for buying the product.

Next the ID management server notifies inquiry information indicating the number of inquiries or the number of accesses made for the content ID to the manufacturer indicated by the product information associated with the content ID. Having received the inquiry information the manufacturer pays an affiliate reward corresponding to the number of inquiries or the like indicated by the inquiry information to the content creator specified by the content ID by electronic payment via the ID management server and the content sharing server .

In the example illustrated in when the content and the product information are uploaded the content sharing server registers the product information in the ID management server in association with the content ID. However such registration may be omitted. For example the content sharing server searches the ID management server for a product ID for identifying the product of the uploaded product information and embeds the product ID in the uploaded content as illustrated in .

Following this the transmitter downloads the content in which the product ID is embedded and the content ID from the content sharing server displays the content and transmits the content ID and the product ID by changing in luminance i.e. by visible light communication according to an operation by the user. The user views the content. In the case where the user is interested in the product introduced in the content the user points the receiver at the transmitter to capture the transmitter . The receiver captures the content displayed on the transmitter thus receiving the content ID and the product ID.

The receiver then accesses the ID management server and inquires of the ID management server for the content ID and the product ID. As a result the receiver receives the product information associated with the product ID from the ID management server and displays the product information. When the receiver receives an operation requesting to buy the product corresponding to the product information the receiver accesses the manufacturer of the product and executes a process for buying the product.

Next the ID management server notifies inquiry information indicating the number of inquiries or the number of accesses made for the content ID and the product ID to the manufacturer indicated by the product information associated with the product ID. Having received the inquiry information the manufacturer pays an affiliate reward corresponding to the number of inquiries or the like indicated by the inquiry information to the content creator specified by the content ID by electronic payment via the ID management server and the content sharing server .

The system in this embodiment includes a content sharing server instead of the content sharing server illustrated in and further includes an SNS server . The SNS server is a server providing a social networking service and performs part of the process performed by the content sharing server illustrated in .

In detail the SNS server obtains the content and the product information uploaded from the content creator searches for the product ID corresponding to the product information and embeds the product ID in the content. The SNS server then transfers the content in which the product ID is embedded to the content sharing server . The content sharing server receives the content transferred from the SNS server and transmits the content in which the product ID is embedded and the content ID to the transmitter .

Thus in the example illustrated in the unit including the SNS server and the content sharing server serves as the content sharing server illustrated in .

In the system illustrated in each of an appropriate affiliate reward can be paid for an advertisement content for which inquiries have been made using visible light communication.

Though the information communication method according to one or more aspects has been described by way of the embodiments above the present disclosure is not limited to these embodiments. Modifications obtained by applying various changes conceivable by those skilled in the art to the embodiments and any combinations of structural elements in different embodiments are also included in the scope of one or more aspects without departing from the scope of the present disclosure.

As illustrated in the transmitter modulates a transmission signal by a plurality of modulation schemes and transmits modulated signals alternately or simultaneously.

By modulating the same signal by the plurality of modulation schemes and transmitting the modulated signals even a receiver that supports only one of the modulation schemes can receive the signal. Moreover for example the combined use of a modulation scheme with high transmission speed a modulation scheme with high noise resistance and a modulation scheme with long communication distance allows reception to be performed using an optimal method according to the receiver environment.

In the case where the receiver supports reception by the plurality of modulation schemes the receiver receives the signals modulated by the plurality of schemes. When modulating the same signal the transmitter assigns the same signal ID to the modulated signals and transmits the modulated signals. By checking the signal ID the receiver can recognize that the same signal is modulated by the different modulation schemes. The receiver synthesizes the signal having the same signal ID from the plurality of types of modulated signals with it being possible to receive the signal promptly and accurately.

For example the transmitter includes a signal dividing unit and modulation units to . The signal dividing unit divides a transmission signal into a partial signal and a partial signal and attaches a signal ID to the partial signal and another signal ID to the partial signal . The modulation unit generates a signal having sine waves by performing frequency modulation on the partial signal with the signal ID. The modulation unit generates a signal having square waves by performing on the partial signal with the signal ID frequency modulation different from that performed by the modulation unit . Meanwhile the modulation unit generates a signal having square waves by performing pulse position modulation on the partial signal with the other signal ID.

As illustrated in the transmitter transmits together the signals modulated by a plurality of modulation schemes. In the example in with a long exposure time set the receiver can receive only the signal modulated by a frequency modulation scheme that uses a low frequency. With a short exposure time set the receiver can receive the signal modulated by the pulse position modulation scheme that uses a high frequency band. In this case the receiver will obtain a temporal average of strength of received light by calculating an average of luminance in a direction perpendicular to a bright line and thus can obtain a signal that is the same as a signal obtained when the exposure time is long.

As illustrated in the transmitter includes a signal storage unit a signal verification unit a signal modulation unit a light emitting unit an abnormality notification unit a source key storage unit and a key generation unit. The signal storage unit stores a transmission signal and a signal conversion value obtained by converting the transmission signal using a verification key described later. A one way function is used for this conversion. The source key storage unit stores a source key which is a source value of a key for example as a circuit constant such as a time constant or a resistance. The key generation unit generates the verification key from the source key.

The signal verification unit converts the transmission signal stored in the signal storage unit using the verification key to obtain a signal conversion value. The signal verification unit determines whether or not the signal has not been tampered with depending on whether or not the obtained signal conversion value and the signal conversion value stored in the signal storage unit are equal. Even when the signal in the signal storage unit is copied to another transmitter this other transmitter cannot transmit the signal because the verification key is different. Transmitter forgery can thus be prevented.

In the case where the signal has been tampered with an abnormality notification unit notifies that the signal has been tampered with. Examples of the notification method include blinking a light emitting unit in a cycle visible to humans outputting a sound and so on. By limiting the abnormality notification to a predetermined time immediately after power on the transmitter can be put to use other than transmission even in the case where the signal has an abnormality.

In the case where the signal has not been tampered with a signal modulation unit converts the signal to a light emission pattern. Various modulation schemes are available. For example the following modulation schemes are available amplitude shift keying ASK phase shift keying PSK frequency shift keying FSK quadrature amplitude modulation QAM delta modulation DM minimum shift keying MSK complementary code keying CCK orthogonal frequency division multiplexing OFDM amplitude modulation AM frequency modulation FM phase modulation PM pulse width modulation PWM pulse amplitude modulation PAM pulse density modulation PDM pulse position modulation PPM pulse code modulation PCM frequency hopping spread spectrum FHSS and direct sequence spread spectrum DSSS . A modulation scheme is selected according to the property of the transmission signal whether analog or digital whether continuous data transmission or not etc. and the required performance transmission speed noise resistance transmission distance . Moreover two or more modulation schemes may be used in combination.

In Embodiments 1 to 9 the same advantageous effects can be achieved in the case where the signal modulated by any of the above mentioned modulation schemes is used.

As illustrated in the transmitter may include a signal demodulation unit instead of the signal verification unit. In this case a signal storage unit holds an encrypted transmission signal obtained by encrypting a transmission signal using an encryption key that is paired with a decryption key generated in a key generation unit. The signal demodulation unit decrypts the encrypted transmission signal using the decryption key. This structure makes it difficult to forge a transmitter i.e. to produce a transmitter for transmitting an arbitrary signal.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED or an organic EL device in each of the embodiments described above.

This watch is configured as a receiver for visible light communication and includes light sensors and collecting lenses corresponding to the respective light sensors. Specifically a collecting lens is placed on the top surface of each sensor as illustrated in the cross sectional view in . In the collecting lens has a predetermined tilt. The shape of the collecting lens is not limited to this and may be any other shape capable of collecting light. With this structure the light sensor can collect and receive light from a light source in the external world by the lens. Even a small light sensor as included in a watch can thus perform visible light communication. In the watch is divided into 12 areas and 12 light sensors are arranged in the areas with the collecting lens being placed on the top surface of each light sensor. By dividing the inside of the watch into a plurality of areas and arranging a plurality of light sensors in this way it is possible to obtain information from a plurality of light sources. For example in a first light sensor can receive light from a light source and a second light sensor can receive light from a light source . A solar cell may be used as a light sensor. The use of a solar cell as a light sensor enables solar power to be generated and also visible light communication to be performed by a single sensor which contributes to lower cost and a more compact shape. Moreover in the case where a plurality of light sensors are arranged information from a plurality of light sources can be obtained simultaneously with it being possible to improve the position estimation accuracy. Though this embodiment describes a structure of providing light sensors in a watch this is not a limit for the present disclosure and it may be possible to provide light sensors in any movable device such as a mobile phone or a mobile terminal.

A receiver such as a wristwatch includes a plurality of light receiving units. For example the receiver includes as illustrated in a light receiving unit on the upper end of a rotation shaft that supports the minute hand and the hour hand of the wristwatch and a light receiving unit near the character indicating the 12 o clock on the periphery of the wristwatch. The light receiving unit receives light directed to thereto along the direction of the above mentioned rotation shaft and the light receiving unit receives light directed thereto along a direction connecting the rotation shaft and the character indicating the 12 o clock. Thus the light receiving unit can receive light from above when the user holds the receiver in front of his or her chest as when checking the time. As a result the receiver is capable of receiving a signal from a ceiling light. The light receiving unit can receive light from front when the user holds the receiver in front of his or her chest as when checking the time. As a result the receiver can receive a signal from a signage or the like in front of the user.

When these light receiving units and have directivity the signal can be received without interference even in the case where a plurality of transmitters are located nearby.

For example as illustrated in a in the receiver such as a wristwatch includes 17 light receiving elements light receiving units . These light receiving elements are arranged on the watch face. Out of these light receiving elements 12 light receiving elements are arranged at positions corresponding to 1 o clock to 12 o clock on the watch face and the remaining five light receiving elements are arranged in a central area on the watch face. Each of these 17 light receiving elements has different directivity and receives light a signal in a corresponding direction. Thus as a result of arranging a plurality of light receiving elements having directivity the receiver can estimate the direction of the received signal. Furthermore prisms for guiding light to the light receiving elements may be arranged in front of the light receiving elements as illustrated in b in . Specifically the receiver includes eight light emitting elements arranged at regular intervals in a peripheral part on the watch face and a plurality of prisms for guiding light to at least one of those light emitting elements. With such prisms an accurate direction of the transmitter can be estimated even when the number of light receiving elements is small. For example when only a light receiving element of the eight light receiving elements receives light the transmitter is estimated to be situated in a direction connecting the center of the watch face and a prism . When light receiving elements and receive the same signal the transmitter is estimated to be situated in a direction connecting the center of the watch face and a prism . Note that windshield glass of the wristwatch may be given the directivity function and the prism function.

The information communication method according to an aspect of the present disclosure is an information communication method of obtaining information by a mobile terminal and includes Steps SE and SE.

Specifically this information communication method includes receiving by at least one of a plurality of solar cells included in the mobile terminal and each having directivity visible light released along a direction corresponding to the directivity of the at least one of the plurality of solar cells SE and obtaining the information by demodulating a signal specified by the received visible light SE .

A mobile terminal E according to an aspect of the present disclosure is a mobile terminal that obtains information and includes a plurality of solar cells E each having directivity and an information obtainment unit E. When at least one of the plurality of solar cells E receives visible light released along a direction corresponding to the directivity of the solar cell E the information obtainment unit E obtains information by demodulating a signal specified by the received visible light.

In the information communication method and the mobile terminal E illustrated in the solar cell E can be used in power generation while being used as a light sensor for visible light communication and thus it is possible to reduce the cost for the mobile terminal E that obtains information and also possible to downsize the mobile terminal E. Furthermore since each of the plurality of solar cells E has directivity the direction where a transmitter that emits visible light is present can be estimated based on the directivity of the solar cell E that has received visible light. Moreover since each of the plurality of solar cells E has directivity it is possible that visible light emitted from one transmitter is received separately from visible light emitted from another and thus it is possible to appropriately obtain information from each of the plurality of transmitters.

Furthermore in the receiving SE the solar cell E may receive visible light transmitted by the prism or included in the mobile terminal E as illustrated in b in . This makes it possible to accurately estimate a direction where a transmitter that emits visible light is present while reducing the number of solar cells E included in the mobile terminal E. Furthermore as illustrated in the mobile terminal E is a wristwatch and the plurality of solar cells E the light receiving elements are arranged along an outer edge of the watch face of the wristwatch. The orientation of the visible light received by one of the plurality of solar cells E may be different from the orientation of the visible light received by another. With this it is possible to appropriately obtain information by a wristwatch.

A receiver such as a wristwatch is connected to a smartphone or a glasses type display via wireless communication such as Bluetooth . In the case where the receiver receives a signal or detects the presence of a signal the receiver displays on the display information indicating reception of the signal for example. The receiver transmits the received signal to the smartphone . The smartphone obtains data associated with the received signal from a server and displays the obtained data on the glasses type display

A receiver such as a wristwatch is connected to a smartphone via wireless communication such as Bluetooth . The receiver has a watch face composed of a display such as a liquid crystal display and is capable of displaying information other than the time. The smartphone recognizes the current position from a signal received by the receiver and displays the route and distance to the destination on the display surface of the receiver

In a in a specific signal is expressed as a specific modulation frequency. The receiver performs frequency analysis on a light pattern a pattern of luminance change of a light source to determine a dominant modulation frequency and reconstructs a signal.

In a in the modulation frequency is changed with time. This enables many values to be expressed. A typical image sensor has an imaging frame rate of 30 fps. Accordingly reception can be ensured by continuing one modulation frequency for 1 30 second or more. In b in a time during which no signal is superimposed is inserted when changing the frequency. As a result the receiver can easily recognize the change of the modulation frequency. A light pattern in the time during which no signal is superimposed can be distinguished from that in the signal superimposition part by maintaining constant brightness or using a specific modulation frequency. When a frequency that is an integer multiple of 30 Hz is set as the specific modulation frequency the non signal superimposition part is unlikely to appear in the difference image and hamper the reception process. The length of the time during which no signal is superimposed may be greater than or equal to the same length as a signal of the longest period among light patterns used for signals. This facilitates reception. As an example if a light pattern of a lowest modulation frequency is 100 Hz the time during which no signal is superimposed is set to greater than or equal to 1 100 second.

Therefore in the example 2 in which a light pattern is expressed the number of frequencies included in the waveform is limited to a predetermined number or less that is the number of frequencies is set variable below a predetermined number. Alternatively in the example 3 in which a light pattern is expressed the number of frequencies included in the waveform is limited to a predetermined number. By doing so it is possible to avoid the above described problem. As compared to the example 1 and the example 2 the example 3 allows signals and noise to be more easily separated and is most tolerant to noise because the number of included frequencies is predetermined.

When signals are represented using n different frequencies 2 1 different signals can be represented in the example 1 . Furthermore when the frequencies are limited to m different frequencies k 1 to m C 1 different signals can be represented in the example 2 and Cdifferent signals can be represented in the example 3 .

As the method of overlapping a plurality of modulation frequencies there are the following methods i simply adding up waveforms ii weighted averaging using weighted waveforms and iii repeating the respective waveforms of the frequencies in sequence. When the receiver performs frequency analysis such as discrete cosine series expansion an adjustment is preferably performed in the weighted averaging in ii such that the peak of each frequency is the same or similar because there is a tendency for a higher frequency to have a lower peak. Specifically it is preferred that more weight be given to a higher frequency. In iii it is possible to adjust the level of the frequency peak upon reception by adjusting the ratio of the number of outputs the number of cycles rather than repeating one output of the waveform of each frequency on a per cycle basis . It may be that the number of output cycles is set larger for a higher frequency or that the length of time for output is set longer for a higher frequency. Through this adjustment it is possible to facilitate the reception process by equalizing the levels of frequency peaks and also possible to represent additional information by giving meaning to a difference between the levels of frequency peaks. For example when the order of the levels of the frequency peaks is given meaning it is possible to add information of log n bits where n different frequencies are included. The frequency may be changed every period every half a period every multiple of half a period or every length of predetermined time. The timing of changing the frequency may be when the luminance has the highest value the lowest value or any value. It is possible to reduce flicker by equalizing luminance before changing the frequency and luminance after changing the frequency continuously changing the luminance . This can be achieved when transmission signals are output at each frequency for a length of time that is an integral multiple of a half of the wavelength at the frequency. Here the length of time of output at each frequency is different. Furthermore when signals are output at a certain frequency for a length of time that is a multiple of a half of the period the receiver can easily recognize by frequency analysis that the frequency is included in the signals even in the case of digital output. Discontinuous output rather than continuous output at the same frequency is better as it is hard to be caught by human eyes or cameras. For example when period Tappears twice Tappears twice and Tappears once in terms of the proportion of output TTTTTis better than TTTTT. Instead of repeating the output in a predetermined order output in varying order may also be applicable. This order may be given meaning to represent additional information. This order cannot be seen from the frequency peaks but it is possible to obtain such information by analyzing the order of frequencies. Since the exposure time needs to be set shorter in the case of analyzing the order of the frequencies than the case of analyzing the frequency peaks it may be possible to set the exposure time short only when the additional information is necessary or it may be possible that only the receiver that can set the exposure time short can obtain the additional information.

In the signals of are represented in a binary light pattern. In the methods i and ii among the methods of overlapping frequencies analog waveforms are complicated and even when such analog waveforms are binarized it is not possible to represent a complicated form. Consequently the receiver fails to obtain a correct frequency peak leading to more reception errors. In the method iii analog waveforms are not complicated meaning that binarization has less influence thereon and thus a relatively correct frequency peak can be obtained. Therefore the method iii is superior in the case of using a digitalized light pattern with for example a binary or a small number of values. This modulation method can be construed as one type of frequency modulation from the standpoint that signals are represented based on frequencies in a light pattern or can alternatively be construed as one type of PWM from the standpoint that signals are represented through adjustment on the duration of pulses.

With the setting in which the unit of time for a change in luminance is a discrete value it is possible to transmit and receive signals in the same or similar way as pulse modulation. The average luminance can be set high by setting a low luminance section as the shortest unit of time regardless of the length of the period of a transmission frequency. Here since the average luminance increases when the period of the transmission frequency is longer it is possible to increase the average luminance by increasing the number of outputs at this frequency with a long period. Even when low luminance sections have the same length a high luminance section is set to have a length determined by subtracting the length of the low luminance section from the period of the transmission frequency. By doing so a frequency peak will appear in the transmission frequency when the frequency analysis is performed. Thus when a frequency analysis technique such as the discrete cosine transform is used the exposure time of the receiver does not need to be set so short to enable the receiver to receive signals.

In c in the modulation frequency overlap is changed with time in the same way as a in . This enables many values to be expressed.

A signal of a high modulation frequency cannot be received unless the exposure time is short. Up to a certain level of modulation frequency however can be used without setting the exposure time. When a signal modulated using frequencies from low to high modulation frequencies is transmitted all terminals can receive the signal expressed by the low modulation frequency. Besides a terminal capable of setting a short exposure time also receives the signal up to the high modulation frequency with it being possible to receive more information from the same transmitter at high speed. Alternatively it may be that when a modulation signal of a low frequency is found in a normal imaging mode overall transmission signals including a modulation signal of a high frequency are received in a visible light communication mode.

The frequency shift keying scheme and the frequency multiplex modulation scheme have an advantageous effect of causing no flicker perceivable by the human eye even in the case where a lower modulation frequency than when expressing a signal by pulse position is used and so can use many frequency bands.

In Embodiments 1 to 10 the same advantageous effects can be achieved in the case where the signal modulated by the above mentioned reception scheme and modulation scheme is used.

A receiver has functions of a in . A light receiving unit receives a light pattern. A frequency analysis unit Fourier transforms the light pattern to map a signal in a frequency domain. A peak detection unit detects a peak of a frequency component in the light pattern. In the case where no peak is detected by the peak detection unit the subsequent process is suspended. A peak time change analysis unit analyzes a time change of a peak frequency. A signal source specification unit specifies in the case where a plurality of frequency peaks are detected a combination of modulation frequencies of signals transmitted from the same transmitter.

Thus reception can be performed without signal interference even in the case where a plurality of transmitters are located nearby. When light from a transmitter is reflected off a floor a wall or a ceiling and received light from a plurality of transmitters tends to be mixed. Even in such a case reception can be performed without signal interference.

As an example in the case where the receiver receives a light pattern in which a signal of a transmitter A and a signal of a transmitter B are mixed frequency peaks are obtained as in b in . Since fdisappears and fappears fand fcan be specified as signals from the same transmitter. Likewise f f and fcan be specified as signals from the same transmitter and f f and fcan be specified as signals from the same transmitter.

By fixing the time interval at which one transmitter changes the modulation frequency it is possible to easily specify the signals from the same transmitter.

When a plurality of transmitters change the modulation frequency at the same timing the signals from the same transmitter cannot be specified by the above mentioned method. Hence the time interval at which the modulation frequency is changed differs between transmitters. This prevents a situation where the plurality of transmitters change the modulation frequency always at the same timing so that the signals from the same transmitter can be specified.

As illustrated in c in the time from when the transmitter changes the modulation frequency to when the transmitter changes the modulation frequency next time is calculated from the current modulation frequency and the modulation frequency before the change. In so doing even in the case where the plurality of transmitters change the modulation frequency at the same timing it is possible to specify which signals of modulation frequencies are transmitted from the same transmitter.

Each transmitter may recognize the transmission signal of the other transmitter and adjust the modulation frequency change timing to be different from the other transmitter.

The method described above produces the same advantageous effects not only in the case of frequency shift keying where one transmission signal has one modulation frequency but also in the case where one transmission signal has a plurality of modulation frequencies.

In the case where the light pattern is not changed with time in the frequency multiplex modulation scheme as illustrated in a in the signals from the same transmitter cannot be specified. However by inserting a segment with no signal or by changing to a specific modulation frequency as illustrated in b in the signals from the same transmitter can be specified based on the time change of the peak.

This information processing program is a program for causing the light emitter or the light emitting unit of the above described transmitter to change in luminance with the light pattern illustrated in b in or b in .

In other words this information processing program is an information processing program that causes a computer to process information to be transmitted in order for the information to be transmitted by way of luminance change. In detail this information processing program causes a computer to execute an determination step SA of encoding the information to determine a luminance change frequency and an output step SA of outputting a signal of the luminance change frequency determined to cause a light emitter to change in luminance according to the luminance change frequency determined to transmit the information. In the determination step SA each of a first frequency e.g. the frequency f and a second frequency e.g. the frequency f different from the first frequency is determined as the luminance change frequency. In the output step SA each of a signal of the first frequency and a signal of the second frequency is output as the signal of the luminance change frequency determined to cause the light emitter to change in luminance according to the first frequency during a first time e.g. time T and change in luminance according to the second frequency during a second time e.g. time T different from the first time after the first time elapses.

With this the information to be transmitted can be appropriately transmitted in the form of visible light signals of the first and second frequencies. Furthermore with the first time and the second time being different the transmission can be adapted to various situations. As a result communication between various devices becomes possible.

For example as illustrated in the first time is a duration corresponding to one period of the first frequency and the second time is a duration corresponding to one period of the second frequency.

Furthermore in the output step SA at least one of the signal of the first frequency and the signal of the second frequency may be repeatedly output to make a total number of times the signal of the first frequency is output and a total number of times the signal of the second frequency is output different from each other. With this the transmission can be adapted to various situations.

Furthermore in the output step SA at least one of the signal of the first frequency and the signal of the second frequency may be repeatedly output to make a total number of times one of the signal of the first frequency and the signal of the second frequency that has a lower frequency is output greater than a total number of times a remaining one of the signal of the first frequency and the signal of the second frequency that has a higher frequency is output.

With this in the case where the light emitter changes in luminance according to the frequency specified by each output signal the light emitter can transmit with high luminance the information to be transmitted. For example suppose that the duration for which low luminance lasts is the same in the change in luminance according to a low frequency namely the first frequency and the change in luminance according to a high frequency namely the second frequency. In this case the duration for which high luminance lasts is longer in the change in luminance according to the first frequency that is a low frequency than in the change in luminance according to the second frequency that is a high frequency . Therefore when many signals having the first frequency are output the light emitter can transmit with high luminance the information to be transmitted.

Furthermore in the output step SA at least one of the signal of the first frequency and the signal of the second frequency may be repeatedly output to make a total number of times one of the signal of the first frequency and the signal of the second frequency that has a higher frequency is output greater than a total number of times a remaining one of the signal of the first frequency and the signal of the second frequency that has a lower frequency is output. For example the number of times the signal of the frequency fis output becomes greater than the number of times the signal of the frequency fis output as illustrated in .

With this in the case where the light emitter changes in luminance according to the frequency specified by each output signal the reception efficiency of the information to be transmitted by way of such luminance change can be higher. For example when the information to be transmitted is transmitted to the receiver in the form of visible light signals represented by a plurality of frequencies the receiver performs frequency analysis such as the Fourier transform on a captured image to detect a frequency peak included in the visible light signal. Here with a higher frequency such peak detection is more difficult. Therefore the signal of the first frequency and the signal of the second frequency are output so that the number of times one of the signals having a higher frequency is output becomes greater than the number of times a remaining one of the signals having a lower frequency is output as described above. By doing so it is possible to facilitate peak detection of a high frequency. As a result the reception efficiency can be improved.

Furthermore in the output step SA at least one of the signal of the first frequency and the signal of the second frequency may be repeatedly output to avoid continuous output of a signal of the same frequency. For example the signal of the frequency fis not continuously output and the signal of the frequency fis not continuously output either as illustrated in .

With this in the case where the light emitter changes in luminance according to the frequency specified by each output signal it can make it harder for human eyes or cameras to catch flicker of light from the light emitter.

This information processing apparatus A is an apparatus for causing the light emitter of the above described transmitter to change in luminance with the light pattern illustrated in b in or b in .

In other words this information processing apparatus A is an apparatus that processes information to be transmitted in order for the information to be transmitted by way of luminance change. In detail the information processing apparatus A includes a frequency determination unit A configured to encode the information to determine a luminance change frequency and an output unit A configured to output a signal of the luminance change frequency determined to cause a light emitter to change in luminance according to the luminance change frequency determined to transmit the information. Here the frequency determination unit A is configured to determine as the luminance change frequency each of a first frequency and a second frequency different from the first frequency. The output unit A is configured to output each of a signal of the first frequency and a signal of the second frequency as the signal of the luminance change frequency determined to cause the light emitter to change in luminance according to the first frequency during a first time and change in luminance according to the second frequency during a second time different from the first time after the first time elapses. The information processing apparatus A can produce the same advantageous effects as the above described information processing program.

A transmitter such as a ceiling light a lighting device has a wireless communication function of Wi Fi Bluetooth or the like. The transmitter transmits by visible light communication information such as a light emitter ID and an authentication ID for connecting to the transmitter by wireless communication. A receiver A such as a smartphone a mobile terminal performs wireless communication with the transmitter based on the received information. The receiver A may connect to the transmitter using other information. In such a case the receiver A does not need to have a reception function. A receiver B is an electronic device a control target device such as a microwave as an example. The transmitter transmits information of the paired receiver B to the receiver A. The receiver A displays the information of the receiver B as an operable device. The receiver A provides an instruction to operate the receiver B a control signal to the transmitter via wireless communication and the transmitter provides the operation instruction to the receiver B via visible light communication. As a result the user can operate the receiver B through the receiver A. Moreover a device connected to the receiver A via the Internet or the like can operate the receiver B through the receiver A.

Bidirectional communication is possible when the receiver B has a transmission function and the transmitter has a reception function. The transmission function may be realized as visible light by light emission or communication by sound. For instance the transmitter includes a sound collection unit and recognizes the sound output from the receiver B to thereby recognize the state of the receiver B. As an example the transmitter recognizes the operation end sound of the receiver B and notifies the receiver A of such recognition. The receiver A displays the operation end of the receiver B on the display thus notifying the user.

The receivers A and B include NFC. The receiver A receives a signal from the transmitter communicates with the receiver B via NFC and registers in the receiver A and the transmitter that a signal from the transmitter transmitting the signal received immediately before is receivable by the receiver B. This is referred to as pairing between the transmitter and the receiver B. For example in the case where the receiver B is moved the receiver A registers in the transmitter that the pairing is cleared. In the case where the receiver B is paired with another transmitter the newly paired transmitter notifies this to the previously paired transmitter to clear the previous pairing.

Light emission operation by a light emitter which is a lighting device is described first. In a light emitter such as a lighting device or a TV monitor attached to a ceiling or a wall an authentication ID generation unit generates an authentication ID using a random number generation unit changing per time period. For the ID of the light emitter and this authentication ID in the case where there is no interrupt Step the light emitter determines that there is no transmission data string transmitted from a mobile terminal . Accordingly a light emitting unit such as an LED continuously or intermittently outputs a light signal including 1 the light emitter ID 2 the authentication ID and 3 a transmission data string flag 0 which is an identifier for identifying whether or not there is a transmission data string transmitted via a mobile terminal from an electronic device which is a control target device.

The transmitted light signal is received by a photosensor in the electronic device Step . The electronic device determines in Step S whether or not the device ID of the electronic device and the authentication ID the device authentication ID and the light emitter ID are valid. When the result of the determination is YES the IDs are valid the electronic device checks whether or not the transmission data string flag is 1 Step . Only when the result of the checking is YES when the transmission data string flag is 1 the electronic device executes the data of the transmission data string e.g. a user command for applying a cooking recipe or the like Step 

A mechanism of light transmission by the electronic device using the light modulation scheme according to the present disclosure is described below. The electronic device transmits the device ID the authentication ID for authenticating the device and the light emitter ID of the light emitter received by the electronic device as mentioned above i.e. the light emitter ID of the light emitter the successful reception of which is ensured for example using an LED backlight unit of a display unit Step .

The light signal according to the present disclosure is transmitted from the display unit such as a liquid crystal display of a microwave or a POS device by PPM FDM or FSK at a modulation frequency of 60 Hz or more without flicker. Accordingly ordinary consumers are unaware of the transmission of the light signal. It is therefore possible to produce independent display such as a microwave menu on the display unit .

The user who intends to use the microwave or the like receives a light signal from the light emitter by an in camera unit of a mobile terminal thus receiving the light emitter ID and the light emitter authentication ID via an in camera processing unit Step . As the light emitter ID receivable by the electronic device a light emitter ID corresponding to the position which is recorded in the mobile terminal or a cloud with position information using Wi Fi or mobile reception such as 3G may be detected Step .

When the user points an out camera of the mobile terminal at the display unit of the microwave or the like the light signal according to the present disclosure can be demodulated using a MOS camera. Increasing the shutter speed enables faster data reception. A reception unit receives the device ID of the electronic device the authentication ID a service ID or a service provision cloud URL or device status converted from the service ID.

In Step the mobile terminal connects to the external cloud using the URL received or held inside via a 3G Wi Fi communication unit and transmits the service ID and the device ID. In the cloud a database is searched for data corresponding to each of the device ID and the service ID. The data is then transmitted to the mobile terminal . Video data command buttons and the like are displayed on the screen of the mobile terminal based on this data. Upon viewing the display the user inputs a desired command by an input method of pressing a button on the screen or the like Step . In the case of Yes input a transmission unit of a BTLE Bluetooth Low Energy transmission and reception unit transmits a transmission data string including the device ID of the electronic device or the like the device authentication ID the light emitter ID the light emitter authentication ID and the user command in Step .

The light emitter receives the transmission data string by a reception unit in a BTLE transmission and reception unit . When the interrupt processing unit detects that the transmission data string is received Yes in Step data transmission data string ID transmission data flag 1 is modulated by the modulation unit according to the present disclosure and transmitted by light from the light emitting unit such as an LED. When reception of the transmission data string is not detected NO in Step the light emitter continuously transmits the light emitter ID and the like.

Since the electronic device has already confirmed through actual reception that the signal from the light emitter is receivable the reception can be reliably performed.

In this case the light emitter ID is included in the transmission data string so that the interrupt processing unit recognizes that the electronic device as the transmission target is present in the light irradiation range of the light emitter of the ID. Therefore the signal is transmitted only from the light emitter situated within the very narrow range where the electronic device is present without transmitting the signal from other light emitters. The radio space can be efficiently used in this way.

In the case where this scheme is not employed since a Bluetooth signal reaches far a light signal will end up being transmitted from a light emitter at a different position from the electronic device. While one light emitter is emitting light light transmission to another electronic device is impossible or is interfered with. Such a problem can be effectively solved by this scheme.

In Step the photosensor receives the light signal. Since the light emitter ID is checked first a light emission signal of another light emitter ID can be removed and so malfunctions are reduced.

In the present disclosure the transmission data string includes the device ID and the device authentication ID of the electronic device that is to receive the signal. In Step whether or not the device authentication ID and the device ID belong to the electronic device is checked thus preventing any malfunction. A malfunction of a microwave or the like caused by the electronic device erroneously processing a signal transmitted to another electronic device can be avoided too.

In Step when the transmission data flag is 1 it is determined that there is a user command. When the transmission data flag is 0 the process is stopped. When the transmission data flag is 1 after the device ID and the authentication ID in the user data string are authenticated the transmission data string of the user command and the like is executed. For example the electronic device extracts and displays a recipe on the screen. When the user presses the corresponding button the operation of the recipe such as 600 w for 3 minutes 200 w for 1 minute and steaming for 2 minutes can be started without an error.

When the user command is executed electromagnetic noise of 2.4 GHz is generated in the microwave. To reduce this in the case of operating according to instructions through the smartphone via Bluetooth or Wi Fi an intermittent drive unit intermittently stops microwave output e.g. for about 100 ms in 2 seconds. Communication by Bluetooth Wi Fi 802.11n etc. is possible during this period. For example if the microwave is not stopped transmission of a stop instruction from the smartphone to the light emitter by BTLE is interfered with. In the present disclosure on the other hand the transmission can be performed without any interference with it being possible to stop the microwave or change the recipe by a light signal.

In this embodiment by merely adding the photosensor which costs only several yen per unit to the electronic device including the display unit bidirectional communication with the smartphone in interaction with the cloud can be realized. This has an advantageous effect of turning a low cost home appliance into a smart home appliance. Though the home appliance is used in this embodiment the same advantageous effects can be achieved with a POS terminal including a display unit an electronic price board in a supermarket a personal computer etc.

In this embodiment the light emitter ID can be received only from the lighting device situated above the electronic device. Since the reception area is narrow a small zone ID of Wi Fi or the like is defined for each light emitter and the ID is assigned to the position in each zone thereby reducing the number of digits of the light emitter ID. In such a case since the number of digits of the light emitter ID transmitted by PPM FSK or FDM according to the present disclosure is reduced it is possible to receive a light signal from a small light source obtain an ID at high speed receive data from a distant light source etc.

The signal transmission and reception system includes a smartphone which is a multifunctional mobile phone an LED light emitter which is a lighting device a home appliance such as a refrigerator and a server. The LED light emitter performs communication using BTLE Bluetooth Low Energy and also performs visible light communication using a light emitting diode LED . For example the LED light emitter controls a refrigerator or communicates with an air conditioner by BTLE. In addition the LED light emitter controls a power supply of a microwave an air cleaner or a television TV by visible light communication.

For example the television includes a solar power device and uses this solar power device as a photosensor. Specifically when the LED light emitter transmits a signal using a change in luminance the television detects the change in luminance of the LED light emitter by referring to a change in power generated by the solar power device. The television then demodulates the signal represented by the detected change in luminance thereby obtaining the signal transmitted from the LED light emitter. When the signal is an instruction to power ON the television switches a main power thereof to ON and when the signal is an instruction to power OFF the television switches the main power thereof to OFF.

The server is capable of communicating with an air conditioner via a router and a specified low power radio station specified low power . Furthermore the server is capable of communicating with the LED light emitter because the air conditioner is capable of communicating with the LED light emitter via BTLE. Therefore the server is capable of switching the power supply of the TV between ON and OFF via the LED light emitter. The smartphone is capable of controlling the power supply of the TV via the server by communicating with the server via wireless fidelity Wi Fi for example.

As illustrated in the information communication method according to this embodiment includes transmitting the control signal the transmission data string or the user command from the mobile terminal the smartphone to the lighting device the light emitter through the wireless communication such as BTLE or Wi Fi different from the visible light communication performing the visible light communication by the lighting device changing in luminance according to the control signal and detecting a change in luminance of the lighting device demodulating the signal specified by the detected change in luminance to obtain the control signal and performing the processing according to the control signal by the control target device such as a microwave . By doing so even the mobile terminal that is not capable of changing in luminance for visible light communication is capable of causing the lighting device to change in luminance instead of the mobile terminal and is thereby capable of appropriately controlling the control target device. Note that the mobile terminal may be a wristwatch instead of a smartphone.

In Step the process starts. In Step the receiver determines whether or not there is a periodic change in the intensity of received light. In the case of Yes the process proceeds to Step . In the case of No the process proceeds to Step and the receiver receives light in a wide range by setting the lens of the light receiving unit at wide angle. The process then returns to Step . In Step the receiver determines whether or not signal reception is possible. In the case of Yes the process proceeds to Step and the receiver receives a signal. In Step the process ends. In the case of No the process proceeds to Step and the receiver receives light in a narrow range by setting the lens of the light receiving unit at telephoto. The process then returns to Step

With this method a signal from a transmitter in a wide direction can be received while eliminating signal interference from a plurality of transmitters.

In Step the process starts. In Step the receiver sets the lens of the light receiving unit at maximum telephoto. In Step the receiver determines whether or not there is a periodic change in the intensity of received light. In the case of Yes the process proceeds to Step . In the case of No the process proceeds to Step and the receiver receives light in a wide range by setting the lens of the light receiving unit at wide angle. The process then returns to Step . In Step the receiver receives a signal. In Step the receiver sets the lens of the light receiving unit at maximum telephoto changes the light reception direction along the boundary of the light reception range detects the direction in which the light reception intensity is maximum and estimates that the transmitter is in the detected direction. In Step the process ends.

With this method the direction in which the transmitter is present can be estimated. Here the lens may be initially set at maximum wide angle and gradually changed to telephoto.

In Step the process starts. In Step the receiver determines whether or not a signal is received from a base station of Wi Fi Bluetooth IMES or the like. In the case of Yes the process proceeds to Step . In the case of No the process returns to Step . In Step the receiver determines whether or not the base station is registered in the receiver or the server as a reception start trigger. In the case of Yes the process proceeds to Step and the receiver starts signal reception. In Step the process ends. In the case of No the process returns to Step

With this method reception can be started without the user performing a reception start operation. Moreover power can be saved as compared with the case of constantly performing reception.

In Step the process starts. In Step the receiver transmits either an ID of a connected carrier communication network Wi Fi Bluetooth etc. or position information obtained from the ID or position information obtained from GPS etc. to a high order bit ID index server. In Step the receiver receives the high order bits of a visible light ID from the high order bit ID index server. In Step the receiver receives a signal from a transmitter as the low order bits of the visible light ID. In Step the receiver transmits the combination of the high order bits and the low order bits of the visible light ID to an ID solution server. In Step the process ends.

With this method the high order bits commonly used in the neighborhood of the receiver can be obtained. This contributes to a smaller amount of data transmitted from the transmitter and faster reception by the receiver.

Here the transmitter may transmit both the high order bits and the low order bits. In such a case a receiver employing this method can synthesize the ID upon receiving the low order bits whereas a receiver not employing this method obtains the ID by receiving the whole ID from the transmitter.

In Step the process starts. In Step the receiver applies a frequency filter circuit to a received light signal or performs frequency resolution on the received light signal by discrete Fourier series expansion. In Step the receiver determines whether or not a low frequency component is present. In the case of Yes the process proceeds to Step and the receiver decodes the signal expressed in a low frequency domain of frequency modulation or the like. The process then proceeds to Step . In the case of No the process proceeds to Step . In Step the receiver determines whether or not the base station is registered in the receiver or the server as a reception start trigger. In the case of Yes the process proceeds to Step and the receiver decodes the signal expressed in a high frequency domain of pulse position modulation or the like. The process then proceeds to Step . In the case of No the process proceeds to Step . In Step the receiver starts signal reception. In Step the process ends.

In Step the process starts. In Step in the case where the sensitivity is settable the receiver sets the highest sensitivity. In Step in the case where the exposure time is settable the receiver sets the exposure time shorter than in the normal imaging mode. In Step the receiver captures two images and calculates the difference in luminance. In the case where the position or direction of the imaging unit changes while capturing two images the receiver cancels the change generates an image as if the image is captured in the same position and direction and calculates the difference. In Step the receiver calculates the average of luminance values in the direction parallel to the exposure lines in the captured image or the difference image. In Step the receiver arranges the calculated average values in the direction perpendicular to the exposure lines and performs discrete Fourier transform. In Step the receiver recognizes whether or not there is a peak near a predetermined frequency. In Step the process ends.

With this method signal reception is possible even in the case where the exposure time is long such as when the exposure time cannot be set or when a normal image is captured simultaneously.

In the case where the exposure time is automatically set when the camera is pointed at a transmitter as a lighting the exposure time is set to about 1 60 second to 1 480 second by an automatic exposure compensation function. If the exposure time cannot be set signal reception is performed under this condition. In an experiment when a lighting blinks periodically stripes are visible in the direction perpendicular to the exposure lines if the period of one cycle is greater than or equal to about 1 16 of the exposure time so that the blink period can be recognized by image processing. Since the part in which the lighting is shown is too high in luminance and the stripes are hard to be recognized the signal period may be calculated from the part where light is reflected.

In the case of using a scheme such as frequency shift keying or frequency multiplex modulation that periodically turns on and off the light emitting unit flicker is less visible to humans even with the same modulation frequency and also flicker is less likely to appear in video captured by a video camera than in the case of using pulse position modulation. Hence a low frequency can be used as the modulation frequency. Since the temporal resolution of human vision is about 60 Hz a frequency not less than this frequency can be used as the modulation frequency.

When the modulation frequency is an integer multiple of the imaging frame rate of the receiver bright lines do not appear in the difference image between pixels at the same position in two images and so reception is difficult because imaging is performed when the light pattern of the transmitter is in the same phase. Since the imaging frame rate of the receiver is typically 30 fps setting the modulation frequency to other than an integer multiple of 30 Hz eases reception. Moreover given that there are various imaging frame rates of receivers two relatively prime modulation frequencies may be assigned to the same signal so that the transmitter transmits the signal alternately using the two modulation frequencies. By receiving at least one signal the receiver can easily reconstruct the signal.

The ratio between a high luminance section and a low luminance section is adjusted to change the average luminance. Thus brightness adjustment is possible. Here when the period Tin which the luminance changes between HIGH and LOW is maintained constant the frequency peak can be maintained constant. For example in each of a b and c in the time of brighter lighting than the average luminance is set short to adjust the transmitter to emit darker light and the time of brighter lighting than the average luminance is set long to adjust the transmitter to emit brighter light while time Tbetween a first change in luminance at which the luminance becomes higher than the average luminance and a second change in luminance is maintained constant. In the light in b and c is adjusted to be darker than that in a and the light in c is adjusted to be darkest. With this light adjustment can be performed while signals having the same meaning are transmitted.

It may be that the average luminance is changed by changing luminance in the high luminance section luminance in the low luminance section or luminance values in the both sections.

Since there is a limitation in component precision the brightness of one transmitter will be slightly different from that of another even with the same setting of light adjustment. In the case where transmitters are arranged side by side a difference in brightness between adjacent ones of the transmitters produces an unnatural impression. Hence a user adjusts the brightness of the transmitters by operating a light adjustment correction operation unit. A light adjustment correction unit holds a correction value. A light adjustment control unit controls the brightness of the light emitting unit according to the correction value. When the light adjustment level is changed by a user operating a light adjustment operation unit the light adjustment control unit controls the brightness of the light emitting unit based on a light adjustment setting value after the change and the correction value held in the light adjustment correction unit. The light adjustment control unit transfers the light adjustment setting value to another transmitter through a cooperative light adjustment unit. When the light adjustment setting value is transferred from another transmitter through the cooperative light adjustment unit the light adjustment control unit controls the brightness of the light emitting unit based on the light adjustment setting value and the correction value held in the light adjustment correction unit.

The control method of controlling an information communication device that transmits a signal by causing a light emitter to change in luminance according to an embodiment of the present disclosure may cause a computer of the information communication device to execute determining by modulating a signal to be transmitted that includes a plurality of different signals a luminance change pattern corresponding to a different frequency for each of the different signals and transmitting the signal to be transmitted by causing the light emitter to change in luminance to include in a time corresponding to a single frequency only a luminance change pattern determined by modulating a single signal.

For example when luminance change patterns determined by modulating more than one signal are included in the time corresponding to a single frequency the waveform of changes in luminance with time will be complicated making it difficult to appropriately receive signals. However when only a luminance change pattern determined by modulating a single signal is included in the time corresponding to a single frequency it is possible to more appropriately receive signals upon reception.

According to one embodiment of the present disclosure the number of transmissions may be determined in the determining so as to make a total number of times one of the plurality of different signals is transmitted different from a total number of times a remaining one of the plurality of different signals is transmitted within a predetermined time.

When the number of times one signal is transmitted is different from the number of times another signal is transmitted it is possible to prevent flicker at the time of transmission.

According to one embodiment of the present disclosure in the determining a total number of times a signal corresponding to a high frequency is transmitted may be set greater than a total number of times another signal is transmitted within a predetermined time.

At the time of frequency conversion at a receiver a signal corresponding to a high frequency results in low luminance but an increase in the number of transmissions makes it possible to increase a luminance value at the time of frequency conversion.

According to one embodiment of the present disclosure changes in luminance with time in the luminance change pattern have a waveform of any of a square wave a triangular wave and a sawtooth wave.

According to one embodiment of the present disclosure when an average luminance of the light emitter is set to have a large value a length of time for which luminance of the light emitter is greater than a predetermined value during the time corresponding to the single frequency may be set to be longer than when the average luminance of the light emitter is set to have a small value.

By adjusting the length of time for which the luminance of the light emitter is greater than the predetermined value during the time corresponding to a single frequency it is possible to adjust the average luminance of the light emitter while transmitting signals. For example when the light emitter is used as a lighting signals can be transmitted while the overall brightness is decreased or increased.

Using an application programming interface API indicating a unit for using OS functions on which the exposure time is set the receiver can set the exposure time to a predetermined value and stably receive the visible light signal. Furthermore using the API on which sensitivity is set the receiver can set sensitivity to a predetermined value and even when the brightness of a transmission signal is low or high can stably receive the visible light signal.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED or an organic EL device in each of the embodiments described above.

In order to receive the visible light signal by the image sensor in the scheme according to the present disclosure it is necessary to set the exposure time shorter than a predetermined time. The predetermined time is determined according to a modulation scheme and a modulation frequency of the visible light signal. Generally the exposure time needs to be shorter as the modulation frequency increases.

As the exposure time becomes shorter the clarity of observied bright lines can increase. Meanwhile a shorter exposure time leads to a reduction in the intensity of received light resulting in an entire captured image being darker. In other words the signal strength is attenuated. Therefore it is possible to improve reception performance such as a reception speed and an error rate by setting a short exposure time within the range in which presence of the visible light signal is detectable.

As illustrated in the receiver sets the imaging mode to the visible light imaging mode Step S . At this time the receiver determines whether or not it includes a monochrome imaging function and is to receive a signal modulated with luminance information only Step S . Here when determining that it includes a monochrome imaging function and is to receive a signal modulated with luminance information only Step S Y the receiver sets a color related mode included in the imaging mode to a monochrome imaging mode in which the monochrome imaging function is used Step S . By doing so in the case of receiving a signal modulated with luminance information only that is in the case of receiving a visible light signal which represents information by changes in luminance only it is possible to improve the processing speed by not handling color information. In contrast when not determining in Step S that it includes a monochrome imaging function and is to receive a signal modulated with luminance information only Step S N that is when the visible light signal is represented using color information the receiver sets the color related mode included in the imaging mode to a color imaging mode Step S .

Next the receiver determines whether or not an imaging unit including the above stated image sensor includes a function of selecting an exposure time Step S . Here when determining that the function is included Step Y the receiver sets the exposure time shorter than the above stated predetermined time using the function so that bright lines will appear in a captured image Step S . Note that the receiver may set the exposure time to as short an exposure time as possible within the range in which the transmitter that transmits the visible light signal can be seen in the captured image.

In contrast when determining in Step S that the function of selecting the exposure time is not included Step S N the receiver further determines whether or not the imaging unit includes a function of setting sensitivity Step S . Here when determining that the function of setting sensitivity is included Step S Y the receiver sets the sensitivity to the maximum using the function Step S . As a result a captured image obtained by imaging with the maximum sensitivity will be bright. Therefore in the receiver with automatic exposure enabled the exposure time is set short by the automatic exposure so that the exposure falls within a predetermined range. Note that in the automatic exposure every time an image is captured the captured image is used as input of the automatic exposure and the exposure time is adjusted as needed based on the captured image so that the exposure falls within the predetermined range. Details of the automatic exposure shall be described later.

Furthermore the receiver determines whether or not the imaging unit includes a function of setting the F number aperture Step S . Here when the function of setting the F number Step S Y is included the receiver sets the F number to the minimum opens the aperture using the function Step S . As a result a captured image obtained by imaging with the minimum F number will be bright. Therefore in the receiver with automatic exposure enabled the exposure time is set short by the automatic exposure so that the exposure falls within a predetermined range.

Furthermore the receiver determines whether or not the imaging unit includes a function of selecting an exposure compensation value Step S . Here when determining that the imaging unit includes the function of selecting an exposure compensation value Step S Y the receiver sets the exposure compensation value to the minimum using the function Step S . As a result in the receiver with automatic exposure enabled the exposure time is set short by the automatic exposure so that the exposure becomes low.

A scene mode a high speed scene mode for capturing an image of a subject in high speed motion is generally defined to have a name such as Sport or Action. 

As illustrated in the receiver determines after Step S or Step S whether or not the following condition is satisfied Step S the imaging unit includes a function of setting the high speed scene mode and setting of the high speed scene mode does not lead to setting the sensitivity lower than before the setting of the scene mode or lead to setting the F number higher than before the setting of the scene mode or lead to setting the exposure compensation value higher than before the setting of the scene mode. Here when determining that the above condition is satisfied Step S Y the receiver sets the scene mode to the high speed scene mode Step S . As a result in the receiver with automatic exposure enabled the exposure time is set short by the automatic exposure so that a blur free image of the subject in high speed motion can be captured.

Next the receiver enables the automatic exposure Step S and captures an image of the subject Step S .

As illustrated in the receiver determines after Step S whether or not the imaging unit includes a zoom function Step S . Here when determining that the zoom function is included Step S Y the receiver further determines whether or not a zoom center position is selectable that is whether or not the center position can be set to a given position within the captured image Step S . When determining that the center position is selectable Step S Y the receiver selects a bright part of the captured image as the zoom center position and zooms to capture an image in which the subject corresponding to the bright part is shown large at the center Step S . In contrast when determining that the center position is not selectable Step S N the receiver determines whether or not the center of the captured image is brighter than brightness having a predetermined value or whether or not the center of the captured image is brighter than the average brightness of predetermined portions of the captured image Step S . Here when determining that the center is brighter Step S Y the receiver zooms Step S . Thus also in this case the subject corresponding to the bright part can be shown large at the center in a captured image.

Generally in many of devices including an imaging unit the center weighted metering is adopted as a metering scheme and when a captured image has a bright part at the center the exposure is adjusted based on the bright part even when another position is not selected as the metering position. With this the exposure time is set short. In addition since the zooming results in an increase in the area of the bright part and thus the exposure is adjusted based on a brighter screen the exposure time is set short.

Next the receiver determines whether or not a function of selecting a metering position or a focus position is included Step S . Here when determining that the function is included Step S Y the receiver performs processing for finding a bright place within the captured image. That is the receiver performs processing for finding out of the captured image a place in a region brighter than predetermined brightness and having predetermined shape and size. Specifically the receiver first determines whether or not an exposure evaluation calculation expression for the automatic exposure is already known Step S . When determining that the calculation expression is already known Step S Y the receiver finds a place in the above described bright region by evaluating the brightness of each region of the captured image with the use of the same calculation expression as the known calculation expression Step S . In contrast when determining that the exposure evaluation calculation expression is unknown N in Step S the receiver finds a place in the above described bright region by evaluating the brightness of each region of the captured image with the use of a predetermined calculation expression for calculating an average value of brightness of pixels in a region having predetermined shape and size Step S . Note that the predetermined shape is the shape of a rectangle a circle or a cross for example. Furthermore the region may be made up of a plurality of discontinuous regions. Furthermore the calculation for the above described average value may use rather than a simple average a weighted average calculated with a more weight in a part closer to the center.

The receiver determines whether or not a total area of all the bright regions found is smaller than a predetermined area Step S . Here when determined that the total area is smaller than the predetermined area Step S Y the receiver zooms to capture an image in which the total area of the bright regions is no less than the predetermined area Step S . Next the receiver determines whether or not a metering position is selectable Step S . When determining that the metering position is selectable Step S Y the receiver selects a place in the brightest region as the metering position Step S . In the automatic exposure the exposure is adjusted based on the brightness of the metering position. Thus when a place in the brightest region is selected as the metering position the exposure time is set short by the automatic exposure. In contrast when determining in Step S that the metering position is not selectable Step N that is when the focus position is selectable the receiver selects a place in the brightest region as the focus position. Various imaging units can be mounted in the receiver. In the automatic exposure by some of these various imaging units the exposure is adjusted based on brightness at the focus position. Therefore when a place in the brightest region is selected as the focus position the exposure time is set short by the automatic exposure. Here the selected place may be different from the place in the region used to evaluate or calculate brightness and is set according to a setting scheme of the imaging unit. As an example when the selected scheme is designed to select a center point the receiver selects the center of the brightest region and when the selected scheme is designed to select a rectangular region the receiver selects a rectangular region including the center of the brightest region.

Next the receiver determines whether or not any region of the captured image is brighter than the region of the place selected as the metering position or the focus position Step S . Here when determining that a brighter region is present Step S Y the receiver repeats the processing following Step S. In contrast when determining that no brighter region is present Step S N the receiver captures an image of the subject Step S .

Next the receiver determines based on the image captured in Step S whether or not the automatic exposure needs to be ended or whether or not a predetermined time has elapsed since the automatic exposure was enabled Step S . Here for example when determining that the automatic exposure does not need to be ended Step S N the receiver further determines based on the image captured in Step S whether or not the position or the imaging direction of the imaging unit has changed Step S . When determining that the position or the imaging direction of the imaging unit has changed Step S Y the receiver performs the processing following Step S again. By doing so even when the place selected as the metering position or the focus position moves in the captured image a place in the brightest region at that moment can be selected. In contrast when determining in Step S that the position or the imaging direction of the imaging unit has not changed Step N the receiver repeats the processing following Step S. Note that the receiver may search for the brightest region and select a metering position or a focus position every time one image is captured.

When determining in Step that the automatic exposure needs to be ended when the exposure time does not change any more or when determining in Step that the predetermined time has elapsed Step S Y or when the exposure time is set in Step S the receiver disables the automatic exposure Step S and captures an image of the subject Step S . The receiver then determines whether or not a visible light signal has been received by capturing the image Step S . Here when determining that no visible light signal has been received Step S N the receiver further determines whether or not a predetermined time has elapsed Step S . When determining that the predetermined time has not elapsed Step S N the receiver repeats the processing following Step S. In contrast when determining that the predetermined time has elapsed Step S Y that is when failing to receive a visible light signal within the predetermined time the receiver repeats the processing following Step S to search for the brightest region again.

Note that the receiver may stop zooming at any point in time when the zoom function is used. This means that when not zooming the receiver may detect whether or not a bright subject is present in a range that is not captured when zoomed in but is captured when not zoomed in. Note that this bright subject is likely to be a transmitter that transmits a visible light signal by way of luminance change. By doing so it is possible to receive signals from transmitters present in a wide range.

The automatic exposure in is described below. The automatic exposure is an operation a process or a function of automatically adjusting a metering result to a predetermined value by the imaging unit of the receiver by way of adjusting the exposure time the sensitivity and the aperture.

The metering method for obtaining a metering result includes average metering full frame metering center weighted metering spot metering partial metering and segment metering. The average metering calculates average brightness of an entire image to be captured. The center weighted metering calculates a weighed average value of brightness that is more weighted toward the center or a selected portion of an image. The spot metering calculates an average value or a weighted average value of brightness of one predetermined area or a few predetermined areas defined with the center or the selected portion of the image as its center. The segment metering segments the image into portions measures light at each of the portions and calculates a value of total brightness.

Even being unable to directly set the exposure time short the imaging unit including an automatic exposure function is capable of indirectly setting an exposure time by the automatic exposure function. For example when the sensitivity is set high e.g. to the maximum value a captured image is bright where the other parameters are the same and therefore the exposure time can be set short by the automatic exposure. When the aperture is set to be open i.e. uncovered the exposure time can be set short likewise. When a value indicating an exposure compensation level is set low e.g. to the minimum value the automatic exposure causes a dark image to be captured that is the exposure time is set short. When the brightest place in an image is selected as the metering position the exposure time can be set short. If it a metering method is selectable the exposure time can be set short when the spot metering is selected. If a metering range is selectable the exposure time can be set short when the minimum metering range is selected. In the case where the area of the bright part in the image is large the exposure time can be set short when the largest possible metering range that does not exceed the bright part is selected. If more than one metering position is selectable the exposure time can be set short when the same place is selected as the metering position more than one time. When a zoomed in image of a bright place in the image is captured and this place is selected as the metering position the exposure time can be set short.

The zoom in that is the way to obtain a magnified image includes optical zoom which adjusts the focal length of a lens to change the size of an image formed on an imaging element digital zoom which interpolates an image formed on an imaging element through digital processing to obtain a magnified image and EX zoom which changes imaging elements that are used for imaging to obtain a magnified image. The EX zoom is applicable when the number of imaging elements included in an image sensor is great relative to a resolution of a captured image.

For example an image sensor illustrated in includes 32 by 24 imaging elements arranged in matrix. Specifically 32 imaging elements in width by 24 imaging elements in height are arranged. When this image sensor captures an image having a resolution of 16 pixels in width and 12 pixels in height out of the 32 by 24 imaging elements included in the image sensor only 16 by 12 imaging elements evenly dispersed as a whole in the image sensor e.g. the imaging elements of the image sensor indicated by black squares in a in are used for imaging as illustrated in a in . In other words only odd numbered or even numbered imaging elements in each of the heightwise and widthwise arrangements of imaging elements is used to capture an image. By doing so an image having a desired resolution is obtained. Note that although a subject appears on the image sensor in this is for facilitating the understanding of a relationship between each of the imaging elements and a captured image.

When capturing an image of a wide range to search for a transmitter or to receive information from many transmitters a receiver including the above image sensor captures an image using only a part of the imaging elements evenly dispersed as a whole in the image sensor

When using the EX zoom the receiver captures an image by only a part of the imaging elements that is locally dense in the image sensor e.g. the 16 by 12 image sensors indicated by black squares in the image sensor in b in as illustrated in b in . By doing so an image is obtained which is a zoomed in image of a part of the image that corresponds to that part of the imaging elements. With such EX zoom a magnified image of a transmitter is captured which makes it possible to receive visible light signals for a long time as well as to increase the reception speed and to receive a visible light signal from far way.

In the digital zoom it is not possible to increase the number of exposure lines that receive visible light signals and the length of time for which the visible light signals are received does not increase therefore it is preferable to use other kinds of zoom as much as possible. The optical zoom requires time for physical movement of a lens an image sensor or the like in this regard the EX zoom requires only a digital setting change and is therefore advantageous in that it takes a short time to zoom. From this perspective the order of priority of the zooms is as follows 1 the EX zoom 2 the optical zoom and 3 the digital zoom. The receiver may use one or more of these zooms selected according to the above order of priority and the need of zoom magnification. Note that the imaging elements that are not used in the imaging methods represented in a and b in may be used to reduce image noise.

This reception program is a program for causing a computer included in a receiver to execute the processing illustrated in for example.

In other words this reception program is a reception program for receiving information from a light emitter. In detail this reception program causes a computer to execute an exposure time setting step SA of setting an exposure time of an image sensor using automatic exposure a bright line image obtainment step SA of obtaining a bright line image which is an image including a plurality of bright lines corresponding to a plurality of exposure lines included in the image sensor by capturing an image of a light emitter changing in luminance by the image sensor with the set exposure time and an information obtainment step SA of obtaining information by decoding a pattern of the plurality of the bright lines included in the obtained bright line image. In the exposure time setting step SA the sensitivity of the image sensor is set to the maximum value within a predetermined range for the image sensor as in Step S in and an exposure time according to the sensitivity at the maximum value is set by the automatic exposure.

By doing so a short exposure time that allows for an appropriate bright line image to be obtained can be set using an automatic exposure function included in a commonly used camera even when the exposure time of the image sensor cannot be directly set. Thus in the automatic exposure the exposure is adjusted based on brightness of an image captured by the image sensor. Therefore when the sensitivity of the image sensor is set to a large value the image is bright and thus the exposure time of the image sensor is set short to reduce exposure. Setting the sensitivity of the image sensor to the maximum value allows the exposure time to be set shorter and thus it is possible to obtain an appropriate bright line image. That is it is possible to appropriately receive information from the light emitter. As a result communication between various devices becomes possible. Note that the sensitivity is ISO speed for example.

In the exposure time setting step SA a value indicating an exposure compensation level of the image sensor is set to the minimum value within a preset range for the image sensor as in Step S in and an exposure time according to the sensitivity at the maximum value and the exposure compensation level at the minimum value is set by the automatic exposure.

By doing so since the value indicating the exposure compensation level is set to the minimum value processing in the automatic exposure to reduce exposure allows the exposure time to be set shorter and thus it is possible to obtain an appropriate bright line image. Note that the unit of the value indicating the exposure compensation level is EV for example.

Furthermore in the exposure time setting step SA a brighter part than the other part in a first image captured by the image sensor of a subject including a light emitter is specified as in . The optical zoom is then used to enlarge an image of a part of the subject that corresponds to this bright part. Furthermore a second image obtained by capturing the enlarged image of the part of the subject by the image sensor is used as input of the automatic exposure to set the exposure time. Moreover in the bright line image obtainment step SA the enlarged image of the part of the subject is captured by the image sensor with the set exposure time to obtain a bright line image.

Thus the optical zoom enlarges an image of a part of the subject that corresponds to the bright part in the first image that is the optical zoom enlarges an image of a bright light emitter with the result that the second image can be brighter than the first image as a whole. Since this bright second image is used as input of the automatic exposure processing in the automatic exposure to reduce exposure allows the exposure time to be set shorter and thus it is possible to obtain an appropriate bright line image.

Furthermore in the exposure time setting step SA it is determined as illustrated in whether or not a central part of the first image captured by the image sensor of the subject including the light emitter is brighter than the average brightness of a plurality of points in the first image. When the central part is determined to be brighter the optical zoom enlarges an image of a part of the subject that corresponds to the central part. Furthermore a second image obtained by capturing the enlarged image of the part of the subject by the image sensor is used as input of the automatic exposure to set the exposure time. Moreover in the bright line image obtainment step SA the enlarged image of the part of the subject is captured by the image sensor with the set exposure time to obtain a bright line image.

Thus the optical zoom enlarges an image of a part of the subject that corresponds to the bright central part in the first image that is the optical zoom enlarges an image of a bright light emitter with the result that the second image can be brighter than the first image as a whole. Since this bright second image is used as input of the automatic exposure processing in the automatic exposure to reduce exposure allows the exposure time to be set shorter and thus it is possible to obtain an appropriate bright line image. If arbitrary setting of a center position for the enlargement is not possible the optical zoom enlarges a central part of the angle of view or the image. Therefore even when arbitrary setting of the center position is not possible the optical zoom can be used to make the second image brighter as a whole as long as the central part of the first image is bright. Here if the enlargement by the optical zoom is performed even when the central part of the first image is dark the second image will be dark resulting in the exposure time becoming long. Therefore as described above the enlargement by the optical zoom is performed only when the central part is determined to be bright so that the exposure time can be prevented from becoming long.

Furthermore in the exposure time setting step SA a brighter part than the other part in a first image of a subject including a light emitter captured by among K imaging elements where K is an integer of 3 or more included in an image sensor only N imaging elements where N is an integer less than K and no less than 2 evenly dispersed in the image sensor is specified as illustrated in . Moreover a second image captured by only N densely arranged imaging elements corresponding to the bright part among the K imaging elements included in the image sensor is used as input of the automatic exposure to set the exposure time. In the bright line image obtainment step SA an image is captured by only the N densely arrange imaging elements included in the image sensor with the set exposure time to obtain a bright line image.

By doing so the second image can be bright as a whole through what is called the EX zoom even when the bright part is not located at the center of the first image with the result that the exposure time can be set short.

Furthermore in the exposure time setting step SA a metering position in the image of the subject captured by the image sensor is set as illustrated in and an exposure time according to brightness at the set metering position is set by the automatic exposure.

By doing so when the bright part in the captured image is set as the metering position processing in the automatic exposure to reduce exposure allows the exposure time to be set shorter and thus it is possible to obtain an appropriate bright line image.

Furthermore the reception program may further cause a computer to execute an imaging mode setting step of switching an imaging mode of the image sensor from a color imaging mode for obtaining a color image by imaging to a monochrome imaging mode for obtaining a monochrome image by imaging. In this case in the exposure time setting step SA an image obtained in the monochrome imaging mode is used as input of the automatic exposure to set the exposure time.

Thus an image obtained in the monochrome imaging mode is used as input of the automatic exposure with the result that an appropriate exposure time can be set without influence of color information. When the exposure time is set in the monochrome imaging mode the bright line image is obtained by imaging according to this mode. Therefore when the light emitter transmits information only by changing in luminance the information can be appropriately obtained.

Furthermore in the exposure time setting step SA every time an image is obtained by capturing an image of the light emitter by the image sensor the obtained image is used as input of the automatic exposure to update the exposure time of the image sensor. Here as illustrated in Step S in for example the updating of the exposure time by the automatic exposure is brought to an end when the fluctuation range of the exposure time that is updated as needed falls below a predetermined range and thus the exposure time is set.

Thus when the fluctuation of the exposure time is stable that is when brightness of an image obtained by imaging is within a target brightness range the exposure time set at the point is used in the imaging for obtaining a bright line image. Therefore an appropriate bright line image can be obtained.

This reception device A is the above described receiver that performs the processing illustrated in for example.

In detail this reception device A is a device for receiving information from a light emitter and includes an exposure time setting unit SA configured to set an exposure time of an image sensor using automatic exposure an imaging unit A configured to obtain a bright line image which is an image including a plurality of bright lines corresponding to a plurality of exposure lines included in the image sensor by capturing an image of a light emitter changing in luminance by the image sensor with the set exposure time and a decoding unit A configured to obtain information by decoding a pattern of the plurality of the bright lines included in the obtained bright line image. The exposure time setting unit A sets the sensitivity of the image sensor to the maximum value within a predetermined range for the image sensor and sets the exposure time according to the sensitivity at the maximum value by the automatic exposure. This reception device A can produce the same advantageous effects as the above described reception program.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED or an organic EL device in each of the embodiments described above.

As illustrated in the exposure time is set for each exposure line in an image sensor which is an imaging unit included in a receiver. Specifically a long exposure time for normal imaging is set for a predetermined exposure line white exposure lines in and a short exposure time for visible light imaging is set for another exposure line black exposure lines in . For example a long exposure time and a short exposure line are alternately set for exposure lines arranged in the vertical direction. By doing so normal imaging and visible light imaging visible light communication can be performed almost simultaneously upon capturing an image of a transmitter that transmits a visible light signal by changing in luminance. Note that out of the two exposure times different exposure times may be alternately set on a per line basis or a different exposure time may be set for each set of several lines or each of an upper part and a lower part of the image sensor . With the use of two exposure times in this way combining data of images captured with the exposure lines for which the same exposure time is set results in each of a normal captured image and a visible light captured image which is a bright line image having a pattern of a plurality of bright lines. Since the normal captured image lacks an image portion not captured with the long exposure time that is an image corresponding to the exposure lines for which the short exposure time is set the normal captured image is interpolated for the image portion so that a preview image can be displayed. Here information obtained by visible light communication can be superimposed on the preview image . This information is information associated with the visible light signal obtained by decoding the pattern of the plurality of the bright lines included in the visible light captured image . Note that it is possible that the receiver stores as a captured image the normal captured image or an interpolated image of the normal captured image and adds to the stored captured image the received visible light signal or the information associated with the visible light signal as additional information.

As illustrated in an image sensor may be used instead of the image sensor . In the image sensor the exposure time is set for each column of a plurality of imaging elements arranged in the direction perpendicular to the exposure lines the column is hereinafter referred to as a vertical line rather than for each exposure line. Specifically a long exposure time for normal imaging is set for a predetermined vertical line white vertical lines in and a short exposure time for visible light imaging is set for another vertical line black vertical lines in . In this case in the image sensor the exposure of each of the exposure lines starts at a different point in time as in the image sensor but the exposure time of each imaging element included in each of the exposure lines is different. Through imaging by this image sensor the receiver obtains a normal captured image and a visible light captured image . Furthermore the receiver generates and displays a preview image based on this normal captured image and information associated with the visible light signal obtained from the visible light captured image

This image sensor is capable of using all the exposure lines for visible light imaging unlike the image sensor . Consequently the visible light captured image obtained by the image sensor includes a larger number of bright lines than in the visible light captured image and therefore allows the visible light signal to be received with increased accuracy.

As illustrated in an image sensor may be used instead of the image sensor . In the image sensor the exposure time is set for each imaging element in such a way that the same exposure time is not set for imaging elements next to each other in the horizontal direction and the vertical direction. In other words the exposure time is set for each imaging element in such a way that a plurality of imaging elements for which a long exposure time is set and a plurality of imaging elements for which a short exposure time is set are distributed in a grid or a checkered pattern. Also in this case the exposure of each of the exposure lines starts at a different point in time as in the image sensor but the exposure time of each imaging element included in each of the exposure lines is different. Through imaging by this image sensor the receiver obtains a normal captured image and a visible light captured image . Furthermore the receiver generates and displays a preview image based on this normal captured image and information associated with the visible light signal obtained from the visible light captured image

The normal captured image obtained by the image sensor has data of the plurality of the imaging elements arranged in a grid or evenly arranged and therefore interpolation and resizing thereof can be more accurate than those of the normal captured image and the normal captured image . The visible light captured image is generated by imaging that uses all the exposure lines of the image sensor . Thus this image sensor is capable of using all the exposure lines for visible light imaging unlike the image sensor . Consequently as with the visible light captured image the visible light captured image obtained by the image sensor includes a larger number of bright lines than in the visible light captured image and therefore allows the visible light signal to be received with increased accuracy.

The receiver including the above described image sensor illustrated in switches at predetermined intervals between an exposure time that is set in an odd numbered exposure line hereinafter referred to as an odd line and an exposure line that is set in an even numbered exposure line hereinafter referred to as an even line . For example as illustrated in at time t the receiver sets a long exposure time for each imaging element in the odd lines and sets a short exposure time for each imaging element in the even lines and an image is captured with these set exposure times. At time t the receiver sets a short exposure time for each imaging element in the odd lines and sets a long exposure time for each imaging element in the even lines and an image is captured with these set exposure times. At time t the receiver captures an image with the same exposure times set as those set at time t. At time t the receiver captures an image with the same exposure times set as those set at time t.

The receiver obtains Image which includes captured images obtained from the plurality of the odd lines hereinafter referred to as odd line images and captured images obtained from the plurality of the even lines hereinafter referred to as even line images . At this time the exposure time for each of the even lines is short resulting in the subject failing to appear clear in each of the even line images. Therefore the receiver generates interpolated line images by interpolating even line images with pixel values. The receiver then displays a preview image including the interpolated line images instead of the even line images. Thus the odd line images and the interpolated line images are alternately arranged in the preview image.

At time t the receiver obtains Image which includes captured odd line images and even line images. At this time the exposure time for each of the odd lines is short resulting in the subject failing to appear clear in each of the odd line images. Therefore the receiver displays a preview image including the odd line images of the Image instead of the odd line images of the Image . Thus the odd line images of the Image and the even line images of the Image are alternately arranged in the preview image.

At time t the receiver obtains Image which includes captured odd line images and even line images. At this time the exposure time for each of the even lines is short resulting in the subject failing to appear clear in each of the even line images as in the case of time t. Therefore the receiver displays a preview image including the even line images of the Image instead of the even line images of the Image . Thus the even line images of the Image and the odd line images of the Image are alternately arranged in the preview image. At time t the receiver obtains Image which includes captured odd line images and even line images. At this time the exposure time for each of the odd lines is short resulting in the subject failing to appear clear in each of the odd line images as in the case of time t. Therefore the receiver displays a preview image including the odd line images of the Image instead of the odd line images of the Image . Thus the odd line images of the Image and the even line images of the Image are alternately arranged in the preview image.

In this way the receiver displays the image including the even line images and the odd line images obtained at different times that is displays what is called an interlaced image.

The receiver is capable of displaying a high definition preview image while performing visible light imaging. Note that the imaging elements for which the same exposure time is set may be imaging elements arranged along a direction horizontal to the exposure line as in the image sensor or imaging elements arranged along a direction perpendicular to the exposure line as in the image sensor or imaging elements arranged in a checkered pattern as in the image sensor . The receiver may store the preview image as captured image data.

In an image sensor included in the receiver a long exposure time or a short exposure time is set for each exposure line as in the above described image sensor . In this image sensor the ratio between the number of imaging elements for which the long exposure time is set and the number of imaging elements for which the short exposure time is set is one to one. This ratio is a ratio between normal imaging and visible light imaging and hereinafter referred to as a spatial ratio.

In this embodiment however this spatial ratio does not need to be one to one. For example the receiver may include an image sensor . In this image sensor the number of imaging elements for which a short exposure time is set is greater than the number of imaging elements for which a long exposure time is set that is the spatial ratio is one to N N 1 . Alternatively the receiver may include an image sensor . In this image sensor the number of imaging elements for which a short exposure time is set is less than the number of imaging elements for which a long exposure time is set that is the spatial ratio is N N 1 to one. It may also be that the exposure time is set for each vertical line described above and thus the receiver includes instead of the image sensors to any one of image sensors to having spatial ratios one to N one to one and N to one respectively.

These image sensors and are capable of receiving the visible light signal with increased accuracy or speed because they include a large number of imaging elements for which the short exposure time is set. These image sensors and are capable of displaying a high definition preview image because they include a large number of imaging elements for which the long exposure time is set.

Furthermore using the image sensors and the receiver may display an interlaced image as illustrated in .

The receiver may switch the imaging mode between a normal imaging mode and a visible light imaging mode for each frame as illustrated in a in . The normal imaging mode is an image mode in which a long exposure time for normal imaging is set for all the imaging elements of the image sensor in the receiver. The visible light imaging mode is an image mode in which a short exposure time for visible light imaging is set for all the imaging elements of the image sensor in the receiver. Such switching between the long and short exposure times makes it possible to display a preview image using an image captured with the long exposure time while receiving a visible light signal using an image captured with the short exposure time.

Note that in the case of determining a long exposure time by the automatic exposure the receiver may ignore an image captured with a short exposure time so as to perform the automatic exposure based on only brightness of an image captured with a long exposure time. By doing so it is possible to determine an appropriate long exposure time.

Alternatively the receiver may switch the imaging mode between the normal imaging mode and the visible light imaging mode for each set of frames as illustrated in b in . If it takes time to switch the exposure time or if it takes time for the exposure time to stabilize changing the exposure time for each set of frames as in b in enables the visible light imaging reception of a visible light signal and the normal imaging at the same time. The number of times the exposure time is switched is reduced as the number of frames included in the set increases and thus it is possible to reduce power consumption and heat generation in the receiver.

The ratio between the number of frames continuously generated by imaging in the normal imaging mode using a long exposure time and the number of frames continuously generated by imaging in the visible light imaging mode using a short exposure time hereinafter referred to as a temporal ratio does not need to be one to one. That is although the temporal ratio is one to one in the case illustrated in a and b of this temporal ratio does not need to be one to one.

For example the receiver can make the number of frames in the visible light imaging mode greater than the number of frames in the normal imaging mode as illustrated in c in . By doing so it is possible to receive the visible light signal with increased speed. When the frame rate of the preview image is greater than or equal to a predetermined rate a difference in the preview image depending on the frame rate is not visible to human eyes. When the imaging frame rate is sufficiently high for example when this frame rate is 120 fps the receiver sets the visible light imaging mode for three consecutive frames and sets the normal imaging mode for one following frame. By doing so it is possible to receive the visible light signal with high speed while displaying the preview image at 30 fps which is a frame rate sufficiently higher than the above predetermined rate. Furthermore the number of switching operations is small and thus it is possible to obtain the effects described with reference to b in .

Alternatively the receiver can make the number of frames in the normal imaging mode greater than the number of frames in the visible light imaging mode as illustrated in d in . When the number of frames in the normal imaging mode that is the number of frames captured with the long exposure time is set large as just mentioned a smooth preview image can be displayed. In this case there is a power saving effect because of a reduced number of times the processing of receiving a visible light signal is performed. Furthermore the number of switching operations is small and thus it is possible to obtain the effects described with reference to b in .

It may also be possible that as illustrated in e in the receiver first switches the imaging mode for each frame as in the case illustrated in a in and next upon completing receiving the visible light signal increases the number of frames in the normal imaging mode as in the case illustrated in d in . By doing so it is possible to continue searching for a new visible light signal while displaying a smooth preview image after completion of the reception of the visible light signal. Furthermore since the number of switching operations is small it is possible to obtain the effects described with reference to b in .

The receiver starts visible light reception which is processing of receiving a visible light signal Step S and sets a preset long short exposure time ratio to a value specified by a user Step S . The preset long short exposure time ratio is at least one of the above spatial ratio and temporal ratio. A user may specify only the spatial ratio only the temporal ratio or values of both the spatial ratio and the temporal ratio. Alternatively the receiver may automatically set the preset long short exposure time ratio without depending on a ratio specified by a user.

Next the receiver determines whether or not the reception performance is no more than a predetermined value Step S . When determining that the reception performance is no more than the predetermined value Y in Step S the receiver sets the ratio of the short exposure time high Step S . By doing so it is possible to increase the reception performance. Note that the ratio of the short exposure time is when the spatial ratio is used a ratio of the number of imaging elements for which the short exposure time is set to the number of imaging elements for which the long exposure time is set and is when the temporal ratio is used a ratio of the number of frames continuously generated in the visible light imaging mode to the number of frames continuously generated in the normal imaging mode.

Next the receiver receives at least part of the visible light signal and determines whether or not at least part of the visible light signal received hereinafter referred to as a received signal has a priority assigned Step S . The received signal that has a priority assigned contains an identifier indicating a priority. When determining that the received signal has a priority assigned Step S Y the receiver sets the preset long short exposure time ratio according to the priority Step S . Specifically the receiver sets the ratio of the short exposure time high when the priority is high. For example an emergency light as a transmitter transmits an identifier indicating a high priority by changing in luminance. In this case the receiver can increase the ratio of the short exposure time to increase the reception speed and thereby promptly display an escape route and the like.

Next the receiver determines whether or not the reception of all the visible light signals has been completed Step S . When determining that the reception has not been completed Step S N the receiver repeats the processes following Step S. In contrast when determining that the reception has been completed Step S Y the receiver sets the ratio of the long exposure time high and effects a transition to a power saving mode Step S . Note that the ratio of the long exposure time is when the spatial ratio is used a ratio of the number of imaging elements for which the long exposure time is set to the number of imaging elements for which the short exposure time is set and is when the temporal ratio is used a ratio of the number of frames continuously generated in the normal imaging mode to the number of frames continuously generated in the visible light imaging mode. This makes it possible to display a smooth preview image without performing unnecessary visible light reception.

Next the receiver determines whether or not another visible light signal has been found Step S . When another visible light signal has been found Step S Y the receiver repeats the processes following Step S

The receiver may set two or more exposure times in the image sensor. Specifically as illustrated in a in each of the exposure lines included in the image sensor is exposed continuously for the longest exposure time of the two or more set exposure times. For each exposure line the receiver reads out captured image data obtained by exposure of the exposure line at a point in time when each of the above described two or more set exposure times ends. The receiver does not reset the read captured image data until the longest exposure time ends. Therefore the receiver records cumulative values of the read captured image data so that the receiver will be able to obtain captured image data corresponding to a plurality of exposure times by exposure of the longest exposure time only. Note that it is optional whether the image sensor records cumulative values of captured image data. When the image sensor does not record cumulative values of captured image data a structural element of the receiver that reads out data from the image sensor performs cumulative calculation that is records cumulative values of captured image data.

For example when two exposure times are set the receiver reads out visible light imaging data generated by exposure for a short exposure time that includes a visible light signal and subsequently reads out normal imaging data generated by exposure for a long exposure time as illustrated in a in .

By doing so visible light imaging which is imaging for receiving a visible light signal and normal imaging can be performed at the same time that is it is possible to perform the normal imaging while receiving the visible light signal. Furthermore the use of data across exposure times allows a signal of no less than the frequency indicated by the sampling theorem to be recognized making it possible to receive a high frequency signal a high density modulated signal or the like.

When outputting captured image data the receiver outputs a data sequence that contains the captured image data as an imaging data body as illustrated in b in . Specifically the receiver generates the above data sequence by adding additional information to the imaging data body and outputs the generated data sequence. The additional information contains an imaging mode identifier indicating an imaging mode the visible light imaging or the normal imaging an imaging element identifier for identifying an imaging element or an exposure line included in the imaging element an imaging data number indicating a place of the exposure time of the captured image data in the order of the exposure times and an imaging data length indicating a size of the imaging data body. In the method of reading out captured image data described with reference to a in the captured image data is not necessarily output in the order of the exposure lines. Therefore the additional information illustrated in b in is added so that which exposure line the captured image data is based on can be identified.

This reception program is a program for causing a computer included in a receiver to execute the processing illustrated in for example.

In other words this reception program is a reception program for receiving information from a light emitter changing in luminance. In detail this reception program causes a computer to execute Step SA Step SA and Step SA. In Step SA a first exposure time is set for a plurality of imaging elements which are a part of K imaging elements where K is an integer of 4 or more included in an image sensor and a second exposure time shorter than the first exposure time is set for a plurality of imaging elements which are a remainder of the K imaging elements. In Step SA the image sensor captures a subject i.e. a light emitter changing in luminance with the set first exposure time and the set second exposure time to obtain a normal image according to output from the plurality of the imaging elements for which the first exposure time is set and obtain a bright line image according to output from the plurality of the imaging elements for which the second exposure time is set. The bright light image includes a plurality of bright lines each of which corresponds to a different one of a plurality of exposure lines included in the image sensor. In Step SA a pattern of the plurality of the bright lines included in the obtained bright line image is decoded to obtain information.

With this imaging is performed by the plurality of the imaging elements for which the first exposure time is set and the plurality of the imaging elements for which the second exposure time is set with the result that a normal image and a bright line image can be obtained in a single imaging operation by the image sensor. That is it is possible to capture a normal image and obtain information by visible light communication at the same time.

Furthermore in the exposure time setting step SA a first exposure time is set for a plurality of imaging element lines which are a part of L imaging element lines where L is an integer of 4 or more included in the image sensor and the second exposure time is set for a plurality of imaging element lines which are a remainder of the L imaging element lines. Each of the L imaging element lines includes a plurality of imaging elements included in the image sensor and arranged in a line.

With this it is possible to set an exposure time for each imaging element line which is a large unit without individually setting an exposure time for each imaging element which is a small unit so that the processing load can be reduced.

For example each of the L imaging element lines is an exposure line included in the image sensor as illustrated in . Alternatively each of the L imaging element lines includes a plurality of imaging elements included in the image sensor and arranged along a direction perpendicular to the plurality of the exposure lines as illustrated in .

It may be that in the exposure time setting step SA one of the first exposure time and the second exposure time is set for each of odd numbered imaging element lines of the L imaging element lines included in the image sensor to set the same exposure time for each of the odd numbered imaging element lines and a remaining one of the first exposure time and the second exposure time is set for each of even numbered imaging element lines of the L imaging element lines to set the same exposure time for each of the even numbered imaging element lines as illustrated in . In the case where the exposure time setting step SA the image obtainment step SA and the information obtainment step SA are repeated in the current round of the exposure time setting step S an exposure time for each of the odd numbered imaging element lines is set to an exposure time set for each of the even numbered imaging element lines in an immediately previous round of the exposure time setting step S and an exposure time for each of the even numbered imaging element lines is set to an exposure time set for each of the odd numbered imaging element lines in the immediately previous round of the exposure time setting step S.

With this at every operation to obtain a normal image the plurality of the imaging element lines that are to be used in the obtainment can be switched between the odd numbered imaging element lines and the even numbered imaging element lines. As a result each of the sequentially obtained normal images can be displayed in an interlaced format. Furthermore by interpolating two continuously obtained normal images with each other it is possible to generate a new normal image that includes an image obtained by the odd numbered imaging element lines and an image obtained by the even numbered imaging element lines.

It may be that in the exposure time setting step SA a preset mode is switched between a normal imaging priority mode and a visible light imaging priority mode and when the preset mode is switched to the normal imaging priority mode the total number of the imaging elements for which the first exposure time is set is greater than the total number of the imaging elements for which the second exposure time is set and when the preset mode is switched to the visible light imaging priority mode the total number of the imaging elements for which the first exposure time is set is less than the total number of the imaging elements for which the second exposure time is set as illustrated in .

With this when the preset mode is switched to the normal imaging priority mode the quality of the normal image can be improved and when the preset mode is switched to the visible light imaging priority mode the reception efficiency for information from the light emitter can be improved.

It may be that in the exposure time setting step SA an exposure time is set for each imaging element included in the image sensor to distribute in a checkered pattern the plurality of the imaging elements for which the first exposure time is set and the plurality of the imaging elements for which the second exposure time is set as illustrated in .

This results in uniform distribution of the plurality of the imaging elements for which the first exposure time is set and the plurality of the imaging elements for which the second exposure time is set so that it is possible to obtain the normal image and the bright line image the quality of which is not unbalanced between the horizontal direction and the vertical direction.

This reception device A is the above described receiver that performs the processing illustrated in for example.

In detail this reception device A is a reception device that receives information from a light emitter changing in luminance and includes a plural exposure time setting unit A an imaging unit A and a decoding unit A. The plural exposure time setting unit A sets a first exposure time for a plurality of imaging elements which are a part of K imaging elements where K is an integer of 4 or more included in an image sensor and sets a second exposure time shorter than the first exposure time for a plurality of imaging elements which are a remainder of the K imaging elements. The imaging unit A causes the image sensor to capture a subject i.e. a light emitter changing in luminance with the set first exposure time and the set second exposure time to obtain a normal image according to output from the plurality of the imaging elements for which the first exposure time is set and obtain a bright line image according to output from the plurality of the imaging elements for which the second exposure time is set. The bright line image includes a plurality of bright lines each of which corresponds to a different one of a plurality of exposure lines included in the image sensor. The decoding unit A obtains information by decoding a pattern of the plurality of the bright lines included in the obtained bright line image. This reception device A can produce the same advantageous effects as the above described reception program.

The receiver captures an image of a transmitter and then displays an image including the image of the transmitter as illustrated in a in . Furthermore the receiver generates an image by superimposing an object on the image and displays the image . The object is an image indicating a location of the transmitter and that a visible light signal is being received from the transmitter . The object may be an image that is different depending on the reception status for the visible light signal such as a state in which a visible light signal is being received or the transmitter is being searched for an extent of reception progress a reception speed or an error rate . For example the receiver changes a color a line thickness a line type single line double line dotted line etc. or a dotted line interval of the object . This allows a user to recognize the reception status. Next the receiver generates an image by superimposing on the image an obtained data image which represents content of obtained data and displays the image . The obtained data is the received visible light signal or data associated with an ID indicated by the received visible light signal.

Upon displaying this obtained data image the receiver displays the obtained data image in a speech balloon extending from the transmitter as illustrated in a in or displays the obtained data image near the transmitter . Alternatively the receiver may display the obtained data image in such a way that the obtained data image can be displayed gradually closer to the transmitter as illustrated in b of . This allows a user to recognize which transmitter transmitted the visible light signal on which the obtained data image is based. Alternatively the receiver may display the obtained data image as illustrated in in such a way that the obtained data image gradually comes in from an edge of a display of the receiver. This allows a user to easily recognize that the visible light signal was obtained at that time

When the image of the transmitter moves on the display the receiver moves the obtained data image according to the movement of the image of the transmitter. This allows a user to recognize that the obtained data image is associated with the transmitter. The receiver may alternatively display the obtained data image in association with something different from the image of the transmitter. With this data can be displayed in AR.

For example when a user swipes the obtained data image down as illustrated in a in the receiver stores obtained data represented by the obtained data image . The receiver positions the obtained data image representing the obtained data stored at an end of arrangement of the obtained data image representing one or more pieces of other obtained data already stored. This allows a user to recognize that the obtained data represented by the obtained data image is the obtained data stored last. For example the receiver positions the obtained data image in front of any other one of obtained data images as illustrated in a in .

When a user swipes the obtained data image to the right as illustrated in b in the receiver discards obtained data represented by the obtained data image . Alternatively it may be that when a user moves the receiver so that the image of the transmitter goes out of the frame of the display the receiver discards obtained data represented by the obtained data image . Here all the upward downward leftward and rightward swipes produce the same or similar effect as that described above. The receiver may display a swipe direction for storing or discarding. This allows a user to recognize that data can be stored or discarded with such operation.

In the receiver obtained data images of a plurality of pieces of obtained data stored are displayed on top of each other appearing small in a bottom area of the display as illustrated in a in . When a user taps a part of the obtained data images displayed in this state the receiver displays an expanded view of each of the obtained data images as illustrated in b in . Thus it is possible to display an expanded view of each obtained data only when it is necessary to browse the obtained data and efficiently use the display to display other content when it is not necessary to browse the obtained data.

When a user taps the obtained data image that is desired to be displayed in a state illustrated in b in a further expanded view of the obtained data image tapped is displayed as illustrated in c in so that a large amount of information is displayed out of the obtained data image. Furthermore when a user taps a back side display button the receiver displays the back side of the obtained data image displaying other data related to the obtained data.

By disabling turning off the image stabilization function or converting a captured image according to an image stabilization direction and an image stabilization amount the receiver is capable of obtaining an accurate imaging direction and accurately performing self position estimation. The captured image is an image captured by an imaging unit of the receiver. Self position estimation means that the receiver estimates its position. Specifically in the self position estimation the receiver identifies a position of a transmitter based on a received visible light signal and identifies a relative positional relationship between the receiver and the transmitter based on the size position shape or the like of the transmitter appearing in a captured image. The receiver then estimates a position of the receiver based on the position of the transmitter and the relative positional relationship between the receiver and the transmitter.

The transmitter moves out of the frame due to even a little shake of the receiver at the time of partial read out illustrated in for example in which an image is captured only with the use of a part of the exposure lines that is when imaging illustrated in for example is performed. In such a case the receiver enables the image stabilization function and thereby can continue signal reception.

The above described transmitter includes a light emitting unit and causes the light emitting unit to change in luminance to transmit a visible light signal. In the above described self position estimation the receiver determines as a relative positional relationship between the receiver and the transmitter a relative angle between the receiver and the transmitter based on the shape of the transmitter specifically the light emitting unit in a captured image. Here in the case where the transmitter includes a light emitting unit having a rotationally symmetrical shape as illustrated in for example the determination of a relative angle between the transmitter and the receiver based on the shape of the transmitter in a captured image as described above cannot be accurate. Thus it is desirable that the transmitter include a light emitting unit having a non rotationally symmetrical shape. This allows the receiver to accurately determine the above described relative angle. This is because a bearing sensor for obtaining an angle has a wide margin of error in measurement therefore the use of the relative angle determined in the above described method allows the receiver to perform accurate self position estimation.

The transmitter may include a light emitting unit the shape of which is not a perfect rotation symmetry as illustrated in . The shape of this light emitting unit is symmetrical at degree rotation but not perfect rotational symmetry. In this case the receiver determines a rough angle using the bearing sensor and can further use the shape of the transmitter in a captured image to uniquely limit the relative angle between the receiver and the transmitter and thus it is possible to perform accurate self position estimation.

The transmitter may include a light emitting unit illustrated in . The shape of this light emitting unit is basically rotational symmetry. However with a light guide plate or the like placed in a part of the light emitting unit the light emitting unit is formed into a non rotationally symmetrical shape.

The transmitter may include a light emitting unit illustrated in . This light emitting unit includes lightings each having a rotationally symmetrical shape. These lightings are arranged in combination to form the light emitting unit and the whole shape thereof is not rotationally symmetrical. Therefore the receiver is capable of performing accurate self position estimation by capturing an image of the transmitter. It is not necessary that all the lightings included in the light emitting unit are each a lighting for visible light communication which changes in luminance for transmitting a visible light signal it may be that only a part of the lightings is the lighting for visible light communication.

The transmitter may include a light emitting unit and an object illustrated in . The object is an object configured such that its positional relationship with the light emitting unit does not change e.g. a fire alarm or a pipe . The shape of the combination of the light emitting unit and the object is not rotationally symmetrical. Therefore the receiver is capable of performing self position estimation with accuracy by capturing images of the light emitting unit and the object

Every time the receiver captures an image the receiver can perform the self position estimation based on the position and the shape of the transmitter in the captured image. As a result the receiver can estimate a direction and a distance in which the receiver moved while capturing images. Furthermore the receiver can perform triangulation using frames or images to perform more accurate self position estimation. By combining the results of estimation using images or the results of estimation using different combinations of images the receiver is capable of performing the self position estimation with higher accuracy. At this time the results of estimation based on the most recently captured images are combined with a high priority making it possible to perform the self position estimation with higher accuracy.

The receiver reads out a signal of horizontal optical black as illustrated in a in at the time of normal imaging but can skip reading out a signal of horizontal optical black as illustrated in b of . By doing so it is possible to continuously receive visible light signals.

The horizontal optical black is optical black that extends in the horizontal direction with respect to the exposure line. Vertical optical black is part of the optical black that is other than the horizontal optical black.

The receiver adjusts the black level based on a signal read out from the optical black and therefore at a start of visible light imaging can adjust the black level using the optical black as does at the time of normal imaging. Continuous signal reception and black level adjustment are possible when the receiver is designed to adjust the black level using only the vertical optical black if the vertical optical black is usable. The receiver may adjust the black level using the horizontal optical black at predetermined time intervals during continuous visible light imaging. In the case of alternately performing the normal imaging and the visible light imaging the receiver skips reading out a signal of horizontal optical black when continuously performing the visible light imaging and reads out a signal of horizontal optical black at a time other than that. The receiver then adjusts the black level based on the read out signals and thus can adjust the black level while continuously receiving visible light signals. The receiver may adjust the black level assuming that the darkest part of a visible light captured image is black.

Thus it is possible to continuously receive visible light signals when the optical black from which signals are read out is the vertical optical black only. Furthermore with a mode for skipping reading out a signal of the horizontal optical black it is possible to adjust the black level at the time of normal imaging and perform continuous communication according to the need at the time of visible light imaging. Moreover by skipping reading out a signal of the horizontal optical black the difference in timing of starting exposure between the exposure lines increases with the result that a visible light signal can be received even from a transmitter that appears small in the captured image.

The transmitter may transmit a visible light signal after adding to the visible light signal a transmitter identifier indicating the type of the transmitter. In this case the receiver is capable of performing a reception operation according to the type of the transmitter at the point in time when the receiver receives the transmitter identifier. For example when the transmitter identifier indicates a digital signage the transmitter transmits as a visible light signal a content ID indicating which content is currently displayed in addition to a transmitter ID for individual identification of the transmitter. Based on the transmitter identifier the receiver can handle these IDs separately to display information associated with the content currently displayed by the transmitter. Furthermore for example when the transmitter identifier indicates a digital signage an emergency light or the like the receiver captures an image with increased sensitivity so that reception errors can be reduced.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED or an organic EL device in each of the embodiments described above.

The transmitter divides data to be transmitted into packets and transmits the packets. A packet is made up of a header and a body for example. A luminance change pattern of the header that is a header pattern needs to be a luminance change pattern that does not exist in the body. With this it is possible to identify a position of a packet in data to be continuously transmitted.

For example data to be transmitted is modulated using a 4 PPM scheme. Specifically in this 4 PPM data to be transmitted is modulated into a luminance change pattern having four slots one of which indicates 0 and the other three of which indicate 1. Therefore when data to be continuously transmitted is modulated the number of continuous slots indicating 0 is no more than two and the number of slots indicating 0 in four slots and next four slots is no more than two.

In this embodiment the header pattern is represented as 111111111000 indicated in a in 111111110001 indicated in b in 111111101001 indicated in c in or 111111100101 indicated in d in . With this the header and the data to be continuously transmitted i.e. the body can be identified. Specifically in the header pattern indicated in a in the last four slots 1000 of the header pattern can show that the four slots are a part of the header. In this case the receiver can easily recognize a change in luminance because the number of slots indicating 0 in the header is three and the largest number of continuous slots indicating 0 is four. This means that the receiver can easily receive data from a small transmitter or a distant transmitter.

In the header pattern indicated in b in the last five slots 10001 of the header pattern can show that the five slots are a part of the header. In this case flicker due to a change in luminance can be reduced because the largest number of continuous slots indicating 0 is three which is fewer than in the case of a in . As a result the load on a circuit of the transmitter or the request for design therefore can be reduced. That is it is possible to downsize the capacitor reducing the power consumption the calorific value or the load on the power supply.

In the header pattern indicated in c or d in the last six slots 101001 or 100101 of the header pattern can show that the six slots are a part of the header. In this case flicker due to a change in luminance can be further reduced because the largest number of continuous slots indicating 0 is two which is still fewer than in the case of b in .

The transmitter divides data to be transmitted into packets and transmits the packets. A packet is made up of a header an address unit a data unit and an error correction code unit. When the header has a luminance change pattern that does not exist in the other part it is possible to identify a position of a packet in continuous data. Part of the divided data is stored into the data unit. An address indicating which part of the whole the data in the data unit is present is stored into the address unit. A code for detecting or correcting a reception error of part of a packet or the whole packet which is specifically ECC ECC or ECC illustrated in and are collectively referred to as an error correction code is stored into the error correction code unit.

The ECC is an error correction code of the address unit. When the error correction code of the address unit is provided rather than the error correction code of the whole packet the reliability of the address unit can be higher than the reliability of the whole packet. With this when a plurality of packets have been received data units of packets that have the same address are compared so that the data units can be verified allowing for a reduction in the reception error rate. The same or similar advantageous effects can be produced when the error correction code of the address unit is longer than the error correction code of the data unit.

Each of the ECC and the ECC is an error correction code of the data unit. The number of error correction code units may be other than two. When the data unit has a plurality of error correction codes it is possible to perform error correction using only the error correction code for a part successfully received so far and thus it is possible to receive highly reliable data even when the packet has not been fully received.

The transmitter may be configured to transmit a predetermined number of error correction codes or less. This allows the receiver to receive data with high speed. This transmission method is effective for a transmitter having a light emitting unit which is small in size and high in luminance such as a downlighting. This is because when the luminance is high the error probability is low meaning that there is no need for many error correction codes. In the case of a failure to transmit the ECC the header in next transmission starts with the ECC resulting in a high luminance state continuing over four or more slots and thus the receiver can recognize that this part is not ECC .

Note that the header the address unit and the ECC are transmitted with a frequency lower than the data unit the ECC and the ECC as illustrated in b in . Conversely the data unit the ECC and the ECC are transmitted with a frequency higher than the header the address unit and the ECC. With this it is possible to reduce the reception error rate of data such as the header and it is also possible to transmit a large amount of data in the data unit with high speed.

The receiver receives a packet Step S and performs error correction Step S . The receiver then determines whether or not a packet having the same address as the address of the received packet has already been received Step S . When determining that a packet having the same address has been received Step S Y the receiver compares data in these packets. The receiver determines whether or not the data units are identical Step S . When determining that the data units are not identical Step S N the receiver further determines whether or not the number of differences between the data units is a predetermined number or more specifically whether or not the number of different bits or the number of slots indicating different luminance states is a predetermined number or more Step S . When determining that the number of differences is the predetermined number or more Step S N the receiver discards the already received packet Step S . By doing so when a packet from another transmitter starts being received interference with the packet received from a previous transmitter can be avoided. In contrast when determining that the number of differences is not the predetermined number or more Step S N the receiver regards as data of the address data of the data unit of packets having an identical data unit the number of which is largest Step S . Alternatively the receiver regards identical bits the number of which is largest as a value of a bit of the address. Still alternatively the receiver demodulates data of the address regarding an identical luminance state the number of which is largest as a luminance state of a slot of the address.

A reception method of demodulating data of the data unit based on a plurality of packets is described.

First the receiver receives a packet Step S and performs error correction on the address unit Step S . Here the receiver does not demodulate the data unit and retains pixel values in the captured image as they are. The receiver then determines whether or not no less than a predetermined number of packets out of the already received packets have the same address Step S . When determining that no less than the predetermined number of packets have the same address Step S Y the receiver performs a demodulation process on a combination of pixel values corresponding to the data units in the packets having the same address. Since these packets have been received at different points in time each of the pixel values for the data units reflects luminance of the transmitter that is at a slightly different point in time. Therefore the part subject to the above described demodulation process will contain a larger amount of data a larger number of samples than the data unit in a single packet. This makes it possible to demodulate the data unit with higher accuracy. Furthermore the increase in the number of samples makes it possible to demodulate a signal modulated with a higher modulation frequency.

As illustrated in b in the data unit and the error correction code unit for the data unit are modulated with a higher frequency than the header unit the address unit and the error correction code unit for the address unit. In the above described demodulation method data following the data unit can be demodulated even when the data has been modulated with a high modulation frequency. With this configuration it is possible to shorten the time for the whole packet to be transmitted and it is possible to receive a visible light signal with higher speed from far away and from a smaller light source.

The receiver receives packets Step S and determines whether or not a packet containing the data unit in which all the bits are zero hereinafter referred to as a 0 end packet has been received Step S . When determining that the packet has been received that is when determining that a 0 end packet is present Step S Y the receiver determines whether or not all the packets having addresses following the address of the 0 end packet are present that is have been received Step S . Note that the address of a packet to be transmitted later among packets generated by dividing data to be transmitted is assigned a larger value. When determining that all the packets have been received Step S Y the receiver determines that the address of the 0 end packet is the last address of the packets to be transmitted from the transmitter. The receiver then reconstructs data by combining data of all the packets having the addresses up to the 0 end packet Step S . In addition the receiver checks the reconstructed data for an error Step S . By doing so even when it is not known how many parts the data to be transmitted has been divided into that is when the address has a variable length rather than a fixed length data having a variable length address can be transmitted and received meaning that it is possible to efficiently transmit and receive more IDs than with data having a fixed length address.

Next a reception method using an exposure time longer than a period of a modulation frequency is described.

For example as illustrated in a in there is a case where the visible light signal cannot be properly received when the exposure time is set to time equal to a modulation period. Note that the modulation period is a length of time for one slot described above. Specifically in such a case the number of exposure lines that reflect a luminance state in a particular slot black exposure lines in is small. As a result when there happens to be much noise in pixel values of these exposure lines it is difficult to estimate luminance of the transmitter.

In contrast the visible light signal can be properly received when the exposure time is set to time longer than the modulation period as illustrated in b in for example. Specifically in such a case the number of exposure lines that reflect luminance in a particular slot is large and therefore it is possible to estimate luminance of the transmitter based on pixel values of a large number of exposure lines resulting in high resistance to noise.

For example as illustrated in a in when the exposure time is equal to the modulation period a luminance change that is a change in pixel value of each exposure line received by the receiver follows a luminance change used in the transmission. However as illustrated in b in when the exposure time is three times as long as the modulation period a luminance change received by the receiver cannot fully follow a luminance change used in the transmission. Furthermore as illustrated in c in when the exposure time is 10 times as long as the modulation period a luminance change received by the receiver cannot at all follow a luminance change used in the transmission. To sum up when the exposure time is longer luminance can be estimated based on a larger number of exposure lines and therefore noise resistance increases but a longer exposure time causes a reduction in identification margin or a reduction in the noise resistance due to the reduced identification margin. Considering the balance between these effects the exposure time is set to time that is approximately two to five times as long as the modulation period so that the highest noise resistance can be obtained.

When the transmitter transmits data by changing in luminance the data size of one packet will be large if all pieces of data to be transmitted transmission data are included in the packet. However as described with reference to when the transmission data is divided into data parts and each of these data parts is included in a packet the data size of the packet is small. The receiver receives this packet by imaging. As the data size of the packet increases the receiver has more difficulty in receiving the packet in a single imaging operation and needs to repeat the imaging operation.

Therefore it is desirable that as the data size of the transmission data increases the transmitter increase the number of divisions in the transmission data as illustrated in a and b in . However when the number of divisions is too large the transmission data cannot be reconstructed unless all the data parts are received resulting in lower reception efficiency.

Therefore as illustrated in a in when the data size of the address address size is variable and the data size of the transmission data is 2 to 16 bits 16 to 24 bits 24 to 64 bits 66 to 78 bits 78 bits to 128 bits and 128 bits or more the transmission data is divided into 1 to 2 2 to 4 4 4 to 6 6 to 8 and 7 or more data parts respectively so that the transmission data can be efficiently transmitted in the form of visible light signals. As illustrated in b in when the data size of the address address size is fixed to 4 bits and the data size of the transmission data is 2 to 8 bits 8 to 16 bits 16 to 30 bits 30 to 64 bits 66 to 80 bits 80 to 96 bits 96 to 132 bits and 132 bits or more the transmission data is divided into 1 to 2 2 to 3 2 to 4 4 to 5 4 to 7 6 6 to 8 and 7 or more data parts respectively so that the transmission data can be efficiently transmitted in the form of visible light signals.

The transmitter sequentially changes in luminance based on packets containing respective ones of the data parts. For example according to the sequence of the addresses of packets the transmitter changes in luminance based on the packets. Furthermore the transmitter may change in luminance again based on data parts of the packets according to a sequence different from the sequence of the addresses. This allows the receiver to reliably receive each of the data parts.

First the receiver obtains from a server near the receiver a notification operation identifier for identifying a notification operation and a priority of the notification operation identifier specifically an identifier indicating the priority Step S . The notification operation is an operation of the receiver to notify a user using the receiver that packets containing data parts have been received when the packets have been transmitted by way of luminance change and then received by the receiver. For example this operation is making sound vibration indication on a display or the like.

Next the receiver receives packetized visible light signals that is packets containing respective data parts Step S . The receiver obtains a notification operation identifier and a priority of the notification operation identifier specifically an identifier indicating the priority which are included in the visible light signals Step S .

Furthermore the receiver reads out setting details of a current notification operation of the receiver that is a notification operation identifier preset in the receiver and a priority of the notification operation identifier specifically an identifier indicating the priority Step S . Note that the notification operation identifier preset in the receiver is one set by an operation by a user for example.

The receiver then selects an identifier having the highest priority from among the preset notification operation identifier and the notification operation identifiers respectively obtained in Step S and Step S Step S . Next the receiver sets the selected notification operation identifier in the receiver itself to operate as indicated by the selected notification operation identifier notifying a user of the reception of the visible light signals Step S .

Note that the receiver may skip one of Step S and Step S and select a notification operation identifier with a higher priority from among two notification operation identifiers.

Note that a high priority may be assigned to a notification operation identifier transmitted from a server installed in a theater a museum or the like or a notification operation identifier included in the visible light signal transmitted inside these facilities. With this it can be made possible that sound for receipt notification is not played inside the facilities regardless of settings set by a user. In other facilities a low priority is assigned to the notification operation identifier so that the receiver can operate according to settings set by a user to notify a user of signal reception.

First the receiver obtains from a server near the receiver a notification operation identifier for identifying a notification operation and a priority of the notification operation identifier specifically an identifier indicating the priority Step S . Next the receiver receives packetized visible light signals that is packets containing respective data parts Step S . The receiver obtains a notification operation identifier and a priority of the notification operation identifier specifically an identifier indicating the priority which are included in the visible light signals Step S .

Furthermore the receiver reads out current setting details of notification operation of the receiver that is a notification operation identifier preset in the receiver and a priority of the notification operation identifier specifically an identifier indicating the priority Step S .

The receiver then determines whether or not an operation notification identifier indicating an operation that prohibits notification sound reproduction is included in the preset notification operation identifier and the notification operation identifiers respectively obtained in Step S and Step S Step S . When determining that the operation notification identifier is included Step S Y the receiver outputs a notification sound for notifying a user of completion of the reception Step . In contrast when determining that the operation notification identifier is not included Step S N the receiver notifies a user of completion of the reception by vibration for example Step S .

Note that the receiver may skip one of Step S and Step S and determine whether or not an operation notifying identifier indicating an operation that prohibits notification sound reproduction is included in two notification operation identifiers.

Furthermore the receiver may perform self position estimation based on a captured image and notify a user of the reception by an operation associated with the estimated position or facilities located at the estimated position.

This information processing program is a program for causing the light emitter of the above described transmitter to change in luminance according to the number of divisions illustrated in .

In other words this information processing program is an information processing program that causes a computer to process information to be transmitted in order for the information to be transmitted by way of luminance change. In detail this information processing program causes a computer to execute an encoding step SA of encoding the information to generate an encoded signal a dividing step SA of dividing the encoded signal into four signal parts when a total number of bits in the encoded signal is in a range of 24 bits to 64 bits and an output step S of sequentially outputting the four signal parts. Note that each of these signal parts is output in the form of the packet illustrated in a in . Furthermore this information processing program may cause a computer to identify the number of bits in the encoded signal and determine the number of signal parts based on the identified number of bits. In this case the information processing program causes the computer to divide the encoded signal into the determined number of signal parts.

Thus when the number of bits in the encoded signal is in the range of 24 bits to 64 bits the encoded signal is divided into four signal parts and the four signal parts are output. As a result the light emitter changes in luminance according to the outputted four signal parts and these four signal parts are transmitted in the form of visible light signals and received by the receiver. As the number of bits in an output signal increases the level of difficulty for the receiver to properly receive the signal by imaging increases meaning that the reception efficiency is reduced. Therefore it is desirable that the signal have a small number of bits that is a signal be divided into small signals. However when a signal is too finely divided into many small signals the receiver cannot receive the original signal unless it receives all the small signals individually meaning that the reception efficiency is reduced. Therefore when the number of bits in the encoded signal is in the range of 24 bits to 64 bits the encoded signal is divided into four signal parts and the four signal parts are sequentially output as described above. By doing so the encoded signal representing the information to be transmitted can be transmitted in the form of a visible light signal with the best reception efficiency. As a result it is possible to enable communication between various devices.

In the output step SA it may be that the four signal parts are output in a first sequence and then the four signal parts are output in a second sequence different from the first sequence.

By doing so since these four signals parts are repeatedly output in different sequences these four signal parts can be received with still higher efficiency when each of the output signals is transmitted to the receiver in the form of a visible light signal. In other words if the four signal parts are repeatedly output in the same sequence there are cases where the receiver fails to receive the same signal part but it is possible to reduce these cases by changing the output sequence.

Furthermore the four signal parts may be each assigned with a notification operation identifier and output in the output step SA as indicated in . The notification operation identifier is an identifier for identifying an operation of the receiver by which a user using the receiver is notified that the four signal parts have been received when the four signal parts have been transmitted by way of luminance change and received by the receiver.

With this in the case where the notification operation identifier is transmitted in the form of a visible light signal and received by the receiver the receiver can notify a user of the reception of the four signal parts according to an operation identified by the notification operation identifier. This means that a transmitter that transmits information to be transmitted can set a notification operation to be performed by a receiver.

Furthermore the four signal parts may be each assigned with a priority identifier for identifying a priority of the notification operation identifier and output in the output step SA as indicated in .

With this in the case where the priority identifier and the notification operation identifier are transmitted in the form of visible light signals and received by the receiver the receiver can handle the notification operation identifier according to the priority identified by the priority identifier. This means that when the receiver obtained another notification operation identifier the receiver can select based on the priority one of the notification operation identified by the notification operation identifier transmitted in the form of the visible light signal and the notification operation identified by the other notification operation identifier.

This information processing apparatus A is an apparatus for causing the light emitter the light emitting unit of the above described transmitter to change in luminance according to the number of divisions illustrated in .

In other words this information processing apparatus A is an apparatus that processes information to be transmitted in order for the information to be transmitted by way of luminance change. In detail this information processing apparatus A includes an encoding unit A that encodes the information to generate an encoded signal a dividing unit that divides the encoded signal into four signal parts when a total number of bits in the encoded signal is in a range of 24 bits to 64 bits and an output unit A that sequentially outputs the four signal parts. The information processing apparatus A can produce the same advantageous effects as the above described information processing program.

This transmission and reception system includes a transmitter configured as an electronic device such as a washing machine for example a receiver configured as a smartphone for example and a communication device configured as an access point or a router.

When a start button is pressed Step S the transmitter transmits via Wi Fi Bluetooth Ethernet or the like information for connecting to the transmitter itself such as SSID password IP address MAC address or decryption key Step S and then waits for connection. The transmitter may directly transmit these pieces of information or may indirectly transmit these pieces of information. In the case of indirectly transmitting these pieces of information the transmitter transmits ID associated with these pieces of information. When the receiver receives the ID the receiver then downloads from a server or the like information associated with the ID for example.

The receiver receives the information Step S connects to the transmitter and transmits to the transmitter information for connecting to the communication device configured as an access point or a router such as SSID password IP address MAC address or decryption key Step S . The receiver registers with the communication device information for the transmitter to connect to the communication device such as MAC address IP address or decryption key to have the communication device wait for connection. Furthermore the receiver notifies the transmitter that preparation for connection from the transmitter to the communication device has been completed Step S .

The transmitter disconnects from the receiver Step S and connects to the communication device Step S . When the connection is successful Step S Y the transmitter notifies the receiver that the connection is successful via the communication device and notifies a user that the connection is successful by an indication on the display an LED state sound or the like Step S . When the connection fails Step S N the transmitter notifies the receiver that the connection fails via the visible light communication and notifies a user that the connection fails using the same means as in the case where the connection is successful Step S . Note that the visible light communication may be used to notify that the connection is successful.

The receiver connects to the communication device Step S and when the notifications to the effect that the connection is successful and that the connection fails Step S N and Step S N are absent the receiver checks whether or not the transmitter is accessible via the communication device Step S . When the transmitter is not accessible Step S N the receiver determines whether or not no less than a predetermined number of attempts to connect to the transmitter using the information received from the transmitter have been made Step S . When determining that the number of attempts is less than the predetermined number Step S N the receiver repeats the processes following Step S. In contrast when the number of attempts is no less than the predetermined number Step S Y the receiver notifies a user that the processing fails Step S . When determining in Step S that the notification to the effect that the connection is successful is present Step S Y the receiver notifies a user that the processing is successful Step S . Specifically using an indication on the display sound or the like the receiver notifies a user whether or not the connection from the transmitter to the communication device has been successful. By doing so it is possible to connect the transmitter to the communication device without requiring for cumbersome input from a user.

Next registration of a network connection of an electronic device in the case of connection via another electronic device is described.

This transmission and reception system includes an air conditioner a transmitter configured as an electronic device such as a wireless adaptor or the like connected to the air conditioner a receiver configured as a smartphone for example a communication device configured as an access point or a router and another electronic device configured as a wireless adaptor a wireless access point a router or the like for example.

First when a start button is pressed Step S the electronic device A transmits information for connecting to the electronic device A itself such as individual ID password IP address MAC address or decryption key Step S and then waits for connection Step S . The electronic device A may directly transmit these pieces of information or may indirectly transmit these pieces of information in the same manner as described above.

The receiver receives the information from the electronic device A Step S and transmits the information to the electronic device B Step S . When the electronic device B receives the information Step S the electronic device B connects to the electronic device A according to the received information Step S . The electronic device B determines whether or not connection to the electronic device A has been established Step S and notifies the receiver of the result Step or Step S .

When the connection to the electronic device B is established within a predetermine time Step S Y the electronic device A notifies the receiver that the connection is successful via the electronic device B Step S and when the connection fails Step S N the electronic device A notifies the receiver that the connection fails via the visible light communication Step S . Furthermore using an indication on the display a light emitting state sound or the like the electronic device A notifies a user whether or not the connection is successful. By doing so it is possible to connect the electronic device A the transmitter to the electronic device B the electronic device without requiring for cumbersome input from a user. Note that the air conditioner and the transmitter illustrated in may be integrated together and likewise the communication device and the electronic device illustrated in may be integrated together.

This transmission and reception system includes a receiver configured as a digital still camera or a digital video camera for example and a transmitter configured as a lighting for example.

First the receiver transmits an imaging information transmission instruction to the transmitter Step S . Next when the transmitter receives the imaging information transmission instruction when an imaging information transmission button is pressed when an imaging information transmission switch is ON or when a power source is turned ON Step S Y the transmitter transmits imaging information Step S . The imaging information transmission instruction is an instruction to transmit imaging information. The imaging information indicates a color temperature a spectrum distribution illuminance or luminous intensity distribution of a lighting for example. The transmitter may directly transmit the imaging information or may indirectly transmit the imaging information. In the case of indirectly transmitting the imaging information the transmitter transmits ID associated with the imaging information. When the receiver receives the ID the receiver then downloads from a server or the like the imaging information associated with the ID for example. At this time the transmitter may transmit a method for transmitting a transmission stop instruction to the transmitter itself e.g. a frequency of radio waves infrared rays or sound waves for transmitting a transmission stop instruction or SSID password or IP address for connecting to the transmitter itself .

When the receiver receives the imaging information Step S the receiver transmits the transmission stop instruction to the transmitter Step S . When the transmitter receives the transmission stop instruction from the receiver Step S the transmitter stops transmitting the imaging information and uniformly emits light Step S .

Furthermore the receiver sets an imaging parameter according to the imaging information received in Step S Step S or notifies a user of the imaging information. The imaging parameter is for example white balance an exposure time a focal length sensitivity or a scene mode. With this it is possible to capture an image with optimum settings according to a lighting. Next after the transmitter stops transmitting the imaging information Step S Y the receiver captures an image Step S . Thus it is possible to capture an image while a subject does not change in brightness for signal transmission. Note that after Step S the receiver may transmit to the transmitter a transmission start instruction to request to start transmission of the imaging information Step S .

For example a transmitter configured as a charger includes a light emitting unit and transmits from the light emitting unit a visible light signal indicating a state of charge of a battery. With this a costly display device is not needed to allow a user to be notified of a state of charge of the battery. When a small LED is used as the light emitting unit the visible light signal cannot be received unless an image of the LED is captured from a nearby position. In the case of a transmitter which has a protrusion near the LED the protrusion becomes an obstacle for closeup of the LED. Therefore it is easier to receive a visible light signal from the transmitter having no protrusion near the LED than a visible light signal from the transmitter

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED or an organic EL in each of the embodiments described above.

When an error occurs the transmitter transmits a signal indicating that an error has occurred or a signal corresponding to an error code so that the receiver can be notified that an error has occurred or of details of an error. The receiver takes an appropriate measure according to details of an error so that the error can be corrected or the details of the error can be properly reported to a service center.

In the demo mode the transmitter transmits a demo code. With this during a demonstration of a transmitter as a product in a store for example a customer can receive a demo code and obtain a product description associated with the demo code. Whether or not the transmitter is in the demo mode can be determined based on the fact that the transmitter is set to the demo mode that a CAS card for the store is inserted that no CAS card is inserted or that no recording medium is inserted.

For example when a transmitter configured as a remote controller of an air conditioner receives main unit information the transmitter transmits the main unit information so that the receiver can receive from the nearby transmitter the information on the distant main unit. The receiver can receive information from a main unit located at a site where the visible light communication is unavailable for example across a network.

Next a process of transmitting information only when the transmitter is in a bright place is described.

The transmitter transmits information when the brightness in its surrounding area is no less than a predetermined level and stops transmitting information when the brightness falls below the predetermined level. By doing so for example a transmitter configured as an advertisement on a train can automatically stop its operation when the car enters a train depot. Thus it is possible to reduce battery power consumption.

Next content distribution according to an indication on the transmitter changes in association and scheduling is described.

The transmitter associates with a transmission ID content to be obtained by the receiver in line with the timing at which the content is displayed. Every time the content to be displayed is changed a change in the association is registered with the server.

When the timing at which the content to be displayed is displayed is known the transmitter sets the server so that other content is transmitted to the receiver according to the timing of a change in the content to be displayed. When the server receives from the receiver a request for content associated with the transmission ID the server transmits to the receiver corresponding content according to the set schedule.

By doing so for example when content displayed by a transmitter configured as a digital signage changes one after another the receiver can obtain content that corresponds to the content displayed by the transmitter.

Next content distribution corresponding to what is displayed by the transmitter synchronization using a time point is described.

The server holds previously registered settings to transfer different content at each time point in response to a request for content associated with a predetermined ID.

The transmitter synchronizes the server with a time point and adjusts timing to display content so that a predetermined part is displayed at a predetermined time point.

By doing so for example when content displayed by a transmitter configured as a digital signage changes one after another the receiver can obtain content that corresponds to the content displayed by the transmitter.

Next content distribution corresponding to what is displayed by the transmitter transmission of a display time point is described.

The transmitter transmits in addition to the ID of the transmitter a display time point of content being displayed. The display time point of content is information with which the content currently being displayed can be identified and can be represented by an elapsed time from a start time point of the content for example.

The receiver obtains from the server content associated with the received ID and displays the content according to the received display time point. By doing so for example when content displayed by a transmitter configured as a digital signage changes one after another the receiver can obtain content that corresponds to the content displayed by the transmitter.

Furthermore the receiver displays content while changing the content with time. By doing so even when content being displayed by the transmitter changes there is no need to renew signal reception to display content corresponding to displayed content.

In the case where a user has a registered account the receiver transmits to the server the received ID and information to which the user granted access upon registering the account or other occasions such as position telephone number ID installed applications etc. of the receiver or age sex occupation preferences etc. of the user .

In the case where a user has no registered account the above information is transmitted likewise to the server when the user has granted uploading of the above information and when the user has not granted uploading of the above information only the received ID is transmitted to the server.

With this a user can receive content suitable to a reception situation or own personality and as a result of obtaining information on a user the server can make use of the information in data analysis.

The receiver obtains from the server content associated with the received ID. When an application currently running supports the obtained content the application can displays or reproduces the obtained content the obtained content is displayed or reproduced using the application currently running. When the application does not support the obtained content whether or not any of the applications installed on the receiver supports the obtained content is checked and when an application supporting the obtained content has been installed the application is started to display and reproduce the obtained content. When all the applications installed do not support the obtained content an application supporting the obtained content is automatically installed or an indication or a download page is displayed to prompt a user to install an application supporting the obtained content for example and after the application is installed the obtained content is displayed and reproduced.

The receiver obtains from the server content associated with the received ID and information designating an application to be started an application ID . When the application currently running is a designated application the obtained content is displayed and reproduced. When a designated application has been installed on the receiver the designated application is started to display and reproduce the obtained content. When the designated application has not been installed the designated application is automatically installed or an indication or a download page is displayed to prompt a user to install the designated application for example and after the designated application is installed the obtained content is displayed and reproduced.

The receiver may be designed to obtain only the application ID from the server and start the designated application.

The receiver may be configured with designated settings. The receiver may be designed to start the designated application when a designated parameter is set.

When a predetermined address of the received data has a predetermined value or when the received data contains a predetermined identifier the receiver determines that signal transmission is streaming distribution and receives signals by a streaming data reception method. Otherwise a normal reception method is used to receive the signals.

By doing so signals can be received regardless of which method streaming distribution or normal distribution is used to transmit the signals.

When the value of the received ID is within a predetermined range or when the received ID contains a predetermined identifier the receiver refers to a table in an application and when the table has the reception ID content indicated in the table is obtained. Otherwise content identified by the reception ID is obtained from the server.

By doing so it is possible to receive content without registration with the server. Furthermore response can be quick because no communication is performed with the server.

The receiver detects a signal and recognizes a modulation frequency of the signal. The receiver sets an exposure time according to a period of the modulation frequency a modulation period . For example the exposure time is set to a value substantially equal to the modulation frequency so that signals can be more easily received. When the exposure time is set to an integer multiple of the modulation frequency or an approximate value roughly plus minus 30 thereof for example convolutional decoding can facilitate reception of signals.

The receiver transmits to the server data received from the transmitter and current position information information related to a user address sex age preferences etc. and the like. The server transmits to the receiver a parameter for the optimum operation of the transmitter according to the received information. The receiver sets the received parameter in the transmitter when possible. When not possible the parameter is displayed to prompt a user to set the parameter in the transmitter.

With this it is possible to operate a washing machine in a manner optimized according to the nature of water in a district where the transmitter is used or to operate a rice cooker in such a way that rice is cooked in an optimal way for the kind of rice used by a user for example.

Information to be transmitted contains an identifier the value of which shows to the receiver a structure of a part following the identifier. For example it is possible to identify a length of data kind and length of an error correction code a dividing point of data and the like.

This allows the transmitter to change the kind and length of data body the error correction code and the like according to characteristics of the transmitter a communication path and the like. Furthermore the transmitter can transmit a content ID in addition to an ID of the transmitter to allow the receiver to obtain an ID corresponding to the content ID.

This embodiment describes each example of application using a receiver such as a smartphone and a transmitter for transmitting information as a blink pattern of an LED or an organic EL device in each of the embodiments described above.

A transmitter in this embodiment is configured as a backlight of a liquid crystal display for example and includes a blue LED and a phosphor including a green phosphorus element and a red phosphorus element .

The blue LED emits blue B light. When the phosphor receives as excitation light the blue light emitted by the blue LED the phosphor produces yellow Y luminescence. That is the phosphor emits yellow light. In detail since the phosphor includes the green phosphorus element and the red phosphorus element the phosphor emits yellow light by the luminescence of these phosphorus elements. When the green phosphorus element out of these two phosphorus elements receives as excitation light the blue light emitted by the blue LED the green phosphorus element produces green luminescence. That is the green phosphorus element emits green G light. When the red phosphorus element out of these two phosphorus elements receives as excitation light the blue light emitted by the blue LED the red phosphorus element produces red luminescence. That is the red phosphorus element emits red R light. Thus each light of RGB or Y RG B is emitted with the result that the transmitter outputs white light as a backlight.

This transmitter transmits a visible light signal of white light by changing luminance of the blue LED as in each of the above embodiments. At this time the luminance of the white light is changed to output a visible light signal having a predetermined carrier frequency.

A barcode reader emits red laser light to a barcode and reads a barcode based on a change in the luminance of the red laser light reflected off the barcode. There is a case where a frequency of this red laser light used to read the barcode is equal or approximate to a carrier frequency of a visible light signal outputted from a typical transmitter that has been in practical use today. In this case an attempt by the barcode reader to read the barcode irradiated with white light i.e. a visible light signal transmitted from the typical transmitter may fail due to a change in the luminance of red light included in the white light. In short an error occurs in reading a barcode due to interference between the carrier frequency of a visible light signal in particular red light and the frequency used to read the barcode.

In order to prevent this in this embodiment the red phosphorus element includes a phosphorus material having higher persistence than the green phosphorus element . This means that in this embodiment the red phosphorus element changes in luminance at a sufficiently lower frequency than a luminance change frequency of the blue LED and the green phosphorus element . In other words the red phosphorus element reduces the luminance change frequency of a red component included in the visible light signal.

Blue light being outputted from the blue LED is included in the visible light signal as illustrated in a in . The green phosphorus element receives the blue light from the blue LED and produces green luminescence as illustrated in b in . This green phosphorus element has low persistence. Therefore when the blue LED changes in luminance the green phosphorus element emits green light that changes in luminance at substantially the same frequency as the luminance change frequency of the blue LED that is the carrier frequency of the visible light signal .

The red phosphorus element receives the blue light from the blue LED and produces red luminescence as illustrated in c in . This red phosphorus element has high persistence. Therefore when the blue LED changes in luminance the red phosphorus element emits red light that changes in luminance at a lower frequency than the luminance change frequency of the blue LED that is the carrier frequency of the visible light signal .

When the blue LED is ON without changing in luminance for example the green phosphorus element emits green light having intensity I Iwithout changing in luminance i.e. light having a luminance change frequency f 0 . Furthermore even when the blue LED changes in luminance at a low frequency the green phosphorus element emits green light that has intensity I Iand changes in luminance at frequency f that is substantially the same as the low frequency. In contrast when the blue LED changes in luminance at a high frequency the intensity I of the green light emitted from the green phosphorus element that changes in luminance at the frequency f that is substantially the same as the high frequency is lower than intensity Idue to influence of an afterglow of the green phosphorus element . As a result the intensity I of green light emitted from the green phosphorus element continues to be equal to I I I when the frequency f of luminance change of the light is less than a threshold f and is gradually lowered when the frequency f increases over the threshold fas indicated by a dotted line in .

Furthermore in this embodiment persistence of the red phosphorus element is higher than persistence of the green phosphorus element . Therefore the intensity I of red light emitted from the red phosphorus element continues to be equal to I I I when the frequency f of luminance change of the light is less than a threshold flower than the above threshold f and is gradually lowered when the frequency f increases over the threshold fas indicated by a solid line in . In other words the red light emitted from the red phosphorus element is not seen in a high frequency region but is seen only in a low frequency region of a frequency band of the green light emitted from the green phosphorus element .

More specifically the red phosphorus element in this embodiment includes a phosphorus material with which the red light emitted at the frequency f that is the same as the carrier frequency fof the visible light signal has intensity I I. The carrier frequency fis a carrier frequency of luminance change of the blue light LED included in the transmitter. The above intensity Iis one third intensity of the intensity Ior I 10 dB intensity. For example the carrier frequency fis 10 kHz or in the range of 5 kHz to 100 kHz.

In detail the transmitter in this embodiment is a transmitter that transmits a visible light signal and includes a blue LED that emits as light included in the visible light signal blue light changing in luminance a green phosphorus element that receives the blue light and emits green light as light included in the visible light signal and a red phosphorus element that receives the blue light and emits red light as light included in the visible light signal. Persistence of the red phosphorus element is higher than persistence of the green phosphorus element. Each of the green phosphorus element and the red phosphorus element may be included in a single phosphor that receives the blue light and emits yellow light as light included in the visible light signal. Alternatively it may be that the green phosphorus element is included in a green phosphor and the red phosphorus element is included in a red phosphor that is separate from the green phosphor.

This allows the red light to change in luminance at a lower frequency than a frequency of luminance change of the blue light and the green light because the red phosphorus element has higher persistence. Therefore even when the frequency of luminance change of the blue light and the green light included in the visible light signal of the white light is equal or approximate to the frequency of red laser light used to read a barcode the frequency of the red light included in the visible light signal of the white light can be significantly different from the frequency used to read a barcode. As a result it is possible to reduce the occurrences of errors in reading a barcode.

The red phosphorus element may emit red light that changes in luminance at a lower frequency than a luminance change frequency of the light emitted from the blue LED.

Furthermore the red phosphorus element may include a red phosphorus material that receives blue light and emits red light and a low pass filter that transmits only light within a predetermined frequency band. For example the low pass filter transmits out of the blue light emitted from the blue LED only light within a low frequency band so that the red phosphorus material is irradiated with the light. Note that the red phosphorus material may have the same persistence properties as the green phosphorus element. Alternatively the low pass filter transmits only light within a low frequency band out of the red light emitted from the red phosphorus material as a result of the red phosphorus material being irradiated with the blue light emitted from the blue LED. Even when the low pass filter is used it is possible to reduce the occurrences of errors in reading a barcode as in the above mentioned case.

Furthermore the red phosphor element may be made of a phosphor material having a predetermined persistence property. For example the predetermined persistence property is such that assume that a Iis intensity of the red light emitted from the red phosphorus element when a frequency f of luminance change of the red light is 0 and b fis a carrier frequency of luminance change of the light emitted from the blue LED the intensity of the red light is not greater than one third of Ior I 10 dB when the frequency f of the red light is equal to f f f .

With this the frequency of the red light included in the visible light signal can be reliably significantly different from the frequency used to read a barcode. As a result it is possible to reliably reduce the occurrences of errors in reading a barcode.

With this since the carrier frequency actually used to transmit the visible light signal today is 9.6 kHz it is possible to effectively reduce the occurrences of errors in reading a barcode during such actual transmission of the visible light signal.

With the advancement of an image sensor an imaging element of the receiver that receives the visible light signal a carrier frequency of 20 kHz 40 kHz 80 kHz 100 kHz or the like is expected to be used in future visible light communication. Therefore as a result of setting the above carrier frequency fto approximately 5 kHz to 100 kHz it is possible to effectively reduce the occurrences of errors in reading a barcode even in future visible light communication.

Note that in this embodiment the above advantageous effects can be produced regardless of whether the green phosphorus element and the red phosphorus element are included in a single phosphor or these two phosphor elements are respectively included in separate phosphors. This means that even when a single phosphor is used respective persistence properties that is frequency characteristics of red light and green light emitted from the phosphor are different from each other. Therefore the above advantageous effects can be produced even with the use of a single phosphor in which the persistence property or frequency characteristic of red light is lower than the persistence property or frequency characteristic of green light. Note that lower persistence property or frequency characteristic means higher persistence or lower light intensity in a high frequency band and higher persistence property or frequency characteristic means lower persistence or higher light intensity in a high frequency band.

Although the occurrences of errors in reading a barcode are reduced by reducing the luminance change frequency of the red component included in the visible light signal in the example illustrated in the occurrences of errors in reading a barcode may be reduced by increasing the carrier frequency of the visible light signal.

As illustrated in when the carrier frequency fof the visible light signal is about 10 kHz the frequency of red laser light used to read a barcode is also about 10 kHz to 20 kHz with the result that these frequencies are interfered with each other causing an error in reading the barcode.

Therefore the carrier frequency fof the visible light signal is increased from about 10 kHz to for example 40 kHz so that the occurrences of errors in reading a barcode can be reduced.

However when the carrier frequency fof the visible light signal is about 40 kHz a sampling frequency ffor the receiver to sample the visible light signal by capturing an image needs to be 80 kHz or more.

In other words since the sampling frequency frequired by the receiver is high an increase in the processing load on the receiver occurs as a new problem. Therefore in order to solve this new problem the receiver in this embodiment performs downsampling.

A transmitter in this embodiment is configured as a liquid crystal display a digital signage or a lighting device for example. The transmitter outputs a visible light signal the frequency of which has been modulated. At this time the transmitter switches the carrier frequency fof the visible light signal between 40 kHz and 45 kHz for example.

A receiver in this embodiment captures images of the transmitter at a frame rate of 30 fps for example. At this time the receiver captures the images with a short exposure time so that a bright line appears in each of the captured images specifically frames as with the receiver in each of the above embodiments. An image sensor used in the imaging by the receiver includes 1 000 exposure lines for example. Therefore upon capturing one frame each of the 1 000 exposure lines starts exposure at different timings to sample a visible light signal. As a result the sampling is performed 30 000 times 30 fps 1 000 lines per second 30 ks sec . In other words the sampling frequency fof the visible light signal is 30 kHz.

According to a general sampling theorem only the visible light signals having a carrier frequency of 15 kHz or less can be demodulated at the sampling frequency fof 30 kHz.

However the receiver in this embodiment performs downsampling of the visible light signals having a carrier frequency fof 40 kHz or 45 kHz at the sampling frequency fof 30 kHz. This downsampling causes aliasing on the frames. The receiver in this embodiment observes and analyzes the aliasing to estimate the carrier frequency fof the visible light signal.

First the receiver captures an image of a subject and performs downsampling of the visible light signal of a carrier frequency fof 40 kHz or 45 kHz at a sampling frequency fof 30 kHz Step S .

Next the receiver observes and analyzes aliasing on a resultant frame caused by the downsampling Step S . By doing so the receiver identifies a frequency of the aliasing as for example 5.1 kHz or 5.5 kHz.

The receiver then estimates the carrier frequency fof the visible light signal based on the identified frequency of the aliasing Step S . That is the receiver restores the original frequency based on the aliasing. Here the receiver estimates the carrier frequency fof the visible light signal as for example 40 kHz or 45 kHz.

Thus the receiver in this embodiment can appropriately receive the visible light signal having a high carrier frequency by performing downsampling and restoring the frequency based on aliasing. For example the receiver can receive the visible light signal of a carrier frequency of 30 kHz to 60 kHz even when the sampling frequency fis 30 kHz. Therefore it is possible to increase the carrier frequency of the visible light signal from a frequency actually used today about 10 kHz to between 30 kHz and 60 kHz. As a result the carrier frequency of the visible light signal and the frequency used to read a barcode 10 kHz to 20 kHz can be significantly different from each other so that interference between these frequencies can be reduced. As a result it is possible to reduce the occurrences of errors in reading a barcode.

A reception method in this embodiment is a reception method of obtaining information from a subject the reception method including setting an exposure time of an image sensor so that in a frame obtained by capturing the subject by the image sensor a plurality of bright lines corresponding to a plurality of exposure lines included in the image sensor appear according to a change in luminance of the subject capturing the subject changing in luminance by the image sensor at a predetermined frame rate and with the set exposure time by repeating starting exposure sequentially for the plurality of the exposure lines in the image sensor each at a different time and obtaining the information by demodulating for each frame obtained by the capturing data specified by a pattern of the plurality of the bright lines included in the frame. In the capturing sequential starts of exposure for the plurality of exposure lines each at a different time are repeated to perform on the visible light signal transmitted from the subject changing in luminance downsampling at a sampling frequency lower than a carrier frequency of the visible light signal. In the obtaining for each frame obtained by the capturing a frequency of aliasing specified by a pattern of the plurality of bright lines included in the frame is identified a frequency of the visible light signal is estimated based on the identified frequency of the aliasing and the estimated frequency of the visible light signal is demodulated to obtain the information.

With this reception method it is possible to appropriately receive the visible light signal having a high carrier frequency by performing downsampling and restoring the frequency based on aliasing.

The downsampling may be performed on the visible light signal having a carrier frequency higher than 30 kHz. This makes it possible to avoid interference between the carrier frequency of the visible light signal and the frequency used to read a barcode 10 kHz to 20 kHz so that the occurrences of errors in reading a barcode can be effectively reduced.

A reception device receives visible light emitted by a transmission device including a plurality of light sources four light sources in .

First when shifted to a mode for visible light communication the reception device starts an imaging unit in the normal imaging mode S . Note that when shifted to the mode for visible light communication the reception device displays on a screen a box for capturing images of the light sources.

After a predetermined time the reception device switches an imaging mode of the imaging unit to the macro imaging mode S . Note that the timing of switching from Step S to Step S may be instead of when a predetermined time has elapsed after Step S when the reception device determines that images of the light sources have been captured in such a way that they are included within the box . Such switching to the macro imaging mode allows a user to include the light sources into the box in a clear image in the normal imaging mode before shifted to the macro imaging mode in which the image is blurred and thus it is possible to easily include the light sources into the box .

Next the reception device determines whether or not a signal from the light source has been received S . When it is determined that a signal from the light source has been received S Yes the processing returns to Step S in the normal imaging mode and when it is determined that a signal from the light sources has not been received S No the macro imaging mode in Step continues. Note that when Yes in Step S a process based on the received signal e.g. a process of displaying an image represented by the received signal may be performed.

With this reception device a user can switch from the normal imaging mode to the macro imaging mode by touching with a finger a display unit of a smartphone where light sources appear to capture an image of the light sources that appear blurred. Thus an image captured in the macro imaging mode includes a larger number of bright regions than an image captured in the normal imaging mode. In particular light beams from two adjacent light sources among the plurality of the light source cannot be received as continuous signals because striped images are separate from each other as illustrated in the left view in a in . However this problem can be solved when the light beams from the two light sources overlap each other allowing the light beams to be handled upon demodulation as continuously received signals that are to be continuous striped images as illustrated in the right view in a in . Since a long code can be received at a time this produces an advantageous effect of shortening response time. As illustrated in b in an image is captured with a normal shutter and a normal focal point first resulting in a normal image which is clear. However when the light sources are separate from each other like characters even an increase in shutter speed cannot result in continuous data leading to a demodulation failure. Next the shutter speed is increased and a driver for lens focus is set to close up macro with the result that the four light sources are blurred and expanded to be connected to each other so that the data can be received. Thereafter the focus is set back to the original one and the shutter speed is set back to normal to capture a clear image. Clear images are recorded in a memory and are displayed on the display unit as illustrated in c . This produces an advantageous effect in that only clear images are displayed on the display unit. As compared to an image captured in the normal imaging mode an image captured in the macro imaging mode includes a larger number of regions brighter than predetermined brightness. Thus in the macro imaging mode it is possible to increase the number of exposure lines that can generate bright lines for the subject.

A reception device receives visible light emitted by a transmission device including a plurality of light sources four light sources in .

First when shifted to a mode for visible light communication the reception device starts an imaging unit in the normal imaging mode and captures an image of a wider range than an image displayed on a screen of the reception device . Image data and orientation information are held in a memory S . The image data represent the image captured. The orientation information indicates an orientation of the reception device detected by a gyroscope a geomagnetic sensor and an accelerometer included in the reception device when the image is captured. The image captured is an image the range of which is greater by a predetermined width in the vertical direction or the horizontal direction with reference to the image displayed on the screen of the reception device When shifted to the mode for visible light communication the reception device displays on the screen a box for capturing images of the light sources.

After a predetermined time the reception device switches an imaging mode of the imaging unit to the macro imaging mode S . Note that the timing of switching from Step S to Step S may be instead of when a predetermined time has elapsed after Step S when the image is captured and it is determined that image data representing the image captured has been held in the memory. At this time the reception device displays out of the image an image having a size corresponding to the size of the screen of the reception device based on the image data held in the memory.

Note that the image displayed on the reception device at this time is a part of the image that corresponds to a region predicted to be currently captured by the reception device based on a difference between an orientation of the reception device represented by the orientation information obtained in Step a position indicated by a white broken line and a current orientation of the reception device . In short the image is an image that is a part of the image and is of a region corresponding to an imaging target of an image actually captured in the macro imaging mode. Specifically in Step an orientation an imaging direction changed from that in Step S is obtained an imaging target predicted to be currently captured is identified based on the obtained current orientation imaging direction the image that corresponds to the current orientation imaging direction is identified based on the image captured in advance and a process of displaying the image is performed. Therefore when the reception device moves in a direction of a void arrow from the position indicated by the white broken line as illustrated in the image in the reception device can determine according to an amount of the movement a region of the image that is to be clipped out as the image and display the image that is a determined region of the image .

By doing so even when capturing an image in the macro imaging mode the reception device can display without displaying the image captured in the macro imaging mode the image clipped out of a clearer image i.e. the image captured in the normal imaging mode according to a current orientation of the reception device . In a method in the present disclosure in which using a blurred image continuous pieces of visible light information are obtained from a plurality of light sources distant from each other and at the same time a stored normal image is displayed on the display unit the following problem is expected to occur when a user captures an image using a smartphone a hand shake may result in an actually captured image and a still image displayed from the memory being different in direction making it impossible for the user to adjust the direction toward target light sources. In this case data from the light sources cannot be received. Therefore a measure is necessary. With an improved technique in the present disclosure even when a hand shake occurs an oscillation detection unit such as an image oscillation detection unit or an oscillation gyroscope detects the hand shake and a target image in a still image is shifted in a predetermined direction so that a user can view a difference from a direction of the camera. This display allows a user to direct the camera to the target light sources making it possible to capture an optically connected image of separated light sources while displaying a normal image and thus it is possible to continuously receive signals. With this signals from separated light sources can be received while a normal image is displayed. In this case it is easy to adjust an orientation of the reception device in such a way that images of the plurality of light sources can be included in the box . Note that defocusing means light source dispersion causing a reduction in luminance to an equivalent degree and therefore sensitivity of a camera such as ISO is increased to produce an advantageous effect in that visible light data can be more reliably received.

Next the reception device determines whether or not a signal from the light sources has been received S . When it is determined that a signal from the light sources has been received S Yes the processing returns to Step S in the normal imaging mode and when it is determined that a signal from the light sources has not been received S No the macro imaging mode in Step continues. Note that when Yes in Step S a process based on the received signal e.g. a process of displaying an image represented by the received signal may be performed.

As in the case of the reception device this reception device can also capture an image including a brighter region in the macro imaging mode. Thus in the macro imaging mode it is possible to increase the number of exposure lines that can generate bright lines for the subject.

A transmission device is for example a display device such as a television and transmits different transmission IDs at predetermined time intervals by visible light communication. Specifically transmission IDs i.e. ID ID ID and ID associated with data corresponding to respective images and to be displayed at time points t t t and t are transmitted. In short the transmission device transmits the ID to ID one after another at the predetermined time intervals .

Based on the transmission IDs received by the visible light communication a reception device requests a server for data associated with each of the transmission IDs receives the data from the server and displays images corresponding to the data. Specifically images and corresponding to the ID ID ID and ID respectively are displayed at the time points t t t and t.

When the reception device obtains the ID received at the time point t the reception device may obtain from the server ID information indicating transmission IDs scheduled to be transmitted from the transmission device at the following time points t to t. In this case the use of the obtained ID information allows the reception device to be saved from receiving a transmission ID from the transmission device each time that is to request the server for the data associated with the ID to ID for time points t to and display the received data at the time points t to .

Furthermore it may be that when the reception device requests the data corresponding to the ID at the time point t even if the reception device does not obtain from the server information indicating transmission IDs scheduled to be transmitted from the transmission device at the following time points t to t the reception device receives from the server the data associated with the transmission IDs corresponding to the following time points t to t and displays the received data at the time points t to t. To put it differently in the case where the server receives from the reception device a request for the data associated with the ID transmitted at the time point t the server transmits even without requests from the reception device for the data associated with the transmission IDs corresponding to the following time points t to t the data to the reception device at the time points t to t. This means that in this case the server holds association information indicating association between the time points t to t and the data associated with the transmission IDs corresponding to the time points t to t and transmits at a predetermined time predetermined data associated with the predetermined time point based on the association information.

Thus once the reception device successfully obtains the transmission ID at the time point t by visible light communication the reception device can receive at the following time points t to t the data corresponding to the time points t to t from the server even without performing visible light communication. Therefore a user no longer needs to keep directing the reception device to the transmission device to obtain a transmission ID by visible light communication and thus the data obtained from the server can be easily displayed on the reception device . In this case when the reception device obtains data corresponding to an ID from the server each time response time will be long due to time delay from the server. Therefore in order to accelerate the response data corresponding to an ID is obtained from the server or the like and stored into a storage unit of the receiver in advance so that the data corresponding to the ID in the storage unit is displayed. This can shorten the response time. In this way when a transmission signal from a visible light transmitter contains time information on output of a next ID the receiver does not have to continuously receive visible light signals because a transmission time of the next ID can be known at the time which produces an advantageous effect in that there is no need to keep directing the reception device to the light source. An advantageous effect of this way is that when visible light is received it is only necessary to synchronize time information clock in the transmitter with time information clock in the receiver meaning that after the synchronization images synchronized with the transmitter can be continuously displayed even when no data is received from the transmitter.

Furthermore in the above described example the reception device displays the images and corresponding to respective transmission IDs i.e. the ID ID ID and ID at the respective time points t t t and t. Here the reception device may present information other than images at the respective time points as illustrated in . Specifically at the time point t the reception device displays the image corresponding to the ID and moreover outputs sound or audio corresponding to the ID. At this time the reception device may further display for example a purchase website for a product appearing in the image. Such sound output and displaying of a purchase website are performed likewise at each of the time points other than the time point t i.e. the time points t and .

Next in the case of a smartphone including two cameras left and right cameras for stereoscopic imaging as illustrated in b in the left eye camera displays an image of normal quality with a normal shutter speed and a normal focal point and at the same time the right eye camera uses a higher shutter speed and or a closer focal point or a macro imaging mode as compared to the left eye camera to obtain striped bright lines according to the present disclosure and demodulates data. This has an advantageous effect in that an image of normal quality is displayed on the display unit while the right eye camera can receive light communication data from a plurality of separate light sources that are distant from each other.

A transmission packet is made up of a preamble TYPE a payload and a check unit. Packets may be continuously transmitted or may be intermittently transmitted. With a period in which no packet is transmitted it is possible to change the state of liquid crystals when the backlight is turned off to improve the sense of dynamic resolution of the liquid crystal display. When the packets are transmitted at random intervals signal interference can be avoided.

For the preamble a pattern that does not appear in the 4 PPM is used. The reception process can be facilitated with the use of a short basic pattern. With the basis pattern placed in a rear part as illustrated in b and c in a packet can be received even when a short section is received. When the first bit and the last bit of the preamble are 1 a high luminance state like in c in the preamble can be received with accuracy.

The kind of the preamble is used to represent the number of divisions in data so that the number of divisions in data can be made variable without unnecessarily using a transmission slot.

When the payload length varies according to the value of the TYPE it is possible to make the transmission data variable. In the TYPE the payload length may be represented or the data length before division may be represented. When a value of the TYPE represents an address of a packet the receiver can correctly arrange received packets. Since a required length of the address is different according to the number of divisions the length of the TYPE may vary according to the number of divisions as illustrated in c in . Furthermore the payload length the data length that is represented by a value of the TYPE may vary according to the kind of the preamble the number of divisions and the like.

When the length of the check unit varies according to the payload length efficient error correction detection is possible. When the shortest length of the check unit is set to two bits efficient conversion to the 4 PPM is possible. Furthermore when the kind of the error correction detection code varies according to the payload length error correction detection can be efficiently performed. It may also be that the length of the check unit or the kind of the error correction detection code varies according to the kind of the preamble or the value of the TYPE.

Some of different combinations of the payload and the number of divisions lead to the same data length. In such a case each combination even with the same data value is given a different meaning so that more values can be represented.

A transmission packet is made up of a preamble unit a body unit and a luminance adjustment unit. The body includes an address unit a data unit and an error correction detection code unit. When intermittent transmission is permitted the same advantageous effects as described above can be obtained.

As illustrated in luminance changes of the preamble unit having two different averages of luminance the body unit having three different averages of luminance and the luminance adjustment unit having luminance that can continuously change are combined so that the average luminance can be changed continuously as a whole. The continuous changes in luminance of the luminance adjustment unit can be achieved by changing the maximum luminance or by changing the ratio between a bright period and a dark period. Since there are two representation methods around 50 in luminance 50 may be a border of usage therebetween or the two representation methods may represent different pieces of data so that more values can be represented.

Upon reception assuming four combinations of the preamble unit and the body unit the maximum likelihood decoding is performed and a pattern having the highest likelihood is regarded as a received signal with the result that the signal can be received even when the light adjustment state is unknown.

Since the preamble unit has a small number of variations i.e. two variations of luminance changes and is a starting part of signal detection efficient signal reception is possible when the reference of luminance is determined based on this part.

When the convolution length is three the use of the preamble in makes it possible to detect the preamble as it is without convolutional decoding because of three consecutive 1 and 0.

In each luminance of the 4 PPM the state of convolution transitions as illustrated in . Through the maximum likelihood estimation in each of these patterns it is possible to receive a signal while performing convolutional decoding. The start states 000 and 111 in are not present in the end state but the end state of the preamble is one of these states. Therefore with the use of this pattern in the maximum likelihood decoding of the first four slots of the body unit the maximum likelihood decoding can be performed with accuracy.

As the sensitivity is set higher or as the exposure time is set shorter imaging accompanies more noise. Therefore it is possible to reduce the noise by increasing the number of pixels to be used to determine the average luminance within the exposure line. When the sensitivity is set to a value N times larger the number of pixels to be averaged is set to a value N squared times larger to reduce an amount of noise to the same extent. Conversely when the sensitivity is set low or the exposure time is set long the number of pixels to be averaged is reduced to reduce computational load.

When a value obtained by dividing the likelihood of the highest likelihood pass in the maximum likelihood decoding by the length of the pass is lower than a predetermined value the result of the decoding is unreliable and the decoded signal is therefore decoded. Thus it is possible to reduce reception errors.

When the likelihood in the maximum likelihood decoding is low or when error detection has been performed there is a case where a signal can be properly received after another decoding process is performed in the state where the number of pixels to be averaged is reduced so that noise is reduced. Furthermore in the same case when a pixel has a large value there is a case where a signal can be properly received after the sensitivity is set lower or the exposure time is set shorter and when a pixel has a small value there is a case where a signal can be properly received after the sensitivity is set higher or the exposure time is set longer.

Assume that when the receiver has a sampling rate that is the reciprocal of a temporal difference in exposure timing between adjacent exposure lines of f hertz a transmission frequency is Nf 2 k hertz. In this case assume that N is an integer and k

Since the barcode reader reads reflected light of a red ray removal of a red component from a visible light communication signal can lead to removal of an adverse effect on a reading operation by a barcode reader. In order to remove a red component from a visible light communication signal there is a method using a filter or a phosphor that increases an afterglow of a component that emits red light having a phase opposite to the signal and has a long wavelength for example. The receiver can properly receive a signal by receiving the signal based on luminance of light containing a green or blue component.

According to the last operation on the transmitter by a user the transmitter changes a signal to be transmitted. By doing so information on a phenomenon resulting from the operation can be transmitted or a signal that a user wishes to transmit can be transmitted.

The transmitter transmits signals only for a predetermined length of time after a user performs the last operation. This makes it possible to reduce power consumption and to assign a timer of a microcomputer to another function for example.

The transmitter transmits a signal only when the timer of the microcomputer is not used for another function. Alternatively the transmitter alternately performs functions of using the timer of the microcomputer including signal transmission. With this a small number of timers can be enough in the transmitter.

The receiver performs a different operation only during a predetermined period after predetermined data is received by visible light communication. For example within one hour after an ID is received from an advertisement sign a product or service is offered at a discounted price or a campaign item for a game can be downloaded. With this it is possible to realize an offline to online service or an offline to online to offline service.

The receiver receives setting information from the transmitter and stores into a storage of the receiver the setting information in association with identification information on the transmitter. The receiver receives identification information from the same or another transmitter and sets the associated setting information in the transmitter. The setting information may be other than something received from the transmitter for example language setting of the receiver. By doing so it is possible to quickly recover the setting of the transmitter. Furthermore settings suitable for a user can be configured in the transmitter without input from a user.

The receiver performs normal imaging and displays an image on a preview screen while a reception process continues. By doing so it is possible to display a smoother preview image without reducing the reception performance.

The receiver continuously or intermittently captures a predetermined number of visible light images stores them in the memory until processing on the captured images in a previous frame ends and sequentially performs a reception process. By doing so it is possible to complete reception even when the receiver is directed to the transmitter for a short length of time.

Although only some exemplary embodiments have been described above the scope of the Claims of the present application is not limited to these embodiments. Those skilled in the art will readily appreciate that various modifications may be made in these exemplary embodiments and that other embodiments may be obtained by arbitrarily combining the structural elements of the embodiments without materially departing from the novel teachings and advantages of the subject matter recited in the appended Claims. Accordingly all such modifications and other embodiments are included in the present disclosure.

The present disclosure is applicable to an information communication device and the like and in particular to an information communication device and the like used for a method of communication between a mobile terminal such as a smartphone a tablet terminal a mobile phone a smartwatch or a head mounted display and a home electric appliance such as an air conditioner a lighting device a rice cooker a television a recorder or a projector.

