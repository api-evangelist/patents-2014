---

title: Computer system and its event notification method
abstract: If a failure occurs in physical resources constituting a virtual volume, a management server device is notified of information required by a user. A computer system includes a server device for managing a plurality of virtual volumes, a storage apparatus having a storage unit equipped with a plurality of storage devices, and a controller for controlling data input to, or output from, the storage unit, a management server device which is an access target of a user terminal, and an event management device for managing an event(s) generated by the server device or the storage apparatus, wherein when the event management device receives the event, it judges the content of the event and identifies a virtual volume to be affected by the event; and if a service level that should be satisfied by the identified virtual volume is defined for the identified virtual volume, the event management device identifies, based on the content of the received event, whether an incident in violation of the service level has occurred or not, and then notifies the management server device of the identified content as an event based on an event filter.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09256507&OS=09256507&RS=09256507
owner: HITACHI, LTD.
number: 09256507
owner_city: Tokyo
owner_country: JP
publication_date: 20140725
---
The present invention relates to a computer system having a storage apparatus and a server device and to an event notification method for the computer system.

With a computer system having a storage apparatus and a server device real volumes composed of storage areas in storage devices are virtualized as virtual volumes and the virtualized virtual volumes are provided to a user terminal which is an access requestor. Under this circumstance a user can operate desired applications by accessing the virtual volumes using the user terminal.

A virtualization device hereinafter sometimes referred to as the virtualization mechanism for virtualizing real volumes to obtain virtual volumes is implemented in for example a server device having a hypervisor a SAN Storage Area Network switch or a storage apparatus.

Meanwhile in some case when managing virtual volumes the correspondence relationship between a plurality of real volumes and a plurality of virtual volumes is registered in a volume management table and a management server manages the correspondence relationship between each real volume and each virtual volume by using the volume management table.

There is a suggested management server designed in such a manner that when receiving failure notice at the time of the occurrence of a failure in a real volume or a virtual volume under the above described circumstance the management server refers to the volume management table based on the failure notice about the real volume or the failure notice about the virtual volume identifies the virtual volume corresponding to the real volume in which the failure occurred associates the failure notice about the virtual volume with the failure notice about the real volume and outputs information which associates the failure notice about the virtual volume with the failure notice about the real volume to a terminal of an administrator see Patent Literature 1 .

If a failure occurs in physical resources such as storage devices which constitute a virtual volume a server device for managing virtual volumes masks the failure by using an alternate storage device or an alternate path and restores the failure on the background so that applications can continue to operate.

If a failure occurs in physical resources constituting a virtual volume the conventional technology gives no consideration to provision of only information in violation of a communication service agreement entered between a service provider and a user hereinafter referred to as the Service Level Agreement SLA to a terminal of the user who uses virtual volumes.

For example if a failure occurs in physical resources constituting a virtual volume redundancy may be temporarily lost the performance of the virtual volume may degrade or the SLA may be violated depending on the fault of the storage device after the occurrence of the failure until the restoration of the failure.

Under this circumstance some user may strictly define the SLA and use virtual volumes and virtual servers on the assumption of the environment envisaged by the SLA. If a failure due to a violation of the SLA occurs it is desirable that such a user should be promptly notified of the content of the SLA violation. This is because the user may sometimes wish to deal with the SLA violation by themselves. For example if performance degradation of the virtual volume is predicted there is a possibility that the user themselves may deal with the situation by for example increasing the number of the virtual volumes or the number of the virtual servers or by using other virtual volumes whose performance is not affected.

The present invention was devised in light of the problems of the conventional technology and it is an object of the invention to provide a computer system and its event notification method capable of notifying a device which provides an access requestor with virtual volumes of information required by a user if a failure occurs in physical resources constituting a virtual volume.

In order to achieve the above described object a computer system according to the present invention includes a server device for managing a plurality of virtual volumes a storage apparatus for controlling data input to or output from a plurality of storage devices a management server device for managing the virtual volumes as access targets of an access requestor and an event management device for managing at least the server device or the storage apparatus as a management target and managing an event generated by the management target wherein when the event management device receives the event it judges the content of the event and identifies a virtual volume to be affected by the event from among the virtual volumes and if a service level that should be satisfied by the identified virtual volume is defined for the identified virtual volume the event management device identifies based on the content of the received event whether an incident in violation of the service level has occurred or not and then notifies the management server device of the identified content as an event based on an event filter.

According to the present invention it is possible to notify a device which provides an access requestor with virtual volumes of information required by a user.

Referring to a computer system includes an event notification system a storage apparatus a server device and a relay device .

The server device sends receives information to from the storage apparatus via the relay device and generates an event if a failure occurs in any of a plurality of server resources constituting the server device . This server device is equipped with a hypervisor having a function as a virtualization device and a plurality of virtual servers A B operating on the hypervisor . The event herein means an event including information indicating the content of the failure and information for identifying a failure occurrence site. Event notification can be implemented by using a trap defined by SNMP Simple Network Management Protocol . The event notification can also be implemented by using a dedicated protocol other than SNMP. Furthermore the same applies to events reported by various devices described below.

The hypervisor virtualizes a plurality of real volumes which are composed of storage areas of storage devices not shown in the storage apparatus to obtain a plurality of virtual volumes VV VV which are composed of virtual storage areas and manages the plurality of virtualized virtual volumes . Each virtual volume is managed by for example a virtual server A and a virtual server B . The virtual server A and the virtual volume VV are configured as section A resources and are managed by a section A management system .

The virtual server B and the virtual volume VV are configured as section B resources and are managed by a section B management system . Information about the section A management system is provided via a network not shown to a user terminal not shown used by the section A administrator and information about the section B management system is provided via a network not shown to a user terminal not shown used by the section B administrator .

The relay device relays information or data sent and received between the server device and the storage apparatus and if a failure occurs in any of a plurality of relay resources constituting the relay device the relay device generates an event.

The storage apparatus has a plurality of real volumes and a controller not shown for controlling data input to or output from each real volume and if a failure occurs in any of the plurality of storage resources constituting the storage apparatus the storage apparatus generates an event.

If an event is generated by any of the storage apparatus the server device or the relay device the event notification system receives the generated event judges the content of the received event and identifies a virtual volume to be affected by the generation of the event for example the virtual volume VV from among the plurality of virtual volumes .

If a service level which should be satisfied by the identified virtual volume VV is defined for the identified virtual volume VV under the above described circumstance the event notification system identifies based on the content of the received event whether an incident in violation of the defined service level has occurred or not and notifies the section A management system of the identified content as an event based on an event filter in accordance with event filter information . The definition of the service level with respect to the virtual volumes is recorded in service level information not shown . Consequently the section A administrator can recognize the occurrence of an incident in violation of the SLA by accessing the section A management system using the user terminal.

Furthermore the event notification system notifies an overall management system of the event received from the device associates this event with the event identified as described above based on the event filter to obtain an associated event and notifies the overall management system of the associated event . As a result the system administrator for managing the entire system can recognize the occurrence of an incident in violation of the service level and the content of failure information which associates this violation incident with the site where the failure occurred by operating the overall management system using a system administrator terminal not shown .

Referring to the computer system includes the event notification system the storage apparatus the server device a plurality of relay devices SW SW a resource management system the section A management server device the section B management server device and an overall management server and the respective elements are connected via an internal network . For example a LAN Local Area Network can be used as the internal network .

The event notification system has a processor a memory and a network controller any of which is not shown . If an event is generated by any of the storage apparatus the server device and the relay device the event notification system receives the generated event judges the content of the received event and identifies a virtual volume to be affected by the generation of the event for example the virtual volume VV from among the plurality of virtual volumes .

If the service level is defined for the identified virtual volume under the above described circumstance the event notification system identifies based on the received event whether an incident in violation of the defined service level has occurred or not and notifies for example the section A management system of the identified content in accordance with the event filter information .

Furthermore the event notification system notifies the overall management system of the content of the event received from the device and notifies the overall management system of the event associated with the information about the service level violation incident reported to the section A management system .

The storage apparatus has a plurality of real volumes and a controller not shown for controlling data input to or output from each real volume as well as a storage event generator not shown for generating an event s if a failure occurs in any of the plurality of storage resources constituting the storage apparatus .

Each real volume is composed of storage areas of one or more storage devices. For example HDDs Hard Disk Drives semiconductor memory devices optical disk devices magneto optical disk devices magnetic tape devices and flexible disk devices can be used as the storage devices.

If HDDs are used as the storage devices for example FC Fibre Channel disks SCSI Small Computer System Interface disks SATA Serial ATA disks ATA AT Attachment disks or SAS Serial Attached SCSI disks can be used.

Furthermore each storage device can constitute a RAID Redundant Array of Inexpensive Disks group such as RAID RAID or RAID and each storage device can be divided into a plurality of RAID groups. Under this circumstance a plurality of logical units hereinafter sometimes referred to as LUs Logical Units or a plurality of logical volumes can be formed in a physical storage area of each storage device.

The server device SV has a function sending receiving information to from the storage apparatus via the relay device and also has a function as a server event generator not shown for generating an event s if a failure occurs in any of a plurality of server resources constituting the server device . This server device is equipped with the hypervisor having a function as a virtualization device and a plurality of virtual servers VM VM operating on the hypervisor .

The hypervisor virtualizes a plurality of real volumes which are composed of storage areas of the storage devices not shown in the storage apparatus to obtain a plurality of virtual volumes which are composed of virtual storage areas and manages the plurality of virtualized virtual volumes . Each virtual volume is used by for example the plurality of virtual servers VM VM in order to store data.

The relay device has a function relaying information or data sent and received between the server device and the storage apparatus and also has a function as a relay event generator not shown for generating an event s if a failure occurs in any of a plurality of relay resources constituting the relay device .

The resource management system manages the plurality of storage resources resources including physical resources and logical resources constituting the storage apparatus the plurality of server resources resources including physical resources and logical resources constituting the server device and the plurality of relay resources resources including physical resources and logical resources constituting each relay device .

The section A management server device is connected to the user terminal not shown used by the section A administrator via the network or a network which is not shown in the drawing or the Internet and has the section A management system manage the virtual volumes and the virtual server VM which are exclusively allocated to section A. Information managed by the section A management system is provided to the user terminal used by the section A administrator via the network a network which is not shown in the drawing or the Internet. Incidentally a group of logical resources such as the virtual volumes and the virtual server which are managed exclusively by section A will be hereinafter referred to as the domain .

The section B management server device is connected to the user terminal not shown used by the section B administrator via the network or a network which is not shown in the drawing or the Internet and has the section B management system manage the virtual volumes and the virtual server VM which are exclusively allocated to section B. Information managed by the section B management system is provided to the user terminal used by the section B administrator via the network or a network which is not shown in the drawing or the Internet. Incidentally a group of logical resources such as the virtual volumes and the virtual server which are managed exclusively by section B will be hereinafter referred to as the domain .

The overall management server has the overall management system having a processor a memory and a network controller any of which is not shown manage the entire computer system. Under this circumstance the system administrator for managing the entire system can recognize information managed by the resource management system and the content of events sent from the event notification system by operating the overall management system using the system administrator terminal not shown .

Incidentally the event notification system the resource management system and the overall management server can be integrated and configured as an event management device.

Referring to the relay device SW has a plurality of power sources and a plurality of relay ports SP SP and the relay device SW has a plurality of power sources and a plurality of relay ports SP SP .

The storage apparatus is constituted from a controller a controller a plurality of storage devices such as HDDs and a plurality of power sources and each controller and each HDD are connected via an internal bus .

The controller is constituted from a processor for supervising and controlling the entire controller a memory for storing for example control programs and a plurality of controller ports CP CP . The controller port CP is connected to the relay port SP and the controller port CP is connected to the relay port SP .

The controller is constituted from a processor for supervising and controlling the entire controller a memory for storing for example control programs and a plurality of controller ports CP CP . The controller port CP is connected to the relay port SP and the controller port CP is connected to the relay port SP .

When RAID groups are composed of a plurality of HDDs in for example a RAID group RG is composed of a plurality of HDDs and a RAID group RG is composed of plurality of HDDs .

A plurality of real volumes PV PV PV are composed of storage areas of the plurality of HDDs constituting the RAID group . A plurality of real volumes PV PV PV are composed of storage areas of the plurality of HDDs constituting the RAID group .

The real volumes PV PV PV are configured so that they can be accessed from the server device via the controller ports CP CP and the real volumes PV PV PV are configured so that they can be accessed from the server device via the controller ports CP CP .

Referring to the server device has a plurality of physical resources including a plurality of processors for supervising and controlling the entire server device a memory for storing various programs and information host bus adapters HB HB for sending receiving data to from each relay device a plurality of power sources and a network controller and the respective elements are connected via an internal network .

The host bus adapter has a plurality of host ports HP HP . The host port HP is connected to the relay port SP of the relay device SW and the host port HP is connected to the relay port SP of the relay device SW .

The host bus adapter has a plurality of host ports HP HP . The host port HP is connected to the relay port SP of the relay device SW and the host port HP is connected to the relay port SP of the relay device SW .

Referring to the server device includes an operating system OS a hypervisor a virtual server and a virtual server .

The hypervisor operates on the operating system and also a monitoring unit for monitoring whether a failure exists or not in each of the physical resources constituting the hypervisor and the server device operates on the operating system . This monitoring unit functions as a server event generator for generating an event when a failure occurs in the hypervisor or a failure occurs in the various physical resources. Incidentally the hypervisor itself can have a function equivalent to that of the monitoring unit . Furthermore hardware independent of the operating system can be equipped with a function monitoring the physical resources and a failure notice function.

The hypervisor configures virtual volumes to VV VV VV VV as virtual volumes obtained by virtualizing the real volumes .

The virtual server VM has applications and an OS operating system and activates the applications operating on the OS . Also the virtual server VM is configured so that it can access the virtual volumes VV VV and these virtual volumes are used by the applications on the virtual server VV to store data.

The virtual server VM has applications and an OS operating system and activates the applications operating on the OS . Also the virtual server VM is configured so that it can access the virtual volumes VV VV and these virtual volumes are used by the applications on the virtual server VV to store data.

Referring to the resource management system has a processor for supervising and controlling the entire resource management system a memory for storing various information and programs and a network controller for controlling for example data transferred over the network and the respective elements are connected via an internal bus . The memory stores logical resource information physical resource information resource connection information domain information service level information and a logical resource allocation program .

Referring to the event notification system has a processor for supervising and controlling the entire event notification system a memory for storing various information and programs and a network controller for controlling for example data transferred over the network and the respective elements are connected via an internal bus .

The memory stores event filter information a domain administrator failure restoration schedule information an event reception program an effect judgment program an event notification program for the domain administrator and an event notification program for the system administrator .

Referring to the logical resource information is information for managing a plurality of logical resources constituting the storage apparatus or the server device and is constituted from an ID field A a type field B a subordinate resource ID field C and a domain ID field D.

The ID IDentifier is information about an identifier for uniquely identifying each logical resource. Each entry of this ID field A stores PV to PV when identifying a real volume and VV to VV when identifying a virtual volume . Furthermore each entry of the ID field A stores RG or RG when identifying a RAID group and VM or VM when identifying a virtual server .

The type is information about a name for identifying the type of each logical resource. Each entry of the type field B stores REAL VOLUME when the relevant logical resource is a real volume VIRTUAL VOLUME when the relevant logical resource is a virtual volume RAID GROUP when the relevant logical resource is a RAID group or VIRTUAL SERVER when the relevant logical resource is a virtual server .

The subordinate resource ID is an identifier for identifying a resource located at a subordinate position of the logical resource with the relevant ID. Each entry of the subordinate resource ID field C stores the identifier for identifying the relevant subordinate resource.

For example if the real volume is composed of the RG RAID group an entry corresponding to the real volume composed of the RG RAID group stores RG. Furthermore if the virtual volume is composed of a plurality of real volumes PV PV an entry corresponding to this virtual volume stores PV PV. In a case of a real volume a virtual volume or a RAID group information about its maximum capacity may be further stored in a maximum capacity field not shown in the drawing . Also in a case of the real volume a total value of the capacity allocated to the virtual volume may be further stored in an allocated capacity field not shown in the drawing .

The domain ID is an identifier for identifying the relevant domain. An entry of the domain ID field D stores DM or DM as the identifier of the relevant domain. DM is the identifier of the domain and DM is the identifier of the domain .

Referring to the physical resource information is information for managing a plurality of physical resources constituting the storage apparatus or the server device and is constituted from an ID field A a type field B a superior resource ID field C and a status field D.

The ID is information about an identifier for uniquely identifying each physical resource. Each entry of the ID field A stores ST when identifying the storage apparatus HD to HD when identifying the HDD and CT or CT when identifying the controller . Furthermore each entry of the ID field A stores CP to CP when identifying the controller port and PS or PS when identifying the power source . Furthermore Each entry of the ID field A stores the identifier SV when identifying the server device HBO or HB when identifying the HBA and HP HP HP HP when identifying the host port .

The type is information about a name for identifying the type of each physical resource. Each entry of the type field B stores STORAGE APPARATUS in a case of the storage apparatus HDD in a case of the HDD CONTROLLER in a case of the controller CONTROLLER PORT in a case of the controller port and POWER SOURCE in a case of the power source . Furthermore each entry of the type field B stores SERVER DEVICE in a case of the server device HBA in a case of the HBA and HOST PORT in a case of the host port .

The superior resource ID is information about an identifier for identifying a resource located at a superior position of each physical resource.

From among entries of the superior resource ID field C for example an entry corresponding to the HDD stores ST when the superior resource of the HDD is the storage apparatus and an entry corresponding to the controller stores ST when the superior resource of the controller is the storage apparatus . Furthermore an entry corresponding to the controller port stores CT or CT when the superior resource of the controller port is the controller .

The status is information about the status of each physical resource. Each entry of the status field D stores information indicating NORMAL when the relevant physical resource is in a normal state and information indicating FAILURE when a failure has occurred in the relevant physical resource.

Referring to the resource connection information is information for managing a connection relationship between a plurality of resources and is constituted from an ID field A a connected target ID field B and a type field C.

The ID is information about an identifier for uniquely identifying each resource. An entry of the ID field A stores PV to PV when identifying the real volume CP to CP when identifying the controller port and HP to HP when identifying the host port of the host bus adapter .

The connected target ID is information about an identifier for uniquely identifying a connected target of each resource. An entry of the connected target ID field B stores an identifier for identifying the connected target of each resource. For example if the connected targets of the real volume PV from among the real volumes are the controller ports CP CP the connected target ID field B stores CP CP.

The type is information about the type of connections between the resources. An entry of the type field C stores for example LUN when the real volume is configured so that it can be accessed from the controller port and CABLE when the controller port is connected to the relay port .

Referring to the domain information is information for managing the section A management system and the section B management system and is constituted from a domain ID field A a management server address field B an SNMP address field C and a spool field D.

The domain ID is information about an identifier for uniquely identifying the relevant domain. An entry of the domain ID field A stores for example DM as the domain ID corresponding to the domain of section A or DM as the domain ID corresponding to the domain of section B.

The management server address is an address allocated to the section A management server device or the section B management server device . An entry of the management server address field B stores 192.168.1.100 as an address corresponding to the section A management server device or 192.168.1.101 as an address corresponding to the section B management server device .

The SNMP address is an address used for event notification using an SNMP trap. An entry corresponding to the section B management server device from among entries of the SNMP address field C stores 192.168.1.111.

If a plurality of domains are managed by one management system a spool event spool is provided in the management system and events specific to a domain are stored in the spool. The administrator of that domain can refer to the events stored in the spool. An entry corresponding to the domain ID DM from among entries of the spool field D stores DM S as the name for identifying the spool. This indicates that events addressed to the domain corresponding to the domain ID DM are stored in the spool DM S provided in the common management system.

Referring to the service level information is information about the service level defined as the SLA and is constituted from an ID field A a performance field B an availability field C a reliability field D and a backup field E.

The ID is information about an identifier for uniquely identifying each virtual volume . Each entry of the ID field A stores for example VV to VV as the identifier for identifying the relevant virtual volume .

The performance is information about performance required for each virtual volume . An entry of the performance field B stores information indicating A when the service level is high information indicating B when the service level is medium and information indicating C when the service level is low. A blank means that no service level is defined.

The availability is information about availability of the virtual volume . Each entry of the availability field C stores information indicating A when the service level relating the availability of the virtual volume is high information indicating B when the service level relating the availability of the virtual volume is medium and information indicating C when the service level is low. A blank means that no service level is defined.

The reliability is information about reliability of the virtual volume . An entry of the reliability field D stores A when the service level relating the reliability of the virtual volume is high information indicating B when the service level relating the reliability of the virtual volume is medium and information indicating C when the service level is low. A blank means that no service level is defined.

The backup is information about the required number of the virtual volumes when backing up the relevant virtual volume . An entry of the backup field E stores information indicating the number of the virtual volumes required for a backup. For example if five virtual volumes are required to back up the relevant virtual volume information indicating 5 is stored in the backup field E.

If an incident in violation of the service level occurs the event filter information shown in is information for managing an event notification method for reporting that incident and is constituted from an ID field A a performance field B an availability field C a reliability field D and a backup field E.

An entry of the ID field A stores for example VV to VV as an identifier for identifying the relevant virtual volume .

The performance is information for defining the event notification method in a case of a violation of the service level with respect to the performance of each virtual volume . The availability is information for defining the event notification method in a case of a violation of the service level with respect to the availability of the virtual volume . The reliability is information for defining the event notification method in a case of a violation of the service level with respect to the reliability of the virtual volume . The backup is information for defining the event notification method in a case of a violation of the service level with respect to the backup of the virtual volume .

If the content of the event does not reach the service level defined by the service level information in each entry of the performance field B the availability field C the reliability field D and the backup field E stores information indicating SL NOT REACHED first filter information which means that the content of the event will be reported.

On the other hand if it is unnecessary to report the service level violation regardless of whether or not the service level is defined each entry of the performance field B to the backup field E stores information indicating NONE. Furthermore if a violation of the service level occurs each entry of the performance field B to the backup field E stores information indicating ALL second filter information when notice should be always made.

Referring to the failure restoration schedule information is information for retaining time required for failure restoration of each type of the resources and is constituted from a device type field A a site field B a time required for alternation field C and a time required for replacement field D.

An entry of the device type field A stores information about the device type. For example an entry of the device type field A stores information indicating STORAGE in a case of the storage apparatus information indicating CONNECTING DEVICE in a case of the relay device and information indicating SERVER DEVICE in a case of the server device.

An entry of the site field B stores information indicating the type of a failure occurrence site in the device of the type shown in the device type field A. For example in a case of the storage apparatus an entry of the site field stores HDD and RAID GROUP with respect a RAID group and HDD.

The time required for alternation is information about the maximum required time to switch the processing to another system when the failure site indicated by the site field B is a redundant configuration. An entry of the time required for alternation field C stores information indicating for example 0 30 when a maximum of 30 minutes are required as the time required for alternation.

The time required for replacement is information required to restore the failure site indicated by the site field B by means of for example replacement of the site. An entry of the time required for replacement field A stores information about maximum required time to restore the failure occurrence site. For example an entry of the time required for replacement field A stores information indicating 4 00 when a maximum of four hours are required to restore the HDD or the RAID group in the storage apparatus.

Referring to a logical resource allocation screen is a screen displayed on a display screen of the user terminal. A section administrator can create a desired virtual volume by using this screen. An area for creating a virtual volume displays a user ID and a domain. The user ID is a user ID of a section system administrator who operates this screen. The domain is a domain ID of a domain recognized as a management target by the section system administrator who operates this screen. These pieces of information have been already input as authentication information by the section system administrator on a previous screen before this screen is displayed. An area for basic settings is displayed below the above described area. The capacity of the virtual volume used by the user is input in a capacity input area as operated by the section system administrator hereinafter referred to as the user .

A service level display area displays performance availability reliability and backup as service level items. Areas A B C and NONE for selecting the service level of each item are displayed in the order of high medium and low corresponding to the performance availability and reliability items. Areas and NONE for selecting the number of the virtual volumes required for a backup are displayed corresponding to the backup item.

Furthermore the ID of a virtual server to which the created virtual volume is to be allocated is input to a virtual server input area for selecting the virtual server as operated by the user.

Selection items for performance availability reliability and backup are displayed in a notification condition selection area in event notice settings. The user can select either Case Where All Applies or Service Level Violation or can select neither of them with respect to each of these selection items. Furthermore if either of them is selected the user may further select either one of Only One Hour or Longer Restoration Time or Only One Day or Longer Restoration Time or can select neither of them.

Now if the user selects Case Where All Applies with respect to any of the items this content will be reflected as ALL in the event filter information in . Moreover if the user selects Service Level Violation with respect to any of the items this content will be reflected as SL NOT REACHED in the event filter information in . Furthermore if the user selects Only One Hour or Longer Restoration Time one hour or longer restoration time in addition to ALL and SL NOT REACHED will be added as the third filter information to the event filter information . The same applies to the case of Only One Day or Longer Restoration Time.

Next the content of processing by the logical resource allocation program will be explained with reference to a flowchart in .

The logical resource allocation program is activated by the processor for the resource management system .

Firstly when the logical resource allocation program is activated by the processor for the resource management system it starts virtual volume allocation processing step receives parameters input to the logical resource allocation screen in such as the required capacity of a virtual volume and the ID of the virtual server step selects an appropriate real volume to create a virtual volume with the capacity required by the user step and virtualizes the selected real volume and creates the virtual volume step . The real volume with an appropriate unused capacity can be selected by using the logical resource information . The virtual volume can be composed of a plurality of real volumes . An appropriate ID which does not overlap with any existing resource ID is set to the created virtual volume .

Next the logical resource allocation program registers the created virtual volume together with the ID of the domain managed by the user in the logical resource information step registers each item of the service level which has been input in the service level information step registers the content of the selection area the content selected by the user from among the event notice settings in the event filter information step sets allocates the created virtual volume so that it can be accessed from the virtual server with the ID which has been input to the virtual server input area step and terminates the processing in this routine step . The creation of the virtual volume and the allocation of the virtual volume to the virtual server can be executed by controlling the hypervisor via the network .

Next the processing content of the event reception program will be explained with reference to a flowchart in .

After the event reception program is activated by the processor it starts event reception processing step executes event wait processing step judges whether it has received an event or not step and repeats the processing in step and step until it receives an event.

When receiving an event the event reception program judges whether the event is a storage event or not step .

If an affirmative judgment is returned in step that is if the event reception program has received the event from the storage apparatus the event reception program executes storage effect judgment processing step and if a negative judgment is returned in step the event reception program judges whether the relevant event is a connecting device event or not step .

If an affirmative judgment is returned in step that is if the event reception program has received the event from the relay device which is the connecting device the event reception program executes connecting device effect judgment processing step and if a negative judgment is returned in step the event reception program judges whether the relevant event is a server device event or not step .

If an affirmative judgment is returned in step that is if the event reception program has received the event from the server device the event reception program executes server device effect judgment processing step .

At the end of the above described processing the event reception program executes system administrator notification processing step and domain administrator notification processing step and returns to the processing in step . In step the event reception program activates the event notification program for the system administrator to send to the overall management system information about the effects on the resources allocated to each section the service level violation incident which were judged in step in association with the event information received from the device. In step the event reception program activates the event notification program for the domain administrator and sends the effects on the resources allocated to each section to the section management system for managing the domain to which the resources are allocated.

Next the content of the storage effect judgment processing will be explained with reference to flowcharts in to . Incidentally the processor forms in the memory a template for the section event information to be reported to the section management system before executing the above mentioned processing. This template for the section event information will be eventually sent as information about the effects on the resources allocated to each section by the event notification program for the domain administrator which is activated in step in to the section management system . Furthermore the effect judgment program communicates with the logical resource allocation program via the network so that the logical resource information the physical resource information the resource connection information the domain information and the service level information can be accessed.

If an affirmative judgment is returned in step in the effect judgment program starts the storage effect judgment processing step .

The effect judgment program judges the content of the received event and judges whether or not the received event is an event of the HDD or the RAID group step . If a negative judgment is returned in step the effect judgment program proceeds to processing in step and if an affirmative judgment is returned in step the effect judgment program identifies the virtual volume and the domain to which that virtual volume is allocated based on the content of the received event and the logical resource information steps and and judges based on the content of the received event whether the relevant event is degeneration of the RAID group or not step .

If a negative judgment is returned in step the effect judgment program proceeds to processing in step and if an affirmative judgment is returned in step the effect judgment program executes processing for adding reliability degradation information to the template for the section event information step and judges whether the relevant event is the RAID group reconstruction or high load step . Incidentally the reliability degradation information herein used includes the identifier ID of the virtual volume which is a target information which indicates the occurred incident such as reliability degradation and the overview of a cause for the reliability degradation. The overview of the cause is for example information meaning Storage Failure Requiring Device Replacement and does not include any detained information such as a specific location of the failure. Furthermore all of reliability degradation information availability degradation information and performance degradation information which are to be added to the template for the section event information below includes the identifier ID of the target virtual volume the information indicating the occurred incident as identified by the judgment processing and the information indicating the overview of the cause in the same manner as in the example described in this paragraph. A template for the section event information for one section may sometimes include identifiers of a plurality of virtual volumes and the information indicating the occurred incident and the information indicating the overview of the cause are associated with the virtual volumes . Furthermore the template for the section event information includes failure occurrence time included in the event information received from various devices.

If a negative judgment is returned in step the effect judgment program proceeds to processing in step and if an affirmative judgment is returned in step the effect judgment program executes processing for adding the performance degradation information to the template for the section event information step and judges based on the content of the received event whether a fault has occurred in the RAID group or not step .

If a negative judgment is returned in step the effect judgment program proceeds to processing in step and if an affirmative judgment is returned in step for example if the HDDs cannot be accessed due to the fault of the RAID group the effect judgment program executes processing for adding the failure information to the template for the section event information step and then executes processing for adding recovery prediction information to the template for the section event information step thereby terminating the processing in this routine step . The recovery prediction information to be added is decided by referring to the failure restoration schedule information . For example in a case of the RAID group degeneration 0 30 which is the time required for alternation is adopted and in a case of the fault of the RAID group 4 00 which is the time required for replacement is adopted. Furthermore required time according to the failure site and the failure type is also specified in the following processing and is set as the recovery prediction information.

On the other hand as shown in if a negative judgment is returned in step the effect judgment program judges based on the received event whether or not a failure has occurred in the controller or the port for example the controller port step . If a negative judgment is returned in step the effect judgment program proceeds to processing in step and if an affirmative judgment is returned in step the effect judgment program identifies a connected target real volume as a connected target of the controller or the controller port step as shown in .

For example in a case of a failure of the controller ports CP CP the effect judgment program identifies the real volume PV as the connected target real volume based on the resource connection information .

Next the effect judgment program identifies the virtual volume based on the identified real volume step and identifies the domain based on the identified virtual volume step . The effect judgment program refers to the logical resource information in order to execute the above processing. Subsequently the effect judgment program identifies an alternate path for the real volume based on the identified domain step and judges whether alternate access is possible or not step .

For example the effect judgment program refers to the physical resource information and the resource connection information and judges whether one of the connected target IDs of the identified real volumes is NORMAL or not. If one of the connected target IDs of the identified real volumes is NORMAL this means the alternate access is possible. So the effect judgment program executes processing for adding the performance and availability degradation information to the template for the section event information step .

If a fault has occurred in all the connected target IDs of the identified real volumes this means the alternate access is impossible. So the effect judgment program executes processing for adding the failure information to the template for the section event information step Subsequently the effect judgment program executes processing for adding the recovery prediction information to the template for the section event information step and terminates the processing in this routine step .

Furthermore as shown in if a negative judgment is returned in step the effect judgment program judges whether a failure has occurred in the power source of the storage apparatus or not step . If an affirmative judgment is returned in step the effect judgment program identifies all the real volumes of the storage apparatus step identifies the virtual volume composed of the identified real volumes step and identifies the domain based on the identified virtual volume step .

Next the effect judgment program refers to the physical resource information and judges whether or not an alternate power source in normal operation state exists in the storage apparatus which generated the event step .

If an affirmative judgment is returned in step the effect judgment program recognizes the existence of the alternate power source and executes processing for adding the availability degradation information to the template for the section event information step and then proceeds to processing in step in and if a negative judgment is returned in step that is if the alternate power source does not exist the effect judgment program executes processing for adding the failure information to the template for the section event information step and then proceeds to processing in step in .

Furthermore if a negative judgment is returned in step in the effect judgment program executes processing for judging other effects step then executes processing for adding the recovery prediction information to the template for the section event information step and terminates the processing in this routine step .

Next the content of the connecting device effect judgment processing will be explained with reference to flowcharts in and .

If an affirmative judgment is returned in step in the effect judgment program starts the connecting device effect judgment processing step .

The effect judgment program judges based on the received event whether or not a failure has occurred in a port such as the relay port step . If a negative judgment is returned in step the effect judgment program proceeds to processing in step and if an affirmative judgment is returned in step the effect judgment program identifies the real volumes to or from which input or output is performed via this port and the virtual volume which is composed of these real volumes based on information about the relay port where the failure occurred the logical resource information and the resource connection information step identifies the domain based on the identified virtual volume step and judges based on the physical resource information and the resource connection information whether an alternate path for the identified real volumes exists or not step .

Next if it is determined that the alternate path exists the effect judgment program executes processing for adding the availability and performance degradation information to the template for the section event information step then executes processing for adding the recovery prediction information to the template for the section event information step and terminates the processing in this routine step .

On the other hand if a negative judgment is returned in step this means the alternate path does not exist. So the effect judgment program executes processing for adding the failure information to the template for the section event information step executes processing for adding the recovery prediction information to the template for the section event information step and terminates the processing in this routine step .

Furthermore as shown in if a negative judgment is returned in step the effect judgment program judges whether a failure has occurred in the power source in the relay device or not step . If an affirmative judgment is returned in step the effect judgment program identifies the real volumes usually a plurality of real volumes to from which input or output is performed via the connecting device where the failure occurred and the virtual volume which is formed of these real volumes step identifies the domain based on the identified virtual volume step and judges whether or not an alternate power source exists in the connecting device where the failure occurred by referring to the physical resource information step .

If an affirmative judgment is returned in step the effect judgment program executes processing for adding the availability degradation information to the template for the section event information step and proceeds to step .

If a negative judgment is returned in step that is if the alternate power source does not exist the effect judgment program executes processing for adding the failure information to the template for the section event information step and proceeds to step .

Furthermore if a negative judgment is returned in step the effect judgment program executes processing for judging the other effects step and proceeds to step .

Next the content of the server device effect judgment processing will be explained with reference to flowcharts in and .

If an affirmative judgment is returned in step in the effect judgment program starts the server device effect judgment processing step .

The effect judgment program judges based on the received event whether or not a failure has occurred in the host bus adapter HBA or a port such as the host port step . If a negative judgment is returned in step the effect judgment program proceeds to processing in step and if an affirmative judgment is returned in step the effect judgment program identifies the virtual volume which is configured in the hypervisor of the server device having this host bus adapter or the host port based on the logical resource information and the physical resource information step identifies the domain based on the identified virtual volume step and judges whether alternate access to the real volumes constituting the virtual volume is possible or not by referring to the logical resource information the physical resource information and the resource connection information step .

If an affirmative judgment is returned in step that is if the alternate access is possible the effect judgment program executes processing for adding the performance and availability degradation information to the template for the section event information step then executes processing for adding the recovery prediction information to the template for the section event information step and terminates the processing in this routine step .

On the other hand if a negative judgment is returned in step that is if the alternate access is impossible the effect judgment program executes processing for adding the failure information to the template for the section event information step and then proceeds to processing in step .

On the other hand as shown in if a negative judgment is returned in step the effect judgment program judges whether or not a failure has occurred in the power source in the server device step . If an affirmative judgment is returned in step the effect judgment program identifies the virtual volume which is configured in the hypervisor of the server device where the failure occurred based on the logical resource information step identifies the domain based on the identified virtual volume step and identifies based on the physical resource information whether or not an alternate power source exists in the server device where the failure occurred step .

If an affirmative judgment is returned in step the effect judgment program executes processing for adding the availability degradation information to the template for the section event information step and then proceeds to processing in step .

If a negative judgment is returned in step that is if the alternate power source does not exist the effect judgment program executes processing for adding the failure information to the template for the section event information step and then proceeds to processing in step .

Furthermore if a negative judgment is returned in step the effect judgment program executes processing for judging other effects step then executes processing for adding the recovery prediction information to the template for the section event information step and terminates the processing in this routine step .

Next the processing content of the event notification program for the domain administrator will be explained with reference to a flowchart in .

This processing is started by activation of the event notification program for the domain administrator by the processor for the event notification system in step of the processing flow shown in step . The target of the following sequence of processing is the template for the section event information formed by the effect judgment program . At this point the template for the section event information has become a complete form of the section event information to be reported to the section management system .

The event notification program for the domain administrator selects one virtual volume included in the template for the section event information step obtains event notice settings defined for the selected virtual volume from the event filter information and judges whether or not any information that satisfies notification conditions of the event notice settings exists in the content of the received event step .

Next if an affirmative judgment is returned in step the event notification program for the domain administrator identifies the domain to which the virtual volume is allocated based on the logical resource information further identifies an event notice destination of the management system which manages that domain based on the domain information step and executes processing for notifying the identified management system of the section event information step . The content of the notice includes the identifier of the virtual volume information indicating the occurred incident of the service level violation and information indicating the overview of the cause. Furthermore the content of the notice can include the restoration scheduled time based on the time required for alternation C or the time required for replacement D the event occurrence time and information about the service level defined for the virtual volume .

Subsequently the event notification program for the domain administrator judges whether or not information about the next virtual volume is included in the section event information step and if an affirmative judgment is returned in step the event notification program for the domain administrator selects next one virtual volume step and then repeats the processing from step to step .

If a negative judgment is returned in step the event notification program for the domain administrator executes processing in step and if a negative judgment is returned in step the event notification program for the domain administrator terminates the processing in this routine step .

Referring to a domain event information display screen is a screen displayed on the user terminal used by the section administrator and is constituted from a list and a details area . The domain event information display screen is formed by the section management system and information displayed on this screen is based on the section event information sent by the event notification program for the domain administrator to the section management system .

The list is constituted from an ID A an overview B a target C restoration scheduled time D and a status E.

The ID A displays an identifier for identifying the relevant event. For example a first entry displays WARN  as the identifier of the relevant event. The overview B displays information about the overview of the relevant service level violation incident. For example if the reliability of the virtual volume degrades the overview B displays Virtual Volume Reliability Degradation. The target C displays an identifier for identifying the site where the relevant failure occurred. For example if a failure occurs in the virtual volume the target C displays VV. The restoration scheduled time D displays the scheduled date and time for restoration of the failure site restoration. The status E displays GENERATED when an event is generated or RESTORED when the failure site has been restored. Whether the failure has been restored or not is judged and displayed based on the logical resource information and the physical resource information .

The details area displays the details of the relevant event relating to which the failure occurred. This details area displays the content of an entry selected from the list as detailed information. For example if WARN  of the first entry is selected from the list the details area displays the overview target time cause service level and restoration scheduled time as display items with respect to the selected identifier.

The overview area displays Virtual Volume Reliability Degradation and the target area displays Virtual Volume VV already allocated to Virtual Server VM .

The time area displays a date and time of the occurrence of the failure. The cause area displays for example Storage Failure Requiring Device Replacement and the service level area displays for example Performance A Reliability A and Availability A as the service level set to the virtual volume VV. Furthermore the restoration scheduled time area displays the scheduled date and time of restoration of the failure site.

The user can recognize the information displayed in the list and the details area on the domain event information display screen by operating the domain event information display screen of the user terminal.

Referring to a system information display screen is a display screen of a terminal used by the system administrator and is constituted from a list a details area and a notice content to domain area . The system information display screen is formed by the overall management system and information displayed on this screen is based on the event information and the section event information sent by the event notification program for the system administrator to the overall management system .

The list displays a list of events sent from various devices and displays with respect to each event an ID A an overview B a target C time limit for restoration D and a status E.

The ID A displays an identifier for identifying the relevant event for example ERR . The overview B displays as the overview of the relevant event for example RAID Group Degeneration when a RAID group in the storage apparatus has degenerated or Storage Power Source Failure when a failure occurred in the power source for the storage apparatus .

The target C displays an identifier for identifying the site where the relevant failure occurred. For example if a RAID group regarding which the RAID group degeneration has occurred belongs to RG the target C displays RG.

The time limit for restoration D displays a date and time of the time limit for restoration of the failure site. The time limit for restoration is calculated from the failure restoration schedule information and the failure occurrence time included in the event.

The status E displays GENERATED when an event is generated or RESTORED when the failure site has been restored after the generation of the event.

If the administrator selects any of entries of the list the details area displays the content of the selected entry. For example if a first entry of the list is selected the details area displays as the content of the selected entry its ID RAID Group Degeneration during Single Parity Operation as the overview RAID Group RG and Storage Apparatus ST as failure occurrence sites.

Furthermore the time area displays a date and time of the occurrence of the failure. The cause area displays for example HDD Failure as a cause of the failure occurrence. The time limit for restoration displays the time limit date and time of restoration of the failure site.

The notice content to domain area displays the section event information which is caused by the event selected in the list and reported to the section management system in the same format as that for the content displayed in the details area on the domain event information display screen in .

The system administrator can recognize the information displayed in the list the details area and the notice content to domain area on the system information display screen by operating the system information display screen .

If items for specifying the service level are defined in the service level information corresponding to the identified virtual volume the event notification system calculates whether or not the service level violation incident has occurred based on the received event and notifies the section management system of the result as the event based on the event filter according to this embodiment.

According to this embodiment the section administrator can recognize the occurrence of an incident in violation of the service level by accessing the section management system using the user terminal.

Furthermore according to this embodiment the event notification system notifies the overall management system of the content of the event in violation of the service level and also notifies the overall management system of the failure information which associates the content of the extracted event and the site where the failure occurred.

As a result according to this embodiment the system administrator for managing the entire system can recognize the content of the event in violation of the service level and also recognize the content of the failure information which associates the content of the extracted event and the site where the failure occurred by operating the overall management system using the system administrator terminal.

Referring to the computer system is constituted from an event notification system a storage apparatus server devices a plurality of relay devices a resource management system a section A management server device a section B management server device an overall management server and a subordinate storage apparatus and the respective elements are connected via an internal network . For example a LAN can be used as the internal network .

With the computer system according to this embodiment the event notification system is used instead of the event notification system the resource management system is used instead of the resource management system the storage apparatus is located between the plurality of server devices and the plurality of relay devices and the subordinate storage apparatus is located as a storage apparatus belonging to a subordinate tier of each relay device . Each server device each relay device the section A management server device the section B management server device and the event notification system can be respectively composed of the same elements according to the first embodiment.

The subordinate storage apparatus has a plurality of real volumes and it also has a subordinate storage event generator not shown for generating an event s if a failure occurs in any of a plurality of subordinate storage resources constituting the subordinate storage apparatus .

Each real volume is composed of storage areas of one or more subordinate storage devices. For example HDDs Hard Disk Drives semiconductor memory devices optical disk devices magneto optical disk devices magnetic tape devices and flexible disk devices can be used as the subordinate storage devices.

The storage apparatus has a function sending receiving information or data to from the subordinate storage apparatus via each relay device and also has a function as a storage event generator not shown for generating an event s if a failure occurs in any of the plurality of storage resources constituting the storage apparatus .

The storage apparatus has a function as a virtualization mechanism so that it virtualizes a plurality of real volumes composed of storage areas of the subordinate storage devices not shown of the subordinate storage apparatus to be a plurality of virtual volumes and manages the plurality of virtualized virtual volumes . Each virtual volume is provided by the virtualization mechanism of the storage apparatus in order for for example each server device to store data.

The subordinate storage apparatus can be constituted from for example subordinate storage units not shown having one or more subordinate storage devices and a subordinate controller not shown for sending receiving information to from the storage apparatus via each relay device and controlling data input to or output from the subordinate storage units in response to an access request.

Each server device SV SV has a function sending receiving information to from the storage apparatus and also has a function as a server event generator not shown for generating an event s if a failure occurs in any of the plurality of server resources constituting the server device .

Each relay device has a function relaying information or data sent and received between the storage apparatus and the subordinate storage apparatus and also has a function as a relay event generator not shown for generating an event s if a failure occurs in any of the plurality of relay resources constituting each relay device .

The resource management system manages the plurality of storage resources resources including physical resources and logical resources constituting the storage apparatus the plurality of server resources resources including physical resources and logical resources constituting each server device the plurality of relay resources resources including physical resources and logical resources constituting each relay device and the plurality of subordinate storage resources resources including physical resources and logical resources constituting the subordinate storage apparatus .

The event notification system has a processor a memory and a network controller any of which is not shown . If an event is generated by any of each server device the storage apparatus each relay device and the subordinate storage apparatus the event notification system receives the event via the internal network judges the content of the received event and identifies a virtual volume to be affected by the generation of the event from among the plurality of virtual volumes .

If the items for specifying the service levels are defined in the service level information not shown corresponding to the identified virtual volume under the above described circumstance the event notification system calculates whether an incident in violation of the defined service level has occurred or not based on the received event in accordance with the event filter information and notifies for example the section management system of the result.

Furthermore the event notification system notifies the overall management system of the event which associates the event received from the device and the service level violation incident.

Next shows a logical configuration diagram of the storage apparatus and the subordinate storage apparatuses.

If a plurality of real volumes PV PV are mounted in a subordinate storage apparatus and a plurality of real volumes PV to PV are mounted in a subordinate storage apparatus as shown in the storage apparatus virtualizes the real volume PV to configure a virtual volume VV and virtualizes the real volume PV to configure a virtual volume VV . Furthermore the storage apparatus virtualizes the real volumes PV to PV respectively to configure virtual volumes VV to VV .

Under this circumstance the storage apparatus connects each virtual volume VV to VV to each controller port CP CP connects each virtual volume VV to VV to each controller port CP CP and provides each virtual volume VV to VV as an access target of the user terminal to each server device .

Referring to logical resource information is information for managing a plurality of logical resources constituting the storage apparatus or the subordinate storage apparatus and is constituted from an ID field A a type field B a subordinate resource ID field C and a domain ID field D.

The ID is information about an identifier for uniquely identifying each logical resource. Each entry of this ID field A stores PV to PV when identifying a real volume and VV to VV when identifying a virtual volume .

The type is information about a name for identifying the type of each logical resource. Each entry of the type field B stores REAL VOLUME when the relevant logical resource is a real volume .

The subordinate resource ID is an identifier for identifying a resource located at a subordinate position of the logical resource with the relevant ID. Each entry of the subordinate resource ID field C stores the identifier of the relevant subordinate resource.

For example if the real volume is composed of a storage device of the storage apparatus LS an entry corresponding to the real volume composed of the storage apparatus LS stores LS. Furthermore if the virtual volume is composed of the real volumes PV to PV an entry corresponding to this virtual volume stores PV to PV.

The domain ID is an identifier for identifying a domain used for the relevant virtual volume . An entry corresponding to the virtual volume from among entries of the domain ID field D stores DM or DM as information about the identifier.

Referring to event filter information is information used instead of the event filter information and is constituted from a virtual volume ID field A and a received logical message field .

The virtual volume ID is information about an identifier for identifying a virtual volume . Each entry of the virtual volume ID field A stores for example VV to VV as the identifier for identifying the relevant virtual volume .

The received logical message is information about logical messages received by the user terminal. Each entry of the received logical message field B stores information about the received logical message. For example if performance degradation reliability degradation and availability degradation occur with respect to the virtual volume an entry of the received logical message field corresponding to this virtual volume stores information indicating Performance Degradation Reliability Degradation and Availability Degradation.

According to this embodiment the section administrator can recognize an incident s in violation of the service level by accessing the section management system using the user terminal.

Furthermore according to this embodiment the system administrator for managing the entire system can recognize the content of an even in violation of the service level by operating the overall management system using the system administrator terminal and recognize a failure by associating the site where the failure occurred with the incident in violation of the service level.

Incidentally the present invention is not limited to the aforementioned embodiments and includes various variations. For example the aforementioned embodiments have been described in detail in order to explain the invention in an easily comprehensible manner and are not necessarily limited to those having all the configurations explained above. Furthermore part of the configuration of a certain embodiment can be replaced with the configuration of another embodiment and the configuration of another embodiment can be added to the configuration of a certain embodiment. Also part of the configuration of each embodiment can be deleted or added to or replaced with the configuration of another configuration.

Furthermore part or all of the aforementioned configurations functions processing units processing means and so on may be realized by hardware by for example designing them in integrated circuits. Also each of the aforementioned configurations functions and so on may be realized by software by processors interpreting and executing programs for realizing each of the functions. Information such as programs tables and files for realizing each of the functions may be recorded and retained in memories storage devices such as hard disks and SSDs Solid State Drives or storage media such as IC Integrated Circuit cards SD Secure Digital memory cards and DVDs Digital Versatile Discs .

