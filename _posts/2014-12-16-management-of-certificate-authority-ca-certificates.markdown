---

title: Management of certificate authority (CA) certificates
abstract: Systems and methods for automatically installing CA certificates received from a network security appliance by a client security manager to make the CA certificate become a trusted CA certificate to a client machine are provided. In one embodiment, a client security manager establishes a connection with a network security appliance through a network, wherein the client security manager is configured for managing security of a client at the client side and the network security appliance is configured for managing the security of traffic pass through the network. The client security manager downloads from the network security appliance a certificate authority (CA) certificate to be used for signing a server certificate of a secure connection between the network security appliance and the client and automatically installs the CA certificate into a certificate store of the client.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09455980&OS=09455980&RS=09455980
owner: Fortinet, Inc.
number: 09455980
owner_city: Sunnyvale
owner_country: US
publication_date: 20141216
---
Contained herein is material that is subject to copyright protection. The copyright owner has no objection to the facsimile reproduction of the patent disclosure by any person as it appears in the Patent and Trademark Office patent files or records but otherwise reserves all rights to the copyright whatsoever. Copyright 2014 Fortinet Inc.

Embodiments of the present invention generally relate to computer networking. In particular various embodiments relate to management of a certificate authority CA certificate on a client machine and a network security appliance.

Many networking applications require secure and authenticated communications. Secure Sockets Layer SSL and its related protocols are often used to enable secure communications between a client and a server. According to SSL protocols session information between an SSL client and an SSL server are negotiated through a handshake phase and the identity of the SSL server is verified by the SSL client. The session information may include a session ID peer certificates the cipher specification to be used the compression algorithm to be used and shared secrets that are used to generate symmetric cryptographic keys. The SSL client encrypts a premaster secret with a public key from the SSL server s certificate and transmits the premaster secret to the server. Then both parties compute the master secret locally and derive the session key from it. After the handshake phase a secure socket is established and application data encrypted by the session key can be securely transmitted between the client and server.

To inspect data that is encrypted in an SSL packet a security policy enforcement device may perform SSL man in the middle inspection as shown in . As shown in a security policy enforcement device e.g. firewall comprises a kernel a transparent SSL proxy and an inspection module . When SSL client initiates an SSL session with SSL server through network a client hello message is transmitted by SSL client though an SSL port such as port . A Transmission Control Protocol TCP Internet Protocol IP stack within kernel intercepts the client hello message by monitoring the SSL port. Next the client hello message is redirected to transparent SSL proxy . Transparent SSL proxy uses its own certificate to negotiate with SSL client to setup a first SSL session SSL Session 1 . On the other hand transparent SSL proxy sends a client hello message to SSL server and negotiates with SSL server to setup a second SSL session SSL session 2 over network . After the two SSL sessions are established transparent SSL proxy possesses a session key used for encrypting and decrypting data in SSL session 1 and another session key used for encrypting and decrypting data in SSL session 2. When SSL client transmits data to SSL server data transmitted by SSL client is actually encrypted by the session key negotiated with transparent SSL proxy not SSL server . After an encrypted packet that is transmitted from SSL client in SSL session 1 is intercepted by kernel the packet is redirected to transparent SSL proxy . Because transparent SSL proxy possesses the session key of SSL session 1 it can decrypt the encrypted packet sent by SSL client . After the packet is decrypted plain data of the packet is sent to inspection module by kernel . The plain data is scanned by inspection module according to inspection policies. If the plain data passes the scan the data is re encrypted by transparent SSL proxy using a session key that is negotiated between transparent SSL proxy and SSL server . A re encrypted packet is then transmitted by kernel to SSL server through SSL session 2.

During the handshake phase SSL server sends a server certificate that is issued by a certificate authority and signed by a CA certificate to SSL client . SSL client checks trusted root certificates in the certificate store of SSL client for the CA certificate that signed the server certificate. If the CA certificate is one of the trusted root certificates that are installed in the certificate store it means that the server certificate is signed by a trusted CA and is acceptable to SSL client . If the CA certificate is not one of the trusted root certificates SSL client may present a warning message as shown in to the user. The user is warned that the security certificate is not issued by a trusted certificate authority and is provided with options to continue or stop establishing the secure connection. If the user decides to continue the secure connection even though the CA is not trusted by SSL client SSL client may temporally accept this CA certificate. Generally it is not a good practice for the user to accept un trusted certificates when a warning message is presented.

In a man in the middle SSL inspection system as shown in transparent SSL proxy establishes SSL session 1 with SSL client and establishes SSL session 2 with SSL server independently. The server certificate sent to SSL client in session 1 is signed by CA certificate of firewall . SSL client may show a warning message as shown in if the CA certificate of firewall is not installed in the certificate store as a trusted root certificate of SSL client . To avoid such a warning message the CA certificate of firewall may be installed manually on SSL client so that the CA certificate of firewall becomes a trusted root certificate of SSL client and no warning message will be presented when encrypted data packets between SSL client and SSL server are inspected by firewall .

Manually installing a CA certificate within a firewall requires knowledge of certificates and different operating systems and platform may have different process for installing root CA certificates. It is not convenient for users to install the CA certificate on client systems. Therefore there is a need for a method and system that automatically installs and manage CA certificates on client systems.

Systems and methods are described for automatically installing CA certificates received from a network security appliance by a client security manager to make the CA certificate become a trusted CA certificate to a client machine. In one embodiment a client security manager establishes a connection with a network security appliance through a network wherein the client security manager is configured for managing security of a client at the client side and the network security appliance is configured for managing the security of traffic pass through the network. The client security manager downloads from the network security appliance a certificate authority CA certificate to be used for signing a server certificate of a secure connection between the network security appliance and the client and automatically installs the CA certificate into a certificate store of the client.

Other features of embodiments of the present invention will be apparent from the accompanying drawings and from the detailed description that follows.

Systems and methods are described for automatically installing CA certificates received from a network security appliance by a client security manager to make the CA certificate become a trusted CA certificate to a client machine. According to one embodiment a client security manager establishes a connection with a network security appliance through a network wherein the client security manager is configured for managing security of a client at the client side and the network security appliance is configured for managing the security of traffic pass through the network. The client security manager downloads from the network security appliance a certificate authority CA certificate to be used for signing a server certificate of a secure connection between the network security appliance and the client and automatically installs the CA certificate into a certificate store of the client.

In the following description numerous specific details are set forth in order to provide a thorough understanding of embodiments of the present invention. It will be apparent however to one skilled in the art that embodiments of the present invention may be practiced without some of these specific details. In other instances well known structures and devices are shown in block diagram form.

Embodiments of the present invention include various steps which will be described below. The steps may be performed by hardware components or may be embodied in machine executable instructions which may be used to cause a general purpose or special purpose processor programmed with the instructions to perform the steps. Alternatively the steps may be performed by a combination of hardware software firmware and or by human operators.

Embodiments of the present invention may be provided as a computer program product which may include a machine readable storage medium tangibly embodying thereon instructions which may be used to program a computer or other electronic devices to perform a process. The machine readable medium may include but is not limited to fixed hard drives magnetic tape floppy diskettes optical disks compact disc read only memories CD ROMs and magneto optical disks semiconductor memories such as ROMs PROMs random access memories RAMs programmable read only memories PROMs erasable PROMs EPROMs electrically erasable PROMs EEPROMs flash memory magnetic or optical cards or other type of media machine readable medium suitable for storing electronic instructions e.g. computer programming code such as software or firmware . Moreover embodiments of the present invention may also be downloaded as one or more computer program products wherein the program may be transferred from a remote computer to a requesting computer by way of data signals embodied in a carrier wave or other propagation medium via a communication link e.g. a modem or network connection .

In various embodiments the article s of manufacture e.g. the computer program products containing the computer programming code may be used by executing the code directly from the machine readable storage medium or by copying the code from the machine readable storage medium into another machine readable storage medium e.g. a hard disk RAM etc. or by transmitting the code on a network for remote execution. Various methods described herein may be practiced by combining one or more machine readable storage media containing the code according to the present invention with appropriate standard computer hardware to execute the code contained therein. An apparatus for practicing various embodiments of the present invention may involve one or more computers or one or more processors within a single computer and storage systems containing or having network access to computer program s coded in accordance with various methods described herein and the method steps of the invention could be accomplished by modules routines subroutines or subparts of a computer program product.

Notably while embodiments of the present invention may be described using modular programming terminology the code implementing various embodiments of the present invention is not so limited. For example the code may reflect other programming paradigms and or styles including but not limited to object oriented programming OOP agent oriented programming aspect oriented programming attribute oriented programming OP automatic programming dataflow programming declarative programming functional programming event driven programming feature oriented programming imperative programming semantic oriented programming functional programming genetic programming logic programming pattern matching programming and the like.

The terms connected or coupled and related terms are used in an operational sense and are not necessarily limited to a direct connection or coupling. Thus for example two devices may be coupled directly or via one or more intermediary media or devices. As another example devices may be coupled in such a way that information can be passed there between while not sharing any physical connection with one another. Based on the disclosure provided herein one of ordinary skill in the art will appreciate a variety of ways in which connection or coupling exists in accordance with the aforementioned definition.

The phrases in one embodiment according to one embodiment and the like generally mean the particular feature structure or characteristic following the phrase is included in at least one embodiment of the present invention and may be included in more than one embodiment of the present invention. Importantly such phrases do not necessarily refer to the same embodiment.

If the specification states a component or feature may can could or might be included or have a characteristic that particular component or feature is not required to be included or have the characteristic.

The phase network security appliance generally refers to a hardware device or appliance configured to be coupled to a network and to provide one or more of data privacy protection encryption and security. The network security appliance can be a device providing one or more of the following features network firewalling VPN antivirus intrusion prevention IPS content filtering data leak prevention antispam antispyware logging reputation based protections event correlation network access control vulnerability management load balancing and traffic shaping that can be deployed individually as a point solution or in various combinations as a unified threat management UTM solution. Non limiting examples of network security devices include proxy servers firewalls VPN appliances gateways UTM appliances and the like.

Endpoint control module may be a daemon running on firewall that may manage the client security manager remotely. A CA certificate may be generated by firewall and used for signing a server certificate that is used for establishing an SSL session with SSL client for deep inspection of encrypted traffic transmitted to and from SSL client . In some embodiments CA certificate may be a unique CA certificate to firewall and may be generated when firewall is powered up based on random parameters that are generated by a hardware random generator. In other embodiments CA certificate may be a CA certificate of the user of firewall and it may be imported or uploaded by the user. CA certificate may be pushed to SSL client through a network connection between client security manager and endpoint control module and will be installed on SSL client by client security manager . CA certificate may be used for signing a server certificate that is used by transparent SSL proxy to identify firewall in an SSL session between SSL client and firewall .

Client security manager may be client based software that offers a wide range of security features for client computers including but not limited to personal computers laptops or mobile devices. Client security manager may provide multiple functions including but not limited to virus scan Virtual Private Network VPN two factor authentication parental control and etc. Client security manager may also connect to firewall to extend the security function of firewall to the client side. When client security manager is installed or loaded on SSL client client security manager may send a registration or connecting request to firewall . Firewall may send a client configuration file to client security manager if the request is accepted. The client configuration file may include a CA certificate issued by firewall . After client security manager receives CA certificate it is installed by client security manager to the certificate store of SSL client . After CA certificate is installed in the certificate store CA certificate become a trusted root CA certificate and the server certificate that is received by SSL client in an SSL session and signed by CA certificate will be trusted by SSL client and no warning message will be presented to the user.

Connection module is used for establishing a network connection with a network security appliance e.g. a FORTIGATE network gateway FORTIGATE is a trademark or registered trademark of Fortinet Inc. of Sunnyvale Calif. . When client security manager is installed or loaded on a client machine connection module may try to find the network security appliance that is managing the network. Connection module may initiate a request to establish a secure connection for example by way of SSL and or IPsec with the network security appliance based on an endpoint control protocol defined by the manufacturer of client security manager and the network security appliance. By establishing a secure connection data traffic between client security manager and the network security appliance are encrypted and transmitted in the secure connection so that the transmitted data cannot be intercepted by a third party.

Registration management module is used for registering or un registering client security manager with the network security appliance. Generally when client security manager is installed on a client machine registration management module may send a registration request and registration information such as registration serial number to the network security appliance through the secure tunnel between client security manager and the network security appliance. When the user of client security manager wants to un register it from the network security appliance registration management module may send a un registration request to the network security appliance.

Configuration module is used for receiving a client configuration file from the network security appliance and configuring client security manager according to the client configuration file. Generally after client security manager is registered with a client security manager the client security manager may push a client configuration file to client security manager through the secure tunnel established between client security manager and the network security appliance. The client configuration file may be an extensible markup language XML file including multiple elements defining the settings that should be used on client security manager . After the client configuration file is received configuration module may extract each element of the client configuration file and configure settings and functions of client security manager accordingly. If a CA certificate is included in the client configuration file the CA certificate is extracted from the client configuration file and sent to CA management module for installation within a CA certificate store of the client machine. Configuration module may also backup the settings of client security manager as well as the CA certificate downloaded from the network security appliance to a backup file that is locally stored on the client machine. The backup file may be used for restoring previous settings and the CA certificate when client security manager is restored on the client machine.

CA management module is used for managing CA certificates received from the network security appliance. When a CA certificate is received from the network security appliance with which client security manager is registered CA management module may optionally check if the CA certificate is a valid certificate e.g. not expired and etc. After the verification CA management module may call corresponding certificate Application Programming Interfaces APIs or tools to install the CA certificate into a certificate store of the client machine. Further when client security manager is un registered from the network security appliance or uninstalled from the client machine CA management module may optionally call corresponding APIs or tools to delete the CA certificate from the certificate store to avoid too many CA certificates from remaining in the certificate store.

Security module may include multiple modules that provide security functions of client security manager including but not limited to virus scan web filtering VPN connection parental control and etc. These functions are well known to persons skilled in the art and detailed descriptions thereof will be omitted for sake of brevity.

At block a client security manager initiates a connection to a firewall when the client security manager is installed or loaded on the client machine. In some examples the client security manager may initiate a secure connection to the firewall based on an endpoint control protocol that is defined by the manufacture of the client security manager and the firewall. The endpoint control protocol may control the data and control message transmission between the client security manager and the firewall across a network in a secure way. The endpoint control protocol may be a private protocol or a standard control protocol e.g. Control And Provisioning of Wireless Access Points CAPWAP .

At block the firewall negotiates with the client security manager and establishes a secure connection between the client security manager and the firewall. After the secure connection is established data and control messages between the client security manager and the firewall may be transmitted through the network without being intercepted by third parties.

At block the client security manager may send a register request to the firewall if it is the first time that the client security manager is installed on the client machine. The registration request may include registration information such as serial numbers user information and etc. which are used for verifying a legitimate user of the client security manager and the firewall. If the client security manager is already registered with the firewall the client security manager may send a login request at each time that it is loaded for running on the client machine.

At block the firewall receives the registration request or the login request and verifies if the client security manager is a legitimate user based on the received registration information or user credentials at block . If the client security manager is not a legitimate user the request is rejected. If the client security manager is a legitimate user the process goes to block

At block a CA certificate is pushed to the client security manager through the secure connection. In some examples the firewall may push a client configuration file to the client security manager when the client security manager is registered with the firewall based on the endpoint control protocol. The client configuration file may be an extensible markup language XML file that includes settings to be used by the client security manager for configuring various functions to be executed on the client machine. The CA certificate of the firewall may be an element of the client configuration file. Further the CA certificate may be a unique CA certificate to the firewall. In other examples the user of firewall may also import or upload his own CA certificate to the firewall and use the custom certificate to sign the server certificate during the SSL session with the SSL client.

At block the client configuration file is received by the client security manager and the CA certificate may be extracted from the client configuration file.

At block the client security manager may verify if the CA certificate is a valid CA certificate based on the digital signature included in the CA certificate.

At block if the CA certificate is verified as a legitimate one the client security manager may install the CA certificate to the certificate store of the client machine. As different platforms may have different mechanisms for managing certificate client security manager may call a corresponding API to perform the installation. For Microsoft Windows trademarks of Microsoft Corp. platforms the client security manager may use the Windows Crypto API to add the CA certificates to the Windows certificate store. The CA certificate may be stored as trusted root certificates of the Windows certificate store. For Android platforms the client security manager may use the Android build in KeyChain API to add the certificates as trusted CA certificates. For OS X trademarks of Apple Inc. platforms the client security manager may use the OSX Certificate Key and Trust Services API to add the certificates to the Keychain store. For iOS trademarks of Apple Inc. platform the client security manager may use the iOS Certificate Key and Trust Services API to add the certificates to the Keychain store. After the CA certificate is installed on the system certificate store web browsers that use the system certificates store will not present a warning message when a server certificate that is signed by the CA certificate downloaded from the firewall is received during an SSL session. Web browsers that use system certificate store include Google Chrome Internet Explorer and etc. As the Firefox web browser manages the certificates by itself FireFox tool certutil.exe can be used by the client security manager to add a CA certificate to the Firefox certificate database so that the CA certificate issued by the firewall become a trusted one for the Firefox web browser. When the API associated with installing the CA certificate is called by the client security manager and the CA certificate is installed into the system certificate store a warning message may be presented by the client system informing the user that a new CA certificate is about to be installed. The user may allow the CA certificate that is downloaded by the client security manager to be installed by clicking a confirmation button and the CA certificate will be installed into the CA certificate store by the client system.

After the CA certificate of the firewall is installed on the client machine the client security manager may provide additional management functionality in relation to the CA certificate. For example the CA certificate together with other configurations of the client security manager may be exported to a local storage for backup purpose so that the settings and CA certificate may be restored when the client security manager is re installed.

Further when the client security manager is uninstalled from the client machine the CA certificate may optionally be deleted from the certificate store of the client machine. When the client security manager is un registered from the firewall the client security manager may send a un register request to the firewall. The CA certificate may optionally be deleted from the certificate store of the client machine. By deleting CA certificate downloaded from the firewall when the client security manager is un registered with the firewall or uninstalled from the client machine the certificate storage of the client machine will not keep too many unnecessary certificates.

Further each CA certificate issued by a certificate authority has a validity period based on the certificate management protocol. The firewall may generate a new CA certificate or renew the CA certificate before it is expired. If a new CA certificate is generated or the CA certificate is renewed the endpoint control module of the firewall may push the new CA certificate to the client security manager when the client security manager is connected to the firewall. The client security manager may delete the old CA certificate from the client machine and install the new CA certificate to the trusted certificate store of the client machine.

Embodiments of the present disclosure include various steps which will be described in more detail below. A variety of these steps may be performed by hardware components or may be tangibly embodied on a computer readable storage medium in the form of machine executable instructions which may be used to cause a general purpose or special purpose processor programmed with instructions to perform these steps. Alternatively the steps may be performed by a combination of hardware software and or firmware.

As shown computer system includes a bus a processor communication port a main memory a removable storage media a read only memory and a mass storage . A person skilled in the art will appreciate that computer system may include more than one processor and communication ports.

Examples of processor include but are not limited to an Intel Itanium or Itanium 2 processor s or AMD Opteron or Athlon MP processor s Motorola lines of processors FortiSOC system on a chip processors or other future processors. Processor may include various modules associated with embodiments of the present invention.

Communication port can be any of an RS 232 port for use with a modem based dialup connection a 10 100 Ethernet port a Gigabit or 10 Gigabit port using copper or fiber a serial port a parallel port or other existing or future ports. Communication port may be chosen depending on a network such a Local Area Network LAN Wide Area Network WAN or any network to which computer system connects.

Memory can be Random Access Memory RAM or any other dynamic storage device commonly known in the art. Read only memory can be any static storage device s such as but not limited to a Programmable Read Only Memory PROM chips for storing static information such as start up or BIOS instructions for processor .

Mass storage may be any current or future mass storage solution which can be used to store information and or instructions. Exemplary mass storage solutions include but are not limited to Parallel Advanced Technology Attachment PATA or Serial Advanced Technology Attachment SATA hard disk drives or solid state drives internal or external e.g. having Universal Serial Bus USB and or Firewire interfaces such as those available from Seagate e.g. the Seagate Barracuda 7200 family or Hitachi e.g. the Hitachi Deskstar 7K1000 one or more optical discs Redundant Array of Independent Disks RAID storage such as an array of disks e.g. SATA arrays available from various vendors including Dot Hill Systems Corp. LaCie Nexsan Technologies Inc. and Enhance Technology Inc.

Bus communicatively couples processor s with the other memory storage and communication blocks. Bus can be such as a Peripheral Component Interconnect PCI PCI Extended PCI X bus Small Computer System Interface SCSI USB or the like for connecting expansion cards drives and other subsystems as well as other buses such a front side bus FSB which connects processor to system memory.

Optionally operator and administrative interfaces such as a display keyboard and a cursor control device may also be coupled to bus to support direct operator interaction with computer system . Other operator and administrative interfaces can be provided through network connections connected through communication port .

Removable storage media can be any kind of external hard drives floppy drives IOMEGA Zip Drives Compact Disc Read Only Memory CD ROM Compact Disc Re Writable CD RW Digital Video Disk Read Only Memory DVD ROM .

Components described above are meant only to exemplify various possibilities. In no way should the aforementioned exemplary computer system limit the scope of the present disclosure.

While embodiments of the invention have been illustrated and described it will be clear that the invention is not limited to these embodiments only. Numerous modifications changes variations substitutions and equivalents will be apparent to those skilled in the art without departing from the spirit and scope of the invention as described in the claims.

