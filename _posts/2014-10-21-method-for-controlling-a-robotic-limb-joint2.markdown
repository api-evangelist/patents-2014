---

title: Method for controlling a robotic limb joint
abstract: A model-based neuromechanical controller for a robotic limb having at least one joint includes a finite state machine configured to receive feedback data relating to the state of the robotic limb and to determine the state of the robotic limb, a muscle model processor configured to receive state information from the finite state machine and, using muscle geometry and reflex architecture information and a neuromuscular model, to determine at least one desired joint torque or stiffness command to be sent to the robotic limb, and a joint command processor configured to command the biomimetic torques and stiffnesses determined by the muscle model processor at the robotic limb joint. The feedback data is preferably provided by at least one sensor mounted at each joint of the robotic limb. In a preferred embodiment, the robotic limb is a leg and the finite state machine is synchronized to the leg gait cycle.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09539117&OS=09539117&RS=09539117
owner: Massachusetts Institute of Technology
number: 09539117
owner_city: Cambridge
owner_country: US
publication_date: 20141021
---
This Application is a divisional of U.S. patent application Ser. No. 12 698 128 filed Feb. 1 2010 now U.S. Pat. No. 8 864 846 which claims the benefit of U.S. Provisional Patent Appl. Ser. No. 61 148 545 filed Jan. 30 2009 and is a continuation in part of U.S. patent application Ser. No. 12 608 627 filed Oct. 29 2009 now U.S. Pat. No. 8 870 967 which is a continuation of U.S. patent application Ser. No. 11 642 993 filed Dec. 19 2006 now abandoned which claims the benefit of the U.S. Provisional Patent Appl. Ser. No. 60 751 680 filed Dec. 19 2005 and is a continuation in part of U.S. patent application Ser. No. 11 600 291 filed Nov. 15 2006 now abandoned which claims the benefit of U.S. Provisional Appl. No. 60 736 929 filed Nov. 15 2005 and U.S. Provisional Appl. No. 60 705 651 filed Aug. 4 2005 and is a continuation in part of U.S. patent application Ser. No. 11 395 448 filed Mar. 31 2006 which claims the benefit of U.S. Provisional Patent Appl. No. 60 666 876 filed Mar. 31 2005 and of U.S. Provisional Patent Appl. No. 60 704 517 filed Aug. 1 2005 and a continuation in part of U.S. patent application Ser. No. 11 499 853 filed Aug. 4 2006 now U.S. Pat. No. 7 313 463 which claims the benefit of U.S. Provisional Appl. 60 705 651 filed Aug. 4 2005 now abandoned.

U.S. patent application Ser. No. 11 499 853 filed Aug. 4 2006 now U.S. Pat. No. 7 313 463 is a continuation in part of U.S. patent application Ser. No. 11 395 448 filed Mar. 31 2006 now abandoned which claims the benefit of U.S. Provisional Appl. No. 60 704 517 filed Aug. 1 2005 and U.S. Provisional Appl. No. 60 666 876 filed Mar. 31 2005.

U.S. patent application Ser. No. 12 698 128 filed Feb. 1 2010 now U.S. Pat. No. 8 864 846 is also a continuation in part of U.S. patent application Ser. No. 12 157 727 filed Jun. 12 2008 now U.S. Pat. No. 8 512 415 which claims the benefit of U.S. Provisional Appl. No. 60 934 223 filed Jun. 12 2007 and is a continuation in part of U.S. patent application Ser. No. 11 642 993 filed Dec. 19 2006 now abandoned.

The present application claims the benefit of the filing date of each of the foregoing patent applications and incorporates the disclosures of each of the foregoing applications herein by reference in their entirety.

This invention was made with U.S. government support under Grant Numbers VA241 P 0026 65OD70025 and VA241 P 0479 650 D85022 awarded by the United States Veterans Administration. The government has certain rights in this invention.

The present invention relates to control of artificial joints and limbs for use in prosthetic orthotic exoskeletal or robotic devices and in particular to control methodology for a robotic leg based on a neuromuscular model of locomotion.

Legged locomotion of animals and humans is controlled by a complex network of neurons. Proposed in the early 20th century Brown T. G. 1914. On the nature of the fundamental activity of the nervous centres together with an analysis of the conditioning of rhythmic activity in progression and a theory of the evolution of function in the nervous system. J Physiol 48 1 18 46. . and firmly established today Orlovsky G. Deliagina T. Grillner S. 1999. Neuronal control of locomotion from mollusc to man. Oxford University Press New York the central pattern generator CPG forms the basis of this network.

In the current view the CPG consists of layers of neuron pools in the spinal cord Rybak I. A. Shevtsova N. A. Lafreniere Roula M. McCrea D. A. 2006. Modeling spinal circuitry involved in locomotor pattern generation insights from deletions during fictive locomotion. J Physiol 577 Pt 2 617 639 which through other neuron pools channeling muscle synergies provide rhythmic activity to the leg extensor and flexor muscles Dietz V. 2003. Spinal cord pattern generators for locomotion. Clin Neurophysiol 114 8 1379 1389 Minassian K. Persy I. Rattay F. Pinter M. M. Kern H. Dimitrijevic M. R. 2007. Human lumbar cord circuitries can be activated by extrinsic tonic input to generate locomotor like activity. Hum Mov Sci 26 2 275 295 sufficient to generate stepping movements even in the absence of spinal reflexes Grillner S. Zangger P. 1979. On the central generation of locomotion in the low spinal cat. Exp Brain Res 34 2 241 261 Frigon A. Rossignol S. 2006. Experiments and models of sensorimotor interactions during locomotion. Biol Cybern 95 6 607 627 . Spinal reflexes are nevertheless part of this complex network Rybak I. A. Stecina K. Shevtsova N. A. McCrea D. A. 2006. Modeling spinal circuitry involved in locomotor pattern generation insights from the effects of afferent stimulation. J Physiol 577 Pt 2 641 658 contributing to the selection of locomotive patterns the timing of the extensor and flexor activities and the modulation of the CPG output.

Using this combination of a central pattern generation and modulating reflexes neuromuscular models of lampreys Ekeberg O. Grillner S. 1999. Simulations of neuromuscular control in lamprey swimming. Philos Trans R Soc Lond B Biol Sci 354 1385 895 902 salamanders Ijspeert A. Crespi A. Ryczko D. Cabelguen J. M. 2007. From swimming to walking with a salamander robot driven by a spinal cord model. Science 315 5817 1416 1420 cats Ivashko D. G. Prilutski B. I. Markin S. N. Chapin J. K. Rybak I. A. 2003. Modeling the spinal cord neural circuitry controlling cat hindlimb movement during locomotion. Neurocomputing 52 54 621 629 Yakovenko S. Gritsenko V. Prochazka A. 2004. Contribution of stretch reflexes to locomotor control a modeling study. Biol Cybern 90 2 146 155 Maufroy C. Kimura H. Takase K. 2008. Towards a general neural controller for quadrupedal locomotion. Neural Netw 21 4 667 681 and humans Ogihara N. Yamazaki N. 2001. Generation of human bipedal locomotion by a bio mimetic neuro musculo skeletal model. Biol Cybern 84 1 1 11 Paul C. Bellotti M. Jezernik S. Curt A. 2005. Development of a human neuro musculo skeletal model for investigation of spinal cord injury. Biol Cybern 93 3 153 170 have developed into essential tools for studying different control strategies in animal and human locomotion. The emphasis of these models has been to reproduce the architecture of the CPG and underlying reflexes suggested by experiments Pearson K. Ekeberg O. Buschges A. 2006. Assessing sensory function in locomotor systems using neuro mechanical simulations. Trends Neurosci 29 11 625 631 . However little attention has been paid to understanding how such architectures might represent or encode principles of locomotion mechanics.

These principles suggest that in contrast to the complexity of the identified neural networks legged locomotion requires little or no control. For instance two conceptual models of walking Alexander R. 1976. Mechanics of bipedal locomotion. In Perspectives in experimental biology Ed. Davies P. S. Pergamon Oxford Mochon S. McMahon T. 1980. Ballistic walking. J. Biomech. 13 1 49 57 and running Blickhan R. 1989. The spring mass model for running and hopping. J. of Biomech. 22 1217 1227 McMahon T. Cheng G. 1990. The mechanism of running how does stiffness couple with speed J. of Biomech. 23 65 78 have been put forth that capture dominant mechanisms of legged locomotion. Researchers have demonstrated the capacity of these models to self stabilize if the mechanical system is properly tuned McGeer T. 1990. Passive dynamic walking. Int. J. Rob. Res. 9 2 62 82 McGeer T. 1992. Principles of walking and running. Vol. 11 of Advances in Comparative and Environmental Physiology. Springer Verlag Berlin Heidelberg Ch. 4 Seyfarth A. Geyer H. G nther M. Blickhan R. 2002. A movement criterion for running. J. of Biomech. 35 649 655 Ghigliazza R. Altendorfer R. Holmes P. Koditschek D. 2003. A simply stabilized running model. SIAM J. Applied. Dynamical Systems 2 2 187 218 . Walking and running robots have moreover demonstrated the practical relevance and control benefits derived from this principle Raibert M. 1986. Legged robots that balance. MIT press Cambridge McGeer T. 1990. Passive dynamic walking. Int. J. Rob. Res. 9 2 62 82 Saranli U. Buehler M. Koditschek D. 2001. Rhex A simple and highly mobile hexapod robot. Int. Jour. Rob. Res. 20 7 616 631 Collins S. Ruina A. Tedrake R. Wisse M. 2005. Efficient bipedal robots based on passive dynamic walkers. Science 307 5712 1082 1085 . But it remains an open question how this and other principles of legged mechanics are integrated into the human motor control system.

The importance of this interplay between mechanics and motor control has been recognized by neuroscientists and biomechanists alike Pearson K. Ekeberg O. Buschges A. 2006. Assessing sensory function in locomotor systems using neuro mechanical simulations. Trends Neurosci 29 11 625 631 . For instance although it is generally accepted that the CPG forms a central drive for motor activity in locomotion Grillner S. Zangger P. 1979. On the central generation of locomotion in the low spinal cat. Exp Brain Res 34 2 241 261 Dietz V. 2003. Spinal cord pattern generators for locomotion. Clin Neurophysiol 114 8 1379 1389 Frigon A. Rossignol S. 2006. Experiments and models of sensorimotor interactions during locomotion. Biol Cybern 95 6 607 627 Ijspeert A. J. 2008. Central pattern generators for locomotion control in animals and robots a review. Neural Netw 21 4 642 653 Lundberg suggested in 1969 that out of its rather simple central input spinal reflexes which relay information about locomotion mechanics could shape the complex muscle activities seen in real locomotion Lundberg A. 1969. Reflex control of stepping. In The Nansen memorial lecture V Oslo Universitetsforlaget 5 42 . Refining this idea Taga later proposed that because centrally generated rhythms are entrained by sensory signals which are induced by rhythmic movements of the motor apparatus . . . motor output is an emergent property of the dynamic interaction between the neural system the musculo skeletal system and the environment Taga G. 1995. A model of the neuro musculo skeletal system for human locomotion. I. Emergence of basic gait. Biol. Cybern. 73 2 97 111 . In support he presented a neuromuscular model of human locomotion that combines a CPG with sensory feedback and demonstrates how basic gait can emerge from the global entrainment between the rhythmic activities of the neural and of the musculo skeletal system.

What the actual ratio of central and reflex inputs is that generates the motor output continues to be debated Pearson K. G. 2004. Generating the walking gait role of sensory feedback. Prog Brain Res 143 123 129 Frigon A. Rossignol S. 2006. Experiments and models of sensorimotor interactions during locomotion. Biol Cybern 95 6 607 627 Hultborn H. 2006. Spinal reflexes mechanisms and concepts from Eccles to Lundberg and beyond. Prog Neurobiol 78 3 5 215 232 Prochazka A. Yakovenko S. 2007. The neuromechanical tuning hypothesis. Prog Brain Res 165 255 265 . For instance for walking cats it has been estimated that only about 30 percent of the muscle activity observed in the weight bearing leg extensors can be attributed to muscle reflexes Prochazka A. Gritsenko V. Yakovenko S. 2002. Sensory control of locomotion reflexes versus higher level control. Adv Exp Med Biol 508 357 367 Donelan J. M. McVea D. A. Pearson K. G. 2009. Force regulation of ankle extensor muscle activity in freely walking cats. J Neurophysiol 101 1 360 371 .

In humans the contribution of reflexes to the muscle activities in locomotion seems to be more prominent. Sinkjaer and colleagues estimated from unloading experiments that reflexes contribute about 50 percent to the soleus muscle activity during stance in walking Sinkjaer T. Andersen J. B. Ladouceur M. Christensen L. O. Nielsen J. B. 2000. Major role for sensory feedback in soleus EMG activity in the stance phase of walking in man. J Physiol 523 Pt 3 817 827 . More recently Grey and colleagues found that the soleus activity changes proportionally to changes in the Achilles tendon force suggesting a direct relationship between positive force feedback and activity for this muscle Grey M. J. Nielsen J. B. Mazzaro N. Sinkjaer T. 2007. Positive force feedback in human walking. J Physiol 581 1 99 105 . Whether such a large reflex contribution is present for all leg muscles remains open. Perhaps a proximo distal gradient exists in motor control where proximal leg muscles are mainly controlled by central inputs while distal leg muscles are dominated by reflex inputs due to higher proprioceptive feedback gains and a larger sensitivity to mechanical effects as Daley and colleagues concluded from locomotion experiments with birds Daley M. A. Felix G. Biewener A. A. 2007. Running stability is enhanced by a proximo distal gradient in joint neuromechanical control. J Exp Biol 210 Pt 3 383 394 .

Adaptation to terrain is an important aspect of walking. Today s commercially available ankle foot prostheses utilize lightweight passive structures that are designed to present appropriate elasticity during the stance phase of walking S. Ron Prosthetics and Orthotics Lower Limb and Spinal. Lippincott Williams Wilkins 2002 . The advanced composites used in these devices permit some energy storage during controlled dorsiflexion and plantar flexion and subsequent energy release during powered plantar flexion much like the Achilles tendon in the intact human A. L. Hof B. A. Geelen Jw. Van den Berg Calf muscle moment work and efficiency in level walking role of series elasticity Journal of Biomechanics Vol. 16 No. 7 pp. 523 537 1983 D. A. Winter Biomechanical motor pattern in normal walking Journal of Motor Behavior Vol. 15 No. 4 pp. 302 330 1983 .

Although this passive elastic behavior is a good approximation to the ankle s function during slow walking normal and fast walking speeds require the addition of external energy and thus cannot be implemented by any passive ankle foot device M. Palmer Sagittal plane characterization of normal human ankle function across a range of walking gait speeds Master s Thesis Massachusetts Institute of Technology Cambridge Mass. 2002 D. H. Gates Characterizing ankle function during stair ascent descent and level walking for ankle prosthesis and orthosis design Master s Thesis Boston University 2004 A. H. Hansen D. S. Childress S. C. Miff S. A. Gard K. P. Mesplay The human ankle during walking implication for the design of biomimetic ankle prosthesis Journal of Biomechanics Vol. 37 Issue 10 pp. 1467 1474 2004 . This deficiency is reflected in the gait of transtibial amputees using passive ankle foot prostheses. Their self selected walking speed is slower and stride length shorter than normal D. A. Winter and S. E. Sienko. Biomechanics of below knee amputee gait Journal of Biomechanics 21 pp. 361 367 1988 . In addition their gait is distinctly asymmetric the range of ankle movement on the unaffected side is smaller H. B. Skinner and D. J. Effeney Gait analysis in amputees Am J Phys Med Vol. 64 pp. 82 89 1985 H. Bateni and S. Olney Kinematic and kinetic variations of below knee amputee gait Journal of Prosthetics Orthotics Vol. 14 No. 1 pp. 2 13 2002 while on the affected side the hip extension moment is greater and the knee flexion moment is smaller D. A. Winter and S. E. Sienko. Biomechanics of below knee amputee gait Journal of Biomechanics 21 pp. 361 367 1988 H. Bateni and S. Olney Kinematic and kinetic variations of below knee amputee gait Journal of Prosthetics Orthotics Vol. 14 No. 1 pp. 2 13 2002 . They also expend greater metabolic energy walking than non amputees N. H. Molen Energy speed relation of below knee amputees walking on motor driven treadmill Int. Z. Angew Physio Vol. 31 p 173 1973 G. R. Colborne S. Naumann P. E. Longmuir and D. Berbrayer Analysis of mechanical and metabolic factors in the gait of congenital below knee amputees Am. J. Phys. Med. Rehabil. Vol. 92 pp 272 278 1992 R. L. Waters J. Perry D. Antonelli H. Hislop. Energy cost of walking amputees the influence of level of amputation J Bone Joint Surg. Am. Vol. 58 No. 1 pp. 4246 1976 E. G. Gonzalez P. J. Corcoran and L. R. Rodolfo. Energy expenditure in B K amputees correlation with stump length. Archs. Phys. Med. Rehabil. 55 111 119 1974 D. J. Sanderson and P. E. Martin. Lower extremity kinematic and kinetic adaptations in unilateral below knee amputees during walking Gait and Posture. 6 126 136 1997 A. Esquenazi and R. DiGiacomo. Rehabilitation After Amputation Journ Am Podiatr Med Assoc 91 1 13 22 2001 . These differences could possibly be a result of the amputees greater use of hip power to compensate for the lack of ankle power A. D. Kuo Energetics of actively powered locomotion using the simplest walking model J Biomech Eng. Vol. 124 pp. 113 120 2002 A. D. Kuo J. M. Donelan and A. Ruina Energetic consequences of walking like an inverted pendulum Step sto step transitions Exerc. Sport Sci. Rev. Vol. 33 No. 2 pp. 88 97 2005 A. Ruina J. E. Bertram and M. Srinivasan A collisional model of the energetic cost of support work qualitatively explains leg sequencing in walking and galloping pseudo elastic leg behavior in running and the walk to run transition. J. Theor. Biol. Vol. 237 No. 2 pp. 170 192 2005 .

Passive ankle foot prostheses cannot provide the capability of adaptation to terrain. To provide for a normal economical gait beyond slow walking speeds powered ankle foot prostheses have now been developed S. Au and H. Herr. Initial experimental study on dynamic interaction between an amputee and a powered ankle foot prosthesis Workshop on Dynamic Walking Mechanics and Control of Human and Robot Locomotion Ann Arbor Mich. May 2006 S. K. Au J. Weber and H. Herr Biomechanical design of a powered ankle foot prosthesis Proc. IEEE Int. Conf. On Rehabilitation Robotics Noordwijk The Netherlands pp. 298 303 June 2007 S. Au J. Weber E. Martinez Villapando and H. Herr. Powered Ankle Foot Prosthesis for the Improvement of Amputee Ambulation IEEE Engineering in Medicine and Biology International Conference. August 23 26 Lyon France pp. 3020 3026 2007 H. Herr J. Weber S. Au. Powered Ankle Foot Prosthesis Biomechanics of the Lower Limb in Health Disease and Rehabilitation. September 3 5 Manchester England pp. 72 74 2007 S. K. Au Powered Ankle Foot Prosthesis for the Improvement of Amputee Walking Economy Ph.D. Thesis Massachusetts Institute of Technology Cambridge Mass. 2007 S. Au J. Weber and H. Herr. Powered Ankle foot Prosthesis Improves Walking Metabolic Economy IEEE Trans. on Robotics Vol. 25 pp. 51 66 2009 J. Hitt R. Bellman M. Holgate T. Sugar and K. Hollander The sparky spring ankle with regenerative kinetics projects Design and analysis of a robotic transtibial prosthesis with regenerative kinetics in Proc. IEEE Int. Conf. Robot. Autom. Orlando Fla. pp 2939 2945 May 2006 S. K. Au H. Herr On the Design of a Powered Ankle Foot Prosthesis The Importance of Series and Parallel Elasticity IEEE Robotics Automation Magazine. pp. 52 59 September 2008 . Some of these are of size and weight comparable to the intact human ankle foot and have the elastic energy storage motor power and battery energy to provide for a day s typical walking activity S. K. Au H. Herr On the Design of a Powered Ankle Foot Prosthesis The Importance of Series and Parallel Elasticity IEEE Robotics Automation Magazine. pp. 52 59 September 2008 .

The use of active motor power in these prostheses raises the issue of control. In previous work with these powered devices the approach taken was to match the torque ankle state profile of the intact human ankle for the activity to be performed S. K. Au Powered Ankle Foot Prosthesis for the Improvement of Amputee Walking Economy Ph.D. Thesis Massachusetts Institute of Technology Cambridge Mass. 2007 J. Hitt R. Bellman M. Holgate T. Sugar and K. Hollander The sparky spring ankle with regenerative kinetics projects Design and analysis of a robotic transtibial prosthesis with regenerative kinetics in Proc. IEEE Int. Conf. Robot. Autom. Orlando Fla. pp 2939 2945 May 2006 F. Sup A. Bohara and M. Goldfarb Design and Control of a Powered Transfemoral Prosthesis The International Journal of Robotics Research Vol. 27 No. 2 pp. 263 273 2008 . The provision of motor power meant that the open work loops of the angle torque profiles in faster walking could be supported rather than just the spring like behavior provided by passive devices. However this control approach exhibited no inherent adaptation. Instead torque profiles were required for all intended activities and variation of terrain along with an appropriate means to select among them.

In general existing commercially available active ankle prostheses are only able to reconfigure the ankle joint angle during the swing phase requiring several strides to converge to a terrain appropriate ankle position at first ground contact. Further they do not provide any of the stance phase power necessary for normal gait and therefore cannot adapt net stance work with terrain slope. In particular control schemes for powered ankle foot prostheses rely upon fixed torque ankle state relationships obtained from measurements of intact humans walking at target speeds and across known terrains. Although effective at their intended gait speed and terrain these controllers do not allow for adaptation to environmental disturbances such as speed transients and terrain variation.

Neuromuscular models with a positive force feedback reflex scheme as the basis of control have recently been employed in simulation studies of the biomechanics of legged locomotion H. Geyer H. Herr A muscle reflex model that encodes principles of legged mechanics predicts human walking dynamics and muscle activities Submitted for publication H. Geyer A. Seyfarth R. Blickhan Positive force feedback in bouncing gaits Proc. R Society. Lond. B 270 pp. 2173 2183 2003 . Such studies show promise regarding the need for terrain adaptation.

In one aspect the present invention is a controller and a control methodology for a biomimetic robotic leg based on a neuromuscular model of human locomotion. The control architecture commands biomimetic torques at the ankle knee and hip joints of a powered leg prosthesis orthosis or exoskeleton during walking In a preferred embodiment the powered device includes artificial ankle and knee joints that are torque controllable. Appropriate joint torques are provided to the user as determined by the feedback information provided by sensors mounted at each joint of the robotic leg device. These sensors include but are not limited to angular joint displacement and velocity using digital encoders hall effect sensors or the like torque sensors at the ankle and knee joints and at least one inertial measurement unit IMU located between the knee and the ankle joints.

Sensory information of joint state position and velocity from the robotic leg is used as inputs to a neuromuscular model of human locomotion. Joint state sensory information from the robotic leg is used to determine the internal state for each of its virtual muscles and what the individual virtual muscle force and stiffness should be given particular levels of muscle activation is determined from a spinal reflex model. If the robotic leg is a leg prosthesis worn by a transfemoral amputee angular sensors at the ankle and knee measure joint state for these joints. For the hip joint the absolute orientation of the user s thigh is determined using both the angular joint sensor at the prosthetic knee and an IMU positioned between the prosthetic knee and the ankle joints. To estimate hip position and velocity the control architecture works under the assumption that the upper body torso maintains a relative vertical position during gait.

In one aspect the invention is a model based neuromechanical controller for a robotic limb comprising at least one joint the controller comprising a neuromuscular model including a muscle model muscle tendon lever arm and muscle tendon length equations and reflect control equations the neuromuscular model being configured to receive feedback data relating to a measured state of the robotic limb and using the feedback data and the muscle model muscle tendon lever arm and muscle tendon length equations and reflect control equations of the neuromuscular model to determine at least one torque command the controller further comprising a torque control system in communication with the neuromuscular model whereby the torque control system receives the at least one torque command from the neuromuscular model for controlling the robotic limb joint. In a preferred embodiment the feedback data is provided by at least one sensor mounted at each joint of the robotic limb. In another preferred embodiment the robotic limb is a leg and the controller further includes a finite state machine synchronized to the leg gait cycle the finite state machine being configured to receive the feedback data from the at least one sensor to determine a gait phase of the robotic leg using the feedback data received.

In another aspect the invention is a model based method for controlling a robotic limb comprising at least one joint comprising the steps of receiving feedback data relating to the state of the robotic limb at a finite state machine determining the state of the robotic limb using the finite state machine and the received feedback data determining using a neuromuscular model that includes muscle tendon lever arm and muscle tendon length equations and reflex control equations and state information from the finite state machine at least one desired joint torque or stiffness command to be sent to the robotic limb and commanding the biomimetic torques and stiffnesses determined by the muscle model processor at the robotic limb joint.

A control architecture is presented to command biomimetic torques at the ankle knee and hip joints of a powered leg prosthesis orthosis or exoskeleton during walking. In this embodiment the powered device includes artificial ankle and knee joints that are torque controllable. Appropriate joint torques are provided to the user as determined by the feedback information provided by sensors mounted at each joint of the robotic leg device. These sensors include but are not limited to angular joint displacement and velocity using digital encoders hall effect sensors or the like torque sensors at the ankle and knee joints and at least one inertial measurement unit IMU located between the knee and the ankle joints.

Sensory information of joint state position and velocity from the robotic leg hip knee and ankle is used as inputs to a neuromuscular model of human locomotion. This model uses joint state sensory information from the robotic leg to determine the internal state for each of its virtual muscles and establishes what the individual virtual muscle force and stiffness should be given particular levels of muscle activation determined from a spinal reflex model. If the robotic leg is a leg prosthesis worn by a transfemoral amputee angular sensors at the ankle and knee measure joint state for these joints. For the hip joint the absolute orientation of the user s thigh is determined using both the angular joint sensor at the prosthetic knee and an IMU positioned between the prosthetic knee and the ankle joints. To estimate hip position and velocity the control architecture works under the assumption that the upper body torso maintains a relative vertical position during gait.

As used herein and in the Appl.s incorporated by reference herein the following terms expressly include but are not to be limited to 

 Agonist means a contracting element that is resisted or counteracted by another element the antagonist.

 Agonist antagonist actuator means a mechanism comprising at least two actuators that operate in opposition to one another an agonist actuator that when energized draws two elements together and an antagonist actuator that when energized urges the two elements apart.

 Antagonist means an expanding element that is resisted or counteracted by another element the agonist.

 Biomimetic means a man made structure or mechanism that mimics the properties and behavior of biological structures or mechanisms such as joints or limbs.

 Extension means a bending movement around a joint in a limb that increases the angle between the bones of the limb at the joint.

 Flexion means a bending movement around a joint in a limb that decreases the angle between the bones of the limb at the joint.

 Motor means an active element that produces or imparts motion by converting supplied energy into mechanical energy including electric pneumatic or hydraulic motors and actuators.

 Spring means an elastic device such as a metal coil or leaf structure which regains its original shape after being compressed or extended.

An exemplary embodiment of a neuromuscular model based control scheme according to this aspect of the invention is shown as a block diagram in . In a neuromuscular model according to the invention includes reflex control equations for each modeled muscle unit . The predicted forces and stiffnesses from all the modeled muscles are used to compute model estimates of desired joint torques and stiffnesses using muscle moment arm values provided by muscle tendon lever arm and muscle tendon length equations which moment arm and muscle tendon length values from joint state e.g. joint angle and data from the literature. A muscle tendon unit MTU also referred to a muscle tendon complex MTC and associated parameters are described below with reference to . For the purposes of this description MTU has the same meaning as MTC. The model estimates are then sent to torque control system of biomimetic robotic leg as desired net torque and stiffness values for joints of biomimetic robotic leg . Top level finite state machine then tracks the torque and stiffness values at each robotic joint of biomimetic robotic leg . Finite state machine receives joint state as an input and provides gait phase and joint state as outputs to neuromuscular model .

In order for each of the virtual muscle to produce its required force a muscle stimulation parameter STIM t is required. This parameter can be determined from either an outside input or a local feedback loop. In the control methodology for the exemplary biomimetic leg the STIM t is computed based on local feedback loops. This architecture is based on the reflex feedback framework developed by Geyer and Herr H. Geyer H. Herr A muscle reflex model that encodes principles of legged mechanics predicts human walking dynamics and muscle activities Submitted for publication herein incorporated by reference in its entirety . In this framework the neural control is designed to mimic the stretch reflex of an intact human muscle. This neuromuscular reflex based control methodology allows the biomimetic robotic leg to replicate human like joint mechanics.

Neuromechanical model. A human model with a reflex control that encodes principles of legged mechanics predicts human walking dynamics and muscle activities. While neuroscientists identify increasingly complex neural networks that control animal and human gait biomechanists find that locomotion requires little motor control if principles of legged mechanics are heeded. Here it is shown how muscle reflex behavior could be vital to link these two observations. A model of human locomotion was developed that is driven by muscle reflex behaviors that encode principles of legged mechanics. Equipped with this principle based reflex control the model stabilizes into the walking gait from its dynamic interplay with the ground tolerates ground disturbances and self adapts to stairs. Moreover the model shows qualitative agreement with joint angles joint torques and muscle activations known from experiments suggesting that human motor output could largely be shaped by muscle reflex behaviors that link principles of legged mechanics into the neural networks responsible for locomotion.

A human walking model with a motor control is based on muscle reflexes which are designed to include such principles of legged mechanics. These principles derive from simple conceptual models of legged locomotion and include the reliance on compliant leg behavior in stance Blickhan R. 1989. The spring mass model for running and hopping. J. of Biomech. 22 1217 1227 Ghigliazza R. Altendorfer R. Holmes P. Koditschek D. 2003. A simply stabilized running model. SIAM J. Applied. Dynamical Systems 2 2 187 218 Geyer H. Seyfarth A. Blickhan R. 2006. Compliant leg behaviour explains the basic dynamics of walking and running. Proc. R. Soc. Lond. B 273 2861 2867 the stabilization of segmented legs based on static joint torque equilibria Seyfarth A. G nther M. Blickhan R. 2001. Stable operation of an elastic three segmented leg. Biol. Cybern. 84 365 382 G nther M. Keppler V. Seyfarth A. Blickhan R. 2004. Human leg design optimal axial alignment under constraints. J. Math. Biol. 48 623 646 the exploitation of ballistic swing leg mechanics Mochon S. McMahon T. 1980. Ballistic walking. J. Biomech. 13 1 49 57 and the enhancement of gait stability using swing leg retraction Seyfarth A. Geyer H. G nther M. Blickhan R. 2002. A movement criterion for running. J. of Biomech. 35 649 655 Seyfarth A. Geyer H. Herr H. M. 2003. Swing leg retraction a simple control model for stable running. J Exp. Biol. 206 2547 2555 . Hill type muscles combined with spinal reflexes are employed including positive force and length feedback schemes to effectively encode these mechanical features.

Comparing the model s behavior with kinetic kinematic and electromyographic evidence from the literature for human walking it has been shown that a neuromuscular model with a motor control designed to encode principles of legged mechanics can produce biological walking mechanics and muscle activities. This reflex control allows the model to tolerate sudden changes in ground level and to adapt to stair ascent and descent without parameter interventions.

The structure and control of the human model evolves in six steps from a conceptual point mass model into a neuromuscular biped with an upper body and two three segment legs each actuated by seven muscles and controlled by muscle reflexes. depict six stages in the evolution of a general neuromuscular model architecture according to this aspect of the present invention. The first three stages integrate and stabilize compliant leg behavior in stance . The fourth stage adds an upper body and its balance control . The last two stages prepare and ensure the pro and retraction of the legs during swing .

In described in more detail in the paragraphs that follow evolving from a stance leg configuration compliant leg behavior as key to walk and run is generated by driving the soleus muscle SOL and the lumped vasti group muscles VAS with positive force feedbacks F . To prevent knee overextension the biarticular gastrocnemius muscle GAS is added using F and the VAS gets inhibited if the knee extends beyond a 170 threshold. To prevent ankle overextension the tibialis anterior muscle TA is added whose pulling of the ankle joint into a flexed position by positive length feedback L is suppressed under normal stance conditions by negative force feedback F from soleus. To allow leg swings an upper body is added . It is driven into a reference lean with respect to the vertical by the hip flexor HFL and co activated hip extensor muscles GLU HAM of the stance leg where the biarticular HAM prevents knee overextension resulting from hip extensor moments. The landing of the other leading leg initiates swing by adding subtracting a constant stimulation to HFL GLU respectively and by suppressing VAS proportionally to the load borne by the other leg . The actual leg swing is facilitated by HFL using L until it gets suppressed by L of HAM . HFL s stimulation is biased dependent on the upper body s lean at take off. Moreover using F for GLU and HAM retracts and straightens the leg toward the end of swing. Finally the now unsuppressed L of TA drives the ankle to a flexed position .

Stance leg compliance and stability. The bipedal spring mass model is used as the starting point for the conceptual basis for human locomotion . Although this model consists only of point mass that progresses on two massless spring legs it reproduces the center of mass dynamics observed in human walking and running unifying both gaits in one conceptual framework based on compliant leg behavior in stance Geyer H. Seyfarth A. Blickhan R. 2006. Compliant leg behaviour explains the basic dynamics of walking and running. Proc. R. Soc. Lond. B 273 2861 2867 .

To implement compliant behavior in neuromuscular legs each spring is replaced with thigh shank and foot and a soleus muscle SOL and a vasti muscle group VAS are added both generating their muscle activity through local positive force feedback F during the stance period of gait . This force reflex is modeled in the same way as in Geyer H. Seyfarth A. Blickhan R. 2003. Positive force feedback in bouncing gaits Proc. R. Soc. Lond. B 270 2173 2183. Under positive force feedback the stimulation Sm t of a muscle m is the sum of a pre stimulation S0 m and the muscle s time delayed t and gained G force Fm Sm t S0 m GmFm t tm .

While compliant leg behavior is essential it also threatens joint stability in segmented legs Seyfarth A. G nther M. Blickhan R. 2001. Stable operation of an elastic three segmented leg. Biol. Cybern. 84 365 382 G nther M. Keppler V. Seyfarth A. Blickhan R. 2004. Human leg design optimal axial alignment under constraints. J. Math. Biol. 48 623 646 . In segmented legs the knee and ankle torques and obey the static equilibrium h h where hand hare the perpendicular distances from the knee and the ankle to the leg force vector Fleg respectively. In effect a large extension torque at one joint forces the other joint closer to Fleg threatening its overextension for spring like behaving legs for details see Seyfarth A. G nther M. Blickhan R. 2001. Stable operation of an elastic three segmented leg. Biol. Cybern. 84 365 382 .

This tendency to overextend at the knee or the ankle is countered by adding the gastrocnemius GAS and tibialis anterior TA muscles . Like SOL and VAS the biarticular GAS uses local positive force feedback F during the stance period of gait. This muscle reflex not only prevents knee hyperextension resulting from large extension torques at the ankle but also contributes to generating an overall compliant leg behavior. In contrast the monoarticular TA uses local positive length feedback L with S t S G l l t where lis the TA fiber length and lis a length offset. Flexing the foot TA s L prevents the ankle from overextending when large knee torques develop. This muscle reflex is not required however if sufficient activity of the ankle extensor muscles preserves the torque equilibrium of knee and ankle. To avoid that TA unnecessarily fights SOL in this situation the TA stimulation is inhibited with a negative force feedback F from the SOL resulting in S t S G l l t GF t t . To further protect the knee from hyperextending the VAS gets inhibited if the knee extends beyond a 170 deg threshold S t S GF t t k t t where k is a proportional gain 170 deg and is the knee angle. This reflex inhibition is only active if 0 and the knee is actually extending.

Upper body and its balance. In the next step of evolving from the conceptual spring mass model into a neuromuscular biped the point mass representation is discarded and an upper body around which the legs can be swung is introduced. This upper body combines head arms and trunk HAT . To balance the HAT during locomotion to each leg is added a gluteus muscle group GLU and a hip flexor muscle group HFL . The GLU and the HFL are stimulated with a proportional derivative signal of the HAT s forward lean angle with respect to gravity S k kd dt where kand kare the proportional and derivative gains and is a reference lean angle for similar approaches compare for instance G nther M. Ruder H. 2003. Synthesis of two dimensional human walking a test of the model. Biol. Cybern. 89 89 106 . Also included is the biarticular hamstring muscle group HAM with S Sto counter knee hyperextension that results from a large hip torque developed by the GLU when pulling back the heavy HAT . Since hip torques can only balance the HAT if the legs bear sufficient weight the stimulations of the GLU HAM and HFL are modulated for each leg proportionally to the amount of body weight it bears. As a result each leg s hip muscles contribute to the HAT s balance control only during stance.

Swing leg pro and retraction. The human model s structure is complete except for a muscle reflex control that produces swing leg pro and retraction. It is assumed that a stance leg s functional importance reduces in proportion to the amount of body weight bw borne by the contralateral leg and initiate swing leg protraction already in double support . The human model detects which leg enters stance last contralateral leg and suppresses F of the ipsilateral leg s VAS in proportion to the weight the contralateral leg bears S t S GF t t k t t k F . The contralateral suppression allows the knee to break its functional spring behavior and flex while the ankle extends pushing the leg off the ground and forward. While this catapult mechanism can initiate swing only if the ankle pushes sufficiently the model further prepares swing leg protraction by increasing the stimulation of the HFL and decreasing that of the GLU by a fixed amount S in double support.

During actual swing the main reliance is on a leg s ballistic motion but it is influenced in two ways . On one hand protraction of the swing leg is facilitated. The HFL is stimulated using positive length feedback L biased by the forward pitch angle of the HAT at the stance to swing transition S t S k G l l t . Using this approach it is ensured that the swing leg s ballistic motion gains the momentum to bring it forward in time Mochon S. McMahon T. 1980. Ballistic walking. J. Biomech. 13 1 49 57 .

Furthermore the swing leg is also prevented from overreaching and its retraction is ensured. If legs reach and maintain a proper orientation during swing legged systems self stabilize into a gait cycle McGeer T. 1990. Passive dynamic walking. Int. J. Rob. Res. 9 2 62 82 Seyfarth A. Geyer H. G nther M. Blickhan R. 2002. A movement criterion for running. J. of Biomech. 35 649 655 Ghigliazza R. Altendorfer R. Holmes P. Koditschek D. 2003. A simply stabilized running model. SIAM J. Applied. Dynamical Systems 2 2 187 218 Geyer H. Seyfarth A. Blickhan R. 2006. Compliant leg behaviour explains the basic dynamics of walking and running. Proc. R. Soc. Lond. B 273 2861 2867 . The tolerance of this mechanical self stability against disturbances can largely be enhanced if swing legs additionally retract before landing Seyfarth A. Geyer H. 2002. Natural control of spring like running optimized self stabilization. In Proceedings of the 5th international conference on climbing and walking robots. Professional Engineering Publishing Limited pp. 81 85 Seyfarth A. Geyer H. Herr H. M. 2003. Swing leg retraction a simple control model for stable running. J. Exp. Biol. 206 2547 2555 . To implement this halt and retract strategy three muscle reflexes are included in the human model. The overreaching of the swing leg that would result from the forward impulse the leg receives when the knee reaches full extension during protraction is prevented. Hereto the HFL s L is inhibited proportional to the stretch which the HAM receives in swing S t k TO G l l t G l l t . In addition F is used for the GLU S t S GF t t and for the HAM S t S GF t t to ensure that dependent on the actual protraction momentum the swing leg not only halts but also transfers part of this momentum into leg straightening and retraction. Finally the TA L introduced to ensure foot clearance is kept throughout the swing. The SOL GAS and VAS remain silent during this phase.

Reflex control parameters. The different reflex contributions to the muscle stimulations Sm t are governed through the equations used in the model. No parameter optimization was performed. Parameters were derived from previous knowledge of reflex behavior F L or by making plausible estimates. All muscle stimulations are limited in range from 0.01 to 1 before being translated into muscle activations A t . Table 1 presents the stance reflex equations used in the preferred embodiment.

Results. Although the human model has no central pattern generator CPG that feed forwardly activates its muscles it switches for each leg between the different reflexes for stance and swing using sensors located at the ball and heel of each foot to detect ground. As a result the model s dynamic interaction with its mechanical environment becomes a vital part of generating muscle activities. graphically depicts pattern generation according to this aspect of the invention. In instead of a central pattern reflexes generate the muscle stimulations S . Left L and right R leg have separate stance and swing reflexes which are selected based on contact sensing from ball and heel sensors . The reflex outputs depend on mechanical inputs M intertwining mechanics and motor control.

Walking gait. To study how important this interdependence of mechanics and motor control can be to human locomotion the model was started with its left leg in stance and its right leg in swing at a normal walking speed v0 1.3 ms 1. Since the modeled muscle reflexes include time delays of up to 20 ms all muscles are silent at first. depict walking of a human model self organized from dynamic interplay between model and ground and the corresponding ground reaction force respectively according to one aspect of the present invention. In snapshots of human model taken every 250 ms and corresponding model GRF are shown with separate plots for left and right legs 30 Hz low pass filtered . Starting with a horizontal speed of 1.3 ms the model slows down in the first two steps but then rapidly recovers into walking at the same speed. Leg muscles are shown only for the right leg indicating muscle activation 10 . Initial conditions for definition of ankle knee and hip angle for each leg were 85 deg 175 deg 175 deg left leg and 90 deg 175 deg 140 deg right leg .

Because of these disturbed initial conditions the model slightly collapses and slows down in its first step . If its parameters are chosen properly however the model rapidly recovers in the following steps and walking self organizes from the dynamic interplay between model and ground. Here the vertical ground reaction force GRF of the legs in stance shows the M shape pattern characteristic for walking gaits indicating similar whole body dynamics of model and humans for steady state walking.

Steady state patterns of angles torques and muscle activations. This similarity also holds upon closer inspection the model shows qualitative agreement with angle torque and muscle activation patterns known from human walking data. compare steady state walking at 1.3 msfor the model and a human subject for hip knee and ankle respectively according to one aspect of the present invention. In normalized to one stride from heel strike to heel strike of the same leg the model s steady state patterns of muscle activations torques and angles of hip knee and ankle are compared to human walking data adapted from Perry 1992 . Vertical dotted lines around 60 of stride indicate toe off. Compared muscles are adductor longus HFL upper gluteus maximum GLU semimembranosis HAM and vastus lateralis VAS .

The strongest agreement between model prediction and walking data can be found at the ankle . The reflex model not only generates ankle kinematics and torques observed for the human ankle in walking but also predicts SOL TA and GAS activities that resemble the experimental SOL TA and GAS activities as inferred from their surface electromyographs. For SOL and GAS this activity is generated exclusively by their local F reflexes in stance. For TA its L reflex responds with higher activity to plantar flexion of the foot in early stance but gets suppressed by F from SOL during the remainder of that phase. Only when SOL activity reduces at the transition from stance to swing 60 of stride does the TA s L resume pulling the foot against plantar flexion.

The comparison shows a weaker agreement for the knee and the hip. For instance although the general trajectory of the human knee is captured by the model its knee flexes about 10 degree or 30 more than the human s in early stance . Related to this larger knee flexion the model lacks the observed VAS activity in late swing that continues into early stance. Only after heel strike the F of VAS engages and can activate the muscle group in response to the loading of the leg. The delay in extensor activities causes not only a relatively weak knee in early stance but also the heavy HAT to tilt forward after impact. Since the balance control of the HAT engages gradually with the weight borne by the stance leg the balance reflexes are silent until heel strike and then must produce unnaturally large GLU and HAM activities to return the HAT to its reference lean . Hence the model s hip trajectory and torque pattern least resemble that of humans whose hip extensors GLU and HAM are active before impact and can prevent such an exaggerated tilt of the trunk.

Self adaptation to ground changes. Despite its limited reflex control the human model tolerates sudden and self adapts to permanent changes of the ground level. show an example in which the model encounters a sequence of stairs going up 4 cm each. depict adaptation to walking up stairs including snapshots of the model net work extensor muscle activation patterns and the corresponding ground reaction force according to one aspect of the present invention. In approaching from steady state walking at 1.3 ms eight strides of the human model are shown covering five steps of 4 cm incline each. The model returns to steady state walking on the 8th stride. One stride is defined from heel strike to heel strike of the right leg. Shown in are snapshots of the model at heel strike and toe off of the right leg. For this leg are further shown in the net work during stance generated at hip knee and ankle with positive work being extension work in the activation patterns of the five extensor muscles of each stride and in the corresponding ground reaction forces normalized to body weight bw with ground reaction forces of the left leg are included for comparison.

Approaching from steady state walking 1st stride the model hits the stairs at the end of the 2nd stride with the foot of its outstretched right leg . This early impact slows down the model and tilts the upper body forward which is countered by a large hip torque generated by the GLU and HAM 3rd stride . Since hip extension torques tend to also extend the knee the VAS does not feel as much force as in steady state and its force feedback control lowers its muscle stimulation even though the net work at the knee during stance remains about the same as in steady state. In contrast the slow down of the model reduces the force the ankle extensors GAS and SOL feel during stance and their force feedback reflexes produce slightly less muscle stimulation lowering the net work of the ankle . In strides and the model settles into upstair walking at about 1 mswhere the forward and upward thrust is generated mainly at the hip and knee. After reaching the plateau in the 6th stride the model recovers into its original steady state walking speed of 1.3 msin the 8th stride.

For both walking up and down stairs no single control is responsible. The key to the model s tolerance and adaptation are its dynamic muscle reflex responses. The rebound of the stance leg depends on how much load the leg extensors SOL GAS and VAS feel which guarantees that the leg yields sufficiently to allow forward progression when going up but brakes substantially when going down. On the other hand the forward propulsion of the swing leg varies with the model dynamics. Sudden deceleration after impact of the opposite leg forward lean of the upper body and ankle extension rate near the end of stance all contribute to leg propulsion in swing. These combined features ensure that the swing leg protracts enough in upstair walking and substantially in downstair walking. For the latter the force feedbacks of GLU and HAM constrain excess rotations of the leg and instead force it to rapidly retract and straighten.

Muscle tendon units. All 14 muscle tendon units MTUs of the biped have the same model structure. is a schematic of a muscle tendon model according to one aspect of the present invention. In active contractile element CE together with series elasticity SE form the muscle tendon unit MTU in normal operation. If CE stretches beyond its optimum length l l l parallel elasticity PE engages. Conversely buffer elasticity BE prevents the active CE from collapsing if SE is slack l l

As seen in an active Hill type contractile element CE produces force in line with a series elasticity SE . Although the MTUs are fitted into the skeleton such that the individual CEs operate mainly on the ascending limb of their force length relationship the MTU model includes a parallel elasticity PE which engages if the CE stretches beyond its optimum length l. In addition a buffer elasticity BE ensures that the CE cannot collapse when the geometry of the leg shortens the MTU so much that it becomes slack. Note that BE is merely a numerical tool that allows the MTU to describe a slack muscle for instance a slack GAS when the knee overly flexes. BE does however not result in forces outside the MTU.

Table 3 presents individual MTU parameters. All parameters are estimated from Yamaguchi et al. Yamaguchi G. T. Sawa A. G. U. Moran D. W. Fessler M. J. Winters J. M. 1990. A survey of human musculotendon actuator parameters. In Winters J. Woo S. Y. Eds. Multiple Muscle Systems Biomechanics and Movement Organization. Springer Verlag New York pp. 717 778 . The maximum isometric forces Fare estimated from individual or grouped muscle physiological cross sectional areas assuming a force of 25N per cm. The maximum contraction speeds vare set to 6lsfor slow muscles and to 12lsfor medium fast muscles. The optimum CE lengths land the SE slack lengths lreflect muscle fiber and tendon lengths.

Details on how CE and SE were modeled can be found in Geyer et al. Geyer H. Seyfarth A. Blickhan R. 2003. Positive force feedback in bouncing gaits Proc. R. Soc. Lond. B 270 2173 2183 . The force of the CE F A Ff l f v is i a product of muscle activation A CE force length relationship f l and CE force velocity relationship f v . Based on this product approach the MTU dynamics are computed by integrating the CE velocity v which is found by inverting f v . Given that F F FP F f v F F F A Ff l . This equation has a numerically critical point during muscle stretch when F Fapproaches zero. To speed up simulations this critical point is avoided by introducing f v into the force production of the parallel elasticity F l l f v . Note that PE engages outside the normal range of operation in the model and like BE plays a minor role for the muscle dynamics during normal locomotion. With this approach however f v F F A Ff l F is obtained which can numerically be integrated using coarse time steps. While this approach is convenient to speed up the model simulation it was also critical when muscle dynamics were emulated on PC boards with fixed and limited time resolution.

The MTUs have common and individual parameters. The common parameters include the time constant of the excitation contraction coupling t 0.01 the CE force length relationship s width w 0.56l and residual force factor c 0.05 the CE force velocity relationship s eccentric force enhancement N 1.5 and shape factor K 5 and the SE reference strain 0.04 for details see Geyer H. Seyfarth A. Blickhan R. 2003. Positive force feedback in bouncing gaits Proc. R. Soc. Lond. B 270 2173 2183 . Also common parameters are the PE reference strain w where F F l l 1 f v and the BE rest length l l w and its reference compression w 2 where F F l l l . The individual MTU attachment parameters are readily available from the literature and distinguish each muscle or muscle group. Their values are listed in Table 4.

Musculoskeletal connections and mass distribution. The MTUs connect to the skeleton by spanning one or two joints. The transfer from muscle forces Fto joint torques is modeled using variable lever arms r rcos for the ankle and knee where is the joint angle is the angle at which rreaches its maximum and r F. For the hip it is simply assumed that r r. On the other hand changes lin MTU lengths are modeled as l r sin sin for the ankle and knee and as l r for the hip. The reference angle is the joint angle where l l l. The factor accounts for muscle pennation angles and ensures that an MTU s fiber length stays within physiological limits throughout the working range of the joint. The specific parameters for each muscle and joint are listed in Table 4. These values are either supported by experimental evidence Muraoka T. Kawakami Y. Tachi M. Fukunaga T. 2001. Muscle fiber and tendon length changes in the human vastus lateralis during slow pedaling. J. Appl. Physiol. 91 2035 2040 Maganaris C. 2001. Force length characteristics of in vivo human skeletal muscle. Acta Physiol. Scand. 172 279 285 Maganaris C. 2003. Force length characteristics of the in vivo human gastrocnemius muscle. Clin. Anat. 16 215 223 Oda T. Kanehisa H. Chino K. Kurihara T. Nagayoshi T. Kato E. Fukunaga T. Kawakami Y. 2005. In vivo length force relationships on muscle fiver and muscle tendon complex in the tibialis anterior muscle. Int. J. Sport and Health Sciences 3 245 252 or were obtained through rough anatomical estimates.

The seven segments of the human model are simple rigid bodies whose parameters are listed in Table 5. Their values are similar to those used in other modeling studies for instance in G nther and Ruder G nther M. Ruder H. 2003. Synthesis of two dimensional human walking a test of the model. Biol. Cybern. 89 89 106 . The segments are connected by revolute joints. As in humans these joints have free ranges of operation 70 

Ground contacts and joint limits. Each foot segment of the bipedal model has contact points at its toe and heel. When impacting the ground a contact point CP gets pushed back by a vertical reaction force F Fff which like the muscle force is the product of a force length relationship f y y yand a force velocity relationship f dy dt 1 dy dt v . This product approach to modeling vertical reaction forces is similar to existing approaches that describe the vertical force as the sum of a spring and a nonlinear spring damper term Scott S. Winter D. 1993. Biomechanical model of the human foot kinematics and kinetics during the stance phase of walking. J. Biomech. 26 9 1091 1104 Gerritsen K. van den Bogert A. Nigg B. 1995. Direct dynamics simulation of the impact phase in heel toe running. J. Biomech. 28 6 661 668 G nther M. Ruder H. 2003. Synthesis of two dimensional human walking a test of the model. Biol. Cybern. 89 89 106 . By separating spring and damper terms however the parameters of the contact model can be interpreted as two basic material properties a ground stiffness k F yand a maximum relaxation speed v which characterizes how quickly the ground surface can restore its shape after being deformed. For instance v describes a perfectly elastic ground impact where the ground always pushes back against the CP and v 0 describes a perfectly inelastic impact where the ground like sand pushes back on the CP for downward velocities but cannot push back for upward velocities. Note that the same impact model is used to describe the mechanical soft limits of the model s joints see previous section with a soft limit stiffness of 0.3N m degand a maximum relaxation speed of 1 deg s.

In addition to the vertical reaction force a horizontal reaction force is applied to the CP during ground contact. Initially this force is modeled as a kinetic friction force that opposes the CP s motion on the ground with a force F F. When the CP slows down to below a speed v the horizontal reaction force is modeled as a stiction force computed in a manner similar to that in which the vertical impact force is computed . Stiction changes back to kinetic friction if the stiction force exceeds a limit force F F. Thus dependent on the transition conditions both types of horizontal reaction force interchange until the CP leaves the ground surface.

The results suggest that mechanics and motor control cannot be viewed separately in human locomotion. A neuromuscular model of human locomotion according to one aspect of the invention self organizes into the walking gait after an initial push tolerates sudden changes in ground level and adapts to stair walking without interventions. Central to this model s tolerance and adaptiveness is its reliance on muscle reflexes which integrate sensory information about locomotion mechanics into the activation of the leg muscles. Having no CPG the model shows that in principle no central input is required to generate walking motions suggesting that reflex inputs that continuously mediate between the nervous system and its mechanical environment may even take precedence over central inputs in the control of normal human locomotion.

In addition the model results suggest that these continuous reflex inputs encode principles of legged mechanics. Current experimental and modeling research on the role of spinal reflexes during locomotion focuses on their contribution to the timing of swing and stance phases and to the production of muscle force in load bearing extensor muscles Pang M. Y. Yang J. F. 2000. The initiation of the swing phase in human infant stepping importance of hip position and leg loading. J Physiol 528 Pt 2 389 404 Dietz V. 2002. Proprioception and locomotor disorders. Nat Rev Neurosci 3 10 781 790 Ivashko D. G. Prilutski B. I. Markin S. N. Chapin J. K. Rybak I. A. 2003. Modeling the spinal cord neural circuitry controlling cat hindlimb movement during locomotion. Neurocomputing 52 54 621 629 Yakovenko S. Gritsenko V. Prochazka A. 2004. Contribution of stretch reflexes to locomotor control a modeling study. Biol Cybern 90 2 146 155 Ekeberg O. Pearson K. 2005. Computer simulation of stepping in the hind legs of the cat an examination of mechanisms regulating the stance to swing transition. J Neurophysiol 94 6 4256 4268 Maufroy C. Kimura H. Takase K. 2008. Towards a general neural controller for quadrupedal locomotion. Neural Netw 21 4 667 681 Donelan J. M. Pearson K. G. 2004. Contribution of sensory feedback to ongoing ankle extensor activity during the stance phase of walking. Can J Physiol Pharmacol 82 8 9 589 598 Frigon A. Rossignol S. 2006. Experiments and models of sensorimotor interactions during locomotion. Biol Cybern 95 6 607 627 Grey M. J. Nielsen J. B. Mazzaro N. Sinkjaer T. 2007. Positive force feedback in human walking. J Physiol 581 1 99 105 . The reflex contribution to load bearing has started to link positive force feedback to the underlying dynamics of the locomotor system Prochazka A. Gillard D. Bennett D. 1997. Positive force feedback control of muscles. J. of Neurophys. 77 3226 3236 Geyer H. Seyfarth A. Blickhan R. 2003. Positive force feedback in bouncing gaits Proc. R. Soc. Lond. B 270 2173 2183 . There appears to be no previous work that systematically expands on the idea of encoding principles of legged dynamics in the motor control system. While some of the muscle reflexes implemented in the human model were simple expedients to let it enter cyclic motions trunk balance swing leg initiation mainly the stance phase reflexes encoded principles of legged dynamics and control described previously including compliant stance leg behavior Blickhan R. 1989. The spring mass model for running and hopping. J. of Biomech. 22 1217 1227 McMahon T. Cheng G. 1990. The mechanism of running how does stiffness couple with speed J. of Biomech. 23 65 78 Geyer H. Seyfarth A. Blickhan R. 2006. Compliant leg behaviour explains the basic dynamics of walking and running. Proc. R. Soc. Lond. B 273 2861 2867 stabilization of segmented chains Seyfarth A. G nther M. Blickhan R. 2001. Stable operation of an elastic three segmented leg. Biol. Cybern. 84 365 382 G nther M. Keppler V. Seyfarth A. Blickhan R. 2004. Human leg design optimal axial alignment under constraints. J. Math. Biol. 48 623 646 and swing leg retraction Herr H. McMahon T. 2000. A trotting horse model. Int. J. Robotics Res. 19 566 581 Herr H. McMahon T. 2001. A galloping horse model. Int. J. Robotics Res. 20 26 37 Herr H. M. Huang G. T. McMahon T. A. April 2002. A model of scale effects in mammalian quadrupedal running. J Exp Biol 205 Pt 7 959 967 Seyfarth A. Geyer H. 2002. Natural control of spring like running optimized self stabilization. In Proceedings of the 5th international conference on climbing and walking robots. Professional Engineering Publishing Limited pp. 81 85 Seyfarth A. Geyer H. Herr H. M. 2003. Swing leg retraction a simple control model for stable running. J Exp. Biol. 206 2547 2555 . Based on these functional reflexes the model not only converges to known joint angle and torque trajectories of human walking but also predicts some individual muscle activation patterns observed in walking experiments. This match between predicted and observed muscle activations suggests that principles of legged mechanics could play a larger role in motor control than anticipated before with muscle reflexes linking these principles into the neural networks responsible for locomotion.

In a preferred embodiment the neuromechanical model of the invention has been implemented as a muscle reflex controller for a powered ankle foot prosthesis. This embodiment is an adaptive muscle reflex controller based on simulation studies that utilizes an ankle plantar flexor comprising a Hill type muscle with a positive force feedback reflex. The model s parameters were fitted to match the human ankle s torque angle profile as obtained from level ground walking measurements of a weight and height matched intact subject walking at 1 m sec. Using this single parameter set clinical trials were conducted with a transtibial amputee walking on level ground ramp ascent and ramp descent conditions. During these trials an adaptation of prosthetic ankle work was observed in response to ground slope variation in a manner comparable to intact subjects without the difficulties of explicit terrain sensing. Specifically the energy provided by the prosthesis was directly correlated to the ground slope angle. This study highlights the importance of neuromuscular controllers for enhancing the adaptiveness of powered prosthetic devices across varied terrain surfaces.

In order to produce a controller with the ability to adapt the neuromuscular model with a positive force feedback reflex scheme as the basis of control of the invention was used as part of the control system for a powered ankle foot prosthesis. The controller presented here employs a model of the ankle foot complex for determining the physical torque to command at the ankle joint. In this model the ankle joint is provided with two virtual actuators. For plantar flexion torque the actuator is a Hill type muscle with a positive force feedback reflex scheme. This scheme models the reflexive muscle response due to some combination of afferent signals from muscle spindles and Golgi tendon organs. For dorsiflexion torque an impedance is provided by a virtual rotary spring damper.

The parameters of this neuromuscular model were fitted by an optimization procedure to provide the best match between the measured ankle torque of an intact subject walking at a target speed of 1.0 m sec and the model s output torque when given as inputs the measured motion of the intact subject. The neuromuscular model based prosthetic controller was used to provide torque commands to a powered ankle foot prosthesis worn by an amputee. This control strategy was evaluated using two criteria. First the controller was tested for the ability to produce prosthesis ankle torque and ankle angle profiles that qualitatively match those of a comparable intact subject at a target level ground walking speed. The second performance criterion was the controller s ability to exhibit a biologically consistent trend of increasing gait cycle net work for increasing walking slope without changing controller parameters. Detecting variations in ground slope is difficult using typical sensors so a controller with an inherent ability to adapt to these changes is of particular value.

The ankle joint is a rolling bearing design joining a lower foot structure to an upper leg shank structure topped with a prosthetic pyramid fixture for attachment to the amputee s socket. The foot includes a passive low profile Flex Foot Osur to minimize ground contact shock to the amputee. A unidirectional leaf spring the parallel spring acts across the ankle joint engaging when the ankle and foot are perpendicular to each other. It acts in parallel to a powered drive train providing the passive function of an Achilles tendon. The powered drive train is a motorized link across the ankle joint as represented in . From the upper leg shank end it consists in series of a brushless motor Powermax EC 30 200 Watt 48V Maxon operating at 24V a belt drive transmission with 40 15 reduction and a 3 mm pitch linear ball screw. At this operating voltage the theoretical maximum torque that can be generated by the motor through the drivetrain is approximately 340 Nm.

At the foot the series spring a Kevlar composite leaf spring connects the foot to the ball nut with a moment arm r that is direction dependent. Therefore the effective rotary stiffness of the series spring as evaluated by locking the drive train and exerting a torque about the ankle joint is 533 N m rad for positive torque and 1200 N m rad for negative torque where positive torque or plantar flexion torque is that tending to compress the series spring as represented in . The drive train and the series spring together comprise a series elastic actuator SEA G. A. Pratt and M. M. Williamson Series elastic actuators Proceedings on IEEE RSJ International Conference on Intelligent Robots and Systems Pittsburgh pp. 399 406 1995 . The arrangement of these components is shown schematically in .

Sensors. A hall effect angle sensor at the ankle joint is a primary control input and has a range of 0.19 to 0.19 radians where zero corresponds to the foot being perpendicular to the shank. Joint angle is estimated with a linear hall effect sensor Allegro A1395 mounted on the main housing. This sensor is proximate to a magnet that is rigidly connected to the foot structure so that the magnetic axis is tangent to the arc of the magnet s motion. As a result of this arrangement the magnetic field strength at the sensor location varies as the magnet rotates past the sensor. Strain gauges are located inside the prosthetic pyramid attachment allowing for an estimate of the torque at the ankle joint. Strain gauges located on the series spring permit sensing of the output torque of the motorized drive train thereby allowing for closed loop force control of the SEA. The motor itself contains Hall effect commutation sensors and is fitted with an optical shaft encoder that enables the use of advanced brushless motor control techniques.

Microcontroller. Overall control and communications for the ankle foot prosthesis are provided by a single chip 16 bit DSP oriented microcontroller the Microchip Technology Incorporated dsPIC33FJ128MC706. The microcontroller operates at 40 million instructions per second with 128 kilo bytes of flash program memory and 16384 bytes of RAM. It provides adequate computation to support real time control.

Motor Controller. A second 16 bit dsPIC33FJ128MC706 was used as a dedicated motor controller. The high computation load and speed requirements of modern brushless motor control methodologies along with task isolation from the main microcontroller s real time demands motivated this architecture. A high speed digital link between the main microcontroller and the motor microcontroller supplied virtually instantaneous command of the motor.

Wireless Interface. For development and data collection a high speed serial port of the microcontroller is dedicated to external communications. This port may be used directly via cable or may have a wide variety of wireless communication devices attached. For the present study the 500 Hz sensor and internal state information is telemetered over the serial port at 460 Kilobaud and transmitted via an IEEE 802.11g wireless local area network device Lantronix Wiport .

Battery. All power for the prosthesis was provided by a 0.22 kg lithium polymer battery having a 165 Watt Hour kg energy density. The battery was able to provide a day s power requirements including 5000 steps of powered walking.

Optimal Mechanical Component Selection. Meeting the requirements for mass size torque speed energy efficiency shock tolerance and nearly silent operation is not a trivial task. Of particular importance is the modeling and optimization of the drive train for the production of the biological torques and motions of walking. Some effects of the motor selection overall transmission ratio series elastic spring and parallel spring are described in S. K. Au H. Herr On the Design of a Powered Ankle Foot Prosthesis The Importance of Series and Parallel Elasticity IEEE Robotics Automation Magazine. pp. 52 59 September 2008.

Control Architecture. The purpose of the control architecture is to command an ankle torque appropriate to the amputee s gait cycle as determined from available sensor measurements of prosthetic ankle state. The controller determines the appropriate torque using a neuromuscular model of the human ankle foot complex. In this model a hinge joint representing the human ankle joint is actuated by two competing virtual actuators a unidirectional plantar flexor which is a Hill type muscle model and a dorsiflexor which acts as either a bi directional proportional derivative position controller or a unidirectional virtual rotary spring damper depending on the gait phase. A finite state machine maintains an estimate of the phase of the amputee s gait. Depending on this estimated gait phase one or the other or both of the virtual actuators produce torques at the virtual ankle joint. The net virtual torque is then used as the ankle torque command to the prosthesis hardware. Physical torque at the ankle joint is produced by both the motorized drive train and the parallel spring. The ankle angle sensor is used to determine the torque produced by the parallel spring and the remaining desired torque is commanded through the motor controller.

Top Level State Machine Control. Top level control of the prosthesis is implemented by a finite state machine synchronized to the gait cycle. During walking two states are recognized swing phase and stance phase. Prosthesis sensor inputs ankle torque as estimated from the pyramid strain gauges ankle angle and motor velocity are continuously observed to determine state transitions. Conditions for these state transitions were experimentally determined. depicts the operation of the state machine and the transition conditions. The dorsiflexor and plantar flexor virtual actuators develop torque depending on the gait state estimate from the state machine.

In the swing state is visually depicted as SW and stance is divided into controlled plantar flexion CP controlled dorsiflexion CD and powered plantar flexion PP . State transitions are determined using the prosthesis ankle torque T as measured from the pyramid strain gauges and prosthesis ankle angle .

The transition to swing phase when the foot leaves the ground is detected by either a drop in total ankle torque to less than 5 N m as measured using the pyramid strain gauges or a drop in measured ankle angle below 0.19 radians to prevent angle sensor saturation. Positive torque is defined as actuator torque tending to plantar flex the ankle and positive angles correspond to dorsiflexion. To prevent premature state transitions the ankle torque developed during the stance phase must exceed 20 N m for these transitions to be enabled. In addition a 200 ms buffer time provides a minimum time frame for the stance period. The transition to stance phase upon heel strike is detected by a decrease in torque below 7 N m as measured using the pyramid strain gauges.

A block diagram of an exemplary embodiment of a control system for an ankle foot prosthesis according to this aspect of the invention is shown in . Depicted in are neuromuscular model and biomimetic robotic limb . Robotic limb includes torque control system and robotic limb joint . Torque control system includes parallel spring model lead compensator friction compensator and motor controller .

The prosthesis measured ankle state dot over is used to produce a torque command from the neuromuscular model . This desired ankle torque is fed through a torque control system to obtain a current command to the prosthesis actuator. The three primary components of this torque control system are the feedforward gain K lead compensator and friction compensation term. The parallel spring contribution to prosthesis ankle torque is subtracted from the desired ankle torque to obtain the desired actuator torque . The closed loop torque controller then enforces the desired actuator torque using the measured actuator torque . Finally the friction compensation term produces an additional torque value which is added to the output of the closed loop torque controller.

Dorsiflexor Model. depict an exemplary embodiment of the musculoskeletal model as implemented on the prosthetic microcontroller including the Hill type muscle model and spring damper attachments to the two link ankle joint model detailed Hill type muscle model and geometry of the muscle model skeletal attachment including the variable moment arm implementation and angle coordinate frame for the muscle model. Depicted in are mechanical representations of dorsiflexor spring damper planar flexor MTC foot shank and heel .

The dorsiflexor in is the dorsiflexor actuator. It represents the Tibialis Anterior and other biological dorsiflexor muscles. This dorsiflexor is implemented as a virtual rotary spring damper with a set point of 0 dot over 0 and relation dot over . 1 

Here Kis the spring constant and Kis the damping constant is the ankle angle and dot over is the ankle angular velocity. For the stance phase the value of Kwas optimized along with other muscle model parameters to best match the stance phase behavior of the biological ankle for normal level ground walking. The damping term K was experimentally tuned for stance phase to 5 Nm s rad to prevent the forefoot from bouncing off the ground at foot flat. Also during the stance phase the dorsiflexor acts only to provide dorsiflexion torque so to mimic the unidirectional property of biological muscles. Furthermore when the torque generated by the dorsiflexor drops to zero during stance as a result of the foot becoming perpendicular to the shank the dorsiflexor is disabled for the remainder of the stance phase. Therefore the dorsiflexor only contributes to the torque production early in the stance phase when human dorsiflexor muscles are known to play a significant role J. Perry Gait Analysis Normal and Pathological Function New Jersey SLACK Inc. 1992 Chapter 4 pp. 55 57 . In the swing phase the dorsiflexor acts as a position controller driving the foot to the set point 0 dot over 0 . For this a gain of K 220 N m rad and damping constant of K 7 N m s rad provides for quick ground clearance of the foot early in the swing phase.

Plantar Flexor Model. The virtual plantar flexor in comprises a muscle tendon complex MTC which represents a combination of human plantar flexor muscles. The MTC is based on S. K. Au J. Weber and H. Herr Biomechanical design of a powered ankle foot prosthesis Proc. IEEE Int. Conf. On Rehabilitation Robotics Noordwijk The Netherlands pp. 298 303 June 2007 where it is discussed in further detail. It consists of a contractile element CE which models muscle fibers and a series element SE which models a tendon. The contractile element consists of three unidirectional components a Hill type muscle with a positive force feedback reflex scheme a high limit parallel elasticity and a low limit or buffer parallel elasticity. In series with the contractile element is the series element which is a nonlinear unidirectional spring representing the Achilles tendon. The attachment geometry of the muscle tendon complex to the ankle joint model is nonlinear complicating the calculation of torques resulting from the actuator force.

Plantar Flexor Series Elastic Element. The series elastic element SE operates as a tendon in series with the muscle contractile element as in H. Geyer A. Seyfarth R. Blickhan Positive force feedback in bouncing gaits Proc. R Society. Lond. B 270 pp. 2173 2183 2003 . Taking as the tendon strain defined as 

Plantar Flexor Contractile Element. The contractile element CE of the plantar flexor virtual actuator is a Hill type muscle model with a positive force feedback reflex scheme. It includes active muscle fibers to generate force and two parallel elastic components as in H. Geyer H. Herr A muscle reflex model that encodes principles of legged mechanics predicts human walking dynamics and muscle activities Submitted for publication . The Hill type muscle fibers exert a unidirectional force. This force is a function of the muscle fiber length l velocity v and muscle activation A. The resulting force Fis as in H. Geyer A. Seyfarth R. Blickhan Positive force feedback in bouncing gaits Proc. R Society. Lond. B 270 pp. 2173 2183 2003 given by 4 The force length relationship f l of the Hill type muscle is a bell shaped curve given by 

Following H. Geyer H. Herr A muscle reflex model that encodes principles of legged mechanics predicts human walking dynamics and muscle activities Submitted for publication the force length relationship for the high limit parallel elasticity HPE set in parallel with the CE is given by 

Reflex Scheme. The contractile element activation A is generated using the positive force feedback reflex scheme shown in as in H. Geyer H. Herr A muscle reflex model that encodes principles of legged mechanics predicts human walking dynamics and muscle activities Submitted for publication H. Geyer A. Seyfarth R. Blickhan Positive force feedback in bouncing gaits Proc. R Society. Lond. B 270 pp. 2173 2183 2003 . depicts an exemplary embodiment of a reflex scheme for the virtual plantar flexor muscle including the relationship among ankle angle muscle force and the plantar flexor component of ankle torque.

As depicted in this feedback loop includes a stance phase switch for disabling the plantar flexor force development during the swing phase. During stance the plantar flexor force F is multiplied by a reflex gain Gain delayed by Delayand added to an offset stimulation PRESTIM to obtain the neural stimulation signal. The stimulation is constrained to range from 0 to 1 and is low pass filtered with time constant T to simulate the muscle excitation contraction coupling. The resulting signal is used as activation in equation 4 with an initial value of PreA. In addition a suppression gain Gain following H. Geyer H. Herr A muscle reflex model that encodes principles of legged mechanics predicts human walking dynamics and muscle activities Submitted for publication was implemented to help prevent the two actuators from fighting each other during stance. Here the torque generated by the dorsiflexor is reduced by either Gain For until its value drops to zero.

Plantar Flexor Geometry and Implementation. Within the muscle model framework the ankle angle is defined as shown in . Using this angle as the input to the model the length of the muscle tendon complex is calculated as in H. Geyer H. Herr A muscle reflex model that encodes principles of legged mechanics predicts human walking dynamics and muscle activities Submitted for publication by sin sin . 12 where is a scaling factor representing the pennation angle of the muscle fibers and is the ankle angle at which l lunder no load.

The fiber length lcan be computed using l l l where lis obtained from the inverse of 3 given the current value of F F Ffrom the muscle dynamics. The fiber contraction velocity v can then be obtained via differentiation. This creates a first order differential equation governed by the dynamics of the neuromuscular model. This equation can be solved for Fgiven the time history of and initial condition. However since integration is computationally more robust than differentiation an integral form of this implementation was used to solve for F as described in H. Geyer H. Herr A muscle reflex model that encodes principles of legged mechanics predicts human walking dynamics and muscle activities Submitted for publication .

Given the attachment radius r and the angle at which maximum muscle tendon moment arm is realized the relationship between Fand the resulting plantar flexor contribution to ankle torque T is given by cos 13 where R is a variable moment arm resulting from the muscle attachment to the ankle joint model. This relationship is shown graphically in . Hence the plantar flexor model can ultimately be treated as a dynamical system linking a single input to a single output T.

Neuromuscular Model Parameter Determination. The plantar flexor model is a lumped representation of all of the biological plantar flexor muscles. Likewise the dorsiflexor represents all biological dorsiflexor muscles. In this work joint and torque measurements were taken only at the ankle joint. As a result the state of multi articular muscles such as the gastrocnemius could not be accurately estimated. Therefore the plantar flexor was based upon the dominant monarticular plantar flexor in humans the Soleus. Therefore the majority of the plantar flexor parameters values are those reported in H. Geyer H. Herr A muscle reflex model that encodes principles of legged mechanics predicts human walking dynamics and muscle activities Submitted for publication for the Soleus muscle. Some parameters of the plantar flexor as well as those for the dorsiflexor however were expected to either have been significantly affected by the lumped models or were not well known from biology. These six parameters were fitted using a combination of a Genetic Algorithm and gradient descent to enable the neuromuscular model to best match the walking data of an intact subject.

Non amputee Subject Data Collection. Kinetic and kinematic walking data were collected at the Gait Laboratory of Spaulding Rehabilitation Hospital Harvard Medical School in a study approved by the Spaulding committee on the Use of Humans as Experimental Subjects H. Herr M. Popovic Angular momentum in human walking The Journal of Experimental Biology Vol. 211 pp 487 481 2008 . A healthy adult male 81.9 kg was asked to walk at slow walking speed across a 10 m walkway in the motion capture laboratory after informed consent was given.

The motion capture was performed using a VICON 512 motion capture system with eight infrared cameras. Reflective markers were placed at 33 locations on the subject s body in order to allow the infrared cameras to track said locations during the trials. The cameras were operated at 120 Hz and were able to track a given marker to within approximately 1 mm. The markers were placed at the following bony landmarks for tracking the lower body bilateral anterior superior iliac spines posterior superior iliac spines lateral femoral condyles lateral malleoli forefeet and heels. Wands were placed over the tibia and femur and markers were attached to the wands over the mid shaft of the tibia and the mid femur. Markers were also placed on the upper body at the following sites sternum clavicle C7 and T10 vertebrae head and bilaterally on the shoulder elbow and wrist joints.

Ground reaction forces were measured using two staggered force plates model no. 2222 or OR6 5 1 by Advanced Mechanical Technology Inc. Watertown Mass. USA which were incorporated into the walkway. The precision of these force plates measuring ground reaction force and center of pressure is approximately 0.1 N and 2 mm respectively. The force plate data was collected at 1080 Hz and synchronized with the VICON motion capture data. Joint torques were calculated from the ground reaction forces and joint kinematics using a modified version of a standard inverse dynamics model. Vicon Bodybuilder by Oxford Metrics UK was used to perform the inverse dynamics calculations.

Six trials were obtained for a slow level ground walking speed 1.0 m s mean and a single trial was used to represent the target ankle and torque trajectories for this walking condition. The end of the stance phase was defined as the point in time when the joint torque first dropped to zero after the peak torque was reached in the gait cycle. This event occurred at 67 gait cycle for the selected trial.

Fitting of Model Parameters to Experimental Data via Optimization. The following parameters were chosen for tuning F Gain Gain and . The goal of the parameter tuning was to find the parameter set that would enable the neuromuscular model to best match a biological ankle torque trajectory for a particular walking condition given the corresponding biological ankle angle trajectory as input to the model. The cost function for the optimization was defined as the squared error between the biologic and model torque profiles during the stance phase given the biological ankle angle trajectory i.e. 

A Genetic Algorithm optimization was chosen to perform the initial search for optimal parameter values and a direct search was included to pinpoint the optimal parameter set. The Genetic Algorithm tool in Matlab was used to implement both optimization methods. The level ground human walking data at the selected 1.0 m s walking speed was used to provide the reference behavior for the optimization. The allowable range for each of the optimization parameters are shown in Table 7.

The initial population was chosen by the optimizer. The parameter values obtained from the parameter optimization are shown in Table 8.

Results of the parameter optimization. As a verification of the optimization effectiveness the optimization was run with the final parameters using the biological ankle angle profile as input to the neuromuscular model. A comparison of the resulting torque profile to the biologic torque profile is shown in .

As shown in a comparison of the ankle moment profile from the intact biological ankle to that of the neuromuscular model with the biological ankle angle profile as the input and with optimized parameter values are biological ankle moment grey line modeled dorsiflexor component dash dot line modeled plantar flexor muscle component thin line and total neuromuscular model plantar flexor and dorsiflexor moment dashed line . The neuromuscular model ankle moment matches the biological ankle moment almost exactly for most of the gait cycle.

Low Level Torque Control. The physical torque actually produced at the ankle joint during stance phase is from the combined actions of the parallel spring and the motorized drive train. The rotary parallel spring stiffness is approximately linear in the range of operation with a spring stiffness of 500 N m rad. Using this spring constant the parallel spring contribution is predicted and subtracted from the desired ankle torque. The remaining torque must be produced by the motorized drive train.

The performance of the motorized drive train is improved by use of lead compensation friction compensation and feed forward techniques as shown in . Experimental investigations of the open loop drive train dynamics were performed and used to implement these improvements M. Eilenberg A Neuromuscular Model Based Control Strategy for Powered Ankle Foot Prostheses Master s Thesis Massachusetts Institute of Technology Cambridge Mass. 2009 . The output torque versus commanded torque for level ground walking ramp ascent and ramp descent is shown in . The prosthesis output torque was estimated using the strain gauge on the series spring for the SEA torque contribution and the ankle angle based parallel spring torque estimate for the parallel spring torque contribution.

Clinical Evaluation. The prosthesis was placed on the right leg of a healthy active 75 kg transtibial amputee. The subject was allowed time to walk on the prosthesis for natural adjustment. The wireless link to the prosthesis was used to record the walking data from these trials. During the level ground walking trials the subject was asked to walk across a 10 m long path. The target intended walking speed was set to 1.0 m s to match that of the intact subject. The subject began walking approximately 5 m from the beginning of the pathway and stopped walking approximately 3 m past the end of the path. Markers on the ground were used to note the beginning and end of the 10 m path. A stopwatch was used to verify the average walking speed for each trial by noting when the subject s center of mass passed over each of the markers. A total of 10 trials were captured. Trials with walking speeds within 5 of the target speeds were used for processing resulting in 45 gait cycles. The subject was next asked to walk up an 11 degree 2 m long incline at a self selected speed. The subject started on level ground approximately 2 m from the start of the incline and stopped approximately 1 m past the incline on a platform for 10 ramp ascent trials. This same path was then navigated in reverse for 12 ramp descent trials.

Data Analysis. The first three and last three gait cycles of the level ground trials were assumed to be transients and were therefore ignored. Each of the remaining gait cycles were re sampled to span 1000 data points. Mean and standard deviation trajectories were computed from the resulting data. For both ramp ascent and descent the last step on the ramp was used as the representative gait cycle. Each selected gait cycle was re sampled and averaged in the same manner as described for the level ground trials.

The net work was calculated for each individual gait cycle by numerically integrating ankle torque over ankle angle from heel strike to toe off. Here the swing phase was ignored for the net work calculations. The average net work for each walking condition was then computed from the individual gait cycle net work values.

Results. Torque Tracking. A precondition of the present experiments was the ability of the ankle foot prosthesis to actually produce the torques and speeds that would be commanded by the neuromuscular controller. This ability is demonstrated in illustrating commanded torque versus measured output torque for level ground walking ramp ascent and ramp descent.

Adaptation to Ground Slope. The evaluation of ground slope adaptation of the neuromuscular model controlled prosthesis was confirmed by the clinical trial data of . The numerically integrated data of those trials gave net work values work loop areas as follows 

Comparison to a Biological Ankle. The purpose of this neuromuscular model is to represent the inherent dynamics of the human ankle foot complex in a useful way. Therefore one may evaluate the resulting prosthesis controller based upon its ability to mimic the human behavior. discussed previously show the level ground walking torque and angle profiles from the prosthesis along with those of a weight and height matched subject with intact limbs.

The measured ankle torque and ankle angle profiles of the prosthesis qualitatively match those of a comparable intact individual for level ground walking. The differences observed are of a low order and may reasonably be attributed to a number of factors including atrophy and or hypertrophy in the clinical subject s leg muscles resulting from amputation differences in limb lengths and perhaps the lack of a functional biarticular gastrocnemius muscle. In addition the limited range of the prosthetic angle sensor prohibited the prosthesis from reaching the full range of motion of the intact ankle.

Ground Slope Adaptation. The neuromuscular control presented here exhibits an inherent adaptation to ground slope without explicit sensing of terrain. The increased ankle net work during ramp ascent and the decreased ankle net work during ramp descent as compared to that of level ground walking is consistent with the behavior of an intact human ankle under the same conditions according to data from A. S. McIntosh K. T. Beatty L. N. Dwan and D. R. Vickers Gait dynamics on an inclined walkway Journal of Biomechanics Vol. 39 pp 2491 2502 2006 . This variation of stance phase positive net work across walking conditions indicates a slope adaptive behavior that is emergent of the neuromuscular model. The ability of the neuromuscular model to produce these biomimetic changes in behavior suggests that the model embodies an important characteristic of the human plantar flexor muscles. In addition it is anticipated that the model has the potential for speed adaptation. In an attempt to move faster the wearer may push harder on the prosthesis. This additional force could cause the modeled reflex to command higher virtual muscle forces resulting in greater energy output and hence higher walking speeds.

While a preferred embodiment is disclosed many other implementations will occur to one of ordinary skill in the art and are all within the scope of the invention. Each of the various embodiments described above may be combined with other described embodiments in order to provide multiple features. Furthermore while the foregoing describes a number of separate embodiments of the apparatus and method of the present invention what has been described herein is merely illustrative of the Appl. of the principles of the present invention. Other arrangements methods modifications and substitutions by one of ordinary skill in the art are therefore also considered to be within the scope of the present invention which is not to be limited except by the claims that follow.

