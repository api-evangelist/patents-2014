---

title: Image display of a centerline of tubular structure
abstract: Systems and methods for determining a centerline of a tubular structure from volumetric data of vessels where a contrast agent was injected into the blood stream to enhance the imagery for centerlining. Given a 3D array of scalar values and a first and second point, the system and methods iteratively find a path from the start position to the end position that lies in the center of a tubular structure. A user interface may be provided to visually present and manipulate a centerline of the tubular structure and the tubular structure itself.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09443303&OS=09443303&RS=09443303
owner: Calgary Scientific Inc.
number: 09443303
owner_city: Calgary, AB
owner_country: CA
publication_date: 20140509
---
This application claims priority to U.S. patent application Ser. No. 13 466 308 filed May 8 2012 entitled IMAGE DISPLAY OF A CENTERLINE OF TUBULAR STRUCTURE which claims priority to U.S. Provisional Patent Application No. 61 532 700 filed Sep. 9 2011 and U.S. Provisional Patent Application No. 61 561 582 filed Nov. 18 2011 each entitled Image Display of a Centerline of Tubular Structure. Each application above is incorporated herein by reference.

With the advent of sophisticated medical imaging modalities such as magnetic resonance computed tomography ultrasound and cone beam X ray imaging three dimensional 3D volumetric data sets can be reconstructed from a series of two dimensional 2D slices of an anatomical structure taken around an axis of rotation. Such 3D volumetric data may be displayed using volume rendering techniques so as to allow a physician to view any point inside the anatomical structure without the need to insert an instrument inside the patient s body.

To detect diagnose and treat blood vessel pathologies physicians and other healthcare professionals rely on the visual examination of 3D images and multiple 2D projection or cross sectional images. Recent advances in the medical image processing field have made available some software tools for semi automated quantification of vascular diseases. Software tools for semi automated quantification of the severity of blood vessel stenosis and the size of aneurysms are available for use today on some clinical image processing workstations. These tools typically analyze blood vessels through an idealized model of a blood vessel such as a tubular model with possible branching. One of general steps for analyzing the shape of blood vessels is the extraction of the centerline of these vessels. For diseases like aneurysms or stenosis the profile of the blood vessel diameter along the centerline abnormally expands or shrinks respectively.

Disclosed herein are systems and methods for determining a centerline of a tubular structure. The systems may include a computing device and the methods may be performed by a processor executing within the computing device. Volumetric data of vessels may be provided where a contrast agent was injected into the blood stream to enhance the imagery for centerlining. Given a 3D array of scalar values and a first and a second point seed points the system and methods iteratively find a path from the first point to the second point that lies in the center of a tubular structure by transforming the data associated with the curves. A user interface may be provided to visually present and manipulate a centerline of the tubular structure and the tubular structure itself.

In accordance with some implementations the methods may include receiving at a computing device volumetric data representative of the tubular structure and a selection of a first point and a second point along a length of the tubular structure initializing a minimal range of data values associated with a cross section of the tubular structure and iteratively generating positions associated with two discrete curves from each point toward the other point the positions initially moving along a direction vector defined at each point. Iteratively generating positions may include defining a cross section in a plane of the tubular structure and choosing a next point on each of the two discrete curves in accordance with a smallest area among plural cross sections determined at each next point on each of the two discrete curves. For each of the two discrete curves the method may include moving in a direction normal to the cross section having the smallest area determining if the discrete curves have terminated if the discrete curves have terminated then determining if a length of a result of a curve in a present iteration is shorter than a length of a curve as determined in a previous iteration and caching the result of the curve in the present iteration pass if it is determined that the length of the result of the curve in the present iteration is shorter otherwise maintaining the length of the curve as determined in the previous iteration. Next the method may include increasing the range of data values for a next iteration and terminating the iterative process when a length of a joined curve is longer than a joined curve of the previous iteration the joined curve of the previous iteration corresponding to the centerline otherwise returning to iteratively generating positions.

Other systems methods features and or advantages will be or may become apparent to one with skill in the art upon examination of the following drawings and detailed description. It is intended that all such additional systems methods features and or advantages be included within this description and be protected by the accompanying claims.

Unless defined otherwise all technical and scientific terms used herein have the same meaning as commonly understood by one of ordinary skill in the art. Methods and materials similar or equivalent to those described herein can be used in the practice or testing of the present disclosure. While implementations will be described for determining a centerline of a tubular vessel detecting branches and contouring of a tubular vessel and for determining a location of an aneurysm it will become evident to those skilled in the art that the implementations are not limited thereto.

The imaging scanner is operably connected to a computer system that controls the operation of the scanner and via a communication channel to an image processing system that processes the image data signals utilizing appropriate image processing software applications. The communication channel may be a direct peer to peer connection a network connection such as LAN a WAN or the Internet a wired or wireless connection etc. The image processing system has an image data archive or database an application server and a user workstation . The components of the image processing system are interconnected via a communications network that may be implemented by physical connections wireless communications or a combination. The image data archive or database is adapted to store the image data signals that are produced by the image scanner as well as the results of any additional operations on the image data signals by the other components of the image processing system . The image data archive or database may be a Picture Archiving and Communications System PACS . Other types of image data archives or databases may also be used.

The user workstation is adapted to control the operation of the imaging processing system and its various components. The user workstation may interact with the application server and the various image processing software applications that are stored in or are accessible by the application server . The user workstation may be any computing device such as a desktop computer dedicated workstation laptop notebook table computing device mobile device e.g. wireless handheld smartphone etc. The user workstation communicates via either a wired or wireless connection.

The application server also manages and coordinates the image data sets among the image processing applications. The image processing applications may include for example visualization applications computer aided diagnosis CAD applications medical image rendering applications anatomical segmentation applications or any other type of medical image processing application. The image processing applications may also include the methods of the present invention. The image data archive or database applications server and the user workstation may also each be connected to a remote computer network or computing device e.g. a remote device having the characteristics of the workstation as noted above for communication purposes or to access additional data or functionality. The workstation may comprise appropriate user interfaces like displays storage media input output devices etc.

The various components of the imaging system are conventional and well known components and may be configured and interconnected in various ways as necessary or as desired. The imaging system and in particular the image processing system is adapted to permit the imaging system to operate and to implement methods in accordance with the present disclosure for example as shown in .

With reference to a first example operational flow A begins when a 3D array of scalar values i.e. the volume data S is provided and two input points or seed points within the volume vessel are selected as a first point and a second point S . The scalar values provided at S are pixel intensity values. A user may be presented with a 2D display of the 3D array where the 2D display is slice along the axial sagittal or coronal planes three orthogonal views . From the 2D display the user may indicate the two input points at S when viewing the imagery using e.g. a mouse. In some implementations the two input points may be provided automatically by another system.

At S the algorithm is initialized by evaluating statistics local to the two input points. In particular at S at the first point and the second point the area of the tubular structure at that point and the associated range of data values are determined by detecting the steep gradient at the wall of the tubular structure. For example the cross section area may be measured for increasing values of data range. The correct cross sectional area and associated range is selected by locating the range of values that provides an appropriate minimum in the expansion of the area with changes in the range. Other metrics such as a standard deviation of the data values may be used to examine the data values. From these statistics an initial range of values pixel intensities is calculated that will be considered part of the tubular structure.

The range may be constrained so that it will initially be very small with respect to the full range of the data in order to reduce errors where a vessel is near another structure of potentially overlapping pixel intensities such as bones the base of the skull etc. As described below this enables the methods of the present disclosure to track a centerline that is parallel or adjacent to a bony structure e.g. the carotid siphon . In addition a smaller range of values will help ensure that if the process does not succeed it fails quickly. Throughout the process described below the range may be expanded or limited as necessary.

At S the flow enters an iterative loop that executes so long as the range has changed less than a configurable number of times see below . The process attempts to generate two discrete curves represented as Non Uniform Rational B Spline NURBS curves that start at the two input points and join at some position within the volume. The two curves are used to increase the likelihood of finding a curve that connects the two points when there are bifurcations trifurcations or more complex branches. For example if one of the curves goes down a wrong branch then the curve starting at the other point will join at the point where the first curve branches. In yet other circumstances the curves may not join indicating that both curves may have traveled down different branches of the tubular structure.

At S for each range the curves are initialized to start at the input points i.e. one from the first point and one from the second point. At S the initial direction vector for each curve is towards the other input point. Using the initial point and direction a plane is defined in the volume perpendicular to the direction and passing through the point a current point . This plane describes a cross section of the tubular structure. In order to choose the next point to add to the curve the direction is perturbed slightly in several directions. For example the direction may be perturbed in e.g. sixteen directions. Each of the perturbed directions results in another cross section. For each of these cross sections the area of the tubular structure is measured. The area is measured based on the requirement that values be connected and within the current range. The direction normal to the cross section with the smallest area is chosen as the direction to move.

At S a local search may be performed to determine and move to a pixel having a highest intensity. For example in the case of magnetic resonance MR data where the vessel is narrow it is likely that the pixel with the highest intensity value in the local region is the center of the vessel. To account for instances where a path defined by the above process is not passing through that pixel the local search looks for a pixel having a more intense value. The locality of the search may be limited to 2 minimum spacing units from the current point. If a pixel or pixels is found having a higher intensity the path is moved to the pixel having the highest intensity.

At S it is determined if the curves have terminated. This may be tested by determining if the intensity value at this new position is not within the current range. If so the curve is terminated. For example if the intensity at the new position was greater it is possible that the new position is in bone. If at S the curves have not terminated then the intensity value at this position is within the current range. As such the point is added to the curve. The curves are then tested at S to see if they have joined. If the curves are not joined the process of measuring the smallest cross sectional area to determine the next direction at S is repeated using the new position and direction. In accordance with some implementations the curves may be terminated if a resulting total length of the two distinct curves reaches a predetermined length e.g. 3000 mm.

If the curves are joined at S it is possible that the resulting curve may not follow the center of the tubular structure rather it may follow a tortuous path inside the tubular structure. To alleviate this condition the result may be cached at SA passing through SA in a first loop and the range increased at S to run the process again S S . The amount that the range is increased depends on the initial range the full range of the values in the dataset how much the range was increased the last time the range was increased etc. Thus the value of range that is used for the next attempt through the loop is updated in accordance with the details of the termination of the current attempt along with a history the previous attempts. As will be shown in changing the range enables the process of to take advantage of the principal that a curve following the center of a tubular structure is guaranteed to be shorter than one that follows a tortuous path inside the tubular structure. Thus after running through the process S S a subsequent time if the result of the process is better at SA then the result may cached at SA and so on. A better result is when the length of the curve is shorter than the length of the curve as determined in the previous pass through the loop. The process continues until it fails to find a curve connecting the two points or the resulting curve is longer than a previous result which likely means the range has become too large SA .

Returning back to S if both curves are terminated the process flows to S where the range is increased and the curves are reinitialized to start over at S. When the loop returns to S it is determined if the range is no longer okay. The test at S determines if the range has grown to greater than five times the initial range or if more than 20 iterations of the loop have been performed. If the range is no longer okay then it is determined if there is a result at S. The result may be determined to be a success at SA or a failure at SA. If the range is okay at S then the flow continues at S as described above.

As illustrated in the operational flow A may result in two outcomes 1 a centerline is obtained at SA or 2 no centerline is obtained because the two ends do not join after multiple attempts SA . The operational flow A may be implemented within systems that are examining vessels with issues that can interfere with the centerlining process. For example the vessels may have stenosis. As such a second example operational flow B produces either a complete centerline or a partial centerline. As will be described the operational flow B includes operations that iteratively look for the best incomplete result i.e. the process compares each incomplete result with the previous incomplete result and maintains the best incomplete result in a cache. Rather than returning no centerline i.e. SA operational flow B returns a partial centerline from the cached incomplete results. If necessary or as desired a user may further manually edit the partial centerline.

With reference to the operational flow B will now be described. Operations that are the same as those introduced above with regard to are referenced by the same reference numbers and are not repeated below for purposes of conciseness. The operational flow B begins with S and S and flows through S as described above.

At S it is determined if the curves have terminated. This may be tested by determining if the intensity value at this new position is not within the current range. If so the curve is terminated. For example if the intensity at the new position was greater it is possible that the new position is in bone. If at S the curves have not terminated then the intensity value at this position is within the current range. As such the point is added to the curve. The curves are then tested at S to see if they have joined. If the curves are not joined then at S it is determined if the incomplete result is better than a previous result. Here a better result is determined by looking for the centerline sections that result in the smallest gap between the two pieces of the curves. The determination at S may be made to keep track of the best incomplete result from the current iteration through the loop that begins at S. If not then the flow returns to S. If the incomplete result is better than a previous result then the better result is cached at and the flow returns to S. If the curves are joined at S then it is tested at SB if the complete result is better than a previous result. If yes then the result is cached at SB and the range increased at S to run the process again S S . If at SB the complete result is not better than a previous then the flow proceeds directly to S.

Returning back to S if both curves are terminated the process flows to S where it is determined if the incomplete result is better than a previous result. The determination at S may be made to compare the best incomplete result from the current iteration through the loop that begins at S with incomplete results of previous iterations. This determination may be made by applying the following relationship 

If at S the result is not better then the flow returns to S where the range is increased and the curves are reinitialized to start over at S. If the incomplete result is better than a previous result then the better result is cached at and the flow returns to S.

When the loop returns to S it is determined if the range is no longer okay. As noted above the test at S determines if the range has grown to greater than five times the initial range or if more than 20 iterations of the loop have been performed. If the range is okay at S then the flow continues at S as described above. If the range is no longer okay then it is determined if there is a result at S. If yes the result is determined to be a success at SB or if no an incomplete result is provided SB from the cached results.

Thus to summarize the operational flows of an optimal result may be found when the curve connecting the two points is along the shortest path length constrained by the smallest range used to determine cross sectional areas. It is noted that sampling associated with the processes herein may be performed using trilinear interpolation.

Once the centerline of a vessel is determined contouring may be performed by taking cross sections of the vessel at regular intervals. With the cross sections the edge of the tubular structure may be determined. Finding high quality contours that outline a tubular structure from a collection of cross sections may be problematic as tubular structures may not exhibit a large gradient magnitude at their borders. In addition tubular structures may contain bifurcations trifurcations or more complex branch structures that make finding high quality contours difficult. In using the results from contouring it is possible that the contour produced at a branching of the vessel may be identified as a false positive for an aneurysm or stenosis or may otherwise obscure important details.

In accordance with aspects of the present disclosure once a centerline is determined various methods may be used to generate a contour. illustrates an example operational flow diagram to generate a contour of the tubular structure and detect branches of the tubular structure. At S the cross section contour is represented as a NURBS curve. At S the initial contour for each cross section is found by performing a flood fill initiated at the center and constrained by the best range that was used in the centerline algorithm of . The resulting range from the centerline algorithm is used because it would have started quite small and grown slowly until a reasonably smooth centerline was found. This idea of growing the range slowly helps to improve the contouring in situations where the gradient magnitude is small at the border of the tubular structure. Once the flood fill is complete at S the contour is generated. In particular the points that lie on the outside border of the result of the flood fill are used to generate the contour.

After a contour is generated properties of the initial contour may be used to detect branch structures. For example in accordance with aspects of the present disclosure at S properties of the initial contour may be detected. Detecting branches in the tubular structure is done by measuring the following exemplary properties of the initial contour. The first property used to detect a branch is curvature. Normally with a tubular structure the curvature of the cross section contour will not change sign. Typically a vessel has a positive curvature. If the sign of the curvature changes that will often indicate a potential branch. This is shown in which has a cross section with negative curvature. The next property used to detect branches is the change in circularity. A tubular structure will not normally have sudden changes in circularity. When a significant change in circularity occurs that can also indicate a potential branch. demonstrates this note the location of the centerline. The other property that may be measured to detect branches is the change in area inside the contour. A sudden change in the area inside a contour can also indicate a potential branch. shows a branch completing the area inside the contour around where the centerline lies will have changed significantly. Often when these measurements indicate a branch multiple consecutive cross section contours are identified as potential branches. Combinations of the above properties may be used to identify a bifurcation.

At S the contour is adjusted. Adjusting the contours so that they more closely represent the structure that the centerline is passing through can be important in many applications. Take for instance the tubular structure as a blood vessel in a computed tomography scan. Measuring stenosis in the vessel could be done using cross section contours. The contours at or near to a bifurcation could indicate a false positive.

When a branch is detected it is adjusted at S it by replacing the range of branch cross sections with an approximation of a non branching tubular structure that follows the centerline. The cross section contours at each end of the branch are resampled to the same number of points. The points that make up the contours are also ordered to start at the point with the largest positive X value and follow a counterclockwise path. Spline interpolation is then used to approximate the cross section contours in between. As such the cross sections shown in are resampled to the same resolution and reordered to start with the point at the largest positive X value and following a counterclockwise path. The dashed line in shows the adjusted result.

With reference to there is an operational flow diagram of process performed to determine a location of an aneurysm. Aspects of the present disclosure may be used to determine the locations of an aneurysm. An aneurysm is a bulge in an otherwise near uniform tubular structure. The algorithm for detecting an aneurysm detects both the first and second points of the bulge plus the first bifurcation point in the tubular structure if present on each side of the bulge. The process begins at S where the previous detection of both the centerline and contours of the tubular structure is performed in accordance with the methods of .

At S to determine the two ends of the aneurysm the contour area may be considered as a function of position along the length of the centerline of the tubular structure. Points with a large second derivative magnitude along the centerline may be located. Such points marker points are of interest because points having a large second derivative typically correspond to the neck at each end of the aneurysm where the contour area changes abruptly from the near constant value of the tubular structure to the increasing value observed at the aneurysm ends.

At S the bifurcation points are determined. Knowledge of the first bifurcation points at each end of the aneurysm is typically required by a clinician. These points are located by making use of the contour area and radius in a manner similar to that described for the contour algorithm but tuned to identify subtle bifurcations and without the need for establishing the clean contours at each end of the bifurcation itself.

As noted above the user interface may be provided on the workstation which may be any connected computing device. Through an appropriate application server the user interface may be rendered having characteristics appropriate for the particular device serving as the workstation . For example a dedicated workstation may be provided with multiple monitors to display several views at once whereas a mobile device may only display a limited number of views at a time e.g. one or two . In some implementations the application server may comprise PUREWEB available from Calgary Scientific Alberta Canada.

A workflow associated with a user interface will now be introduced with reference to . Generally a user may instantiate the user interface on a workstation such as that described above. The user interface provides options to select edit analyze and generate reports regarding vessels within image data associated with e.g. a patient. A user may initially select a particular vessel or vessels of interest to be displayed in a four quadrant view that shows e.g. a 3D view of an area of interest and associated orthogonal 2D views of the same area of interest. Once the vessel selected the user may edit particular properties of the vessel such as the centerline which may have been automatically generated in accordance with the methods above.

Once the user is satisfied with the vessel user may enter an analysis view. Within the analysis view user may select various functions to determine characteristics of the vessel under analysis. For example the user may determine areas of stenosis or aneurysms present in the vessel either manually or automatically by selecting an appropriate tool. The user may also edit contours associated with the vessel of interest. Other data may be displayed such as cross sections diameters areas etc. When the user has completed the analysis of the vessel a report may be generated to provide information in a condensed format for review by e.g. a healthcare professional. With the introduction above the specifics of each mode of operation as presented in the user interface will now be introduced.

Referring now to there are screen shots of a user interface that may be presented on e.g. the user workstation to view image data acquired by the image processing system . illustrate a Vessel Finder mode of operation. The user interface is provided on a display of the user workstation to allow a user to display annotate and or edit a medical image generated from scans of a patient. As noted above the user workstation may be any computing device such as a desktop computer dedicated workstation laptop notebook table computing device mobile device e.g. wireless handheld smartphone etc. As show in the user interface enables a user to view vessels within a patient s body display information and characteristics of the vessels e.g. centerlines stenosis aneurysms cross sections contours etc. and perform other operations such as bone removal and cutting using a scalpel tool etc. The user may interact with the user interface using any input devices of the user workstation such as a mouse keyboard touchscreen etc.

In user interface the Vessel Finder mode provides a 3D image of a region of a patient together with three orthogonal 2D multi planar rendering MPR views and . For example the views may be an axial view coronal view and a sagittal view respectively. shows a first orientation A of the 3D image and shows a second orientation B of the 3D image . A menu is provided to add or remove a particular vessel or vessels of interest. The available vessels are listed in the menu . In some implementations the vessels listed in the menu may be color coded to differentiate among them when selected and shown in the various views of the user interface . The available vessels may be those in which a contrast agent was injected during the imaging process performed by the medical imaging scanner .

In a selected vessel left internal carotid siphon is shown within the brain of the patient and through the skull base bone and into the patient s neck. The centerline of the vessel is shown as reference numeral and may be color coded to the vessel name shown in the menu . One or more of the views may contain information about the patient when the image data was obtained information about the contrast agent etc. Within the 3D window tools are provided such that the user may perform various operations on the views such as bone segmentation or cutting tissue away using a scalpel function. Other tools are available such as a lens tool screenshot tool a measuring tool an annotation tool etc. the details of which are evident to those of ordinary skill in the art.

As show in the user interface may provide a Vessel Editor mode wherein a user may make adjustments to the vessel the centerline and other characteristics of the vessel. Adjustments may be made using one or more of the available tools showing user interface . The user may for example may move a vessel. The user may also place a new centerline or move an existing centerline within vessel by selecting locations shown as dots where the new location of centerline should pass. While only one vessel is shown in it is noted that if multiple vessels are selected in the Vessel Finder user interface then the multiple vessels will be shown in the Vessel Editor user interface. Characteristics of each vessel may be edited individually by the user.

Within the Analysis view multiple tools may be provided to enable a user to find or determine conditions such as e.g. stenosis or an aneurism of the vessel . The stenosis tool may detect a broadest location of the vessel e.g. D and from that location user may find the most narrow location of the vessel e.g. between B and D as A is not within the scope of consideration . Other tools include a puck editor that may be provide to refine the cross section of the vessel by pushing the edges to improve the contour of the vessel . A contour tool may be provided to edit the contour of the vessel and to select portions of the contour .

In the Analysis view an auto aneurism tool may be provided as one of the tools . In some implementations the auto aneurism tool may be used when analyzing e.g. the aorta. For example in accordance with the workflow above the aorta is located using the Vessel Finder mode shown as vessel in . As shown in the accuracy of the centerline may be confirmed or refined using the Vessel Editor mode. Next as shown in in the Analysis mode the auto aneurysm tool may locate an aneurysm and the vessel and mark several features of the vessel . For example a proximal neck and distal neck may be located. Between the necks a maximum lumen and minimum lumen may be located together with a cross sectional area of each. The length of the aneurism may be determined and displayed. Each of the determined features may be color coded and a cross section of the vessel at a location of each feature shown in a respective color coded window. Additionally or optionally one or more Windows may be provided to show cross sections of the above noted features of the vessel .

It should be understood that the various techniques described herein may be implemented in connection with hardware or software or where appropriate with a combination of both. Thus the methods and apparatus of the presently disclosed subject matter or certain aspects or portions thereof may take the form of program code i.e. instructions embodied in tangible media such as floppy diskettes CD ROMs hard drives or any other machine readable storage medium wherein when the program code is loaded into and executed by a machine such as a computer the machine becomes an apparatus for practicing the presently disclosed subject matter. In the case of program code execution on programmable computers the computing device generally includes a processor a storage medium readable by the processor including volatile and non volatile memory and or storage elements at least one input device and at least one output device. One or more programs may implement or utilize the processes described in connection with the presently disclosed subject matter e.g. through the use of an application programming interface API reusable controls or the like. Such programs may be implemented in a high level procedural or object oriented programming language to communicate with a computer system. However the program s can be implemented in assembly or machine language if desired. In any case the language may be a compiled or interpreted language and it may be combined with hardware implementations.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

