---

title: In-building location security and privacy
abstract: A location server includes: a first receiver module configured to receive, from a location-based services application server (LBS AS), a first identification for a first mobile device associated with the LBS AS; a second receiver module configured to receive, from an access/location network (ALN), a second identification for a second mobile device associated with the ALN; a comparison module, communicatively coupled to the first and second receiver modules, configured to determine whether the first and second identifications match and whether the first and second mobile devices are the same mobile device based at least in part on whether the first and second identifications match; and a location service information module, communicatively coupled to the comparison module, and configured to provide a location service for the first mobile device in response to the comparison module determining that the first and second mobile devices are the same mobile device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09402163&OS=09402163&RS=09402163
owner: QUALCOMM Incorporated
number: 09402163
owner_city: San Diego
owner_country: US
publication_date: 20140610
---
This application claims the benefit of U.S. Provisional Application No. 61 856 310 filed Jul. 19 2013 entitled In Building Location Security and Privacy that is incorporated herein in its entirety for all purposes.

Support for accurate and reliable location of a mobile device in an indoor environment such a building subway or venue is being developed but is currently not widely available nor as accurate or reliable as needed by applications users and venue and building owners. Support for security and privacy in the context of in building location is also at an early stage of development. For example support for in building location security and privacy with the solution being developed by the In Location Alliance ILA is very limited. For example several ways exist in which a mobile device MD can spoof a media access control MAC address of another MD in order to obtain the spoofed MD s location without authorization or to feed false location information to a location client of the spoofed MD. In the ILA architecture there are three separate over the air OTA interfaces to an MD on which different MD identifiers IDs can be used. Verifying on a network side of the architecture that the same MD is at the end of each interface may be difficult.

An example of a location server includes a first receiver module configured to receive from a location based services application server a first identification for a first mobile device associated with the location based services application server a second receiver module configured to receive from an access location network a second identification for a second mobile device associated with the access location network a comparison module communicatively coupled to the first receiver module and the second receiver module configured to determine whether the first identification matches the second identification and to determine whether the first mobile device and the second mobile device are the same mobile device based at least in part on whether the first identification matches the second identification and a location service information module communicatively coupled to the comparison module and configured to provide a location service for the first mobile device in response to the comparison module determining that the first mobile device and the second mobile device are the same mobile device.

Implementations of such a location server may include one or more of the following features. To provide the location service the location service information module is configured to at least one of provide location assistance data to the first mobile device provide a location estimate to the first mobile device or provide a location estimate for the first mobile device to the location based services application server. The location service information module is configured to obtain the location estimate for the first mobile device using at least one of measurements for the first mobile device provided by the access location network a location estimate for the first mobile device provided by the first mobile device or location measurements provided by the first mobile device. The location server is a Secure User Plane Location SUPL Location Platform SLP and the location service information module is configured to obtain the location estimate for the first mobile device using a SUPL session between the location server and the first mobile device. The first identification includes a first internet protocol address and the second identification includes a second internet protocol address or the first identification includes a first Media Access Control MAC address and the second identification includes a second MAC address. The location server further includes a venue identifier module configured to send a venue assigned identifier VID to the first mobile device the VID being temporarily unique to the first mobile device. The VID comprises a first Media Access Control MAC address. The server further includes a third receiver module configured to receive from a third mobile device a third identification for the third mobile device where the comparison module is configured to determine whether the third identification matches the first identification and the second identification and to determine whether the first mobile device the second mobile device and the third mobile device are the same mobile device based at least in part on whether the third identification matches the first identification and the second identification where the location service module is configured to provide the location service for the first mobile device is in response to the comparison module determining that the first mobile device the second mobile device and the third mobile device are the same mobile device and where the first identification the second identification and the third identification all include an Internet Protocol address a Venue Assigned Identity or a Media Access Control address.

Another example of a location server includes first receiving means for receiving from a location based services application server a first identification for a first mobile device associated with the location based services application server second receiving means for receiving from an access location network a second identification for a second mobile device associated with the access location network comparison means communicatively coupled to the first receiving means and the second receiving means for determining whether the first identification matches the second identification determining means for determining whether the first mobile device and the second mobile device are the same mobile device based at least in part on whether the first identification matches the second identification and location service information means communicatively coupled to the comparison means for providing a location service for the first mobile device in response to the comparison means determining that the first mobile device and the second mobile device are the same mobile device.

Implementations of such a location server may include one or more of the following features. For providing the location service the location service information means are configured to at least one of provide location assistance data to the first mobile device provide a location estimate to the first mobile device or provide a location estimate for the first mobile device to the location based services application server. The location service information means are configured to obtain the location estimate for the first mobile device using at least one of measurements for the first mobile device provided by the access location network a location estimate for the first mobile device provided by the first mobile device or location measurements provided by the first mobile device. The location server is a Secure User Plane Location SUPL Location Platform SLP and the location service information means are configured to obtain the location estimate for the first mobile device using a SUPL session between the location server and the first mobile device. The first identification includes a first internet protocol address and the second identification includes a second internet protocol address or the first identification includes a first Media Access Control MAC address and the second identification includes a second MAC address. The location server further includes venue identifier means for sending a venue assigned identifier VID to the first mobile device the VID being temporarily unique to the first mobile device. The server further comprises a third receiving means for receiving from a third mobile device a third identification for the third mobile device where the comparison means are configured to determine whether the third identification matches the first identification and the second identification and to determine whether the first mobile device the second mobile device and the third mobile device are the same mobile device based at least in part on whether the third identification matches the first identification and the second identification where the location service means are configured to provide the location service for the first mobile device is in response to the comparison means determining that the first mobile device the second mobile device and the third mobile device are the same mobile device and where the first identification the second identification and the third identification all include an Internet Protocol address a Venue Assigned Identifier or a Media Access Control address.

An example of a mobile device includes a transceiver configured to send and receive signals to and from a location based services application server LBS AS and an access location network ALN and a processor communicatively coupled to the processor and configured to send via the transceiver a first identity for the mobile device toward the LBS AS send via the transceiver a second identity for the mobile device toward the ALN where the first identity and the second identity comprise a common identity for the mobile device and obtain a location service from at least one of the LBS AS or the ALN via the transceiver.

Implementations of such a mobile device may include one or more of the following features. The common identity for the mobile device comprises an Internet Protocol IP address or a Media Access Control MAC address. To obtain the location service from the LBS AS or the ALN the processor is configured to receive via the transceiver at least one of location assistance data from the LBS AS or the ALN or a location estimate for the mobile device from the LBS AS or the ALN. The processor is configured to receive via the transceiver a venue assigned identifier VID from the LBS AS or a location server where the VID is temporarily unique to the mobile device and include the VID in at least one of the first identity or the second identity. The VID comprises a Media Access Control MAC address. The processor is further configured to send via the transceiver a third identity for the mobile device toward a location server where the third identity comprises the common identity for the mobile device and obtain via the transceiver another location service from the location server. The location server is a Secure User Plane Location SUPL Location Platform SLP and where to obtain the another location service from the location server the processor is configured to receive from the location server via the transceiver using a SUPL session at least one of location assistance data or a location estimate for the mobile device. The ALN comprises at least one of an IEEE 802.11 WiFi access point AP a Bluetooth AP or and a Femtocell.

Another example of a mobile device includes means for sending a first identity for the mobile device toward a location based services application server LBS AS means for sending a second identity for the mobile device toward an access location network ALN where the first identity and the second identity comprise a common identity for the mobile device and means for obtaining a location service from at least one of the LBS AS or the ALN.

Implementations of such a mobile device may include one or more of the following features. The common identity for the mobile device comprises an Internet Protocol IP address or a Media Access Control MAC address. For obtaining the location service from the LBS AS or the ALN the means for obtaining are configured to receive at least one of location assistance data from the LBS AS or the ALN or a location estimate for the mobile device from the LBS AS or the ALN. The mobile device further includes means for receiving a venue assigned identifier VID from the LBS AS or a location server where the VID is temporarily unique to the mobile device and where at least one of the means for sending the first identity or the means for sending the second identity are configured to include the VID in at least one of the first identity or the second identity respectively. The VID comprises a Media Access Control MAC address. The mobile device further includes means for sending a third identity for the mobile device toward a location server where the third identity comprises the common identity for the mobile device and means for obtaining another location service from the location server. The location server is a Secure User Plane Location SUPL Location Platform SLP and where for obtaining the another location service from the location server the means for obtaining the another location service are configured to receive from the location server via the transceiver using a SUPL session at least one of location assistance data or a location estimate for the mobile device.

Items and or techniques described herein may provide one or more of the following capabilities as well as other capabilities not mentioned. Spoofing of mobile device identifiers may be reduced or eliminated and mobile devices reliably identified on all three ILA over the air interfaces e.g. by providing a venue assigned identifier such as a MAC address for a mobile device. Better support for security privacy and service control may be provided for an ILA architecture. A mobile device or mobile device user may be identified to help ensure correct authorized service is provided including privacy support and billing. Sensitive venue information e.g. access point locations and or heat maps may be restricted to trusted applications and or trusted mobile devices. Mobile device information including mobile device location and identity may be protected against interception by third parties and provided only to entities approved or authorized by a mobile device user. Other capabilities may be provided and not every implementation according to the disclosure must provide any let alone all of the capabilities discussed. Further it may be possible for an effect noted above to be achieved by means other than that noted and a noted item technique may not necessarily yield the noted effect.

Techniques in accordance with the disclosure may be used to support security and or privacy for in building location e.g. based on the ILA architecture. For example information concerning a mobile device e.g. an address or identity for the mobile device may be provided by the mobile device or by another entity to a location server through multiple interfaces with the information received through at least one of the interfaces being trustworthy. The location server may compare the information received via the multiple interfaces and determine whether the information is for the same mobile device or possibly for different mobile devices. If the information is for the same mobile device then information may be provided by the location server to a location based services application server such that the location based services application server provides a location service to the mobile device e.g. to an application on the mobile device or to the user of the mobile device to an external client or to the owner or operator of a venue or building in which the mobile device is located. For example a venue assigned ID VID may be provided by a server to a mobile device on an OTA interface. The VID may be provided to the mobile device over a secure connection and thus the VID may be unknown to other mobile devices and not easily spoofed. The VID may then be provided by the mobile device to a location server via one or more other OTA interfaces. The VID would verify that the same mobile device was providing the VID to the location server. A MAC address may be used as a VID which may provide some level of mobile device privacy in addition to security because a server associated with the venue would be assigning the mobile device MAC address and detection of the MAC address by other mobile devices when transmitted by the mobile device would not necessarily identify the mobile device e.g. the user of the mobile device . The ILA architecture may also be extended by adding a service and security manager to support security privacy and service control.

A mobile device MD may be a cell phone smart phone PDA laptop tablet or some other device that is mobile and can send and receive wireless related communications and may be referred to as a mobile station device terminal wireless terminal mobile terminal user equipment UE Secure User Plane Location SUPL Enabled Terminal SET or by some other name. It may be useful to obtain the location of the mobile device by the mobile device or by a network e.g. a location server in a network in order to provide the location to a user of the mobile device to an application on the mobile device or to an application in a network or venue. The provision of this location may enable provision of location related services to the user of the mobile device to an external client or to a network or venue. Examples of such location related services may include provision of directions to a user of the mobile device provision of maps e.g. floor plans a venue layout applicable to the current location of the mobile device to the user of the mobile device provision of assistance by a network or venue owner to the user of a mobile device e.g. details of sales at nearby shops in a shopping mall or gate closure times at an airport and collection of user related information by a venue owner e.g. the number of visitors to different parts of a venue .

Referring to a communication system includes a mobile device MD an access location network ALN a location server LS a location based services application server LBS AS a map database an access location network ALN database and optionally a service and security manager SSM . The MD and the ALN are disposed in an indoor area that may be a building venue campus or some other structure or area with a significant amount of area indoors. The servers and the databases may belong to or may be operated on behalf of a venue that occupies part or all of the indoor area e.g. a shopping mall college campus hospital airport or museum and are shown disposed outside of the indoor area but any all or any combination of the servers and or the databases could be disposed within the indoor area . The system is a communication system in that each of the MD the ALN the servers and the databases are configured to communicate with at least one of the other components of the system . Furthermore the communication between the ALN and the MD may typically use wireless means e.g. may employ IEEE 802.11x WiFi signaling Bluetooth signaling or wireless signaling as defined for cellular networks by standards organizations such as the 3rd Generation Partnership Project 3GPP and the 3rd Generation Partnership Project 2 3GPP2 . For example cellular communication between the ALN and the MD may be according to the Global System for Mobile communications GSM defined by 3GPP Wideband Code Division Multiple Access WCDMA defined by 3GPP Long Term Evolution LTE defined by 3GPP or code division multiple access 2000 cdma2000 defined by 3GPP2. The MD can move or be moved to various locations within the indoor area including onto different floors of the indoor area when more than one floor is present. The MD which may also be referred to as a User Equipment UE an access terminal AT a mobile station MS a subscriber unit etc. may be any of a variety of devices such as a mobile phone a smartphone a laptop computer a tablet computer a personal digital assistant etc. Only one MD is shown in and to simplify the discussion below only this MD is discussed but more than one MD may be used in the system . The ALN may be a local network that includes access points APs that may support WiFi or Bluetooth wireless communication and or femtocells that may support wireless communication according to WCDMA LTE or cdma2000. The SSM is discussed more fully below after discussion of .

The communication system may correspond in whole or in part to an indoor location system defined by the ILA. The Access location Network ALN may provide wireless communication access to the MD and may enable communication between the MD and other entities in the communication system such as the location server LS and the Location Based Services Application Server LBS AS . The ALN may also enable communication between the MD and entities not shown in such as the Internet and a location server or location servers remote from the indoor area . The LS may support an ability to determine the current location of the MD or enable the MD to determine its current location and may include an ability to send location assistance data AD to the MD obtain the location of the MD using location related measurements provided by the MD and or the ALN and send an obtained location for the MD to the MD or to another client entity such as the LBS AS .

In particular implementations the MD may have circuitry and processing resources capable of computing a position fix or estimated location of the MD . For example the MD may compute a position fix based at least in part on pseudorange measurements to four or more Global Navigation Satellite System GNSS satellites for GNSS constellations such as GPS Glonass or Galileo. In particular implementations the MD may receive from the LS positioning assistance data e.g. almanac ephemeris data Doppler search windows to aid in the acquisition and measurement of signals transmitted by GNSS satellites and or aid the MD to compute a location estimate from such measurements.

In other implementations the MD may obtain a location fix by processing signals received from terrestrial transmitters fixed at known locations e.g. APs and or base stations belonging to the ALN using any one of several techniques such as for example Advanced Forward Link Trilateration AFLT or Observed Time Difference of Arrival OTDOA . In these particular techniques pseudoranges or timing differences may be measured by the MD relative to three or more of such terrestrial transmitters fixed at known locations based at least in part on pilot or other positioning related signals transmitted by the transmitters and received at the MD . Here the LS may be capable of providing positioning assistance data to the MD including for example information on signals to be measured e.g. signal timing signal content and or signal scheduling and locations and identities of terrestrial transmitters to facilitate positioning techniques such as AFLT and OTDOA. For example the LS may include a base station almanac BSA in AD sent to the MS which indicates locations and identities of cellular base stations and or APs in the ALN and may provide information related to base station and AP transmitted signals such as transmission power antenna gain and signal timing.

In particular environments such as indoor environments or urban canyons the MD may not be capable of acquiring signals from a sufficient number of GNSS satellites to perform positioning and may not receive signals from a sufficient number of base station transceivers to perform AFLT or OTDOA to compute a position fix. In these circumstances the MD may be capable of computing a position fix based at least in part on signals acquired from local transmitters e.g. WiFi APs and or Femtocells positioned at known locations . For example the MD may obtain a position fix by measuring ranges to three or more indoor terrestrial wireless access points which are positioned at known locations. Such ranges may be measured for example by obtaining a Media Access Control MAC ID address from signals received from WiFi APs and obtaining range measurements to the access points by measuring one or more characteristics of signals received from such access points such as for example a Received Signal Strength indication RSSI or a round trip signal propagation time RTT . In alternative implementations the MD may obtain an indoor position fix by applying characteristics of acquired signals to a radio map indicating expected RSSI and or RTT values at particular locations in an indoor area. In particular implementations a radio map may associate identities of local transmitters e.g. a MAC address which is discernible from a signal acquired from a local transmitter expected RSSI from signals transmitted by the identified local transmitters an expected RTT from the identified transmitters and possibly standard deviations from these expected RSSI or RTT values. In alternative implementations angles of arrival or departure may be used in lieu of or in combination with measurements of range or signature recognition in a radio map for estimating a location of a mobile device. These however are merely examples of positioning methods applicable to the indoor area and the system and that claimed subject matter is not limited in this respect.

In particular implementations the MD may receive positioning assistance data for indoor positioning operations from the LS . For example such positioning assistance data may include locations and identities e.g. MAC addresses of transmitters in the ALN positioned at known locations to enable measuring ranges to these transmitters based at least in part on a measured RSSI and or a measured RTT for example. Other positioning assistance data to aid indoor positioning operations may include radio maps magnetic maps routeability graphs building layouts and floor plans indicating permitted locations common locations and improbable locations e.g. associated with walls and building infrastructure just to name a few examples. Other positioning assistance data received by the MD may include for example local maps of indoor areas for display or to aid in navigation. Such a map may be provided to the MD as the MD enters a particular indoor area. Such a map may show indoor features such as doors hallways entry ways walls etc. points of interest such as bathrooms fire exits pay phones room names stores etc. By obtaining and displaying such a map the MD may overlay a current location of the MD over the displayed map to provide the user of the MD with additional context.

According to an embodiment the MD may access indoor navigation assistance data from the LS by for example requesting particular types of indoor assistance data. In particular implementations the LS may be capable of providing indoor navigation assistance data to cover many different indoor areas including for example floors of buildings wings of hospitals terminals at an airport portions of a university campus areas of a large shopping mall just to name a few examples. Also memory resources at the MD and data transmission resources may make receipt of indoor navigation assistance data for all areas served by the LS impractical or infeasible. A request for indoor navigation assistance data from the MD may then indicate a rough or course estimate of a location of the MD . The MD may then be provided with indoor navigation assistance data covering areas including and or proximate to the rough or course estimate of the location of the MD which may reduce the memory requirements of the MD and use of data transmission resources while still providing the MD with valuable navigation and other positioning assistance data.

In a particular implementation the ALN may comprise devices positioned and configured to transmit or receive signals to assist in positioning operations such as for example local transceivers or base station transceivers. Signals transmitted and received by the ALN to assist in positioning operations for the MD and other mobile devices may be designed primarily to support communication of audio video data and control information as part of normal communications operations but may provide the additional benefit of supporting positioning by having measurable attributes such as signal strength signal angle of arrival signal timing or other signal characteristics.

In certain implementations the MD and the LS may support the Secure User Plane Location SUPL location solution defined by the Open Mobile Alliance OMA . In this case the LS may comprise a home SUPL Location Platform H SLP or a discovered SUPL Location Platform D SLP . The LS may be an H SLP if provided for the MD by a home wireless network operator for the user of the MD or by some other preferred location provider for the user of the MD and may comprise a location server for which the MD is provisioned to receive location services while in a home area e.g. home network coverage area or while unable to obtain location services from some other location server if not in a home area. The LS may be a D SLP if not provided by a home operator or preferred location provider for the user of the MD and may support location services in some area that is not a home area for the MD such as a particular building a venue a city a state or some foreign country for a user and may have unique data e.g. unique positioning assistance data that can be transmitted to the MD to support location services in this area. A D SLP may support better location services e.g. may enable more accurate and reliable location than an H SLP inside the area served by the D SLP. It may be an advantage for the MD to discover a D SLP while in certain environments such as inside a venue in order to obtain improved location services.

SUPL is a location solution based on interaction between a SUPL Enabled Terminal SET and a SUPL Location Platform SLP using TCP IP as a transport mechanism e.g. with TCP IP packets transmitted between the LS and the MD via the ALN . When SUPL is supported SUPL messages defined according to the SUPL User Plane Location Protocol ULP defined by OMA may be exchanged between a SET and an SLP to set up and manage SUPL location sessions and to transfer positioning assistance data location parameters e.g. a location estimate and or measurements for use in computing a location estimate and SUPL related positioning capabilities. A SUPL session may employ one or more positioning protocols that may convey at least a portion of positioning assistance data transferred from an SLP to a SET and some or all of the location measurement and or location estimate information transferred from the SET to the SLP. Certain SUPL messages e.g. a SUPL POS message may carry one or more embedded messages defined according to a positioning protocol as a means of invoking and supporting positioning within a SUPL session. Examples of positioning protocols supported by SUPL include the Radio Resource Location Services LCS Protocol RRLP the Radio Resource Control Protocol RRC the LTE Positioning Protocol LPP the IS 801 protocol and the LPP Extensions LPPe protocol. Typically LPPe may extend LPP such that an LPP message may contain an embedded LPPe message. RRLP RRC and LPP are defined by 3GPP IS 801 is defined by 3GPP2 and LPPe is defined by OMA all in publicly available documents.

Referring now to other elements in the communication system Access location Network Database ALN DB may be a computer system or server that stores data such as map data location related information e.g. positioning assistance data including base station almanac data for the ALN and or assistance data for A GNSS information on points of interest and or other data that may be used by a location service. This information may be derived from a third party service via measurement data generated by mobile devices such as the MD and sent to the LS using crowdsourcing and thereafter relayed to the ALN DB and or from the Map Database Map DB . The map DB may be a computer system or server that stores maps building layouts floor plans and other geographic information for the indoor area which may be provided by an owner of the indoor area . The LBS AS may comprise an application program server computer or service that uses location information to provide location related services to the MD a user of the MD an owner of the indoor area and or an operator of the ALN or the LS . Examples of such location related services may include provision of map data or directions to an application App on the MD provision of statistical information on the locations and movement of all MDs in the indoor area to the owner of the indoor area and or provision to the user of the MD of data applicable to the location of the MD in the indoor area such as nearby fire exits nearby parking spaces in a car park discounts on items nearby to the user in a shopping mall information on exhibits nearby to the user in a museum. The LBS AS may use information obtained from the map DB e.g. floor plan information for the indoor area as well as location information e.g. the current location of the MD obtained from the LS or from the MD to provide such location related services.

Referring now to the components of the communication system also referred to here as the system are configured to communicate with each other over respective interfaces I Fs . In particular the components of the system are configured to communicate respectively via interfaces I Fs and . Further a modem and a positioning engine PE of the MD are configured to communicate via an interface A and the PE and an application App of the MD are configured to communicate via an interface B wherein both interfaces A and B may be internal to the MD e.g. may be Application Programming Interfaces APIs . The system is an example of an architecture for ILA privacy and security. Trust relationships may exist i.e. communications may be trustworthy on I F A and I F B internal to the MD and on I Fs on the network side once mutual authentication over each of these network interfaces has been performed between the pair of entities at each end of each interface e.g. between the LS and the LBS AS in the case of I F . Trust relationships may be absent on I Fs such that data and identification information received over these interfaces should be independently verified.

Interfaces and may comprise logical or physical interfaces. In the case of a physical interface n where n is a number in the range 1 5 6 7 and 8 the two entities joined by I F n may comprise physically separate entities and may be linked wirelessly by a wireline connection e.g. a cable or LAN or via one or more intermediate entities such as a network or local area network e.g. the ALN . In the case of a logical interface n the two entities joined by I F n may be different parts e.g. different programs or processes within the same physical entity. As an example the LS and the LBS AS may be physically separate entities if I F is physical or may be parts of the same entity if I F is logical. Interfaces and to the MD may comprise physical OTA interfaces.

In supporting location of the MD and location services related to the MD interface may enable the ALN to provide access network measurements made of signals transmitted from the MD and or measurements provided to the ALN by the MD that were made by the MD of signals transmitted by the ALN to the LS to enable the LS to locate the MD . Further with I F the LS may configure the ALN to make or obtain particular measurements of or related to the MD and provide them to the LS e.g. measurements or information related to detection of the MD and or the timing strength and or direction of arrival of signals received from the MD . With interface the ALN may transfer to the MD for support of location service by the MD positioning assistance data which the ALN may have been configured with or may have obtained from the LS . Transfer of assistance data over I F from the ALN to the MD may occur point to point and or may make use of broadcast messages transmitted from APs or Femtocells in the ALN to multiple devices including but not limited to the MD . Positioning assistance data transferred may provide descriptions or characteristics of one or more transmitters e.g. access points in or outside of the ALN whose signals may be measured by the MD to estimate the location of the MD . With I F the ALN may also transfer to the MD measurements made by the ALN of signals received from the MD . In addition with I F the MD may transfer to the ALN location related measurements of signals received by the MD from the ALN and the ALN may make measurements of signals received from the MD . Interface may be supported by an IEEE 802.11 WiFi protocol when the ALN contains WiFi APs by LTE when the ALN contains LTE eNode Bs or Home eNode Bs or by other radio access technologies such as WCDMA cdma2000 and Bluetooth. With interface as part of the primary function of a system for providing positioning services the LS may transfer location related positioning assistance data to the MD and the MD may transfer positioning measurements location estimates and or crowd sourced measurements to the LS . The various interactions and transfers on I F may occur according to the SUPL ULP protocol in some embodiments. In further embodiments SUPL ULP used on I F may employ LPP and or LPP LPPe as positioning protocols as defined and allowed by the SUPL location solution defined by OMA in SUPL versions 2.0 2.1 and 3.0. Signaling used on I F may be transferred via the ALN using I Fs and in some implementations. With interface the LBS AS may send to the MD a location request map data and or location related content such as navigation and direction finding data. In addition on I F the MD may send to the LBS AS a location response and or a location report e.g. in response to a location request from the LBS AS and may also or instead send a request to the LBS AS for map data and or other location related content. Signaling used on I F may be transferred via the ALN using I Fs and in some implementations and using an interface between the LBS AS and the ALN that is not shown in .

With interface in the system in the LBS AS may send to the LS a location request e.g. related to the MD and or a configuration request related to reporting the presence and or location of the MD . Further on I F the LS may send to the LBS AS a location response and or location report e.g. in response to a location request and or configuration request received earlier from the LBS AS . To support the interactions on I F the Mobile Location Protocol MLP defined by OMA in publicly available documents may be used in some embodiments. MLP may also be used in some embodiments to support interactions on interface . With interface the ALN DB may transfer to the LS map data and or access network related data e.g. access network almanac data and BSA data for the ALN that may contain the locations and or transmission characteristics of APs and or base stations and or femtocells in the ALN . Further on I F the LS may transfer to the ALN DB location related measurement data e.g. signal strength and or round trip time measurements together with the location or an estimate of the location at which the measurements were made which may concern access points and or base stations in the ALN and may have been obtained at least in part by the LS from the ALN and or via crowdsourcing from one or more mobile devices such as the MD . The ALN DB may use the received location related measurement data to derive update and or validate location assistance data that it may have such as BSA data for the ALN . Similarly with interface the LBS AS may request and obtain map data e.g. building floor plans location of points of interest in the indoor area from the map DB . With interface the ALN DB may request and obtain map data e.g. building floor plans from the map DB . Each of interfaces through may also provide support for security including for example the ability of two entities communicating via an interface n where n is any number 1 through 8 to identify and authenticate one another.

In the system the LS may primarily support positioning of the MD whereas the LBS AS may primarily support services that use as input location information for the MD e.g. current location current velocity current heading location history and may then provide additional services dependent on this e.g. navigation assistance direction finding information of interest related to a particular location etc. to the MD and or to other entities such as a venue owner for the indoor area or some other external client. The functional partitioning of the LS and the LBS AS may be convenient to enable different providers e.g. which may include different vendors network operators location providers and or venue owners to provide their own specialized support for location services that may depend at least in part on data resources equipment and expertise uniquely available to each such provider and not available to other providers. With such a functional split the LBS AS may need to rely on the MD and or on the LS to supply location related information for the MD e.g. estimates or approximations of the location of the MD indications of reliability or uncertainty in such estimates or approximations indications of certain location related events for the MD such as the MD entering or leaving the indoor area . The MD may rely on the LBS AS and not on the LS for services dependent on location such as navigation and direction finding assistance. The LS and possibly the MD may rely on the LBS AS for instructions and configuration details indicating when and under what circumstances location information for the MD is to be obtained and provided to the LBS AS . The MD may further rely on the LS for assistance in obtaining its location e.g. for transfer of location assistance data and or computation of a location estimate . The LS may rely on the ALN for location related measurements and or location estimates for the MD and the ALN may rely on the LS for instructions and configuration details indicating when and how to report location measurements and or location estimates for the MD .

In particular implementations a presence and location of the MD in the indoor area may be detected measured or tracked using a mobile based positioning MBP approach and or a network based positioning NBP approach. In an MBP approach for example the MD may obtain location related measurements e.g. measurements of GNSS satellites and or APs or Femtocells in the ALN for use in detecting a presence or estimating a location of the MD . The MD may then determine a location itself for the MD from these measurements or may transfer the measurements to a network server e.g. the LS to determine a location for the MD . In an NBP approach receivers at stationary network elements e.g. APs and or Femtocells in the ALN may acquire signals transmitted by the MD for detection of a presence of the MD in the indoor area and estimating or tracking a location of the MD in the indoor area . The LS may employ NBP and or MBP depending on capabilities of the MD the ALN and the LS . The LBS AS may also query the MD for the location of the MD if the LS and or the ALN do not support NBP or if the MD may provide an estimate of its location more accurately. Also measurements obtained using MBP and NBP approaches may be combined e.g. at the LS to reduce measurement errors and improve accuracy of position estimates for the MD .

Referring now to the MD in the system in the MD may comprise a separate modem a Positioning Engine PE and an application App . The modem may be used to support wireless or wireline communication between the MD and one or more fixed transceivers in networks providing communications and or location services to the MD such as the ALN . The modem may support wireless communication according to GSM WCDMA LTE cdma2000 WiFi Bluetooth and or other wireless standards and may be supported on a separate piece of hardware in the MD e.g. a silicon chip or chipset . The PE may support positioning of the MD and may support location solutions such as SUPL and positioning protocols such as LPP and LPPe. The PE may be supported on hardware separate from the modem e.g. on a different silicon chip or may be supported using the hardware used to support the modem e.g. on the same silicon chip or chip set . In the latter case the PE may be supported using firmware or software separate from that used to support other functions of the modem . The App may provide location based services to the user of the MD and may receive location content e.g. maps directions from the LBS AS . Referring to I Fs to described previously herein the modem may support I F and be the endpoint for messages and signals received from the ALN or sent to the ALN . The PE may support I F and may be the end point for messages e.g. SUPL ULP messages and positioning protocol messages sent to and received from the LS . The App may support I F and may be the end point for messages sent to and received from the LBS . The modem and the PE may communicate using internal interface A in the MD . I F A may be used i to transfer messages and information received from the ALN by the modem that are related to positioning to the PE ii to transfer measurements of signals received from the ALN and made by the modem to the PE and or iii to receive information at the modem from the PE related to positioning support such as messages and information generated by the PE that are to be sent by the modem to the ALN . I F B may be used by the App to request and obtain location information from the PE e.g. the current location of the MD which may be used by the App to provide location related services to the user of the MD e.g. to show the current location of the MD on a map received by the App from the LBS and or may be sent to the LBS AS e.g. if requested by the LBS AS . I F B may also be used by the PE to obtain information from the App e.g. an address for the LS which may have been received by the App from the LBS AS .

It may be important when using the system as described above in association with and to ensure that the same device e.g. the MD is being used for each of I Fs and and that the device is the device that the device claims to be across each of these interfaces. In particular each of I Fs and may support mutual authentication of the pair of entities at each end of each interface. Thus for example I F may enable the MD or the modem or the PE to determine the address or identity ID of an AP or Femtocell in the ALN with which the MD or the modem is in communication and may similarly allow an AP or Femtocell in the ALN that is in communication with the MD or the modem to determine an address or identity for the MD . The address or identity may be carried in messages or signals transmitted from the ALN and from the MD or the modem and may comprise a MAC address in the case of a WiFi a cell global identity in the case of a Femtocell in the ALN or a device or user identity in the case of the MD . Similarly I F may enable the LS to provide its address or identity to the MD or to the PE and may enable the MD or the PE to provide an address or identity for the MD to the LS . I F may enable the address or identity provided by either end to be authenticated meaning that each end can be sure that the provided address or identity is valid and not spoofed from some other entity device or user. Similar again I F may allow the MD or the App and the LBS AS to exchange their respective addresses or identities and may enable each end to authenticate the received address or identity. Discrepancies however may arise when the identities or addresses related to an MD that are exchanged across one interface are not the same as or do not correspond to the same MD as the identities or addresses that are exchanged across another interface. The discrepancies may concern attempts by the user of one MD to masquerade as the user of a different MD by spoofing an identity for this different MD in order to obtain unauthorized location services or provide invalid and misleading location information to other entities. The discrepancies may also concern accidental errors in MD identification where two different MDs may use the same identity.

As a first example of how spoofing may occur with WiFi access with the three separate interfaces and shown in the App in the MD might be designed or programmed by the user of the MD to track the location of the user of another MD here MD shown in . The App in the MD might then provide the WiFi MAC address that is assigned to the MD to the LBS AS instead of the MAC address that is assigned to the MD and may request that the LBS AS track and provide the location of the MD to the App . The LBS may be unaware that the provided MAC address belongs to the MD rather than the MD . For example the LBS AS may be able to authenticate the identity of the App which may not be the same as a MAC address. Having authenticated the App the LBS AS may assume that the MAC address provided by the App is trustworthy and may send a request to the LS for the location of the MD and may provide the MAC address for the MD received from the App . The LS may trust the information received from the LBS e.g. because the LBS AS is considered trustworthy and may pass on the location request to the ALN along with the MAC address of the MD . The ALN may likewise trust the received information from the LS e.g. because the LS is considered trustworthy and may be able to detect the MAC address of the MD from signaling received from the MD e.g. if the MD is in the indoor area . The ALN may further be able to verify that this detected MAC address belongs to the MD that is sending the MAC address in this case the MD or may just assume that the MAC address belongs to the MD that is sending the MAC address. The ALN may not be able to receive and authenticate any other address or identity for the MD so may not know that the MAC address really belongs to the MD and not to the MD . Subsequently the ALN may obtain a location or series of locations for the MD e.g. by measuring RSSI or RTT using signals received from the MD and may return the location or locations or just the signal measurements to the LS which may compute a location or locations if only signal measurements are provided. The LS may then transfer the location or locations to the LBS AS which may in turn return the location or locations to the App on the MD . The user of the MD may then end up being able to track the location of the user of the MD . Although one address or identity may have been authenticated across each of I Fs and in this example the App in the MD is still able to obtain unauthorized locations for the MD without knowledge of network entities such as the ALN the LS and the LBS .

As a second example of how spoofing may occur with WiFi access with the three separate interfaces and in the user of the MD may wish to provide false and misleading location information to a location client e.g. may wish to provide the location of the MD to a location client who wishes to obtain the location of another MD such as the MD in . In this case the user of the MD may reconfigure the MAC address of the MD to correspond to the MAC address assigned to the MD . If the MD now enters the indoor area where the MD may be known from previous visits of the MD and sends the MAC address of the MD to the ALN the ALN and the LS may be duped into believing that the MD has entered the indoor area rather than the MD . For example the modem the PE and the App on the MD may each send the MAC address of the MD to the ALN the LS and the LBS AS respectively over interfaces and respectively. Receiving the same MAC address on all three interfaces may lead the ALN the LS and the LBS AS to assume that the MD has been detected e.g. if the MAC address of the MD had been received and stored e.g. by the LS and or the LBS following a previous visit of the MD to the indoor area . An external client who sends a request to the LS for the location of the MD and identifies the MD using the MAC address of the MD which has been spoofed by the user of the MD may now receive the location of the MD instead of the location of the MD which may cause problems for the external client and for the user of the MD . In this example it is possible that the MD may also be in the indoor area and that an App on the MD may interact with the LBS AS over interface which may confirm the presence of the MD in the indoor area e.g. via authentication of the App on the MD by the LBS AS . In this case if the ALN and the LS continue to identify the MD using the MAC address of the MD then the spoofing in this example may still succeed. For example the LBS AS may confirm to the LS that the MD is present in the indoor area by providing the MAC address of the MD which may also be provided to the LBS AS by the App on the MD . Since the same MAC address is being spoofed by the MD the LS and the ALN may still provide the location of the MD rather than the MD to an external client.

The above examples have been provided with reference to components of the system but are not applicable to the system when the system is configured as discussed below. The above examples show how user privacy may be compromised e.g. in the first example where a user of the MD is able to obtain unauthorized location of a user of the MD and how security may be compromised e.g. in the second example where the user of the MD is able to cause the location of the MD to be sent to an external client who has requested the location of the MD . To help safeguard security and privacy in the system one or more MD identities in addition to a MAC address may be supported on each of the interfaces. For example I F may use an individual App ID or a user ID which may be sent by the App to the LBS AS over I F to identify the App in I F may use an International Mobile Subscriber Identity IMSI a PE ID e.g. an ID assigned by the vendor or provider of the PE to the PE or an IP address which may be sent by the PE to the LS over I F to identify the MD or the PE to the LS and I F may use an IP address which may be sent by the MD or the modem e.g. in some or all signaling messages sent by the modem to the ALN over I F to identify the MD to the ALN .

To further safeguard security and privacy in the system mobile device verification may be implemented by the system using a common MD identity ID . A common MD ID may be provided by the MD on I F I F and I F if used. In a preferred implementation the common MD ID is not a MAC address normally associated with an MD in the case of WiFi access since as shown in the previous examples use of a common MAC address that is normally associated with an MD may allow spoofing. In some embodiments the common MD ID may be a MAC address that is not normally associated with an MD an IP address e.g. which may be assigned by a venue such as by the ALN or may be some other venue assigned ID. The common MD ID may associate other MD identities that may also be provided on these interfaces such as a MAC address an IP address if not the common MD ID a PE ID an App ID or a user ID and may be used to verify that the same MD is being used on I F I F and I F if used. If the common MD ID is also confidential e.g. not disclosed or made available publicly and not sent frequently on radio interfaces where it may be detected by other parties the common MD ID may not be susceptible to spoofing as in the first and second examples above . For example a common MD ID may be owned by a venue e.g. by the owner or operator of a venue in the indoor area and may be temporarily and uniquely assigned to a particular MD e.g. to the MD by the venue. The venue may further assign different common MD IDs to other MDs. In this case the association of a particular common MD ID to a particular MD e.g. the MD may not be known by other entities making it difficult or impossible for another entity e.g. another MD to spoof the common MD ID.

A venue assigned ID VID may be provided as the common MD ID by a venue e.g. by the owner or operator of a venue occupying the indoor area to an MD e.g. the MD for use in verifying by the venue side e.g. by the ALN the LS and the LBS AS that the same MD e.g. the MD is being used on each MD interface i.e. I F I F and I F if used . The VID may be associated with a venue and may be assigned by an entity located at the venue e.g. within the indoor area or may be assigned by an entity that is not physically located at the venue. The VID may be assigned and transferred to the MD on I F I F or I F and may subsequently be provided by the MD to the venue e.g. to the ALN the LS and or the LBS AS using the same interfaces to authenticate the identity of the MD . The VID provided to the MD would not be known to another MD or to another user provided that the VID provision is secure e.g. ciphered . The VID may be for example a temporary MAC address owned by a venue and used by an MD only while associated with the venue e.g. in or near the venue such as in communication range of a network such as the ALN at the venue . Use of a temporary MAC address as a VID may further safeguard user privacy since inclusion of the temporarily assigned MAC address rather than the normal MAC address of the MD in messages and signals sent by the modem in the MD to the ALN will not identify the presence of the MD to other parties e.g. other MDs who may only know the association of the normal MAC address of the MD to the user of the MD . For example the VID may be provided by the LBS AS over I F to the App on the MD and or may be provided by the LS to the PE over I F using SUPL. As another example the VID may be provided by the ALN to the modem using I F .

Referring now to the MD may comprise a computer system including a processor memory including software and or firmware although referred to herein as the software the modem the positioning engine PE the App an I F transceiver an I F transceiver and an I F transceiver . The various components of the MD may be connected in the manner shown in e.g. using a common bus to interconnect the processor the memory the modem the PE and the App or in other ways e.g. if the App is running as software in processor . The processor is preferably an intelligent hardware device e.g. a central processing unit CPU such as those made by ARM Intel Corporation or AMD a microcontroller an application specific integrated circuit ASIC etc. The processor could comprise multiple separate physical entities that can be distributed in the MD . The memory includes random access memory RAM and read only memory ROM . The memory is a non transitory processor readable storage medium that stores the software which is processor readable processor executable software code containing processor readable instructions that are configured to when executed cause the processor to perform various functions described herein although the description including claims may refer only to the processor performing or being configured to perform one or more of the functions . Alternatively the software may not be directly executable by the processor but configured to cause the processor e.g. when compiled and executed to perform the functions.

The modem is configured to modulate and demodulate signals to and from the ALN and supports the I F transceiver to send and receive signals to and from the ALN . Further the modem may support some or all of the I F transceiver and or the I F transceiver .

The PE supports positioning i.e. is configured for position determination of the MD and providing position information to the App . The PE may be configured to perform mobile based positioning MBP in which the PE may determine a location estimate for the MD itself and or may provide location measurements determined by the PE or by the modem to a remote device in the system e.g. the LS to determine the position of the MD . The PE may support interaction with the LS over I F and may support the SUPL location solution and positioning protocols such as LPP LPPe RRLP RRC and or IS 801. The PE may be enabled to receive assistance data from the LS to send location related measurements and or location estimates for the MD to the LS and may support authentication of the LS by the PE and authentication of the MD or the PE by the LS . The PE may be part of the modem e.g. may be a process or program running on the modem or may be supported by the software stored in memory running on processor .

The App is what a user of the MD may interact with in order to obtain location related services e.g. guidance using maps provided by the LBS AS . The App may be implemented by the processor executing the software in the memory and or by hardware. The App may instead be supported in the PE or the modem e.g. as a separate program or process running inside the modem or the PE .

The transceivers are communicatively coupled to and configured to send and receive signals to and from the ALN the LS and the LBS AS respectively. The I F transceiver is configured to convey signals between the PE and the LS and the I F transceiver is configured to convey signals between the App and the LBS AS . Either or both of the transceivers may be configured to send signals to the LS or the LBS AS respectively via the ALN . The transceivers may be configured to communicate wirelessly over the air using the Bluetooth short range wireless protocol IEEE 802.11x WiFi GSM WCDMA LTE cdma2000 and or another appropriate radio access protocol. The transceivers may be implemented at least partially by the processor and the software and one or more components may be shared by multiple ones of the transceivers . The transceivers and may make use of one or more common antennas for transmission and reception not shown in . Thus the transceivers may not be three physically separate entities. For example the transceivers may be one or more physical entities. Additionally the MD may contain transceivers not shown for acquiring and measuring GNSS signals and or signals from base stations APs and femtocells that are not part of the ALN to assist with positioning of the MD .

Referring now to with further reference to and the LS may comprise a computer system including a processor memory including software and or firmware although referred to herein as the software an I F transceiver an I F transceiver an I F transceiver and an I F transceiver . The processor is preferably an intelligent hardware device e.g. a central processing unit CPU such as those made by ARM Intel Corporation or AMD a microcontroller an application specific integrated circuit ASIC etc. The processor could comprise multiple separate physical entities that can be distributed in the LS . The memory includes random access memory RAM and read only memory ROM . The memory is a non transitory processor readable storage medium that stores the software which is processor readable processor executable software code containing processor readable instructions that are configured to when executed cause the processor to perform various functions described herein although the description including the claims may refer only to the processor performing or being configured to perform one or more of the functions . Alternatively the software may not be directly executable by the processor but configured to cause the processor e.g. when compiled and executed to perform the functions.

The transceivers are configured to send and receive signals to and from the ALN the MD the LBS AS and the ALN database respectively. The I F transceiver is configured to convey signals in particular between the PE of the MD and the LS . The transceivers may be configured to communicate by wireline means using IP or other transport protocols with other entities in the system e.g. the ALN the LBS AS and the ALN DB either directly or via routers bridges the Internet and or via other intermediate entities. Communication of I F transceiver with the PE may be via the ALN or via some other wireless network e.g. a wireless LAN or wireless wide area network . The transceivers may be implemented at least partially by the processor and the software and one or more components may be shared by multiple ones of the transceivers . In some implementations one or more of the transceivers may be implemented using processors and memory separate from the processor and the memory and may also in part or in whole be implemented in an entity physically separate from the LS e.g. a communications node.

Referring now to the LS may include a first receiver module first receiving means a second receiver module second receiving means a third receiver module third receiving means a comparison module comparison means a determination module determining means a location service information module location service information means and a venue identifier module venue identifier means . The modules are communicatively coupled to each other and may be functional modules implemented by the processor and the software stored in the memory . Thus reference to any of the modules performing or being configured to perform a function may be shorthand for the processor performing or being configured to perform the function in accordance with the software and or hardware of the processor although the description including claims may refer only to the processor performing or being configured to perform one or more of the functions . Alternatively the software may not be directly executable by the processor but configured to cause the processor e.g. when compiled and executed to perform the functions. Similarly reference to the processor performing a receiving comparing location service information providing or venue identifier assigning or providing function may be equivalent to the first receiver module the second receiver module the third receiver module the comparison module the determination module the location service information module and or the venue identifier module respectively performing the function. The venue identifier module is an optional module such that the LS may or may not contain the venue identifier module .

The receiver modules are configured to receive information over the interfaces I F I F and I F respectively. The first receiver module is configured to receive information from the LBS AS and is preferably implemented by the I F transceiver . The second receiver module is configured to receive information from the ALN and is preferably implemented by the I F transceiver . The third receiver module is configured to receive information from the MD in particular the PE and is preferably implemented by the I F transceiver .

The comparison module is configured to make a comparison of the information received by the first receiver module and information received by the second receiver module and or the third receiver module . The comparison module can determine whether identifying information received by the first receiver module and identifying information received by the second receiver module and or the third receiver module match. The identifying information may be associated with the MD and may be e.g. an Internet Protocol IP address a MAC address a Venue ID VID or another form of information such as a custom identifier. The identifying information may not directly identify the MD but may be used to determine the identity of the MD . The comparison module may be further configured to provide an indication e.g. to the determination module of whether the comparison indicates that the identifying information received by two or more of the modules and or match.

The determination module may determine whether a first mobile device corresponding to a first identifying information received from module a second mobile device corresponding to a second identifying information received from module and or a third mobile device corresponding to a third identifying information received from module are the same mobile device based at least in part on whether the first identification the second identification and or the third identification match one another. For example the determination module may determine that the first mobile device is the second mobile device by determining that the first identifying information matches the second identifying information. The determination module may also analyze other information associated with the identifying information such as when the identifying information was sent and or received to help determine whether the first and second mobile devices are one and the same mobile device. The determination module may be configured to send an indication to the location service information module that the first mobile device the second mobile device and or the third mobile device are the same mobile device i.e. that the sources of the identifying information received by the LS are the same entity.

The location service information module is configured to respond to the indication from the determination module that the sources of the identifying information received by the LS are the same entity. The module is configured to respond by sending location information regarding the identified mobile device e.g. the MD toward the LBS AS such that the LBS AS can provide a location based service to the entity e.g. to the App on the MD .

The venue identifier module is configured to assign a venue assigned identifier VID to the MD . The VID is called a venue assigned identifier because the VID is associated with a particular venue e.g. a venue within the indoor area even though the VID may be assigned by an entity that is not physically at the venue. The module may produce the VID using any of a variety of techniques or a combination of any number of such techniques. For example the module may generate the VID or a portion thereof using a random number generator pseudorandom number generator an incrementing counter etc. and or may select the VID or a portion thereof from an available list or set of VIDs. Thus for example the module may generate a VID with one portion being from a stored set and one portion being determined by a counter. The module assigns the VID to the MD in association with a venue with which the MD is preferably presently associated. The module may assign the VID to the MD for the duration of the MD s association with the venue e.g. the duration that the MD is at and or in and or or near the venue e.g. the building . For example the module may provide both the VID and duration and or geographic area to the MD or to the PE in the MD . When the provided duration has expired and or when the MD has left the provided geographic area the MD or the PE may stop using e.g. may discard the provided VID. Alternatively the MD or the PE may cease using e.g. discard the provided VID some time after no longer receiving signals from the ALN . Alternatively the MD may keep the provided VID e.g. in secure memory and reuse the VID on subsequent visits to the venue in the indoor area and the module may then indicate to the MD or to the PE whether use of the VID is still allowed on a subsequent visit or whether the VID will be replaced by a new VID assigned by module . The module provides the VID to the MD over I F using the I F transceiver or over I F via the ALN over I F using the I F transceiver . The module provides the VID to the MD securely e.g. as a ciphered signal so that the VID is not known to a user or MD other than the MD . Thus the module may be configured to encrypt the VID into an encrypted VID send the encrypted VID to the MD and the MD may be configured to decrypt the encrypted VID and to provide the VID either unencrypted or newly encrypted to the LS . In some implementations encryption of the VID may be supported via encryption of other information on I F I F or I F . For example if the PE and the LS e.g. the I F transceiver support the SUPL location solution then the VID may be transferred to the MD within a SUPL session using encryption already supported for other communication on the SUPL session. Similarly if the VID is transferred to the MD e.g. to the modem on I F via the ALN the transfer over I F may employ ciphering already in used for other communication on I F between the ALN and the MD or the modem . Similarly too if the VID is transferred to the MD e.g. to the App on the MD via the LBS AS using I F the VID may be ciphered using ciphering supported on I F for other communication between the LBS AS and the App . Thus in some implementations the module does not need to encrypt the VID.

The VID may take a variety of forms each of which may be used to guard against providing sensitive information to an entity that is spoofing the MD . For example the VID may be a temporary MAC address associated with a venue e.g. a venue for the indoor area and used by the MD only while at and or in and or near the venue. The VID is preferably easy to provide using the secure user plane location SUPL protocol. The VID is unique within the venue and may not be unique outside the venue. The VID may be a simple parameter e.g. a bit string an octet string a string of decimal digits a string of hexadecimal digits or may assume some other form.

Referring now to with further reference to and the LBS AS comprises a computer system including a processor memory including software and or firmware although referred to herein as the software a venue identifier module venue identifier means an I F transceiver an I F transceiver and an I F transceiver . The processor is preferably an intelligent hardware device e.g. a central processing unit CPU such as those made by ARM Intel Corporation or AMD a microcontroller an application specific integrated circuit ASIC etc. The processor could comprise multiple separate physical entities that can be distributed in the LBS AS . The memory includes random access memory RAM and read only memory ROM . The memory is a non transitory processor readable storage medium that stores the software which is processor readable processor executable software code containing processor readable instructions that are configured to when executed cause the processor to perform various functions described herein although the description including the claims may refer only to the processor performing or being configured to perform one or more of the functions . Alternatively the software may not be directly executable by the processor but configured to cause the processor e.g. when compiled and executed to perform the functions.

The transceivers are configured to send and receive signals to and from the MD e.g. the App in the MD the LS and the map DB respectively. The transceivers may be configured to communicate by wireline means using IP or other transport protocols with other entities in the system e.g. the LS the map DB either directly or via routers bridges the Internet and or via other intermediate entities. Communication of the I F transceiver with the MD or with the App in the MD may be via the ALN or via some other wireless network e.g. a wireless LAN or wireless wide area network . The transceivers may be implemented at least partially by the processor and the software and one or more components may be shared by multiple ones of the transceivers .

The venue identifier module may be similar to the venue identifier module discussed above with respect to . The VID provided by the module however would be provided to the MD via I F using the I F transceiver . The venue identifier module is an optional module such that the LBS AS may or may not contain the venue identifier module . The module may be a functional module implemented by the processor and the software stored in the memory . Thus reference to the module performing or being configured to perform a function may be shorthand for the processor performing or being configured to perform the function in accordance with the software and or firmware and or hardware of the processor . Similarly reference to the processor performing a VID assigning or VID producing function may be equivalent to the venue identifier module performing the function.

Referring now to with further reference to an example of use of a common MD ID using an implementation of the system to verify the MD for Network Based Positioning NBP is shown. As used herein the MD ID may not directly identify the MD but is associated with the MD . In this example the IP address used by the MD and optionally the MAC address used by the MD are used to verify that the MD has not been spoofed when a request for location services is received by the LBS AS allegedly from the MD . In this example the common MD ID is the IP address used by the MD optionally augmented by the MAC address of the MD . In this example the MD e.g. the processor or the modem sends a MAC address and an IP address associated with the MD to the ALN over I F using the I F transceiver and the ALN sends the MAC address and the IP address to the LS on I F . The LS receives the MAC address and the IP address from the ALN over I F through the first receiver module including the I F transceiver . The sending of the IP address and MAC address by the MD to the ALN over I F may be part of a targeted communication to provide the MD ID or may be part of normal communication with the ALN over I F by the MD and not performed specifically to send the common MD ID of the MD . A normal communication is a communication in accordance with a communication protocol for communication of audio and or video and or data and or control information etc. independent of a specific desire to transfer the common MD ID. For example most or all signals e.g. IEEE 802.11 frames in the case that the ALN contains WiFi APs and the MD supports WiFi communication sent over I F by the MD may contain the WiFi MAC address of the MD and most or all messages sent over I F by the MD that are intended for destination entities other than the ALN may be transferred within IP packets that each contain an IP header that includes the IP address of the MD . The IP address of the MD included in each IP header may be needed to ensure that the MD can receive responses from entities such as the ALN and the LS to which the MD sends messages and may thus correspond to an IP address assigned to the MD e.g. by the ALN or by an IP network accessible from the ALN and not to an IP address assigned to some other MD. Similarly the MAC address included by the MD in messages e.g. IEEE 802.11 frames transmitted by the MD to the ALN may correspond to a MAC address used by the MD in order to ensure that the MD can correctly receive responses from the ALN . Consequently both the IP address and MAC address may be trusted by the ALN and by the LS as being addresses used by and associated with the MD .

Further the MD or the App in the MD may send an App ID or user ID and the IP address and optionally the MAC address associated with the MD to the LBS AS over I F using the I F transceiver and the LBS AS receives the App ID or user ID and the IP address and optionally the MAC address through the I F transceiver . When the IP address and optionally the MAC address are sent by the App to the LBS AS over I F the App may have previously received one or both addresses from the PE e.g. in response to a request for one or both addresses from the App to the PE or the App may have obtained one or both addresses from an operating system not shown for the MD . The PE may in turn obtain one or both addresses from the modem in some implementations. In this example the MD may use the ALN to access the LBS AS including to send the App ID or user ID and the IP address and optionally the MAC address to the LBS AS . Thus while shows the App ID or user ID and IP address and optionally the MAC address being sent from the MD or the App directly to the LBS AS over I F the implementation of this communication from the MD to the LBS AS may include sending information over I F to the ALN with the ALN then forwarding the information to the LBS AS as part of normal ALN communications support e.g. using an IP router in the ALN that is connected directly or indirectly to the LBS AS but that is not shown in or in . Sending of the App ID or user ID by the MD or by the App to the LBS AS over I F may be deliberate and performed in order to identify the MD the user of the MD or the App to the LBS AS and enable the LBS AS to authenticate this identity. Sending of the IP address of the MD to the LBS AS over I F may be part of normal communication over I F . For example all messages sent by the MD or by the App over I F to the LBS AS may be transferred using IP and may be contained in a series of IP packets that contain the IP address of the MD in an IP header in each IP packet in order to conform to IP protocol requirements and enable the MD or the App to correctly receive responses from the LBS AS . Consequently the LBS AS can consider the received IP address to be assigned to the MD . If the MAC address of the MD is also transferred to the LBS AS over I F as part of message content and not as part of any protocol used over I F such as IEEE 802.11 WiFi signaling then the LBS AS may not be able to trust the received MAC address because its correct inclusion would not be necessary for correct communication protocol operation unlike correct inclusion of the IP address . The LBS AS then sends to the LS over I F using the I F transceiver the IP address that was received from the MD and optionally the MAC address received over I F . The LS receives the IP address and MAC address over I F through the second receiver module including the I F transceiver . Since the LBS AS trusts the IP address but not the MAC address received over I F the LS may likewise trust the IP address but not the MAC address received over I F e.g. may be configured with this trust association .

The LS can now determine whether e.g. verify that the IP address that the LS received over I F from the ALN and the IP address that the LS received over I F from the LBS AS come from the same source. For example the comparison module can compare the two IP addresses to determine whether they match. If the two received IP addresses match i.e. are the same the LS may assume that the same MD sent both addresses on I F and I F because as previously described the IP addresses received over I F and I F can be trusted to be associated with the sending MD since they form part of normal communication by this MD. In addition the LS may trust the MAC address received from the ALN over I F if the two received IP addresses match and may place additional trust in this MAC address if the same MAC address is also received from the LBS AS over I F . The LS could then use the received MAC address to identify the sending MD as the MD if preferred. In any case because the LS has verified that the same MD in this case the MD is in communication with the ALN over I F and in communication with the LBS AS over I F the LS may provide location services to the MD or to the App on the MD or to the LBS AS . For example the LS may request location related measurements from the ALN for the MD over I F and the ALN may subsequently return the identity of any APs in the ALN that detect signals from the MD and measurements of RSSI and or RTT and or of other quantities using these signals. The LS may identify the MD to the ALN using the IP address and or MAC address for the MD previously received and verified from the ALN . The LS may then employ NBP to compute a location for the MD using these measurements and known locations for APs in the ALN or may compute a series of locations for the MD at different times and may send the computed location or locations to the LBS AS over I F . The LBS AS may then send the location or locations to an external client e.g. if permitted by the MD or by the App may use the location or locations internally e.g. to help compute statistics on users in the indoor area and or may return the location or locations to the MD e.g. to the App on the MD . The LS can take other action based on the comparison of the IP addresses e.g. enabling the LBS AS to provide a location service e.g. location determination directions etc. to the MD or denying such information and or providing an alert to the LBS AS and or to the SSM when the SSM is present if the comparison shows that the received IP addresses or MAC addresses are not the same and hence that the same MD did not provide both IP addresses or both MAC addresses . In this example it may be difficult for an MD to spoof the IP addresses sent on I F and I F and the MAC address sent on I F because the transfer of these addresses on these interfaces is part of normal communication and hence the addresses must be associated at least temporarily with the MD .

In some implementations the MD may have more than one IP address e.g. an IP address assigned to the MD by the ALN or by an IP network accessible from the ALN and one or more other IP addresses assigned to the MD by other networks e.g. by a wireless network other than the ALN . If the MD sends communication to entities on the venue side e.g. to the ALN the LS the LBS AS through the same access network e.g. through the ALN then the MD can include the same IP address in all communication e.g. an IP address assigned by the ALN and the examples in and in subsequent figures can occur as described. In case the MD uses different IP addresses when communicating with different venue entities e.g. sends one IP address to the ALN and a different IP address to the LS and or to the LBS AS then the verification of a common IP address by the LS in these examples may not be possible. In that case the examples described later in may remain valid via use of a common MD ID that is a VID although the IP address verification portion of these examples may be skipped. For example in each of the LS may match the VID received from the MD over different interfaces and based on a successful match may conclude that the same MD i.e. the MD is being used on each interface even when a successful match of received IP addresses on different interfaces does not occur. For example the LS may be aware that in the indoor area it is possible for an MD such as the MD to acquire more than one IP address e.g. if more than one wireless access network has coverage in the indoor area and therefore more than one IP address may be used for communication by the MD . In this circumstance the LS may be willing to skip verification of the received IP addresses if a VID received on different interfaces can be matched. In indoor areas where only one access network is available e.g. the ALN however the LS may require that the same IP address be received from an MD over all interfaces e.g. I F I F and I F as described in as one condition for verifying the same MD is being used for all applicable interfaces.

Referring now to with further reference to an example of use of a common MD ID using an implementation of the system to verify the MD for MBP is shown. This example is similar to the example shown in and described above except that the MD here the PE also sends the IP address and an IMSI International Mobile Subscriber Identity to the LS over I F using the I F transceiver . The information sent over I F to the LS may form part of a location session between the MD or the PE and the LS e.g. using the SUPL location solution. In this example the common MD ID for the MD is again an IP address associated with the MD and optionally a MAC address for the MD . In this example the MD may use the ALN to access the LS including to send the IMSI for the MD the IP address associated with the MD and optionally the MAC address for the MD to the LS over I F . Thus while shows the IMSI and the IP address being sent from the MD directly to the LS over I F the implementation of this communication from the MD to the LS may include sending information over I F to the ALN with the ALN then forwarding this information e.g. using an IP router in the ALN to the LS similar to the MD sending information to the LBS AS via the ALN as discussed above. The IP address received by the LS from the MD over I F may be trusted if the LS is able to receive the IP packets sent by the MD e.g. via the ALN since the IP address of the MD may be a mandatory part of such IP packets e.g. part of the IP header of each IP packet and thus not easily capable of being spoofed. The optional MAC address received by the LS from the MD over I F may however not be trusted as the MAC address may just be part of message content and not associated with a communications protocol visible to the LS . The IMSI sent by the MD to the LS over I F may be trusted if the LS is able to authenticate the IMSI. For example if the SUPL ULP protocol is used over I F by the MD and the LS the LS may employ SUPL authentication procedures to verify the IMSI. In some implementations the MD may not send an IMSI but some other MD identity such as a Mobile Subscriber Integrated Services Digital Network Number MSISDN which may be authenticated by the LS instead of an IMSI. The LS can determine whether the same MD provided the IP addresses that the LS received over each of I F I F and I F by comparing the three IP addresses to determine whether they indicate that they came from the same source e.g. that they match. If the three received IP addresses match and if any MAC addresses received over I F I F and or I F by the LS also match then the LS can assume that the same MD sent all the addresses. The LS may also be able to identify the sending MD as being the MD from the MAC address received if a MAC address is received by the LS or from any verified IMSI or MSISDN received by the LS from the MD over I F . The LS may then use NPB to provide location services related to the MD to the LBS AS and or to the MD via the LBS AS as described in association with . In addition or alternatively the LS may employ MBP e.g. using the SUPL solution over I F to provide location services to the MD such as providing location assistance data to the MD determining a location of the MD and providing the location to the MD . The LS may further obtain the location or a series of locations for the MD using MBP over I F and provide the location or locations to the LBS AS after which the LBS AS as in i may return the location or locations to an external client or to the MD ii may retain the location or locations to help gather data on users in the indoor area and or iii may provide location related content to the MD or to the App over I F such as map data and directions.

Referring now to with further reference to another example of use of a common MD ID using an implementation of the system to verify the MD for NBP is shown. In this example the LBS AS in particular the venue identifier module is configured to reassign a MAC address to the MD and to send the reassigned MAC address as a venue assigned identifier VID to the MD . In this example the common MD ID is a VID and the VID is the MAC address assigned to the MD by the LBS AS . The VID here MAC address may be assigned temporarily to the MD by the LBS AS while the MD is in a venue supported by the LBS AS e.g. while the MD is in the indoor area and may replace the normal MAC address of the MD for the period of assignment. The period of assignment or assignment period may be finite e.g. 10 minutes or equal to a period during which the MD is in the indoor area etc. or open ended i.e. indefinite e.g. if VIDs are not reused by the assigning entity here the LBS AS although an open ended assignment could be terminated e.g. by a follow up communication to the MD from the LBS AS . The VID may also be obtained by the LBS AS from some entity in a venue e.g. from a Service and Security Manager SSM described later. The VID may be unique to the MD for the period of assignment to the MD and thus not assigned to any other MD while assigned to the MD . After the VID has been assigned the MD may include the VID here the new MAC address in a communication e.g. IEEE 802.11 frames that the MD sends to the ALN over I F . To start the VID assignment the LBS AS may receive an App ID e.g. for the App or a user ID from the MD or from the App over I F and may authenticate this ID e.g. may verify that the ID belongs to the MD or to the App and that the ID belongs to an App or user that is entitled to receive location related services from the venue supported by the LBS AS in the indoor area . In order to ensure that the MD and the user of the MD and not some other MD and user receive location related services the LBS AS may send the VID containing a venue assigned MAC address to the MD or to the App over I F . Specifically the venue identifier module may send the VID via the I F transceiver over I F to the App of the MD that receives the VID through the I F transceiver . In this case I F may be a secure connection which may be established between the LBS AS and the MD just after or just before the LBS AS has verified the App ID or user ID sent by the MD or by the App and may employ ciphering to prevent other users and MDs from being able to intercept and discover the VID sent on I F to the MD or the App . The App may provide the VID here the MAC address to the PE via I F B and the PE may provide the VID to the modem via I F A. In some implementations the App may provide the received VID here the MAC address to the modem in other ways e.g. via an operating system for the MD . The modem may use the provided MAC address in the VID for all communication over I F as described earlier and may thus provide the VID here the MAC address and the IP address of the MD to the ALN over I F using the I F transceiver . The ALN transfers the received VID here the MAC address and the received IP address over I F to the LS that receives the VID and the IP address using the I F transceiver . Further the LBS AS in particular the venue identifier module may send the VID here the assigned MAC address over I F using the I F transceiver to the LS that receives the VID using the I F transceiver . The LS may verify that the same VID here the same MAC address is received from the LBS AS over I F and from the ALN over I F e.g. may perform a comparison using comparison module . Since the VID here the MAC address was assigned by the venue e.g. by the LBS AS and was transferred securely to the MD over I F the LS may assume that the same MD is being used over I F and over I F if the same VID is received by the LS over I F and I F . The LS may then provide location services associated with the MD to the LBS AS using NBP as described in association with . Further the LBS AS may use location information e.g. location estimates for the MD received from the LS to provide location services to the MD or to the App to an authorized external client and or to a venue owner or operator. In case the LS does not determine a match between the VID received from the LBS AS and the VID here the MAC address received from the ALN the LS may assume that the same MD is not being used over I F and I F and may withhold provision of location services.

Referring now to with further reference to another example of use of a common MD ID using an implementation of the system to verify the MD for MBP is shown. In this example the common MD ID is a VID that comprises a new MAC address assigned by a venue e.g. by the LBS AS to the MD . This example is similar to the example shown in and described above except that the MD here the PE also sends the VID comprising the MAC address assigned to the MD by the LBS AS over I F the IP address associated with the MD and an IMSI for the MD to the LS over I F using the I F transceiver . The information sent over I F may form part of a location session between the MD or the PE and the LS e.g. using the SUPL location solution. In this example the MD may use the ALN to access the LS including to send the IMSI the VID and the IP address to the LS . Thus while shows the IMSI the VID and the IP address being sent from the MD directly to the LS over I F the implementation of this communication from the MD to the LS may include sending this information over I F to the ALN with the ALN then forwarding the information e.g. using an IP router in the ALN to the LS similarly to the MD or the App sending information to the LBS AS via I F via the ALN as discussed above. The IP address associated with the MD that is sent by the MD e.g. by the PE to the LS e.g. via the ALN may be trusted by the LS because the LS may be able to receive the IP packets sent by the MD which contain the IP address of the MD e.g. in an IP header in each IP packet included for the purposes of normal communication including being able to receive responses e.g. from the LS over I F . Hence the likelihood of the IP address being false e.g. spoofed from another MD may be very low. Similarly the IMSI for the MD or possibly another ID for the MD such as an MSISDN that is sent by the MD e.g. the PE to the LS over I F may be trusted by the LS if the LS is able to authenticate the IMSI e.g. using authentication supported by the SUPL location solution. However the VID here the MAC address sent by the MD to the LS on I F may not be considered trustworthy by the LS as the VID here the MAC address may not be part of any communication transport protocol intercepted and supported by the LS and thus could possibly be spoofed on I F . The LS can determine whether the same MD has sent the information received by the LS over I F I F and I F as before by matching the IP address e.g. 3 separate IP addresses received over each of these 3 interfaces and by matching the VID e.g. 3 separate VIDs each comprising the MAC address assigned to the MD e.g. using comparison module . If the same IP address is received over all 3 interfaces I F I F and I F and if the same VID is received over all 3 interfaces or just over any 2 interfaces if not received over all 3 interfaces then the LS may consider that the same MD is sending the information that was received and therefore the received information may be trusted. Further the LS may identify the MD from any IMSI received and authenticated over I F or by associating the VID that was received to an application or user e.g. if the LBS AS has provided this association in data accessible to the LS . The LS may then provide location services to the MD or associated with the MD as described for e.g. may send location assistance data to the MD may compute and send a location of the MD to the MD and or may send a location or series of locations for the MD to the LBS AS . The LS may further use NBP e.g. measurements obtained for the MD by the ALN to locate the MD and or may use MBP e.g. location measurements or a location estimate received from the MD over I F to locate the MD . The LBS AS may provide the location of the MD e.g. received from the LS to the MD may provide location related content to the MD e.g. navigation data maps directions may provide the location of the MD to authorized external clients and or may use location information for the MD to help compile statistical data for the MD or for all users in indoor area .

Referring now to with further reference to and another example of use of a common MD ID using an implementation of the system to verify the MD for MBP is shown. In this example the common MD ID is a VID that comprises a new MAC address assigned by a venue e.g. by the LS to the MD . In this example the LS in particular the venue identifier module is configured to reassign a new MAC address to the MD and to send the reassigned MAC address as a venue assigned identifier VID to the MD over I F . As in the VID may be unique to the MD for the period of assignment to the MD and thus not assigned to any other MD while assigned to the MD . The venue identifier module sends the VID via the I F transceiver over I F to the MD in particular to the PE that receives the VID through the I F transceiver . In this case I F may be a secure connection such that the VID is provided to the MD in a trustworthy manner. For example the MD e.g. the PE may access the LS to obtain location services e.g. obtain the location of the MD or obtain location assistance data from the LS such as BSA data for the ALN or GNSS satellite data . Alternatively the LS may access the MD e.g. the PE in order to locate the MD and provide the location of the MD to an authorized external client such as the LBS AS . As part of the access between the MD e.g. the PE and the LS the LS may authenticate the identity of the MD e.g. an IMSI or MSISDN for the MD and or the MD e.g. the PE may authenticate the identity of the LS e.g. may verify that the LS belongs to a venue for the indoor area and that the MD is authorized e.g. by a home wireless network operator to provide location services to the MD . Preferably following any authentication the LS may send a VID comprising a new MAC address to the MD e.g. to the PE as shown in . As an example the SUPL location solution may be supported by the LS and the MD and may be used for mutual authentication and transfer of the VID from the LS to the MD . Communication on I F between the LS and the MD e.g. the PE may be transferred via the ALN e.g. using I F and I F and may further be transferred via the modem in the MD . Following receipt of the VID from the LS the PE may provide the VID here the MAC address to the modem via I F A. The modem may then use the received MAC address rather than any MAC address normally used by the MD for all communication with the ALN . Thus the modem may send one or more signals or messages to the ALN that may be intercepted by APs in the ALN and that contain the new MAC address here the VID and the IP address of the MD over I F using the I F transceiver . The ALN may transfer the received MAC address i.e. the VID and the received IP address over I F to the LS that receives the VID and the IP address using the I F transceiver . The ALN and the LS may consider both the received MAC address i.e. the VID and received IP address to be trustworthy as they may have been received as part of normal communication protocols e.g. an IEEE 802.11 protocol in the case of the MAC address and the IP protocol in the case of the IP address used on I F and thus would be unlikely to be false e.g. spoofed from another MD . Further the PE may send the new MAC address i.e. the VID to the App via I F B and the App may send an App ID or User ID the IP address for the MD and the MAC address i.e. the VID over I F using the I F transceiver to the LBS AS . The LBS AS receives the App ID or User ID the IP address and the MAC address VID using the I F transceiver and may then send the MAC address i.e. the VID and the IP address using the I F transceiver over I F to the LS . All communication on I F between the LBS AS and the MD e.g. the App may be transferred via the ALN e.g. using I F and an interface between the ALN and the LBS AS that is not shown in or in and may further be transferred via the modem in the MD . The LBS AS may verify e.g. authenticate the App ID or user ID received from the App over I F after which or before which a secure e.g. ciphered connection may be established between the App and the LBS AS . The MAC address i.e. the VID that is transferred from the App to the LBS AS over I F may then be sent using this secure connection and thus may not be seen e.g. intercepted by other MDs. However because the MAC address may not form part of a communication protocol visible to the LBS AS the LBS AS may not consider the MAC address to be trustworthy. However the LBS AS may consider the IP address received from the MD to be trustworthy if the communication protocol e.g. IP within which the IP address is contained is visible to the LBS AS as described earlier since the included IP address may then be used to support other communication with the MD e.g. responses from the LBS AS and may thus be correct and not susceptible to spoofing.

As described above and as shown in the LS may receive a MAC address and IP address from the ALN over I F that are considered trustworthy and an IP address that is considered trustworthy and a MAC address that is not considered trustworthy from the LBS AS over I F . The LS may also receive an IP address from the MD e.g. the PE over I F that is considered trustworthy and may then send a VID comprising a MAC address to the MD e.g. the PE over I F . The LS can make a determination as to whether the same MD is being used on I F I F and I F . As in the previous example for this may be done by comparing the IP addresses received by the LS on I F I F and I F and by comparing the MAC addresses here VIDs received by the LS on I F and I F and sent by the LS on I F . The comparison may be performed by comparison module . If the IP addresses all match and the MAC addresses here VIDs all match then the LS may consider that the same MD is being used across each of interfaces and . Further the LS may identify this MD as being the MD in some implementations using the IMSI or some other MD ID such as an MSISDN . The LS may then provide location services to or associated with the MD using NBP and or MBP as described for and or may provide location information e.g. one or more locations for the MD to the LBS AS . The LBS AS may further provide location services to the MD and or an authorized external client as described for . If the IP addresses and the MAC addresses here VIDs do not all match then the LS may consider that the same MD is not being used across each of interfaces and and may withhold provision of location services.

Referring now to with further reference to another example of use of a common MD ID using an implementation of the system to verify the MD for NBP is shown. In this example the common MD ID is a VID that is typically not a MAC address and may be a string of characters decimal digits hexadecimal digits a binary string an octet string or some other value. The VID may be assigned by the LBS AS or may be obtained by the LBS AS from some entity in a venue e.g. from a Service and Security Manager SSM described later. In this example the LBS AS in particular the venue identifier module may be configured to assign the non MAC address VID to the MD and to send the VID to the MD over I F . To determine the VID to assign the venue identifier module may produce the VID e.g. using a random number generator etc. select the VID from a stored set of VIDs or obtain the VID in another manner e.g. from the SSM . The VID may be unique to the MD for the period of assignment to the MD and thus not assigned to any other MD while assigned to the MD . To start the VID assignment the LBS AS may receive an App ID e.g. for the App or a user ID from the MD or from the App over I F and may authenticate this ID e.g. may verify the ID is assigned to the App or to the MD and identifies an App or user entitled to receive location related services from the venue supported by the LBS AS in the indoor area . In order to help ensure that the MD and the user of the MD and not some other MD or user receive location related services the LBS AS may send the VID to the MD or to the App over I F . Specifically the venue identifier module may send the VID via the I F transceiver over I F to the App of the MD that receives the VID through the I F transceiver . In this case I F may be a secure connection which may be established between the LBS AS and the MD after or before the LBS AS has verified the App ID or user ID sent by the MD or by the App and may employ ciphering to prevent other users and MDs from being able to intercept and discover the VID sent on I F . As before communication on I F between the LBS AS and the MD e.g. the App may be transferred via the ALN e.g. using I F and an interface between the ALN and the LBS AS that is not shown in or in and may further be transferred via the modem in the MD . The App may provide the VID to the PE via I F B and the PE may provide the VID to the modem via I F A. In some implementations the App may provide the received VID here the MAC address to the modem in other ways e.g. via an operating system for the MD . The modem may provide the VID the MAC address for the MD and the IP address of the MD to the ALN over I F using the I F transceiver . The ALN may transfer the received VID the MAC address and the IP address over I F to the LS that receives the VID and the IP address using the I F transceiver . The modem may also provide the MAC address for the MD to the PE via I F A and the PE may provide the received MAC address to the App via I F B. The App may send the IP address of the MD and possibly the MAC address received from the PE via the I F transceiver over I F to the LBS AS when in communication with the LBS AS e.g. at the same time that the App sends the user ID or App ID to the LBS AS and receives the VID from the LBS AS as described earlier . Further the LBS AS may send the received IP address the MAC address if received from the App and the VID assigned to the MD over I F using the I F transceiver to the LS that receives the IP address the MAC address if sent and the VID using the I F transceiver . The ALN and the LS may consider the IP address and MAC address received from the MD over I F as trustworthy if they are included within an access protocol or transport protocol e.g. an IEEE 802.11 protocol in the case of a MAC address and IP in the case of an IP address that is visible to e.g. intercepted by the ALN . Likewise the LBS AS and the LS may consider an IP address received from the MD over I F as trustworthy if included within a transport protocol visible to e.g. intercepted by the LBS AS . Further the LS may consider a VID received from the LBS AS as trustworthy due to being assigned by the LBS AS . However a MAC address transferred by the MD to the LBS AS and then transferred to the LS and any VID transferred by the MD to the ALN and then to the LS may not be considered trustworthy initially due to being included inside other messages and not being included for communication purposes and hence being susceptible to spoofing.

As described above and as shown in the LS may receive over I F from the ALN a MAC address and IP address that are considered trustworthy and a VID that is not considered trustworthy and may receive over I F from the LBS AS an IP address and VID that are considered trustworthy and a MAC address that is not considered trustworthy. The LS can make a determination as to whether the same MD is being used on I F and I F . As in the previous examples this may be done by comparing the two IP addresses two MAC addresses if received and two VIDs received by the LS on I F and I F . The comparison may be performed by comparison module . As a MAC address can be spoofed on I F the MAC address comparison may not be reliable. However the IP address comparison may be reliable if the MD uses the ALN to access the LBS AS . The VID comparison may also be reliable because the venue i.e. the LS or the LBS AS associated with the venue assigned the VID. If the two IP addresses the two MAC addresses if received and the two VIDs all match then the LS may consider that the same MD is being used across each of interfaces and . Further the LS may identify this MD as being the MD in some implementation using the MAC address or VID received from the ALN or from the LBS AS e.g. if a lookup table is available to the LS that associates the MD identity to the MAC address or VID . The LS may then provide location services to or associated with the MD using NBP as described for and and or may provide location information e.g. one or more locations for the MD to the LBS AS . The LBS AS may further provide location services to the MD and or an authorized external client as described for and .

Referring now to with further reference to another example of use of a common MD ID using an implementation of the system to verify the MD for MBP is shown. In this example the common MD ID is a VID that is typically not a MAC address and may be a string of characters decimal digits hexadecimal digits a binary string an octet string or some other value. The VID may be assigned by the LBS AS or may be obtained by the LBS AS from some entity in a venue e.g. from a Service and Security Manager SSM described later. This example is similar to the example shown in and described above except that the MD here the PE also sends the VID the IP address of the MD an IMSI or some other identification for the MD such as an MSISDN and possibly the MAC address of the MD to the LS over I F using the I F transceiver . The IP address associated with the MD that is sent by the MD e.g. by the PE to the LS e.g. via the ALN may be trusted by the LS because the LS may be able to receive the IP packets sent by the MD which contain the IP address of the MD included for the purposes of normal communication including being able to receive responses e.g. from the LS over I F . Hence the likelihood of the IP address being false e.g. spoofed from another MD may be low. Similarly the IMSI for the MD or possibly another ID for the MD such as MSISDN that is sent by the MD e.g. the PE to the LS over I F may be trusted by the LS if the LS is able to authenticate the IMSI e.g. using authentication supported by the SUPL location solution. However the VID and if included the MAC address sent by the MD to the LS on I F may not be considered trustworthy by the LS as the VID and the MAC address may not be part of any communication transport protocol intercepted and supported by the LS and thus could possibly be spoofed on I F . The LS can make a determination as to whether the same MD provided the three VIDs the three IP addresses and possibly the two or three MAC addresses that the LS received over I F I F and I F by comparing the three VIDs the three IP addresses and if provided on I F and or I F the two or three MAC addresses to determine whether the received information indicate the same source e.g. that the three VIDs the three IP addresses and if provided the two or three MAC addresses match i.e. the 3 VIDs match the 3 IP addresses match and the 2 or 3 MAC addresses match . Further the LS may identify the MD from any IMSI received and authenticated over I F or by associating the VID that was received to an application or user e.g. if the LBS AS has provided this association in data accessible to the LS . A MAC address can be spoofed on I F and or I F so MAC address comparison by itself may not be reliable. An IP address comparison may be reliable unless the MD does not use the ALN to access the LBS AS and or the LS e.g. if the MD uses some other access network to access the LBS AS and or the LS and uses a different IP address e.g. assigned by the different access network for such access . A VID comparison may always be reliable because the venue e.g. the LBS AS assigned the VID uniquely to the MD in a manner not visible to other MDs. Based on verifying the same MD or the MD for each of interfaces and the LS can take appropriate action as discussed above e.g. in association with to provide location services to the MD the LBS AS and or an external client and the LBS AS can provide appropriate location services to the MD an external client and or the venue based on the determination.

Referring now to with further reference to another example of use of a common MD ID using an implementation of the system to verify the MD for MBP is shown. In this example the common MD ID is a VID that is typically not a MAC address and may be a string of characters decimal digits hexadecimal digits a binary string an octet string or some other value. The VID may be assigned by the LS or may be obtained by the LS from some entity in a venue e.g. from a Service and Security Manager SSM described later. In this example the LS in particular the venue identifier module is configured to assign a non MAC address VID to the MD and to send the VID to the MD over I F . The venue identifier module sends the VID via the I F transceiver over I F to the MD in particular to the PE that receives the VID through the I F transceiver . In this case I F may be a secure connection such that the VID is provided to the MD in a trustworthy manner. For example the MD e.g. the PE may access the LS to obtain location services e.g. obtain the location of the MD or obtain location assistance data from the LS such as BSA data for the ALN or GNSS satellite data . Alternatively the LS may access the MD e.g. the PE in order to locate the MD and provide the location of the MD to an authorized external client such as the LBS AS . As part of the access between the MD e.g. the PE and the LS the LS may authenticate the identity of the MD e.g. an IMSI or MSISDN for the MD and or the MD e.g. the PE may authenticate the identity of the LS e.g. may verify that the LS belongs to a venue for the indoor area and or that the MD is authorized to receive location services from the LS e.g. by a home wireless network operator . Following any authentication the LS may send a VID as shown in . In addition the MD may send the IP address of the MD and possibly a MAC address for the MD e.g. received by the PE from the modem over I F A to the LS . As an example the SUPL location solution may be supported by the LS and the MD and may be used for mutual authentication and transfer of the VID from the LS to the MD and transfer of the MAC and IP addresses from the MD to the LS . Communication on I F between the LS and the MD e.g. the PE may be transferred via the ALN e.g. using I F and I F and may further be transferred via the modem in the MD . The LS may consider the IP address received from the MD to be trustworthy e.g. if the IP address forms part of normal communication between the MD and the LS but may not consider the received MAC address to be trustworthy if included inside a transport protocol message. Following receipt of the VID from the LS the PE may provide the VID to the modem via I F A and to the App via I F B. The modem may send one or more signals or messages to the ALN or that may be intercepted by APs in the ALN that contain the VID the MAC address of the MD and the IP address of the MD over I F using the I F transceiver . The ALN may transfer the received VID the received MAC address and the received IP address over I F to the LS that receives the VID the MAC address and the IP address using the I F transceiver . The ALN and the LS may consider both the received MAC address and the received IP address to be trustworthy as they may have been received as part of communication protocols e.g. an IEEE 802.11 protocol in the case of the MAC address and the IP protocol in the case of the IP address and thus would be unlikely to be false e.g. spoofed from another MD . However the ALN and the LS may consider the received VID to be untrustworthy due to being received inside access and transport protocol messages and thus being susceptible to spoofing.

The modem may send the MAC address of the MD to the PE and the PE may forward the MAC address and the VID to the App via I F B. The App may send the App ID for the App or a User ID the IP address for the MD the VID and optionally the MAC address for the MD over I F using the I F transceiver to the LBS AS . The LBS AS receives the App ID or User ID the IP address the VID and if sent the MAC address using the I F transceiver and may then send the VID the IP address and optionally the MAC address using the I F transceiver over I F to the LS . Communication on I F between the LBS AS and the MD e.g. the App may be transferred via the ALN e.g. using I F and an interface between the ALN and the LBS AS not shown in or in and may further be transferred via the modem in the MD . The LBS AS may verify e.g. authenticate the App ID or user ID received from the App over I F after which or before which a secure e.g. ciphered connection may be established between the App and the LBS AS . The VID and MAC address if sent that are transferred from the App to the LBS AS over I F may be sent using this secure connection and thus may not be seen e.g. intercepted by other MDs. However because the VID and MAC address if sent may not form part of a communication transport protocol visible to the LBS AS the LBS AS and the LS may not consider the received VID and the MAC address if sent to be trustworthy. However the LBS AS and the LS may consider the IP address received from the MD to be trustworthy if the communication protocol e.g. IP within which the IP address is contained is visible to the LBS AS since the included IP address may then be used to support other communication with the MD e.g. responses from the LBS AS and may thus be correct and not susceptible to spoofing.

The LS can now make a determination by appropriate comparisons as to whether the same MD is being used on I F I F and I F i.e. that the same MD provided the VIDs the IP addresses and optionally the MAC addresses that the LS received or sent in the case of a VID for I F over I F I F and I F and that the VIDs received over I F and I F correspond to the VID assigned by the LS and provided to the MD over I F . As before the LS can make this determination by matching the IP address e.g. three separate IP addresses received over each of I F I F and I F and by matching the VIDs received over I F and I F with the VID sent over I F and by matching any MAC addresses received over I F I F and I F e.g. using comparison module . If the same IP address is received over all interfaces I F I F and I F the same VID is received over I Fs and as is sent over I F and if the same MAC address is received over I Fs and or then the LS may consider that the same MD is sending the information that was received and therefore the received information may be trusted. The MAC address comparison may not be fully reliable as the MAC address could be spoofed on I F or I F . The IP address comparison may be reliable unless the MD does not use the ALN to access the LBS AS over I F or the LS over I F e.g. uses a different access network with an IP address different to that used for the ALN access over I F . The VID comparison may always be reliable because the venue e.g. the LS assigned the VID and transferred the VID to the MD in a secure manner.

Having verified that the same MD is sending information over I Fs and the LS may identify the MD from any IMSI or MSISDN received. The LS may also provide location services to the MD or associated with the MD as described before e.g. for and . Thus for example the LS may send location assistance data to the MD may compute and send a location of the MD to the MD and or may send a location or series of locations for the MD to the LBS AS . The LS may further use NBP e.g. measurements obtained for the MD by the ALN to locate the MD and or may use MBP e.g. location measurements or a location estimate received from the MD over I F to locate the MD . The LBS AS may provide the location of the MD e.g. received from the LS to the MD may provide location related content to the MD e.g. navigation data maps directions may provide the location of MS to authorized external clients and or may use location information for the MD to compile statistical data for the MD or all users in indoor area .

A venue assigned user ID or App ID sent over I F by an MD e.g. by an application in the MD as in the previous examples described in association with may be used e.g. by an LBS AS such as the LBS AS to identify either a particular application e.g. the App in a particular MD e.g. the MD or a particular user of an MD e.g. the user of the MD . The user ID or App ID may be assigned when a user or an application e.g. the App first registers for service with the LBS AS and establishes service and privacy preferences. This may be accomplished using authentication algorithms using known methods.

Mobile device identification on I F e.g. identification of the MD by the ALN or on I F e.g. identification of the MD by the LS may be performed using a MAC address an IP address or a VID that is sent by an MD e.g. the MD to an ALN e.g. the ALN or LS e.g. the LS . The ALN or the LS may identify the sending MD e.g. the MD by associating the received address or VID with information for the MD obtained previously by the ALN or the LS e.g. with a VID assigned by the LS or the LBS AS to the MD or with a MAC address or IP address known to belong to the MD .

A location service may be withheld by the LS in the absence of a request for such service and or permission to provide the service. For example the LS may withhold location support for the MD e.g. if there is an MD initiated location request over I F from the MD to the LS until a configuration request is received for the MD from the LBS AS . As another example if a service and security manager SSM is supported as discussed below then the LS may query the SSM regarding permission to support MD location requests and withhold location service information in the absence of permission.

Venue assistance data i.e. data to assist with mobile device location determination such as BSA data may be protected in a variety of ways e.g. to help prevent venue assistance data being passed accidentally or deliberately from an MD e.g. the MD that received the assistance data from an LS e.g. the LS to some unauthorized third party such as another venue or another location service provider not associated with the venue to which the data belongs. For example sensitive venue assistance data may be provided only to an MD e.g. to the MD via I F or I F after an application e.g. the App that is trusted by the venue makes a service request to the LBS AS that is authenticated by the LBS AS and the LBS AS then configures or provides the LS with the MD ID e.g. a MAC address or a VID for the MD . In this case the LS may use receipt of the configured provided MD ID as a trigger to permit sensitive assistance data to be provided to the identified the MD . As another example the PE may send a PE provider ID e.g. configured in the PE by the provider for the PE to the LS e.g. using SUPL that can be authenticated by the LS . If the PE provider ID is associated with a trusted PE provider e.g. as indicated in a database stored in the memory of the LS then the LS may provide sensitive assistance data to the PE . In this case the PE would be configured not to release the sensitive assistance data to applications or users and to discard the sensitive assistance data in response to the MD leaving the venue e.g. disconnecting from the ALN or the LS or after a threshold amount of time has elapsed. As another example IDs of APs of the ALN e.g. MAC addresses in the case of WiFi APs may be reassigned. The IDs such as MAC addresses may be reassigned intermittently e.g. periodically aperiodically a combination of aperiodically and periodically etc. . The reassignment of the IDs may help prevent reuse of previously provided sensitive assistance data by an unauthorized third party since after the IDs are reassigned any assistance data that referred to the previous IDs would no longer be valid. In addition other data about venue APs in the ALN that may have been provided by MDs to unauthorized third parties via crowdsourcing may also no longer be applicable once AP IDs have been reassigned.

In an implementation reassigning AP IDs e.g. MAC addresses of WiFi APs or cell identifiers for Femtocells may be supported using elements in the system described in association with and . Referring to to reduce overhead of AP ID reassignment in a venue fixed internal AP IDs can be used in the ALN DB and in signaling messages used on I F between the ALN DB and the LS . The LS may convert between internal AP IDs sent or received on I F and external AP IDs e.g. MAC addresses used for assistance data and measurement reports sent or received on I F and or I F . The reassignment of AP IDs may then not affect data and signaling from the perspective of ALN DB e.g. may not affect AP BSA data stored in the ALN DB transfer of assistance data e.g. BSA data from ALN DB to the LS or transfer of measurement data for APs obtained by MDs e.g. the MD and crowd sourced to the LS and subsequently transferred from the LS to ALN DB . The AP ID conversion in the LS may use an AP ID mapping table e.g. mapping a fixed internal ID for each AP to an external ID and may not be a significant burden because the LS may translate anyway between different protocols and data formats used on different interfaces for the LS and may add AP ID mapping to this already existing protocol or data format translation. As one example the LS may translate between assistance data formats e.g. for BSA data received over I F from ALN DB and assistance data formats relayed over I F to the ALN or over I F to the MD . As a second example crowd sourced measurement data e.g. for APs in the ALN or APs in networks other than the ALN may be received by the LS according to one format over I F from MDs such as the MD and may be converted to a different format by the LS and then forwarded over I F to ALN DB . If the LS keeps a record of which MDs have been sent assistance data containing external AP IDs then the LS may update these MDs with new external AP IDs if the external IDs have been reassigned by the LS . In some implementations the ALN may manage the AP ID reassignment e.g. with a report sent to the LS indicating reassigned AP IDs. Alternatively the LS may manage the AP ID reassignment. Alternatively still the ALN DB may manage the AP ID reassignment with the ALN DB replacing old AP assistance data with new assistance data containing reassigned AP IDs sent to the LS if AP IDs are reassigned. In this case the LS translation of AP addresses may be avoided. In any case measurement reports from MDs that reference previous external AP IDs may be recognized and with the previous IDs replaced by the new IDs e.g. by the LS or by the ALN DB provided that any new set of AP IDs is non overlapping with the previous set of AP IDs.

The LBS AS can support service authorization and privacy on behalf of MD users e.g. the user of the MD . Allowed services and privacy can be negotiated between a user and the LBS AS when the user registers for service e.g. when the App registers for service with the LBS AS over I F after a user of the MD invokes the App for the first time and or when the user requests service via the App after entering a venue e.g. when the user enters the coverage area of the ALN . The LS can then fulfill e.g. respond to any location requests from the LBS AS for the MD and may assume that the LBS AS will safeguard user privacy. The LBS AS can also configure access restrictions for the MD directly in the ALN such as whether the MD is allowed Internet access which venue intranet entities the MD is allowed to access etc. Other capabilities of the LBS AS are possible such as recording of and billing for the ALN usage by the MD and location services provided to the MD by the LS and the LBS AS .

Referring to with further reference to a process of providing location based services includes the stages shown. The process is however an example only and not limiting. The process can be altered e.g. by having stages added removed rearranged combined performed concurrently and or having single stages split into multiple stages. For example stage discussed below with respect to could be added to the process . Further stages discussed below with respect to could be added to the process .

The process has a common mobile device identifier MD ID provided by the MD via the interfaces I F and I F to the LS . The common MD ID associates other MD identifiers that may also be provided that facilitates verification that the same MD is being used on interface I F and interface I F and interface I F if used . The common MD ID should not be able to be spoofed e.g. because the MD ID is confidential and is difficult to be intercepted and possibly not interceptable by other entities and or the MD ID is owned by a venue and unlikely to be and possibly not capable of being copied. Thus common information associated with the MD is provided through different interfaces to the LS and the LS determines whether the information is indicative of a single source e.g. the common information matches. The LS responds to verifying that the information is indicative of a single source by providing and or approving the LBS AS to provide location service information e.g. a location of the MD or location assistance information that can be used e.g. by the MD to determine the location of the MD .

At stage the process includes receiving at a location server from a location based services application server a first identification for a first mobile device associated with the location based services application server. For example the LS receives as provided by the LBS AS the IP address and the MAC address of the MD as discussed above with respect to with the MAC address being optional in and the IP address being optional in and the VID as discussed with respect to .

At stage the process includes receiving at the location server from an access location network a second identification provided by a second mobile device to the access location network. For example the LS receives from the ALN the IP address and the MAC address of the MD as discussed above with respect to and the VID as discussed with respect to .

At stage the process includes determining whether the first identification matches the second identification. For example the LS in particular the comparison module makes a comparison of the information received from the LBS AS and the ALN and possibly information resident at the LS e.g. a VID produced or selected by the venue identifier module . Based on this comparison the comparison module determines whether the first identification and the second identification e.g. the respective IP addresses MAC addresses and or VIDs match.

At stage the process includes determining whether the first mobile device and the second mobile device are the same mobile device based at least in part on whether the first identification matches the second identification. For example the LS in particular the determination module makes a determination as to whether the MD was the source of the information received from both the LBS AS and the ALN . This determination may include the determination that the first identification and the second identification match. This may constitute the entirety of the determination or the determination may be based on other information as well such as i when the first identification and the second identification were received and or ii authentication of MD by the ALN and or LBS AS with authentication results being conveyed to the LS .

At stage the process includes enabling location services for the first mobile device in response to determining that the first mobile device and the second mobile device are the same mobile device. For example the LS in particular the location service information module in response to the first and second mobile devices being one and the same may be enabled to send and may send a location of the MD to the LBS AS for provision to the MD or for use in determining and providing another location based service to the MD . Also or alternatively the LS may be enabled to and may provide or instruct the LBS AS to provide location assistance information that the MD can use to determine the location of the MD .

Referring to with further reference to a process of providing location based services includes the stages shown. The process is however an example only and not limiting. The process can be altered e.g. by having stages added removed rearranged combined performed concurrently and or having single stages split into multiple stages. For example stages are optional.

At stage the process includes sending a venue assigned identifier to a mobile device. For example the LBS AS i.e. the venue identifier module or the LS i.e. the venue identifier module may produce or select and send the VID to the MD . The VID may be a MAC address or a non MAC address identifier.

At stage the process includes receiving at a location server first and second information from a location based services application server and an access location network and third information from the mobile device. For example this stage is similar to stages discussed above except that optionally third information may be received by the location server from the mobile device. For example the MD may send an IMSI an IP address a MAC address or the VID preferably only if the VID is sent by the LBS AS to the MD or combinations of these pieces of information.

At stage the process includes making a comparison of the first information and the second information. This stage is similar to stage discussed above except that information from three sources external to the LS are compared.

At stage the process includes responding to the comparison indicating that the first second and third information all originated from the mobile device by sending location information regarding the mobile device to the location based services application server and or the mobile device. For example this stage is similar to stage discussed above with respect to the process except that the location information may be provided by the LS to the LBS AS and or the MD .

At stage the process includes determining whether to terminate the assigned VID. For example if the MD ceases communication with the ALN the LS or the LBS AS e.g. by being turned off leaving a range of the ALN the LS or the LBS AS or otherwise being disconnected from the ALN the LS or the LBS AS then the process terminates. Also or alternatively the assigned VID may have a temporal limit such that if a temporal threshold is exceeded e.g. a timer expires then the process terminates. If the process terminates then a VID will be assigned if the process begins again e.g. if the MD re enters the venue or re establishes communication with the ALN the LS or the LBS . If the assigned VID is not to be terminated then the process proceeds to stage .

At stage the process includes determining whether new first second or third information is received. If so then the process returns to stage and otherwise returns to stage .

Referring now to with further reference to the MD may include a first sending module means for sending a first identity a second sending module means for sending a second identity a third sending module means for sending a third identity a location service module means for obtaining a location service and a venue assigned identifier module means for receiving a venue assigned identifier . The modules are communicatively coupled to each other and may be functional modules implemented by the processor the software stored in the memory the modem the PE the App and or one or more of the transceivers as appropriate. Thus reference to any of the modules or performing or being configured to perform a function may be shorthand for the processor performing or being configured to perform the function in accordance with the software and or hardware of the processor the modem the PE the App and or one or more of the transceivers performing or being configured to perform the function. Similarly reference to the processor performing a receiving sending or obtaining function may be equivalent to the first sending module the second sending module the third sending module the location service module and or the venue assigned identifier module respectively performing the function.

The first second and third sending modules are configured to obtain possibly produce and send first second and third identities for the MD toward the LBS AS the ALN and the LS respectively. The first second and third identities may include a common identity for the mobile device . The common identity may be e.g. a MAC address an IP address and or a VID and may be obtained from the memory or from a device other than the MD e.g. from the LBS AS via the venue assigned identifier module . The venue assigned identifier module may be configured to receive a VID from the LS the ALN or the LBS AS and the first second and or third sending modules and or respectively may be configured to include the VID in the first second and or third identity respectively.

The location service module may be configured to obtain a location service from the ALN the LS and or the LBS AS . Obtaining the location service may be receiving location assistance data from the ALN the LS and or the LBS AS or receiving a location estimate for the MD from the ALN the LS and or the LBS AS .

Referring to with further reference to a process of obtaining location based services at a mobile device e.g. MD includes the stages shown. The process is however an example only and not limiting. The process can be altered e.g. by having stages added removed rearranged combined performed concurrently and or having single stages split into multiple stages.

At stage the process includes sending a first identity for the mobile device to a Location Based Services Application Server LBS AS . For example the first sending module of the MD sends an identity to the LBS AS . The first identity may be a MAC address an IP address a venue assigned identifier VID etc.

At stage the process includes sending a second identity for the mobile device to an Access location Network ALN wherein the first identity and the second identity comprise a common identity for the mobile device. For example the second sending module of the MD sends an identity to the ALN . The second identity may be a MAC address an IP address a venue assigned identifier VID etc. The first and second identities include a common preferably identical portion.

At stage the process includes obtaining a location service from at least one of the LBS AS or the ALN. For example the location service module receives location assistance data from the LBS AS and or the ALN and or the location service module receives a location estimate for the MD from the LBS AS and or the ALN .

The process may further include sending a third identity for the mobile device to a location server wherein the third identity includes the common identity for the mobile device. For example the third sending module can obtain and send the third identity to the LS . As with the first and second identities the third entity may be a MAC address an IP address a VID or other information used as an identity. The process may further include obtaining a location service from the location server such as the location service module receiving location assistance data and or a location estimate for the MD from the LS . The LS may be a SUPL SLP and receiving the location assistance data and or the location estimate for the MD from the LS may comprise using a SUPL session between the LS and the MD .

The first second and or third identity may be obtained from the memory obtained from an entity external to the MD produced by the MD etc. For example the process may further include receiving a VID from the LBS AS or from a location server wherein the VID is temporarily unique to the mobile device and wherein the first identity the second identity and or the third identity include the VID. For example the venue assigned identifier module may receive the VID from the LS . The VID may be e.g. a MAC address.

Referring again to and to the SSM includes a computer system including a processor memory including software and an I F transceiver . The processor is preferably an intelligent hardware device e.g. a central processing unit CPU such as those made by ARM Intel Corporation or AMD a microcontroller an application specific integrated circuit ASIC etc. The processor could comprise multiple separate physical entities that can be distributed in the SSM . The memory includes random access memory RAM and read only memory ROM . The memory is a non transitory processor readable storage medium that stores the software which is processor readable processor executable software code containing processor readable instructions that are configured to when executed cause the processor to perform various functions described herein although the description including the claims may refer only to the processor performing or being configured to perform one or more of the functions . Alternatively the software may not be directly executable by the processor but configured to cause the processor e.g. when compiled and executed to perform the functions. The SSM is configured to communicate bi directionally with the LS the LBS AS and or the ALN . The I F transceiver may be one or more physical entities e.g. one for each interface for communicating with the ALN the LS and the LBS AS a single transceiver or multiple transceivers with one or more shared components. The SSM could be a logical entity in one of the ALN the LS or the LBS AS . Alternatively the SSM could be distributed in more than one of the ALN the LS and the LBS AS . If the SSM is external to the ALN the LS and the LBS AS as shown three interfaces provide the communication between the SSM and the ALN the LS and the LBS AS .

The SSM has multiple potential roles. The SSM can be a focal point for authorizing location and connectivity service to an MD such as the MD from the ALN the LS and the LBS AS . Thus one or more requests for providing one or more corresponding location services may be sent to the SSM and the SSM may respond to each of the requests by authorizing or denying the requested location service e.g. by sending an authorization indication or a denial indication to the requesting entity . The SSM can enable a venue owner or service provider to support or make use of multiple ALNs LSs and or LBS ASs. The SSM can coordinate and share information across the multiple ALNs LSs and or LBS ASs. Multiple LBS ASs may be used for example when there are multiple application providers with different LBS ASs. For example each application provider may provide one or more Apps for an MD such as the MD and may also provide an LBS AS to support service requests from these Apps over I F . In that case each App e.g. the App may interact only with the LBS AS for the provider of the App and not with an LBS AS for some other App provider. Multiple LSs could be used for example when there are several location providers. Multiple ALNs could be used for example with multiple venues or when a single venue uses different types of APs e.g. WiFi APs and Bluetooth APs .

Communications in the system including the SSM may include various requests and responses. For example the ALN can send an access control request to the SSM e.g. requesting to provide communication services e.g. access to the Internet or access to other entities in the system to a mobile device e.g. the MD that has initiated communication with the ALN . The SSM can respond to the ALN with an access control response that either grants or denies permission for the ALN to provide communication services to that mobile device. The MD or an App on the MD such as the App may send information to the LBS AS enabling an authentication by the LBS AS of the user of the MD or an App e.g. the App on the MD and may include in this information the App ID or user ID to be authenticated. Similarly the LBS AS may send information to the MD or to an App such as the App on the MD enabling the MD or the App to authenticate the LBS AS . The authentication communications between the MD or the App and the LBS AS will either authenticate the MD and or the LBS AS or not with the latter case resulting in location services being denied by the LBS AS to the MD and or not requested from the LBS AS by the MD . The MD may also or alternatively send one or more MD IDs to the LBS AS e.g. a MAC address IP address and or VID. The LBS AS may send a service authorization request to the SSM to obtain authorization for providing location services for the MD and may include in the service authorization request one or more IDs for the MD such as a MAC address user ID or App ID. In response to the service authorization request the SSM may send a service authorization response to the LBS AS either granting or denying permission for the LBS AS to provide location services to the MD and possibly indicating which location services may be provided. The SSM can record e.g. in the memory which mobile devices and or applications are registered for service e.g. in each LBS AS and or in which venue. The MD may send MD authentication information and or one or more MD IDs e.g. an IMSI IP address MAC address VID to the LS to enable the LS to identify the MD e.g. determine whether the MD is being used on each of I Fs and as described earlier herein and or to enable the LS to authenticate the MD . The LS may similarly send LS authentication information to the MD to enable the MD to authenticate the LS . The LS may also send a location authorization request to the SSM to obtain authorization to provide location services for the MD e.g. directly to the MD or to the LBS AS . The LS may include in the location authorization request one or more IDs for the MD such as a MAC address IMSI or MSISDN. The SSM may respond to the location authorization request by sending a location authorization response to the LS either granting or denying permission for the LS to provide location services for the MD and possibly indicating which location services may be provided. The LS may send an MD search request to the ALN instructing or requesting the ALN to search for the particular the MD e.g. by detecting signals transmitted by the MD containing an ID for the MD such as a particular MAC address or IP address e.g. with the MD search request including a MAC address and or IP address of the MD . The ALN may respond to this request by searching for the MD and sending an MD detection response to the LS indicating whether the ALN has detected the MD e.g. has detected signals transmitted by the MD containing a MAC address or IP address provided in the request from the LS . The ALN and the MD may exchange one or more IDs e.g. MAC addresses as part of the ALN detecting the MD and or the MD obtaining communication services from the ALN . The LBS AS may send a location request to the LS over I F to obtain four or more locations for the MD and may include in the request one or more IDs for the MD e.g. an IP address MAC address and or VID . The LS may then verify that the same MD e.g. the MD is being used over I Fs and possibly as described previously herein and may then obtain one or more locations for the MD via interaction with the MD over I F e.g. using SUPL and or by requesting a location or location measurements for the MD from the ALN over I F . The LS may then return one or more locations for the MD to the LBS AS over I F .

The SSM may also support other functions associated with providing location services to or associated with the MD and or associated with providing location services in a secure manner from the LS and or the LBS AS . For example the SSM may support i security wherein an identity for the MD or the App is verified ii service authorization wherein communication services from the ALN and or location services from the LS and or the LBS AS are authorized by the SSM and or iii privacy wherein the location of the MD is not disclosed to unauthorized clients. The SSM may also associate and verify different MD identities used on different I Fs e.g. as described earlier in association with wherein the comparison of different MD IDs received over I Fs and possibly is verified by the SSM rather than by the LS . The SSM may authorize interconnect services to the MD from the ALN location services to the MD from the LS and location content services to the MD from the LBS AS . The SSM may maintain user e.g. subscription records and may maintain the services that are authorized to the MD or the App and the privacy requirements for the MD or the App . The SSM may further maintain service usage records for the MD or the App e.g. for billing of the user of the MD and or to collect statistics on certain or all users . The SSM may act as a gateway to some external clients e.g. may interface to Public Safety Answering Points PSAPs or to clients that perform lawful interception. The SSM may authorize different location services for an MD e.g. from the LS and or from the LBS AS including specific types of assistance data that can be sent to the MD from the LS and or specific types of location content e.g. building maps directions venue information that can be sent to the MD by the LBS AS .

While many of the previous examples are based on an ALN that comprises one or more WiFi APs the methods exemplified by these examples may be applicable to an ALN comprising other types of AP for example an ALN comprising one or more Bluetooth APs one or more femtocells one or more small cells and or a combination of one or more different types of AP. For the examples in which a WiFi MAC address is provided to the MD as a VID and or sent by the MD to the ALN the LS and or the LBS AS to identify the MD and wherein the ALN comprises APs different from WiFi APs the WiFi MAC address in these examples may be replaced by a different address or different identity for the MD . The different address or different identity may be associated with communication between the MD and those APs in the ALN that are not WiFi APs and or may be an address or identity used by a communication protocol on I F between the MD and one or more APs in the ALN that are not WiFi APs. The different address or different identity may be a TCP IP address a UDP IP address a Bluetooth address a provider address a device address e.g. an International Mobile Equipment Identity IMEI a public user address or some other address or identity.

As used herein including in the claims or as used in a list of items prefaced by at least one of indicates a disjunctive list such that for example a list of at least one of A B or C means A or B or C or AB or AC or BC or ABC i.e. A and B and C or combinations with more than one feature e.g. AA AAB ABBC etc. .

As used herein including in the claims unless otherwise stated a statement that a function or operation is based on an item or condition means that the function or operation is based on the stated item or condition and may be based on one or more items and or conditions in addition to the stated item or condition.

A wireless communication network does not have all communications transmitted wirelessly but is configured to have at least some communications transmitted wirelessly.

Other examples and implementations are within the scope and spirit of the disclosure and appended claims. For example due to the nature of software functions described above can be implemented using software executed by a processor hardware firmware hardwiring or combinations of any of these. Features implementing functions may also be physically located at various positions including being distributed such that portions of functions are implemented at different physical locations.

A wireless communication network does not have all communications transmitted wirelessly but is configured to have at least some communications transmitted wirelessly.

Substantial variations to described configurations may be made in accordance with specific requirements. For example customized hardware might also be used and or particular elements might be implemented in hardware software including portable software such as applets etc. or both. Further connection to other computing devices such as network input output devices may be employed.

Common forms of physical and or tangible computer readable media include for example a floppy disk a flexible disk hard disk magnetic tape or any other magnetic medium a CD ROM any other optical medium punch cards paper tape any other physical medium with patterns of holes a RAM a PROM EPROM a FLASH EPROM any other memory chip or cartridge a carrier wave as described hereinafter or any other medium from which a computer can read instructions and or code.

The methods systems and devices discussed above are examples. Various configurations may omit substitute or add various procedures or components as appropriate. For instance in alternative configurations the methods may be performed in an order different from that described and that various steps may be added omitted or combined. Also features described with respect to certain configurations may be combined in various other configurations. Different aspects and elements of the configurations may be combined in a similar manner. Also technology evolves and thus many of the elements are examples and do not limit the scope of the disclosure or claims.

Specific details are given in the description to provide a thorough understanding of example configurations including implementations . However configurations may be practiced without these specific details. For example well known circuits processes algorithms structures and techniques have been shown without unnecessary detail in order to avoid obscuring the configurations. This description provides example configurations only and does not limit the scope applicability or configurations of the claims. Rather the preceding description of the configurations provides a description for implementing described techniques. Various changes may be made in the function and arrangement of elements without departing from the spirit or scope of the disclosure.

Also configurations may be described as a process which is depicted as a flow diagram or block diagram. Although each may describe the operations as a sequential process many of the operations can be performed in parallel or concurrently. In addition the order of the operations may be rearranged. A process may have additional stages or functions not included in the figure. Furthermore examples of the methods may be implemented by hardware software firmware middleware microcode hardware description languages or any combination thereof. When implemented in software firmware middleware or microcode the program code or code segments to perform the tasks may be stored in a non transitory computer readable medium such as a storage medium. Processors may perform the described tasks.

Components functional or otherwise shown in the figures and or discussed herein as being connected or communicating with each other are communicatively coupled. That is they may be directly or indirectly connected to enable communication between them.

Having described several example configurations various modifications alternative constructions and equivalents may be used without departing from the spirit of the disclosure. For example the above elements may be components of a larger system wherein other rules may take precedence over or otherwise modify the application of the invention. Also a number of operations may be undertaken before during or after the above elements are considered. Accordingly the above description does not bound the scope of the claims.

A statement that a value exceeds or is more than a first threshold value is equivalent to a statement that the value meets or exceeds a second threshold value that is slightly greater than the first threshold value e.g. the second threshold value being one value higher than the first threshold value in the resolution of a computing system. A statement that a value is less than or is within a first threshold value is equivalent to a statement that the value is less than or equal to a second threshold value that is slightly lower than the first threshold value e.g. the second threshold value being one value lower than the first threshold value in the resolution of a computing system.

The following are examples of methods and processor readable storage media in accordance with respective portions of the description above.

receiving at a location server from a location based services application server a first identification for a first mobile device associated with the location based services application server 

receiving at the location server from an access location network a second identification for a second mobile device associated with the access location network 

determining whether the first mobile device and the second mobile device are the same mobile device based at least in part on whether the first identification matches the second identification and

enabling location services for the first mobile device in response to determining that the first mobile device and the second mobile device are the same mobile device.

2. The method of example 1 wherein the enabling location services comprises at least one of providing location assistance data to the first mobile device providing a location estimate to the first mobile device or providing a location estimate for the first mobile device to the location based services application server.

3. The method of example 2 wherein the location estimate for the first mobile device is obtained using at least one of measurements for the first mobile device provided by the access location network a location estimate for the first mobile device provided by the first mobile device or location measurements provided by the first mobile device.

4. The method of example 3 wherein the location server is a Secure User Plane Location SUPL Location Platform SLP and the location estimate for the first mobile device provided by the first mobile device or the location measurements provided by the first mobile device are obtained using a SUPL session between the location server and the first mobile device.

5. The method of example 1 wherein the first identification includes a first internet protocol address and the second identification includes a second internet protocol address or the first identification includes a first Media Access Control MAC address and the second identification includes a second MAC address.

6. The method of example 1 further comprising sending a first venue assigned identifier VID to the first mobile device from the location based services application server wherein the first VID is temporarily unique to the first mobile device and wherein the first identification includes the first VID and the second identification includes a second VID.

7. The method of example 6 wherein the first VID comprises a first Media Access Control MAC address and the second VID comprises a second MAC address.

receiving at the location server from a third mobile device a third identification for the third mobile device 

determining whether the third identification matches the first identification and the second identification and

determining whether the first mobile device the second mobile device and the third mobile device are the same mobile device based at least in part on determining whether the third identification matches the first identification and the second identification 

wherein the enabling location services for the first mobile device is in response to determining that the first mobile device the second mobile device and the third mobile device are the same mobile device.

9. The method of example 8 wherein the first identification includes a first internet protocol address the second identification includes a second internet protocol address and the third identification includes a third internet protocol address.

10. The method of example 8 wherein the first identification includes a first Media Access Control MAC address the second identification includes a second MAC address and the third identification includes a third MAC address.

11. The method of example 8 further comprising sending a venue assigned identifier VID to either the first mobile device from the location based services application server or to the third mobile device from the location server wherein the VID is temporarily unique to the mobile device to which it is sent.

12. The method of example 11 wherein determining whether the third identification matches the first identification and the second identification comprises determining that the first identification the second identification and the third identification each comprise the VID.

14. The method of example 1 wherein the access location network comprises at least one of an IEEE 802.11 WiFi access point AP a Bluetooth AP or a Femtocell.

15. The method of example 1 wherein enabling location services for the first mobile device comprises enabling location services for the first mobile device from the location based services application server.

16. The method of example 1 further comprising withholding location services for the first mobile device from the location server in response to failing to determine that the first mobile device and the second mobile device are same mobile device.

17. A processor readable storage medium comprising processor readable instructions configured to cause a processor to 

receive from a location based services application server a first identification for a first mobile device associated with the location based services application server 

receive from an access location network a second identification for a second mobile device associated with the access location network 

determine whether the first mobile device and the second mobile device are the same mobile device based at least in part on whether the first identification matches the second identification and

enable location services for the first mobile device in response to determining that the first mobile device and the second mobile device are the same mobile device.

18. The processor readable storage medium of example 17 wherein the instructions configured to cause the processor to enable location services comprise instructions configured to cause the processor to at least one of provide location assistance data to the first mobile device provide a location estimate to the first mobile device or provide a location estimate for the first mobile device to the location based services application server.

19. The processor readable storage medium of example 18 further comprising instructions configured to cause the processor to obtain the location estimate for the first mobile device using at least one of measurements for the first mobile device provided by the access location network a location estimate for the first mobile device provided by the first mobile device or location measurements provided by the first mobile device.

20. The processor readable storage medium of example 19 wherein the instructions include instructions configured to cause the processor to obtain the location estimate for the first mobile device provided by the first mobile device or the location measurements provided by the first mobile device are obtained using a Secure User Plane Location session with the first mobile device.

21. The processor readable storage medium of example 17 wherein the first identification includes a first internet protocol address and the second identification includes a second internet protocol address or the first identification includes a first Media Access Control MAC address and the second identification includes a second MAC address.

22. The processor readable storage medium of example 17 further comprising instructions configured to cause the processor to 

determine whether the third identification matches the first identification and the second identification and

determine whether the first mobile device the second mobile device and the third mobile device are the same mobile device based at least in part on determining whether the third identification matches the first identification and the second identification 

wherein the instructions configured to cause the processor to enable location services for the first mobile device are configured to cause the processor to do so in response to determining that the first mobile device the second mobile device and the third mobile device are the same mobile device.

23. The processor readable storage medium of example 22 wherein the first identification includes a first internet protocol address the second identification includes a second internet protocol address and the third identification includes a third internet protocol address.

24. The processor readable storage medium of example 22 wherein the first identification includes a first Media Access Control MAC address the second identification includes a second MAC address and the third identification includes a third MAC address.

25. The processor readable storage medium of example 22 further comprising instructions configured to cause the processor to send a venue assigned identifier VID to the third mobile device wherein the VID is temporarily unique to the mobile device to which it is sent.

26. The processor readable storage medium of example 25 wherein the instructions configured to cause the processor to determine whether the third identification matches the first identification and the second identification comprise instructions configured to cause the processor to determine that the first identification the second identification and the third identification each comprise the VID.

27. The processor readable storage medium of example 25 wherein the VID comprises a Media Access Control MAC address.

28. The processor readable storage medium of example 17 wherein the access location network comprises at least one of an IEEE 802.11 WiFi access point AP a Bluetooth AP or a Femtocell.

29. The processor readable storage medium of example 17 further comprising instructions configured to cause the processor to withhold location services for the first mobile device from the location server in response to failing to determine that the first mobile device and the second mobile device are same mobile device.

sending a first identity for the mobile device to a Location Based Services Application Server LBS AS 

sending a second identity for the mobile device to an Access location Network ALN wherein the first identity and the second identity comprise a common identity for the mobile device and

31. The method of example 30 wherein the common identity for the mobile device comprises an Internet Protocol IP address or a Media Access Control MAC address.

32. The method of example 30 wherein the obtaining location services from the LBS AS or the ALN comprises at least one of receiving location assistance data from the LBS AS or the ALN or receiving a location estimate for the mobile device from the LBS AS or the ALN.

33. The method of example 30 further comprising receiving a venue assigned identifier VID from the LBS AS wherein the VID is temporarily unique to the mobile device and wherein the second identity includes the VID.

sending a third identity for the mobile device to a location server wherein the third identity comprises the common identity for the mobile device.

37. The method of example 36 wherein the obtaining location services from the location server comprises at least one of receiving location assistance data from the location server or receiving a location estimate for the mobile device from the location server.

38. The method of example 37 wherein the location server is a Secure User Plane Location SUPL Location Platform SLP and wherein receiving location assistance data from the location server or receiving a location estimate for the mobile device from the location server comprises using a SUPL session between the location server and the mobile device.

39. The method of example 35 further comprising receiving a venue assigned identifier VID from the location server wherein the VID is temporarily unique to the mobile device and wherein the first identity and the second identity includes the VID.

41. The method of example 30 wherein the ALN comprises at least one of an IEEE 802.11 WiFi access point AP a Bluetooth AP or a Femtocell.

42. A processor readable storage medium comprising processor readable instructions configured to cause a processor to 

send a second identity for the mobile device to an Access location Network ALN wherein the first identity and the second identity comprise a common identity for the mobile device and

43. The processor readable storage medium of example 42 wherein the common identity for the mobile device comprises an Internet Protocol IP address or a Media Access Control MAC address.

44. The processor readable storage medium of example 42 wherein the instructions configured to cause the processor to obtain location services from the LBS AS or the ALN comprise instructions configured to cause the processor to at least one of receive location assistance data from the LBS AS or the ALN or receive a location estimate for the mobile device from the LBS AS or the ALN.

45. The processor readable storage medium of example 42 further comprising instructions configured to cause the processor to receive a venue assigned identifier VID from the LBS AS wherein the VID is temporarily unique to the mobile device and wherein the second identity includes the VID.

46. The processor readable storage medium of example 45 wherein the VID comprises a Media Access Control MAC address.

47. The processor readable storage medium of example 42 further comprising instructions configured to cause the processor to send a third identity for the mobile device to a location server wherein the third identity comprises the common identity for the mobile device.

48. The processor readable storage medium of example 47 further comprising instructions configured to cause the processor to obtain location services from the location server.

49. The processor readable storage medium of example 48 wherein the instructions configured to cause the processor to obtain location services from the location server comprise instructions configured to cause the processor to at least one of receive location assistance data from the location server or receive a location estimate for the mobile device from the location server.

50. The processor readable storage medium of example 49 wherein the location server is a Secure User Plane Location SUPL Location Platform SLP and wherein the instructions configured to cause the processor to receive location assistance data from the location server or receive a location estimate for the mobile device from the location server comprise instructions configured to cause the processor to use a SUPL session with the location server to receive the location assistance data or the location estimate.

51. The processor readable storage medium of example 47 further comprising instructions configured to cause the processor to receive a venue assigned identifier VID from the location server wherein the VID is temporarily unique to the mobile device and wherein the first identity and the second identity includes the VID.

52. The processor readable storage medium of example 51 wherein the VID comprises a Media Access Control MAC address.

53. The processor readable storage medium of example 42 wherein the ALN comprises at least one of an IEEE 802.11 WiFi access point AP a Bluetooth AP or a Femtocell.

