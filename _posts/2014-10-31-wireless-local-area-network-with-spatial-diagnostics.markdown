---

title: Wireless local area network with spatial diagnostics
abstract: A diagnostic system for spatial diagnosis of the WLAN includes: a sounding aggregator and a spatial correlator. The sounding aggregator is configured to aggregate multiple-input multiple-output (MIMO) channel state information (CSI) from channel soundings of the WLAN, including channel soundings between a wireless access point (WAP) node and associated station nodes on a selected one of a plurality of communication channels of the WLAN. The spatial correlator is coupled to the sounding aggregator and configured to correlate CSI from the channel soundings with spatial characteristics of the WLAN including at least one of: a change in location of a WLAN node, human activity among the WLAN nodes, and structural impediments among WLAN nodes.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09078153&OS=09078153&RS=09078153
owner: Quantenna Communications, Inc.
number: 09078153
owner_city: Fremont
owner_country: US
publication_date: 20141031
---
The field of the present invention relates in general to wireless local area networks WLAN including wireless access points WAP and wireless stations and methods for spatial diagnosis of same.

Home and office networks a.k.a. wireless local area networks WLAN are established and serviced using a device called a Wireless Access Point WAP . The WAP may include a router. The WAP wirelessly couples all the devices of the home network e.g. wireless stations such as computers printers televisions digital video DVD players security cameras and smoke detectors to one another and to the Cable or Subscriber Line through which Internet video and television is delivered to the home. Most WAPs implement the IEEE 802.11 standard which is a contention based standard for handling communications among multiple competing devices for a shared wireless communication medium on a selected one of a plurality of communication channels. The frequency range of each communication channel is specified in the corresponding one of the IEEE 802.11 protocols being implemented e.g. a b g n ac ad ax . Communications follow a hub and spoke model with a WAP at the hub and the spokes corresponding to the wireless links to each client device.

After selection of a single communication channel for the associated home network access to the shared communication channel relies on a multiple access methodology identified as Collision Sense Multiple Access CSMA . CSMA is a distributed random access methodology first introduced for home wired networks such as Ethernet for sharing a single communication medium by having a contending communication link back off and retry access to the line if a collision is detected i.e. if the wireless medium is in use.

Communications on the single communication medium are identified as simplex meaning one communication stream from a single source node to one or more target nodes at one time with all remaining nodes capable of listening to the subject transmission. To confirm arrival of each communication packet the target node is required to send back an acknowledgment a.k.a. ACK packet to the source. Absent the receipt of the ACK packet the source will retransmit the unacknowledged data until an acknowledgement is received or a time out is reached.

Initially wireless home networks handled Internet communications for a limited number of devices e.g. 1 3 over an indoor range and throughput of 20 feet and 1 Mbps respectively. As such they were limited to delivery of data where inconsistencies in delivery e.g. temporary outages or throughput shortfalls are not noticeable e.g. files and web pages. With improvements in range and throughput of 250 feet and 600 Mbps came the possibility of wireless delivery to low latency audio video streams for consumer devices such as TVs. Each TV requires 5 30 Mbps in uninterrupted throughput for acceptable picture quality. Picture quality is extremely sensitive to placement of the wireless components i.e. WAP set top box and or TV. In addition to higher throughput devices the next generation WLAN is also expected to handle what is identified as the Internet of Things IoT e.g. literally hundreds of wireless embedded devices within a home serviced by a single WAP as a communication bridge for coupling the devices associated with the modern home e.g. computers TVs appliances sensors to the Internet.

The present invention provides a method and apparatus for spatial diagnostics for a wireless local area network WLAN . In an embodiment of the invention a diagnostic system for spatial diagnosis of the WLAN includes a sounding aggregator and a spatial correlator. The sounding aggregator is configured to aggregate multiple input multiple output MIMO channel state information CSI from channel soundings of the WLAN including channel soundings between a wireless access point WAP node and associated station nodes on a selected one of a plurality of communication channels of the WLAN. The spatial correlator is coupled to the sounding aggregator and configured to correlate channel state information CSI from the channel soundings with spatial characteristics of the WLAN including at least one of a change in location of a WLAN node human activity among the WLAN nodes and structural impediments among WLAN nodes.

The present invention provides a method and apparatus for spatial diagnosis of a wireless home network for services ranging from WLAN diagnosis home security health care monitoring smart home utility control elder care etc. Instead of the WAP merely serving as a bridge for coupling the stations to the Internet the WAP and associated stations forming the WLAN take on an additional role as an independent source of content i.e. spatial data. Examples of this spatial data include a Changes in the location of one or more of the WLAN nodes including the identification of the node subject to such displacement and the time of displacement. b Human activity within the WLAN including the time location and path of the movement where the location and path are identified at least relative to the associated WLAN link or link vector. c Structural impediments occupying the space in and around the WLAN. The provision of this spatial data by the existing WLAN avoids the redundancy and obviates the need for many of the additional wireless devices currently vying for inclusion in the residential and commercial WLAN. In many cases the sensing and monitoring capabilities which these devices proffer can instead be harvested directly from the existing WLAN nodes during the course of their normal operation. This spatial data obviates the need for dedicated sensors and devices within the home and allows application developers to provide applications servicing the following market segments WLAN diagnosis home security health care monitoring smart home utility control elder care etc. without the need for additional devices or dedicated hardware.

In the WAP is shown setting up communication links and with wireless station nodes and respectively within residence . Each link pair exchanges capabilities e.g. A B on link and capabilities exchange A B on link . During this exchange the number of antenna the number of streams the coding and beamforming support capabilities of each device are exchanged. Next an initial explicit sounding request and response takes place C D on link and C D on link . The sounding is sent using an isotropic radio frequency Rf signal strength . The sounding itself identifies the target station s from which a response is requested and includes a preamble field which is modulated at the maximum number of streams supported by the link partners using a bit sequence and modulation and coding scheme MCS known to all recipients. Upon receipt the recipient station s determine changes in amplitude and phase to the sounding transmission brought about the link channel e.g. fading attenuation and phase shift and passes indicia of these channel characteristics as sounding feedback response packet s D D back to the WAP where they are immediately used to set up beamforming of subsequent data communications as shown in .

The IEEE 802.11n and 802.11ac standards support increasing degrees of complexity in the signal processing required of fully compliant WLAN nodes including beamforming capability for focused communication of user data. One of the many capabilities of a fully compliant WLAN node under either of these standards is the ability to focus the signal strength of a transmitted communication toward a receiving device. Doing so requires multiple antenna and means for independently controlling the phase and amplitudes of the communication signals transmitted thereon. A baseband component of the WAP or station called a spatial mapper takes as input the independent communication streams for each antenna together with a steering matrix a.k.a. beamforming matrix determined during a prior isotropic sounding of the channel as shown in . The steering matrix contains complex coefficients corresponding to the discrete phase and amplitude adjustments to each antenna s communication streams which provide the required focused signal strength to the composite of the signals transmitted from all antennas. Ideally the superposition of the beamforming matrix coefficients on the corresponding transmitted communication signals from each antenna will result in constructive interference of the communication signals with one another along the path to the target and destructive interference elsewhere. The greater the number of antenna in the phased array the more focused the resultant signal strength.

Now the steering matrix as stated is derived from the prior sounding and the sounding itself is made using an isotropic radiation profile as shown in . This isotropic radiation profile can be achieved either by relying on the inherent isotropy of the antennas in a MIMO array and without any steering matrix or by using a steering matrix designed to produce isotropic signal strength in the sounding.

In the WAP is shown using the sounding feedback to set up subsequent data communications with its link partners e.g. stations . Where the capabilities of the link partners capabilities permit the sounding feedback is used to establish subsequent beamformed data communications. Beamforming increases the received signal strength and is achieved by independent changes in phase and or amplitude of the signal transmitted from each of the transmit antennas which collectively steer the transmit power footprint toward the intended recipient station s using the channel state information CSI obtained in the sounding response packets D D See . Once each links beamsteering matrix is determined the sounding feedback is discarded. WAP is shown at time tusing its multiple antenna to beamform A downlink data communication packets E on link to station . Subsequently at time tWAP is shown beamforming B downlink data communication packets E on link to station . As data communications degrade either or both link partners re sound the link to update the link CSI and the prior beamsteering information is discarded.

The explicit sounding provided for in the IEEE 802.11ac standard allows the receiver to assist the transmitter to steer subsequent user data communications toward the receiver using the beamforming matrix provided by the receiver in response to the explicit link channel sounding initiated by the transmitter. An explicit sounding may be initiated by a WAP or a station. In the example shown the WAP initiates the sounding by sending at time tsends a null data packet announcement NDPA frame . The NDPA identifies the WAP and the target recipient station s for the sounding. Where more than one station is a target recipient the order in which the recipient stations are listed controls the order of their response. Next at time ta null data packet NDP is sent by the WAP. This packet like all the other packets associated with the sounding contains no user data rather the header of the packet A contains a ubiquitous preamble field which in the case of the IEEE 802.11ac standard is identified as the VHT LTF field shown in . The VHT LTF field a.k.a. channel estimation or sounding field contains a long training sequence used for MIMO channel estimation by the receiver. Each recipient device then determines the corresponding beamsteering matrix required to adjust the phase and amplitude of subsequent MIMO transmissions by the WAP so as to maximize the received signal strength at the receiving station. The first intended target e.g. station then responds at time twith the beamforming feedback packet containing CSI. If the receiving station is IEEE 802.11n compliant the feedback is in the form of the link channel matrix H. If the receiving station is IEEE 802.11ac compliant the feedback is in the form of the actual unitary beamsteering matrix V and the per tone diagonal matrix SNR. Any remaining stations targeted by the initial sounding respond with the beamsteering matrix for their own link when asked to do so by the WAP. The WAP sends a report poll packet at time tidentifying the next station from which sounding feedback is requested. That station e.g. station then responds at time twith beamforming feedback packet . Next at time tthe communication of user data packets resumes and user data e.g. packet is sent on the link s that have been sounded using the associated beamforming matrix determined during the preceding sounding.

All WLAN packets whether associated with communicating a sounding or the communication of user data include a similar header portion with the same training and signal preamble fields with known sequences which allow the receiving station to synchronize reception with packet boundaries and to determine the received channel.

Once you are storing CSI rather than discarding it what can you do with it One answer surprisingly enough is that you can determine when performance changed in the WLAN or on a specific link thereof and offer a possible explanation for same. For example if the WLAN performed properly at one point in time and then after movement of a WAP or station node ceased to perform properly then knowledge of which node rotated or was moved coupled perhaps with WLAN performance metrics before and after the move s can be used to isolate a potential source of the WLAN s problems and allow the technician or homeowner to focus on a targeted solution to the problem. Thus spatial data can be exploited by Telco or ISP call centers or technical support or onsite service technicians to improve diagnosis of WLAN problems.

In the example shown the spatial diagnostics proceed as follows. Over the time interval of the sounding samples shown i.e. t tthe CSI for link is stable with substantially similar matrix coefficients cat 50 dB cat 55 dB cat 57 dB cat 52 dB. This suggests spatial stability of both the WAP and its link partner station node over the interval covered by the aggregated soundings. Spatial stability in this embodiment of the invention means neither movement of either link partner node from one location to another nor in place rotation of the device and its associated antenna either or both of which would result in a permanent perturbation of the matrix coefficient values. Over the same time interval however the CSI for link is not stable. The matrix coefficients at tand tare permanently perturbed in subsequent interval tand t. This suggests movement or rotation on the part of either link partner i.e. WAP or station node . However since the other link in which WAP is a partner experienced no perturbation in the same interval it is reasonable to conclude that the node movement C in the interval between sounding feedback tand ttook place on the part of station node . One such example of movement is positional movement C of station from position A to B as shown in . These correlations of CSI over time with device positioning can be stored as spatial data B and used for services including customer call center or service technician diagnosis of changes in network performance or similar such troubleshooting.

Once you are storing CSI over time you can also determine which links or set of links were disrupted due to human activity. For example suppose the soundings of a WLAN link are conducted at 100 ms intervals. If those soundings are temporarily disrupted over a timescale which correlates with human activity e.g. a human walking at a pace of 4 5 feet per second within a home on a path which intercepted a WLAN link might be expected to disrupt 8 12 successive soundings of the link. Furthermore if other links are sequentially disrupted then knowledge of which links were disrupted by human activity and when may be used to estimate a path of human activity within the home relative to the links. This spatial data as to human activity can be exploited by the Telco or Wireless Service Provider to provide a range of services to the home including turning appliances or lights on and off as a person enters and exits a room determining for home security purposes whether anyone is in the home and if they are then sounding an alarm or notifying the police and determining for elder care monitoring what the activity pattern and times thereof are for an elderly individual.

In the example shown the spatial diagnostics proceed as follows. Over the time interval of the sounding samples shown i.e. t tthe CSI for link is stable with substantially similar matrix coefficients cat 40 dB cat 45 dB cat 35 dB cat 40 dB. This suggests no human activity between WAP and its link partner station node over the interval covered by the aggregated soundings. Over the same time interval however the CSI for link is not stable. The matrix coefficients are temporarily perturbed at time t. Perturbation between matrices in a sequence can in an embodiment of the invention be determined from the sum of the squares of the differences in the coefficients of the two matrices as follows 

Link Channel Perturbation Equation 1 where B and C are the channel matrices being compared e.g. matrices B C. If the sum BC exceeds a threshold amount associated with normal variations in a channel then a perturbation is deemed to have taken place. The perturbation in this example is temporary since the link perturbation AD e.g. a comparison of matrices A D in a surrounding interval is zero indicating that no permanent perturbation has taken place over the interval t t only the temporary perturbation at time tas evidenced in the link perturbation magnitude BC. These correlations of CSI over time with human activity between links can be stored as spatial data B and used for services including smart home home security and home health care for example.

The IEEE 802.11 standards specify wireless local area networks. The more recent versions of this standard describe a function identified as channel sounding in which the receiving member of a link pair passes channel information to the transmitting one of the pair to improve subsequent transmissions. Sounding feedback resulting from channel soundings contains CSI as specified by the corresponding wireless standard. Traditionally the CSI is used to derive a beamsteering matrix which in turn is used to control subsequent beamformed communications from one of the link partners e.g. the WAP to the other link partner e.g. station s . The advantage of a beamsteering matrix results from the fact that both transmitting and receiving link partners have more than one antenna which are used to engage in multiple input multiple output MIMO communications. By controlling the phase and amplitude of transmissions on each antenna the overall radiative profile of the transmissions takes on increased strength along the link path and is reduced elsewhere. This improves communications to the receiver without an increase in overall power required on the transmitter. The receiver uses its intimate knowledge of the received characteristics of the sounding transmission from the transmitter to determine a beamsteering matrix which the transmitter can use to improve subsequent MIMO transmissions to the receiver.

The IEEE 802.11n standard specifies sounding feedback in the form of the channel matrix H with row and column dimensions corresponding to the number of transmit and receive antenna respectively. There is one H matrix for each of the OFDM sub channels or tones within the selected channel. Traditionally the sounding feedback was only used for immediate calculation of a beamsteering matrix V after which it was discarded and replaced with the beamsteering matrix determined from the next sounding.

In accordance with this invention however the IEEE 802.11n sounding feedback i.e. channel matrices H are also aggregated and subject to additional analysis to determine channel perturbation channel attenuation magnitude channel scattering correlation and time of flight as will be discussed below. One or more of these parameters can in turn be correlated with one another to produce spatial data including Structural Spatial Data Human Activity within the WLAN or changes in the location of a WLAN Device.

The IEEE 802.11ac standard specifies sounding feedback in the form of both a beamsteering matrix V and a signal to noise ratio SNR matrix. In other words in this standard the receiver calculates the beamsteering matrix itself and then sends it back to its link partner for controlling subsequent MIMO transmissions thereof. The H matrix itself is not part of the feedback. Each V and SNR matrix has row and column dimensions corresponding to the number of transmit and receive antenna respectively. There is a V and an SNR matrix for each of the OFDM sub channels or tones within the selected channel.

The V and SNR matrices are determined by the receiver from a singular value decomposition SVD of the channel matrix H as follows 

Singular Value Decomposition of Link Channel Equation A where U and V are unitary matrices and is a diagonal real valued matrix. By their very definition these per tone SNR values are simply scaled versions of the diagonal elements of . Therefore sounding feedback comprises two of the three matrices resulting from the SVD of the receive channel matrix.

Traditionally the sounding feedback was only used for driving subsequent MIMO communications over the multiple antennas of the transmitting one of the link partners using the beamsteering matrix V delivered as part of the sounding feedback. Further after each sounding the beamsteering matrix was discarded in a typical prior art WLAN.

In accordance with this invention however the IEEE 802.11ac sounding feedback V and SNR matrices are also aggregated and subject to additional analysis to determine channel perturbation channel attenuation power loss channel scattering and time of flight as will be discussed below. One or more of these parameters can in turn be correlated with spatial data including Structural Spatial Data Human Activity or Device Location changes.

Transpose of Link Channel Matrix Equation A where V is the unitary matrix provided in the sounding feedback and is the scaled version of the per tone SNR matrix also provided with the sounding feedback.

The HH matrix can be used to determine channel perturbation channel attenuation power loss and channel scattering correlation. One or more of these parameters can in turn be correlated with one another to produce spatial data including Structural Spatial Data Human Activity within the WLAN or changes in the location of a WLAN Device.

Given a link channel matrix H that represents the MIMO link channel between two link partners the total loss in power between the signal transmitted from one of the link partners and received by the other link partner expressed in terms of the received channel matrix H is given by 

In free space such as a line of site link between a WAP and a station in the same room link power attenuates as a function of distance roughly as follows 

Freespace Power Attenuation Power Loss 50 20 Log Equation 3 where D is the separation in meters of the WLAN nodes e.g. WAP and station which form a link. Thus a 10 dB attenuation corresponds to an uncertainty in link separation distance of 7 10 meters for relevant residential structures depending on whether there is or is not an intervening wall. One way of resolving that uncertainty as to whether the power loss is due to a wall or other structural impediment or due simply to the distance separating the link partners is to determine how much scattering and reflection is exhibited by the link channel.

The link channel matrix H contains all sorts of information as to the differences between the MIMO paths between the multiple antennas of the transmitter to the multiple antennas of the receiver. Geometrically for a transmitter with two antennas and a receiver with two antennas there are 4 discrete paths between the transmitter and receiver. The link channel matrix characterizes all of these. The scattering of the channel e.g. whether it is predominantly line of site LOS without structural impediments or multi path MP with many structural impediments is expressed in terms of the correlation of the channel. This in turn is given by the standard deviation sigma of the diagonal elements of the link channel as follows 

The normalized standard deviation can be used to distinguish between channel power loss due to a structural impediment with ensuing scattering and reflection versus channel loss due to signal attenuation due exclusively to the distance separating link partners without intervening structural impediments. Higher standard deviations are associated with link channels which are low in scattering i.e. are primarily line of site and without intervening structural impediments. Lower standard deviations are associated with link channels with significant scattering and which therefore may include one or more intervening structural impediments. Another way of resolving uncertainty as to whether the power loss is due to a wall or other structural impediment or due simply to the distance separating the link partners is to determine time of flight for a link which directly correlates with the distance separating the link nodes and is largely independent of the degree of scattering.

Where the sounding feedback includes the link channel matrix H the time of flight of the link channel can be determined by comparing the phase rotation between neighboring sub channels or tones. Phase rotation over time of flight is frequency dependent. Therefore a sounding on two neighboring tones or sub channels initially transmitted with no phase shift there between will upon receipt exhibit a relative phase shift between the two tones that increases with the time of flight of the link. Since each sub channel has a well defined center frequency and where sounding feedback i.e. an H matrix is provided for each tone it is possible to determine the time of flight of the link from the relative phase shift in the sounding of the two neighboring tones. Such sounding feedback is currently available with IEEE 802.11n compliant devices. The first step in determining time of flight for a link is to express the complex coefficients of each of the neighboring tone s associated H matrix as a product of a real valued matrix and a complex scalar as follows 

Signal on Neighboring Sub Channels Equation 5b where Ais the message and f is the center frequency and 2 ft is the period of oscillation of the signal. A channel may have as many as 512 tones but we need only look at the neighboring pair or pairs that we are using for the phase delay calculation. The neighboring tones used for the comparison may be adjacent to one another or removed from one another.

Arriving Signal on Neighboring Sub Channels Equation 5c where the phase phi on each of the pair of selected tones are 2 f T and 2 f T.

Once the time of flight along the link is determined the separation of the nodes that form the link can also be determined.

Link Node Separation Equation 5e where D is the separation in meters of the WLAN nodes e.g. WAP and station which form a link and c is the speed of an electromagnetic signal in air or approximately c 3 10m s. We know that signal speed is independent of its frequency. So every nanosecond of flight time T corresponds to roughly 1 foot or approximately 0.3048 meters of distance between the WLAN nodes which form the link.

In a WLAN all links follow a rimless hub and spoke paradigm with the WAP at the hub and with communications limited to the link with each station forming a spoke. In the prior art there are no user data communications nor soundings on crosslinks between stations. In this embodiment of the invention even though there are no user data communications on the crosslinks between stations soundings of those crosslinks are still aggregated in order to improve the quality of the spatial information which can be derived during normal WLAN operations.

The 1and 2soundings from WAP and station respectively are sent using an isotropic radio frequency Rf signal strength and respectively. Unlike prior art sounding feedback which is discarded after beamsteering matrices for subsequent data communications are determined the sounding feedback a.k.a. CSI is stored in memory element as link channel state information A from which the spatial data B will be calculated. These spatial data calculations whether performed on the WAP or in the cloud take place in parallel with and therefore without disrupting normal WLAN communications.

Once you are storing CSI over time you can also determine the probable structure within which the WLAN operates. For example suppose two nodes e.g. a WAP node and a station node of the WLAN are in the same room of the residence. The sounding feedback is more likely to indicate a higher received power and less scattering and reflection of the link signal than would be the case if the nodes were in different rooms of the residence. Furthermore if other WAP links exhibit relatively lower received power and more scattering and reflection of the link signal the associated stations are more likely to be in a different room of the residence than the WAP. The aggregate of these spatial parameters may be used to estimate the structural relationship between the WLAN nodes and the rooms of the surrounding structure. This spatial data as to the WLAN and the residence of which it is a part can be exploited by the Telco or Wireless Service Provider to provide either directly or through application developers a range of services to the home including turning appliances or lights on and off as a person enters and exits a room turning a WLAN node on and off as a person enters and exits a room determining for home security purposes whether anyone is in the home and if they are then sounding an alarm or notifying the police of the intrusion and the room in which the intrusion is taking place and determining for elder care monitoring what the activity pattern and times thereof are for an elderly individual on a room by room basis.

On the basis of the 1set of soundings spatial parameters the WLAN nodes associated with link a c i.e. WAP and station are tentatively identified as residing in a single room A of the structure . The link between these WLAN nodes exhibits the least power loss i.e. the highest signal strength and the least scattering i.e. the highest standard deviation of all the links. By contrast the relatively larger power loss and higher degree of scattering associated with the remaining links suggests that the associated link targets nodes a.k.a. b and a.k.a. d are not in the same room with the WAP or the station . Thus at the end of the 1set of soundings stations and are identified as residing in room B separate from the WAP and station which are in the other room A. After the 1set of isotopic soundings considerable ambiguity or uncertainty exists as to the surrounding structures of each WLAN node. We do not know for example whether station nodes a.k.a. b and a.k.a. d are in the same room with each other. This ambiguity at least is resolved after the second set of soundings taken by station .

On the basis of the 2set of sounding s spatial parameters the WLAN nodes associated with link d b i.e. station and station are identified as residing in separate rooms C and E of the structure . The link between these WLAN nodes exhibits the greatest power loss i.e. the least signal strength 89 dB and among the highest levels of scattering i.e. the lowest standard deviation . of all the links. Furthermore neither of these stations resides in the same room D as either station or WAP as determined after the 1soundings. Additionally the relatively lower power loss over link d a 73 dB as opposed to link d c 75 dB indicates that WAP is on the side of room D closer to station while station is likely on the other more distant side of the room. Thus after the 1and 2sets of isotopic soundings spatial impediments and surroundings of the WLAN nodes have largely been resolved. The remaining spatial ambiguities if any may concern the layout of the devices in each room in two or three dimensional space. The embodiment of the invention shown in the following allows for these ambiguities to be resolved without interrupting normal WLAN communications or protocols.

The soundings up to this point have referred to as isotropic in that ideally the sounding signal strength from each WLAN node i.e. station or WAP including those equipped with more than one antenna and including those that support multiple input multiple output MIMO is uniform in all directions. That sounding characterization includes each sub channel or tone which makes up the communication channel on which the sounding is taking place. Thus the soundings that have been discussed to this point can also be further characterized as homogenous in that the channel sounding signal strength is isotropic as is the signal strength of each individual sub channel or tone thereof.

The distinct signal strength directionality that is imparted by the MIMO antenna array to each of the tones selected for anisotropic sounding is determined using standardized calculations of weights and phase for phased array of antenna on the subject WLAN node e.g. WAP or station as follows.

The sounding sent on each antenna will include antenna specific adjustments e.g. a complex weighting factor to the phase and amplitude of each sounding so that the composite sounding signal on the given tone or sub channel will exhibit constructive interference between soundings from each antenna in the desired direction and destructive interference in all others.

Take the case of a linear array of antennas spaced apart at the wavelength of the center frequency of the channel. The array factor AF is a function dependent only on the geometry of the array and the beamsteering i.e. amplitude and phase applied to its individual elements. The following function is the array factor AF for a linear array of antennas each spaced apart from one another along a line coincident with the x axis at the wavelength of the center frequency of the channel 

A single heterogeneous downlink sounding is shown. The individual tones or sub channels which make up the OFDM channel are shown. For a 20 Mhz channel 56 tones or sub channels make up the OFDM channel. Selected tones or sub channels having indices 0 14 28 and 42 are subject to discrete anisotropic soundings. The associated anisotropic Rf signal footprints and azimuthal angles are shown B at 0 for tone 0 C at 90 for tone 14 D at 180 for tone 28. The remaining footprint for tone 42 at 270 is not shown. The remaining tones or sub channels each have an isotropic sounding Rf signal footprint A.

The downlink sounding is used to characterize all links from WAP to stations respectively. The sounding and responses C C D C for links respectively are shown. The anisotropic sounding shown in this embodiment of the invention on selected ones of the tones or sub channels does not interfere with normal network operation occurring as they do concurrently with the normal isometric sounding of the remaining tones on the channel. These anisotropic soundings on selected sub channels or tones do however provide a richer set of spatial parameters by adding to the pool of aggregated CSI spatial information derived from the discrete directionality of the sounding signal strength from each of the selected tones. The anisotropically sounded sub channels may be used singly or in combination with the remaining isotropically sounded sub channels for the determination of spatial information.

Link between WAP and station is shown as exhibiting a power loss of 69 dB on the sub channel with index 28 sounded anisotropically at an azimuthal angle of 180 . Link also exhibits a power loss of 78 dB on the sub channel with index 14 sounded anisotropically at an azimuthal angle of 90 . Link also exhibits a power loss of 87 dB on the sub channel with index 0 sounded anisotropically at an azimuthal angle of 0 . Based only on relative power loss and the associated direction of the associated anisotropic sounding vector addition is used to determine the likely spatial orientation of the WLAN station as having an azimuthal angle of 160 relative to the WAP . The magnitude of the attenuation in power at 180 suggests an intervening wall indicating that station is in a different room A from the WAP in room B.

Link between WAP and station is shown as exhibiting a power losses of 74 dB 53 dB and 76 dB on the sub channels with indices 28 14 0 sounded anisotropically at azimuthal angles of 180 90 0 respectively. Vector addition is used to determine the likely spatial orientation of the WLAN station as having an azimuthal angle of 110 relative to the WAP . The modest attenuation in power at 90 suggests an absence of obstacles or structure along this link indicating that station is in the same room B as the WAP.

Link between WAP and station is shown as exhibiting a power losses of 87 dB 82 dB and 64 dB on the sub channels with indices 28 14 0 sounded anisotropically at azimuthal angles of 180 90 0 respectively. Vector addition is used to determine the likely spatial orientation of the WLAN station as having an azimuthal angle of 35 relative to the WAP . The sizeable attenuation in power at 0 suggests an intervening wall along this link indicating that station is in a different room C from the WAP.

In other embodiments of the invention additional spatial information may be derived from the CSI sounding feedback such as the relative amounts of scattering or correlation exhibited by each link channel in response to each of the discrete anisotropic soundings. In another embodiment of the invention both the CSI derived from sounding the isotropic together with the anisotropically sounded sub channels may be used for the structural determinations. In another embodiment of the invention the CSI sounding feedback indicative of the angle of receipt i.e. the V matrix may be used to further refine the spatial determination.

At time tthe transmitting node is shown engaging in normal beamformed MIMO transmit communications of a user data packet and associated header A to the receiving node . The communications are conducted on the selected one of the communication channels available to the WLAN. The header A of each user data packet contains a Very High Throughput Long Training Field a.k.a. VHT LTF which the receiver uses to characterize the link channel H. The receiving node which may be a WAP or a station determines the link channel H where n is the sub channel index for each of the OFDM tones or sub channels of the selected channel. The channels for the first three tones. H H Hreferenced as A C are shown. If the receiving station determines based on a comparison with prior link channel analysis that the link channel H has changed significantly then the WLAN node will feed forward the CSI information in packet at time tto the transmitting node . In an embodiment of the invention the sounding feed forward may also be sent directly to the aggregating entity for the spatial data e.g. the WAP or the server or other computer processing entity associated with the Cloud . If the sounding feed forward conforms to the IEEE 802.11n standard it will include the H matrix for each sub channel or tone. If the sounding feedback conforms to the IEEE 802.11ac standard it will include the V and SNR matrix for each sub channel or tone. Upon receipt of the sounding feedforward packet the WLAN node processes the feedforward and determines IEEE 802.11n or reads IEEE 802.11ac the V matrix therefrom. WLAN node determines the Vmatrix where n is the sub channel index for each of the OFDM tones or sub channels of the selected channel. The V matrix for the first three tones V V Vreferenced as A C are shown. These V matrices a.k.a. the beamsteering matrices starting at time t are used for adjusting the beamsteering of the Rf signal strength of the subsequent user data packets and packet headers A transmitted toward the recipient WLAN node . The CSI from the unsolicited sounding feedback is also aggregated in the WAP or in the Cloud for subsequent spatial analysis.

In an embodiment of the invention the link channels are analyzed for perturbations in the channel coefficients. The links associated with the permanent perturbations are individually analyzed both before A and after B the permanent perturbation to identify any WLAN node subject to displacement as discussed above in connection with . Node displacement may take the form of a change in physical location of the node or its reorientation either of which will result in significant permanent changes in the associated link channel matrices. If a WLAN node was displaced the time of its displacement along with the change in throughput before and after the displacement is stored in spatial data table . In the example shown wireless node c e.g. a station node is displaced further away from node d and closer to node b .

The links associated with the temporary perturbations in the link channels are individually analyzed to determine whether the perturbations are consistent with human activity in the residence and if so the path of the activity. Perturbations at times t t tto links b c b d b a respectively are correlated with human activity A C in the residence and a path of that activity through the WLAN links is determined as discussed above in connection with . The time and path of this human activity and or the temporary perturbations of the associated links are stored as records in spatial data table .

In another embodiment of the invention the link channels magnitudes correlation and scattering time of flight are analyzed . These parameters are correlated with node layout and structural impediments within or around the WLAN nodes as discussed above in connection with . In the example shown nodes a and c are determined to be in the same room B of the residence in between the rooms A and C associated with nodes b and d respectively. This layout and structural information is stored in the spatial data table on the Telco or ISP s server or cloud database.

In an embodiment of the invention the spatial data is made available to 3party developers via application programming interfaces API s . This allows the developers to create homeowner facing applications for WLAN servicing home security smart home and health monitoring within each homeowner s residence B. The spatial data can be useful in diagnosing issues with WLAN operation since one of the causes of such issues may be movement of a device node from a location at which performance was acceptable to a new location at which service interruptions are experienced. The spatial data can be useful in home security scenarios such as determining the presence of an intruder in the home. The spatial data can be used in smart home scenarios such as turning devices or utilities on or off depending on the presence or absence of a human in a room of the residence. The spatial data can also be useful for health monitoring of an elderly person in a home to track their activity or determine whether they have had a fall. Each of these potential consumer facing applications use as their foundation the spatial data aggregated from the homeowner s own residence from their WLAN without interrupting or degrading the normal WLAN communication function.

In operation the sounding generator controls explicit and unsolicited soundings. For explicit soundings it controls the timing and generation of the sounding as well as the stations targeted for a sounding feedback response. In embodiments of the invention where the isotropic sounding includes selected tones or sub channels with anisotropic Rf signal footprints the selection of the anisotropically sounded tones and the determination of their distinct directionality is controlled by the sounding generator. For unsolicited soundings the sounding generator controls the determination of when the channel change warrants feed forward of link channel CSI as well as the actual sending of that feed forward sounding CSI.

The sounding aggregator controls the aggregation of uplink downlink and crosslink CSI sounding feed forward and feedback and the storage of the associated CSI records in storage as link channel CSI records .

The spatial correlator correlates CSI from the explicit or unsolicited channel soundings with spatial characteristics of the WLAN including at least one of a change in location of a WLAN node human activity among the WLAN nodes and structural impediments among WLAN nodes. The spatial correlator stores the resultant spatial data in storage . The spatial correlator in an embodiment of the invention correlates perturbations over time in the CSI of WLAN link s with at least one of a change in location of an associated WLAN node and human activity across the WLAN link s . In another embodiment of the invention the spatial correlator correlates at least one of magnitudes time of flight and multi path properties of the CSI of the WLAN link s with the structural impediments to communications on said link s . In an embodiment of the invention the spatial correlator determines perturbations in the CSI by evaluating changes over time in the link channel matrix coefficients in accordance with Equation 1. In an embodiment of the invention the spatial correlator determines power loss in a link channel as the magnitude of the trace of the matrix resulting from the multiplication of the link channel Hermitian and itself i.e. HH in accordance with Equation 2. In an embodiment of the invention the spatial correlator determines the amount of scattering exhibited by a link channel as the standard deviation of the trace of the matrix resulting from the multiplication of the link channel Hermitian and itself i.e. HH in accordance with either Equation 4a or 4b. In an embodiment of the invention the spatial correlator determines the time of flight of a link channel by determining both the difference in the average phase rotation of two neighboring OFDM sub channels or tones of the link channel together with the difference in the center frequency of the two sub channels in accordance with Equations 5a e.

The developer API module provides the APIs for accessing the spatial data including a manifest template which includes the files features and permissions required by the associated application. The Application access control module governs an applications access to spatial data. This includes correlation of the manifest file permissions the identify of the application user and the WLAN owned by the application user with the corresponding spatial data. The application access control module uses the subscriber and WLAN identifier table to make these determinations.

In the baseband stage transmitted communications for user station are encoded and scrambled in encoder scrambler module and de multiplexed into two streams in demultiplexer . Each stream a b is subject to interleaving and constellation mapping in an associated interleaver mapper and passed to the spatial mapper . The spatial mapper uses a beamsteering matrix determined from a prior isotropic sounding of the link with station to steer subsequent communications thereto. The beamsteering matrix specifies specific phase and amplitude adjustments for the communications on each antenna designed to steering the outgoing communications toward the recipient station. There is a discrete beamsteering matrix for each of the OFDM tones or sub channels. The combined streams ab are injected into each of the OFDM tones or sub channels A B of the inverse discrete Fourier Transform IDFT modules A B respectively. Each IDFT module is coupled via associated upconversion circuitry in the Rf stage to an associated one of the pair of antenna . During Explicit soundings there is no beamsteering rather the Rf radiation signal strength is the same in all directions.

In the Rf Stage received communications ab on each of the two antenna from user station are downconverted and supplied as input to the baseband stage . In the baseband stage the received communications are then transformed from the time to the frequency domain in the discrete Fourier Transform DFT modules A B from which they are output as discrete orthogonal frequency division multiplexed OFDM tones sub carriers sub channels A B. All received streams are then subject to equalization in equalizer . Received steams ab are subject to de interleaving and constellation demapping in associated deinterleaver demapper modules followed by multiplexing in multiplexer . The received data ab is decoded and descrambled in decoder descrambler .

In process the link channel CSI resulting from the explicit or unsolicited MIMO soundings of any or all WLAN links are aggregated after any normal use associated with the normal operation of the WLAN. No aggregation takes place in prior art soundings. Rather in the normal use of channel sounding feedback from explicit soundings in Prior Art WLAN operations the soundings feedback is used exclusively by the transmitting node to update the beamsteering matrix for subsequent communications on the associated link and is then discarded. By contrast all soundings in this embodiment of the invention are also subsequently centrally aggregated on the WAP or in the Cloud server for subsequent spatial analysis. In an embodiment of the invention aggregation begins at a station with the collection of link channel CSI from uplink or crosslink soundings with subsequent delivery of the link channel CSI to the WAP or directly to the cloud e.g. a Telco or ISP server. In another embodiment of the invention aggregation begins at the WAP with the collection of link channel CSI from downlink and uplink soundings. In either embodiment of the invention aggregation may be performed exclusively at the WAP or cooperatively between the WAP and the Cloud on a server coupled to the WAP through a wired or wireless broadband connection to the ISP or Telco servicing the WLAN associated with the WAP. Next control is passed to processes .

In the block of processes spatial correlation of the aggregated link channel takes place. The first of the processes in this block is decision process . In decision process a determination is made as to the type of sounding analysis required. If the sounding analysis is historical control is passed to process . In process the historical trends in link channel CSI from the aggregated downlink uplink and crosslink soundings are evaluated. The evaluation includes whether a perturbation of the associated link channel has taken place and if so when and of what type e.g. temporary or permanent. Perturbations are determined by evaluating changes over time in the link channel matrix coefficients from the associated soundings.

Next in decision process a determination is made as to whether the perturbations being evaluated are temporary or permanent. Processing of permanent perturbations begins in process in which permanent link channel perturbations are correlated with changes in location or orientation of a WLAN device or node as discussed above in connection with . Next in process any changes in throughput of the associated link are noted before and after the change in location or orientation of the WLAN node. Next in process the corresponding spatial data as to the relocated or reoriented WLAN node s is stored as spatial WLAN node data for the associated WLAN.

Alternately if in the perturbation decision process a determination is made that the perturbations being evaluated are temporary then control is passed to process . In process the processing of temporary perturbations of a link channel are correlated with human activity within or across the associated links as discussed above in connection with . Next in process the perturbation times of different links is used to determine a prospective path of human activity relative to the WLAN links. Next in process the corresponding spatial data as to the human activity within the residence serviced by the WLAN nodes is stored as spatial activity data for the associated WLAN.

Alternately if in the sounding analysis decision process a determination is made that steady state sounding analysis is to be performed then control passes to process . The steps associated with steady state sounding analysis may be performed concurrently with or subsequent to the historical sounding analysis with each improving the accuracy of the other. Steady state analysis commences with process in which the link channel CSI associated with each links sounding is evaluated for magnitude of the link channels power or signal strength the time of flight associated with the link and the scattering or multipath properties of the link channel. In an embodiment of the invention the power loss in a link channel is determined from the magnitude of the trace of the product of the link Channel Hermitian and itself i.e. HH. In an embodiment of the invention the time of flight of the at least one link is determined as proportional to the quotient of the phase rotational difference divided by the frequency difference of two neighboring OFDM sub channels of the selected communication channel. The neighboring tones may be adjacent to one another or separated from one another by one or more intervening tones or sub channels. In an embodiment of the invention the scattering of a link channel is determined from the standard deviation of the trace of the product of the link Channel Hermitian and itself. HH. After these evaluations have been completed control is passed to process .

In process a further evaluation is performed when and if the generally isotropic soundings associated with the link channel CSI included a selected subset of OFDM tones or sub channels which were anisotropically sounded. If so then the discrete directionally associated with the sounding of each tone within these sub channels is evaluated and used to improve the accuracy of the correlation in the following step .

In process the above described sounding parameters evaluated in processes are correlated with prospective note layout and structural impediments including structural surroundings. At one extreme minimums of link channel power loss scattering and time of flight are correlated with link nodes in the same room or structure with one another. Conversely at another extreme maximums of link channel power loss scattering and time of flight are correlated with link nodes in different rooms from one another and separated by one or more walls depending on the amount of power loss and scattering. Additionally where a link channel exhibits power loss without scattering a correlation is made as to the distance separating the link nodes. Conversely where a link channel exhibits power loss with significant scattering a correlation is made as to structural impediments between the link nodes. Where selected tones of the associated sounding were directionally sounded the direction of the sounding is correlated with the relative layout of the nodes on this and other links subject to the sounding. This improves the accuracy of the node layout and structural impediment correlations. Next in process the corresponding spatial data as to WLAN node layout and structural impediments including surrounding structures is stored as spatial structural data for the associated WLAN.

After all forms of spatial correlation have been completed the associated spatial data is stored in process with identifiers for the associated property or structure e.g. a street address and for the associated owner or subscriber of the WLAN e.g. the subscribers name and account number. This spatial data can then be made available to application developers for numerous residential and business spatial Applications such as WLAN diagnosis home security health care monitoring smart home utility control elder care etc.

The components and processes disclosed herein may be implemented a software hardware firmware or a combination thereof including program code software a memory element for storing the program code software and a processor for executing the program code software without departing from the scope of the Claimed Invention.

The foregoing description of a preferred embodiment of the invention has been presented for purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise forms disclosed. Obviously many modifications and variations will be apparent to practitioners skilled in this art. It is intended that the scope of the invention be defined by the following claims and their equivalents.

