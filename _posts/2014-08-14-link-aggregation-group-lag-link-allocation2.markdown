---

title: Link aggregation group (LAG) link allocation
abstract: Methods, systems, and computer readable media for link aggregation group (LAG) link allocation are disclosed. According to one method for indirect LAG link allocation, the method includes status information associated with a LAG. The method also includes at a first network node, utilizing the status information to set path identifiers in packets for controlling LAG allocation. The method further includes at a second network node separate from the first network node, receiving the packets and allocating LAG links to the packets based on the path identifiers.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09537785&OS=09537785&RS=09537785
owner: IXIA
number: 09537785
owner_city: Calabasas
owner_country: US
publication_date: 20140814
---
The subject matter described herein relates to processing information. More specifically the subject matter relates to methods systems and computer readable media for link aggregation group LAG link allocation.

Link aggregation generally refers to any technique that aggregates or combines multiple network connections e.g. links or ports into one virtual network connection or a link aggregation group LAG . For example at concurrent times a network switch may provide data to a server via two LAG links associated with a LAG where the combined throughput of the LAG links is greater than either of the individual LAG links. When sending packets via a LAG a network element such as a network switch may be configured to provide the packets via one or more LAG links. However issues arise when attempting to use or allocate the LAG efficiently. In particular conventional LAG link allocation is typically based on a flow tuple hash or other methods that fail to effectively load balance or load share flows e.g. sessions or related packets among LAG links. For example conventional LAG link allocation techniques fail to ensure that LAG links are not overutilized or underutilized. Another problem with conventional LAG implementations is that conventional LAG implementations typically require all links in a LAG be the same speed and have other similar characteristics such as latency.

Accordingly a need exists for improved methods systems and computer readable media for LAG link allocation.

Methods systems and computer readable media for link aggregation group LAG link allocation are disclosed. According to one method for indirect LAG link allocation the method includes status information associated with a LAG. The method also includes at a first network node utilizing the status information to set path identifiers in packets for controlling LAG allocation. The method further includes at a second network node separate from the first network node receiving the packets and allocating LAG links to the packets based on the path identifiers.

According to one system the system includes a LAG controller configured to monitor status information associated with a LAG. The system also includes a first network node configured to utilize the status information to set path identifiers in packets for controlling LAG allocation and a second network node separate from the first network node. The second network node is configured to receive the packets and to allocate LAG links to the packets based on the path identifiers.

The subject matter described herein may be implemented in software in combination with hardware and or firmware. For example the subject matter described herein may be implemented in software executed by a processor. In one exemplary implementation the subject matter described herein may be implemented using a computer readable medium having stored thereon computer executable instructions that when executed by the processor of a computer control the computer to perform steps. Exemplary computer readable media suitable for implementing the subject matter described herein include non transitory devices such as disk memory devices chip memory devices programmable logic devices and application specific integrated circuits. In addition a computer readable medium that implements the subject matter described herein may be located on a single device or computing platform or may be distributed across multiple devices or computing platforms.

As used herein the term node refers to a physical computing platform including one or more processors and memory.

As used herein the terms function or module refer to hardware firmware or software in combination with hardware and or firmware for implementing features described herein.

As used herein the term link refers to any path route or type s of connection between devices. For example a link may include one or more communications nodes networks or media such as a wire cable fiber optics radio or other medium. In a second example a link may also include a trunk and or logical connection.

As used herein the term link aggregation group LAG refers to a group of links a related link aggregation technique and or a multi path technique for connecting multiple devices. For example a LAG may involve an equal cost multi path routing technique or other multi path technology for providing communications between two or more network nodes. In this example the two or more network nodes may be associated with different data centers networks and or multiple network operators interconnecting them.

The subject matter described herein includes methods systems and computer readable media for link aggregation group LAG link allocation. Conventional LAG link allocation techniques use hashing functions that generate hash values based on packet header information e.g. a source address a destination address a source port number a destination port number and or an application protocol. For example every packet in a flow may include packet header information that outputs to the same hash value. In this example the hash value may be associated with a particular LAG link. While packets of a given flow may be related to the same hash value other packets may also include packet header information that when used by a hashing function generates the same hash value and therefore multiple flows may be associated with the same link. Hence conventional LAG link allocation techniques that use hashing functions do not prevent LAG links from being overutilized or underutilized.

In accordance with some aspects of the subject matter described herein a computing platform e.g. a device or a node or a module e.g. a field programmable gateway array FPGA an application specific integrated circuit ASIC or software executing on a processor may be configured to use status information associated with a LAG for assigning path identifiers that affect LAG link allocation. For example a network element e.g. a network switch a network router or an endpoint may receive status information associated with a LAG e.g. link utilization information error rate information and or maintenance or projected maintenance information from a LAG controller or other entity such as a software defined network SDN controller or a network management system. In this example the network element may modify using the status information values e.g. in a load balancing hash table that determines path identifiers to include in packets where each of the path identifiers e.g. virtual local area network VLAN identifier or a multiprotocol label switching MPLS label indicates a particular LAG link for sending a corresponding packet.

By using status information associated with a LAG to assign path identifiers that affect or trigger LAG link allocation an exemplary computing platform or module may use current utilization rates of individual LAG links to effectively load balance e.g. load share packets among LAG links. Moreover by using path identifiers stored in packets for triggering LAG link allocation load balancing mechanisms or related lookup information at a network element associated with a LAG e.g. a network switch connected to LAG links can be simplified e.g. the associations between path identifiers and LAG links may be substantially static and or have a one to one ratio.

Reference will now be made in detail to exemplary embodiments of the subject matter described herein examples of which are illustrated in the accompanying drawings. Wherever possible the same reference numbers will be used throughout the drawings to refer to the same or like parts.

Network elements may represent any suitable entity or entities e.g. one or more nodes or devices for receiving processing and or sending traffic. Network elements may include multiple communications interfaces and may communicate using a variety of protocols. For example network elements may include functionality for communicating or facilitating communications with one or more nodes or modules in network .

In some embodiments network elements may include a network switch a network router a network device LAG controller an endpoint and or a server. Exemplary communications interfaces may include a software defined network SDN related interface an Internet protocol IP interface a graphical user interface GUI a command line interface CLI and or an application programming interface API . Exemplary protocols may include an extensible markup language XML protocol a hypertext transfer protocol HTTP an IP protocol a Diameter protocol an OpenFlow protocol and or other protocols.

In some embodiments network elements and may represent endpoints e.g. computing platforms devices and or nodes or routers e.g. near endpoints associated with one or more flows e.g. one or more related packets . For example network element may be a server executing a hypervisor and one or more virtual machines VM . In this example the hypervisor and or VMs may be configured to generate and or modify packets and or related header information associated with one or more flows. In another example network element may be a top of rack server associated with a server or endpoint. In this example network element may be configured to modify packets and or related header information associated with one or more flows.

In some embodiments network elements and may include routing or path related information stored in one or more data structures. Exemplary data structures for storing routing or path related information may include a hash table an associative array and or a content addressable memory CAM .

In some embodiments routing information may include a path assignment table where each entry in the path assignment table may include an association between one or more assignment values and a path identifier e.g. VLAN identifier a MPLS label or a path label that affects which LAG link a packet traverses. Exemplary assignment values may include a flow tuple or other identifier a hash of a flow tuple or other identifier and or data in a key value data structure. For example an assignment value may represent a value e.g. a memory address in a key value data structure e.g. a CAM and a flow tuple or other identifier may represent a key in the key value data structure. In another example an assignment value may represent a unique or non unique key in a key value data structure and a path identifier may represent a value in the key value data structure.

In some embodiments assignment values may represent values within a given range e.g. 0 15 and may be generated using one or more assignment procedures such as a hashing function a load sharing algorithm a modulus operation and or packet header information. Using a path assignment table or related information network elements and may modify packets to include path identifiers based on corresponding assignment values. The path identifiers in the packets may be used by one or more network elements e.g. network element to determine and or indicate which paths e.g. LAG links the packets travel.

In some embodiments network element and or network element may include a LAG optimization module LOM such as LOM or LOM . Each of LOMs and may be any suitable entity or entities e.g. software executing on a processor an ASIC an FPGA or a combination of software an ASIC or an FPGA for performing one or more aspects associated with optimizing LAG utilization. For example LOM may receive from LAG controller or another entity information regarding link utilization associated with LAG . In this example LOM may use this information for determining whether and or how to re distribute load among LAG links associated with LAG .

In some embodiments each of LOMs and may include functionality for modifying and or maintaining routing information and or path related information. For example LOM may be configured to modify associations between assignment values and path identifiers in a path assignment table. By modifying associations between assignment values and path identifiers LOM may affect utilization among LAG links associated with LAG since the likelihood of packets being associated with a LAG link is related to the number of assignment values associated with a given path identifier.

In some embodiments each of LOMs and may include functionality for determining how to assign or reassign associations between assignment values and path identifiers. In such embodiments each of LOMs and may use various algorithms predetermined information dynamic information and or historical information when determining whether and or how to assign or reassign associations between assignment values and path identifiers. For example LOM may determine that certain popular assignment values are attributable to a large percentage of utilization among LAG links and as such LOM may attempt to assign each of these popular assignment values to a separate LAG link. In another example LOM may increase a number of assignment values that are associated with a path identifier after determining that a corresponding LAG link e.g. with regard to path identifier is underutilized. In another example LOM may decrease a number of assignment values that are associated with a path identifier after determining that a corresponding LAG is overutilized.

In some embodiments each of LOMs and may be configured to maintain routing information and or path related information based on newly received utilization information which may be used for new flows and may also be configured to store routing information and or path related information based on older received utilization information which may be used for pre existing flows. For example assuming an assignment value 2 was reassigned to a path identifier X from Y if a flow associated with an assignment value 2 was initiated e.g. existing prior to the reassignment subsequent packets associated with the flow may still be modified to include path identifier Y while packets from all new flows associated with an assignment value 2 may be modified to include path related a path identifier X . In this example by maintaining information for existing flows an existing flow need not be reassigned to a path identifier and as such packets for the flow may continue to traverse the same LAG link.

In some embodiments each of LOMs and may be configured to maintain routing information and or path related information based on newly received utilization information which may be used for new flows and pre existing flows. In such embodiments each of LOMs and may be configured to provide additional information when a flow is reassigned to another path identifier. For example assuming an assignment value 2 was reassigned to a path identifier X from Y if a flow associated with an assignment value 2 was initiated e.g. existing prior to the reassignment subsequent packets associated with the flow may be modified to include path identifier Y regardless of a previous path identifier for the flow. In this example one or more procedures e.g. a handover operation may be implemented such that the flow is processed and or handled correctly e.g. at a destination port or endpoint processor.

In some embodiments network elements and may represent nodes e.g. routers switches or other devices associated with LAG . For example network element and may be routers connected via multiple network connections collectively known as LAG . In this example LAG ports A B C and D may each represent a LAG link or network connection associated with LAG .

In some embodiments network elements and may include functionality for allocating packets or flows among LAG links e.g. LAG ports A D . For example network element may be configured to analyze or inspect a path identifier in a received packet and to determine using the path identifier which LAG port e.g. LAG link to utilize when sending the packet. In this example the path identifier may indicate a particular LAG link associated with LAG .

In some embodiments network elements and may include routing information and or path related information stored in one or more data structures. For example routing information and or path related information may include a port forwarding table where each entry in the port forwarding table may include an association between a path identifier and a port indicator that indicates which LAG link a packet traverses. Using a port forwarding table or related information network elements and may determine a LAG link to utilize for packets based on corresponding path identifiers included in the packets.

LAG controller may represent any suitable entity or entities e.g. one or more nodes or devices for monitoring and or controlling LAG link utilization. In some embodiments LAG controller may directly or indirectly monitor status information and or aspects associated with LAG or links therein. For example LAG controller may directly monitor performance including link utilization of links in LAG by receiving information from network elements and or . In another example LAG controller may indirectly monitor performance including link utilization of links in LAG by receiving information from network element LOM network element and or LOM . In this example LAG controller may not even need to communicate with network elements and thereby allowing network elements and to forgo needing additional functionality for communicating with LAG controller e.g. an SDN interface or related functionality .

In some embodiments LAG controller may communicate with various entities e.g. network elements network operators or other sources and may determine utilization rates or related information for LAG a LAG link therein or a related entity e.g. a node a resource or a network segment . In another example LAG controller may determine whether a LAG or a link therein is overloaded underloaded experiencing problems or operating normally.

In some embodiments LAG controller may be implemented as a distributed entity across multiple computing devices or platforms. For example LAG controller may be implemented as a software module executing on processors associated with LOM LOM and or other entities such as network elements .

In some embodiments LAG controller may communicate with one or more of network elements or modules using a software defined network SDN related interface or another interface. Exemplary SDN related interfaces may include an OpenFlow protocol interface or a Diameter protocol interface.

In some embodiments LAG controller may use received or derived information to direct or trigger LAG link allocation and or to modify routing or related information. For example LAG controller may receive utilization rates from network elements connected to LAG . The utilization rates may indicate an amount that each LAG link is being utilized. In this example LAG controller may use this information to re distribute load among LAG links associated with LAG e.g. by modifying values in a path assignment table at network element or LOM . In another example LAG controller may receive and send LAG utilization related information to LOM and LOM may determine whether and or how to re distribute load among LAG links associated with LAG .

It will be appreciated that is for illustrative purposes and that various nodes and or modules locations and or functionality described above in relation to may be changed altered added or removed.

Referring to data may be depicted using a table representing associations between assignment values e.g. a range of values between 0 15 and path identifiers e.g. VLAN identifiers and or MPLS labels . For example as depicted in a VLAN identifier 1 may be associated with assignment values 0 5 a VLAN identifier 2 may be associated with assignment values 6 10 a VLAN identifier 3 may be associated with assignment values 11 12 and a VLAN identifier 4 may be associated with assignment values 13 15 .

In some embodiments data may also include information regarding link utilization associated with LAG such as a current utilization rate associated with a LAG link that corresponds to a particular path identifier. For example as depicted in VLAN identifier 1 may be associated with a relative link utilization rate of 15 corresponding to LAG port A illustrated in VLAN identifier 2 may be associated with a relative link utilization rate of 30 corresponding to LAG port B illustrated in VLAN identifier 3 may be associated with a relative link utilization rate of 75 corresponding to LAG port C illustrated in and VLAN identifier 4 may be associated with a relative link utilization rate of 55 corresponding to LAG port D illustrated in . In some embodiments data may be modified e.g. in response to obtaining and or receiving utilization related information from LAG controller . For example LAG controller may obtain utilization rates associated with each LAG link periodically e.g. every 30 seconds and or aperiodically e.g. dynamically . In this example LAG controller may send this utilization information to LOM and in response LOM may modify data in an effort to load balanced traffic among LAG links associated with LAG .

In some embodiments assignment procedures e.g. one or more techniques for assigning path related identifiers may be modified and or changed such that some path identifiers are assigned to more or less traffic. For example if a path identifier is associated with an underutilized LAG link data may be modified to associate more assignment values with the path identifier. In this example by associating more assignment values with the path identifier a higher percentage of new flows may be allocated to the underutilized LAG link. In another example if a path identifier is associated with an overutilized LAG link data may be modified to associate less assignment values with the path identifier. In this example by associating less assignment values with the path identifier a lower percentage of new flows may be allocated to the overutilized LAG link.

Referring to data may be depicted after modifying associations between assignment values and path identifiers. For example as depicted in VLAN identifier 1 may be associated with assignment values 0 1 VLAN identifier 2 may be associated with assignment values 2 6 VLAN identifier 3 may be associated with assignment values 7 12 and VLAN identifier 4 may be associated with assignment values 13 15 .

In some embodiments data may also include updated information regarding link utilization associated with LAG such as current utilization rates. For example as depicted in VLAN identifier 1 may be associated with a relative link utilization rate of 80 corresponding to LAG port A illustrated in VLAN identifier 2 may be associated with a relative link utilization rate of 50 corresponding to LAG port B illustrated in VLAN identifier 3 may be associated with a relative link utilization rate of 30 corresponding to LAG port C illustrated in and VLAN identifier 4 may be associated with a relative link utilization rate of 70 corresponding to LAG port D illustrated in .

It will be appreciated that data in is for illustrative purposes and that different and or additional information may also be maintained for LAG link allocation.

In some embodiments data may be substantially static thereby simplifying various data maintenance issues regarding such data. For example in contrast to data associations between path identifiers and LAG links may rarely change and as such related network elements e.g. network elements may not need to constantly modify these associations in data .

Referring to data may be depicted using a table representing associations between path identifiers and LAG ports e.g. LAG links . In some embodiments each path identifier may be associated with a particular LAG port or LAG link associated with LAG . For example as depicted in VLAN identifier 1 may be associated with LAG port A illustrated in VLAN identifier 2 may be associated with LAG port B illustrated in VLAN identifier 3 may be associated with LAG port C illustrated in and VLAN identifier 4 may be associated LAG port D illustrated in . In this example each LAG port represents a different LAG link associated with LAG .

In some embodiments multiple path identifiers may be associated with a same LAG link. For example data may include VLAN identifiers 1 10 where at least two of the VLAN identifiers e.g. VLAN identifiers 1 4 are associated with a same LAG link e.g. LAG port A .

In some embodiments each path identifier may be associated with a unique LAG link. For example as depicted in data may include VLAN identifiers 1 4 and LAG ports A D in a one to one ratio e.g. where each VLAN identifier is associated with a unique LAG port.

It will be appreciated that data in is for illustrative purposes and that different and or additional information may also be maintained for LAG link allocation. For example data may include multiple or different path identifiers such as VLAN identifiers and MLPS labels.

At step status information associated with LAG may be monitored. For example link utilization information may be obtained by LAG controller directly from network elements and . In another example link utilization information may obtained indirectly by LAG controller e.g. via various other network nodes.

In some embodiments status information associated with LAG may include link utilization information error related information maintenance information performance information priority information operator preference information or user preference information

In some embodiments monitoring status information associated with LAG may include receiving at least some of the status information using a SDN related protocol and or interface such as an OpenFlow protocol or a Diameter protocol.

In some embodiments LOM may be implemented at a network switch a network router a network device a LAG controller an endpoint a hypervisor a VM or a server.

In some embodiments link utilization information may include a bandwidth consumption value associated with LAG a bandwidth availability value associated with LAG or a utilization percentage or rate associated with LAG .

At step a first network node may utilize the status information to set path identifiers in packets for controlling LAG allocation. For example LOM at network element may determine new assignment values for one or more path identifiers based on performance information e.g. error rates associated with particular links of LAG user preferences and or link utilization information. In this example LOM may update a related hash table or other path assignment data structure e.g. an associative array or CAM with the new assignment values.

In some embodiments a first network node network element network element or LAG controller may include a network switch a network router a network device an endpoint a hypervisor a VM or a server.

At step a second network node separate from the first network node may receive the packets and allocate LAG links to the packets based on the path identifiers.

In some embodiments a second network node e.g. network element or network element may be connected to LAG .

In some embodiments each LAG link associated with LAG may correspond to one or more of the path identifiers.

In some embodiments utilizing monitored link utilization to set path identifiers in packets for controlling LAG allocation may include selecting the path identifiers for the packets including the path identifiers in the packets and sending the packets. For example LOM network element or a virtual element therein e.g. a hypervisor or a VM may select a path identifier for a packet based on an assignment value stored in a hash table an associative array or a CAM and the packet s header information. In this example the packet may be modified to include the path identifier and sent to another node e.g. network element .

In some embodiments allocating LAG links to packets based on path identifiers may include determining using the path identifiers and forwarding information corresponding LAG links and sending via the corresponding LAG links the packets. For example network element may receive a packet containing a VLAN identifier 2 . In this example network element may consult data to determine that VLAN identifier 2 is associated with LAG port B and as such may send the packet via LAG port B .

It should be noted that LAG controller LOM LOM and or functionality described herein may constitute a special purpose computing device. Further LAG controller LOM LOM and or functionality described herein can improve the technological field of routing and or loading balancing communications and can improve LAG utilization and related LAG allocation techniques.

The subject matter described herein for LAG link allocation improves the functionality of LAGs and networks in general by providing for more efficient resource e.g. link utilization. It should also be noted that a computing platform that implements the subject matter described herein may comprise a special purpose computing device usable to monitor status information associated with a LAG and to use this information in adjusting LAG link allocations.

It will be understood that various details of the subject matter described herein may be changed without departing from the scope of the subject matter described herein. Furthermore the foregoing description is for the purpose of illustration only and not for the purpose of limitation as the subject matter described herein is defined by the claims as set forth hereinafter.

