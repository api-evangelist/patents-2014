---

title: Service processing method, device, and system
abstract: Embodiments of the present invention relate to the field of communications technologies and provide a service processing method, device, and system, where service expansion can be performed without changing an original device of an operator. The embodiments of the present invention include: acquiring business service information corresponding to a to-be-processed service flow, where the business service information includes a service flow identifier of the to-be-processed service flow and a service label corresponding to the service flow identifier; and sending the business service information corresponding to the to-be-processed service flow to a service router, so that the service router processes, according to the business service information, the to-be-processed service flow.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09590991&OS=09590991&RS=09590991
owner: Huawei Technologies Co., Ltd.
number: 09590991
owner_city: Shenzhen
owner_country: CN
publication_date: 20141224
---
This application is a continuation of International Application No. PCT CN2013 078555 filed on Jul. 1 2013 which claims priority to Chinese Patent Application No. 201210239173.X filed on Jul. 11 2012 both of which are hereby incorporated by reference in their entireties.

The present invention relates to the field of communications technologies and in particular to a service processing method device and system.

With the development of Internet a BRAS Broadband Remote Access Server or a BNG Broadband Network Gateway needs to gradually enhance various value added service processing capabilities for example OTT Over the top video processing DPI Deep Packet Inspection a firewall and antivirus. Currently expansion of all those capabilities is concentrated on the BRAS or the BNG however because there will be more types of value added services in the future when each service is expanded software upgrade and even hardware upgrade need to be performed on the BRAS or the BNG. Regardless of the software upgrade or the hardware upgrade an operator needs to power off a BRAS or BNG device and original services of users on the BRAS or the BNG are interrupted. Currently the number of users that the BRAS or the BNG can support is very large and if device power off is performed an influence range is very large which greatly affects user experience.

Embodiments of the present invention provide a service processing method device and system where service expansion can be performed without changing an original device of an operator.

To achieve the foregoing objective the embodiments of the present invention use the following technical solutions 

A service processing method including acquiring business service information corresponding to a to be processed service flow. The business service information includes a service flow identifier of the to be processed service flow and a service label corresponding to the service flow identifier. The method further includes sending the business service information corresponding to the to be processed service flow to a service router so that the service router processes according to the business service information the to be processed service flow. The service label is a service atom that undergoes encoding processing or a service atom cluster that undergoes encoding processing.

A service processing method including receiving business service information sent by a controller where the business service information includes a service flow identifier and a service label of a first service flow. The method further includes receiving the first service flow and acquiring a service routing table and processing the first service flow according to the business service information and the service routing table. The service label is a service atom or service atom cluster that undergoes encoding processing.

A service processing device including a business service information acquiring unit configured to acquire business service information corresponding to a to be processed service flow. The business service information includes a service flow identifier of the to be processed service flow and a service label corresponding to the service flow identifier. A business service information sending unit configured to send the business service information corresponding to the to be processed service flow to a service router so that the service router processes according to the business service information the to be processed service flow. The service label is a service atom that undergoes encoding processing or a service atom cluster that undergoes encoding processing.

Another service processing device including a receiving unit configured to receive business service information sent by a controller. The business service information includes a service flow identifier and a service label of a first service flow. The receiving unit is further configured to receive the first service flow. An acquiring unit is configured to acquire a service routing table. A processing unit is configured to process the first service flow according to the business service information and the service routing table.

According to the service processing method device and system that are provided by the embodiments of the present invention a service processing sequence is identified by using a service atom or a service atom cluster and business service information corresponding to the service atom or the service atom cluster is generated so that a service router and a service server adjacent to the service router process a to be processed service flow according to the business service information. In a service processing manner provided by the embodiments development of a new service changes into recombination of existing service atoms or adding of a new service atom so that an operator may proceed to process a service by still using an existing device and therefore service expansion can be performed without changing an original device of the operator.

The following clearly describes the technical solutions in the embodiments of the present invention with reference to the accompanying drawings in the embodiments of the present invention. Apparently the described embodiments are merely a part rather than all of the embodiments of the present invention. All other embodiments obtained by a person of ordinary skill in the art based on the embodiments of the present invention without creative efforts shall fall within the protection scope of the present invention.

The embodiment of the present invention provides a service processing method and the method is for example a method on a controller side. As shown in the method includes the following steps.

The business service information includes a service flow identifier of the to be processed service flow and a service label corresponding to the service flow identifier where the service label is a service atom or service atom cluster that undergoes encoding processing and the service atom cluster is a sequence formed by at least two service atoms arranged according to a sequence. The service atom is used to identify a service processing step required for processing the to be processed service flow. The encoding processing refers to that different binary digits or m ary digits are used to indicate different service atoms or service atom clusters.

For example if a service flow requires one service processing step a service label corresponding to the service flow is a service atom that undergoes encoding processing if a service flow needs multiple service processing steps service labels corresponding to the service flow are multiple service atom clusters that undergo encoding processing.

The present invention further provides a service processing method and the method is for example a method on a service router side. As shown in the method includes 

The business service information includes a service flow identifier of the to be processed service flow and a service label corresponding to the service flow identifier. The service label is a service atom or service atom cluster that undergoes encoding processing and the service atom cluster is a sequence formed by at least two service atoms arranged according to a sequence. The service atom is used to identify a service processing step required for processing the to be processed service flow. The encoding processing refers to that different binary digits or m ary digits are used to indicate different service atoms or service atom clusters.

The acquiring a service routing table may be implemented in the following two manners which specifically include the following steps.

Manner 1 Service routing table information sent by the controller is received and a service routing table is generated according to the service routing table information.

The service routing table information is generated by the controller according to service processing path information where the service processing path information is used to indicate a hop count required for processing the to be processed service flow and a type and the number of service atoms involved in each hop.

The service routing table is pre generated and stored in the service router and may be any one of a centralized service routing table and a distributed service routing table.

For example the centralized service routing table may include a service flow identifier a processing sequence number of a service flow an output port corresponding to the processing sequence number and a next hop service label corresponding to the processing sequence number the distributed service routing table may include a service atom processing capability an output port and address information that are corresponding to a next hop service processing device.

According to the service processing method provided by this embodiment of the present invention a service processing sequence and a service processing type are identified by using a service atom or a service atom cluster and business service information corresponding to the service atom or the service atom cluster is generated so that a service router and a service server adjacent to the service router process a to be processed service flow according to the business service information. In a service processing manner provided by this embodiment development of a new service changes into recombination of existing service atoms or adding of a new service atom so that an operator may process a new service by using an existing device and therefore service expansion can be performed without changing an original device of the operator.

This embodiment of the present invention further provides a service processing method which may be applied in a service routing network architecture shown in and the network architecture includes a controller a broadband network gateway BNG a service router a service server and a third party service device. If a service server includes a service routing function the service server changes into a service router.

The controller includes a network abstraction module which is configured to abstract various network devices and servers such as a service router and a service server as a whole so that for various control modules such as an access control module and a service routing control module an abstract service routing virtual network is seen that is only a node that has a service routing function and a node or a server that has a service processing capability are seen which implements that physical hardware at a bottom layer is shielded and device forms such as an access device a router and a switch are shielded. A service abstraction module is configured to abstract an editable service or network processing resource inside the controller as a service atom or a service atom cluster visible for a user or an API Application Programming Interface that may be open to a third party. An open cloud interface configured to provide the third party with a standard interface for cloud collaboration in aspects such as cloud management cloud control and cloud bearing and the open cloud interface may be defined in a form of an open application programming interface Open API in this network architecture. For example an Open API may be a service atom API or a service routing API where the service atom API is configured to provide an interface for the third party to construct a service of the third party and the service routing API is configured to provide an interface for the third party to construct a virtual service routing network of the third party.

There are various control modules between the foregoing network abstraction module and the foregoing service abstraction module and the control modules include an access control module configured to implement an access control function such as user authentication and a Dynamic Host Configuration Protocol DHCP function the access control module may be further configured to acquire business service information of a to be processed service flow. A service routing control module configured to generate and maintain a service routing table and generate service processing path information for a service flow according to a service atom or a service atom cluster corresponding to the service flow. A service atomization module configured to register a service atom processing capability of a server. A service atom cluster generating Service Chain Orchestration module configured to generate a service atom cluster according to information such as business service information a service policy and a user policy.

The service router in this embodiment may be configured to add change or delete a service label for a packet in a service flow and forward the packet according to the service routing table. The service server in this embodiment may be configured to process a CT Communication Technology service and an IT Information Technology service and provide a corresponding service atom processor for example a CT service atom processor or an IT service atom processor. The service server may be provided by a telecommunication operator and may also be provided by a third party.

For example if the service router is used as a medium or small sized broadband service gateway the controller may be built in the service router and a service routing network architecture shown in is formed so that a network delay may be further reduced performance is improved and control is simplified.

It should be noted that the controller may have three control modes a user authentication control mode an associated control mode and a signaling control mode. When processing a service flow the service router may have two processing manners which include a centralized service routing processing manner and a distributed service routing processing manner.

Based on the foregoing described network architecture shown in when the controller uses the user authentication control mode this embodiment of the present invention provides a service processing method. As shown in the method includes the following.

A user may have multiple services and a service flow corresponding to each service has its respective business service information.

A specific step of exchanging the user authentication message with the AAA server is a technology well known by a person skilled in the art and is not described in detail in this embodiment of the present invention.

The business service information corresponding to the user may be carried in the user authentication message of the user. For example the business service information corresponding to the user may be carried in an expanded access grant message of AAA and the expansion for example may be implemented by adding a new attribute or option in the access grant message of AAA.

The service processing path information is used to indicate in a process of processing the to be processed service flow a service router or a service server that the to be processed service flow needs to pass through according to a sequence and service atoms in the service atom cluster that a service router or a service server at each hop needs to separately process according to a sequence.

In this embodiment by using the user authentication control mode the controller may provide a corresponding service processing manner for a user after the user passes authentication so that the user obtains a personalized service and user experience is improved. In the user authentication control mode control and bearing are separated and a service path is optimal. The mode can be better compatible with an existing Internet service and is more suitable for a user scenario of dynamic IP Internet Protocol address allocation.

Based on the foregoing described network framework shown in when the controller uses the associated control mode that is a method in which service routing control is triggered by using a data packet this embodiment of the present invention provides a service processing method. As shown in the method includes 

The packet which cannot be identified by the service router of the to be processed service flow is a packet in which routing information corresponding to the packet cannot be found in a routing table of the service router.

A relevant description of the business service information is the same as the foregoing relevant description.

A relevant description of the service processing path information is the same as the relevant description in the step .

For example the service router also has an ordinary forwarding capability. When the service atom or the service atom cluster corresponding to the to be processed service flow cannot be processed ordinary forwarding is performed on the to be processed service flow and the control procedure in the associated control mode is ended. The ordinary forwarding herein is forwarding performed based on header information such as IP address information or other address information of a service flow packet.

In this embodiment by using the associated control mode the controller may control and process data for which a corresponding service label is not set which implements service processing of a majority of service flows and a special data packet. The mode can be better compatible with an existing Internet service and may further support a scenario in which a home user or an enterprise user uses a static IP address.

Based on the foregoing network framework shown in when the controller uses the signaling control mode this embodiment of the present invention provides a service processing method. As shown in the method includes 

A relevant description of the service processing path information is the same as the relevant description in the step .

In this embodiment by using the signaling control mode the controller may process by using a service atom a service such as a voice service of a type that a service is initiated by using signaling which improves serviceability of the service atom and reduces a development cost of an operator. The mode requires a user terminal to be capable of initiating service related signaling which is relatively suitable for a VoIP Voice over Internet Protocol service or another service such as a Peer to Peer service that supports signaling.

For example in this embodiment after the controller ends the control procedure the service router may process according to the centralized service routing processing manner or the distributed service routing processing manner the to be processed service flow.

In the service routing network architecture shown in when the service router and the service server are connected in a star topology the centralized service routing processing manner may be used. In a network connection structure shown in a controller may be disposed in a service router and may also be disposed outside the service router and connect to the service router. The service router and the service server are mutually independent all service servers connect to the service router and data exchange may be performed the service servers do not connect to each other so that a star topology connection is presented between the service router and the service servers.

An upstream device and a downstream device may be a service router or another network device that can send a packet and are not listed one by one herein in this embodiment of the present invention.

Based on the network connection structure shown in shows specific steps of the centralized service routing processing manner and the specific steps include 

It should be noted that Table 1 is only a centralized service routing table in a single controller generated and maintained by a Service Routing Control module and different controllers need to generate and maintain their respective centralized service routing tables. Content in Table 1 is only used as an example and specific implementation needs to be set according to an actual situation and a demand.

The service label is obtained by encoding a service atom or a service atom cluster and a specific encoding manner is not limited herein all realizable encoding manners in the prior art may be applied in this embodiment of the present invention. For example in Table 1 service labels 54321 12345 and 11111 are respectively corresponding to three different service atoms A B and C A B and C respectively represent three different service processing operations and a combination of the three different service processing operations according to a sequence of ABC is a service processing process required for processing the service flow.

The following Table 2 is a setting instance of a service label when a service flow is transmitted in a pseudo wire PW . A flow label is used to identify the service flow which may avoid flow classification made by a node subsequently and even may avoid making service identification. The service label is the same with the foregoing definition and is a service atom or service atom cluster that undergoes encoding processing where the service atom cluster is a sequence formed by at least two service atoms arranged according to a sequence.

The service label may also be set at a data link layer for example a service label is added inside an Ethernet packet and a virtual local area network VLAN identifier may be used as a service label. MPLS is Multi Protocol Label Switching multi protocol label switching.

The second processing sequence number is a second processing sequence number in the centralized service routing table shown in Table 1 in a column in which the processing sequence number is located.

It should be noted that in the step if it is determined that the second processing sequence number is still not the last processing sequence number continue to perform a procedure described in steps to until all service atoms in the service label corresponding to the to be processed service flow are processed completely in proper sequence.

In the service routing network architecture shown in if functions respectively corresponding to the service router the controller and the service server are integrated on a same device the device becomes a service processing device. In this case service processing devices may be connected together by using a network connection structure shown in so that a distributed service routing processing manner may be used. In the network connection structure shown in each service processing device can receive a packet or send a packet each two service processing devices may connect to each other and can perform data exchange.

An upstream device and a downstream device shown in may be a service router or another network device that can send a packet and may have a connection relationship and a data exchange capability with all service processing devices. The network connection structure shown in is only schematic and a specific connection manner is not limited in this embodiment of the present invention.

Based on the network connection structure shown in shows specific steps of the distributed service routing processing manner and the specific steps include 

Acquiring a distributed service routing table may be generating by receiving service routing table information sent by the controller the distributed service routing table according to the service routing table information or directly acquiring a service routing table configured in a service router. The first service flow is a to be processed service flow.

A distributed service routing table on the first service processing device is used as an example and the distributed service routing table may be shown in Table 3.

A next hop address may be an address of a service processing device and may also be an address of a virtual machine of the service processing device an IP address may be used and other information that has an address identification function may also be used which is not limited in this embodiment of the present invention. A next hop service atom processing capability for example may be indicated by using a service atom or a service atom cluster. The service processing device may be virtualized into multiple service servers that is virtual machines .

It should be noted that the distributed service routing table may be obtained by the service processing device by receiving the service routing table information sent by the controller and the distributed service routing table may also be acquired by the service processing device by learning a service atom or service atom cluster processing capability of an adjacent service processing device or the distributed service routing table is generated according to a locally configured service atom processing capability of an adjacent node.

For example the acquiring the distributed service routing table by the service processing device by learning the service atom or service atom cluster processing capability of the adjacent service processing device is specifically 

acquiring by the service processing device and from a received message multicast or broadcast by the adjacent service processing device a service atom processing capability corresponding to the adjacent service processing device and address information corresponding to the adjacent service processing device and

generating the distributed service routing table according to the service atom processing capability corresponding to the adjacent service processing device the address information corresponding to the adjacent service processing device and information of an output port connected to the adjacent service processing device.

Further after the distributed service routing table is generated the service processing device may still notify its service atom processing capability by periodically broadcasting or multicasting and receive a multicast or broadcast message sent by the adjacent service processing device. If a service atom processing capability notified by a new service processing device is received a new entry is added into an existing distributed service routing table according to the service atom processing capability corresponding to the new service processing device and address information of the new service processing device. If a new service atom processing capability notified by an adjacent service router a corresponding entry in the distributed service routing table of the adjacent service processing device is updated according to the new service atom processing capability. Optionally if no service atom processing capability notified by the adjacent service processing device is received in a time an entry that is corresponding to the adjacent service router and in the distributed service routing table may be deleted.

It should be noted that for generating the distributed service routing table according to the locally configured service atom processing capability of the adjacent node it is unnecessary for the service processing device to acquire a service atom processing capability of another service processing device by itself instead the distributed service routing table is generated according to a service atom processing capability locally pre configured in the service processing device of an adjacent service processing device. The pre configured service atom processing capability of the adjacent service processing device for example may be configured by network maintenance personnel or other personnel.

The predetermined service route selection policy includes a longest prefix matching policy and an optimal service feature matching policy.

For example the longest prefix matching policy may be understood as follows If a service atom cluster corresponding to the to be processed service flow is ABCD according to the distributed service routing table of Table 3 a service processing device corresponding to an output port 4 should be selected because the service processing device corresponding to the output port 4 may process a service atom A when a service atom cluster corresponding to the service flow is BCAD according to content displayed in the distributed service routing table of Table 3 a service processing device corresponding to an output port 3 should be selected because the service processing device corresponding to the output port 3 may process a service atom combination BC. Compared with a service processing device corresponding to an output port 2 a service atom C can further be consecutively processed.

For example the optimal service feature matching policy may be understood as selecting a route with a lowest routing cost. For example when the service atom cluster corresponding to the service flow is BCAD according to the content displayed in the distributed service routing table of Table 3 a route whose output port is 3 should be selected however if a routing cost of the service processing device corresponding to the output port 3 is higher for example a transmission delay is larger and in this case a route that is corresponding to the output port 2 and whose routing cost is lower may be selected.

Further the first service processing device may further receive a second service flow sent by the adjacent service processing device acquires a service label in the second service flow and decodes the service label into a corresponding service atom or service atom cluster and processes the second service flow according to the corresponding service atom or service atom cluster.

Optionally the second service processing device receives a service flow packet sent by the first service processing device and the service flow packet carries a service label corresponding to the service flow the second service processing device processes the service flow packet according to a registered service atom processing capability and the second service processing device deletes a processed service atom from a service atom cluster corresponding to the service label and then determines whether there is a remaining service atom in the service atom cluster. If it is determined that there is a remaining service atom the service label in the service flow packet is replaced with a new service label from which the service atom is deleted and an output port and a corresponding next hop address are searched for in the distributed service routing table according to the new service label and optionally according to the predetermined service route selection policy the second service processing device sends by using the found output port a service flow packet carrying the new service label to a third service processing device such as the service processing device corresponding to the next hop address so that the third service processing device processes the service flow according to a service atom processing capability of the third service processing device. The deleting the processed service atom from the service atom cluster corresponding to the service label is for example when a service label of the service flow is ABCD and the service processing device processes a service atom A deleting the service atom A in the service label ABCD and generating a new service label BCD.

If it is determined that there is no remaining service atom the second service processing device forwards the service flow packet out of the service routing network.

Two data processing manners provided in this embodiment may be applied in different network scenarios which increases a usage scope of this embodiment of the present invention and improves expansibility of a service.

According to the service processing method provided by this embodiment of the present invention a service processing sequence is identified by using a service atom or a service atom cluster and business service information corresponding to the service atom or the service atom cluster is generated so that a service router and a service server adjacent to the service router process a to be processed service flow according to the business service information. In a service processing manner provided by this embodiment development of a new service changes into recombination of existing service atoms or adding of a new service atom so that an operator may proceed to process a service by still using an existing device and therefore service expansion can be performed without changing an original device of the operator.

This embodiment of the present invention provides a service processing device and the service processing device for example may be the controller in Embodiment 1. As shown in the device includes a business service information acquiring unit configured to acquire business service information corresponding to a to be processed service flow where the business service information includes a service flow identifier of the to be processed service flow and a service label corresponding to the service flow identifier. A business service information sending unit is configured to send the business service information corresponding to the to be processed service flow to a service router so that the service router processes according to the business service information the to be processed service flow. The service label is a service atom that undergoes encoding processing or a service atom cluster that undergoes encoding processing.

For example as shown in the business service information acquiring unit includes an access control module and the access control module is configured to acquire from an authentication authorization and accounting server the business service information corresponding to the to be processed service flow.

For example the business service information acquiring unit includes the access control module and the access control module may be configured to acquire business service information that is preset in a controller and corresponding to the to be processed service flow.

For example the business service information acquiring unit includes the access control module and the access control module is configured to receive a service requirement sent by a service signaling gateway where the service requirement is a service requirement corresponding to service request signaling that is sent by a user and received by the service signaling gateway and the access control module generates according to the service requirement the business service information corresponding to the to be processed service flow.

For example as shown in the business service information sending unit specifically includes a service atom cluster generating module a service atomization module and a service routing control module where the service atom cluster generating module is configured to generate a service atom or a service atom cluster corresponding to the service label and determine according to a service atom processing capability registered in the service atomization module whether the service atom or the service atom cluster can be processed and if the service atom or the service atom cluster can be processed when the service router processes the to be processed service flow in a distributed service routing processing manner and a service routing table in the service router does not need to be generated according to service routing table information sent by the controller the service atom cluster generating module sends the business service information to the service routing control module and the service routing control module delivers the business service information to an entry service router corresponding to the to be processed service flow.

For example when the service router processes the to be processed service flow in a centralized service routing processing manner or when the service router processes the to be processed service flow in the distributed service routing processing manner and the service routing table in the service router needs to be generated according to the service routing table information sent by the service processing device the service routing control module generates according to the service atom processing capability registered in the service atomization module service processing path information corresponding to the to be processed service flow the service atom cluster generating module sends the business service information to the service routing control module and the service routing control module delivers the business service information to a first service router on a service processing path corresponding to the service processing path information generates service routing table information corresponding to each service router on the service processing path corresponding to the service processing path information and delivers the service routing table information to a corresponding service router.

For example if it is determined that the service atom or the service atom cluster cannot be processed the service atom cluster generating module is further configured to send the to be processed service flow to a network server so that the network server notifies a user that the to be processed service flow cannot be processed currently.

This embodiment of the present invention further provides another service processing device and the service processing device for example may be the service processing device or the service router in Embodiment 1. As shown in the service processing device includes a receiving unit configured to receive business service information sent by a controller where the business service information includes a service flow identifier and a service label of a first service flow. The receiving unit is further configured to receive the first service flow. An acquiring unit is configured to acquire a service routing table. A processing unit is configured to process the first service flow according to the business service information and the service routing table.

For example as shown in the acquiring unit includes a receiving module configured to receive service routing table information sent by the controller. A generating module is configured to generate the service routing table according to the service routing table information. Alternatively as shown in the acquiring unit includes an acquiring module which is configured to directly acquire a service routing table that has been stored in the service processing device. Alternatively as shown in the acquiring unit includes a service routing table learning module which is configured to acquire a distributed service routing table by learning a service atom or service atom cluster processing capability of an adjacent service processing device.

For example as shown in the processing unit includes a label adding module configured to when a service routing table acquired by the acquiring unit is a centralized service routing table add according to a first processing sequence number that is corresponding to the service flow identifier of the first service flow and in the centralized service routing table a first next hop service label corresponding to the first processing sequence number to a packet of the first service flow.

A first sending module is configured to send by using a first output port corresponding to the first processing sequence number the packet to which the first next hop service label is added of the first service flow to a service server corresponding to the first output port so that the service server corresponding to the first output port processes the first service flow according to the first next hop service label.

A first receiving module is configured to receive the first service flow that is sent by the service server corresponding to the first output port and undergoes first processing.

A determining module configured to determine whether the first processing sequence number is a last processing sequence number that is corresponding to the service flow identifier and in the service routing table.

A service label removing module is configured to if it is determined that the first processing sequence number is the last processing sequence number that is corresponding to the service flow identifier and in the service routing table remove the first next hop service label in the first service flow that undergoes processing. The first sending module is further configured to forward the packet from which the first next hop service label is removed of the first service flow out of a service routing network.

A service label replacing module is configured to if it is determined that the first processing sequence number is not the last processing sequence number that is corresponding to the service flow identifier and in the service routing table replace the first next hop service label in the first service flow that undergoes processing with a second next hop service label corresponding to a second processing sequence number that is corresponding to the service flow identifier and in the service routing table.

The first sending module is further configured to send by using a second output port corresponding to the second processing sequence number a packet carrying the second next hop service label of the first service flow to a service server corresponding to the second output port so that the service server corresponding to the second output port processes according to the second next hop service label the packet carrying the second next hop service label of the first service flow.

The first receiving module is further configured to receive the packet which undergoes processing of the first service flow where the packet is sent by the service server corresponding to the second output port and carries the second next hop service label.

The determining module is further configured to determine whether the second processing sequence number is the last processing sequence number that is corresponding to the service flow identifier and in the service routing table.

The service label removing module is further configured to if it is determined that the second processing sequence number is the last processing sequence number that is corresponding to the service flow identifier and in the service routing table remove the second next hop service label carried in the packet which carries the second next hop service label and undergoes processing of the first service flow.

The first sending module is configured to forward the packet from which the second next hop service label is removed of the first service flow out of the service routing network.

For example as shown in the processing unit further includes a searching module configured to when the acquired service routing table is a distributed service routing table search for in the distributed service routing table according to the service label and a predetermined service route selection policy and obtain a third output port and address information that are corresponding to a next hop service processing device. A carrying module is configured to carry the service label in the first service flow. A second sending module configured to send the first service flow to the next hop service processing device by using the third output port so that the next hop service processing device processes the to be processed service flow according to a service atom processing capability of the next hop service processing device.

For example as shown in the processing unit further includes a second receiving module configured to receive a second service flow sent by an adjacent service processing device acquire a service label in the second service flow and decode the service label into a corresponding service atom or service atom cluster and process the second service flow according to the corresponding service atom or service atom cluster.

This embodiment of the present invention further provides a service processing system . As shown in the system includes the foregoing service processing device and the service processing device .

When the foregoing service processing device is a controller and the service processing device is composed of a service router and a service server shows an instance of the service processing system .

According to the service processing device and system that are provided by this embodiment of the present invention a service processing sequence is identified by using a service atom or a service atom cluster and business service information corresponding to the service atom or the service atom cluster is generated so that a service router and a service server adjacent to the service router process a to be processed service flow according to the business service information. In a service processing manner provided by this embodiment development of a new service changes into recombination of existing service atoms or adding of a new service atom so that an operator may proceed to process a service by still using an existing device and therefore service expansion can be performed without changing an original device of the operator.

Based on the foregoing descriptions of the implementation manners a person skilled in the art may clearly understand that the present invention may be implemented by software in addition to necessary universal hardware or by hardware only. In most circumstances the former is a preferred implementation manner. Based on such an understanding the technical solutions of the present invention essentially or the part contributing to the prior art may be implemented in a form of a software product. The software product is stored in a readable storage medium such as a floppy disk a hard disk or an optical disc of a computer and includes several instructions for instructing a computer device which may be a personal computer a server or a network device to perform the methods described in the embodiments of the present invention.

The foregoing descriptions are merely specific implementation manners of the present invention but are not intended to limit the protection scope of the present invention. Any variation or replacement readily figured out by a person skilled in the art within the technical scope disclosed in the present invention shall fall within the protection scope of the present invention. Therefore the protection scope of the present invention shall be subject to the protection scope of the claims.

