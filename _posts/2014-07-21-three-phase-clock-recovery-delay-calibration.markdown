---

title: Three phase clock recovery delay calibration
abstract: System, methods and apparatus are described that facilitate transmission of data, particularly between two devices within an electronic apparatus. Information is transmitted in N-phase polarity encoded symbols. A clock recovery circuit may be calibrated based on state transitions in a preamble transmitted on two or more connectors. A calibration method is described. The method includes detecting a plurality of transitions in a preamble of a multiphase signal and calibrating a delay element to provide a delay that matches a clocking period of the multiphase signal. Each transition may be detected by only one of a plurality of detectors. The delay element may be calibrated based on time intervals between detections of successive ones of the plurality of transitions.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09137008&OS=09137008&RS=09137008
owner: QUALCOMM Incorporated
number: 09137008
owner_city: San Diego
owner_country: US
publication_date: 20140721
---
This application claims priority to and the benefit of U.S. provisional patent application No. 61 857 572 filed on Jul. 23 2013 the entire content of which application is incorporated herein by reference.

The present disclosure relates generally to high speed data communications interfaces and more particularly calibration of clocking in multi wire multiphase data communication links.

Manufacturers of mobile devices such as cellular phones may obtain components of the mobile devices from various sources including different manufacturers. For example an application processor in a cellular phone may be obtained from a first manufacturer while the display for the cellular phone may be obtained from a second manufacturer. Application processors displays and or other devices may be interconnected using a physical interface that may be standards based or proprietary in design. In one example a display component may provide an interface that conforms to the Display System Interface DSI standard specified by the Mobile Industry Processor Interface Alliance MIPI .

In a multi wire interface the maximum speed of the communication link and the ability of a clock data recovery CDR circuit may be limited by the maximum time variation related to transitions of signals transmitted on the communication link. Transitions on different wires may exhibit different variations in signal transition times which can cause the outputs of receivers in a receiving device to change at different times with respect to a data or symbol boundary. Large transition time differences in multi wire signals often requires the implementation of a delay element in the CDR circuit where the delay element has a minimum delay that is at least as long as the difference between the min and max receiver transition events. The maximum time of this delay element can restrict the throughput on the communication link by significantly limiting the period of the transmission clock. Moreover the maximum time of the delay element may vary with operating conditions including power voltage and temperature.

Embodiments disclosed herein provide systems methods and apparatus that enable calibration of clocks used in multiphase transmission systems. Calibration may be performed for each transmission of a multiphase signal and calibration allows for tighter operating margins of data recovery circuits. The apparatus may include a mobile terminal having multiple Integrated Circuit IC devices may be collocated in an electronic apparatus and communicatively coupled through one or more data links.

In various aspects of the disclosure a calibration method includes a calibration method that includes detecting a series of transitions in signaling state of three or more wires of a multi wire communications interface. Each transition in the series of transitions may correspond to a boundary between consecutive symbols in a preamble transmitted on the multi wire communications interface. In an aspect the calibration method includes deriving a receive clock from the series of transitions determining a transition region based on the series of transitions and calibrating a delay period corresponding to a duration of the transition region. In an aspect the calibration method includes receiving data symbols from the multi wire communications interface after termination of the preamble. The data symbols may be received using a version of the receive clock that is modified based on the delay period.

In an aspect the data symbols may be received by detecting a first detected transition corresponding to a boundary between a first data symbol and a second data symbol and ignoring other transition detections for a period of time based on the delay period and capturing a current data symbol after the period of time has elapsed. The ignored transition detections may correspond to the same boundary between the first data symbol and the second data symbol.

In an aspect calibrating the delay period includes estimating differences in timing between transitions in the series of transitions and calculating the delay period based on a maximum one of the differences in timing. The differences in timing between transitions in the series of transitions may be estimated relative to the receive clock. The delay period may be calibrated using a successive approximation algorithm or a linear search algorithm.

In an aspect each transition in the series of transitions is detected by a single one of a plurality of detectors. Each detector in the plurality of detectors may be configured to determine a difference between signaling state of two wires of the multi wire communications interface. The two wires may carry different versions of a multiphase signal. The plurality of detectors may include differential receivers. Each differential receiver may be configured to receive signals from a different pair of wires than the other differential receivers.

In an aspect the preamble is based on a gray code. The preamble may include a sequence of symbols identified in control information communicated between a transmitting device and a receiving device coupled to the multi wire communications interface.

In various aspects of the disclosure an apparatus includes means for detecting a series of transitions in signaling state of three or more wires of a multi wire communications interface. Each transition in the series of transitions may correspond to a boundary between consecutive symbols in a preamble transmitted on the multi wire communications interface. In an aspect the apparatus includes means for deriving a receive clock from the series of transitions means for determining a transition region based on the series of transitions and means for calibrating a delay period corresponding to a duration of the transition region. In an aspect the apparatus includes means for receiving data symbols from the multi wire communications interface after termination of the preamble. The data symbols may be received using a version of the receive clock that is modified based on the delay period.

In various aspects of the disclosure an apparatus includes a processing circuit configured to detect a series of transitions in signaling state of three or more wires of a multi wire communications interface. Each transition in the series of transitions may correspond to a boundary between consecutive symbols in a preamble transmitted on the multi wire communications interface. In an aspect the processing circuit may be configured to derive a receive clock from the series of transitions determine a transition region based on the series of transitions calibrate a delay period corresponding to a duration of the transition region and receive data symbols from the multi wire communications interface after termination of the preamble. The data symbols may be received using a version of the receive clock that is modified based on the delay period.

In various aspects of the disclosure a processor readable storage medium may have one or more instructions which when executed by at least one processing circuit cause the at least one processing circuit to detect a series of transitions in signaling state of three or more wires of a multi wire communications interface. Each transition in the series of transitions may correspond to a boundary between consecutive symbols in a preamble transmitted on the multi wire communications interface. In an aspect the instructions may cause the processing circuit to derive a receive clock from the series of transitions determine a transition region based on the series of transitions and calibrate a delay period corresponding to a duration of the transition region. In an aspect the instructions may cause the processing circuit to receive data symbols from the multi wire communications interface after termination of the preamble. The data symbols may be received using a version of the receive clock that is modified based on the delay period. The processor readable storage medium may include a non transitory storage medium.

Various aspects are now described with reference to the drawings. In the following description for purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of one or more aspects. It may be evident however that such aspect s may be practiced without these specific details.

As used in this application the terms component module system and the like are intended to include a computer related entity such as but not limited to hardware firmware a combination of hardware and software software or software in execution. For example a component may be but is not limited to being a process running on a processor a processor an object an executable a thread of execution a program and or a computer. By way of illustration both an application running on a computing device and the computing device can be a component. One or more components can reside within a process and or thread of execution and a component may be localized on one computer and or distributed between two or more computers. In addition these components can execute from various computer readable media having various data structures stored thereon. The components may communicate by way of local and or remote processes such as in accordance with a signal having one or more data packets such as data from one component interacting with another component in a local system distributed system and or across a network such as the Internet with other systems by way of the signal.

Moreover the term or is intended to mean an inclusive or rather than an exclusive or. That is unless specified otherwise or clear from the context the phrase X employs A or B is intended to mean any of the natural inclusive permutations. That is the phrase X employs A or B is satisfied by any of the following instances X employs A X employs B or X employs both A and B. In addition the articles a and an as used in this application and the appended claims should generally be construed to mean one or more unless specified otherwise or clear from the context to be directed to a singular form.

Certain aspects of the invention may be applicable to communications links deployed between electronic devices that may include subcomponents of an apparatus such as a telephone a mobile computing device an appliance automobile electronics avionics systems etc. depicts a simplified example of an apparatus that employs a communication link between IC devices. The apparatus may include a communications transceiver operably coupled to a processing circuit . In one example the apparatus may include a wireless communication device that communicates through an RF transceiver with a radio access network RAN a core access network the Internet and or another network. The processing circuit may include an application specific IC ASIC and or one or more other IC devices. The ASIC may include one or more processing devices logic circuits and so on. The processing circuit may include and or be coupled to processor readable storage such as a memory that may maintain instructions that may be executed by a processor of the processing circuit and data which may be manipulated by the processing circuit . Certain functions of the processing circuit may be controlled by one or more of an operating system and an application programming interface API layer that supports and enables execution of software modules residing in storage media such as the memory device . The memory device may include read only memory ROM or random access memory RAM electrically erasable programmable ROM EEPROM flash cards or any memory device that can be used in processing systems and computing platforms. The processing circuit may include or access a local database that can maintain operational parameters and other information used to configure and operate the apparatus . The local database may be implemented using one or more of a database module flash memory magnetic media EEPROM optical media tape soft or hard disk or the like. The processing circuit may also be operably coupled to external devices such as an antenna a display operator controls such as a keypad a button rocker or slider switch and or other components.

The communication link may include multiple channels links and . One or more channel may be bidirectional and may operate in a half duplex mode and or in a full duplex mode. One or more channel and may be unidirectional. The communication link may be asymmetrical providing higher bandwidth in one direction. In one example a first communications channel may be referred to as a forward link while a second communications channel may be referred to as a reverse link . The first IC device may be designated as a host system or a transmitter while the second IC device may be designated as a client system or a receiver even if both IC devices and are configured to transmit and receive on the communications link . In one example the forward link may operate at a higher data rate when communicating data from a first IC device to a second IC device while the reverse link may operate at a lower data rate when communicating data from the second IC device to the first IC device .

The IC devices and may each include a processor which may be provided on a processing circuit computing circuit or other device. In one example the first IC device may be adapted to perform core functions of the apparatus including maintaining wireless communications through a wireless transceiver and an antenna while the second IC device may be configured to support a user interface that manages or operates a display controller and may control operations of a camera or video input device using a camera controller . Other features supported by one or more of the IC devices and may include a keyboard a voice recognition component global positioning systems biometric recognition systems motion sensors and other input or output devices. The display controller may include circuits and software drivers that support displays such as a liquid crystal display LCD panel touch screen display indicators and so on. The storage media and may include transitory and or non transitory storage devices adapted to maintain instructions and data used by respective processors and and or other components of the IC devices and . Communication between each processor and its corresponding storage media and and other modules and circuits may be facilitated by one or more bus and respectively.

Reverse link may be operated in the same manner as the forward link and the forward link and reverse link may be capable of transmitting at comparable speeds or at different speeds where speed may be expressed as a data rate or data transfer rate and or a transmitter clocking rate. The forward and reverse data rates may be substantially the same or may differ by orders of magnitude depending on the application. In some applications a single bidirectional link may support communications between the first IC device and the second IC device . The forward link and or reverse link may be configurable to operate in a bidirectional mode when for example the forward and reverse links and share the same physical connections and operate in a half duplex manner. In one example the communication link may be operated to communicate data control command and other information between the first IC device and the second IC device in accordance with an industry or other standard.

Industry standards may be application specific. In one example the MIPI standard defines physical layer interfaces including a synchronous interface specification D PHY between an application processor IC device and an IC device that supports the camera or display in a mobile device. The D PHY specification governs the operational characteristics of products that comply with MIPI specifications for mobile devices. A D PHY interface may support data transfers using a flexible low cost high speed serial interface that interconnects between the IC devices and within a mobile device. These interfaces may include complimentary metal oxide semiconductor CMOS parallel busses providing relatively low bit rates with slow edges to avoid electromagnetic interference EMI issues.

The communication link of may be implemented as a wired bus that includes a plurality of signal wires denoted as M wires . The M wires may be configured to carry N phase encoded data in a high speed digital interface such as in a display interface. The M wires may facilitate N phase polarity encoding on one or more of the channels and . The physical layer drivers and may be configured or adapted to generate N phase polarity encoded data symbols for transmission on the communication link and or to decode N phase polarity encoded data symbols received from the communication link . The use of N phase polarity encoding provides high speed data transfer and may consume half or less of the power of other interfaces because fewer drivers are active in N phase polarity encoded data links channels within the communication link .

N phase polarity encoding devices within the physical layer drivers and or can typically encode multiple bits per transition on the communication link . In one example a combination of 3 phase encoding and polarity encoding may be used to support a wide video graphics array WVGA 80 frames per second LCD driver IC without a frame buffer delivering pixel data at 810 Mbps for display refresh.

Signaling states defined for each of the M wires in an M wire N phase polarity encoding scheme may include an undriven state a positively driven state and a negatively driven state. In the 3 wire 3 phase polarity encoding scheme the positively driven state and the negatively driven state may be obtained by providing a voltage differential between two of the signal wires and or and or by driving a current through two of the signal wires and or connected in series such that the current flows in different directions in the two signal wires and or . The undriven state may be realized by placing an output of a driver of a signal wire or in a high impedance mode. Alternatively or additionally an undriven state may be obtained on a signal wire or by passively or actively causing an undriven signal wire or to assume a voltage level that lies substantially halfway between positive and negative voltage levels provided on driven signal wires and or . Typically no significant current flows through an undriven signal wire or . Signaling states defined for a 3 wire 3 phase polarity encoding scheme may be denoted using the three signaling states 1 0 1 which may represent voltage or current states. In one example the three states 1 0 1 may signify the three voltage levels V 0 V. In another example the three states 1 0 1 may signify the three voltage levels V V 2 0. In another example the three states 1 0 1 may signify currents of I 0 I.

A 3 wire 3 phase polarity encoder may employ a set of drivers to control the signaling state of connectors and . The drivers may be implemented as unit level current mode or voltage mode drivers. Each driver may receive a set of signals or that determines the signaling state of corresponding connector or . In the example depicted each of the drivers receives a pair of signals or that defines four states for the corresponding connector or . In another example each driver may receive a set of three signals defining 8 states for the corresponding connector or

For each transmitted symbol interval in an M wire N phase polarity encoding scheme at least one signal wire or is in the undriven state 0 signaling state while the number of positively driven 1 signaling state signal wires or is equal to the number of negatively driven 1 signaling state signal wires or such that the sum of current flowing to the receiver is zero. At each symbol transition between the previously transmitted symbol and a next transmitted symbol the state of at least one signal wire or changes. When the signaling state of at least one signal wire and or changed between each pair of consecutive symbols a receiver can reliably generate a receive clock based on the transitions.

In operation a mapper may receive and map input data to a set of symbols . In the depicted 3 wire 3 phase example the set of symbols includes seven 3 bit symbols such that a 16 bit word of the input data may be encoded in each set of symbols. Each bit of a 3 bit symbol defines the state of one of the signal wires and for one symbol interval. The sequence of symbols may be serialized using parallel to serial converters that provide a timed sequence of symbols each symbol defining the signaling state of the 3 wires and . The sequence of symbols is typically timed using a transmission clock to delineate symbol intervals whereby a single symbol is transmitted in each symbol interval. An M wire phase encoder receives the sequence of 7 symbols produced by the mapper one symbol at a time and computes the state of each signal wire and for each symbol interval. The 3 wire encoder selects the states of the signal wires and based on the current input symbol and the previous states of signal wires and

The use of M wire N phase encoding permits a number of bits to be encoded in a plurality of symbols. A non integer number of data bits may be encoded in each symbol. In the example of a 3 wire 3 phase system there are 3 available combinations of 2 wires that may be driven simultaneously and 2 possible combinations of polarity on the pair of wires that is driven yielding 6 possible states. The signaling state of the signal wires and changes at each transition between symbols and accordingly 5 of the 6 states are available at every transition. In other words the state of at least one wire changes at each transition to permit a receiver to generate a reliable receive clock and given a current signaling state there are five possible signaling states available at each transition. With 5 states log 5 2.32 bits may be encoded per symbol. Accordingly a mapper may accept a 16 bit word and convert it to 7 symbols because 7 symbols carrying 2.32 bits per symbol can encode 16.24 bits. In other words a combination of seven symbols that encode five states has 5 78 125 permutations. Accordingly the 7 symbols may be used to encode the 2 65 536 permutations of 16 bits.

Information may be encoded in the direction of rotation at each phase transition and the 3 phase signal may change direction for each signaling state. Direction of rotation may be determined by considering which wires and or are in the 0 state e.g. the undriven state before and after a phase transition because the undriven wire and or changes at every signaling state in a rotating three phase signal regardless of the direction of rotation.

The encoding scheme may also encode information in the polarity i.e. polarity of state of the two of the conductors and that are actively driven. At any time in a 3 wire implementation exactly two of the conductors are driven with currents in opposite directions and or with a voltage differential. In a simple implementation data may be encoded using two bit values where one bit is encoded in the direction of phase transitions and the second bit is encoded in the polarity for the current state .

The timing chart illustrates data encoding using both phase rotation direction and polarity. The curves and relate to signals carried on three wires and respectively for multiple phase states. Initially the phase transitions are in a clockwise direction and the most significant bit is set to binary 1 until the rotation of phase transitions switches at a time to a counterclockwise direction as represented by a binary 0 of the most significant bit. The least significant bit reflects the polarity i.e. polarity of state of the signal in each state.

According to certain aspects disclosed herein one bit of data may be encoded in the rotation or phase change in a 3 wire 3 phase encoding system and an additional bit may be encoded in the polarity of the two driven wires. Additional information may be encoded in each transition of a 3 wire 3 phase encoding system by allowing transition to any of the possible states from a current state. Given 3 rotational phases and two polarities for each phase 6 states are available in a 3 wire 3 phase encoding system. Accordingly 5 states are available for transition from any current state. Accordingly there may be log 5 2.32 bits encoded per symbol transition which allows the mapper to accept a 16 bit word and encode it in 7 symbols.

N Phase data transfer may use more than three wires provided in a communication medium such as a bus. The use of additional signal wires that can be driven simultaneously provides more combinations of states and polarities and allows more bits of data to be encoded at each transition between states. This can significantly improve throughput of the system and reduce the power consumption over approaches that use multiple differential pairs to transmit data bits while providing increased bandwidth.

In one example an encoder may transmit symbols using 6 wires with 2 pairs of wires driven for each state. The 6 wires may be labeled A through F such that in one state wires A and F are driven positive wires B and E negative and C and D are undriven or carry no current . For six wires there may be 

Of the 4 wires driven the possible combinations of two wires driven positive and the other two must be negative . The combinations of polarity may include 

Accordingly the total number of different states may be calculated as 15 6 90. To guarantee a transition between symbols 89 states are available from any current state and the number of bits that may be encoded in each symbol may be calculated as log 89 6.47 bits per symbol. In this example a 32 bit word can be encoded by the mapper into 5 symbols given that 5 6.47 32.35 bits.

The general equation for the number of combinations of wires that can be driven for a bus of any size as a function of the number of wires in the bus and number of wires simultaneously driven 

In operation the wire state decoder may extract a sequence of symbols from signals received on wires and . The symbols are decoded based on signaling states that may be represented as a combination of phase rotation and polarity of the signals received on wires and as disclosed herein. The wire state decoder may include a CDR which extracts a clock that can be used to reliably capture symbols from the wires and . The CDR may be configured to generate the clock based on the occurrence of a transition on least one of the wires and at each boundary between consecutive symbol intervals. An edge of the clock may be delayed to allow time for all wires and to have stabilized and to thereby ensure that the current symbol is captured for decoding purposes.

The delay used by the CDR may be configured to allow a period of time sufficient to mask the effect of multiple edges generated at different times by the differential receivers . These multiple edges can arise when certain state transitions cause different differential receivers to produce edges that may be separated in time with respect to one another. The CDR may include a delay element that delays response to a first occurring edge at a symbol boundary until a time when all possible edges would have occurred. Variations in the performance of components of the CDR may be expected to affect the delays between multiple edges and these variations in performance of the CDR may be accommodated by configuring a delay for the CDR that accounts for worst case conditions. The variations in performance may be caused by changes in power voltage and thermal PVT conditions for example. The increased delay may limit the maximum clock speed usable in the communications link. If the configured delay is too short then multiple clock pulses may be created for a single symbol which may cause loss of synchronization between transmitter and receiver. If the delay is too long symbol times may overlap thereby causing the clock recovery circuit to malfunction or to generate a single pulse for two symbol intervals.

Certain signaling state transitions may be detectable by a single differential receiver or while other signaling state transitions may be detected by two or more of the differential receivers and . In one example the signaling states or relative states of two wires may be unchanged after a transition and the output of a corresponding differential receiver or may also be unchanged after the symbol transition. In another example both wires in a pair of wires A B B C and or C A may be in the same state in a first time interval and both wires may be in a same second state in a second time interval such that the corresponding differential receiver or may be unchanged after the phase transition. Accordingly a clock generation circuit may include signaling state change detect circuits and logic that monitor the outputs of all differential receivers and in order to determine when a signaling state transition has occurred The clock generation circuit may generate a receive clock based on detected signaling state transitions.

Changes in signaling states may be detected at different times on different wires and or . The timing of detection of signaling state changes may vary according to the type of signaling state change that has occurred. The result of this variability is illustrated in the simplified timing chart diagram shown in . Markers and representing the outputs of the signaling state change detection circuit and or differential receivers and are assigned different heights for clarity of illustration only. The relative heights of markers and have no specific relationship to voltage or current levels polarity or weighting values used for clock generation or data decoding. The timing chart illustrates the effect of timing of transitions associated with symbols transmitted on the three wires and . In the timing chart transitions between some symbols may result in variable capture windows and or collectively the symbol capture windows during which symbols may be reliably captured. The number of signaling state changes detected and their relative timing can result in jitter on the clock signal .

Variability in the sizes of the symbol windows and jitter may be caused in part by the electrical characteristics of the wires and as illustrated in the simple example depicted in . Transition times may be affected by variability in signal rise times and or variability in detection circuits caused by manufacturing process tolerances variations and stability of voltage and current sources and operating temperature. Large variability in transition times can be attributed to the existence of different voltage or current levels in 3 phase signaling. A simplified voltage level example is depicted in which illustrates transition times in a single wire or . A first symbol Sym may be transmitted in a symbol interval that ends at time a second symbol Sym may be transmitted in a symbol interval that ends at time and a third symbol Sym may be transmitted in a symbol interval that ends at time when transmission of a fourth symbol Sym begins. The transition from a state determined by the first symbol to the state corresponding to the second symbol may be detected after a first delay attributable to the time taken for voltage in the wire or to reach a threshold voltage and or . The threshold voltages may be used to determine the state of the wire or . The transition from a state determined by the second symbol to the state for the third symbol may be detected after a second delay attributable to the time taken for voltage in the wire or to reach one of the threshold voltages and or . The transition from a state determined by the third symbol to the state for the fourth symbol may be detected after a third delay attributable to the time taken for voltage in the wire or to reach a threshold voltage and or .

As depicted the third delay may be shorter than the first delay and the second delay may be the longest delay. The second delay may be the longest delay because state 0 is an undriven state and the voltage in the wire or may drift slowly towards the threshold whereas the first delay and the second delay are associated with transitions in which the wire or is actively pulled to the 1 and 1 states respectively.

The maximum speed of the communication link configured for N Phase encoding may be limited by the duration of the signal transition region compared to the received signal eye opening . The minimum period for the symbol interval may be constrained by tightened design margins associated with the CDR circuit in the N Phase decoder illustrated in or in the clock generation circuit of for example. Different signaling state transitions may be associated with different variations in signal transition times corresponding to two or more wires and or thereby causing the outputs of the differential receivers and in the receiving device to change at different times with respect to the symbol boundary where the inputs to the differential receivers and begin to change. The large difference in received signal transition times between the outputs of multiple differential receivers and in the receiving device typically requires the implementation of a delay element in the CDR circuit that has a minimum delay that exceeds the transition region time . In one example a delay element may be provided in one or more of the state change detect circuit and or the clock generation circuit shown in . The maximum delay time provided by this delay element may not exceed the closing edge of the eye opening which may be coincident with the commencement of the beginning of the next symbol interval at time in some instances. At faster data rates the eye opening can become small in comparison to the symbol interval and the effect of symbol transition variability may be determinative of the maximum symbol transmission rate.

The duration of any single transition is unlikely to span the full range of the signal transition region t since it is unlikely that a minimum possible signal transition time and a maximum possible transition time occurs during a single symbol transition. In one example the signal transition region may be bounded by the time of the first zero crossing detected at the output of a differential receiver or and the time of the last zero crossing detected at the output of a differential receiver or for all possible symbol transitions. The transition times observed at the outputs of the differential receiver and correspond to the times taken for the connectors and or wires or to reach a next state after the input to a driver of the connector and or wire or . The longest possible transition time may be determined based on the characteristics of the connector and or wire or and the type of state transition involved. In one example the longest possible transition time may be determined by the rise or fall time of a signal. Rise and fall times may be determined by the nature and voltage levels of the original and or the final states. Typically the longest possible transition time corresponds to a transition between an actively driven state and an undriven state.

A high value of tfor the transition region can result in increased design difficulty associated with the CDR circuit or clock generation circuit . For example clock generation circuit may employ a delay element or timer that is triggered by the first zero crossing of the three differential receiver outputs and . The state of the outputs of all three differential receivers and may not be safely sampled until all of the differential receivers and have reached their final state which may be defined by the eye opening . Accordingly the delay element or timer may be triggered at the start or estimated start of the transition region and ideally the timer expires shortly after the end of the transition region at which time clock generation circuit may output a clock edge that is used to sample the outputs of the three differential receivers and

In some systems delay elements in the CDR circuit can be afflicted by variations in manufacturing process circuit supply voltage and die temperature PVT variation and may generate delays that vary significantly. In such systems the nominal operating condition of the CDR circuit is generally set by design to generate a clock edge somewhere in the middle of the eye opening in order to ensure that a clock edge occurs after the end of the transition region and prior to the commencement of the transition region to the next symbol even under worst case PVT effects. Difficulty can arise in designing a CDR circuit that guarantees a clock edge within the eye opening when the transition region is large compared to the eye opening . For example a typical delay element may produce a delay value that changes by a factor of 2 over all PVT conditions and the eye opening must be larger than the transition region in order that a non adjustable delay value can be chosen. According to certain aspects described herein a dynamically configured delay may account for operational variations in the performance of the delay circuit.

The timing charts and illustrate the outputs AB BC CA of the differential receivers and that are representative of the differences between pairs of the signal wires and coupled to the inputs of the differential receivers and . The timing charts and cover a time period before and after the signal transitions shown in the set of charts . The timing charts and relate to a transition from symbol x to symbol x in which signal A transitions from a 1 state to a 1 state signal B transitions from a 1 state to a 1 state and signal C remains at a 0 state. Accordingly the AB differential receiver may measure a 2 difference before the transition and a 2 difference after the transition the BC differential receiver may measure a 1 difference before the transition and a 1 difference after the transition and the CA differential receiver may measure a 1 difference before the transition and a 1 difference after the transition . In this example both transitions and have zero crossings close in time attributable to the final states being driven states.

The timing charts and relate to a transition from symbol x to symbol y in which signal A transitions from a 1 state to a 0 state signal B transitions from a 1 state to a 1 state and signal C transitions from a 0 state to a 1 state. Accordingly the AB differential receiver may measure a 2 difference before the transition and a 1 difference after the transition the BC differential receiver may measure a 1 difference before the transition and a 2 difference after the transition and the CA differential receiver may measure a 1 difference before the transition and a 1 difference after the transition effectively no transition . In this example the transitions and have zero crossings that are separated by a significant period of time. The difference may occur because the BC transition involves two signals that have a final driven state while the AB transition relates to one signal that has a final undriven state.

The timing charts and relate to a transition from symbol x to symbol z in which signal A transitions from a 1 state to a 1 state signal B transitions from a 1 state to a 0 state and signal C transitions from a 0 state to a 1 state. Accordingly the AB differential receiver may measure a 2 difference before the transition and a 1 difference after the transition the BC differential receiver may measure a 1 difference before the transition and a 1 difference after the transition effectively no transition and the CA differential receiver may measure a 1 difference before the transition and a 2 difference after the transition . In this example the transitions CA transition and the AB transition have zero crossings that are separated by a significant period of time. The difference may be attributed to the CA transition involving signals A and C that both have a final driven state while the AB transition involves one signal the B signal that has a final undriven state.

The examples illustrated in describe alignment of transitions for the state transitions x to y and x to z . In these examples for each transition illustrated only one differential receiver or detects a zero crossing. The timing charts and illustrate the differences between signal wires and signals A B and C respectively measurable at the differential receivers and before and after the signal transitions shown in the set of charts . The timing charts and relate to a transition from symbol x to symbol y in which signal A transitions from a 1 state to an undriven 0 state signal B transitions from a 1 state to an 0 undriven state and signal C transitions from an undriven 0 state to a 1 state. Accordingly only the CA differential receiver observes a zero crossing at the transition.

The timing charts and relate to a transition from symbol x to symbol z in which signal A remains at a 1 state signal B remains at a 1 state and signal C transitions from a 0 state to a 1 state. Accordingly only the BC differential receiver observes a zero crossing at the transition.

Variability in the rise and fall times of signals on a multi wire interface and differences in performance of receivers monitoring the signals may result in a transition region see during which multiple detections of the symbol transition may be produced. A CDR circuit see may be configured to delay generation of a sample clock until after all possible transition detections have occurred. In one example the CDR circuit may initiate a delay after the first detection of a symbol transition and may ignore or suppress further transitions during the delay period. The duration of the delay period can impact the maximum symbol transmission rate and can degrade performance if the delay period is unnecessarily long. According to certain aspects described herein a training sequence or preamble may be provided that allows the delay period to be calibrated to an observed transition region . That is the preamble may be used to determine the maximum variability between transition detections for various signaling state changes on different combinations of wires. A delay period calculated based the maximum variability of transition timing may be used to produce an optimal clock mask that can be used to suppress additional transitions occurring in the transition region . A preamble may be transmitted before each data transmission to enable dynamic recalibration of the clock mask thereby accounting for variations caused by changes in PVT conditions during normal operation.

With reference also to and in accordance with certain aspects disclosed herein a transmission on the M wire N phase communications interface may include a preamble which generates a sequence of transitions where each transition is detectable by only a single differential receiver or . The receiver may use this preamble to determine the period of the transmission clock and the receiver may optimize the delay used by a CDR based on measurements of transition detection times using the preamble. The transmission clock and delay may then be used to decode the synchronization word and or data in one or more packets .

In the example of a 3 wire 3 phase communication interface the signaling state of the three wires and may be controlled by a preamble transmitted on the three wires and . The preamble may include the calibration sequence x y z x y z x . . . and or its counter rotating version x z y x z y x . . . . The timing chart illustrates the sequence x y z x y z x . . . showing the outputs and of the differential receivers and as well as a calibration clock generated from the preamble .

The calibration sequence in the preamble may be statically or dynamically defined. In one example the transmitter and receiver may be precoded or preconfigured with a preamble that includes a series of transitions that generate one only one zero crossing in the differential receivers and . In another example a preamble may include a programmable sequence that can be specified by a receiver and or transmitter and communicated using a separate control interface. The preamble pattern can be selected according to application needs.

In the illustrated 3 wire 3 phase example a state machine controls the operation of the calibration circuit . Another type of controller or processing circuit may be used as desired or indicated by the application including for example a processing circuit that employs a sequencer an embedded processor a digital signal processor and or some other processing device. Signals representative of the electrical condition of the transmission lines are received at the inputs and and the signals are provided to the differential receivers which provide outputs that may represent the results of comparisons of all combinations of pairs of the inputs and . Exclusive OR gates XORs and compare the output of each of the differential receivers with a delayed version of the output the respective differential receiver . The delayed version may be produced using delay elements and . The outputs of the XORs and provide pulsed signals where the width of the pulses have a duration or width corresponding to the delay introduced by the respective delay elements and . An OR gate combines the outputs of the XORs and to generate the calibration clock signal which includes all pulses corresponding to transitions detected for any pair of inputs .

The calibration clock signal is provided to a programmable delay element that includes a clocked delay line and a multiplexer . The time taken for a pulse on the calibration clock signal to pass through the delay element is determined by the value of the select input provided by the state machine . Each pulse on the calibration clock signal activates the set input of a flip flop that may be implemented using a D register . The D register is reset when a first pulse in a delayed version of the calibration clock signal exits the delay element . In the example the multiplexer selects one of n progressively delayed outputs delay taps of the delay line as an output of the delay element . The tap is selected by an input value controlled by the state machine .

The state machine may be configured to determine a suitable delay value by conducting a search based on a successive approximation algorithm a linear search algorithm or another suitable search algorithm. The state machine may be configured to find the delay tap that approximates a delay interval corresponding to one symbol period which may be expressed as the transmission clock frequency. A clock generator circuit see may use this same delay interval to control the frequency of the receive clock and to determine when data is to be sampled. In one example the clock generator circuit may determine a sample point by subtracting an amount of delay from the symbol time so that the delay is safely contained within one symbol period.

A clock mask can be produced based on the receive clock period and a sampling delay where the clock mask ensures data is sampled when signals at the input of the decoder have stabilized. Stability of the input signals can be assured regardless of PVT variations by calibrating the clock generator circuit for every transmission. In this manner limitations on maximum speed of the circuit attributable to PVT variations of the clock mask delay can be alleviated.

In one example the state machine may set the multiplexer select input to a relatively large value to detect the first pulse indicating a transition. In one example the multiplexer select input may be set to a value lying in the middle of the range of possible values. For each subsequent pulse the state machine may reduce or increase the multiplexer select input value until the period of the transmission clock is determined. The state machine may increase or decrease the select input by an increment that is halved for each subsequent change in the select input value. The period of the transmission clock may be determined when the first pulse associated with a transition exits the delay element after the last pulse associated with the same transition for every transition.

In practice a pulse exiting the delay element clears the D register while a pulse in a delayed version of the calibration clock signal sets the D register . The state machine monitors the output of the D register and may increase or back off the delay value as needed to obtain an optimized delay value. The state machine also monitors and responds to pulses in the calibration clock signal indicating a transition detected on a pair of the inputs . In one example the state machine is clocked by the calibration clock signal . The state machine may be further adapted or configured to enable measurement of the transmission clock from the preamble .

In the illustrated example the processing circuit may be implemented with a bus architecture represented generally by the bus . The bus may include any number of interconnecting buses and bridges depending on the specific application of the processing circuit and the overall design constraints. The bus links together various circuits including the one or more processors and storage . Storage may include memory devices and mass storage devices and may be referred to herein as computer readable media. The bus may also link various other circuits such as timing sources timers peripherals voltage regulators and power management circuits. A bus interface may provide an interface between the bus and a transceiver . The transceiver provides a means for communicating with various other apparatus over a transmission medium. Depending upon the nature of the apparatus a user interface e.g. keypad display speaker microphone joystick may also be provided and may be communicatively coupled to the bus directly or through a bus interface .

A processor may be responsible for managing the bus and for general processing that may include the execution of software stored in a computer readable medium that may include the storage . In this respect the processing circuit including the processor may be used to implement any of the methods functions and techniques disclosed herein. The storage may be used for storing data that is manipulated by the processor when executing software and the software may be configured to implement any one of the methods disclosed herein.

One or more processors in the processing circuit may execute software. Software shall be construed broadly to mean instructions instruction sets code code segments program code programs subprograms software modules applications software applications software packages routines subroutines objects executables threads of execution procedures functions algorithms etc. whether referred to as software firmware middleware microcode hardware description language or otherwise. The software may reside in computer readable form in the storage or in an external computer readable medium. The computer readable medium and or storage may be a non transitory computer readable medium. A non transitory computer readable medium includes by way of example a magnetic storage device e.g. hard disk floppy disk magnetic strip an optical disk e.g. a compact disc CD or a digital versatile disc DVD a smart card a flash memory device e.g. a flash drive a card a stick or a key drive a random access memory RAM a read only memory ROM a programmable ROM PROM an erasable PROM EPROM an electrically erasable PROM EEPROM a register a removable disk and any other suitable medium for storing software and or instructions that may be accessed and read by a computer. The computer readable medium and or storage may also include by way of example a carrier wave a transmission line and any other suitable medium for transmitting software and or instructions that may be accessed and read by a computer. Computer readable medium and or the storage may reside in the processing circuit in the processor external to the processing circuit or be distributed across multiple entities including the processing circuit . The computer readable medium and or storage may be embodied in a computer program product. By way of example a computer program product may include a computer readable medium in packaging materials. Those skilled in the art will recognize how best to implement the described functionality presented throughout this disclosure depending on the particular application and the overall design constraints imposed on the overall system.

The storage may maintain software maintained and or organized in loadable code segments modules applications programs etc. which may be referred to herein as software modules . Each of the software modules may include instructions and data that when installed or loaded on the processing circuit and executed by the one or more processors contribute to a run time image that controls the operation of the one or more processors . When executed certain instructions may cause the processing circuit to perform functions in accordance with certain methods algorithms and processes described herein.

Some of the software modules may be loaded during initialization of the processing circuit and these software modules may configure the processing circuit to enable performance of the various functions disclosed herein. For example some software modules may configure internal devices and or logic circuits of the processor and may manage access to external devices such as the transceiver the bus interface the user interface timers mathematical coprocessors and so on. The software modules may include a control program and or an operating system that interacts with interrupt handlers and device drivers and that controls access to various resources provided by the processing circuit . The resources may include memory processing time access to the transceiver the user interface and so on.

One or more processors of the processing circuit may be multifunctional whereby some of the software modules are loaded and configured to perform different functions or different instances of the same function. The one or more processors may additionally be adapted to manage background tasks initiated in response to inputs from the user interface the transceiver and device drivers for example. To support the performance of multiple functions the one or more processors may be configured to provide a multitasking environment whereby each of a plurality of functions is implemented as a set of tasks serviced by the one or more processors as needed or desired. In one example the multitasking environment may be implemented using a timesharing program that passes control of a processor between different tasks whereby each task returns control of the one or more processors to the timesharing program upon completion of any outstanding operations and or in response to an input such as an interrupt. When a task has control of the one or more processors the processing circuit is effectively specialized for the purposes addressed by the function associated with the controlling task. The timesharing program may include an operating system a main loop that transfers control on a round robin basis a function that allocates control of the one or more processors in accordance with a prioritization of the functions and or an interrupt driven main loop that responds to external events by providing control of the one or more processors to a handling function.

At step a receive clock may be derived from the series of transitions. The receive clock may be derived using a CDR for example.

At step a transition region may be determined based on the series of transitions. The transition region may correspond to a period of time during which the signaling states of the wires of the multi wire communications interface are changing or unstable.

At step a delay period corresponding to a duration of the transition region may be calibrated. The delay period may be calibrated by estimating differences in timing between transitions in the series of transitions and calculating the delay period based on a maximum one of the differences in timing. The differences in timing between transitions in the series of transitions may be estimated relative to the receive clock. The delay period may be calibrated using a successive approximation algorithm or a linear search algorithm.

At step data symbols may be received from the multi wire communications interface after termination of the preamble. The data symbols may be received using a version of the receive clock that is modified based on the delay period. The data symbols may be received by capturing the signaling state of the wires of the multi wire communications interface in the CDR or using a clock produced by the CDR. The data symbols may be received by detecting a first detected transition corresponding to a boundary between a first data symbol and a second data symbol and ignoring other transition detections for a period of time defined by the delay period. The other transition detections may correspond to the boundary between the first data symbol and the second data symbol. A data symbol may be captured after expiration of the delay period.

In one example the preamble is based on a gray code. The preamble may include a sequence of symbols identified in control information communicated between a transmitting device and a receiving device coupled to the multi wire communications interface.

The processor is responsible for general processing including the execution of software stored on the computer readable storage medium . The software when executed by the processor causes the processing circuit to perform the various functions described supra for any particular apparatus. The software when executed by the processor may cause the processing circuit to control logic and devices that are adapted to perform one or more of the various functions described supra. The computer readable storage medium may also be used for storing data that is manipulated by the processor when executing software. The processing circuit further includes at least one of the modules and . The modules and may be software modules running in the processor resident stored in the computer readable storage medium one or more hardware modules coupled to the processor or some combination thereof. The modules and may include microcontroller instructions state machine configuration parameters or some combination thereof.

In one configuration the apparatus processing circuit for wireless communication includes modules and or circuits configured to detect a series of transitions in signaling state of three or more wires of a multi wire communications interface a module and or circuit that is configured to derive a receive clock from the series of transitions modules and or circuits configured to determine a transition region based on the series of transitions a module and or circuit that is configured to calibrate a delay period corresponding to a duration of the transition region and modules and or circuits configured to receive and or decode data symbols from the multi wire communications interface after termination of the preamble.

The aforementioned means may be implemented for example using some combination of a processor or physical layer drivers or and storage media and .

It is understood that the specific order or hierarchy of steps in the processes disclosed is an illustration of exemplary approaches. Based upon design preferences it is understood that the specific order or hierarchy of steps in the processes may be rearranged. The accompanying method claims present elements of the various steps in a sample order and are not meant to be limited to the specific order or hierarchy presented.

The previous description is provided to enable any person skilled in the art to practice the various aspects described herein. Various modifications to these aspects will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other aspects. Thus the claims are not intended to be limited to the aspects shown herein but is to be accorded the full scope consistent with the language claims wherein reference to an element in the singular is not intended to mean one and only one unless specifically so stated but rather one or more. Unless specifically stated otherwise the term some refers to one or more. All structural and functional equivalents to the elements of the various aspects described throughout this disclosure that are known or later come to be known to those of ordinary skill in the art are expressly incorporated herein by reference and are intended to be encompassed by the claims. Moreover nothing disclosed herein is intended to be dedicated to the public regardless of whether such disclosure is explicitly recited in the claims. No claim element is to be construed as a means plus function unless the element is expressly recited using the phrase means for. 

