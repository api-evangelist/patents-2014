---

title: Methods and systems for transmitting data packets
abstract: The present invention discloses a method carried out by a first communications device for determining performance of a plurality of connections and selecting at least one first connection from the plurality of connections substantially based on performance. Data packets are then transmitted through the at least one first connection. The plurality of connections are aggregated to form an aggregated connection. The determining of performance is performed by transmitting evaluation packets through the plurality of connections. The evaluation packets are based on data packets that are received by the first communication device but have not yet been transmitted through the aggregated connection. The data packets may be designated for a host or node reachable through the aggregated connection. Alternatively, the evaluation packets may be based on predefined information when there are no data packets to be transmitted through the aggregated connection. The performance may be determined periodically.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09602412&OS=09602412&RS=09602412
owner: PISMO LABS TECHNOLOGY LIMITED
number: 09602412
owner_city: Hong Kong
owner_country: HK
publication_date: 20140714
---
The present invention relates in general to the field of computer networks. More particularly the present invention relates to methods and systems for determining performance of a plurality of connections periodically by transmitting evaluation packets through the plurality of connections. One or more connections are selected for transmitting data packets based on at least in part the performance. Data packets are transmitted through at least one of the one or more connections.

A multi Wide Area Network WAN communications device is able to transmit data packets using one or more of its WAN interfaces. The communications device also supports aggregating the bandwidth of multiple WAN interfaces. The communications device also supports end to end connections such as virtual private network VPN connection and session based site to site VPN connection and tunneling. In some implementations each TCP IP session is routed to only one WAN. In this configuration a single TCP file transfer session may only utilize the bandwidth of one WAN connection on each end. For example in a session based site to site virtual private network VPN connection VPN traffic is routed to multiple WAN connections between two sites e.g. sites A and B .

In one implementation M N tunnels are initially formed between the WAN connections where M and N are the number of WAN network connections of site A and site B respectively. Application TCP IP sessions are then routed over the different tunnels. It is notable however that while a session based site to site VPN is able to utilize different tunnels for different sessions a single download session in this type of connection is only able to utilize one tunnel.

When a communications device transmits data packets the communications device needs to select the most suitable WAN network interface access connection logical connection or end to end connection to transmit data packets. However it takes time to identify which of the WAN network interfaces access connection logical connections or end to end connections is the most suitable. The most suitable WAN network interface access connection logical connection or end to end connection to transmit data packets should be the one that may transmit data packets the quickest or according to a set of performance criteria. Furthermore when a communications device establishes a plurality of end to end connections belonging to an aggregated end to end connection it is important to choose the end to end connections with best performance to transmit data packets so that the overall performance of the aggregate end to end connection is satisfactory and is not affected negatively by transmitting data packets through established end to end connections that have poor performance.

However it is well known that performance of end to end connections may vary from time to time. Therefore it is desirable that the performance of the end to end connections is re determined periodically in order to check which end to end connection s have the best performance at a given time. It is also important that the performance of the established end to end connections is re determined using data packets containing same information so that a fair comparison may be made between the established end to end connections based on their performances.

The present invention discloses a method carried out by a first communications device for determining performance of a plurality of connections and selecting at least one first connection from the plurality of connections substantially based on performance. Data packets are then transmitted through the at least one first connection. The plurality of connections may be aggregated to form an aggregated connection. The determining of performance is performed by transmitting evaluation packets through the plurality of connections. The evaluation packets are based on data packets that are received by the first communication device but have not yet been transmitted through the aggregated connection. The data packets may be designated for a host or node reachable through the aggregated connection. Alternatively the evaluation packets may be based on predefined information when there are no data packets to be transmitted through the aggregated connection. The determining of performance may be performed periodically. Data packets may be transmitted using load balancing when there is more than one first connection.

According to one of the embodiments of the present invention each connection of the at least one first connection is classified into at least two groups. At least one of the at least two groups is preferred for transmitting a first type of data packets whereas another at least one of the at least two groups is preferred for transmitting a second type of data packets.

According to one of the embodiments of the present invention the evaluation packets have the same or substantially the same size. The evaluation packets may also have the same or substantially the same information.

According to one of the embodiments of the present invention the performance is substantially based on latency. The at least one first connection is further based on corresponding latency requirement of the data packets. The corresponding latency requirement of the data packets may be determined according to the contents of the data packets. In one variant when the latency of a connection is determined to be higher than about 1000 milliseconds the connection is not selected as one of the at least one first connection. When the latency of a second connection is more than about 800 milliseconds the second connection is not used for data packets containing near real time video data or near real time voice communication. When the latency of a third connection is more than about 500 milliseconds the third connection is not used for near real time voice communication. The second connection and the third connection are comprised in the at least one first connection.

The present invention further discloses a method for transmitting data packets at a first communications device through an aggregated connection by first determining latency of a plurality of connections comprised in the aggregated connection. The difference in latency of the plurality of connections is determined and it is determined whether the difference in latency is higher than a latency discrepancy threshold. If the difference in latency is higher than the latency discrepancy threshold at least one first connection with highest latency is not used for transmitting data packets. At least one second connection with comparatively low latency is used to transmit data packets instead. The plurality of connections is consisted of the at least one first connection and or the at least one second connection. In one variant the at least one first connection is established using third generation of mobile telecommunications technology 3G and the at least one second connection is established using fourth generation of mobile telecommunications technology 4G or wired Ethernet. In one variant when the aggregated connection only comprises at least one first connection established using 3G the at least one first connection is used for transmitting data packets.

The ensuing description provides preferred exemplary embodiment s and exemplary embodiments only and is not intended to limit the scope applicability or configuration of the invention. Rather the ensuing description of the preferred exemplary embodiment s and exemplary embodiments will provide those skilled in the art with an enabling description for implementing a preferred exemplary embodiment of the invention. It is understood that various changes may be made in the function and arrangement of elements without departing from the spirit and scope of the invention as set forth in the appended claims.

Also it is noted that the embodiments may be described as a process which is depicted as a flowchart a flow diagram a data flow diagram a structure diagram or a block diagram. Although a flowchart may describe the operations as a sequential process many of the operations can be performed in parallel or concurrently. In addition the order of the operations may be rearranged. A process is terminated when its operations are completed but could have additional steps not included in the figure. A process may correspond to a method a function a procedure a subroutine a subprogram etc. When a process corresponds to a function its termination corresponds to a return of the function to the calling function or the main function.

Embodiments or portions thereof may be embodied in program instructions operable upon a processing unit for performing functions and operations as described herein. The program instructions making up the various embodiments may be stored in a storage medium such as a secondary storage.

Moreover as disclosed herein the term secondary storage and main memory may represent one or more devices for storing data including read only memory ROM random access memory RAM magnetic RAM core memory magnetic disk storage mediums optical storage mediums flash memory devices and or other machine readable mediums for storing information. The term machine readable medium includes but is not limited to portable or fixed storage devices optical storage devices wireless channels and various other mediums capable of storing containing or carrying instruction s and or data.

Furthermore embodiments may be implemented by hardware software firmware middleware microcode hardware description languages or any combination thereof. When implemented in software firmware middleware or microcode the program instructions or code segments to perform the necessary tasks may be stored in a machine readable medium such as storage medium. A processing unit s may perform the necessary tasks. A processing unit s can be a CPU an ASIC semiconductor chip a semiconductor chip a logical unit a digital processor an analog processor a FPGA or any processor that is capable of performing logical and arithmetic functions. A code segment may represent a procedure a function a subprogram a program a routine a subroutine a module a software package a class or any combination of instructions data structures or program statements. A code segment may represent a procedure a function a subprogram a program a routine a subroutine a module a software package a class or any combination of instructions data structures or program statements. A code segment may be coupled to another code segment or a hardware circuit by passing and or receiving information data arguments parameters or memory contents. Information arguments parameters data etc. may be passed forwarded or transmitted via any suitable means including memory sharing message passing token passing network transmission etc.

A network interface may be implemented by a standalone electronic component or may be integrated with other electronic components. A network interface may have no network connection or at least one network connection depending on the configuration. A network interface is only connected to one accessible network. Therefore there may be more than one network connection being carried by one accessible network. A network interface may be an Ethernet interface a frame relay interface a fibre optic interface a cable interface a DSL interface a token ring interface a serial bus interface a universal serial bus USB interface Firewire interface Peripheral Component Interconnect PCI interface etc.

Embodiments or portions thereof may be embodied in a computer data signal which may be in any suitable form for communication over a transmission medium such that it is readable for execution by a functional device e.g. processing unit for performing the operations described herein. The computer data signal may include any binary digital electronic signal that can propagate over a transmission medium such as electronic network channels optical fibers air electromagnetic media radio frequency RF links and the like and thus the data signal may be in the form of an electrical signal optical signal radio frequency or other wireless communication signal etc. The code segments may in certain embodiments be downloaded via computer networks such as the Internet an intranet LAN MAN WAN the PSTN a satellite communication system a cable transmission system and or the like.

An access connection may carry one or more protocol data including but not limited to Transmission Control Protocol TCP User Datagram Protocol UDP Internet Control Message Protocol ICMP Hypertext Transfer Protocol HTTP Post Office Protocol POP3 File Transfer Protocol FTP and Internet Message Access Protocol IMAP . An access connection may be a wired network or a wireless network. A wired access connection may be implemented using Ethernet fiber optic cable DSL frame relay token ring serial bus USB Firewire PCI T or any material that can pass information. A wireless access connection may be implemented using infra red HighSpeed Packet Access HSPA HSPA Third Generation of mobile telecommunications technology 3G Fourth Generation of mobile telecommunications technology 4G Long Term Evolution LTE WiMax ATM GPRS EDGE GSM CDMA WiFi CDMA2000 WCDMA TD SCDMA BLUETOOTH WiBRO or any other wireless technologies.

A logical connection can be made at either Layer 2 or Layer 3 of the Open Systems Interconnection OSI model that connects two endpoints over a public private or hybrid public and private network to form a connection. Virtual private network VPN is one example of logical connection models. A VPN can be a Layer 2 VPN or Layer 3 VPN. A logical connection can also be established using connection oriented communication protocol such as transmission control protocol TCP . A logical connection may be referred as an end to end connection as it forms a connection between two endpoints.

Site and communications device may comprise M connections and site and communications device may comprise N connections . Connections and are access connections for communicating information within network between sites and . In the illustrated embodiment M is equal to 3 and N is equal to 2 however these values may vary according to desired devices and configurations. Connections and may have similar or differing bandwidth capabilities. Further connections and may comprise different types of WAN connections such as a WiFi cable DSL T 3G 4G LTE satellite connections and the like. It is also noted that site and site may be thought of as both a sender or receiver and discussions regarding the functionality of either site may be implemented on the other site. In other words system may be implemented as a symmetrical network.

Communications devices and have a plurality of network interfaces according to one of the embodiments. Communications device establishes logical connections A B and C via one or more of its plurality of network interfaces with one or more network interfaces of communications device .

One or more network interfaces are connected to corresponding access connections. Communications device uses one or more access connections to connect to one or more public networks and or private networks as illustrated in . In one variant one or more connections may be established using an access connection to connect communications device with another network node such as communications device or network host as illustrated in and .

For illustration purpose evaluation packets and are transmitted through the first second and third connections at t or substantially the same time respectively in order to determine performance of the first second and third connections. At about t communications device has already transmitted evaluation packets and through the first connection and the second connection respectively and has received the acknowledgement from communications device . However communications device has not completed the transmitting of evaluation packet . The difference in the amount of time required to transmit evaluation packets may be due to myriad reasons including network performance of a connection. Also at about t processing unit has determined the first connection has the best network performance after it has completely transmitted evaluation packet . It is well known to those skilled in the arts that there are myriad ways to determine network performance based on evaluation packets. For clarification the present invention is not restricted to have processing unit to make the network performance decision at about the same time after completely transmitting evaluation packet . Performance may be determined based on transmission of the evaluation packets and the receipt of the acknowledgement. Performance may further be determined based on receipt of data packets from communications device .

Once processing unit has determined that the first connection has the best performance processing unit selects the first connection to transmit data packets . Data packets contain data represented by data . Data may belong to one data stream a plurality of data streams or data belonging to no stream. The length of data may vary. Data packets may have different sizes and may comprise one or more data packets. For example data packets may be Internet Protocol IP packets.

In another illustration at about t processing unit re starts the process to determine performance of the first second and third connections again. At about t processing unit has determined that the second connection has the best performance and as a result selecting the second connection to transmit data packets .

In one variant evaluation packets and are transmitted in order to select a network interface for transmitting data packets. For example the plurality of network interfaces comprises a first second and third network interface. Evaluation packets are transmitted through the first second and third network interfaces for determining which network interface is associated with a connection with the best performance. For illustration purpose when the first network interface is determined to be associated with the connection with the best performance data packets are transmitted through the connection s associated with the first network interface. The connections may be access connections or logical connections.

According to one of the embodiments of the present invention evaluation packets that are transmitted at about the same time contain the same or substantially the same information. For example evaluation packets and contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Evaluation packets and are all transmitted in order to determine performance of the connections.

When using the same or substantially the same information processing unit does not need to generate different information for the evaluation packets. This may reduce the amount of computing resources required. In addition the performance of the connections can be compared more accurately as the length and contents of the evaluation packets are the same or substantially the same.

In one variant the same or substantially the same information belongs to the same data session. For illustration purpose data contained in evaluation packets and data contained in data packets data contained in evaluation packets and data contained in data packets and data contained in evaluation packets and belong to the same data session. Therefore the evaluation packets are data packets belonging to the data session. The benefit of using evaluation packets belonging to a data session to determine the performance is that the flow of data transmission is not disrupted interrupted or paused significantly when evaluation packets are transmitted. This is important because performance could be evaluated or determined periodically and frequently and not just at the beginning of the data session. When there is a current data session and there are data packets to be transmitted it is preferred to use the data packets as evaluation packets i.e. evaluate performance of connections based on the transmission of data packets.

In another illustration a video stream is being transmitted through communications device to communications device using TCP. Data of evaluation packets and encapsulates data of a first frame of the video. Data of data packets encapsulates data of a second frame of the video. Data of evaluation packets and are a third frame of the video. Data of data packet encapsulates data of a fourth frame of the video. Data of evaluation packets and encapsulates data of a fifth frame of the video. When performance is being determined through the evaluation packets data of the video stream is still being transmitted. In addition the video is still being transmitted from communications device to communications device without interruption even when different connections are selected from t to t i.e. when the first connections is selected at about t and the second connection is selected at about t .

Another benefit of using evaluation packets belonging to a data session is that real time data is used to determine performance. This makes the performance determination more accurate and relevant.

In one variant evaluation packets and contain information that is predefined. Although using evaluation packets containing predefined information to determine the performance during a data session may disrupt the flow of data session the performance determined may be used to compare against historical performance determined. When there is no current data session or the current data session has no data to be transmitted evaluation packets containing predefined data is more appropriate to be used to determine performance. For example in evaluation packets and contain predefined information. The predefined information in evaluation packets and should be the same in order to have an accurate performance comparison for the first second and third connections. Similarly the predefined information in evaluation packets and should be the same and the predefined information in evaluation packets and should also be the same. Therefore in the time periods t to t t to t and t to t the data session is disrupted interrupted or paused for transmitting the evaluation packets. In one variant the predefined information in evaluation packets and is the same. For illustration purpose when evaluation packets contain predefined information the interval at which they are transmitted may be in the range of 5 seconds to 15 minutes. Preferably the time period t to t may be in the range of 5 seconds to 15 minutes.

According to one of the embodiments of the present invention data packets may be regarded as evaluation packets such that data packets may also be used to determine performance of connections. For example at about t processing unit determines the performance of the first connection based on the successful transmission of data contained in data packets and data contained in evaluation packets . Processing unit determines the performance of the second connection and the third connection using based on the successful transmission of only data contained in evaluation packets and respectively because no data packets were transmitted through the second and third connection.

According to one of the embodiments of the present invention size of each evaluation packet may be configured by the user or administrator. In some scenarios some carriers may give higher priority to packets of smaller size such that packets of smaller size may be transmitted earlier than packets of larger size. As smaller size packets may be transmitted sooner it may be beneficial to configure the size of the evaluation packets to be smaller. Therefore the evaluated latency may be closer to the theoretical latency of the connection. If the size of only evaluation packets and not all data packets is configured to be small the latency evaluated may be much lower than the real latency to be experienced when transmitting data packets. Thus the latency evaluated may not accurately represent the performance of the connection. To avoid this size of all data packets and evaluation packets may be configured to be small.

Alternatively the size of the evaluation packets and data packets may be configured to be larger. The total overhead may be reduced when the size of each packet is larger since there are lesser number of packets for a given amount of data. Furthermore the computing resources required for processing the packets may be reduced as the number of packets may be lesser.

According to one of the embodiments of the present invention evaluation packets have the same size or substantially the same size. For example evaluation packets and all are consisted of five packets as illustrated in . Evaluation packets is consisted of packets evaluation packets is consisted of packets and evaluation packets is consisted of packets . Packets and all have the same size. Similarly packets and all have the same size packets and all have the same size packets and all have the same size and packets and all have the same size. Therefore evaluation packets and all have the same size. Using the same size or substantially same size evaluation packets for evaluation allows processing unit to compare the performance of the connections more accurately. The contents of packets may be the same different or generated randomly. The contents of packets may also belong to the same data session similar to other embodiments discussed earlier.

When a connection gets disconnected or fails while data packets are being transmitted through it processing unit then transmits evaluation packets for determining performance of all three connections. For example the first connection fails at a time between t and t such as at t while data packets containing data are being transmitted through it. Then processing unit does not wait till t to transmit evaluation packets containing data through all three connections. Instead processing unit transmits evaluation packets through the first second and third connections at about t . Then the performance of the three connections may be determined and data packets containing data are transmitted through one of the three connections according to the performance determined.

Alternatively when the first connection fails processing unit transmits evaluation packets only through the second and third connections at t and determines the performance of the second and third connections. Then data packets are transmitted through either the second or the third connection according to the performance determined. Performance of the first connection is not determined because the first connection has already failed and may not be available for transmitting data packets immediately. This may also indicate that the first connection is less stable than others and therefore irregularities in data transmission may be avoided by not using the first connection.

Evaluation packets and are transmitted through the first second and third connections respectively contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . As described earlier contents of evaluation packets and may belong to a data session predefined or randomly generated. Also as described earlier size of evaluation packets and may be the same. The same also applies to evaluation packets and .

For illustration purpose data packets and containing data and data respectively belong to a first data session. Data packets and containing data and data respectively belong to a second data session. In one variant evaluation packets and belongs to either the first data session or the second data session. A user or administrator is able to select which data sessions to be used for evaluation packets. Alternatively contents of evaluation packets and do not belong to any data session and contain information that is predefined. In one variant when a user or administrator of the communications device such as communications device gives higher preference to a particular data session contents of evaluation packets and belong to the particular data session with higher preference. The user or administrator may have higher preference for the particular data session for various reasons. For example the user might want the information of the particular data session to be transmitted faster than the information of other data session s . For example the user gives higher preference to the first data session because the user wants the information of the first data session to be transmitted earlier than the information of the second data session. Evaluation packets and then belong to the first data session. When evaluation packets and carry information of the first data session more information belonging to the first data session is being transmitted compared to information belonging to the second data session within a given time period. Therefore it is more likely that information of the first data session is transmitted earlier than the information of the second data session according to the user s preference.

At about t evaluation packets and are transmitted through the first second and third connections respectively for determining performance of the connections. At about t processing unit determines that the first connection has the best performance. Therefore data packets belonging to the first data session are transmitted through the first connection at about t . At about t communications device can then start transmitting data packets belonging to the second data session. Therefore although there are two ongoing data sessions communications device only uses one connection at a given time for transmitting data packets. Evaluation packets and are transmitted through the first second and third connections respectively for determining performance of the connections at about t . At about t processing unit determines that the second connection has the best performance. Therefore data packets belonging to the first data session are transmitted through the second connection at about t . After data packets have been transmitted at about t processing unit transmits data packets belonging to the second data session and re evaluate the performance of the first second and third connections again at about t . Therefore evaluation packets consisting of evaluation packets and are transmitted through the first second and third connections respectively for determining their performance.

As illustrated in only one connection is used for transmitting data packets at a given time even when there are two data sessions. For clarification this invention also applies to three or more data sessions. One of the benefits of this is that if the connections are connected to or passing through the same network the bandwidth available for one connection may be more or less the same as the bandwidth available for all the connections. In addition using only one connection may reduce channel interference if the connections are wireless access connections. For example while transmitting data packets belonging to the first data session the first connection could have bandwidth capacity that is not interfered by the second and third wireless access connections. Furthermore the amount of processing power and computing resources required could be less when using one connection at a time compared to when using more than one connection at a time.

In one variant the first second and third connections are access connections such as wireless access connections using Wi Fi LTE and or 3G communications technologies. In one variant the first second and third connections are VPN tunnels between communications devices and .

Evaluation packets and are transmitted through the first second and third connections respectively and contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Contents of evaluation packets and may belong to a data session predefined or randomly generated. Also as described earlier size of evaluation packets and may be the same. The same also applies to evaluation packets and .

In transmission of data packets belonging to two data sessions is illustrated. Therefore data packets and containing data and data respectively belong to a first data session. Data packets and containing data and data respectively belong to a second data session. In one variant evaluation packets and belongs to either the first data session or the second data session. A user or administrator is able to select which data session the evaluation packets belong to. Alternatively evaluation packets and do not belong to any data session and contain information that is predefined.

At t evaluation packets and are transmitted through the first second and third connections respectively for determining the performance of the connections. At about t processing unit determines that the first connection has the best performance and the second connection has the second best performance. At about t data packets belonging to the first data session and data packets belonging to the second data session are transmitted through the first connection and the second connection respectively.

In one variant the user or administrator gives higher preference to the first data session. Therefore processing unit determines to transmit data packets belonging to the first data session through the first connection which has the best performance because the user wants the first data session to be faster and more reliable. Data packets belonging to the second data session are transmitted through the second connection which has the second best performance.

In one variant the user or administrator does not have any preference for a particular data session. Therefore the first and second connections are used by processing unit to transmit data packets belonging to the first or second data sessions randomly. Therefore as an alternative to the illustration in data packets may be transmitted through the first connection instead of the second connection and data packets may be transmitted through the second connection instead of the first connection.

At about t evaluation packets and are transmitted through the first second and third connection respectively for determining the performance of the connections again. At about t processing unit determines that the second and third connections have the best performances.

In one variant when the user or administrator gives higher preference to the first data session data packets belonging to the first data session are transmitted through the second connection because the second connection has the best performance and data packets belonging to the second data session are transmitted through the third connection.

Alternatively if the user or administrator does not have any preference for a particular data session the second and third connections are used to transmit data packets belonging to the first or second data sessions randomly. Therefore as an alternative to the illustration in data packets may be transmitted through the second connection instead of the third connection and data packets may be transmitted through the third connection instead of the second connection.

In one variant the user or administrator does not have any preference for a particular data session. A connection such as the second connection was determined to be one of the connections having the best performance after a preceding evaluation time period i.e. t to t . The second connection is again determined to be one of the connections having the best performance after the evaluation time period t to t . In this case it is preferred to not change the connection for a data session if possible. More precisely since the second connection was being used to transmit data packets belonging to the second data session from t until t the second connection is again used to transmit data packets belonging to the second data session from t until t . In this way the second data session will be smoother since the connection being used is not switched.

When two connections are used for transmitting data packets of two data sessions respectively data packets of both the first and data sessions may be transmitted simultaneously by using load balancing technology. Since the two data sessions may be concurrent it is likely that the transmission is complete faster compared to when only one connection is used for both data sessions especially when the two connections are not connected to or passing through the same network. However there may be some interference caused by the use of two connections at the same time. The processing power and resources required are also higher when the connections are balanced.

Comparing and illustrates the transmission of data packets belonging to one data session where only one connection is used at a given time. On the other hand illustrates the transmission of data packets belonging to two data sessions and only one connection is used at a given time. also illustrates the transmission of data packets belonging to two data sessions but unlike two connections are used at a given time for transmitting data packets belonging to the two data sessions respectively.

In one variant after evaluation packets and are transmitted processing unit may have decided that all three connections have satisfied performance requirements and therefore may transmit data packets and through all three connections.

The first second third fourth and fifth connections are classified into two groups. The first second and third connections belong to a first group and the fourth and fifth connections belong to a second group. Processing unit selects one connection from each group for transmitting data packets. Therefore processing unit determines performance of the first group of connections and selects one of the connections in the first group for transmitting data packets based on the performance. Similarly processing unit determines performance of the second group of connections and selects one of the connections in the second group for transmitting data packets based on the performance. Performance of the first and second group of connections may be determined simultaneously or almost simultaneously.

The connections are classified by processing unit into more than one group based on which specific types of data packets they are suitable for transmitting. Alternatively the connections may be classified into groups according to a policy for management purposes according to historical performance evaluation or any other reason for which having different groups of connections would be desirable. The user or administrator may choose more than one connection from each group for transmitting data packets. They can also choose not to use any connections from some groups for transmitting data packets. Therefore the scope of the invention is not limited to using one connection from each group for transmitting data packets.

Evaluation packets and transmitted through the first second and third connections respectively contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Evaluation packets and transmitted through the fourth and fifth connections respectively contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Evaluation packets and are transmitted for determining the performance of the first group of connections. Evaluation packets and are transmitted for determining the performance of the second group of connections. As described earlier contents of evaluation packets and may belong to a data session may be predefined or may be randomly generated. Also as described earlier size of evaluation packets and may be the same. The same also applies to evaluation packets and .

Evaluation packets and are transmitted through the first second and third connections respectively at about t . Performance of the first group of connections is determined by transmitting evaluation packets through all three connections of the first group. Processing unit determines that performance of the first connection is the best among the first group of connections. Therefore at about t processing unit determines to transmit data packets containing data through the first connection. Similarly at about t performance of the second group of connections is determined by transmitting evaluation packets and through the fourth and fifth connections respectively. At about t processing unit determines that the fifth connection has the best performance among the second group of connections. Therefore processing unit determines to transmit data packets containing data at about t through the fifth connection.

Processing unit again determines the performance of the first group of connections by transmitting evaluation packets and through the first second and third connections respectively at about t . At about t processing unit determines that the second connection has the best performance. Therefore data packets containing data are transmitted through the second connection at about t . At the same time the performance of the second group of connections is determined by transmitting evaluation packets and through the fourth and fifth connections respectively at about t . Processing unit determines that the fourth connection has the best performance among the second group of connections at about t . Therefore data packets containing data are transmitted through the fourth connection at about t . At about t evaluation packets and are transmitted through the first second and third connections respectively and evaluation packets and are transmitted through the fourth and fifth connections respectively for determining the performance of the first and second group of connections respectively.

In one of the embodiments the plurality of network interfaces is classified into a first and a second group. Performance of connections connected to network interfaces in the first group is determined by transmitting evaluation packets and . Evaluation packets and are transmitted through connections connected to network interfaces in the first group. Performance of connections connected to network interfaces in the second group is determined by transmitting evaluation packets and . Evaluation packets and are transmitted through connections connected to network interfaces in the second group. One network interface is selected from each group for transmitting data packets according to the performance determined. Therefore the network interface connected to the connection with the best performance is selected from each group.

At a given time two connections are being used to transmit data packets at communications device . One of the two connections belongs to the first group and another one of the two connections belong to the second group. In one variant when the first second third fourth and fifth connections are logical connections the two connections used for transmitting data packets are bonded together to form an aggregated connection. Alternatively the two connections used for transmitting data packets are balanced. In one of the embodiments the connections are classified into groups by processing unit based on certain conditions. The conditions are stored in secondary storage . The conditions are selected from a group consisting of performance metric service provider usage metric location time usage price security user Internet Protocol address range communication protocol communication technology application and device. Connections may belong to a certain group if they satisfy conditions corresponding to the certain group. A connection may belong to more than one group.

In an example viewing in conjunction with there are two ongoing data sessions at communications device . A first data session between communications device and is a File Transfer Protocol FTP session and a second data session between communications device and is a video conferencing session. The FTP session uses the first group of connections comprising the first second and third connections and the video conferencing session uses the second group of connections comprising the fourth and fifth connections. Evaluation packets and have the same size. Evaluation packets and may or may not have the same information. Evaluation packets having the same size are used to determine and compare performance of the connections accurately. Evaluation packets and have the same size. The same applies to evaluation packets and . Data data and data are predefined data contained in evaluation packets and respectively. Data packets and containing data and data respectively are packets of a file belonging to the FTP session. Therefore while determining the performance of the connections the FTP session is interrupted momentarily and transmission of packets of the file resumes when the determining is complete. Data data data data and data are a first second third fourth and fifth frame of the video conferencing session. At a given time the connection s being used by the FTP session and the connection s being used by the video conferencing sessions are either balanced using load balancing technology or bonded to form an aggregated connection.

Comparing with both and illustrate the transmission of packets belonging to two data sessions. However in packets belonging to the two data sessions are transmitted through two connections classified into different groups. Evaluation packets transmitted through each group of connections may be different. At a given time two connections are used for transmitting data packets. On the other hand in only one connection is used for transmitting data packets at a given time and the connections are not classified into different groups.

Comparing and both and illustrate the transmission of packets belonging to two data sessions and two connections may be used at a given time in both and . The difference between and is the classification of connections into different groups in . Evaluation packets and transmitted through the first group of connections contain data belonging to the first data session and evaluation packets and transmitted through the second group of connections contain data belonging to the second data session in some scenarios illustrated by . However in scenarios illustrated in evaluation packets transmitted through all connections contain the same data. Whether the same data belongs to the first data session or the second data session does not depend on the group which the connections belong to. Therefore in the evaluation for the different groups of connections may be carried out in different processes.

Furthermore in data packets belonging to the first and second data session are transmitted through any two connections determined to have the best performance. Whereas in data packets belonging to the first data session is transmitted through the connection having the best performance among the first group of connections and data packets belonging to the second data session is transmitted through the connection having the best performance among the second group of connections.

The benefit of choosing one connection from each group as illustrated in may be that each group of connections may be optimal for transmitting a specific type of data packet. Since the first data session and the second data session may comprise data packets of different types it may be desirable to transmit data packets belonging to different data sessions through connections of different groups. However classifying the connections according to data type may consume high computing resources if there is a change in data types frequently.

In an alternative illustrates transmission of packets belonging to one data session. Therefore data packets and belong to the same data session. Evaluation packets and may also belong to the same data session as data packets and .

At a given time communications device uses two logical connections for transmitting data packets. The two logical connections are selected based on performance determined by processing unit . Performance of the five logical connections is determined by transmitting evaluation packets containing the same information through all five logical connections.

Evaluation packets and transmitted through the first second third fourth and fifth logical connections respectively contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Similarly evaluation packets and contain the same or substantially the same information data . Evaluation packets and are transmitted by processing unit for determining performance of the logical connections. As described earlier contents of evaluation packets and may belong to a data session predefined or randomly generated. Also as described earlier size of evaluation packets and may be the same. The same also applies to evaluation packets and .

Processing unit determines to transmit evaluation packets and through the first second third fourth and fifth logical connections respectively at about t . At about t processing unit determines performance of the five logical connections and selects the two logical connections with best performance namely the first and third logical connections for transmitting data packets. For example the third logical connection has the best performance and the first logical connection has the second best performance. Therefore data packets containing data and data packets containing data are transmitted through the first and third logical connection respectively at about t .

Processing unit re determines performance of the five logical connections by transmitting evaluation packets and through the first second third fourth and fifth logical connections at about t . The performance of the first logical connection continues to be one of the best among the five logical connections. Therefore data packets containing data are transmitted through the first logical connection at about t . At the same time data packets containing data are transmitted through the fourth logical connection because the fourth logical connection is determined to be another one of the logical connections having the best performance among the five logical connections. Evaluation packets are transmitted at about t for determining the performance of the five logical connections again.

In an example communications device transmits Voice over Internet Protocol VoIP packets belonging to a VoIP session through an aggregated connection to communications device . It would be known to those skilled in the art that latency of connections is preferred to be lower than about 500 milliseconds in order to achieve proper quality of the VoIP session. The aggregated connection comprising the first second third fourth and fifth logical connection which are VPN tunnels. Evaluation packets and have the same size and contain the same information data O. The same applies to evaluation packets and . Evaluation packets data packets data packets evaluation packets data packets data packets and evaluation packets are VoIP packets belonging to the VoIP session. Furthermore data data data data data data and data may be encapsulated in encapsulating packets that contain encryption information associated with the authentication required to connect to the VPN tunnels. Connections with a latency lower than about 500 milliseconds may be selected for transmitting VoIP packets.

In one of the embodiments evaluation packets and are transmitted through the plurality of network interfaces to determine performance of logical connections established through the plurality of network interfaces . One or more network interfaces connecting to the connections determined to have the best performance are selected for transmitting data packets. At least one logical connection established through the network interfaces selected is used to transmit data packets. For example a first network interface is determined to have the best performance. The first network interface is connected to a first and second logical connection. Processing unit determines to use at least one of the first and second logical connection to transmit data packets.

Comparing with both the figures illustrate transmission of packets belonging to one data session. The difference is that in two logical connections are used for transmitting data packets at a given time and in one connection is used for transmitting data packets at a given time. The benefit of the scenarios illustrated in is that higher bandwidth is available for the data session since more than one logical connection are used for transmitting data packets. In since data packets belonging to one data session are transmitted through more than one logical connection the logical connections are bonded to form an aggregated connection. In the connections may be logical connections or access connections. However in only logical connections are used and access connections cannot be used because access connections cannot be aggregated.

In an alternative illustrates transmission of packets belonging to two data sessions. Therefore data packets and may belong to different data sessions. Similarly data packets and may belong to different data sessions.

In and the reason why the performance of the connections is determined periodically for example once at t again at t and again at t is that the performance may change from time to time. In many scenarios the performance of connections especially those connecting to wireless networks is not stable and some connections have satisfactory performance at one time and unsatisfactory performance at another time. In a preferred embodiment when performance of the connections is determined the time period between determinations of the performance is within the range of five seconds to one minute. Performance is determined periodically every five seconds to one minute for adapting to changes in network environment because performance of connections may change every few seconds. Therefore the time period t to t and the time period t to t is in the range of five seconds to one minute. Alternatively when performance of the connections is determined in order to check for connection failure the time period allowed between evaluations of the performance is preferably within the range of half an hour to one hour. Therefore the time period t to t and the time period t to t is in the range of half an hour to one hour. The process is continued after t . and are just illustrations of how data packets are transmitted through each of the connections for determining performance of the connections periodically and selecting one of the connections for transmitting data packets based on the performance determined. After t processing unit chooses connection s for transmitting data packets based on the performance of the connections determined at about t . Hence it should be noted that the process does not end after t .

In another example in evaluation packets and belong to the same data session as data packets and . Therefore the evaluation packets and the data packets are transmitted in the data session and each of the packets has a sequence number so that communications device which is the receiving device can arrange them accordingly.

The evaluation packets and data packets are assigned with a corresponding sequence number. The sequence number is in the information contained in the evaluation packets. When evaluation packets and data packets are assigned with a corresponding sequence number the designated host or node arranges the packets arriving at the designated host or node according to their corresponding sequence numbers. When evaluation packets belonging to the a data session contain the same or substantially same information and arrive at a designated host or node the designated host or node is capable of recognizing that the evaluation packets contain the same or substantially same information based on at least in part the sequence number. The designated host or node may choose to ignore drop discard or process evaluation packets arriving after the first evaluation packets. They may choose to process it for statistical purposes such as monitoring performance and keeping records of the performance. The information is contained or encapsulated in the payload of the evaluation packets.

According to one of the embodiments evaluation packets for determining performance of the connections are transmitted through the connections for a first predefined time period. When a connection is selected for transmitting data packets based on its performance data packets are transmitted through the connections for a second predefined time period. For example viewing or the first predefined time period is equal to the time period between t and t t and t or t and t . In one variant time period between t and t is a little longer than time period between t and t or between t and t because initialization time of the connection is included in the time period between t and t . In one variant time periods t to t t to t and t to t are not the same but each of them are predefined. In one variant time period between t and t t and t and t and t are the same and are predefined. Similarly the second predefined time period is equal to the time period between t and t or t and t . In one variant time periods t to t and t to t are not the same but each of them are predefined. Alternatively time periods t to t and t to t are the same and are predefined. The respective predefined time periods may be set by a user manufacturer or administrator of communications device . In one variant the user sets the predefined time period through a web interface an application programming interface API a command line interface or a console. Processing unit retrieves the predefined time periods locally from secondary storage or remotely from a remote server.

In one of the embodiments frequency of determining performance of connections at a communications device such as communications device is low if the connections are stable. Therefore evaluation packets are transmitted less often. The time period for which data packets are transmitted continuously is significantly longer compared to when the connections are not stable. When the connections are stable a connection determined to have the best performance after an evaluation is more likely to continue having the best performance for a longer time. Alternatively when the connections are unstable a connection determined to have the best performance after an evaluation is less likely to continue having the best performance for a long time. It would be known to those skilled in the arts that the performance may change at any moment every 5 seconds. Therefore when the connections are stable determining performance of connections is performed less often and data packets are transmitted continuously for a longer time period. When the connections are unstable determining performance of connections is performed more often and data packets are transmitted continuously for a shorter time period. This is particularly important for wireless communications as the connections are more likely to be unstable in wireless communications.

In one of the embodiments evaluation packets are transmitted for a longer time period. For example the time period between t and t is long. The benefit of transmitting evaluation packets for a longer time period is that the evaluation of performance gives better results. This is because more number of evaluation packets may be transmitted in the time period and therefore the evaluation is more reliable. However transmitting evaluation packets for a longer time period causes communications device to use up more bandwidth for evaluation and since evaluation packets are transmitted through multiple connections the increase in bandwidth usage may be significant. In addition to that if the evaluation packets contain information that is predefined and does not belong to a data session the flow of data transmission will be disrupted interrupted or paused for a longer period of time and that may be undesirable. When there are two ongoing data sessions and evaluation packets belong to a first data sessions a second data session is disrupted for a longer time period which is not desirable in most scenarios. Alternatively evaluation packets are transmitted for a shorter time period. Therefore less bandwidth is consumed during evaluation of the performance of the connections. In one variant transmitting evaluation packets for a shorter time period is also desirable when evaluation packets contain information that is predefined and does not belong to a data session because the flow of data transmission is disrupted for a shorter period of time. However since less number of evaluation packets may be transmitted in a shorter time period the evaluation may not be reliable enough.

In one of the embodiments of the present invention when two or more logical connections are selected for transmitting data packets the two or more logical connections are bonded to form an aggregated connection. The two or more logical connections are bonded only if the packets transmitted through them belong to the same data session. The two or more logical connections are end to end connections that are formed between the same two nodes wherein communications device is one of the two nodes. To form an aggregated connection the data packets encapsulate packets before being transmitted through the two or more logical connections. The packets may originate from communications device and or from host s and or node s connecting to communications device . Using an aggregated connection is beneficial for having a higher overall bandwidth which is a combined bandwidth of the individual logical connections. The aggregated connection is perceived as one logical connection by sessions or applications that are using it. For example viewing in conjunction with in the time period t to t the first and third logical connections are being used to transmit data packets. Therefore the first and third logical connections are bonded together to form an aggregated connection. Similarly in the time period t to t the first and fourth logical connections are bonded and are comprised in the aggregated connection. The third logical connection may still be comprised in the aggregated connection but it is not used for transmitting data packets. Alternatively the third logical connection is removed from the aggregated connection when it is not being used to transmit data packets. This may apply to also where two connections selected for transmitting data packets at a given time are bonded together to form an aggregated connection.

Alternatively when two or more connections are selected for transmitting data packets the two or more connections are balanced. The two or more connections are balanced preferably when the data packets transmitted through them belong to different data sessions. The data packets are distributed among and transmitted through the two or more connections using load balancing technology or any other technology that allows data packets to be distributed and transmitted among multiple connections. For example viewing in conjunction with from t to t data packets are distributed among and transmitted through the first and third logical connections. Similarly from t to t data packets are distributed among and transmitted through the first and fourth logical connections. This may apply to also where data packets are distributed among and transmitted through the two connections belonging to two different groups and selected for transmitting data packets at a given time.

In the embodiments described herein performance of connections are determined according to at least one of the following criteria throughput error rates packet latency packet jitter symbol jitter quality of service security coverage area bandwidth bit error rate packet error rate frame error rate dropped packet rate queuing delay round trip time capacity signal level interference level bandwidth delay product handoff delay time signal to interface ratio and signal to noise ratio. For example when performance is determined according to the dropped packet rate the connection which has the least dropped packet rate is determined to have the best performance. In another example when performance is determined according to the throughput the connection with the highest throughput is determined to have the best performance. Performance may be determined according to more than one criterion.

In one variant a user or administrator may configure communications device to determine performance according to a certain criterion. If the user or administrator chooses bandwidth bandwidth of connections will be evaluated and connection s with highest bandwidth s will be selected for transmitting data. If the user or administrator chooses latency latency of connections will be evaluated and connection s with lowest latency will be selected for transmitting data.

In a preferred embodiment as illustrated in if the performance of the connection is worse than the threshold the connection is not terminated but further evaluation packets or data packets are not transmitted through the connection in step . If the performance of the connection is determined not to be worse than the threshold the connection is not terminated and further evaluation packets are sent through the connection as well in step . The benefit of performing step instead of step is that when a user or administrator wants to use the connection later on they would not need to establish the connection again. Establishing a connection may take some time and computing resources. Therefore the connection is not terminated and is just not allowed to be used to transmit further evaluation packets or data packets.

The threshold may be predefined and stored in a storage medium such as secondary storage or main memory . The threshold may be set by a user or administrator of communications device . The threshold may be part of settings required to establish the connection.

If the performance of a connection is worse than a threshold terminating a tunnel or not sending evaluation packets through the connection may be beneficial for saving bandwidth resources and other computing resources.

According to one of the embodiments of the present invention if the difference in latency between two or more connections in an aggregated connection is higher than a latency discrepancy threshold one or more connections with comparatively high latency is terminated or packets are not transmitted through the one or more connections. For illustration purposes the latency discrepancy threshold is about 500 milliseconds. The latency of a first connection is 400 milliseconds and the latency of a second connection is 950 milliseconds. Since the difference in latency between the first and second connection is higher than about 500 milliseconds the second connection is terminated or not used for transmitting data packets. In another illustration the latency of a first second and third connection is 400 950 and 980 milliseconds respectively and the latency discrepancy threshold is about 500 milliseconds. Since the differences in latency between the first connection and both the second and third connections is higher than about 500 milliseconds the second and third connections are no longer used for transmitting data and may be terminated. In another illustration when the latency of the first connection is approximately 10 milliseconds and the latency of the second connection is approximately 200 milliseconds the second connection is no longer used for transmitting data packets and may be terminated. When packets are being transmitted from communications device to communications device through an aggregated connection comprising the first connection and the second connection a first packet transmitted through the first connection may arrive much earlier than a second packet transmitted through the second connection. Even if a third packet and a fourth packet arrive early through the first connection communications device only acknowledges the arrival of the first packet and since the second packet has not arrived all three of the second third and fourth packet are transmitted again. Therefore resources may be saved by terminating the second connection or not using the second connection so that all four of the first second third and fourth packets are transmitted through the first connection and packets do not need to be retransmitted.

In one variant the second connection may be used for transmitting any packets other than data packets such as health check packets evaluation packets etc. If the latency of the second connection is later determined to become lower then the second connection may again be used for transmitting data packets. In order to monitor the latency of the second connection communications device does not terminate the second connection and continues sending evaluation packets through the second connection even after determining that the difference in latency is higher than the latency discrepancy threshold.

In one variant the latency discrepancy threshold is predefined and may be set by a user or administrator of communications device . Alternatively the latency discrepancy threshold may be set periodically by processing unit . Alternatively the latency discrepancy threshold may be set dynamically or automatically by processing unit based on at least in part the average latency of two or more connections in the aggregated connection. The average latency may be calculated based on latency values evaluated within a specific time period. The specific time period may be in the range of 10 milliseconds to 5 minutes. The latency discrepancy threshold may be set as percentage value of the average latency. For illustration purposes the latency discrepancy threshold may be set to 20 of the average latency of all connections of the aggregated connection. When latencies experienced by a first second and third connections are about 400 milliseconds 500 milliseconds and 900 milliseconds respectively the average latency is about 600 milliseconds. The latency discrepancy threshold may then be set dynamically to 20 of 600 milliseconds which is 120 milliseconds. Since the difference between the latency of the third connection and the average latency is more than 120 milliseconds processing unit may determine not to use the third connection for transmitting data packets. The percentage value may be configured by a user or administrator. In another illustration the latency discrepancy threshold may be set to 30 of the average latency of connections with comparatively low latencies and not all connections in the aggregated connection. When latencies experienced by a first second and third connections are about 400 milliseconds 500 milliseconds and 900 milliseconds respectively the average latency of connections with comparatively low latency is 450 milliseconds. The latency discrepancy threshold may be automatically set by processing unit to 30 of 450 milliseconds which is 135 milliseconds. Since the difference between the latency of the third connection and the average latency is more than 135 milliseconds processing unit may determine not to use the third connection for transmitting data packets. In another variant a user or administrator of communications device may define policies for dynamically setting the latency discrepancy threshold. For illustration a policy is defined such that if average latency of connections with comparatively low latency is less than 100 milliseconds the latency discrepancy threshold is dynamically set to 100 milliseconds. The policy may further be defined such that if the average latency of connections with comparatively low latency is between 100 to 500 milliseconds the latency discrepancy threshold is dynamically set to 400 milliseconds. It should be appreciated that these values are exemplary and there may be various other ways of dynamically setting the latency discrepancy threshold. Connections with comparatively low latencies may include any connections except the connection with the highest latency. Alternatively connections with comparatively low latencies may include any connections which have latencies within a certain range of the lowest latency.

When there are more than two connections the latency discrepancy threshold may be used in various ways. For illustration purposes there are five connections namely a first second third fourth and fifth connection. The fifth connection has the highest latency and the first connection has the lowest latency. If the difference between the highest latency i.e the fifth connection s latency and the lowest latency i.e. the first connection s latency is more than the latency discrepancy threshold the fifth connection is no longer used for transmitting data packets and may be terminated. In another illustration if the difference between the fifth connection s latency and the average latency of the first second third and fourth connections is higher than the latency discrepancy threshold the fifth connection is no longer used for transmitting data packets and may be terminated. In another illustration when the latency of each of the first second third and fourth connections is around 500 milliseconds the latency of the fifth connection is around 1000 milliseconds and the latency discrepancy threshold is 400 milliseconds the fifth connection is not used for transmitting data packets and may be terminated. In one illustration the average variance and standard deviation of latencies of the first second third fourth and fifth connections is calculated. The latency discrepancy threshold is set to be the standard deviation of the latencies. If the difference between latencies of the connections is higher than the standard deviation one or more connections with comparatively high latency is no longer used for transmitting data and may be terminated.

For illustration purpose when there are one or more connection established through an LTE network or Ethernet interface processing unit does not connect to a 3G network even when it is capable of doing so through one or more of network interfaces . It should be known to those skilled in the art that the latency of connections established through a 3G network may be significantly higher than that of connections established through LTE network or Ethernet interface.

The embodiments were chosen and described in order to best explain the principles of the invention and its practical applications to thereby enable others skilled in the art to best utilize the invention and various embodiments with various modifications as are suited to the particular use contemplated.

