---

title: Run-length detection and correction
abstract: System, methods and apparatus are described that facilitate transmission of data, particularly between two devices within electronic equipment. The apparatus may determine whether a run-length violation will occur or is likely to occur if a first sequence of symbols provided by a mapper of an M-Wire N-Phase encoder is transmitted on a plurality of wires. A second sequence of symbols may be substituted for the first sequence of symbols. The second sequence of symbols may comprise a surplus sequence of symbols that is not used for mapping data in the mapper.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09369237&OS=09369237&RS=09369237
owner: QUALCOMM Incorporated
number: 09369237
owner_city: San Diego
owner_country: US
publication_date: 20140806
---
This application claims priority to and the benefit of U.S. provisional patent application No. 61 863 686 filed on Aug. 8 2013 and U.S. provisional patent application No. 61 943 959 filed on Feb. 24 2014 the entire content of both applications being incorporated herein by reference.

The present disclosure relates generally to high speed data communications and more particularly to mappers and demappers used in multi wire multi phase polarity encoders and decoders.

High speed interfaces are frequently used between circuits and components of mobile wireless devices and other complex apparatus. For example certain devices may include processing communications storage and or display devices that interact with one another through communications links. Some of these devices including synchronous dynamic random access memory SDRAM may be capable of providing or consuming data and control information at processor clock rates. Other devices such as display controllers may require variable amounts of data at relatively low video refresh rates.

High speed communications links are often provisioned with multiple parallel connectors. Clock recovery circuits rely on rated or specified transition times for edges on the communications links and variable rise times can lead to inter symbol interference or tolerances values that limit speeds on the high speed communications links. Variability in rise times is affected by a variety of conditions including high run lengths when the state of a wire does not change allowing the voltage or current levels in the wire to increase beyond typical operating levels.

Systems methods and apparatus are disclosed herein that use an interface to a communications link having a number of connectors where the interface may be configured to avoid long run lengths. The communications link may be provided between two devices which may be collocated in an electronic apparatus.

In an aspect of the disclosure a data transfer method includes steps of determining that a run length violation will occur or is likely to occur if a first sequence of symbols provided by a mapper of an M Wire N Phase encoder is transmitted on a plurality of wires and substituting a second sequence of symbols for the first sequence of symbols. The second sequence of symbols may include a surplus sequence of symbols that is not used for mapping data in the mapper.

In an aspect of the disclosure an encoding scheme used by the encoder may define a set of available sequences of symbols. The mapper may be configured to use a subset of the set of available sequences of symbols to map the data. The surplus sequence of symbols may be excluded from membership of the subset of the set of available sequences of symbols.

In an aspect of the disclosure the second sequence of symbols may be substituted for the first sequence of symbols through the use of a table to select the second sequence of symbols based on the content of the first sequence of symbols. The second sequence of symbols may be substituted for the first sequence of symbols by generating a plurality of replacement sequences that are not in the subset of the set of available sequences of symbols and selecting as the second sequence of symbols one of the plurality of replacement sequences which is calculated to be unlikely to cause the run length violation. The second sequence of symbols may be substituted for the first sequence of symbols by generating a plurality of replacement sequences that are not in the subset of the set of available sequences of symbols and selecting as the second sequence of symbols one of the plurality of replacement sequences that is unlikely to cause the run length violation.

In an aspect of the disclosure the run length violation occurs if one or more of the plurality of wires fails to change state while a predefined number of symbols are sequentially transmitted on the plurality of wires. It may be determined that the run length violation will occur by identifying a combination and or sequence of symbols known to cause the run length violation. The combination of symbols may include a predefined number of symbols. It may be determined that the run length violation is likely to occur by identifying a portion of a combination of symbols known to cause the run length violation at the beginning or end of the first sequence of symbols.

In an aspect of the disclosure the second sequence of symbols is transmitted on the plurality of wires in place of the first sequence of symbols. Each of the first sequence of symbols and the second sequence of symbols may include seven symbols for example and 16 bits of data may be mapped to the first sequence of symbols. The symbols of the second sequence of symbols may be transmitted on the plurality of wires by transmitting a first symbol that causes a first wire and a second wire to be driven to signaling states that are different from one another. A third wire may be in a signaling state that is different from the signaling states of the first wire and the second wire. The signaling state of a wire may correspond to a voltage level.

In an aspect of the disclosure an apparatus includes means for determining that a run length violation will occur or is likely to occur if a first sequence of symbols provided by a mapper of an M Wire N Phase encoder is transmitted on a plurality of wires and means for substituting a second sequence of symbols for the first sequence of symbols. The second sequence of symbols may include a surplus sequence of symbols that are not used for mapping data in the mapper.

In an aspect of the disclosure the apparatus includes means for transmitting the second sequence of symbols on the plurality of wires in place of the first sequence of symbols.

In an aspect of the disclosure a non transitory processor readable storage medium has one or more instructions stored thereon which when executed by at least one processing circuit cause the at least one processing circuit to determine that a run length violation will occur or is likely to occur if a first sequence of symbols provided by a mapper of an M Wire N Phase encoder is transmitted on a plurality of wires and substitute a second sequence of symbols for the first sequence of symbols. The second sequence of symbols may include a surplus sequence of symbols that are not used for mapping data in the mapper.

In an aspect of the disclosure a driver circuit includes an encoder configured to generate a sequence of symbols from data to be transmitted on a communications link and a symbol sequence replacer configured to determine that a run length violation will occur or is likely to occur if a first sequence of symbols provided by a mapper of an M Wire N Phase encoder is transmitted on a plurality of wires and substitute a second sequence of symbols for the first sequence of symbols. The second sequence of symbols may include a surplus sequence of symbols that are not used for mapping data in the mapper. Each symbol may be characterized by a combination of a phase state and a polarity of a pair of connectors and a selection of at least one undriven connector.

In an aspect of the disclosure a data transfer method includes receiving a first set of symbols from a plurality of wires on a communications link at a demapper of an M Wire N Phase decoder identifying the first set of symbols as a substitute set of symbols and replacing the substitute set of symbols with a second set of symbols. The second set of symbols may correspond to symbols that would have caused or that would likely have caused a run length violation if transmitted on the plurality of wires. The first set of symbols may be identified as a substitute set of symbols when the first set of symbols is not defined for use in demapping symbols.

In an aspect of the disclosure the run length violation occurs when one or more of the plurality of wires fail to change state while a predefined number of symbols are sequentially transmitted on the plurality of wires. The run length violation is likely to occur if the second set of symbols includes a portion of a combination of symbols known to cause the run length violation at the beginning or end of the first set of symbols. Each of the first set of symbols and the second set of symbols may include seven symbols. The demapper may be configured to demap 16 bits of data from the second set of symbols.

In an aspect of the disclosure a decoding scheme used by the M Wire N Phase decoder defines a set of valid sequences of symbols. The demapper may be configured to use a subset of the set of valid sequences of symbols that does not include the first set of symbols.

In an aspect of the disclosure an apparatus includes means for receiving a first set of symbols from a plurality of wires on a communications link at a demapper of an M Wire N Phase decoder means for identifying the first set of symbols as a substitute set of symbols and means for replacing the substitute set of symbols with a second set of symbols. The second set of symbols may correspond to symbols that would have caused or that would likely have caused a run length violation if transmitted on the plurality of wires. The first set of symbols may be identified as a substitute set of symbols when the first set of symbols is not defined for use in demapping symbols.

In an aspect of the disclosure a non transitory processor readable storage medium has one or more instructions which when executed by at least one processing circuit cause the at least one processing circuit to receive a first set of symbols from a plurality of wires on a communications link at a demapper of an M Wire N Phase decoder identify the first set of symbols as a substitute set of symbols and replace the substitute set of symbols with a second set of symbols. The second set of symbols may correspond to symbols that would have caused or that would likely have caused a run length violation if transmitted on the plurality of wires. The first set of symbols may be identified as a substitute set of symbols when the first set of symbols is not defined for use in demapping symbols.

In an aspect of the disclosure a receiver for decoding M wire N phase polarity encoded symbols includes a symbol sequence replacer configured to receive a first set of symbols from a plurality of wires on a communications link at a demapper of an M Wire N Phase decoder identify the first set of symbols as a substitute set of symbols and replace the substitute set of symbols with a second set of symbols. The second set of symbols may correspond to symbols that would have caused or that would likely have caused a run length violation if transmitted on the plurality of wires. The first set of symbols may be identified as a substitute set of symbols when the first set of symbols is not defined for use in demapping symbols.

Various aspects are now described with reference to the drawings. In the following description for purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of one or more aspects. It may be evident however that such aspect s may be practiced without these specific details.

As used in this application the terms component module system and the like are intended to include a computer related entity such as but not limited to hardware firmware a combination of hardware and software software or software in execution. For example a component may be but is not limited to being a process running on a processor a processor an object an executable a thread of execution a program and or a computer. By way of illustration both an application running on a computing device and the computing device can be a component. One or more components can reside within a process and or thread of execution and a component may be localized on one computing device and or distributed between two or more computing devices. In addition these components can execute from various computer readable media having various data structures stored thereon. The components may communicate by way of local and or remote processes such as in accordance with a signal having one or more data packets such as data from one component interacting with another component in a local system distributed system and or across a network such as the Internet with other systems by way of the signal.

Moreover the term or is intended to mean an inclusive or rather than an exclusive or. That is unless specified otherwise or clear from the context the phrase X employs A or B is intended to mean any of the natural inclusive permutations. That is the phrase X employs A or B is satisfied by any of the following instances X employs A X employs B or X employs both A and B. In addition the articles a and an as used in this application and the appended claims should generally be construed to mean one or more unless specified otherwise or clear from the context to be directed to a singular form.

Certain disclosed examples relate to systems and apparatus that employ multi phase data encoding and decoding methods involving a plurality of conductors i.e. M conductors or wires . The M conductors typically include three or more conductors and each conductor may be referred to as a wire although the M conductors may include conductive traces on a circuit board or within a conductive layer of a semiconductor integrated circuit IC device. The M conductors may be divided into a plurality of transmission groups each group encoding a portion of a block of data to be transmitted. An N phase encoding scheme is defined in which bits of data may be encoded in transitions in signaling state of the M conductors including phase transitions and polarity changes on the M conductors. The signaling state of the M conductors may correspond to and or be defined by a sequence of symbols in which data is encoded. A transition in signaling state of at least one of the M conductors occurs at the symbol boundary between each pair of consecutive symbols. In one example an N phase encoding scheme for a 3 wire system may include three phase states and two polarities providing 6 states with 5 possible transitions from each state. Deterministic voltage and or current changes may be detected and decoded to extract data from the M conductors. Decoding need not rely on clock signals transmitted on independent conductors or pairs of conductors and timing information may be derived directly from phase and or polarity transitions in the M conductors. N Phase polarity encoding can be employed for data transfer in different types of interface including interfaces that use electrical optical and radio frequency RF signaling for example.

Certain aspects of the invention may be applicable to communications links deployed between electronic components which may include subcomponents of devices such as telephones mobile computing devices appliances automobile electronics avionics systems etc. Referring to for example an apparatus employing M wire N phase encoding may include a processing circuit that is configured to control operation of the apparatus . The processing circuit may access and execute software applications and control logic circuits and other devices within the apparatus . In one example the apparatus may include a wireless communication device that communicates through an RF communications transceiver with a radio access network RAN a core access network the Internet and or another network. The communications transceiver may be operably coupled to the processing circuit . The processing circuit may include one or more IC devices such as an application specific IC ASIC . The ASIC may include one or more processing devices logic circuits and so on. The processing circuit may include and or be coupled to processor readable storage that may maintain instructions and data that may be executed by a processing device in the processing circuit . The processing circuit may be controlled by an operating system and or an application programming interface API layer that supports and enables execution of software modules residing in the storage of the wireless device. The storage may include read only memory ROM random access memory RAM electrically erasable programmable read only memory EEPROM a flash memory device and or any other type of memory device that can be used in processing systems and computing platforms. The processing circuit may include and or access a local database that can maintain operational parameters and other information used to configure and operate the apparatus . The local database may be implemented using one or more of a database module or server flash memory magnetic media EEPROM optical media tape soft or hard disk or the like. The processing circuit may also be operably coupled to external devices such as an antenna a display operator controls such as a button and a keypad among other components.

The communications link may include multiple channels and . One or more channels may be bidirectional and may operate in half duplex and or full duplex modes. One or more channel and or may be unidirectional. The communications link may be asymmetrical providing higher bandwidth in one direction. In one example described herein a first communications channel may be referred to as a forward link while a second communications channel may be referred to as a reverse link . A first IC device or may be designated as a host master and or transmitter while the second IC device or may be designated as a client slave and or receiver even if both IC devices and are configured to transmit and receive on the communications link . In one example the forward link may operate at a higher data rate when communicating data from a first IC device to a second IC device while the reverse link may operate at a lower data rate when communicating data from the second IC device to the first IC device .

The IC devices and may each include a processor and or processing circuit . In one example the first IC device may perform core functions of the apparatus including maintaining wireless communications through a wireless transceiver and an antenna while the second IC device may support a user interface that manages or operates a display controller and may control operations of a camera or video input device using a camera controller . Other features supported by one or more of the IC devices and may include a keyboard a voice recognition component biometric readers or other input output devices. The display controller may include circuits and software drivers that support a display such as a liquid crystal display LCD panel a touch screen display an indicator and so on. The storage media and or may include transitory and or non transitory storage devices adapted to maintain instructions and data used by the respective processing circuits and and or other components of the IC devices and . Communication between each processing circuit and its corresponding storage media and and other modules and circuits may be facilitated by one or more buses and respectively.

The reverse link may be operated in the same manner as the forward link . The forward link and the reverse link may be capable of transmitting at comparable speeds or at different speeds where speed may be expressed as data transfer rate and or clocking rates. The forward and reverse data rates may be substantially the same or may differ by orders of magnitude depending on the application. In some applications a single bidirectional link may support communications between the first IC device and the second IC device . The forward link and or the reverse link may be configurable to operate in a bidirectional mode when for example the forward and reverse links and share the same physical connections and operate in a half duplex manner.

In certain examples the reverse link derives a clocking signal from the forward link for synchronization purposes for control purposes to facilitate power management and or for simplicity of design. The clocking signal may have a frequency that is obtained by dividing the frequency of a symbol clock used to transmit signals on the forward link . The symbol clock may be superimposed or otherwise encoded in symbols transmitted on the forward link . The use of a clocking signal that is a derivative of the symbol clock allows fast synchronization of transmitters and receivers which may be provided in the transceivers for example. The use of a clocking signal that is a derivative of the symbol clock may enable fast start and stop of data signals without the need for framing to enable training and synchronization.

In certain examples a single bidirectional link may support communications between a first processing device and a second processing device . In certain instances the first processing device and the second processing device provide encoding and decoding of data address and control signals transmitted between a processing device and memory devices such as dynamic random access memory DRAM .

In one example one or more of buses and or may provide access to double data rate DDR SDRAM using M wire N phase encoding technique. N phase polarity encoding physical layer devices and or can encode multiple bits per transition and multiple sets of wires can be used to transmit and receive data from the SDRAM control signals address signals and so on.

In another example the communication link includes a high speed digital interface such as a mobile display digital interface MDDI and one or more data links and may use N phase polarity encoding. The transceivers and may encode and decode data transmitted on the communications link . The use of N phase polarity encoding enables high speed data transfer that may consume half or less of the power of other interfaces because fewer drivers are active in the N phase polarity encoded data links . The N phase polarity encoding devices and or can encode multiple bits per transition on the interface which may include a bus. In one example a combination of 3 phase and polarity encoding may be used to support a wide video graphics array WVGA 80 frames per second LCD driver IC without a frame buffer delivering pixel data at 810 Mbps for display refresh.

When 3 phase polarity encoding is used connectors such as signal wires and on a 3 wire bus may be undriven driven positive or driven negative. An undriven signal wire or may be in a high impedance state. An undriven signal wire or may be driven or pulled to a voltage level that lies substantially halfway between the positive and negative voltage levels provided on driven signal wires. An undriven signal wire or may have substantially no current flowing through it. In the depicted transmitter a set of drivers may cause each signal wire and to be in one of three signaling states denoted as 1 1 and 0 states for every transmitted symbol. In each symbol interval during which a symbol is transmitted at least one signal is in the undriven 0 state while the number of signals driven positive 1 state is equal to the number of signals driven negative 1 state such that the sum of current flowing to the receiver is always zero.

Each pair of symbols in a sequence of symbols to be transmitted on the signal wires and may be encoded such that the signaling state of at least one signal wire or changes after the symbol boundary between the pair of consecutive symbols.

In one example the drivers may include unit level current mode drivers. In another example the drivers may include voltage mode drivers. In the latter example the drivers may be adapted or configured to drive two of the signal wires and or using opposite polarity voltages while the third signal wire or is at high impedance and or pulled to ground during each symbol interval.

In the depicted transmitter 16 bit data is input to a mapper which maps the input data to 7 symbols for transmitting sequentially over the signal wires and . The 7 symbols may be serialized using parallel to serial converters for example. An M wire N phase encoder receives the serialized symbols provided by the parallel to serial converters and computes the state of each signal wire and during a time period corresponding to each symbol transmission interval. The encoder selects the states of the signal wires and based on the input symbol and the previous states of signal wires and

The use of M wire N phase encoding permits a number of bits to be encoded in a plurality of symbols where the bits per symbol is not an integer. In the simple example of the 3 wire 3 phase system there are 3 available combinations of 2 wires that may be driven simultaneously and 2 possible combinations of polarity on the pair of simultaneously driven wires yielding 6 possible states. Since the signaling state of at least one signal wire and or changes between consecutive symbol intervals 5 of the 6 states are available at every symbol boundary. The availability of 5 states at each symbol boundary permits log 5 2.32 bits to be encoded per symbol. Accordingly a mapper may accept a 16 bit word and convert it to 7 symbols because 7 symbols carrying 2.32 bits per symbol can encode 16.24 bits. In other words a combination of seven symbols that encodes five states has 5 78 125 permutations. Accordingly the 7 symbols may be used to encode the 2 65 536 permutations of 16 bits.

At any phase state in the illustrated three wire example exactly two of the conductors carry a signal which is effectively a differential signal for that phase state while the third conductor or is undriven. The phase state for each conductor may be determined by voltage difference between the conductor or and at least one other conductor and or or by the direction of current flow or lack of current flow in the conductor or . As shown in the state transition diagram three phase states S Sand S are defined. A signal may flow clockwise from phase state Sto phase state S phase state Sto phase state S and or phase state Sto phase state Sand the signal may flow counter clockwise from phase state Sto phase state S phase state Sto phase state S and or phase state Sto phase state S. For other values of N transitions between the N states may optionally be defined according to a corresponding state diagram to obtain circular rotation between state transitions.

In the example of a three wire three phase communications link clockwise rotations Sto S Sto S and or Sto S at a state transition may be used to encode a logic 1 while counter clockwise rotations Sto S Sto S and or Sto S at the state transition may be used to encode a logic 0. Accordingly a bit may be encoded at each transition by controlling whether the signal is rotating clockwise or counter clockwise. For example a logic 1 may be encoded when the three wires transition from phase state Sto phase state Sand a logic 0 may be encoded when the three wires transition from phase state Sto phase state S. In the simple three wire example depicted direction of rotation may be easily determined based on which of the three wires is undriven before and after the transition.

Information may also be encoded in the polarity and or changes of polarity of the driven conductors or in the direction of current flow or changes in the direction of current flow between two conductors . Signals and illustrate voltage levels applied to conductors respectively at each phase state in a three wire three phase link. At any time a first conductor is coupled to a more positive voltage V for example a second conductor is coupled to a more negative voltage V for example while the third conductor may be open circuited. As such one polarity encoding state may be determined by the current flow between the first and second conductors or the voltage polarities of the first and second conductors . In some embodiments two bits of data may be encoded at each phase transition. A decoder may determine the direction of signal phase rotation to obtain the first bit. The second bit may be determined based on the polarity difference between two of the signals and . In some instances the second bit may be determined based on a change or lack of change in polarity of the differential signal transmitted on a pair of the conductors . The decoder having determined direction of rotation can determine the phase state and the polarity of the voltage applied between the two active connectors and or or the direction of current flow through the two active conductors and or

In the example of the three wire three phase link described herein one bit of data may be encoded in the rotation or phase change in the three wire three phase link and an additional bit may be encoded in the polarity or changes in polarity of two driven wires. Certain embodiments encode more than two bits in each transition of a three wire three phase encoding system by allowing transition to any of the possible states from a current state. Given three rotational phases and two polarities for each phase 6 states are defined such that 5 states are available from any current state. Accordingly there may be log 5 2.32 bits per symbol transition and the mapper may accept a 16 bit word and convert it to 7 symbols.

The differential receivers may compare the voltage between pairs of connectors and or in order to determine the signaling state of each connector or . A clock and data recovery CDR circuit may generate a symbol clock by detecting the occurrence of a transition in the output of at least one of the differential receivers . The CDR circuit may capture raw symbols representative of the signaling state of the connectors a b . Seven consecutive raw symbols may be assembled by serial to parallel convertors which produce sets of raw symbols to be processed by a demapper . The demapper may generate 16 bit data from each sequence of 7 raw symbols based on the value of each raw symbol and its immediate predecessor. The 16 bit data may be buffered in the FIFO which may be accessed by external devices to retrieve output 16 bit data words .

With reference also to Table 1 illustrates the operation of the differential receivers . In the example the wire states may be encoded in the voltage amplitude on the three wires and such that a 1 state of a wire is represented as a voltage V volts a 1 state of the wire is represented as 0volts and the undriven state is represented or approximated as V 2 volts. Table 1 illustrates the outputs of the differential receivers for each state in the 3 wire 3 Phase Polarity encoding system. A receiver decoder see may be configured to output a code at the digital output of the receiver decoder for each symbol decoded.

At the receiver N phase symbols are received and accumulated from the N wire bus typically over a plurality of transmission clock cycles. The accumulated symbols may then be decoded by a symbol to bits mapper . Transmit clocks may be derived from one or more portions of the N wire bus and configuration information may be communicated using a designated group of connectors that provide a primary channel. In the example of a 9 wire bus that is configured with three different 3 wire bus segments one bus segment may be identified as the primary channel with a default encoding scheme to be used during power up and synchronization. Commands communicated over the bus may cause the transmitter and receiver to enter a hibernate stage on one or more of the 3 wire segments.

N Phase data transfer may use more than three signal wires or other connectors in provided in a communication medium. The use of additional signal wires that can be driven simultaneously provides more combinations of states and polarities and allows more bits of data to be encoded at each transition between states. This can significantly improve throughput of the system while limiting power consumption as opposed to communications links that use multiple differential pairs to transmit data bits while providing increased bandwidth. Power consumption can be further limited by dynamically configuring the number of active connectors for each transmission.

Of the 4 wires driven the possible combinations of two wires driven positive and the other two must be negative . The combinations of polarity may include 

Accordingly the total number of different states may be calculated as 15 6 90. To guarantee a transition between successive symbols 89 states are available for transition from any current state and the number of bits that may be encoded in each symbol may be calculated as log 89 6.47 bits per symbol. In this example a 32 bit word can be encoded by the mapper into 5 symbols given that 5 6.47 32.35 bits.

The general equation for the number of combinations of wires that can be driven for a bus of any size as a function of the number of wires in the bus and number of wires simultaneously driven 

N Phase Polarity coding may be susceptible to certain issues attributable to run length violations which may arise when one or more wires remain in the same signaling state for an excessive number of successive symbols. In the example of a 3 Phase Polarity encoder conventional mapping and encoding can produce consecutive states on the trio of wires that cause one of the wires to remain in the same state for many consecutive symbols. When one of the three wires is held at a constant value for too long certain undesirable effects may result including increased inter symbol interference ISI . The number of consecutive states in which a wire has the same value voltage or current flow may be referred to as run length and a run length of N may describe a condition in which a wire remains in the same voltage or current state for N symbols. Prolonged run lengths may affect the switching time as capacitances accumulate charge and or as current builds in inductances. Increased switching times can lead to constraints on maximum symbol frequency because the time during which the wires of an N Phase communications link are stable and available for sampling is reduced.

At the receiver a symbol receiver decoder may include a set of differential receivers and a CDR which may cooperate to produce a receiver clock and to decode a sequence of seven raw 3 bit symbols based on the signaling states and transitions in signaling state of the three wires during the sequence of symbol transmission intervals . The receiver may include a serial to parallel convertor that converts the sequence of seven raw symbols to a set of 21 bits organized as seven 3 bit symbols. A module or circuit may be adapted or configured to receive the set of 21 bits and to produce a modified set of 21 bits after reversing symbol substitutions that may have been performed by the run length limiting module or circuit in the transmitter . A Demapper may then convert the 7 symbols in the modified set of 21 bits to a 16 bit word which may be provided as an output of the receiver .

Each symbol detected by the receiver can be represented using a 3 bit raw symbol value having one of five possible values 000 001 010 011 and 100. The value of the raw symbol value is defined by Same Phase delta Phase delta Polarity. Each of the three bits represents a change or no change from the previous wire state to the present wire state. This representation simplifies the detection of symbol sequences that produce run lengths greater than a maximum number of symbols because only these symbol values need to be examined rather than the many different wire states that can result in a run length that exceeds a threshold maximum value.

The transition lines between states are annotated with corresponding raw symbol values represented as the 3 bit value i.e. a Same Phase b delta Phase c delta Polarity and the decimal equivalent of the raw symbol value that may be referred to as a transition number TN . For the purposes of this description the terms raw symbol value and transition number may be used interchangeably and typically are binary and decimal representations of the same quantity. The raw symbol value on the transition line between states x and y is annotated in . The most significant bit a of the raw symbol value may be set to binary 1 when the current symbol has the same phase as the prior symbol but and an opposite polarity from the prior symbol. The next most significant bit b of the raw symbol value may be used to indicate the phase rotation of the current symbol and in the example is set to binary 1 when the phase rotates clockwise and to binary 0 for counter clockwise phase rotation. The least significant bit c of the raw symbol value may be set to binary 1 when the polarity of the current symbol is different from the polarity of the prior symbol i.e. a transition from x to x . In this example the two least significant bits b c of the raw symbol may be ignored when the most significant bit of the raw symbol is set to binary 1.

It can be observed that transitions from any state have symmetry with the transitions from all of the other states. For example three transitions from any state result in one of the signal wires remaining at the same voltage. The signal wire having the unchanged voltage value may change from state to state and the particular signal wire that remains in the same condition may change from state to state.

The timing chart includes two sequences of symbols that generate run length violations. In one example the B wire remains at 0 volts for 5 consecutive states t through t because a group of the symbols corresponds to a series of transition numbers including . . . 3 1 3 1 . . . Similarly the C wire remains at V 2 volts for 5 consecutive states t7 through t11 because a group of the symbols corresponds to a series of transition numbers including . . . 4 4 4 4 . . . . 

With continued reference to and in accordance with certain aspects disclosed herein a combination of the Mapper and the Run Length Limiter circuit or module RLLM may be adapted or configured to determine when a run length violation has occurred. The Mapper and or the RLLM may be adapted or configured to apply an alternate mapping to ensure that the state of each of the 3 wires or M wires in an M wire N phase encoder switches between states more frequently. The RLLM may be provided separately from or within the Mapper . The RLLM may include a run length detection circuit or logic and or the RLLM may examine the raw symbols output by the Mapper to determine whether a run length violation is likely to be generated in the signaling state of the wires during the symbol intervals corresponding to a serialized sequence of symbols generated from the raw symbols . The determination of a run length violation may include a consideration of symbols in the previous or next sequence of symbols which may combine with beginning or ending symbols in the current sequence of symbols to produce a run length violation that spans across either boundary of the 7 symbol intervals .

The RLLM may be configured to apply an alternate mapping in order to prevent the occurrence of run length violations. The alternative mapping may be implemented by substituting a surplus sequence of symbols for a sequence of symbols known to cause a run length violation. The surplus sequence of symbols may include sequences of symbols that are available to the mapper but are unused because the data to be mapped encodes fewer values than the number of sequences of symbols available for transmission. A replacement sequence of symbols may be inserted in place of the originally mapped sequence of symbols in order to constrain the run length to a value of 5 or less.

In some receivers it is assumed that a worst case situation exists in the previous 7 symbols and or the next 7 symbols . Specifically it may be assumed that a run length observed in windows G and G would be an extension of a run length that commenced in the last 2 symbols s and s or last symbol s of the previous seven symbols respectively. Similarly it may be assumed that a run length observed in symbols s s in the G window continues through the s symbol of the next seven symbols and that a run length observed in symbols s s in the G window continues through the s s symbols of the next seven symbols . Having assumed such extension of run length between successive sequences of 7 symbols and the complexity of the run length detection circuit may be reduced considerably. In effect the G window and G window test three symbols and assume a run length violation if these three symbols indicate a four symbol run length and further the G window and G window test four symbols and a run length violation is assumed if these four symbols indicate a five symbol run length.

Using the latter optimizations the groups G G in the first example can detect a run length violation when the following sequences of raw symbol values are detected 

Similar windowing and computational circuit optimizations may be employed when the maximum run length is set to 5 as shown in the second example and when the maximum run length is set to 4 as in the third example . In the second example the groups G G can detect a run length violation when the following sequences of raw symbol values are detected 

In the third example the groups G0 G6 can detect a run length violation when the following sequences of raw symbol values are detected 

These raw symbol sequence values may trigger a run length violation if they appear at the output of the Mapper . Note that for G in the first example only the values of 131 313 and 444 in symbols s s and s are considered when it is assumed that the symbols in the previous sequence of symbols contribute to a run length violation. Specifically it is assumed that symbols s and s of the previous seven symbols contain 13 31 or 44 respectively.

According to certain aspects disclosed herein a 3 Wire 3 Phase polarity encoder may map 16 bits of input data to seven symbols. The Mapper maps the 65 536 possible values of the input data word to a corresponding number of the 78 215 possible permutations of sequences of phase and polarity for the three wires. Accordingly permutations of symbols may be considered to be surplus sequences of symbols because they are unused by conventional mappers.

According to certain aspects described herein the 12 589 surplus sequences of symbols may provide a source of replacement symbol sequences that can be substituted for a sequence of 7 symbols and or when a run length violation is detected. The entire group of 7 symbols and or may be replaced with one of the 12 589 unused symbol permutations. Not all of the 12 589 values are available to be used for replacement however because some of these unused permutations can themselves contribute to run length violations. There may be fewer unused symbol permutations available for replacement when shorter allowable run lengths are desired or required.

In one example unused symbol permutations may be found by examining the output of the Mapper for all of the 65 536 2 input values. Missing i.e. unused 7 symbol sequences can be easily detected by sorting the used 7 symbol sequences that appear at the output of the mapper. Unused 7 symbol sequences may be checked for run length violations and unused 7 symbol sequences without run length violations may be allocated as replacement 7 symbol sequences that are available to substitute for values for the 7 symbol sequences output by the Mapper that have run length violations. When the desired or required maximum run length is decreased the number of 7 symbol sequences needing substitution at the output of the Mapper typically increases while the number of available unused 7 symbol sequence decreases. For example a larger number of the 12 589 unused permutations are likely to include run length violations when the specified maximum run length is decreased thereby decreasing the number of available unused symbol sequences without run length violations. At a certain point the threshold maximum run length may be so low that an insufficient of unused symbol sequences are available to be substituted for the increased number of used symbol sequences that violate the maximum run length.

At the receiving side an inverse replacement process is performed by a symbol replacement module or circuit . A received 7 symbol sequence may be identified as including a substitute sequence of symbols and the received 7 symbol sequence may be then replaced by a 7 symbol sequence that is associated in a table or by algorithm with the substitute 7 symbol sequence . When the 7 symbol sequence replacement mapping is one to one there is typically no ambiguity in the replacement of the original 7 symbol sequence at the receiver . The transmitter and receiver may agree on a table to be used to facilitate substitution at the transmitter and replacement at the receiver .

It is contemplated that other methods for selecting a substitution 7 symbol sequence at the transmitter and its replacement at the receiver may be used. For example an algorithmic selection system may be used. Moreover the run length violation avoidance techniques described herein may be equally applied to various M Wire N Phase Polarity encoding schemes. As shown in a non integer number of bits can be encoded in each symbol for a variety of encoding schemes. As noted in relation to for example one 6 wire N Phase Polarity encoding scheme yields log 89 6.47 bits per symbol. In this example a 32 bit word can be encoded by the mapper into 5 symbols given that 5 6.47 32.35 bits. Thus only 4 294 967 296 values are used from the available 5 474 196 211 values leaving a significant number of symbols available for substitution

Table 2 illustrates the number of sequences of symbols that are available to be used for symbol substitution in different encoding schemes and for a given maximum desired or permissible dp run length. Each string of substitution symbols may be selected to ensure that the order of the symbols in the string of substitution symbols does not create a sequence of transition numbers see that may generate a run length violation. In some instances the string of substitution symbols may be selected to ensure that the order of the symbols in the string of substitution symbols does not create a sequence of transition numbers for all possible values of one or more symbols that can precede or follow the string of substitution symbols.

In some instances the decision to substitute symbols and the selection of a string of substitution symbols to be used for substitution may be made using circuits or modules that are algorithmically controlled. In some instances one or more tables may be used to determine when symbols should be substituted and to select the string of substitution symbols to be used for substitution. In one example patterns may be detected in the symbols and or transition numbers generated by a symbol mapper using a reference table of problematic symbol sequences.

For example the first row includes a sequence of transition numbers i.e. . . . 1 3 1 3 1 . . . that may cause an undesirable run length condition. The run length eliminator may substitute the symbols that cause the run length with a string of substitute symbols that are selected from surplus symbols as discussed herein. The string of substitute symbols may be appended to the remaining symbols of the symbols received from the mapper after the problematic symbols have been removed. In the example of the first row the string of substitute symbols may be configured to generate a sequence of transition numbers . . . 0 4 4 3 4 . . . .

With regard to the second row a different sequence of symbols i.e. . . . 3 1 3 1 3 . . . may cause an undesirable run length condition similar to the run length condition created in the example of the first row . The run length eliminator may substitute the symbols that cause the run length with a string of substitute symbols that are selected from the unused symbols as discussed herein. The string of substitute symbols may be appended to the remaining symbols of the symbols received from the mapper . In the example of the second row the string of substitute symbols may be configured to generate a sequence of transition numbers . . . 1 4 4 3 4. . . . The differences in the strings of substitute symbols which include the leading transition number in this example enable the receiver to reconstruct the symbols generated by the mapper .

In the example depicted the right side table includes a column that identifies a priority that applies to each row spanning the left side table and the right side table . The priorities in this column can be used to control the order in which a search for the sequences of values identified in the left side table is performed. According to one aspect a search may attempt to eliminate the potential for replacement errors by checking for priority 1 sequences first followed by priority 2 sequences then priority 3 sequences and so on. In one example sequences corresponding to those in the priority 1 first row should be detected before searching for the sequences found in the priority 2 sixth row because the s value in the sixth row could be equal to 1 and it is possible that a sequence of transition numbers generated by a transmitter could match sequences in both the first row and the sixth row . In another example the priority 1 second row should be detected before searching for the sequences found in the priority 2 third row because the s value in the third row could be equal to 3 and it is possible that a sequence of transition numbers generated by a transmitter could match sequences in both the second row and the third row .

According to certain aspects described herein each sequence of symbols that may result in a run length issue may be replaced by a string of substitute symbols that identifies the problematic sequence and its configuration and location within a set of 7 symbols.

For example the first row includes a sequence of transition numbers i.e. . . . 0 4 4 3 4 . . . of which the 4 4 3 4 indicates that a specific type of replacement has occurred and the 0 indicates that the original symbols would have caused the 3 phase receiver decoder to generate the . . . 1 3 1 3 1. . . . This latter sequence is substituted for the received raw symbols. As shown by the example of the second row the 4 4 3 4 sequence of transition numbers from the decoded raw symbols i.e. . . . 1 4 4 3 4. . . indicates that a replacement has occurred and the 1 indicates that the original symbols would have caused the 3 phase receiver decoder to generate the . . . 3 1 3 1 3. . . . This latter sequence is substituted for the received raw symbols the second row .

In the example depicted the right side table includes a column that identifies a priority that applies to each row spanning the left side table and the right side table . The priorities in this column can be used to control the order in which a search for the sequences of values identified in the left side table is performed. Prioritization may be performed in some instances for the same or similar reasons discussed in relation to . According to one aspect a search may attempt to eliminate the potential for replacement errors by checking for priority 1 sequences first followed by priority 2 sequences then priority 3 sequences and so on.

In the illustrated example the processing circuit may be implemented with a bus architecture represented generally by the bus . The bus may include any number of interconnecting buses and bridges depending on the specific application of the processing circuit and the overall design constraints. The bus links together various circuits including the one or more processors and storage . The storage may include memory devices and mass storage devices and may be referred to herein as computer readable media. The bus may also link various other circuits such as timing sources timers peripherals voltage regulators and power management circuits. A bus interface may provide an interface between the bus and a transceiver . The transceiver provides a means for communicating with various other apparatus over a transmission medium. Depending upon the nature of the apparatus a user interface e.g. keypad display speaker microphone joystick may also be provided and may be communicatively coupled to the bus directly or through a bus interface .

A processor may be responsible for managing the bus and for general processing that may include the execution of software stored in a computer readable medium that may include the storage . In this respect the processing circuit including the processor may be used to implement any of the methods functions and techniques disclosed herein. The storage may be used for storing data that is manipulated by the processor when executing software and the software may be configured to implement any one of the methods disclosed herein.

One or more processors in the processing circuit may execute software. Software shall be construed broadly to mean instructions instruction sets code code segments program code programs subprograms software modules applications software applications software packages routines subroutines objects executables threads of execution procedures functions algorithms etc. whether referred to as software firmware middleware microcode hardware description language or otherwise. The software may reside in computer readable form in the storage or in an external computer readable medium. The computer readable medium and or storage may be a non transitory computer readable medium. A non transitory computer readable medium includes by way of example a magnetic storage device e.g. hard disk floppy disk magnetic strip an optical disk e.g. a compact disc CD or a digital versatile disc DVD a smart card a flash memory device e.g. a flash drive a card a stick or a key drive a random access memory RAM a read only memory ROM a programmable ROM PROM an erasable PROM EPROM an electrically erasable PROM EEPROM a register a removable disk and any other suitable medium for storing software and or instructions that may be accessed and read by a computer. The computer readable medium and or storage may also include by way of example a carrier wave a transmission line and any other suitable medium for transmitting software and or instructions that may be accessed and read by a computer. The computer readable medium and or the storage may reside in the processing circuit in the processor external to the processing circuit or may be distributed across multiple entities including the processing circuit . The computer readable medium and or storage may be embodied in a computer program product. By way of example a computer program product may include a computer readable medium in packaging materials. Those skilled in the art will recognize how best to implement the described functionality presented throughout this disclosure depending on the particular application and the overall design constraints imposed on the overall system.

The storage may maintain software maintained and or organized in loadable code segments modules applications programs etc. which may be referred to herein as software modules . Each of the software modules may include instructions and data that when installed or loaded on the processing circuit and executed by the one or more processors contribute to a run time image that controls the operation of the one or more processors . When executed certain instructions may cause the processing circuit to perform functions in accordance with certain methods algorithms and processes described herein.

Some of the software modules may be loaded during initialization of the processing circuit and these software modules may configure the processing circuit to enable performance of the various functions disclosed herein. For example some software modules may configure internal devices and or logic circuits of the processor and may manage access to external devices such as the transceiver the bus interface the user interface timers serial to parallel converters parallel to serial converters mappers demappers encoders decoders mathematical coprocessors and so on. The software modules may include a control program and or an operating system that interacts with interrupt handlers and device drivers and that controls access to various resources provided by the processing circuit . The resources may include memory processing time access to the transceiver the user interface and so on.

One or more processors of the processing circuit may be multifunctional whereby some of the software modules are loaded and configured to perform different functions or different instances of the same function. The one or more processors may additionally be adapted to manage background tasks initiated in response to inputs from the user interface the transceiver and device drivers for example. To support the performance of multiple functions the one or more processors may be configured to provide a multitasking environment whereby each of a plurality of functions is implemented as a set of tasks serviced by the one or more processors as needed or desired. In one example the multitasking environment may be implemented using a timesharing program that passes control of a processor between different tasks whereby each task returns control of the one or more processors to the timesharing program upon completion of any outstanding operations and or in response to an input such as an interrupt. When a task has control of the one or more processors the processing circuit is effectively specialized for the purposes addressed by the function associated with the controlling task. The timesharing program may include an operating system a main loop that transfers control on a round robin basis a function that allocates control of the one or more processors in accordance with a prioritization of the functions and or an interrupt driven main loop that responds to external events by providing control of the one or more processors to a handling function.

If at step it is determined that a run length violation is unlikely to occur then the method terminates at step .

If at step it is determined that a run length violation will occur or is likely to occur then the method proceeds to step where a second sequence of symbols is substituted for the first sequence of symbols. The second sequence of symbols includes surplus sequences of symbols that are not otherwise used for mapping data in the mapper.

In an aspect of the disclosure an encoding scheme used by the encoder defines a set of available sequences of symbols. The mapper may be configured to use a subset of the set of available sequences of symbols to map the data. The surplus sequences of symbols may not be in the subset of the set of available sequences of symbols. The second sequence of symbols may be substituted for the first sequence of symbols using a table to select the second sequence of symbols based on the content of the first sequence of symbols. The second sequence of symbols may be substituted for the first sequence of symbols by generating a plurality of replacement sequences from the surplus sequences of symbols and selecting as the second sequence of symbols one of the plurality of replacement sequences which is calculated to be unlikely to cause the run length violation.

In an aspect of the disclosure the run length violation occurs if one or more of the plurality of wires fails to change state while a predefined number of symbols are sequentially transmitted on the plurality of wires.

In an aspect of the disclosure it may be determined that the run length violation would occur by identifying a combination of symbols known to cause the run length violation. The combination of symbols may include a predefined number of symbols. It may be determined that the run length violation would occur by identifying a portion of the combination of symbols known to cause the run length violation at the beginning of the first sequence of symbols. It may be determined that the run length violation would occur by identifying a portion of the combination of symbols known to cause the run length violation at the end of the first sequence of symbols.

In an aspect of the disclosure the second sequence of symbols may be transmitted on the plurality of wires in place of the first sequence of symbols. Each of the first sequence of symbols and the second sequence of symbols may include seven symbols. In one example 16 bits of data may be mapped to a first sequence of symbols having 7 symbols therein.

In an aspect of the disclosure the symbols of the second sequence of symbols may be transmitted on the plurality of wires by transmitting a first symbol which drives a first wire and a second wire to voltage states that are different from one another. A third wire may be in a state that is different from the voltage states of the first wire and the second wire.

The processing circuit may be coupled to line driver circuits through a parallel to serial converter and or other circuits and modules. The line driver circuits may be selectively coupled to a plurality of connectors and or wires under control of the processing circuit . The line driver circuits provide a means for communicating with various other apparatus over a transmission medium including the wires . The processing circuit may be coupled to a computer readable medium . The processing circuit is responsible for general processing including the execution of software stored on the computer readable medium . The software when executed by the processing circuit causes the processing circuit to perform the various functions described supra for any particular apparatus. The computer readable medium may also be used for storing data that is manipulated by the processing circuit when executing software. The processing system further includes at least one of the circuits and or modules and . The modules may be software modules running in the processing circuit resident stored in the computer readable medium one or more hardware modules coupled to the processing circuit or some combination thereof.

In one configuration the encoding apparatus includes means modules or circuits for determining that a run length violation will occur or is likely to occur if a first sequence of symbols provided by a mapper of an M Wire N Phase encoder is transmitted on a plurality of wires and means modules or circuits for substituting a second sequence of symbols for the first sequence of symbols. The encoding apparatus may include means for transmitting the sequence of symbols on the first set of connectors including a plurality of line drivers which may be switched between one or more wires connectors and or activated or deactivated to obtain a trade off between bandwidth and power consumption. The aforementioned means modules and circuits may be one or more of the aforementioned modules of the encoding apparatus and or the processing circuit configured to perform the functions recited by the aforementioned means.

At step the first set of symbols may be identified as a substitute set of symbols that is not used for demapping symbols.

At step a second set of symbols is substituted for the first set of symbols. The second set of symbols may correspond to symbols that would have caused or that would likely have caused a run length violation if transmitted on the plurality of wires. The run length violation may occur when one or more of the plurality of wires fail to change state while a predefined number of symbols are sequentially transmitted on the plurality of wires. The run length violation may be likely to occur if the second set of symbols includes a portion of a combination of symbols known to cause the run length violation at the beginning of the first set of symbols. The run length violation may be likely to occur if the second set of symbols includes a portion of a combination of symbols known to cause the run length violation at the end of the first set of symbols. Each of the first set of symbols and the second set of symbols may include seven symbols.

In an aspect of the disclosure the demapper may be configured to demap 16 bits of data from the second set of symbols.

The processing circuit is responsible for general processing including the execution of software stored on the computer readable medium . The software when executed by the processing circuit causes the processing circuit to perform the various functions described supra for any particular apparatus. The computer readable medium may also be used for storing data that is manipulated by the processing circuit when executing software. The receiver circuit further includes at least one of the modules and or . The modules and or may be software modules running in the processing circuit resident stored in the computer readable medium one or more hardware modules coupled to the processing circuit or some combination thereof.

In one configuration the receiver circuit includes symbol receiving modules or circuits that are configured to receive a first set of symbols from a plurality of wires on a communications link identifier modules or circuits configured to identify first set of symbols as a substitute set of symbols that is not used for demapping symbols and substituting modules or circuits that are configured to substitute a second set of symbols for the first set of symbols. The second set of symbols may correspond to symbols that would have caused or that would likely have caused a run length violation if transmitted on the plurality of wires. The receiver circuit and or the processing circuit may be configured to perform the functions ascribed to the aforementioned modules and circuits.

It is understood that the specific order or hierarchy of steps in the processes disclosed is an illustration of exemplary approaches. Based upon design preferences it is understood that the specific order or hierarchy of steps in the processes may be rearranged. The accompanying method claims present elements of the various steps in a sample order and are not meant to be limited to the specific order or hierarchy presented.

The previous description is provided to enable any person skilled in the art to practice the various aspects described herein. Various modifications to these aspects will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other aspects. Thus the claims are not intended to be limited to the aspects shown herein but is to be accorded the full scope consistent with the language claims wherein reference to an element in the singular is not intended to mean one and only one unless specifically so stated but rather one or more. Unless specifically stated otherwise the term some refers to one or more. All structural and functional equivalents to the elements of the various aspects described throughout this disclosure that are known or later come to be known to those of ordinary skill in the art are expressly incorporated herein by reference and are intended to be encompassed by the claims. Moreover nothing disclosed herein is intended to be dedicated to the public regardless of whether such disclosure is explicitly recited in the claims. No claim element is to be construed as a means plus function unless the element is expressly recited using the phrase means for. 

