---

title: Security, fraud detection, and fraud mitigation in device-assisted services systems
abstract: A device having: an application program that assists the device in accessing a data service over a wireless access network, an application credential associated with the application program, and a policy to be applied when the application program initiates or attempts to initiate communication over the wireless access network. The device also has one or more agents that detect an attempted installation of update software on the device, the update software purporting to be a modification, update, or replacement of the application program; obtain an update-software credential associated with the update software; obtain the application credential; allow the update software to be installed if the update-software credential matches the application credential; and interact with the application program to arrange a setting of the application program, the setting configured to assist in applying the policy when the application program initiates or attempts to initiate communication over the wireless access network.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09491199&OS=09491199&RS=09491199
owner: Headwater Partners I LLC
number: 09491199
owner_city: Tyler
owner_country: US
publication_date: 20140724
---
This application is a divisional of co pending U.S. application Ser. No. 13 309 463 filed Dec. 1 2011 entitled Security Fraud Detection and Fraud Mitigation in Device Assisted Services Systems. 

U.S. application Ser. No. 13 309 463 filed Dec. 1 2011 entitled Security Fraud Detection and Fraud Mitigation in Device Assisted Services Systems is a continuation in part of the following U.S. non provisional patent applications U.S. Ser. No. 12 380 759 filed Mar. 2 2009 entitled Verifiable Device Assisted Service Policy Implementation U.S. Ser. No. 12 380 779 filed Mar. 2 2009 entitled Device Assisted Service Profile Management with User Preference Adaptive Policy Network Neutrality and User Privacy U.S. Ser. No. 12 380 758 filed Mar. 2 2009 entitled Verifiable Device Assisted Service Usage Monitoring with Reporting Synchronization and Notification U.S. Ser. No. 12 380 778 filed Mar. 2 2009 entitled Verifiable Device Assisted Service Usage Billing with Integrated Accounting Mediation Accounting and Multi Account U.S. Ser. No. 12 380 768 filed Mar. 2 2009 entitled Network Based Service Policy Implementation with Network Neutrality and User Privacy U.S. Ser. No. 12 380 767 filed Mar. 2 2009 entitled Network Based Service Profile Management with User Preference Adaptive Policy Network Neutrality and User Privacy U.S. Ser. No. 12 380 780 filed Mar. 2 2009 entitled Automated Device Provisioning and Activation U.S. Ser. No. 12 380 755 filed Mar. 2 2009 entitled Device Assisted Ambient Services U.S. Ser. No. 12 380 756 filed Mar. 2 2009 entitled Network Based Ambient Services U.S. Ser. No. 12 380 770 filed Mar. 2 2009 entitled Network Tools for Analysis Design Testing and Production of Services U.S. Ser. No. 12 380 772 filed Mar. 2 2009 entitled Roaming Services Network and Overlay Networks U.S. Ser. No. 12 380 782 filed Mar. 2 2009 entitled Open Development System for Access Service Providers U.S. Ser. No. 12 380 783 filed Mar. 2 2009 entitled Virtual Service Provider Systems U.S. Ser. No. 12 380 757 filed Mar. 2 2009 entitled Service Activation Tracking System U.S. Ser. No. 12 380 781 filed Mar. 2 2009 entitled Open Transaction Central Billing System U.S. Ser. No. 12 380 774 filed Mar. 2 2009 entitled Verifiable and Accurate Service Usage Monitoring for Intermediate Networking Devices U.S. Ser. No. 12 380 773 filed Mar. 2 2009 entitled Verifiable Service Policy Implementation for Intermediate Networking Devices U.S. Ser. No. 12 380 769 filed Mar. 2 2009 entitled Service Profile Management with User Preference Adaptive Policy Network Neutrality and User Privacy for Intermediate Networking Devices U.S. Ser. No. 12 380 777 filed Mar. 2 2009 entitled Simplified Service Network Architecture U.S. Ser. No. 12 695 019 filed Jan. 27 2010 entitled Device Assisted CDR Creation Aggregation Mediation and Billing U.S. Ser. No. 12 695 020 filed Jan. 27 2010 entitled Adaptive Ambient Services U.S. Ser. No. 12 694 445 filed Jan. 27 2010 entitled Security Techniques for Device Assisted Services U.S. Ser. No. 12 694 451 filed Jan. 27 2010 entitled Device Group Partitions and Settlement Platform U.S. Ser. No. 12 694 455 filed Jan. 27 2010 entitled Device Assisted Services Install U.S. Ser. No. 12 695 021 filed Jan. 27 2010 entitled Quality of Service for Device Assisted Services U.S. Ser. No. 12 695 980 filed Jan. 28 2010 entitled Enhanced Roaming Services and Converged Carrier Networks with Device Assisted Services and a Proxy U.S. application Ser. No. 13 134 005 filed May 25 2011 and entitled System and Method for Wireless Network Offloading U.S. Ser. No. 13 134 028 filed May 25 2011 entitled Device Assisted Services for Protecting Network Capacity U.S. application Ser. No. 13 229 580 filed Sep. 9 2011 and entitled Wireless Network Service Interfaces U.S. application Ser. No. 13 237 827 filed Sep. 20 2011 and entitled Adapting Network Policies Based on Device Service Processor Configuration U.S. application Ser. No. 13 239 321 filed Sep. 21 2011 and entitled Service Offer Set Publishing to Device Agent with On Device Service Selection U.S. application Ser. No. 13 247 998 filed Sep. 28 2011 and entitled Secure Device Data Records U.S. application Ser. No. 13 248 028 filed Sep. 28 2011 and entitled Enterprise Access Control and Accounting Allocation for Access Networks U.S. application Ser. No. 13 248 025 filed Sep. 28 2011 and entitled Service Design Center for Device Assisted Services U.S. application Ser. No. 13 253 013 filed Oct. 4 2011 and entitled System and Method for Providing User Notifications and U.S. application Ser. No. 13 309 556 filed Dec. 1 2011 entitled End User Device that Secures an Association of Application to Service Policy with an Application Certificate Check. 

U.S. application Ser. No. 13 309 463 filed Dec. 1 2011 entitled Security Fraud Detection and Fraud Mitigation in Device Assisted Services Systems claims priority to the following U.S. provisional patent applications U.S. provisional Ser. No. 61 418 507 filed Dec. 1 2010 entitled Application Service Provider Interface System U.S. provisional Ser. No. 61 418 509 filed Dec. 1 2010 entitled Service Usage Reporting Reconciliation and Fraud Detection for Device Assisted Services U.S. provisional Ser. No. 61 420 727 filed Dec. 7 2010 entitled Secure Device Data Records U.S. provisional Ser. No. 61 422 565 filed Dec. 13 2010 entitled Service Design Center for Device Assisted Services U.S. provisional Ser. No. 61 422 572 filed Dec. 13 2010 entitled System Interfaces and Workflows for Device Assisted Services U.S. provisional Ser. No. 61 422 574 filed Dec. 13 2010 entitled Security and Fraud Detection for Device Assisted Services U.S. provisional Ser. No. 61 435 564 filed Jan. 24 2011 entitled Framework for Device Assisted Services U.S. provisional Ser. No. 61 472 606 filed Apr. 6 2011 entitled Managing Service User Discovery and Service Launch Object Placement on a Device and U.S. provisional Ser. No. 61 550 906 filed Oct. 24 2011 entitled Security for Device Assisted Services. 

All of the above referenced applications and patents are hereby incorporated by reference for all purposes.

Furthermore the following applications and patents are hereby incorporated by reference for all purposes U.S. provisional Ser. No. 61 206 354 filed Jan. 28 2009 entitled Services Policy Communication System and Method U.S. provisional Ser. No. 61 206 944 filed Feb. 4 2009 entitled Services Policy Communication System and Method U.S. provisional Ser. No. 61 207 393 filed Feb. 10 2009 entitled Services Policy Communication System and Method U.S. provisional Ser. No. 61 207 739 filed Feb. 13 2009 entitled Services Policy Communication System and Method U.S. provisional Ser. No. 61 270 353 filed Jul. 6 2009 entitled Device Assisted CDR Creation Aggregation Mediation and Billing U.S. provisional Ser. No. 61 275 208 filed Aug. 25 2009 entitled Adaptive Ambient Services U.S. provisional Ser. No. 61 237 753 filed Aug. 28 2009 entitled Adaptive Ambient Services U.S. provisional Ser. No. 61 252 151 filed Oct. 15 2009 entitled Security Techniques for Device Assisted Services U.S. provisional Ser. No. 61 252 153 filed Oct. 15 2009 entitled Device Group Partitions and Settlement Platform U.S. provisional Ser. No. 61 264 120 filed Nov. 24 2009 entitled Device Assisted Services Install U.S. provisional Ser. No. 61 264 126 filed Nov. 24 2009 entitled Device Assisted Services Activity Map U.S. provisional Ser. No. 61 348 022 filed May 25 2010 entitled Device Assisted Services for Protecting Network Capacity U.S. provisional Ser. No. 61 381 159 filed Sep. 9 2010 entitled Device Assisted Services for Protecting Network Capacity U.S. provisional Ser. No. 61 381 162 filed Sep. 9 2010 entitled Service Controller Interfaces and Workflows U.S. provisional Ser. No. 61 384 456 filed Sep. 20 2010 entitled Securing Service Processor with Sponsored SIMs U.S. provisional Ser. No. 61 385 020 filed Sep. 21 2010 entitled Service Usage Reconciliation System Overview U.S. provisional Ser. No. 61 387 243 filed Sep. 28 2010 entitled Enterprise and Consumer Billing Allocation for Wireless Communication Device Service Usage Activities and U.S. provisional Ser. No. 61 387 247 filed Sep. 28 2010 entitled Secured Device Data Records U.S. provisional Ser. No. 61 389 547 filed Oct. 4 2010 entitled User Notifications for Device Assisted Services U.S. provisional Ser. No. 61 407 358 filed Oct. 27 2010 entitled Service Controller and Service Processor Architecture U.S. Pat. No. 8 023 425 issued on Sep. 20 2011 filed as U.S. Ser. No. 12 380 771 originally filed Mar. 2 2009 entitled Verifiable Service Billing for Intermediate Networking Devices. 

As the computing power of mobile end user devices has increased mobile devices have become capable of sending and receiving increasing amounts of data. In addition to e mail and text messages many of today s mobile devices can support a variety of applications that send large quantities of information to and from end users. For example in addition to sending e mail and text messages many of today s mobile devices can deliver news weather sports maps social networking information music videos high resolution photographs documents presentations and other kinds of information.

The ability of mobile devices to send and receive such a wide variety and large quantity of data has stressed wireless access network bandwidth capabilities. As a result network operators are either eliminating service plans with unlimited data usage or they are increasing the price of unlimited service plans so that such plans are not attractive to most consumers. Consequently many users of mobile end user devices subscribe to service plans that include only a limited amount of data per fixed time period e.g. per month . Because today s mobile end user devices can access e.g. send or receive large amounts of information there is a potential for a user of a mobile device to exceed his or her data plan allowance without realizing it. It is well known that such overages in data usage can be very expensive because the billing rate for data usage exceeding the contracted service plan amount is often significantly higher than the billing rate under the service plan.

Because of their computing capabilities many of today s mobile end user devices can also participate in the implementation and enforcement of service policies associated with access network service plans such as charging control and notification policies. Device assisted services DAS have been described in the many prior applications listed in the Cross Reference to Related Applications section of this document. When end user devices participate in implementing and enforcing access network policies there is a potential for device users to attempt to or to successfully spoof or hack end user device components to fraudulently obtain access to data services at incorrect lower service usage billing rates. Likewise highly motivated users might try to gain access to network elements that perform functions related to service policy implementation or enforcement associated with the end user device s data usage.

Thus there is a need to secure software and hardware in both end user devices and in network elements involved in the provision of device assisted services. In addition there is a need to detect and mitigate fraudulent or potentially fraudulent activities.

According to various embodiments systems and methods are provided for securing device assisted services DAS systems and for detecting and mitigating fraud in such systems.

In some embodiments an end user device comprises one or more modems to allow communications over a wireless access network memory configured to store an application specific network access policy to be applied when a particular application program attempts to communicate or successfully communicates over the wireless access network and one or more device agents configured to detect attempted or successful activity by the particular application program and to apply the application specific network access policy to the communication activity.

In some embodiments the one or more device agents are configured to detect attempted or successful activity by the particular application program by flow tagging a data flow associated with the particular application program associating the flow tag with the application identifier and applying the application specific network access policy to the flow tagged data flow.

In some embodiments an end user device comprises one or more modems to allow communications over a wireless access network memory configured to store an application specific network access policy to be applied when a particular application program attempts to communicate or successfully communicates over the wireless access network and one or more device agents configured to use an application programming interface API to arrange an application setting to assist in implementing the application specific network access policy.

In some embodiments the application specific network access policy comprises a control policy configured to assist in controlling transmissions or receptions over the wireless access network that are associated with the application program. In some embodiments the application specific network access policy comprises a charging policy configured to assist in accounting for transmissions or receptions over the wireless access network that are associated with the application program. In some embodiments the end user device has a user interface and the application specific network access policy comprises a notification policy configured to assist in presenting through the user interface a notification message such as for example an offer or an advertisement information about a network type e.g. a home network a roaming network a cellular network a wireless wide area network WWAN a wireless local area network WLAN a wireless personal area network WPAN a 2G network a 3G network a 4G network a WiMAX network an Ethernet network a DSL network a DOCSIS network a cable network a WiFi network etc. an indication of an amount or cost of data usage associated with the application program an indication of a projected amount or a projected cost of data usage associated with the application program e.g. a projection based on a past or historical data usage associated with the application program an indication of an amount or cost of data usage associated with the application program during a particular period of time possibly user configured or user selected an indication that an amount or cost of data usage associated with the application satisfies a condition relative to a limit setting e.g. exceeds a threshold meets a threshold is less than a threshold etc. an indication of an amount or cost of background data usage by the application program etc. In some embodiments the policy is associated with an application identifier e.g. a credential associated with the application possibly stored on the end user device . In some embodiments the application program is secured by an application credential which may be the application identifier . In some embodiments the one or more device agents are further configured to prevent modifications updates or replacements of the application program unless software purporting to be a modification update or replacement of the application program is associated with a credential that is consistent with e.g. matches the application credential.

In some embodiments at least one of the one or more device agents is secured by an agent credential and one of the one or more device agents is configured to prevent modifications updates or replacements of the at least one of the one or more device agents unless software purporting to be a modification update or replacement of the at least one of the one or more device agents is associated with a credential that is consistent with e.g. matches the agent credential.

In some embodiments the agent credential comprises one or more of agent kernel software present with a proper signature certificate or hash result agent framework software present with a proper signature certificate or hash result and agent application software present with a proper signature certificate or hash result.

In some embodiments the end user device is further secured by configuring the one or more device agents to perform one or more of the following checks determining if a hosts file is present and properly configured determining if a service processor on the end user device successfully completed an authentication procedure with a service controller in the network determining if the end user device has been rooted.

In some embodiments a network system is configured to provide access network services to an end user device and the end user device is responsible for implementing an access network policy. In some embodiments the network system is configured to obtain a trusted measure of access network usage by the end user device and to use the trusted measure to confirm that the end user device is properly implementing the access network policy where the trusted measure is obtained from a network element from a secure processor on the end user device or from a trusted third party.

In some embodiments the network system is configured to apply a multi tiered policy verification process comprising at least two of the following policy verification steps performed in any order a determining if the end user device is failing to send service usage reports even though the network system is receiving trusted reports of the end user device s service usage b comparing a trusted service usage measure to a limit or range of usage expected if the end user device is properly implementing the access network policy c comparing a trusted service usage measure to a non secure e.g. device generated usage measure to determine if the difference between the two usage measures is within a specified tolerance d comparing a non secure e.g. device based service usage measure to a limit or range of usage expected if the end user device is properly implementing the access network policy e comparing a classification of the end user device s usage to a limit or range of usage expected if the end user device is properly implementing the access network policy f comparing an aggregation of two or more classifications of the end user device s usage to an aggregate limit on usage to determine if the difference between the two measures is within a specified tolerance g comparing a trusted measure of usage of a class e.g. an application a group of applications a network destination a group of network destinations etc. to a limit or range of usage expected if the end user device is properly implementing the access network policy h comparing a trusted measure of usage of a class e.g. an application a group of applications a network destination a group of network destinations etc. to a non secure e.g. device based measure of usage of the same class to determine if the difference between the two measures is within a specified tolerance i comparing a statistical characterization of usage by a population of end user devices to a trusted measure of the end user device s service usage to determine if the difference between the two measures is within a specified tolerance j comparing a statistical characterization of usage of a particular class e.g. an application a group of applications a network destination a group of network destinations etc. by a population of end user devices to a trusted measure of the end user device s usage of that same class to determine if the difference between the two measures is within a specified tolerance k comparing a statistical characterization of usage by a population of end user devices to a non secure measure of the end user device s service usage to determine if the difference between the two measures is within a specified tolerance l comparing a statistical characterization of usage of a class e.g. an application a group of applications a network destination a group of network destinations etc. to a non secure e.g. device based measure of usage of the same class to determine if the difference between the two measures is within a specified tolerance m comparing detailed class e.g. an application a group of applications a network destination a group of network destinations etc. usage information in a usage report trusted or non secure to determine whether the access network policy allows the classified activity n determining whether a service processor on the end user device successfully authenticated with a service controller in the network o determining whether the end user device is sending reports to a network element in an expected manner p determining whether usage of one or more classes e.g. an application a group of applications a network destination a group of network destinations etc. is consistently slightly under particular limits that would indicate likely fraud on the part of the end user device q comparing an amount or percentage of unknown or unclassified data usage allocated by the end user device to a particular class to an expected amount or percentage of unknown or unclassified data usage where the expected amount or percentage is determined using information from a trusted source e.g. a web crawler domain object model etc. .

In some embodiments the result of one or more of the policy verification steps is a pass fail criterion and the overall pass criterion is a number of failures less than a limit on the number of failures. In some embodiments the result of one or more of the policy verification steps is a quantized value associated with an error likelihood or non error likelihood and the overall fail pass criterion is based on a combination of one or more quantized values. In some embodiments a policy implementation error action is taken if an error occurs where the error action comprises one or more of flagging the end user device or the user for further evaluation charging for the end user device s usage at a pre defined rate associated with an error condition notifying the user of the end user device notifying a network or system administrator quarantining the end user device or a user access to the access network suspending the end user device or user s access to the access network.

The invention can be implemented in numerous ways including as a process an apparatus a system a composition of matter a computer program product embodied on a computer readable storage medium and or a processor such as a processor configured to execute instructions stored on and or provided by a memory coupled to the processor. In this specification these implementations or any other form that the invention may take may be referred to as techniques. In general the order of the steps of disclosed processes may be altered within the scope of the invention. Unless stated otherwise a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. As used herein the term processor refers to one or more devices circuits and or processing cores configured to process data such as computer program instructions.

A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention. The invention is described in connection with such embodiments but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives modifications and equivalents. Numerous specific details are set forth in the following description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.

As illustrated in the embodiment of service controller communicates with existing network information technology IT and billing infrastructure of the network operator in various ways that are described herein and in the applications listed in the section Cross Reference to Related Applications. Service design center provides an interface that allows operator personnel or other authorized persons to configure service plan information for end user devices. Service design center communicates with service controller which in turn assists in provisioning service plans by communicating with existing network IT and billing infrastructure and service processor .

In some embodiments service processor assists in classifying service usage by end user device into sub categories e.g. classes for the purpose of assisting in usage accounting policy enforcement access control policy enforcement applying service usage limits or notification policy enforcement that differs according to the category or class . In some embodiments the classification can be for one or more device applications e.g. a class comprises one or more application programs . In some embodiments the classification can be for one or more network destinations e.g. a class comprises one or more network destinations . In some embodiments the classification can be for one or more network types e.g. a class comprises one or more network types . In some embodiments a classification of service usage referred to as a sponsored service or an ambient service can be performed to facilitate allocating access network costs in whole or in part associated with the sponsored service to a service sponsor the service sponsor being an entity other than the user or subscriber associated with end user device .

In some embodiments the communication activity is classified for purposes of access policy enforcement by service processor or by a network element based on one or more network destinations associated with the communication activity such as for example a collection of one or more of a network address a domain a URL a website a WAP site a server configured to communicate with a device application a content distribution site a network tunnel or tunnel server such as for example a VPN APN or other tunnel a network gateway or a proxy server. In some embodiments the communications activity is classified for the purposes of network access policy enforcement by service processor or by a network element based on a collection of one or more device application programs or device operating system OS components participating in the communications activity.

Service processor comprises one or more software or firmware programs that execute on end user device . To aid in disclosure of the invention service processor is explained using the functional elements or agents shown in . The specific allocation of functional elements within service processor can take many forms and the form presented in is intended to illustrate basic elements but is not intended to be an exhaustive or limiting description of possible functional breakdowns of service processor .

In some embodiments application interface agent monitors device application layer communication activity to identify attempted or successful access network communication activity. In some embodiments application interface agent monitors application layer access network communication activity to identify and classify the access network communication activity. In some embodiments the monitoring of access network communication activity by application interface agent is reported to service monitor agent . In some embodiments the monitoring of access communications activity by application interface agent comprises classifying data traffic flows based on inspection and characterization of which application e.g. TCP application IP application voice application or any other application on end user device each flow is associated with. In some embodiments the monitoring of access communications activity by application interface agent comprises classifying data traffic flows based on inspection and characterization of which network destination each flow is associated with.

In some embodiments service monitor agent application interface agent and or other agents implement virtual traffic tagging by tracking or tracing packet flows through various communication stack formatting processing and encryption steps and providing the virtual tag information to the various agents that monitor control shape throttle or otherwise observe manipulate or modify the traffic. This tagging approach is referred to herein as virtual tagging because there is not a literal data flow traffic flow or packet tag that is attached to flows or packets and the book keeping to tag the packet is done through tracking or tracing the flow or packet through the stack instead.

In some embodiments application interface agent and or other agents identify a traffic flow associate it with a service usage activity and cause a literal tag to be attached to the traffic or packets associated with the activity. This tagging approach is referred to herein as literal tagging. There are various advantages to both the virtual tagging and the literal tagging approaches. For example it can be preferable in some embodiments to reduce the inter agent communication required to track or trace a packet through the stack processing by assigning a literal tag so that each flow or packet has its own activity association embedded in the data. As another example it can be preferable in some embodiments to re use portions of standard communication stack software or components enhancing the verifiable traffic control or service control capabilities of the standard stack by inserting additional processing steps associated with the various service agents and monitoring points rather than re writing the entire stack to correctly process literal tagging information and in such cases a virtual tagging scheme may be desired. As yet another example some standard communication stacks provide for unused unspecified or otherwise available bit fields in a packet frame or flow and these unused unspecified or otherwise available bit fields can be used to literally tag traffic without the need to re write all of the standard communication stack software with only the portions of the stack that are added to enhance the verifiable traffic control or service control capabilities of the standard stack needing to decode and use the literal tagging information encapsulated in the available bit fields. In the case of literal tagging in some embodiments the tags are removed prior to passing the packets or flows to the network or to the applications utilizing the stack. In some embodiments the manner in which the virtual or literal tagging is implemented can be developed into a communication standard specification so that various device or service product developers can independently develop the communication stack and or service processor hardware and or software in a manner that is compatible with service controller specifications and the products of other device or service product developers.

In some embodiments an agent or combination of agents uses tags to assist in applying a policy e.g. a notification charging or control policy when an application program on end user device initiates communications or successfully communicates over an access network. In some such embodiments the agent or combination of agents determines when an application program initiates or attempts to initiate a communication over the first wireless access network by identifying a data flow comprising one or more related data transfers or attempted data transfers associated with the application program assigning a flow tag to the data flow where the flow tag is a traffic flow identifier monitoring an access network service usage or attempted service usage associated with the flow tag and after identifying the data flow applying the policy to the first wireless access network service usage or attempted service usage associated with the flow tag. As will be appreciated by a person having ordinary skill in the art the steps of identifying assigning and monitoring can occur in any order.

In some embodiments application interface agent applies implements or enforces service usage accounting or charging policy for application layer access network communication activity. In some embodiments this policy implementation function is used to apply implement or enforce service usage accounting or charging policy that varies with the classification of the access communication activity as discussed above.

In some embodiments application interface agent implements traffic control policy for application layer access network communication activity. In some embodiments application interface agent implements application level control policy to allow an application to execute on end user device or to prevent an application from executing. In some embodiments application interface agent implements notification policy for application layer access network communication activity.

In some embodiments application interface agent provides applications with an access network service application interface so that the application e.g. TCP application IP application voice application etc. can request or provision special access network service permissions such as for example an access network quality of service QoS channel class a background service usage class a service usage accounting particular to an application or application class or a sponsored service usage particular to an application or application class wherein a sponsor entity other than a user of the end user device subsidizes an access network usage cost associated with the application or application class. In such embodiments application interface agent can communicate with a counterpart in the access network to provide for provisioning of the special access network service permissions for a particular application or class of applications.

In some embodiments application interface agent interacts with application programs e.g. TCP application IP application voice application or another application on end user device to arrange application settings to aid in implementing application level service policy implementation or billing. In some embodiments application interface agent arranges an application setting by posting sending or otherwise communicating a message comprising a setting configuration. In some embodiments the application setting assists in traffic control e.g. allow block throttle rate limit transmit on a particular network background traffic control etc. notification e.g. to a user of end user device to a network element such as service controller etc. or charging e.g. to account for usage of access network resources by end user device .

In some embodiments application interface agent interacts with an application program stored on end user device and configured to access a data service over an access network. In some such embodiments the application program has an associated policy e.g. a notification e.g. of an amount or cost of access network usage associated with the application program an amount or cost of access network usage associated with the application program over a particular possibly user selected period of time background or foreground data usage information etc. charging or control policy to be applied when the application program initiates or attempts to initiate communications over the first access network and application interface agent or another agent on end user device assists in policy implementation by arranging a setting of the application program by posting sending or otherwise communicating the setting to the application program.

In some embodiments one or more agents on end user device are configured to prevent unauthorized modifications updates or replacements of the application software by detecting an attempted installation of update software on end user device where the update software purports to be a modification update or replacement of the application program obtaining a credential associated with the application program obtaining a credential associated with the update software and allowing the update software to be installed on end user device if the credential associated with the purported modification update or replacement of the application program matches the credential associated with the application program.

In some embodiments application interface agent is associated with or comprises a credential and another agent on end user device e.g. access control integrity agent policy control agent etc. is configured to prevent unauthorized modifications updates or replacements of application interface agent . In some embodiments the other agent detects an attempted installation of software purporting to be a modification update or replacement of application interface agent obtains the credential associated with application interface agent obtains a credential associated with the software purporting to be a modification update or replacement of application interface agent and allows the software to be installed on end user device if the credential associated with the software matches the credential associated with application interface agent .

In some embodiments application interface agent intercepts certain application traffic to modify traffic application layer parameters such as email file transfer options or browser headers. In some embodiments application interface agent transmits or receives a service usage test element to aid in verifying service policy implementation service monitoring or service billing. In some embodiments application interface agent performs a transaction billing intercept function to aid the billing agent in transaction billing. In some embodiments application interface agent transmits or receives a billing test element to aid in verifying transaction billing or service billing.

In some embodiments policy implementation agent monitors device network traffic layer communication activity to identify attempted or successful access network communication activity. In some embodiments policy implementation agent monitors network traffic layer communication activity to identify and classify the access communication activity. In some embodiments the monitoring of access network communications activity by policy implementation agent is reported to service monitor agent . Traffic layer communication monitoring can be conducted at one or more layers between the application layer generally referred to as layer 7 and the access network media access control layer generally referred to as layer 2 . In some embodiments traffic layer communication monitoring comprises classifying data traffic flows based on inspection and characterization of layer 7 communication traffic parameters for example one or more of application program identifier or credential network destination classifiers communication protocol parameters communication content classifiers or secure communication protocol parameters such as SSL or TLS connection parameters and associating the classification with one or more resulting traffic flows socket flows or packet flows. In some embodiments traffic layer communication monitoring comprises classifying data traffic flows based on inspection and characterization of layer 4 communication traffic parameters such as for example socket flow tuples. In some embodiments traffic layer communication monitoring comprises classifying data traffic flows based on inspection and characterization of layer 3 communication traffic parameters for example IP addresses . In some embodiments traffic layer communication monitoring comprises classifying data traffic flows based on inspection and characterization of VPN tunnel parameters APN tunnel parameters etc.

In some embodiments policy implementation agent applies implements or enforces access network policy at one or more of the communications traffic layers of a device operating system. As discussed above in some embodiments access network policy can be applied at one or more traffic layers. Traffic layer policy enforcement can be applied at any layer s between and including the application layer generally referred to as layer 7 and the access network media access control layer generally referred to as layer 2 .

In some embodiments communications traffic layer policy application comprises policy applied to a classification of data traffic flows based on inspection and characterization of layer 7 communication traffic parameters for example one or more of application program identifier or credential network destination classifiers communication protocol parameters communication content classifiers or secure communication protocol parameters such as SSL or TLS connection parameters and associating the classification with one or more resulting traffic flows socket flows or packet flows. In some embodiments communications traffic layer policy application comprises policy applied to a classification of data traffic flows based on inspection and characterization of layer 4 communication traffic parameters such as for example socket flow tuples. In some embodiments communications traffic layer policy application comprises policy applied to a classification of data traffic flows based on inspection and characterization of layer 3 communication traffic parameters e.g. IP addresses . In some embodiments communications traffic layer policy application comprises policy applied to a classification of data traffic flows based on inspection and characterization of VPN tunnel parameters APN tunnel parameters etc.

Connection manager determines which access network the device is connected to and provides this information to other agents on end user device . In some embodiments connection manager also chooses a network connection based on available network connections and a network selection policy instruction from policy control agent .

Service monitor agent is responsible for accounting and reporting the access network service usage for end user device . In some embodiments the service monitoring e.g. a measure of the access network service usage is reported to a user of end user device . In some embodiments the service monitoring is reported to a network element. In some embodiments the access network service usage is classified by an application breakdown indicating the amount of service usage attributed to one or more applications. In some embodiments the access network service usage is classified by a network destination or network service breakdown indicating the amount of service usage attributed to one or more network destinations or network services. In some embodiments the access network service usage is classified by a network type breakdown indicating the amount of service usage attributed to one or more network types. In some embodiments the network type breakdown includes a roaming network. In some embodiments the network type breakdown includes a cellular network e.g. 2G 3G 4G etc. .

Policy control agent is responsible for monitoring application layer activity or traffic communication layer activity to identify conditions in which a network access policy should be implemented and then causing a policy enforcement agent for example application interface agent or policy implementation agent to apply the policy. In some embodiments policy control agent receives information about an end user device connection state from other device agents e.g. connection manager one of modem drivers modem selection and control an operating system function etc. to aid in determining the access network policy settings that should be applied at a given time. For example without limitation device connection state information can comprise one or more of application classification information network destination identifier information network service identifier information type of network information time of day or day of week information and geographic location information.

The access network policy instruction provided by policy control agent to a policy enforcement agent for example application interface agent or policy implementation agent can comprise a service usage accounting or charging policy in which the service usage is accounted and reported for the purpose of access network service usage accounting or billing. In some embodiments the service usage is accounted to or billed to a device account or device user account. In some embodiments the service usage accounting is accounted to or billed to a service sponsor account where the service sponsor is an entity that is not the device user or a subscriber associated with end user device . In some embodiments the service usage accounting or charging policy includes modifications in accounting policy based on one or more classifications of service usage and one or more device connection states with classifications of service usage and connection state including but not limited to those disclosed herein.

The access network policy instruction provided by policy control agent to a policy enforcement agent can comprise a service usage control policy wherein the service usage is governed limited or regulated according to a service plan policy. In some embodiments the service usage control policy includes modifications in control policy based on one or more classifications of service usage and one or more device connection states with classifications of service usage and connection state including but not limited to those disclosed herein.

The access network policy instruction provided by policy control agent to a policy enforcement agent can comprise a service notification policy in which a notification associated with the access network service is presented through a user interface of end user device e.g. user interface when a pre determined notification trigger condition is met. In some embodiments the notification indicates an amount of service used. In some embodiments the notification indicates an amount of service remaining. In some embodiments the notification comprises an offer to acquire service. In some embodiments the service notification policy includes modifications in control policy based on one or more classifications of service usage and one or more device connection states with classifications of service usage and connection state including but not limited to those disclosed herein. In some embodiments the notification includes an offer to acquire service based on the occurrence of a pre determined attempted or successful device access to an application or combination of applications. In some embodiments an offer to acquire service is based on the occurrence of a pre determined attempted or successful device access to a network destination or combination of network destinations. In some embodiments an offer to acquire service is based on detection of a condition in which a new service plan may be of interest to a device user who currently has an existing service plan or no service plan. In some embodiments the notification comprises an offer to increase a service allowance. In some embodiments the notification comprises an indication of potential or likely service usage. In some embodiments the notification indicates a roaming service usage. In some embodiments the notification comprises an offer to acquire roaming services. In some embodiments the notification indicates that service authorization is about to expire under a current service plan.

In some embodiments user interface provides a user of end user device with input capability to modify an access network service according to a user preference and or to receive access network service notifications. In some embodiments user interface accepts user inputs for modifying access network policy such as limiting access by one or more applications or access to one or more network destinations. In some embodiments user interface accepts user inputs for modifying end user device s access to particular access networks e.g. one or more roaming networks one or more cellular networks one or more WiFi networks etc. . In some embodiments user interface accepts user inputs for choosing or modifying a service plan.

Service control device link provides a secure communication link and heartbeat function between service processor and service controller . In some embodiments using the heartbeat function agents on end user device provide certain reports to service controller for the purpose of service policy implementation verification e.g. verification related reports on certain aspects of service processor or for other purposes. Such agent heartbeat messages can be sent unencrypted or encrypted signed or otherwise secured. In some embodiments these messages include one or more of an agent information message an agent check in message and an agent cross check message.

In some embodiments an agent information message is included in a agent heartbeat service policy implementation verification message which includes for example any information the agent needs to communicate to service controller as part of the operation of the service policy implementation system. For example an agent response to a service controller challenge as described below can be included in the agent heartbeat service policy implementation verification message.

In some embodiments an agent check in message is included in an agent heartbeat service policy implementation verification message which includes for example a transmission of a unique agent identifier secure unique identifier and or hashed encrypted and signed message beginning with some shared secret or state variable for the hash. For example an agent self check can be included in the agent heartbeat service policy implementation verification message which includes reporting on agent configuration agent operation agent code status agent communication log agent error flags and or other agent associated information potentially hashed encrypted signed or otherwise secured in the message e.g. using a shared secret unique to that agent .

In some embodiments an agent cross check message is included in the agent heartbeat service policy implementation verification message which includes for example reports on the status configuration operation observations communication log or other aspects of another agent. For example agent environment reports can be included in the agent heartbeat service policy implementation verification message which includes for example reports on certain aspects of the service processor operating environment such as software presence e.g. installation status of certain operating system and or application software and or components thereof observed communication with agents or communication attempts memory accesses or access attempts network accesses or access attempts software downloads or attempted downloads software removal or download blocking service policy implementation verification or compromise event error conditions with respect to the operating environment for service processor and or other messages regarding the verification or possibility of compromise associated with service processor operating environment or agents.

In some embodiments the agent heartbeat function also provides regular updates for information important to user service notification services. For example the network based elements can provide regular synchronization updates for the device based service usage or service activity counters in which service usage or service activity measures available from one or more network service history elements are transmitted to end user device . This allows the service usage counter errors between the device service counter and the counters used for central billing to be minimized. A common service usage or service activity measure is total traffic usage associated with one or more applications or one or more network destinations measured to date within a time frame over which a service limit is applicable. Other service usage or service activity measures can also be tracked and reconciled in a similar manner.

In some embodiments of the heartbeat function service controller verifies that the scheduled agent reports are being received and that the reports are within expected parameters. In some embodiments access control integrity server issues signed challenge response sequences to policy implementation agent . For example the challenges can be asynchronous issued when an event or error condition occurs issued on a schedule or issued when a certain amount of data has been used. This approach for example provides a second layer of service policy implementation verification that strengthens the service usage or service activity measurement verification. For example a challenge response can be sent over the heartbeat link for the purpose of verifying device agent integrity.

In some embodiments the challenge response heartbeat message can include sending any kind of command or query transmitted securely or transmitted in the open receiving a response from the agent and then evaluating the response to determine if the response is within a range of parameters expected for a correctly configured agent an agent that is operating properly an agent that is not partially compromised or an agent that is not entirely compromised. In some embodiments the agent is only required to respond with a simple acknowledgement of the challenge. In some embodiments the agent is required to respond with a message or piece of information that is known by the agent. In some embodiments the agent is required to respond with a message or piece of information that would be difficult for the agent to supply if it were to be partially or entirely compromised. In some embodiments the agent is required to respond back with information regarding the operation or configuration of the agent that would be difficult for the agent to supply if the agent were not properly configured not operating properly partially compromised or entirely compromised. In some embodiments a first agent is required to respond back with information regarding the operation configuration status or behavior of a second agent and this information is difficult for the first or second agent to supply if the first or second agent is not properly configured not operating properly is partially compromised or is entirely compromised. In some embodiments the agent is required to respond with a response that includes a shared secret. In some embodiments the agent is required to respond with information regarding the presence configuration operating characteristics or other information regarding other programs in the operating environment of the agent. In some embodiments the agent is required to respond with hashed information of portions of code or a code sample e.g. the code portion or code sample can be specified by service controller .

In some embodiments the information the agent responds with is a response to a signed or encrypted message from service controller and the agent must know how to decode the encrypted controller message in order to respond correctly or it would be difficult for the agent to respond properly if the agent is not configured properly is not operating within appropriate limits is partially compromised or is entirely compromised. In some embodiments the agent signs or encrypts information in such a manner that it is difficult for the agent to respond correctly and for service controller to decode the message unless the agent is configured properly is operating within appropriate limits is not partially compromised and is not entirely compromised. In some embodiments the agent is required to respond with a signed or encrypted hash of information that is difficult for the agent to generate unless the agent is configured properly is operating within appropriate limits is not partially compromised and is not entirely compromised. For example the hashed information can be local device configuration information portions of code or all of the code and or the code portion to be used in the response can be specified by service controller . In another example the hashed information the agent responds with can include a shared secret and or the hashed information can be information regarding the presence configuration operating characteristics or other information regarding other programs in the operating environment of the agent.

Accordingly as described above the agent heartbeat function provides an important and efficient system in some embodiments for verifying the service policy implementation or protecting against compromise events e.g. fraud . There are many other functions the agent heartbeat service can perform some are described herein and others will be apparent to one of ordinary skill in the art given the principles design background and various embodiments provided herein.

In some embodiments service downloader provides for one or more of download of application programs that have an associated service policy download of application credentials and download of service processor components or component updates. In some embodiments service downloader requires a secure signed version of software before a download is accepted. For example the download can require a unique key or credential. In some embodiments service downloader is stored or executed in secure memory or executes in a secure memory partition in the CPU memory space. Those of ordinary skill in the art will appreciate that there are a variety of other security techniques that can be used to ensure the integrity of service downloader .

Access control integrity agent monitors the operational integrity of one or more service processor elements to determine if unauthorized user modification or unauthorized user software program modification of the service processor configuration or operation has occurred. In some embodiments access control integrity agent collects device information on one or more of service policy service usage service activity agent configuration and agent behavior. In some embodiments access control integrity agent also cross checks this information to identify integrity breaches in the service policy implementation and control system. In some embodiments access control integrity agent initiates action when a service policy violation or a system integrity breach is suspected. In some embodiments access control integrity agent takes an action e.g. generating a fraud alert blocking end user device from accessing access network blocking an application from accessing access network directing the device to a quarantine network status in which end user device can for example only access functions generally controlled by the access network service provider or the central service provider etc. when unauthorized conditions are detected. In some embodiments access control integrity agent also performs asynchronous or periodic agent checks to verify the presence configuration or proper operation of other agents. In some embodiments access control integrity agent also performs challenge response sequence verification of other agents.

In some embodiments access control integrity agent monitors agent self check reports to verify that agents are properly configured. In some embodiments access control integrity agent reports the agent self check reports to service controller . In some embodiments access control integrity agent performs a role in service usage test transmission reception and or monitoring with the usage test being tailored to test monitoring or control aspects for any subset of service activities. In some embodiments access control integrity agent performs a role in billing test event generation and or monitoring. In some embodiments access control integrity agent checks and reports the result of service usage monitoring verification tests service usage billing verification tests and or transaction billing verification tests.

In some embodiments access control integrity agent receives agent access attempt reports to determine if unauthorized agent access attempts are occurring. In some embodiments access control integrity agent acts as a central secure communications hub for agent to agent or service controller to agent communication. For example access control integrity agent can be used so that no other software or function can access agents or so that agents cannot access other agents except through a secure point to multipoint communications hub. In some embodiments this approach further enhances compromise resistance for the agents. In some embodiments some or all of the agent communications including agent to agent or service controller to agent communications and possibly including unauthorized attempts to communicate with agents are monitored and logged so that a trace log of some or all agent communications can be maintained. For example the agent communication trace log can be summarized and or compressed for transmission efficiency or regularly reported such as through the heartbeat function or the agent communication trace log can be reported only when service controller requests the agent communication trace log or when there is a verification error event.

In some embodiments access control integrity agent obtains service usage or service activity measures from service monitor agent and compares one or more first service usage measurement points against one or more second service usage measurement points to verify service policy implementation.

As illustrated in the embodiment of service processor is in communication with service controller via access network and optionally including an additional connection path via Internet in embodiments in which service controller is not directly connected to access network such as the embodiment of . Service controller includes service control server link which provides a secure communication link and heartbeat function between service processor and service controller .

In some embodiments service history server records service usage reports for end user device . In some embodiments service history server collects and records service usage or service activity reports e.g. accounting reports from a network element e.g. access network AAA server or end user device e.g. service monitor agent . In some embodiments the service usage reports are generated by service processor . In some embodiments the service usage reports include service usage classification information e.g. usage per application per group of applications per network destination per group of applications per network type etc. as described herein.

Although service usage reports from the network elements can in certain embodiments be less detailed than service usage reports from end user device the reports from the network can provide a valuable source for verification of device service policy implementation because for example it is unlikely that a device error or compromise event on end user device will compromise network based equipment or software. In some embodiments service history server provides the service history on request to other servers and or one or more agents. In some embodiments service history server provides the service usage history to device service history .

In some embodiments policy management server includes storage of access network service policies that are provided to service processor from a network element. In some embodiments policy management server provides known application credentials to service processor . In some embodiments policy management server evaluates run time application credentials provided by service processor .

In some embodiments policy management server transmits policies to service processor via service control link . In some embodiments policy management server manages policy settings on end user device e.g. various policy settings as described herein with respect to various embodiments in accordance with a device service profile. In some embodiments policy management server sets instantaneous policies on policy implementation agents e.g. policy implementation agent . For example policy management server can issue policy settings monitor service usage and if necessary modify policy settings.

In some embodiments policy management server provides adaptive policy management on end user device . For example policy management server can issue policy settings and objectives and rely on the device based policy management e.g. by service processor for some or all of the policy adaptation. This approach can require less interaction with end user device thereby reducing network chatter on service control link for purposes of device policy management. This approach can also provide robust user privacy embodiments by allowing the user to configure the device policy for user privacy preferences settings so that for example sensitive information e.g. geo location data website history is not communicated to the network without the user s approval. In some embodiments policy management server adjusts service policy based on time of day. In some embodiments policy management server receives requests or otherwise obtains a measure of network availability and adjusts traffic shaping policy and or other policy settings based on available network capacity.

In some embodiments policy management server performs a service control algorithm to assist in managing overall network capacity or application QoS. In some embodiments policy management server performs an algorithm to determine which access network is best to connect to such as based on network capacity or application QoS service usage costs and or any other criteria.

In some embodiments access control integrity server monitors the integrity of the access policy system to establish a trusted service policy implementation. In some embodiments access control integrity server collects end user device information on service policy service usage agent configuration and or agent behavior. In some embodiments access control integrity server cross checks this information to identify integrity breaches in the service policy implementation and control system.

In some embodiments access control integrity server initiates action when a service policy violation or a system integrity breach or error is suspected or detected. In some embodiments access control integrity server and or some other agent of service controller acts on access control integrity agent reports and error conditions. In some embodiments checks performed by access control integrity agent include one or more of the following service usage measure against usage range consistent with policies e.g. usage measure from the network and or from the device configuration of agents operation of the agents and or dynamic agent download.

In some embodiments access control integrity server and or some other agent of service controller verifies device service policy implementations by comparing various service usage measures e.g. based on network monitored information and or local service usage monitoring information against expected service usage behavior given the policies that are intended to be in place. For example device service policy implementations can include measuring total data passed data passed that is associated with a particular application or group of applications data passed that is associated with a particular network destination or group of network destinations data passed in a period of time IP addresses data per IP address data per network data per network type and or other measures such as location downloads email accessed URLs etc. and comparing such measures to expected service usage behavior given the policies that are supposed to be in place.

In some embodiments access control integrity server and or some other agent of service controller verifies device service policy and the verification error conditions that can indicate a mismatch in service measure and service policy include one or more of the following unauthorized network access e.g. access beyond sponsored service policy limits unauthorized network speed e.g. average speed beyond service policy limit network data amount does not match policy limit e.g. device not stopping at limit without re up revising service policy unauthorized network address unauthorized service usage e.g. VOIP email and or web browsing when not authorized unauthorized application usage e.g. email VOIP email and or web when not authorized service usage rate too high for plan and policy controller not controlling throttling it down and or any other mismatch in service measure and service policy.

In some embodiments access control integrity server and or some other agent of service controller verifies device service policy based at least in part on for example various error conditions that indicate a mismatch in service measure and service policy. For example various verification error conditions that can indicate a mismatch in service measure and service policy include one or more of the following mismatch in one service measure and another service measure agent failure to report in agent failure to respond to queries e.g. challenge response sequence and or expected periodic agent reporting agent failure to respond correctly to challenge response sequence agent improperly configured agent failure in self checks agent failure in cross checks unauthorized agent communication or attempted unauthorized communication failure in service policy implementation test failure in service usage reporting test failure in service usage billing test failure in transaction billing test failure in download sequence environment compromise event such as unauthorized software load or execution or attempt unauthorized memory access or attempt unauthorized agent access or attempt known harmful software and or known harmful communications signature and or failure to respond to various messages such as send message and suspend and or send message and quarantine.

In some embodiments access control integrity server and or some other agent of service controller verifies device service policy by performing automated queries and analysis which are then reported e.g. anomalous suspicious report results can be reported for further analysis by a person responsible for determining whether such activities indicate out of policy activities or to provide information to the user to inform the user of such anomalous suspicious report results that may indicate out of policy activities . For example the user can review the report to authorize whether such activities were performed by the user e.g. website access requests specific transactions and or phone calls and or indicate that such activities were not authorized by the user e.g. indicate a potential compromise of the device such as by malware or other unauthorized software user use of the device . As another example the user can also be connected to communicate with service support of the service provider regarding such reported activities e.g. by text chat voice phone and or video conference to a service support . Accordingly in some embodiments access control integrity server and or some other agent of service controller provides a policy service control integrity service to verify e.g. periodically and or based on trigger events that the service control of the device has not been compromised and or is not behaving out of policy.

In some embodiments upon detection of one or more service verification errors such as the various service verification errors discussed above end user device is directed to a quarantine network status in which end user device can for example only access network control plane functions billing functions and other functions generally controlled by the access network service provider or the central service provider. In some embodiments end user device is completely suspended from the network. In some embodiments end user device s network access service capabilities and or traffic shaping are limited partially restricted or completely restricted. For example these limitations and or restrictions can be implemented in the device and or in the network. For example implementing a device quarantine e.g. using a RADIUS server to quarantine the device can involve assigning the device to a different billing profile.

In some embodiments service download control server provides for one or more of download of application programs that have an associated service policy download of application credentials and download of service processor components or component updates.

In some embodiments billing event server provides for billing of access network service usage. In some embodiments the billing is modified based on one or more of the classifications of access network service usage described herein. In some embodiments the billing is modified based on one or more of the device connection state conditions described herein.

In some embodiments device service history provides trusted e.g. network based third party based or certain device based service usage measures for billing purposes or for the purpose of verifying a trusted service policy implementation. In some embodiments a trusted service policy implementation is verified by service controller e.g. access control integrity server by comparing the trusted service usage records with the usage limitations expected to be in place if the service policy is being properly implemented by end user device . In some embodiments these trusted service usage measures include a classification of service usage based on application. In some embodiments these trusted service usage measures include a classification of service usage based on network destination or network service identifier. In some embodiments these trusted service usage measures include a classification of service usage based on network type. In some embodiments these trusted service usage measures include a classification of service usage based on time of day. In some embodiments these trusted service usage measures include a classification of service usage based on QoS class. In some embodiments these trusted service usage measures include a classification of service usage based on geography. In some embodiments these trusted service usage measures include a classification of service usage based on a roaming network.

In some embodiments central billing provides for billing of service usage. In some embodiments central billing provides a mediation function for central provider billing events. For example central billing can accept service plan changes. In some embodiments central billing provides updates on device service usage service plan limits and or service policies. In some embodiments central billing collects billing events formulates bills bills service users provides certain billing event data and service plan information to the service controller and or end user device .

In some embodiments access network AAA server assists in authentication of service processor by providing one or more of a device credential database a user credential database a service processor credential database and an authentication service for the device. In some embodiments access network AAA server provides the necessary access network AAA services e.g. access control and authorization functions for the device access layer to allow end user devices onto the central provider access network and the service provider network. In some embodiments access network AAA server also provides the ability to suspend service for a device and resume service for a device based on communications received from service controller . In some embodiments access network AAA server also provides the ability to direct routing for device traffic to a quarantine network or to restrict or limit network access when a device quarantine condition is invoked. In some embodiments access network AAA server also records and reports device network service usage e.g. to device service history .

Although many of the embodiments disclosed herein include service controller a service controller is not necessary in embodiments in which a user of end user device is in full control of access network policies via user interface . For example the user can determine access network service policies that limit service for end user device in general or for one or more of the access network service usage classifications described herein including application limitations network destination or network service limitations network type limitations etc. In some embodiments based solely on user preferences input via user interface of end user device the service processor access network service policy limitations can specify blocking allowing or capping service usage according to for example application application class or destination. In some embodiments these user defined limitations can be modified based on the type of network the device is connected to. In some embodiments these user defined limitations can be modified based on whether the user wishes to allow the access network communication activity for a given classification to occur in the background or not or to cap such service usage when end user device is connected to a particular network type e.g. a roaming network a cellular network a WiFi network etc. . In some embodiments these user defined limitations can be modified based on whether the user wishes to allow the access network communication activity for a given classification to occur while end user device is connected to a roaming network or to cap such service usage while end user device is roaming.

Internet provides a connection to user device application program sources e.g. third party app stores and user device application service destinations e.g. app developer servers and other websites servers or content sources connected to Internet . Application developer service design center SDC user interface UI provides a user interface to allow application developers or website developers who choose to sponsor e.g. partially or entirely subsidize access network usage costs associated with particular applications and or websites to define sponsored service parameters. Usage or transaction monitors track device usage of application developer servers e.g. by generating customer usage or transaction feedback for the purpose of verifying access network service policy for sponsored services.

Authentication credential server interfaces with application credential database with application policy database and with service controller . Authentication credential server has at least three embodiments each with a different mode of operation. In one embodiment or mode of operation authentication credential server provides application credentials and associated access network policies to end user device e.g. to service processor for the purpose of identifying a device application program and associating it with access network policies that are to be applied to attempted or successful access network communications associated with that application. A device application program credential can be a program identifier a name a signature a certificate a hash or any other identifier that uniquely identifies the application. In another embodiment or mode of operation authentication credential server receives a device application credential from end user device e.g. service processor determines if the credential matches a known application credential in application credential database and if so provides the associated application access service policy from application policy database to the device. In a variation of this embodiment if authentication credential server determines that the application credential does not match a known application credential in application credential database then in some embodiments authentication credential server retrieves an access policy associated with unknown applications from application policy database and provides it to end user device . In some embodiments in which the application credential does not match a known application credential end user device is informed that no policy exists for the application associated with the credential. In some embodiments in which the application credential does not match a known application credential no action is taken.

Carrier core network usage monitors monitor usage of access network resources by each end user device . Carrier core network usage monitors may include a deep packet inspection DPI element or any other network element capable of monitoring usage of access network resources by end user devices.

Service design center provides a means for specifying service plan policies for the access network service policy implementation system. Co pending U.S. patent application Ser. No. 13 248 025 which is entitled Service Design Center for Device Assisted Services and is incorporated herein by reference describes some of the information that may be configured via service design center . Examples of information that can be configured using service design center include but are not limited to a list of available service plans the priorities of listed service plans where the priorities identify the order in which the classification function on the end user device should apply filters associated with the available selected or purchased service plans e.g. to determine under which plan a particular service activity by an end user device falls how available service plans will be displayed on an end user device such as end user device a categorization of service plans e.g. whether a service plan is a temporary activation plan a sponsored plan subsidized or paid for by an entity other than a user or subscriber associated with the end user device a user paid plan etc. promotional messages to be displayed on one or more end user devices such as end user device upsell offers e.g. conditions that trigger the display of an upsell offer information characterizing the upsell offer etc. events that cause a no capable plan notification e.g. a notification that is presented when a user of an end user device that is not associated with or subscribed to an applicable data plan attempts to access a data service etc. on the end user device templates for notification messages e.g. message foregrounds and backgrounds colors logos etc. subscriber groups e.g. by importing a list manually typing individual subscriber identifiers etc. requests for reports containing information about a group of end user devices or a group of subscribers information about an end user device associated with a subscriber e.g. data usage measures service plan information cost or account balance information notification settings for the end user device etc. .

In some embodiments service usage reconciliation and fraud detection provides service usage comparisons for the purpose of service fraud detection and corrective action. As disclosed herein service usage measures used by service usage reconciliation and fraud detection can originate from end user device service usage measures trusted service usage measures e.g. measures from carrier core network usage monitors or another trusted source or both. As also disclosed herein the service usage measures can be associated with various classifications e.g. by application network destination device network connection state network type etc. . In some embodiments a trusted service policy implementation is verified by service controller by performing one or more of the following operations a comparing the trusted access network usage records with the usage limitations expected to be in place if the service policy is being properly implemented b comparing a trusted service usage measure against a device service processor based service usage measure c comparing a first device service processor service usage measure against a second device service processor service usage measure d comparing device service usage against a population statistic for the device based service usage measure.

In some embodiments service usage reconciliation and fraud detection uses customer usage or transaction feedback from usage or transaction monitors integrated into application developer servers to aid in detection of service policy error events. In some embodiments the service usage information provided from customer usage or transaction feedback is used to determine the service usage that should be accounted to an application classification service a website classification service a network content classification service or a network classification service defined by a connection to a network gateway proxy server or tunnel server e.g. an APN tunnel server a VPN tunnel server etc. . In some embodiments the service usage provided from customer usage or transaction feedback is compared to device based service usage measures to determine if the two measures are accurate to within a tolerance.

In some embodiments third party app stores provide end user device with an application program source for downloading device application programs associated with an access network policy. In some embodiments when as disclosed herein a device user interface notification offers a user a service plan comprising an application program and an associated access network policy for the application program and the application program is not pre loaded on the device when the user selects the service plan service processor automatically downloads the application from one of third party app stores .

In some embodiments application developer service design center UI allows application developers website developers or other Internet content providers or service providers to log into a sponsored service definition server in order to sign up for sponsored payments to subsidize user accounting for access network service usage for a certain application certain website certain content site certain shopping site or another Internet based service associated with a network destination a group of network destinations an application a group of applications a network type etc. In some embodiments an application credential can be uploaded or specified via application developer service design center UI and associated with a sponsored service plan policy. In some embodiments a network destination identifier can be uploaded or specified via application developer service design center UI and associated with a sponsored service plan policy.

The elements of service controller described herein can be implemented in various advantageous architectural embodiments to assist in securing device assisted services DAS . illustrates an example embodiment of a secure service controller architecture for DAS systems. shows several of the functions that may be accomplished by a service controller e.g. service controller that communicates with one or more end user devices over access network . In particular shows four service controller functions a portal function a file transfer function a gateway function and a credentialing function.

In the embodiment of the portal function is accomplished by portal user optional load balancer optional portal proxy server portal application server and database cluster . In some embodiments the portal function allows a user e.g. carrier personnel mobile virtual network operator MVNO personnel virtual service provider VSP personnel etc. to enter information to configure or manage access network services or end user devices such as by using service design center or application developer service design center UI . In some embodiments the portal function allows a portal user to collect information about provisioned end user devices e.g. reports containing information about an end user device s service plan activity reports containing information about an end user device s access network usage etc. . An example embodiment of the portal function is described in more detail below using .

In some embodiments the file transfer function allows secure file transfers between a carrier e.g. a service provider an MVNO a VSP etc. and the service controller. As illustrated in carrier file is placed on file server through optional load balancer . EAI server retrieves carrier file . In some embodiments EAI server processes carrier file . EAI server configures output file . In some embodiments EAI server configures output file using information in database cluster . EAI server places output file on file server . An example embodiment of the file transfer function is described below using .

In the embodiment of the credentialing function is accomplished by end user device optional load balancer optional credentialing proxy server credentialing application server and database cluster . In some embodiments the credentialing function authenticates end user devices and provides those devices with the credentials they need in order to communicate with the service controller gateway and to use access network services. An example embodiment of the credentialing function is described below using the example embodiment of .

In the embodiment of the gateway function is accomplished by end user device optional load balancer optional gateway proxy server gateway application server and database cluster . In some embodiments the gateway function supports an end user device s DAS communications including the sending of device based usage reports from end user device e.g. using service processor to service controller after the end user device has completed the credentialing procedure. An example embodiment of the gateway function is described below using .

In some service controller embodiments security is provided by making data flowing through the service controller accessible only to the functions and elements that process it. For example in the embodiment of information flowing from end user device to credentialing application server is not available to network elements supporting the portal file server or gateway functions. also illustrates several different security zones. The security zones are protected e.g. separated by firewalls that limit the reach of an entity once that entity has gained access to a hardware element or function within a hardware element that performs a service controller function. As would be understood by a person of ordinary skill in the art a firewall comprises one or more devices that permit or deny network traffic to pass through the firewall based on a set of rules. When interposed between two network elements a firewall can prevent unauthorized access between elements while permitting legitimate communications to pass. In the embodiment shown in once an entity has gained access to an element in one security zone the entity must pass through a firewall to communicate with an entity in a different security zone. For example firewall protects optional load balancer and portal proxy server from unauthorized access by portal user firewall protects portal application server from unauthorized access by optional portal proxy server and firewall protects database cluster from unauthorized entry by portal application server . Thus in order to gain access to database cluster portal user must successfully navigate through three firewalls.

The zone labeled App VLAN is the applications security zone. As illustrated in App VLAN includes portal application server EAI server message bus fraud server reconciliation server gateway application server and credentialing application server . illustrates direct communication paths between some of the elements within the App VLAN zone. For example there are direct communication paths between EAI server and portal application server between EAI server and message bus between fraud server and message bus between reconciliation server and message bus and between gateway application server and message bus . also shows that several of the elements within the App VLAN security zone do not communicate directly but rather use message bus . For example there is no direct communication path between EAI server and reconciliation server but both elements have communication paths with message bus . As would be appreciated by a person having ordinary skill in the art elements with communication paths through message bus could have direct communication paths and elements with direct communication paths could instead communicate using message bus . The communication paths shown in are merely exemplary.

Although shows the various elements within App VLAN as being within a single security zone a person of ordinary skill in the art would recognize that there may be multiple security zones separated by firewalls within the App VLAN zone to provide added security. For example there could be a firewall between portal application server and EAI server . Also although illustrates separate elements e.g. portal application server EAI server etc. within the App VLAN security zone this representation is merely a functional representation. As would be appreciated by a person having ordinary skill in the art in light of the disclosures herein some or all of the elements shown may be combined in a single element e.g. two or more of the illustrated elements could be performed by a single processor a single server etc. .

Although illustrates credentialing application server as not communicating with any of the other elements within the App VLAN security zone in some embodiments it may be advantageous for credentialing application server to communicate with other elements in the App VLAN security zone such as for example EAI server or portal application server to assist in tasks such as for example preventing a particular end user device or a particular subscriber from being allocated a credential or revoking the credential of a particular end user device or a particular subscriber. As another example in some embodiments credentialing application server communicates directly with fraud server to flag fraudulent uses of credentials.

Although illustrates firewalls as separate elements each physical machine implementing one or more functions or elements shown in could contain its own firewall. Furthermore each logical element in each layer could be further firewalled beyond what is shown in . As an example the logical elements that only communicate with message bus could be individually firewalled so they are only allowed to send traffic to and receive traffic from message bus .

As illustrated in in addition to communicating with portal application server and message bus EAI server communicates with carrier IT billing through firewall . In this embodiment EAI server has an interface that allows it to communicate with carrier IT billing . The information flowing to and from EAI server over the various communication paths shown in is described below in more detail using the example embodiment of .

Portal user end user device and carrier file access one or both of service controllers and through global load balancer which routes carrier file and communications to and from portal user and end user device . In some embodiments in which both of service controller and service controller are active global load balancer determines e.g. based on the level of busyness or outage state of elements within service controller and service controller whether to route a particular communication to service controller potentially through optional load balancer or to service controller potentially through optional load balancer . In some embodiments in which one of service controller and service controller is active and the other is in a stand by state global load balancer routes communications to and from the active service controller unless or until there is a need to use functions in the stand by service controller e.g. if one or more elements in the active service controller fail if the active service controller s ability to service communications becomes compromised for some reason etc. . The architecture shown in provides reliability in that a failure within either service controller or service controller will not disable the network s ability to provide service controller services to portal user end user device or carrier usage record . If for example one or more of the hardware elements responsible for credentialing function in service controller fails global load balancer can route credentialing requests from end user device to credentialing function in service controller . As will now be understood by a person of ordinary skill in the art in light of this disclosure additional service controllers may be deployed in a similar manner e.g. connected to load balancer load balancer or load balancer to provide redundancy and to help ensure service controller resources are available for DAS.

Portal user accesses optional portal proxy server if present through firewall and if present optional load balancer . In some embodiments portal user establishes a virtual private network VPN connection over the Internet to communicate with optional portal proxy server . If present optional portal proxy server communicates with portal application server through firewall .

As illustrated in portal application server also communicates with EAI server . In some embodiments portal application server sends instructions associated with the delivery of information to end user device to EAI server . In some embodiments the instructions cause EAI server to configure notification messages e.g. promotional messages offers advertisements etc. which EAI server then stores on database for gateway application server to retrieve and send to end user device . In some embodiments portal application server sends instructions to reset a subscriber or an end user device to EAI server . In some embodiments portal application server sends instructions to cancel an end user device service plan to EAI server . In some embodiments portal application server receives messages from EAI server that indicate EAI server carried out a requested task or completed its portion of a requested task that requires action by another network element.

Portal application server retrieves information from and stores information in database cluster by establishing a connection through firewall . In some embodiments portal application server retrieves information requested by portal user from database cluster . In some embodiments portal application server stores information entered by portal user in database cluster .

Notification agent and notification agent provide information to monitoring element . In some embodiments one or both of notification agents and are SNMP agents. In some embodiments the information provided by one or both of notification agents and includes unsolicited notifications of events e.g. disk full memory error SNMP traps etc. . In some embodiments information provided by one or both of notification agents and is in response to a request from monitoring element .

In some embodiments monitoring element responds to information sent by notification agent or . For example in some embodiments monitoring element sends notification agent or a message directing respectively portal proxy server or portal application server to perform an action e.g. run a program run a test query to validate that the system is functional run a program to determine whether a connected system is functional etc. . In some embodiments monitoring element directs portal proxy server to test the communication path to portal application server .

Log forwarder also sends information to monitoring element . In some embodiments log forwarder sends logs of accesses by or activities of portal users such as portal user to monitoring element . In some embodiments portal application server tracks system level commands and login attempts. In some embodiments log forwarder sends information about system level commands and login attempts to monitoring element . In some embodiments log forwarder sends information configured to assist in diagnosing problems with a system or service controller application. For example in some embodiments portal application server generates log files and log forwarder sends the log files to monitoring element . In some embodiments the log files are generated for individual service controller applications. In some embodiments log forwarder sends a system log an information log a debug log an error log information about a fatal event etc. In some embodiments monitoring element includes a log file harvester. In some embodiments portal application server initiates the transfer of information from log forwarder to monitoring element .

Carrier file can contain various information such as for example a measure of an access network usage by end user device information to provision an access network service for one or more end user devices such as end user device a list of end user devices or subscribers authorized to use a particular service.

In some embodiments carrier file comprises a subscriber list. A subscriber list includes one or more subscriber identifiers where a subscriber identifier is associated with a particular end user. As will be appreciated by a person having ordinary skill in the art a subscriber identifier may also be associated with a particular end user device or with a group of end user devices or the subscriber identifier may not be associated with any particular end user device. Examples of subscriber identifiers are an IMSI an MSID a MDN an MSISDN an MEID an ESN an IPv4 6 MAC or IP address a key a certificate a globally unique identifier GUID a unique identifier UID .

In some embodiments carrier file includes one or more flow data records FDRs . A flow data record contains detailed information related to one or more network communications e.g. source IP source port destination IP destination port bytes transmitted bytes received time flow started time flow ended traffic protocol e.g. TCP UDP etc. .

In some embodiments carrier file includes a plan catalog that includes information about service plans for the access network that are available to one or more end user devices. Examples of the information that may be included in a plan catalog are a list of service plans and their characteristics e.g. notification charging and control policies associated with each plan access network activities qualifying for each plan etc. the priorities of the service plans where the priorities identify the order in which the classification function on the end user device should evaluate the filters associated with the available service plans how the service plans are displayed on end user devices e.g. the order in which they are displayed etc. whether access network costs associated with a plan are paid by a sponsor entity or by a subscriber whether a plan is an activation plan e.g. a service plan that governs a device when a subscriber has not selected a plan promotional messages upsell offers subscriber groups notifications for which no service plan applies.

In some embodiments carrier file includes a list of end user devices or subscribers authorized to use a particular service e.g. a tethering service for sharing an access network connection with other devices through other input output ports on the end user device .

In some embodiments carrier file includes one or more classification rules. A classification rule is any rule that distinguishes between any characteristics of service plans subscribers end user devices network destinations or network types. For example a classification rule may distinguish between sponsor paid and subscriber paid service plans between applications or groups of applications between groups of subscribers between end user devices using valid profiles and those using fraudulent profiles between authorized network destinations and unauthorized destinations between network access types e.g. home roaming 2G 3G WiFi etc. between time of day rules etc.

In the embodiment shown in after being transferred to file server carrier file is transferred to EAI server . In some embodiments the transfer of carrier file to EAI server is initiated by EAI server . EAI server processes carrier file and generates output file . In some embodiments EAI server uses information from another source to generate output file . In some embodiments EAI server uses information from carrier file and information from end user device e.g. a data usage measure providing information about the end user device s use of the access network or of a particular service etc. to generate output file . In some embodiments EAI server uses information stored in database to generate output file . This information can include for example individualized or statistical information related to plan usage popularity of plans notification acknowledgements time of day usage statistics average use per plan subscriber info subscriber behavior etc. In some embodiments EAI server uses information from fraud server to generate output file . This information can include for example fraud alerts indicating that subscriber service plan usage activity has been detected as abnormal or fraudulent as well as a confidence score e.g. to indicate a level of confidence that the user is committing fraud end user device fraud events authentication issues etc. In some embodiments EAI server uses information from reconciliation server to generate output file . This information can include for example detailed or high level end user device service usage records including subscriber identifier device identifier service plan identifier service plan usage bytes start time of report end time of report etc. In some embodiments EAI server uses information from gateway application server to generate output file . This information can include for example information about users roles and permissions or user directory synchronization. In some embodiments EAI server uses information from portal application server to generate output file . This information can include for example usage reports requested by portal user subscriber data e.g. provisioning information import requests from portal user information about accesses by portal users information about revoked portal user access etc.

In some embodiments output file is a batch report. In some embodiments output file is a real time report. In some embodiments output file includes a measure of an access network usage or cost by an end user device such as end user device . In some embodiments output file is a charging data report CDR . In some embodiments output file includes a promotional message or advertisement. In some embodiments output file includes a subscriber list or an end user device list. In some embodiments output file includes information about a service plan purchase made by a user of an end user device such as end user device . In some embodiments output file includes information profiling an end user device s usage of the access network or of an access network service. In some embodiments output file includes a fraud alert. A fraud alert is any indication that the service controller or an end user device has detected activity or an event that suggests that an end user device may be being used in a manner that violates a policy e.g. a notification control or charging policy that should be in effect or that the end user device or device client has been tampered with in a way that compromises the security of the end user device or an element of the end user device e.g. a software application an agent an operating system etc. . A fraud alert may be in any form for example a simple flag or a message containing detailed information about the activity or event that caused the fraud alert to issue. A fraud alert can also include information such as for example the time the event was detected the associated subscriber identifier device identifier suggested remediation actions an error code a rule to be added in the network elements that perform policy charging and rules function PCRF or policy charging and enforcement function PCEF tasks or to the gateway GPRS support node GGSN or any other information that could be useful to understand or mitigate fraudulent activity.

In some embodiments EAI server initiates the transfer of output file to file server . In some embodiments the transfer of output file to file server is initiated by file server . In some embodiments output file transfer agent establishes a connection to file transfer agent to retrieve output file . In some embodiments output file transfer agent establishes a secure connection over the Internet to communicate with file transfer agent through firewall . In some embodiments file server pushes output file to output file transfer agent .

As illustrated in file server also includes notification agent notification agent and file transfer agent . Notification agent establishes a connection to message bus through firewall . In some embodiments notification agent places a message for EAI server on message bus to inform EAI server that carrier file is available on file server . This notification may be advantageous to increase the speed at which EAI server processes carrier file .

Notification agent provides information to monitoring element communicating through firewall . In some embodiments notification agent is an SNMP agent. In some embodiments the information provided by notification agent includes unsolicited notifications of events e.g. disk full memory error SNMP traps etc. . In some embodiments information provided by notification agent is in response to a request from monitoring element .

File transfer agent provides information to monitoring element through firewall . This information can include for example file transfer activity CPU load disk usage successful transfers failed transfers failed logins operating environment info e.g. ambient temperature humidity nominal voltage etc. system errors etc. In some embodiments monitoring element initiates the transfer of information from file transfer agent .

In the embodiment shown in end user device can receive a variety of information from gateway application server . For example end user device can receive information or instructions based on entries by portal user e.g. available service plans how to present the available service plans on a user interface service plan classifications e.g. user paid sponsored etc. promotional messages service offers notification messages etc. . As another example end user device can receive information in response to a request from end user device e.g. a request for an account balance a request for a record of purchase history etc. . As another example end user device can receive administrative content such as for example software updates.

In some embodiments gateway application server determines when to send information to end user device . In some embodiments gateway application server sends information to end user device after completing an authentication protocol. In some embodiments gateway application server sends information to end user device in response to request or activity by another element or function in the service controller e.g. EAI server portal application server fraud server reconciliation server or credentialing application server . In some embodiments gateway application server sends information to end user device in response to a communication from end user device . In some embodiments the communication from end user device is a message in an authentication protocol. In some embodiments gateway application server sends information to end user device over a secure communication link.

As illustrated in end user device can also send information to gateway application server . For example end user device may send reports containing measures of or costs associated with end user device s access network usage user acknowledgments or responses to notification messages device detected fraud events authentication messages heartbeats e.g. communications sent at regular intervals to provide information about the status of end user device such as for example to indicate that end user device is functioning properly or requests e.g. to purchase a service plan to retrieve a purchase history to check an account balance etc. . As will now be understood by a person having ordinary skill in the art in view of the disclosures herein the communication link between end user device and gateway application server can be used to support a wide variety of information exchanges between end user device and the service controller.

As illustrated in gateway application server is also capable of receiving information through message bus . In some embodiments gateway application server passes messages only within the same security zone. In some embodiments gateway application server receives information through message bus from portal user or from EAI server . As mentioned previously message bus may be any inter process communication mechanism and may be different between different pairs of elements. In some embodiments message bus provides web services connectivity between EAI server and gateway application server and EAI server uses web services to send information to gateway application server . In some embodiments the web services calls occur only within the same security zone.

Gateway application server retrieves information from and stores information in database cluster communicating through firewall . In some embodiments gateway application server stores information from end user device in database cluster . In some embodiments gateway application server retrieves queued messages destined for end user device from database cluster . For example gateway application server may retrieve from database and send to end user device one or more of the following types of information control charging or notification policies promotional messages service plan updates end user device configuration updates e.g. related to the look and feel of a user interface on end user device etc. a link to a software download.

In some embodiments gateway application server receives an authentication request from end user device and based on the authentication request retrieves a stored credential from database cluster to assist in authenticating end user device . In some embodiments the authentication request from end user device comprises a credential associated with end user device or associated with a subscriber. In some embodiments the credential is associated with a device identifier or a subscriber identifier or both a device identifier and a subscriber identifier. In some embodiments the credential is one or more of a certificate a key a shared secret a password a hash or a shared algorithm. In some embodiments gateway application server determines based on the received credential and the stored credential whether to proceed with communications with end user device . In some embodiments gateway application server determines whether the credential sent by end user device is valid. In some embodiments gateway application server checks whether the credential sent by end user device has been revoked. In some embodiments gateway application determines whether the credential sent by end user device appears on a revocation list. In some embodiments if the credential is a certificate gateway application server checks whether the certificate is on a certificate revocation list where the certificate revocation list may be stored within or external to service controller e.g. in database cluster in credentialing application server in a separate certificate revocation list server etc. .

In some embodiments if the credential sent by end user device is valid gateway application server communicates with end user device using the credential for the purpose of exchanging service related information or software. In some embodiments the communication using the credential is over a secure communication link. In some embodiments the secure communication link uses the SSL protocol. In some embodiments the service related information comprises a plan catalog. In some embodiments the service related information comprises a control charging or notification policy. In some embodiments the service related information comprises a promotional message or advertisement. In some embodiments the service related information comprises a usage measure or a cost measure. In some embodiments the service related information comprises an account balance. In some embodiments the service related information comprises a fraud alert. In some embodiments the service related information comprises a request from end user device . In some embodiments the service related information comprises a response to a request from end user device . In some embodiments the service related information comprises a request to end user device . In some embodiments the service related information comprises a response to a request to end user device . In some embodiments the service related information is configured to cause end user device to take a specific action. In some embodiments the specific action is to be taken immediately. In other embodiments the specific action is to be scheduled. In some embodiments the specific action is to block allow rate limit or delay access to the access network by end user device .

Notification agent and notification agent provide information to monitoring element . In some embodiments one or both of notification agents and are SNMP agents. In some embodiments the information provided by one or both of notification agents and includes unsolicited notifications of events e.g. disk full memory error SNMP traps etc. . In some embodiments information provided by one or both of notification agents and is in response to a request from monitoring element .

In some embodiments monitoring element responds to information sent by notification agent or . For example in some embodiments monitoring element sends notification agent or a message directing respectively gateway proxy server or gateway application server to perform an action e.g. run a program run a test query to validate that the system is functional run a program to determine whether a connected system is functional etc. . In some embodiments monitoring element directs gateway proxy server to test the communication path to gateway application server .

Log forwarder also sends information to monitoring element . In some embodiments log forwarder sends information configured to assist in diagnosing problems with a system or service controller application. For example in some embodiments gateway application server generates log files and log forwarder sends the log files to monitoring element . In some embodiments the log files are generated for individual service controller applications. In some embodiments log forwarder sends a system log an information log a debug log an error log information about a fatal event etc. In some embodiments gateway application server initiates the transfer of information from log forwarder to monitoring element .

As described herein the credentialing function enhances the security of DAS systems. In some embodiments credentialing application server receives a request from end user device e.g. using service processor for a credential. In some embodiments the credential request from end user device to credentialing application server includes a device identifier e.g. any identifier associated with the end user device and a subscriber identifier e.g. any identifier associated with the subscriber who uses or authorizes the use of the end user device . In some embodiments the credential request comprises a hash of a device identifier and a subscriber identifier. In some embodiments the hash is salted. In some embodiments credentialing application server generates a credential based on the credential request from end user device stores the credential in database cluster and sends the credential to end user device . In some embodiments credentialing application server stores the device identifier and the new credential separately in database cluster . In some embodiments credentialing application server stores the device identifier and new credential as a single entry comprising their combination e.g. a hash . In some embodiments end user device stores the credential in local memory and thereafter uses the credential for secure communications with the service controller e.g. with gateway application server .

Notification agent and notification agent provide information to monitoring element . In some embodiments one or both of notification agents and are SNMP agents. In some embodiments the information provided by one or both of notification agents and includes unsolicited notifications of events e.g. disk full memory error SNMP traps etc. . In some embodiments information provided by one or both of notification agents and is in response to a request from monitoring element .

In some embodiments monitoring element responds to information sent by notification agent and . For example in some embodiments monitoring element sends notification agent and a message directing respectively credentialing proxy server or credentialing application server to perform an action e.g. run a program run a test query to validate that the system is functional run a program to determine whether a connected system is functional etc. . In some embodiments monitoring element directs credentialing proxy server to test the communication path to credentialing application server .

Log forwarder also sends information to monitoring element . In some embodiments log forwarder sends information configured to assist in diagnosing problems with a system or service controller application. For example in some embodiments credentialing application server generates log files and log forwarder sends the log files to monitoring element . In some embodiments the log files are generated for individual service controller applications. In some embodiments log forwarder sends a system log an information log a debug log an error log information about a fatal event etc. In some embodiments credentialing application server initiates the transfer of information from log forwarder to monitoring element .

EAI server also communicates directly with portal application server through web services interface . EAI server communicates with carrier IT billing using EAI interface with information passing through firewall .

EAI server communicates through firewall with database cluster . In some embodiments EAI server retrieves service related information from database cluster e.g. information entered by or derived from information entered by portal user and provides the information to gateway application server for sending to end user device .

In some embodiments monitoring element responds to information sent by notification agent . For example in some embodiments monitoring element sends notification agent a message directing EAI server to perform an action e.g. run a program run a test query to validate that the system is functional run a program to determine whether a connected system is functional etc. .

Log forwarder also sends information to monitoring element . In some embodiments log forwarder sends information configured to assist in diagnosing problems with a system or service controller application. For example in some embodiments EAI server generates log files and log forwarder sends the log files to monitoring element . In some embodiments the log files are generated for individual service controller applications. In some embodiments log forwarder sends a system log an information log a debug log an error log information about a fatal event etc. In some embodiments EAI server initiates the transfer of information from log forwarder to monitoring element .

As illustrated in fraud server includes notification agent and log forwarder . Notification agent provides information to monitoring element . In some embodiments notification agent is an SNMP agent. In some embodiments the information provided by notification agent includes unsolicited notifications of events e.g. disk full memory error SNMP traps etc. . In some embodiments information provided by notification agent is in response to a request from monitoring element .

In some embodiments monitoring element responds to information sent by notification agent . For example in some embodiments monitoring element sends notification agent a message directing fraud server to perform an action e.g. run a program run a test query to validate that the system is functional run a program to determine whether a connected system is functional etc. .

Log forwarder also sends information to monitoring element . In some embodiments log forwarder sends information configured to assist in diagnosing problems with a system or service controller application. For example in some embodiments fraud server generates log files and log forwarder sends the log files to monitoring element . In some embodiments the log files are generated for individual service controller applications. In some embodiments log forwarder sends a system log an information log a debug log an error log information about a fatal event etc. In some embodiments fraud server initiates the transfer of information from log forwarder to monitoring element .

As illustrated in reconciliation server includes notification agent and log forwarder . Notification agent provides information to monitoring element . In some embodiments notification agent is an SNMP agent. In some embodiments the information provided by notification agent includes unsolicited notifications of events e.g. disk full memory error SNMP traps etc. . In some embodiments information provided by notification agent is in response to a request from monitoring element .

In some embodiments monitoring element responds to information sent by notification agent . For example in some embodiments monitoring element sends notification agent a message directing reconciliation server to perform an action e.g. run a program run a test query to validate that the system is functional run a program to determine whether a connected system is functional etc. .

Log forwarder also sends information to monitoring element . In some embodiments log forwarder sends information configured to assist in diagnosing problems with a system or service controller application. For example in some embodiments reconciliation server generates log files and log forwarder sends the log files to monitoring element . In some embodiments the log files are generated for individual service controller applications. In some embodiments log forwarder sends a system log an information log a debug log an error log information about a fatal event etc. In some embodiments reconciliation server initiates the transfer of information from log forwarder to monitoring element .

As illustrated in message bus includes notification agent and log forwarder . Notification agent provides information to monitoring element . In some embodiments notification agent is an SNMP agent. In some embodiments the information provided by notification agent includes unsolicited notifications of events e.g. disk full memory error SNMP traps etc. . In some embodiments information provided by notification agent is in response to a request from monitoring element .

In some embodiments monitoring element responds to information sent by notification agent . For example in some embodiments monitoring element sends notification agent a message directing message bus to perform an action e.g. run a program run a test query to validate that the system is functional run a program to determine whether a connected system is functional etc. .

Log forwarder also sends information to monitoring element . In some embodiments log forwarder sends information configured to assist in diagnosing problems with a system or service controller application. For example in some embodiments message bus generates log files and log forwarder sends the log files to monitoring element . In some embodiments the log files are generated for individual service controller applications. In some embodiments log forwarder sends a system log an information log a debug log an error log information about a fatal event etc. In some embodiments message bus initiates the transfer of information from log forwarder to monitoring element .

As illustrated in database node also includes notification agent and log forwarder which communicate with monitoring element through firewall . Notification agent provides information to monitoring element . In some embodiments notification agent is an SNMP agent. In some embodiments the information provided by notification agent includes unsolicited notifications of events e.g. disk full memory error SNMP traps etc. . In some embodiments information provided by notification agent is in response to a request from monitoring element .

In some embodiments monitoring element responds to information sent by notification agent . For example in some embodiments monitoring element sends notification agent a message directing database node to perform an action e.g. run a program run a test query to validate that the system is functional run a program to determine whether a connected system is functional etc. .

Log forwarder also sends information to monitoring element . In some embodiments log forwarder sends information configured to assist in diagnosing problems with a system or service controller application. For example in some embodiments database node generates log files and log forwarder sends the log files to monitoring element . In some embodiments the log files are generated for individual service controller applications. In some embodiments log forwarder sends a system log an information log a debug log an error log information about a fatal event etc. In some embodiments database node initiates the transfer of information from log forwarder to monitoring element .

In some embodiments it is advantageous to store or implement certain portions or all of service processor e.g. agents etc. in protected or secure memory so that other undesired programs and or unauthorized users have difficulty accessing the functions or software in service processor . In some embodiments service processor at least in part is placed in a secure area of the operating system e.g. in a kernel so that it cannot be removed or if it is removed it must be replaced for proper device operation to resume. In some embodiments service processor at least in part is implemented in and or stored on secure non volatile memory e.g. non volatile memory can be secure non volatile memory that is not accessible without pass keys and or other security mechanisms. In some embodiments the ability to load at least a portion of service processor software into protected non volatile memory also requires a secure key and or signature and or requires that the service processor software components being loaded into non volatile memory are also securely encrypted and appropriately signed by an authority that is trusted by a secure software downloader function such as service downloader shown in . In some embodiments a secure software download embodiment also uses a secure non volatile memory. Those of ordinary skill in the art will also appreciate that all memory can be on chip off chip on board and or off board.

Agent communication bus represents a functional description for providing communication for the various service processor agents and functions. In some embodiments such as the embodiment shown in the architecture of agent communication bus is generally multipoint to multipoint so that any agent can communicate with any other agent service controller or in some cases other components of end user device such as user interface and or modem components. The architecture can also be point to point for certain agents or communication transactions or point to multipoint within the agent framework so that all agent communication can be concentrated or secured or controlled or restricted or logged or reported. In some embodiments agent communication bus is secured signed encrypted hidden partitioned and or otherwise protected from unauthorized monitoring or usage.

In some embodiments there are multiple layers of security applied to agent communication bus communication protocols such as including one or more of the following point to point message exchange encryption using one or more keys that are partially shared or shared within the service processor agent group and or service controller point to point message exchange that using one or more keys that are private to the two endpoints of the communication a bus level message exchange encryption that can be in place of or in addition to other encryption or security or using one or more keys that are partially shared or shared within the service processor agent group and or service controller a set of secure messages that can only be decoded or observed by the agents they are intended for a set of secure messages that allow communication between certain agents or service processor functions and entities outside of the service processor operating environment. In some embodiments and as described herein service control device link is assumed to be equivalent to an agent for communication purposes and in the case of service control device link the communication is not restricted to agent communication bus but also extends to service control communications link . In some embodiments the system has the capability to replace keys or signatures on occasion or on a regular basis to further secure against monitoring eavesdropping or compromise of the agent communication system.

Various forms of message encryption and security framework techniques can be applied to encrypt and or secure agent communication bus including one or more of the following agent bus encryption using shared key for all agents provided and updated by the secure server agent bus encryption using point to point keys in which the secure server informs the bus and agents of keys and updates as appropriate agent level encryption using agent to agent shared keys in which the secure server informs agents of the key and updates the key as appropriate agent level encryption using agent to agent point to point key in which the secure server informs agent of the point to point keys that are required and updates the keys as appropriate agent level access authorization which only allows access to the agents that are on the secure authorization list and in which the list is provided by the secure server and signatures are provided by the secure server user interface UI messages are only analyzed and passed in which user interface cannot have access to configuration information and cannot issue challenges agent level heartbeat encryption which can be point to point or shared key for that agent control link level heartbeat encryption TLS Transport Layer Security communication protocols server level heartbeat encryption which can be point to point or shared key for that secure server and or access control integrity agent or heartbeat function can become point to multipoint secure communications hubs.

In some embodiments the design of agent communication bus depends on the nature of the design embodiments for the agents and or other functions. For example if the agents are implemented largely or entirely in software then agent communication bus can be implemented as an inter process software communication bus. In some embodiments such an inter process software communication bus is a variant of D bus e.g. a message bus system for inter process software communication that for example helps applications agents to talk to one another or another inter process communication protocol or system running a session bus in which all communications over the session bus can be secured signed encrypted or otherwise protected. For example the session bus can be further protected by storing all software e.g. software components applications and or agents in secure memory storing all software in encrypted form in secure memory and or executing all software and communications within a secure execution environment hardware environment and or protected memory space. In some embodiments if the agents and other functions are designed with a mixture of software and hardware or primarily with hardware then the implementation of the bus design will vary and the principles and embodiments described herein will enable one of ordinary skill in the art to design the specifics of agent communication bus to meet a particular set of product and desired functional requirements.

In some embodiments service processor includes a DDR processor located in a secure execution environment and this DDR processor can be used advantageously to improve security of device assisted services systems. Co pending U.S. patent application Ser. No. 13 247 998 entitled Secured Device Data Records and incorporated by reference herein describes embodiments of a DDR processor. In some embodiments the DDR processor sends a sequence of secure device data records DDRs to a network element e.g. via a secure channel . In some embodiments the DDR processor is configured with an access controller that restricts end user device s network access to a predetermined set of network destinations or functions if any of the DDR processor service processor or service controller detects an error or potential fraud in one or more reports in the sequence of secure DDRs.

In some embodiments before service processor of end user device participates in device assisted services it enrolls with service controller . In the enrollment process service controller using e.g. credentialing application server a network element such as authentication credential server etc. allocates a device credential to service processor . In some embodiments the credential is one or more of a certificate a key a shared secret a password a hash a shared algorithm or any other item of information that allows service controller to confirm the identity of service processor . After service controller has allocated the device credential service controller can use the device credential when it needs to authenticate service processor such as for example before end user device sends device based usage reports to gateway application server .

If end user device successfully verifies the service controller credential signing chain in step at step end user device generates a credential signing request using the service controller credential received in step . In some embodiments the credential signing request comprises a subscriber identifier and a device identifier. At step end user device sends the credential signing request to the service controller. In some embodiments the credential signing request comprises a challenge password. At step end user device receives a device credential from service controller . At step end user device stores the device credential in local memory. In some embodiments service controller e.g. credentialing application server comprises a simple certificate enrollment protocol SCEP server and the credential is a certificate. In some embodiments messages sent and received by end user device are encrypted. In some embodiments the service controller credential and device credential are 2048 bit RSA public key credentials. In some embodiments service controller and end user device communicate using a session key.

Although the steps are presented in in a particular order as will be appreciated by a person having ordinary skill in the art in light of the disclosures herein the ordering of some steps can be modified. As simple examples steps and of can be interchanged and in step can be performed before step can be performed before step etc.

In some embodiments service controller is configured to allocate multiple credentials to different end user devices associated with a single subscriber identifier. illustrates an example of such an embodiment. As shown in at step service controller e.g. using credentialing application server receives an authentication request comprising a device identifier and a subscriber identifier from end user device . At step service controller verifies that the subscriber identifier is listed in database cluster . If the subscriber identifier is listed in database cluster at step service controller verifies that the device identifier sent by end user device is not already in database cluster . If the device identifier sent by end user device is not already in database cluster at step service controller obtains e.g. by generating or allocating a new credential for end user device . At step service controller stores both the device identifier and the new credential in database as associated with the subscriber identifier. In some embodiments the device identifier and the new credential are stored in separate fields of database cluster . In some embodiments the device identifier and new credential are stored as a single entry comprising their combination e.g. a hash . In some embodiments service controller monitors or tracks end user device enrollment attempts. In some embodiments credentialing application server or another element of the service controller e.g. a fraud element such as fraud server notifies the carrier about credentialing enrollment attempts successful enrollments or unsuccessful enrollments.

To achieve an overall network service policy the network portion of the access network service policy may be configured to work in conjunction with the device based portion of the access network service policy to achieve an overall combined network service policy. If the device agents required to implement the device portion of the access network service policy are not present on the device or are not properly configured because of tampering or other undesirable activities then the overall combined network service policy can be in error or may not be possible to achieve potentially resulting in an undesired network service policy implementation. In such cases it is desirable for a network system to be employed to detect this condition and modify the network portion of an access network service policy enforced by the network based elements so that a desired network service policy enforcement may be achieved.

Examples of when it may be advantageous to adapt the network portion of an access network service policy in order to account for a missing or improperly configured service processor include but are not limited to i a device credential has been moved to a device that does not have a service processor ii a device credential has been moved to a device with a service processor with a different configuration than the service processor originally associated with the device credential iii a device service processor has been tampered with or has an improper configuration.

In some embodiments service controller detects the presence and proper configuration of a service processor or lack thereof in the end user device. If the service processor is present and properly configured service controller causes a first network portion of an access network service policy to be enforced in the network the first network portion of an access network service policy being configured to provide counterpart policy enforcement to a device portion of an access network service policy to achieve a first desired overall access network service policy. If on the other hand the service processor is not both present and properly configured service controller causes a second network portion of an access network service policy to be enforced in the network wherein the second network portion of the access network service policy is configured to operate without a device counterpart policy to achieve a second desired overall access network service policy.

In some embodiments a trusted service policy implementation comprises service controller authenticating and authorizing service processor . In some embodiments the authentication comprises receiving and confirming a service processor certificate. In some embodiments the authentication comprises receiving and confirming a service processor certificate that is based on a shared secret between service processor and service controller . In some embodiments the shared secret is unique for a given service processor .

In some embodiments the process to establish a trusted service policy implementation comprises service processor sharing two or more types of credentials with service controller wherein the credentials include two or more of a service processor credential a device credential and a user or subscriber credential. In some embodiments a portion of the process to establish a trusted service policy implementation includes end user device e.g. service processor sharing a service processor credential a device credential and a user or subscriber credential with service controller .

In some embodiments establishing a trusted service policy implementation comprises service controller receiving a certificate or hash result from a service processor element or agent acting on a portion of service processor for example access control integrity agent performing a hash or certificate check on another service processor agent .

One or more authentication errors may occur when service controller attempts to authenticate service processor . For example service processor may have invalid credentials. As another example service processor may send invalid application or kernel signatures. As another example service processor may report end user device root detection errors. As another example service processor may contact service controller using an identifier that is already in use by a different end user device.

If service controller does not receive the request from service processor within the pre determined time or if service controller is unable to authenticate service processor for some reason service controller assumes that either 1 end user device does not contain a service processor and is therefore unable to participate in device assisted services or 2 although end user device has a service processor service processor has been disabled. Service controller sends a notification No active SP message to data rating element to indicate that end user device does not have the ability to provide the information necessary for data mediation element to generate detailed data usage reports referred to herein as micro CDRs . In some embodiments service controller sends a trigger to data mediation element to indicate that end user device should be charged for usage at standard bulk rates. In some embodiments service controller specifies a standard bulk rate charging code in the charging data records CDRs it sends to data mediation element . In some embodiments data rating element determines data usage by end user device based on carrier based records e.g. records of end user device s usage of data over access network .

If service controller receives the login or authentication request from service processor within the pre determined time and successfully authenticates service processor service controller sends a notification Device OK message to data rating element to indicate that end user device has a service processor and is capable of supporting device assisted services. In some embodiments data rating element expects to receive micro CDR reports from data mediation element when service controller has determined that end user device has an active service processor. In some embodiments data rating element determines usage based on the micro CDRs which contain more granular information than ordinary CDRs. For example whereas an ordinary CDR might simply report that an end user device used 100 Megabytes MB of data a set of micro CDRs might report that the end user device used 15 MB of e mail 35 MB of social networking and 50 MB of streaming video.

In some embodiments data mediation element sends carrier based usage reports e.g. CDRs to service controller . Service controller queries usage database for device based usage reports e.g. micro CDRs for end user device . Service controller determines the data usage of end user device from the carrier based usage reports. Service controller also determines the data usage of end user device from the device based usage reports. In some embodiments described in more detail below service controller compares the usage determined from the carrier based usage reports to the usage determined from the device based usage reports. If service controller determines that the two usage measures do not match e.g. are not identical or are not within a threshold of each other service controller sends a notification e.g. a fraud alert to data rating element to indicate that the end user device is in a potential fraud state and data rating element should bill usage for end user device based on carrier based usage reports. Service controller sends the carrier based usage reports and device based usage reports to data mediation element .

When the GPRS detach message is received by SGSN SGSN sends a notification to service controller that the data session for end user device is closed.

Service processor may successfully authenticate with service controller but then subsequently send one or more fraud notifications. Examples of device fraud notifications that service processor might send are invalid service processor kernel signature invalid service processor framework signature invalid service processor application signature service processor application unable to connect to service processor kernel service processor application not receiving heartbeat messages from service processor kernel service processor kernel missing service processor framework missing service processor application missing hosts file tampered with or missing service processor to service controller encryption failure or device root detected. In some embodiments in response to receiving a device fraud notification from service processor service controller generates a fraud alert.

In some embodiments establishing a trusted service policy implementation comprises two service processor elements performing a mutual authentication of one another and then acting on an error result if one occurs. illustrates an example embodiment of a procedure that a verifying software component on end user device may perform to verify the integrity of another software component on end user device . Each of the software components can be for example a kernel a library an executable file one or more interpreted machine readable instructions a script a service processor or any other software component.

At step a verifying software component obtains the public key of a to be verified software component. At step the verifying software component generates a random number. At step the verifying software component generates an encrypted challenge using the random number and the to be verified software component s public key. At step the verifying software component sends the encrypted challenge to the to be verified software component. At step the verifying software component obtains an encrypted response from the to be verified software component. At step the verifying software component obtains its own private key. At step the verifying software component uses its own private key and the encrypted response to obtain a first decoded random number. At step the verifying software component verifies that the first decoded random number matches the generated random number. In some embodiments if the first decoded random number does not match the generated random number the verifying software component takes an action. In some embodiments if the to be verified software component is an application the action comprises restricting the application s ability to communicate over an access network. In some embodiments the action comprises notifying a user of end user device . In some embodiments the action comprises notifying a network administrator. In some embodiments if the to be verified software component is an application the action is to apply a policy to attempted or successful communications associated with the application. In some embodiments the action is to take a countermeasure such as for example preventing a user from accessing the to be verified software component preventing the to be verified software component from executing or terminating the to be verified software component if it is running .

In some embodiments if in step the first decoded random number matches the generated random number the verifying software component sends a message to service controller or another network element indicating that the to be verified software component passed the test.

In some embodiments an installed software application on end user device cannot be modified updated or replaced unless the software purporting to be a modification update or replacement includes a credential that matches a credential associated with the installed application. In some embodiments the installed application credential is a name identifier. In some embodiments the installed application credential is a secure signature certificate or hash of the installed software application. In some embodiments the installed application credential is stored on end user device . In some embodiments the installed application credential is accessible to service processor for example via policy control agent . In some embodiments when an attempt is made to modify update or replace the installed software application service processor and or a device operating system OS obtains both the installed application credential and a credential associated with the purported modification update or replacement. If the credential associated with the purported modification update or replacement matches the installed application credential service processor allows the installed application to be modified updated or replaced.

If at step the credential associated with the software purporting to be a modification update or replacement of the installed software application does not match the credential associated with the installed software application then at step a component of end user device e.g. service processor or an operating system takes a fraud action. In some embodiments the fraud action comprises restricting end user device s access to an access network. In some embodiments the fraud action comprises restricting an application s e.g. the installed software application s ability to communicate over an access network. In some embodiments the fraud action comprises notifying a user of end user device . In some embodiments the fraud action comprises notifying a network administrator or a network element of the credential mismatch. In some embodiments the fraud action comprises applying a pre determined billing rate for service usage by end user device . In some embodiments the fraud action comprises applying a pre determined billing rate to service usage associated with the installed software application.

In some embodiments end user device stores in memory e.g. application program store of an application program configured to execute on end user device to access one or more data services over an access network. The application program is associated with a credential that is also stored on end user device e.g. in application program store in application credential and policy store etc. . End user device also stores e.g. in application credential and policy store a network access policy comprising one or more first instructions to be applied when the application program initiates or attempts to initiate communications over the first wireless access network. A device agent or a combination of device agents e.g. application interface agent policy implementation agent modem selection and control etc. determines when the application program initiates or attempts to initiate a communication over the access network e.g. by monitoring end user device traffic flows etc. and applies the network access policy to the communication over the access network.

In some embodiments end user device further comprises one or more device agents e.g. service downloader access control integrity agent service monitor agent etc. that detect when an entity e.g. a user of end user device service controller etc. wishes or attempts to install update software on end user device where the update software purports to be a modification update or replacement of the application program. To improve security the one or more device agents prevent modifications updates and replacements of the application software unless a credential associated with the purported update matches a credential of the installed application. For example the one or more device agents obtain a credential associated with the application program that is already installed on end user device and a credential associated with a purported update to the installed application program. If the one or more device agents determine that the credentials match they allow the update software to be installed or to execute on end user device .

In some embodiments security of end user device is enhanced using agents on end user device . In some embodiments an agent on end user device e.g. policy implementation agent policy control agent access control integrity agent or any other agent that can perform verification functions determines if a hosts file is present on the end user device and configured in an expected manner. If the hosts file is not present or is not configured in an expected manner in some embodiments the agent takes an action. In some embodiments the action is to generate a fraud alert. In some embodiments the action is to take a countermeasure such as for example to block delay rate limit or quarantine access to the access network by end user device . In some embodiments the action is to provide a notification to a user of end user device . In some embodiments the action is to send a message to service controller .

In some embodiments an agent on end user device e.g. policy implementation agent policy control agent access control integrity agent or any other agent that can perform verification functions determines if service processor successfully completed the authentication procedure with service controller . In some embodiments if the agent determines that service processor has failed to complete the authentication procedure the agent takes an action. In some embodiments the action is to generate a fraud alert. In some embodiments the action is to take a countermeasure such as for example to block delay rate limit or quarantine access to the access network by end user device . In some embodiments the action is to provide a notification to a user of end user device . In some embodiments the action is to send a message to service controller .

In some embodiments an agent on end user device e.g. policy implementation agent policy control agent access control integrity agent or any other agent that can perform verification functions determines whether the end user device has been rooted or jailbroken. As will be appreciated by a person having ordinary skill in the art rooting or jailbreaking is a process that allows a user of a mobile device to attain privileged access known as root access to the device s operating system thereby potentially circumventing various limitations that might otherwise govern operation of the device. In some embodiments if the agent determines that end user device has been rooted or jailbroken the agent takes an action. In some embodiments the action is to generate a fraud alert. In some embodiments the action is to take a countermeasure such as for example to block delay rate limit or quarantine access to the access network by end user device . In some embodiments the action is to provide a notification to a user of end user device . In some embodiments the action is to send a message to service controller .

In embodiments in which service processor applies an access network policy that includes classification of attempted or successful service usage attributed to a device software application program the identification of the software application program and association of the access network policy to the software application program comprises associating the access network policy with a known application credential. In some embodiments the credential is a name identifier. In some embodiments the credential is a secure signature certificate or hash of the software application program. In some embodiments the credential is stored on end user device by service processor for example by policy control agent and service processor and or a device operating system OS obtains a run time application credential for an application that intends to initiate execution and obtain access network service or has successfully initiated execution and obtained access network service usage. Policy control agent compares the run time credential to the stored known application credential and if there is a credential match the access network policy associated with the known application credential is applied to the application access network service usage.

In some embodiments the known application credential is stored on end user device and used for the comparison with the run time application credential. In some embodiments the run time application credential is provided to an element of service controller for example policy management server that in turn determines if it matches a known application credential and if so the element of service controller provides the appropriate policy to service processor e.g. using gateway application server . In some embodiments service processor performs an application identity check on the run time software program for example a secure hash a secure hash based on a key provided by an element of service controller or a signature check and the result of this identity check is provided to the element of service controller which in turn determines if it matches a known application credential if so the element of service controller provides the appropriate policy to service processor .

In some embodiments if service processor determines that a run time application credential is intended or may indicate an attempt to spoof a known application credential a fraud action is taken. In some embodiments if service controller determines that a run time application credential is intended or may indicate an attempt to spoof a known application credential a fraud action is taken. In some embodiments the fraud action comprises restricting access to an access network for end user device . In some embodiments the fraud action comprises restricting an application s ability to communicate over an access network. In some embodiments the fraud action comprises notifying a user of end user device . In some embodiments the fraud action comprises notifying a network administrator. In some embodiments the fraud action comprises applying a pre determined billing rate for service usage by end user device . In some embodiments the fraud action comprises applying a pre determined billing rate for run time application service usage by end user device .

If in step the credentials match the end user device takes a second action at step . In some embodiments the second action is to apply a policy associated with the installed application. In some embodiments the second action is to send a message to a server indicating that the end user device is in a healthy state.

Application execution environment retrieves the run time application program from memory and executes it determines a run time application credential associated with the run time application program and associates the run time application credential with a run time communication activity comprising a run time application program s use of or intended use of the first access network. Application policy control receives the run time application credential receives information associated with the run time application communication activity and determines whether the run time application credential matches the known application credential. If so application policy control causes the known application access network policy to be applied to the run time application communication activity.

In some embodiments end user device is further configured to provide the run time application credential to a network element by way of a secure data connection between end user device and the network element. In some embodiments end user device is further configured to receive information from the network element indicating the validity of the run time application credential. In some embodiments end user device is further configured to receive the information about the application policy from the network element by way of a secure data connection between end user device and the network element.

In some embodiments end user device protects particular elements e.g. software from unauthorized user modification or unauthorized application program modification. For example in some embodiments end user device stores the known application credential and the known application access network policy in a secure location. In some embodiments end user device performs various functions such as determining the run time application credential associated with the run time application program e.g. the credential reporting element in the application execution environment associating the run time application credential with the run time application communication activity e.g. the credential reporting element in the application execution environment receiving the run time application credential e.g. application policy control receiving information indicating the run time application communication activity e.g. the application policy control determining if the run time application credential matches the known application credential e.g. the application policy control causing the known application access network policy to be applied to the run time application communication activity e.g. application policy control instructing either the run time controller element of the application execution environment or the application policy enforcement element in the communications stack .

In some embodiments the run time application communication activity is an attempted access or successful access to access network by the run time application program and the known application access network policy specifies allowing the access blocking the access limiting the access or accounting for the access.

In some embodiments the run time application communication activity is an attempted access or successful access to an access network by the run time application program and the known application access network policy specifies a usage notification policy for notifying the user of the attempted or successful access. In some embodiments the usage notification policy is configured to present to a user through user interface an access network service usage breakdown showing the service usage for the run time application program. In some embodiments the usage breakdown includes a breakdown by application. In some embodiments the usage breakdown includes a breakdown by network type. In some embodiments the usage breakdown includes a breakdown by both application and network type. In some embodiments the usage breakdown includes a breakdown by network type. In some embodiments the usage breakdown includes a roaming network breakdown. In some embodiments the usage breakdown includes a breakdown by roaming network usage and by application.

In some embodiments the usage notification policy is configured to present to a user through user interface a warning of the potential rate of service usage for the known application program. In some embodiments the usage notification policy is configured to present to a user through user interface an offer to purchase service for the run time application program. In some embodiments the usage notification policy is configured to present to a user through user interface an indication of how much of a service allowance allocated to the known application program has been used or is remaining to be used.

In some embodiments the run time application communication activity is an attempt to execute or successful execution of the run time application program and the known application access network policy specifies allowing execution of the run time application program blocking execution of the run time application program or notifying the user of the attempted or successful execution.

In some embodiments end user device is further configured with second access modem to communicate with a second access network and the run time application communication activity comprises a run time application program s use of or attempted use of the first access network or the second access network. In some embodiments the known application access network policy settings or instructions differ based on whether end user device is connected to the first access network or to the second access network.

In some embodiments user interface provides a user of end user device with input capability to modify access network service according to user preference and to receive access network service notifications. In some embodiments user interface accepts user inputs for modifying access network policy such as limiting access by one or more applications or access to one or more network destinations. In some embodiments user interface accepts user inputs for choosing or modifying a service plan.

In some embodiments at least an aspect of the known application access network policy is entered by a device user through user interface . In some embodiments at least an aspect of the known application access network policy is obtained from a network element.

In some embodiments the memory is further configured to store an unknown application access network policy to be applied to the run time application communication activity when the run time application credential does not match the known application credential. In some such embodiments the application policy decision agent is further configured to determine if the run time application credential does not match the known application credential and if the run time application credential does not match the known application credential cause the unknown application access network policy to be applied to the run time application communication activity.

In some embodiments end user device further comprises a policy enforcement agent e.g. either a run time controller element of application execution environment or application policy enforcement element in communications stack configured to apply the known application access network policy to the run time application communication activity and to cause the known application access network policy to be applied to the run time application communication activity. In some embodiments the known application access network policy is applied to the run time application communication activity by providing an instruction to the policy enforcement agent. In some embodiments the policy enforcement agent e.g. the run time controller element of application execution environment or application policy enforcement element in communications stack applies the known application access network policy at the application layer of a device operating system. In some embodiments the policy enforcement agent applies the known application access network policy at the library or framework layer of a device operating system. In some embodiments the policy enforcement agent applies the known application access network policy by interacting with communications stack or modifying communications stack traffic flows. In some embodiments the policy enforcement agent applies the known application access network policy at the kernel or low level OS layer of an operating system of end user device .

It may be advantageous in some embodiments to validate particular agents on the end user device that assist in the provisioning and or management of device assisted services. In some embodiments end user device includes one or more verification agents that may be used to validate one or more device assisted services agents. There are many possible device assisted agents that may be verified such as for example a usage reporting agent e.g. an agent that reports aggregate or finer e.g. per service or classification measures of access network usage by the end user device a usage counting agent e.g. an agent that reports counts of access network usage by the end user device a policy enforcement agent a notification agent a policy decision agent a network state agent a kernel communication agent a user interface agent a persistence agent e.g. an agent that reads or writes from a data store such as a local memory a plan catalog agent a service controller communication agent a tethering detection agent a time of day agent e.g. an agent that manages a policy based on time of day a kernel agent or an analytics agent. Examples of agents are shown in and other figures and are described herein.

There are a number of ways in which the verification agent can validate a device assisted services agent including for example by performing a hash operation by performing a checksum operation by determining whether a digital signature is valid by performing a fingerprint by generating a random challenge and checking a response by the device assisted services agent to the challenge by extracting features from the agent for analysis by an artificial intelligence element e.g. a support vector machine a hidden Markov model a decision tree or a decision forest etc. In some embodiments the verification agent sends a verification message to the service controller with information about the results of the verification operation. In some embodiments the verification message contains information about the integrity status of one or more of the device assisted services agents. In some embodiments the verification message comprises a hash where the hash is the result of one or more of a hash operation on a kernel component a hash operation on a system component a hash operation on an application. In some embodiments the verification message comprises a hash that is a combination of two or more hashes. In some embodiments the verification message comprises a salted hash. In some embodiments the end user device receives a verification result from the service controller. In some embodiments the end user device takes an action based on the verification result e.g. blocks allows rate limits or delays an access to the access network by the end user device quarantines the end user device provides a notification to a user of the end user device heals a device assisted services agent etc. .

In some embodiments one or more agents on end user device comprise software components that are associated with installed agent credentials. In some such embodiments an agent associated with an installed agent credential cannot be modified updated or replaced unless the software purporting to be a modification update or replacement is associated with a credential that matches the installed agent credential. An installed agent credential may comprise an agent kernel software being present with a proper signature certificate or hash result an agent framework software being present with a proper signature certificate or hash result or an agent application software being present with a proper signature certificate or hash result.

In some embodiments service controller using e.g. fraud server is configured to detect fraudulent or potentially fraudulent activities by end user device . There are several ways service controller can detect fraud including for example by observing whether service processor exhibits expected behavior by determining whether device generated usage reports indicate fraudulent use of the access network resources by examining the contents of trusted reports e.g. reports from a trusted or secure source of end user device s data usage by comparing contents of non secure device based usage reports to contents of trusted usage reports by comparing end user device s usage to expected usage based on population statistics by detecting SIM card irregularities that may indicate attempts to steal sponsored services. In some embodiments service controller obtains a trusted measure of end user device s service usage and uses the trusted measure alone or in combination with another measure to determine whether end user device is properly implementing a policy that should be in place.

In some embodiments service controller applies a policy error detection procedure to generate a fraud score wherein the fraud score indicates a level of confidence or a likelihood that the analyzed activity or set of activities is fraudulent. In some embodiments service controller using e.g. fraud server determines whether data usage by end user device is fraudulent by using what may be called a layered or tiered approach. In some such embodiments service controller applies at least two tests to determine whether end user device is behaving fraudulently. In some such embodiments a trusted service policy implementation is verified by service controller by performing at least two of the following operations in conjunction with a multi step service usage analysis procedure a comparing a trusted access network usage records with the usage limitations expected to be in place if the service policy is being properly implemented b comparing a trusted service usage measure to a non secure e.g. device generated service processor based service usage measure c comparing a first device service processor service usage measure against a second device service processor service usage measure and d comparing a device service usage measure against a population statistic for the device based service usage measure.

In some embodiments service controller applies at least two tests and combiner generates a fraud score based on the results of the at least two tests. In some embodiments service controller applies one or more of the following tests to determine the fraud score a determining if service processor is failing to send non trusted e.g. device based service usage reports even though service controller is receiving trusted reports of end user device s service usage b comparing a trusted service usage measure to a limit or range of usage expected if end user device is properly implementing a service policy that should be in place c comparing a trusted service usage measure to a non secure e.g. device based usage measure to determine if the difference between the two usage measures is within a specified tolerance d comparing a non secure e.g. device based service usage measure to a limit or range of usage expected if end user device is properly implementing a service policy that should be in place e comparing a classification of end user device usage to a limit or range of usage expected if end user device is properly implementing a service policy that should be in place f comparing an aggregation of two or more classifications of end user device usage to an aggregate limit on usage to determine if the difference between the two measures is within a specified tolerance g comparing a trusted measure of usage of a class e.g. an application a group of applications a network destination a group of network destinations etc. to a limit or range of usage expected if end user device is properly implementing a service policy that should be in place h comparing a trusted measure of usage of a class e.g. an application a group of applications a network destination a group of network destinations etc. to a non secure e.g. device based measure of usage of the same class to determine if the difference between the two measures is within a specified tolerance i comparing a statistical characterization of usage by a population of end user devices to a trusted measure of end user device s service usage to determine if the difference between the two measures is within a specified tolerance j comparing a statistical characterization of usage of a particular class e.g. an application a group of applications a network destination a group of network destinations etc. by a population of end user devices to a trusted measure of end user device s usage of that same class to determine if the difference between the two measures is within a specified tolerance k comparing a statistical characterization of usage by a population of end user devices to a non secure measure of end user device s service usage to determine if the difference between the two measures is within a specified tolerance l comparing a statistical characterization of usage of a class e.g. an application a group of applications a network destination a group of network destinations etc. to a non secure e.g. device based measure of usage of the same class to determine if the difference between the two measures is within a specified tolerance m comparing detailed class e.g. an application a group of applications a network destination a group of network destinations etc. usage information in a usage report trusted or non secure to determine whether a policy that should be in place allows the classified activity n determining whether service processor successfully authenticated with service controller o determining whether service processor is reporting e.g. sending heartbeat messages device reports etc. to service controller in an expected manner p determining whether usage of one or more classes e.g. an application a group of applications a network destination a group of network destinations etc. is consistently slightly under particular limits that would indicate likely fraud on the part of end user device q comparing an amount or percentage of unknown or unclassified data usage allocated by service processor to a particular class to an expected amount or percentage of unknown or unclassified data usage where the expected amount or percentage is determined using information from a trusted source e.g. a web crawler domain object model etc. .

The outputs of the N tests may be pass fail indicators or values e.g. integer binary real numbers etc. . In some embodiments in which the outputs of the N tests are pass fail indicators combiner determines a fraud score of pass or fail e.g. combiner generates one fraud score e.g. a discrete value such as 0 if the result is pass and a different fraud score e.g. a different discrete value such as 1 if the result is fail . In some embodiments the fraud score is pass if each of the N individual test results indicates the associated test was passed. In some embodiments the fraud score is fail if at least one of the N individual test results indicates that the associated test was failed. In some embodiments the fraud score is pass if at least M individual test results indicate the associated tests were passed where M is less than N. In some embodiments the fraud score is fail if M or more individual test results indicate the associated tests were failed. As will be appreciated by a person having ordinary skill in the art in view of the disclosures herein there are many other ways to combine the individual test results and determine the fraud score and the examples above are not meant to be limiting.

In some embodiments the output of each of the N tests is a value. In some embodiments combiner performs a linear combination of the N individual test results. In some embodiments combiner scales one or more of the N test results before performing a combination linear or otherwise .

In some embodiments each output value is between a minimum value and a maximum value e.g. between 0 and 1 or between values A and B inclusive etc. and the maximum value is associated with a high likelihood of fraudulent behavior by end user device . In some embodiments each output value is between 0 and 1 and each output value represents a probability of fraudulent behavior on the part of end user device . In some such embodiments combiner multiplies the individual test result values to generate the fraud score. In some embodiments combiner applies a weighting factor to one or more of the N test results before multiplying them. As will be appreciated by a person having ordinary skill in the art in view of the disclosures herein there are many other ways to combine the individual test results and determine the fraud score and the examples above are not meant to be limiting.

In some embodiments a high fraud score is associated with a high likelihood of fraudulent behavior on the part of end user device . In some such embodiments if the fraud score generated by combiner based on the results of N initial tests is greater than or greater than or equal to a threshold service controller generates a fraud alert. In some embodiments if the fraud score generated by combiner based on the results of N initial tests where N is less than the maximum number of tests available is greater than or greater than or equal to a threshold additional tests are run. In some embodiments one or more additional tests are added to the set of tests selected initially e.g. the value of N is increased and additional tests are selected and included . In some embodiments at least one of the one or more additional tests is more computationally expensive than one or more of the tests in the initial set of N tests.

In some embodiments in which a high fraud score is associated with a high likelihood of fraudulent behavior on the part of end user device if the fraud score generated by combiner based on the results of N initial tests where N is less than the maximum number of tests available is greater than or greater than or equal to a threshold a different set of N tests is selected and run. In some embodiments the different set of N tests includes one or more of the tests run in the initial set of N tests. In some embodiments at least one of the tests in the different set of N tests is more computationally expensive than one or more of the tests in the initial set of N tests.

In some embodiments a low fraud score is associated with a high likelihood of fraudulent behavior on the part of end user device . In some such embodiments if the fraud score generated by combiner based on the results of N initial tests is less than or less than or equal to a threshold service controller generates a fraud alert. In some embodiments if the fraud score generated by combiner based on the results of N initial tests where N is less than the maximum number of tests available is less than or less than or equal to a threshold additional tests are run. In some embodiments one or more additional tests are added to the set of tests selected initially e.g. the value of N is increased and additional tests are selected and included . In some embodiments at least one of the one or more additional tests is more computationally expensive than one or more of the tests in the initial set of N tests.

In some embodiments in which a low fraud score is associated with a high likelihood of fraudulent behavior on the part of end user device if the fraud score generated by combiner based on the results of N initial tests where N is less than the maximum number of tests available is less than or less than or equal to a threshold a different set of N tests is selected and run. In some embodiments the different set of N tests includes one or more of the tests run in the initial set of N tests. In some embodiments at least one of the tests in the different set of N tests is more computationally expensive than one or more of the tests in the initial set of N tests.

In some embodiments one of the N tests indicates whether service processor successfully completed the authentication procedure with service controller . In some embodiments a failure of service processor to complete the authentication procedure with service controller results in a fraud score that indicates end user device is likely behaving fraudulently e.g. an automatic fail or a fraud score that indicates a high likelihood of fraud . In some embodiments the result of one or more tests is a quantized value associated with a likelihood of error e.g. fraud or a likelihood of non error e.g. no fraud and the overall pass fail criterion is based on a combination of one or more of the quantized values.

In some embodiments service controller applies different sets of N tests at different times. For example in some embodiments service controller applies a set of N tests including more computationally expensive tests on occasion or periodically. In some embodiments service controller varies the value of N at various times. In some embodiments service controller regularly applies a small or modest set of tests and then occasionally or periodically applies a larger set of tests. In some such embodiments the larger set of tests includes one or more tests that are more computationally expensive than tests in the smaller set e.g. tests that require processing of flow data records discussed below .

In some embodiments if the fraud score indicates a policy implementation error e.g. likely fraudulent behavior by end user device service controller takes an action comprising one or more of generating a fraud alert flagging end user device or a user associated with end user device for further evaluation charging for end user device s usage at a pre determined rate associated with end user device being in a fraudulent state notifying a user of end user device notifying a network administrator quarantining end user device or a user s access to the access network suspending end user device or a user of end user device from the access network.

Fraudulent or potentially fraudulent activity by end user device can be detected by service controller by observing the behavior of end user device after service processor has been authenticated. In some embodiments detecting fraud comprises ensuring that service control device link and service control server link are operating correctly and there is no break in a continuous heartbeat authentication sequence.

In some embodiments service processor sends periodic or occasional device based usage data reports UDRs to service controller . The UDRs contain information about end user device s data usage. For example the UDRs may indicate how many bytes of data associated with a particular application such as a map application or service such as a music streaming service end user device used since the last report or during a particular time period. In some embodiments service processor sends the UDRs in response to a request from service controller . In some embodiments service controller generates a fraud alert if after having been authenticated service processor fails to send device based usage reports when expected or requested by service controller or when service processor sends device based usage reports at unexpected or improper times. In some embodiments service controller generates a fraud alert if it receives UDRs from service processor after receiving a data session stopped trigger from a network element.

In some embodiments service controller generates a fraud alert if service processor fails to respond as expected to commands issued by service controller . In some embodiments service controller sends a command to service processor and observes a response from service processor . In some embodiments when fraud is suspected service controller instructs service processor to apply and enforce policy modifications. Service controller then observes the response of service processor and performs an analysis on information sent by service processor to service controller to determine whether the behavior of end user device is indicative of fraud.

In some embodiments service controller directs service processor to change a setting of end user device . If the setting change ordinarily would cause a deterministic behavior change in the operation of an end user device that is operating according to an established policy service controller may determine that end user device is operating fraudulently if service controller does not observe that end user device s behavior has changed in the expected manner. As an example service controller might suspend end user device s use of a sponsored service i.e. a service for which a sponsor entity subsidizes an end user device s access to that service . If end user device continues to use the sponsored service after service controller suspended end user device s use of the sponsored service service controller may conclude that the access is fraudulent.

In some embodiments service controller changes a parameter to cause end user device to modify its behavior and potentially also to change particular settings of end user device . For example service controller might communicate to service processor a lower maximum data rate at which end user device is allowed to send data over the access network. If end user device continues to send data at a rate above the newly imposed maximum data rate service controller may conclude that end user device is operating fraudulently. In some embodiments parameter changes are constructed for example from rules or by building a reaction model for a user population where the reaction model learns to distinguish legitimate activity from fraudulent behavior.

Fraudulent or potentially fraudulent activity by end user device can be detected by examining trusted measures or records of data usage by end user device . In some embodiments a network element e.g. service usage reconciliation and fraud detect or fraud server examines the content of usage reports from a trusted source to determine whether end user device is operating within the policies that should be in place. The usage reports may indicate a variety of information including for example one or more of a bulk measure of aggregate data usage destinations accessed network state e.g. time of day network busy state network congestion state etc. type of network e.g. 2G 3G 4G WiFi home roaming etc. etc. In some embodiments the trusted records contain information about end user device s data use associated with a class of service activities where the class is a particular application a group of applications a particular network destination a group of network destinations a network type etc. For example the trusted records may contain one or more of record start time record end time information identifying the class the amount of data use associated with the class etc.

There are several possible sources of trusted records including network elements end user device and third party sources. Records from network elements are generally trusted because it is difficult for unauthorized parties to obtain access to the records themselves or the network elements that generate the records particularly if some or all of the security measures disclosed herein are in place. Examples of network elements that can produce trusted records are gateways e.g. GGSN SGSN PDSN routers switches etc. a home agent proxy servers a charging gateway system a mediation element e.g. mediation a reconciliation element e.g. reconciliation server a billing element e.g. central billing carrier billing a AAA element e.g. access network AAA server and other network elements.

End user device can also generate trusted records if it includes a secure device data record DDR processor and a secure protocol for the sending of reports from the secure DDR processor to service controller . The use of secure DDRs is described in detail in U.S. patent application Ser. No. 13 247 998 which is entitled Secured Device Data Records and is incorporated herein by reference.

Third party sources can also provide trusted records if measures are in place to verify the reports. Examples of third party sources that can provide trusted records are partner service destination servers e.g. search sites advertisement sites application service sites shopping sites content sites gaming sites e mail sites etc. enterprise customer networks etc. Third party sources may provide such information as usage reports site visits transaction reports ad view reports economic benefit reports usage credit increase instructions etc.

In some embodiments using data usage reports from a trusted source a network element determines whether end user device s usage as given by a trusted usage measure is within a limit or range of usage behavior expected if an applicable policy is in place. For example in some embodiments the network element determines whether the bulk usage by end user device is no higher than a maximum amount specified by a policy that should be in place. In some embodiments the network element determines whether end user device s use of a particular class e.g. an application a group of applications a network destination a group of network destinations network type etc. is within data usage limits specified in the control policy that should be in place. In some embodiments the network element determines whether end user device s use of a particular class is allowed under the control policy that should be in place. As will be now be appreciated by one of ordinary skill in the art in view of the disclosures herein there are many ways that a network element can use information in reports from a trusted source to verify that end user device is operating in compliance with policies that should be in place and the examples given above are not meant to be limiting.

In some embodiments service processor is not capable of generating and sending secure DDRs. Instead service processor is capable only of generating and sending non secure records e.g. UDRs of end user device s data usage. In such cases an unscrupulous user might attempt to hack end user device so that the reports it sends contain information that is more favorable to the user than it should be e.g. by reporting less data usage either aggregate or of a class than end user device actually used or by reporting data usage that should be accounted as usage under a subscriber paid service plan as usage of a sponsored service. In some embodiments service controller uses device based usage measures to detect when a user attempts to tamper with service processor in order to have usage of one service reported incorrectly e.g. as usage of a different class as usage of a sponsored service when it is actually part of a subscriber paid plan etc. . In some embodiments service controller compares usage measures in device based e.g. non secure reports to corresponding usage measures in a report from a trusted source.

In some embodiments service controller generates a fraud alert if it receives UDRs from end user device but the UDRs indicate end user device s usage is beyond a charging policy limit. In some embodiments if service controller receives UDRs from end user device but the charging codes in those UDRs do not correspond to charging codes for the currently allowed active services e.g. the charging codes indicate that end user device is using data or a class for which it is not authorized etc. service controller generates a fraud alert.

In some embodiments service controller examines the content of device based usage reports e.g. reports generated by service processor and sent to service controller to verify that service processor is properly classifying services. In some embodiments service controller determines whether applications being used or destinations being accessed by end user device are authorized under a service plan associated with end user device . In some embodiments service controller examines the content of device based usage reports to determine whether end user device imposed a service control that was supposed to be in place e.g. a cap on usage a speed of usage such as a maximum rate an amount of usage of background or foreground data state modifiers such as time of day network busy state network type e.g. home roaming WiFi cellular etc. quality of service limits etc. .

In some embodiments service controller examines the content of device based usage reports to verify that the service usage measures being reported by end user device are compliant with the access network policy or policies that should be in place. In some embodiments service controller determines whether one or more of the following measures are within limits imposed by a policy that should be in place bulk e.g. aggregate usage usage of a class e.g. an application a group of applications a network destination e.g. IP address domain address etc. a group of network destinations etc. application specific usage that includes transaction based single application service or multi application service background usage foreground usage usage that is identified by a time of day network busy state quality of service or network type state modifier roaming usage usage associated with specific content e.g. streaming video streaming audio etc. usage based on a specific layer 3 4 protocol e.g. TCP UDP and or a Layer 7 protocol e.g. IGMP RTMP RSTP etc. .

In some embodiments in which service processor tracks end user device s use of a class e.g. an application a group of applications a network destination a group of network destinations network type etc. service controller examines the content of device based usage reports to determine whether end user device is properly identifying and allocating data usage associated with the class. As is described in detail in several previous applications listed in the Cross Reference to Related Applications section including U.S. patent publication 2010 0198698 filed Jan. 27 2010 and entitled Adaptive Ambient Services classifying data usage in the dynamic e.g. non static environment of the Internet can be challenging. For example a class may include access to a particular web site. Service processor should count as usage of the class end user device s access to the collection of URLs associated with the web site but not access to other network destinations and or applications not associated with the web site. Although it is possible to create at any point in time a comprehensive list of all content associated with the web site a problem arises whenever the web site changes e.g. links or URLs are changed content from other web sites is included or removed etc. because the list of associated addresses domains and access list policies will be inaccurate if it is not updated immediately after the change.

Several of the patent applications listed in the Cross Reference to Related Applications section of this document including U.S. patent application Ser. No. 13 253 013 entitled System and Method for Providing User Notifications and incorporated by reference herein disclose ways to track changes in the Internet to facilitate providing for example service plans with different classes sponsored services etc. One way to track changes is to use search engine web crawler techniques to create and update a catalog of content sources destinations e.g. advertisement servers network domains etc. etc. that are associated with a class. As would be understood by a person of ordinary skill in the art a web crawler is a computer program that browses the web in a methodical automated way. Web crawlers are also known as ants automatic indexers bots web spiders web robots or web scutters. Web crawlers may be used to copy check or validate links on web sites. A web crawler may start with a list of URLs to visit. As the crawler visits these URLs it identifies all the hyperlinks in the page and adds them to the list of URLs to visit. The new list is sometimes called the crawl frontier. URLs from the crawl frontier are then recursively visited according to a set of policies that specify which pages to visit how often to re visit those pages etc.

The immediate identification and propagation to all service processors of all changes in every web site associated with every sponsored service or every class within all service plans can be difficult. Therefore in some embodiments when end user device engages in service activities associated with a class e.g. sends or receives data using a particular application that is itself a class or using an application from a defined set of applications comprising a class or accesses a particular network destination that is itself a class or accesses a particular network destination that is in a class comprising a set of network destinations or uses a particular network type etc. and in the course of using data within the class end user device is directed to a destination that service processor does not know or is unclassified service processor grants a temporary access lease. Under the lease access to for example certain unknown or unclassified destinations is allowed e.g. for a particular amount of data for a particular amount of time etc. but monitored until the unclassified or unknown application or destination can be reclassified as allowed or disallowed. A lease temporarily allows unknown or unclassified activities to take place within the class under the theory that such activities may be the legitimate result of a change in an Internet destination included in the class and therefore it would be undesirable to block these activities or to allocate data access costs associated with them to a bulk usage category or to a different class when they should be allocated to the class.

Service controller can use information from a web crawler search engine e.g. the crawl frontier to assess whether service processor is likely correctly allocating data usage to particular classes. In some embodiments service controller determines whether service processor is allocating a reasonable amount of unknown or unclassified data usage to the class based on web crawler results. For example if the web crawler results indicate that at a particular point in time or on average approximately 80 percent of content available at or through a particular web site is known e.g. has a URL that alone indicates it is part of the class has a URL that indicates it is from an ad server or another so called known benign domain the content of which is unlikely to be accessed fraudulently by a user etc. and 20 percent of the content is unknown e.g. not known to be part of the class not a known benign domain etc. service controller may determine that end user device is likely operating fraudulently if only 50 percent of the data usage allocated by service processor is known to be associated with the web site and the other 50 percent of the data usage allocated by service processor to the class is associated with unknown or unclassified content or destinations. Such a result may indicate that service processor has been hacked and is improperly allocating data usage to the class.

In some embodiments service controller determines whether device based usage reports indicate that service processor is likely fraudulently allocating data usage to a sponsored service. For example in some embodiments service controller determines how much of the data usage service processor is allocating to a sponsored service is known to be associated with the sponsored service and how much is not known to be associated with the sponsored service. In some embodiments service controller determines e.g. based on web crawler or similar data whether service processor is allocating too much unknown or unclassified data usage to a sponsored service. In some embodiments service controller assesses whether service processor is properly granting leases e.g. by determining whether the leases are of an appropriate duration are terminated properly etc. . In some embodiments service controller generates a fraud alert if the UDRs indicate that end user device is improperly classifying disallowed destinations e.g. web sites URLs etc. as part of a sponsored service.

In some embodiments service controller compares usage counts in carrier based usage reports or usage reports from another trusted source to usage counts in UDRs from end user device . In some embodiments if the difference between the usage counts in the two reports is not within a tolerance e.g. an amount of data a percentage etc. service controller generates a fraud alert. In some embodiments if the counts in the reports agree and the charging codes in the UDRs are correct but the UDRs indicate that service processor has incorrectly categorized e.g. classified the data usage service controller generates a fraud alert. In some embodiments if the counts in the reports are in agreement but the usage rate e.g. units of data per unit of time within a service component e.g. a class or within a service activity is greater than a rate limit set by the control policy service controller generates a fraud alert.

In some embodiments service controller generates a fraud alert if a comparison between the device based UDRs and carrier based or other trusted usage reports indicates that end user device consistently under reports its usage of data in a particular class e.g. an application a group of applications a destination a group of destinations etc. . Such underreporting may indicate that service processor is substituting usage counts from a higher priced service for the counts associated with a lower priced or sponsored service e.g. service processor is reporting more usage of the lower priced service and less usage of the higher priced service . Such skimming can occur for example within a single service across multiple services across multiple time periods or in other ways or combinations of these ways.

In some embodiments service controller generates a fraud alert if the UDRs from service processor indicate that end user device s usage of a service component or activity is abnormal when compared to a hard rate limit such as an allowed usage per hour day or week or an expected rate limit such as a rate limit imposed on streaming services.

In some embodiments service controller compares a usage rate of end user device to the average end user device usage rate which it determines using a statistical model of usage data associated with a specific service plan or component of a service plan e.g. a class by a population or sub population of devices. In some such embodiments service controller performs what is known in the art as a k nearest neighbor classification using the usage rate to identify whether end user device is potentially behaving fraudulently. As would be understood by a person having ordinary skill in the art the k nearest neighbor classification may be trained by learning vector quantization LVQ using tunable training parameters such as for example the time window of data usage usage rate etc.

In some embodiments service controller may or may not generate a fraud alert upon detecting a particular condition. For example if the usage counts contained in trusted reports and UDRs from service processor are in agreement but end user device s usage rate in terms of units of data per unit of time deviates significantly from the usage rate of the average user it could mean that service processor has been tampered with or otherwise compromised. Alternatively however it could mean simply that the usage patterns for that service activity or service component are changing or that end user device is being used legitimately but in an unusual manner as compared to how most end user devices are used. A change in usage patterns could result for example if the service plan to which end user device is subscribed adds streaming content such as video or audio and a user is among the first to take advantage of the new content. In some embodiments service controller may simply flag the activity as potentially fraudulent or it may wait until it has performed additional analysis to make a decision regarding whether service processor s behavior is likely fraudulent.

In some embodiments service controller determines a second measure of a network state to confirm that end user device is reporting the correct network state in its charging reports. In some embodiments service controller or another suitable network function obtains the network state as determined using a group of devices. In some embodiments service controller or another suitable network function characterizes sub network portions e.g. base stations base station sectors geographic areas RANs etc. based on a population of end user devices connected to that sub network portion.

In some embodiments service controller determines a second measure of device access behavior for a given network state to ensure end user device is implementing the correct controls. In some embodiments the second measure is from a network element. In some embodiments the second measure is from a secure DDR processor on end user device . In some embodiments the second measure is from a second monitor point within end user device . In some embodiments the second measure is good customer feedback from a third party source.

In some embodiments service controller compares a trusted e.g. network based secure DDR or third party measure of the device s service usage to a device based e.g. service processor based measure of the device s service usage. In some embodiments one or both of the trusted service usage measures and the device based service usage measures include a classification of service usage based on application. In some embodiments one or both of the service usage measures include a classification of service usage based on network destination or network service identifier. In some embodiments one or both of the service usage measures include a classification of service usage based on network type e.g. roaming home cellular WiFi etc. . In some embodiments one or both of the service usage measures include a classification of service usage based on time of day. In some embodiments one or both of the service usage measures include a classification of service usage based on QoS class. In some embodiments one or both of the service usage measures include a classification of service usage based on geography. In some embodiments one or both of the service usage measures include a classification of service usage based on a roaming network.

In some embodiments a trusted service policy implementation is verified by comparing a first device based service processor service usage measure against a second device based service processor service usage measure. In some embodiments one or both service processor usage measures include a classification of service usage based on application. In some embodiments one or both service processor usage measures include a classification of service usage based on network destination or network service identifier. In some embodiments one or both service processor usage measures include a classification of service usage based on network type. In some embodiments one or both service processor usage measures include a classification of service usage based on time of day. In some embodiments one or both service processor usage measures include a classification of service usage based on QoS class. In some embodiments one or both service processor usage measures include a classification of service usage based on geography. In some embodiments one or both service processor usage measures include a classification of service usage based on a roaming network.

A second source not shown generates or provides second service usage measures . In some embodiments the second source is a network element such as a mediation element a gateway a real time reporting element a charging element a billing element or the like. In some embodiments the second source is a database. In some embodiments the second source is a roaming partner network element. In some embodiments the second source is an element on end user device that generates secure device data records. In some embodiments the second source is a partner network destination that provides information about customer usage of or transactions with that destination. In some embodiments the second source is an application on end user device .

Based on the second service usage measures the second source sends second usage records to service controller or service controller obtains the second usage records from the second source. Service controller processes the second usage records in record normalization time reconciliation and pre preprocessing . In some embodiments record normalization time reconciliation and pre preprocessing modifies the format of the second usage records to facilitate one or more of service usage processing reporting analysis comparison mediation and reconciliation operations performed within the service controller system. In some embodiments record normalization time reconciliation and pre preprocessing observes the second usage records and time stamps and time synchronizes time aligns or time aggregates multiple second usage records so that a more consistent measure of usage with a common time reference can be achieved within the service controller system for one or more of service usage processing reporting analysis comparison mediation and reconciliation purposes. Service controller stores the second usage records in second source usage records .

Service controller applies reconciliation and verification processing algorithms to reconcile records in device usage records with records in second source usage records and to validate records in device usage records . Service controller stores information based on the results of reconciliation and verification processing algorithms in data warehouse .

In some embodiments reconciliation and verification processing algorithms reconcile detailed classifications of service usage off of a bulk service usage accounting and onto a finer classification of service usage accounting. For ease of explanation the finer classifications of service usage accounting are referred to herein as micro charging data records or micro CDRs. In some embodiments reconciliation and verification processing algorithms accomplish charging for detailed classifications of service usage by providing a detailed micro CDR charging code identifier in the micro CDR usage record communicated to the carrier network mediation or billing system e.g. operator data mediation . In some embodiments reconciliation and verification processing algorithms accomplish charging for a detailed classification of service usage by mediating out or subtracting the amount of service usage reported in the micro CDR from the amount of service usage accounted to bulk service usage. In some embodiments reconciliation and verification processing algorithms sends charging data records e.g. CDRs micro CDRs etc. to operator data mediation .

In some embodiments reconciliation and verification processing algorithms perform a fraud analysis using information from one or both of second source usage records and device usage records . In some embodiments reconciliation and verification processing algorithms compares usage records associated with a specific device or user credential from one or both of second source usage records and device usage records to determine if service usage is outside of pre defined service usage policy behavior limits. In some embodiments reconciliation and verification processing algorithms compares service usage information associated with a specific device or user credential from one or both of second source usage records and device usage records to determine if a pre defined service usage limit has been reached or exceeded. In some embodiments reconciliation and verification processing algorithms compares service usage information associated with a specific device or user credential from one or both of second usage records and device usage records to determine if the specific device or user is exhibiting a service usage behavior that is outside of pre defined statistical limits as compared to the service usage behavior of a device or user population. In some embodiments reconciliation and verification processing algorithms stores the results of its fraud analysis in data warehouse . In some embodiments reconciliation and verification processing algorithms sends fraud alerts to operator CRM system e.g. a carrier fraud processing system carrier personnel a device user a system administrator etc. .

In some embodiments the second usage records comprise information from multiple other measures or reports. In some embodiments the second usage records are based on information measures or reports from end user device . In some embodiments the second usage records are based on information measures or reports from other end user devices. In some embodiments the second usage records are determined based on information measures or reports from one or more network elements e.g. a base station the RAN the core or using device assisted means etc. .

In some embodiments the second usage records comprise a measure of bulk e.g. aggregate or unclassified data usage by end user device . For example in some embodiments the second usage records comprise a bulk usage report specific to end user device generated by the network by an application service provider or by a server. In some embodiments the second usage records are based on information in one or more previous reports sent by end user device .

In some embodiments the second usage records comprise information associated with the access network state. In some embodiments the second usage records are determined from network state tagged information. In some embodiments the second usage records comprise information from a device data record DDR which may indicate the network busy state and the network type. In some embodiments the second usage records are determined from DDR network state tagged information.

In some embodiments the second usage records comprise information from flow data record. In some embodiments the flow data record FDR reports a detailed level of service usage classification that indicates service usage broken down by network source or destination e.g. domain URL IP address etc. and possibly one or more ports and protocols. In some embodiments the FDR reports a detailed level of service usage classification that indicates usage broken down by device user application or OS application. In some embodiments the FDR reports a detailed level of service usage classification that indicates service usage broken down by time of day network congestion state or service QoS level. In some embodiments the FDR reports a detailed level of service usage broken down by network type e.g. 2G 3G 4G WiFi home roaming etc. . In some embodiments the FDR reports a detailed level of service usage broken down by home or roaming network.

In some embodiments the FDRs are sourced from a network element capable of classifying traffic e.g. a deep packet inspection DPI gateway a proxy server a gateway or server dedicated to a given service classification a good customer feedback source described elsewhere herein etc. . In some embodiments the second usage records are derived from a device service monitor. In some embodiments the second usage records are derived from a trusted device service monitor. In some embodiments the trusted device service monitor is located in a secure execution environment on the device that cannot be accessed by a user or user installed application software.

In some embodiments the second usage records allow service controller to determine whether the access behavior of end user device given the network state indicates that end user device is implementing the correct policy controls. In some embodiments service controller confirms that service processor is reporting the correct network state in its data usage reports. In some embodiments a network element determines the correct network state based on a group of devices. The information is reported to service controller or another suitable network function. Service controller or other suitable network function characterizes portions of the sub network e.g. base stations base station sectors geographic areas radio access network RAN etc. based on the population of end user devices connected to that sub network portion. The network element can also gather network busy state measures from network equipment such as from base stations or by sampling the RAN to determine the second measure.

In some embodiments the second usage records provide information about a cap on the aggregate amount of data usage by end user device . Service controller verifies that the total data usage by end user device as reported in the first usage records does not exceed the cap. If the first usage records provide data usage amounts for individual services used by end user device service controller verifies that the sum of the usage amounts for the individual services does not exceed the cap.

In some embodiments the network classifies FDRs to known service components determines credits of classified usage for each service component ensures that the service component usage does not exceed specified limits or matches end user device reports for the component and checks whether the sum of the components matches the bulk measure.

There are several potentially fraudulent circumstances that may be detected by service controller using one or more of the embodiments disclosed herein such as the example embodiment illustrated in . In some embodiments service controller generates a fraud alert if it receives carrier based usage reports from a network element and UDRs from service processor but the usage counts contained in the reports are not in agreement within a specified tolerance. In order to generate a fraud alert under these circumstances in some embodiments service controller accounts for unsent usage reports that may still be on end user device .

Carrier generated charging data records CDRs or real time reporting records RTRs or other real time or near real time usage record formats such as e.g. flow data records FDRs batch processed usage records continuous usage record event feeds or SMS formatted usage record messages flow from carrier which can be e.g. a real time reporting system a network gateway a network usage charging system element a AAA an HLR a billing element etc. to load balancer to CDR i filtering element .

In some embodiments load balancer selects one of many CDR RTR processing threads that are available in the service controller information processing system. In some embodiments the processing thread is an asynchronous software or firmware program running on a gateway or server CPU. In some embodiments the processing thread is a virtual machine processing thread that exists in a resource pool of gateway or server CPUs or virtual machines which may include geographically separated or redundant resource pools. As illustrated in each processing thread includes the functional steps of CDR RTR filtering JMS queue CDR RTR processor and the interface to CDR RTR database . In some embodiments processing threads are asynchronous in that they are initiated when load balancer directs one or more CDR RTR data transfers to the thread and terminated when the processed CDR RTR information has been processed and deposited into CDR RTR database . Note that shows only one of potentially many available CDR RTR processing threads.

CDR RTR filtering element selects the records that are associated with devices that include a device client that communicates with the service controller e.g. the device client can be a service processor configured to provide service usage notification updates on device service plan purchase or activation with UI options display and user selection actions device assisted access control policy enforcement device assisted service usage charging policy enforcement device assisted service notification messages etc. . In some embodiments devices supporting DAS are identified by device credentials or user credentials that are communicated to the service controller as described herein where the device credential or user credential are members of a device group or user group that is managed by the service controller.

In some embodiments CDR RTR filtering element may be used advantageously to quickly receive and acknowledge a CDR RTR record to provide asynchronous functionality because of real time processing requirements server processing thread scalability and maintainability requirements or server processing thread geographic redundancy requirements. In some embodiments filtering eliminates unnecessary load on JMS queue and or CDR RTR database . CDR RTR filtering element places the records from end user devices known to be configured with a device client e.g. a service processor configured to provide service usage notification updates on device service plan purchase or activation with UI options display and user selection actions device assisted access control policy enforcement device assisted service usage charging policy enforcement device assisted service notification messages etc. that communicates with the service controller through Java messaging service JMS queue . In some embodiments CDR RTR filtering element filters out device records for devices that may have a form of service processor but service processor has not properly authenticated with the service controller . In some embodiments the device clients that are known to be configured with a device client that communicates with service controller are determined by looking up a device credential or user credential associated with CDRs or RTRs in a device group or user group management database.

JMS queue buffers the CDR RTR information remaining after CDR RTR filtering and allocates one or more CDRs RTRs to a service usage processing thread in CDR RTR processor . In some embodiments JMS queue is a persistent queue. In some embodiments JMS queue is a primary messaging system between service controller applications.

CDR RTR processor retrieves the records from JMS queue transforms the records and stores them in CDR RTR database . In some embodiments CDR RTR processor is an application or a process thread. In some embodiments CDR RTR processor pulls a CDR RTR record from JMS queue transforms the record and stores the transformed record in CDR RTR database in one transaction in order to provide fault tolerance in the case of system failure. In some embodiments CDR RTR processor formats the CDR RTR information to provide a common service usage information format to facilitate one or more of service usage processing reporting analysis comparison mediation and reconciliation operations performed within the service controller system. In some embodiments CDR RTR processor observes CDR RTR time stamps and time synchronizes time aligns or time aggregates multiple CDR RTR reports so that a more consistent measure of usage with a common time reference can be achieved within the service controller system for one or more of service usage processing reporting analysis comparison mediation and reconciliation purposes.

In some embodiments end user devices capable of DAS reporting e.g. devices configured with a device client that communicates with the service controller such as service processor described herein connect periodically or on occasion to usage reporting gateway to report their data usages. In some embodiments DAS reporting information includes but is not limited to one or more of user service plan purchase or activation selection choices device user service policy configuration preference selections e.g. user generated service policy assignments for applications websites network types or home roaming policies DAS service usage reports DAS device policy state reports DAS software environment integrity reports and other reports.

In some embodiments DAS device usage reports and analytics flow from carrier device network e.g. devices configured with service processors that are in communication with the service controller to load balancer to usage reporting gateway . In some embodiments load balancer selects one of many usage reporting processing threads that are available in the service controller information processing system. In some embodiments the usage reporting processing thread is an asynchronous software or firmware program running on a gateway or server CPU. In some embodiments the usage reporting processing thread is a virtual machine processing thread that exists in a resource pool of gateway or server CPUs or virtual machines which may include geographically separated or redundant resource pools. As illustrated in each usage reporting processing thread consists of the functional steps of usage reporting gateway JMS queue report processor and the interface to usage report database . In some embodiments usage reporting processing threads are asynchronous in that they are initiated when load balancer directs one or more usage reporting data transfers to a thread and terminated when the processed usage reporting information has been processed and deposited into usage report database . Note that shows only one of potentially many available usage reporting processing threads.

Usage reporting gateway accepts reports from devices configured with a device client e.g. service processor configured to provide service usage notification updates on device service plan purchase or activation with UI options display and user selection actions device assisted access control policy enforcement device assisted service usage charging policy enforcement device assisted service notification messages etc. that communicates with service controller and places the reports on JMS queue . In some embodiments usage reporting gateway only accepts device reports from device service processors that have authenticated with the service controller system e.g. service controller . In some embodiments usage reporting gateway only accepts device reports from device service processors configured with device credentials or user credentials that are members of a device group or user group that is managed by service controller . In some embodiments usage reporting gateway rejects reports from end user devices without authenticated service processors. In some embodiments usage reporting gateway is an application or a process thread. In some embodiments usage reporting gateway quickly receives and acknowledges end user device reports. In some embodiments usage reporting gateway provides asynchronous functionality that is advantageous to support real time processing requirements.

In some embodiments end user device is authenticated before reports are put onto JMS queue . In some embodiments JMS queue is a persistent queue. In some embodiments JMS queue is a primary messaging system between service controller applications.

Report processor retrieves reports from JMS queue transforms the reports and stores the transformed reports in usage report database . In some embodiments report processor is an EAI. In some embodiments report processor retrieves reports from JMS queue transforms the reports and stores the transformed reports in usage report database in a single transaction in order to provide fault tolerance in case of system failure. In some embodiments report processor formats the device usage report information to provide a common service usage information format to facilitate one or more of service usage processing reporting analysis comparison mediation and reconciliation purposes internal processing and comparison within the service controller system. In some embodiments report processor observes device usage report time stamps and time synchronizes time aligns or time aggregates multiple device usage reports so that a more consistent measure of usage with a common time reference can be achieved within the service controller system for one or more of service usage processing reporting analysis comparison mediation and reconciliation purposes.

In some embodiments CDR RTR filtering CDR RTR processor report processor and usage reporting gateway share a host.

In some embodiments micro CDR generator retrieves records from CDR RTR database and retrieves reports from usage report database . In some embodiments micro CDR generator determines a service usage amount for a micro CDR service usage classification assigns a usage accounting identifier to the micro CDR report that identifies the usage as being accounted to a device user for the device associated with a device credential or user credential and reports this amount of service usage to the carrier network in the exemplary embodiment of through JMS queue and FTP or publisher . In some embodiments micro CDR generator determines a service usage amount for a micro CDR service usage classification assigns a usage accounting identifier to the micro CDR report that identifies the usage as being accounted to a service sponsor and reports this amount of service usage to carrier network . In some embodiments the micro CDR for the sponsored service usage report also includes an identifier for a device credential or user credential. In some embodiments the amount of service usage accounted for in the micro CDR is mediated or reconciled off of a device or user bulk service usage accounting. In some embodiments micro CDR generator sends micro CDRs to JMS queue . In some embodiments FTP or publisher retrieves micro CDRs from JMS queue and pushes the micro CDRs to carrier .

In some embodiments fraud analyzer retrieves records from CDR RTR database . In some embodiments fraud analyzer retrieves reports form usage report database . In some embodiments fraud analyzer retrieves micro CDRs from micro CDR generator . In some embodiments fraud analyzer performs a fraud analysis using information from one or more of CDR RTR database usage report database and micro CDR generator . In some embodiments fraud analyzer compares usage records associated with a specific device or user credential from one or more of CDR RTR database usage report database and micro CDR generator to determine if service usage by that device is outside of pre defined service usage policy behavior limits. In some embodiments fraud analyzer compares service usage information associated with a specific device or user credential from one or more of CDR RTR database usage report database and micro CDR generator to determine if a pre defined service usage limit has been reached or exceeded by that device. In some embodiments fraud analyzer compares service usage information associated with a specific device or user credential from one or more of CDR RTR database usage report database and micro CDR generator to determine if the specific device or user is exhibiting a service usage behavior that is outside of pre defined statistical limits as compared to the service usage behavior of a device or user population. In some embodiments fraud analyzer stores the results of its fraud analysis in data warehouse . In some embodiments fraud analyzer sends fraud alerts to carrier network .

In some embodiments a service plan in effect for end user device is a time based service plan e.g. access network costs associated with a particular service or application are not charged to the user or are charged to the user at a reduced rate during a particular time period . In some such embodiments an agent on end user device detects fraudulent or potentially fraudulent activities by determining whether the time or time zone setting on end user device is correct or within a tolerance. illustrates an example procedure to detect when a user of end user device attempts to alter end user device s use of a time based service plan by modifying the time setting on end user device .

At step an agent e.g. policy control agent service monitor agent policy implementation agent etc. on end user device obtains the actual time. In some embodiments the agent obtains the actual time from a trusted source. In some embodiments the trusted source is an NTP server. In some embodiments the trusted source is a cell tower. In some embodiments the agent obtains the actual time based on information about a cell tower location. In some embodiments the agent obtains the actual time based on information from a GPS receiver. In some embodiments the agent obtains the actual time based on a geo located IP address. At step the agent compares the time setting on the device the device time to the actual time. At step the agent determines if the difference between the actual time and the device time is within a tolerance. In some embodiments the tolerance is set by portal user . If the difference is within the tolerance the process ends at step . If the difference is not within the tolerance the agent takes an action at step . In some embodiments the action is to generate a fraud alert. In some embodiments the action is to adjust the time setting on end user device . In some embodiments the action is to use the actual time to enforce a policy e.g. a control policy a charging policy or a notification policy . In some embodiments the action is to take a countermeasure such as for example to block delay rate limit or quarantine access to the access network by end user device . In some embodiments the action is to provide a notification to a user of end user device . In some embodiments the action is to send a message to service controller .

In the embodiment of rule based detection element also obtains CDRs. In some embodiments rules in fraud rules are event driven and are applied to incoming events e.g. CDRs from the carrier network or UDRs from end user device in real time or near real time. As will be appreciated by a person having ordinary skill in the art in light of the disclosures herein rule based detection element may use only UDRs only CDRs or both UDRs and CDRs.

As illustrated in UDRs are also supplied to static analysis element which generates a fraud score upon detecting potentially fraudulent behavior by end user device . In some embodiments static analysis element determines a fraud score using one or more models obtained from a statistical modeling element. In some embodiments static analysis element compares end user device s service usage against a corresponding population statistic for the device based service usage measure. In some embodiments these population statistics for the device based service usage measures include a classification of service usage based on application. In some embodiments these population statistics for the device based service usage measures include a classification of service usage based on network destination or network service identifier. In some embodiments these population statistics for the device based service usage measures include a classification of service usage based on network type. In some embodiments these population statistics for the device based service usage measures include a classification of service usage based on time of day. In some embodiments these population statistics for the device based service usage measures include a classification of service usage based on QoS class. In some embodiments these population statistics for the device based service usage measures include a classification of service usage based on geography. In some embodiments these population statistics for the device based service usage measures include a classification of service usage based on a roaming network.

As illustrated in UDRs are also supplied to time series analysis element which generates a fraud score upon detecting potentially fraudulent behavior by end user device . As will be appreciated by a person having ordinary skill in the art a time series is a sequence of data points typically measured at successive times spaced at uniform time intervals. Time series analysis comprises methods of analyzing time series data to extract meaningful statistics and other characteristics of the data. A time series model generally reflects the fact that observations close together in time are more closely related e.g. correlated than observations that are further apart. In addition time series models often make use of the natural one way ordering of time so that values for a given period are expressed as deriving in some way from past values and not from future values. In some embodiments time series models are used to detect significant changes in an individual subscriber s usage behavior that might indicate fraud. In some embodiments a time series model is used to compare current data usage against a past usage trend or to predict future potential fraud based on past usage. A time series model may model an individual device s data usage or it may leverage population or subpopulation data.

Fraud control center retrieves fraud data from main database and performs one or more of the following functions an aggregate analysis of various fraud metrics events and or scores to determine whether end user device is likely operating fraudulently presentation of fraud related information through a dashboard e.g. a user interface and taking an action to mitigate the fraud e.g. notify a network administrator of a network resource so that further evaluation can take place increase a billing rate for end user device notify a user of or subscriber associated with end user device of the service agreement violation and if applicable increased billing rate via one or more communication media e.g. service processor device notification client user interface text message e mail message voicemail phone call throttle or suspend end user device s access to the access network throttle or suspend an application s access to the access network.

As illustrated in the embodiment of offline statistical model retrieves UDRs from main database and generates models for use by fraud server in determining whether end user device is operating fraudulently. In some embodiments offline statistical model uses population data e.g. UDRs CDRs etc. to construct group profiles for legitimate subpopulations and for fraudulent subpopulations of end user devices within the control of service controller . In some embodiments offline statistical model identifies sudden or long term trends or global behavior shifts and adapts one or more data models based on those trends or shifts. In some embodiments offline statistical model uses on line learning to refine and train one or more models.

Fraud server generates fraud events e.g. fraud alerts and stores them in main database . Fraud control center retrieves fraud data from main database . Depending on the content of the fraud data fraud control center may display information about the fraud data on dashboard which in some embodiments includes a user interface such as a display. In some embodiments fraud responder takes an action based on the fraud data such as notifying carrier of fraudulent or potentially fraudulent activity by end user device .

End user device may contain a sponsored SIM card or another credential that allows the device to use a fixed amount of data possibly associated with a particular service at a reduced charge or at no charge to the user. Unscrupulous users may attempt to find ways to increase their quantity of free or subsidized data usage with sponsored SIM cards. In some embodiments service controller detects fraud associated with SIM cards and takes actions to address the fraud.

Without loss of generality in the following related embodiments the terms SIM card and SIM are used to represent a device credential source. As would be appreciated by one of ordinary skill in the art other device credential sources e.g. a soft SIM a universal SIM an IMSI source a wireless modem a phone number source an IMEI source an MEID source a MAC address source an IP address source a secure device identifier source a device secure communication encryption key source etc. can be interchanged with SIM card in many of the embodiments. For example in embodiments in which a SIM card is moved from one device to another another type of device credential could be moved instead e.g. soft SIM universal SIM an IMSI source a wireless modem a phone number source an IMEI source an MEID source a MAC address source an IP address source a secure device identifier source a device secure communication encryption key source etc. . As another example when a user tampers with a service processor associated with a SIM the user could be tampering with a service processor associated with another type of device credential e.g. soft SIM universal SIM an IMSI source a wireless modem a phone number source an IMEI source an MEID source a MAC address source an IP address source a secure device identifier source a device secure communication encryption key source etc. . There are many other examples where the term SIM can be exchanged for another source of device credentials with the examples being too numerous to list and yet evident to one of ordinary skill in the art in the context of the teachings herein.

In some embodiments the one or more device credential sources include a SIM card. In some embodiments service controller can be configured to recognize which end user device or service processor the SIM is associated with use the SIM and device association to look up a desired device portion of a wireless access network service policy and communicate the policy to the appropriate device service processor. In some embodiments the two different device portions of a wireless access network policy are determined according to a device group or user group service policy definition that includes one or more SIM credentials and or one or more service processor credentials and these policy definitions are entered in a virtual service provider work station that manages the service controller and or service processor policies.

In some embodiments service controller is configured to recognize when the SIM card from a first device with a first service processor has been moved to a second device with a second service processor. In some such embodiments service controller is configured to recognize which device or service processor the SIM is associated with use the SIM and device association to look up a desired network portion of a wireless access network service policy and cause the network portion of a wireless access network service policy to be implemented or enforced in one or more network service policy enforcement elements. In some embodiments the two different network portions of a wireless access network policy are determined according to a device group or user group service policy definition that includes one or more SIM credentials and or one or more service processor credentials and these policy definitions are entered in a virtual service provider work station that manages the service controller and or network service policy enforcement element policies.

In some embodiments the one or more device credential sources include a SIM card. In some embodiments service controller is configured to detect when a device user has moved the SIM card from a first device configured with a properly configured service processor to a second device that is not configured with a properly configured service processor. In some embodiments service controller is configured to determine that the first device is configured with a properly configured service processor and communicate a device portion of a wireless access network service policy to the appropriate device service processor. In some embodiments the device portion of a wireless access network policy is determined according to a device group or user group service policy definition that includes a SIM credential and or a service processor credential and these policy definitions are entered in a virtual service provider work station that manages the service controller and or device service processor policies. In some embodiments service controller is configured to determine that the first device is configured with a properly configured service processor and cause a first network portion of a wireless access network service policy to be implemented or enforced in one or more network service policy enforcement elements. In some embodiments service controller is configured to determine that the second device is not configured with a properly configured service processor and cause a second network portion of a wireless access network service policy to be implemented or enforced in one or more network service policy enforcement elements. In some embodiments the device portion of a wireless access network policy is determined according to a device group or user group service policy definition that includes a SIM credential and these policy definitions are entered in a virtual service provider work station that manages the service controller and or network service policy enforcement element policies.

In some of these embodiments the differences between the first network portion of a wireless access network service policy and the second network portion of a wireless access network service policy can include a difference in network access privileges a difference in allowable network destinations a difference in service usage accounting or billing for bulk access a difference in service usage accounting or billing for a classification of access a difference in service usage accounting rates or billing rates for bulk access a difference in service usage accounting rates or billing rates for a classification of access a difference in sponsored ambient service accounting or billing a difference in service speed or quality a difference in which networks the device or user has access to a difference in the service usage notification that is provided to the end user a difference in roaming service policies or permissions or accounting billing rates a quarantining of the device or user access capabilities differences between e.g. disabling or otherwise modifying one or more features of device operation or suspending the device from access to the network.

In some embodiments a SIM and service processor are associated with a classification of service usage and a corresponding device portion of access network service policy enforcement. Service controller is then responsible for properly authenticating the proper configuration of service processor in association with the SIM in order to determine the appropriate network portion of network access service policy that should be enforced.

In some embodiments a SIM and service processor are associated with one or more application specific services wherein the device network access service has policy elements that are specific to a device software or firmware application. A software or firmware application specific service can include but is not limited to a service with specific policy elements associated with a user application program an operating system program library or function a background application service such as an application update content caching software update or other background application service.

In some embodiments a SIM and service processor are associated with one or more network destination specific services wherein the device network access service has policy elements that are specific to a network destination or resource. A network destination or resource can include but is not limited to a server gateway destination address domain website or URL.

In some embodiments a SIM and service processor are associated with any combination of a device application network destination or resource a type of network a roaming condition e.g. a home or roaming network a time period a level of network congestion a level of network quality of service QoS and a background or foreground communication.

In some embodiments a SIM and service processor are associated with one or more sponsored services also referred to herein as ambient services wherein a portion or all of the service usage accounting for one or more classifications of service usage are accounted to charged to or billed to a service sponsor rather than the device user or party who pays for the user service plan. The portion of service that is sponsored can be all of the device access or a portion or classification of the device access. In some embodiments the classification of the sponsored portion of service e.g. the identification of the portion of the device s use of the access network that should be allocated to the service sponsor is accomplished on the device with service processor . In some embodiments the classification of the sponsored portion of service is accomplished in the network using DPI elements gateway elements server elements proxy elements website elements or web service elements. In some embodiments the classification of the sponsored portion of service is accomplished with a classification policy implemented by a combination of a service processor on the device e.g. steering a classification of service to a given network element via a re direction re route or tunnel e.g. secure SSL VPN APN or other tunnel protocol and one or more network elements e.g. DPI elements gateway elements server elements proxy elements website elements or web service elements . In some embodiments the portion of service that is sponsored includes service for one device application or a group of device applications. In some embodiments the portion of service that is sponsored includes service for a network destination or resource a server or website or a group of network destinations servers or websites. In some embodiments the portion of service that is sponsored includes service on a specific type of network. In some embodiments the portion of service that is sponsored includes service on a home network or a roaming network. In some embodiments the portion of service that is sponsored includes service during a time period. In some embodiments the portion of service that is sponsored includes service for a certain range of network congestion. In some embodiments the portion of service that is sponsored can include service for a certain range of network QoS. In some embodiments the portion of service that is sponsored includes service for a network background or foreground data communication. In some embodiments the portion of service that is sponsored includes any combination of device application network destination or resource a type of network a roaming condition e.g. home or roaming network a time period a level of network congestion a level of network QoS and a background or foreground communication.

In some embodiments a SIM or other source of user credential or device credential as explained previously is installed in or present in association with a device configured with a device service processor configuration that provides access network policy enforcement. In such embodiments one or more network elements can implement or enforce a network based portion of access network policy enforcement and service processor can be configured to implement or enforce a device based portion of access network policy enforcement. In some embodiments one or more SIM credentials can be used at least in part to identify the network based portion of access network policy. In some embodiments one or more SIM credentials can be used at least in part to identify the device based portion of access network policy.

In some embodiments that include a SIM module policy association the policy enforcement includes one or more of access control policy enforcement service usage limit access accounting policy enforcement and access service user notification policy enforcement. In some embodiments the access control policy enforcement includes one or more of allowing limiting blocking deferring delaying or traffic shaping device network access for bulk access e.g. not classified access or one or more specific classifications of access network service activities. In some embodiments the access accounting policy enforcement includes one or more of counting an amount of bulk e.g. unclassified access network service usage or counting an amount of access network service usage for one or more specific classifications of access network service activities. In some embodiments the access service notification policy enforcement includes one or more of notifying an end user when a pre defined service usage condition occurs for bulk e.g. unclassified access network service usage or notifying an end user when a pre defined service usage condition occurs for one or more specific classifications of access network service activities. Examples of specific classifications of access network service activities include access by an application or OS function access to one or more network destinations or network resources such as a web site domain IP address or other address identifier URL socket tuple network server network route or APN network gateway or proxy network content source or sub network . Additional examples of specific classifications of access network service activities include device access to network services with different QoS service levels. In some embodiments a portion of the policies associated with specific classifications of access network service are implemented or enforced with a device based service processor and other portions of access network service policy are enforced in one or more network based elements.

In some embodiments in which one or more network elements implement or enforce a network based portion of access network policy enforcement and a device service processor is configured to implement or enforce a device based portion of access network policy enforcement one or more device SIM credentials are identified and used at least in part to determine the policies enforced by the network. In such embodiments service processor can be relied upon to implement or enforce certain aspects of access network service policy that are not implemented or enforced in the network.

In some embodiments a first portion of access network service policy is determined at least in part by one or more SIM credentials and is implemented by one or more network elements and a second portion of access network service policy is intended to be implemented by a device based service processor but the SIM is installed in a device that is not configured with a service processor capable of implementing the second portion of access network service policy. In some such embodiments a network element identifies whether the SIM is installed in a device that is configured with a service processor capable of implementing the second portion of access network service policy intended to be implemented on the device. In some embodiments the identification is accomplished by a network system that implements one or more of the following device configuration detection and network policy selection functions 1 Identify when a SIM whose credentials are used at least in part to identify a network based portion of access network policy is installed in a device configured to include a service processor capable of implementing or enforcing a device based portion of access network service policy and provision a first network based service policy in one or more network based policy enforcement elements that implement or enforce access network service policy 2 Identify when a SIM whose credentials are used at least in part to identify the network based portion of access network policy is installed in a device that is not configured to include a service processor capable of implementing or enforcing a device based portion of access network service policy and implement a second network based service policy in one or more network based policy enforcement elements that implement or enforce access network service policy.

In some embodiments when it is determined that a SIM whose credentials are used at least in part to identify the network based portion of access network policy is installed in a device configured to include a service processor capable of implementing or enforcing a device based portion of access network service policy a network based service policy provisioning system provisions a first network based service policy into one or more network elements e.g. programs or sends the policy to one or more network elements and also provisions a device based service policy into a device service processor. In some embodiments when it is determined that a SIM whose credentials are used at least in part to identify the network based portion of access network policy is installed in a device that is not configured to include a service processor capable of implementing or enforcing a device based portion of access network service policy a network based service policy provisioning system provisions a second network based service policy into one or more network elements and there is no policy provisioning for a device based service processor.

Such embodiments are advantageous for example when a device based service processor is capable of implementing or enforcing a network access service policy that has fine grain classification aspects that are not otherwise implemented or enforced in the network. For example in some embodiments a SIM is installed in a first device configuration that includes a device based service processor e.g. service processor capable of classifying access network service usage associated with one or more device software applications and enforcing a policy for access control service limit access accounting or access service notification for that classification. In this case a first set of network based access network service policies may be provisioned into the network elements that implement or enforce access network service policy. If the same SIM is installed in a second device configuration that does not include the described service processor capability a second set of network based access network service policies may be provisioned into the network elements that implement or enforce access network service policy. In such embodiments the first device configuration can include a trusted access control or service limit policies in service processor that determine the network access allowances for one or more applications and the first network service policies are configured to facilitate this device based application access control or service limitation. In contrast the second device configuration having no service processor has no trusted access control or service limitation policies and therefore the second network service policies may be configured in a manner that allows access only if the service plan or service account associated with the SIM or second device or SIM user includes permissions for bulk access unclassified access or access that is classified by the network and not by the device.

In some embodiments the second network service policies are configured to modify the classification of network access services in accordance with capabilities that exist only in the network without the assistance of a device assisted classification component.

In some embodiments the second network service policies include a second access service accounting or charging rate that is different than the access service accounting or charging rate of the first network service policies. For example the method of service accounting or service charging to the end user in the case where the SIM is installed in a device configuration that includes a service processor capability e.g. the device is capable of performing service classification accounting control or notification functions can be different than the method of service accounting or service charging to the end user in the case where the SIM is installed in a device configuration that does not include the service processor capability. For example if the SIM is installed in a device configuration that includes a service processor capability a given application e.g. social networking application email application search application voice application news application etc. might have a first service accounting or charging policy defining a first charging measure e.g. time based usage for an application website content type service type QoS class or e.g. megabyte based usage for an application website content type service type QoS class etc. and or first charging rate e.g. X per minute or e.g. Y per megabyte etc. when the device configuration includes a service processor capability whereas when the SIM is not installed in a device configuration that includes a service processor capability all traffic may be rated in the same manner e.g. time based or megabyte based potentially with a higher price. In some embodiments when the SIM is not installed in a device configuration that includes a service processor capability the device network access permissions are altered or the device s communications may be quarantined or blocked.

In some embodiments when a SIM is installed in a device with a first device configuration service processor is configured to differentially treat one or more classifications of access network service activities based on network congestion level time of day QoS level or background foreground access e.g. background content caching or background upload of device user analytics background software or OS updates background application server communications etc. but the same SIM can alternatively be installed in a device without such service processor capabilities e.g. a device with a second device configuration . In such an embodiment one or more of the network based portions of access control or service limitation policy network based portion of accounting or charging policy or network based portion of user notification policy can be varied depending on whether the SIM is installed in a device with the first device configuration or the second device configuration. For example if the SIM is recognized by the network in association with the first device configuration a lower accounting rating or service usage price can be applied to traffic that is i allocated to background status ii is controlled based on network congestion level iii is controlled based on time of day iv is controlled based on a lower QoS classification allowance etc. whereas if the SIM is recognized by the network in association with the second device configuration a single potentially higher accounting rating or service usage price can be applied. In some embodiments if the SIM is recognized by the network in association with the second device configuration the device network access permissions can be altered or the device s communications can be quarantined or blocked.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that includes a service processor service usage charging capability one or more network elements are configured to zero rate the device access i.e. the one or more network elements will not apply the service usage accounting recorded by one or more network elements to the user s bill and user service accounting or charging is turned over to a service controller that receives service usage accounting or charging information from the service processor.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers one or more network elements are configured to zero rate the device access i.e. the one or more network elements will not apply the service usage accounting recorded by one or more network elements to the user s bill and user service accounting or charging is turned over to one or more proxy gateway servers configured to account or charge for device service usage.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers the one or more proxy gateway servers perform additional traffic access control or service limitation policy implementation or enforcement for the one or more classifications of service usage.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers the one or more proxy gateway servers perform additional service usage classification for the purpose of service usage accounting access control service limiting or user notification.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that does not include a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers network elements other than the proxy gateway servers account for service usage potentially at a different rate than when a SIM is determined by a network element to be installed in a device configuration that includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications.

In some embodiments in which the device configuration includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers the device routing re directing or steering is accomplished by routing re directing or steering the device traffic for one or more service usage classifications to a specific network destination or resource associated with the proxy gateway server. In some embodiments the routing re directing or steering is accomplished using a secure tunnel through the network. In some embodiments the routing re directing or steering is accomplished with a VPN or APN tunnel.

In some embodiments a network based service charging policy system is used in conjunction with a user service agreement confirmation system wherein the user agreement confirmation system provides confirmation that the user has agreed to access service usage terms that stipulate a first rate of access service usage accounting or charging when a SIM is detected in association with a device configuration that includes a service processor capability and a second rate of access service usage accounting or charging when a SIM is detected in association with a device configuration that does not include a service processor capability. In some embodiments if a user removes or tampers with a device configuration that includes a service processor capability or if a user installs a SIM in a device that is not configured with a service processor capability the user service usage billing conditions are changed. In some embodiments depending on the device configuration e.g. with or without a service processor capability the user is billed at a different rate for bulk service usage or is billed at a different rate for one or more classifications of service usage.

In some embodiments a network based service charging policy system is used in conjunction with a user service agreement confirmation system wherein the user agreement confirmation system provides confirmation that the user has agreed to access service usage terms that stipulate a first set of access service privileges when a SIM is detected in association with a device configuration that includes a service processor capability and a second set of access service privileges when a SIM is detected in association with a device configuration that does not include a service processor capability. In some embodiments if a user removes or tampers with a device configuration that includes a service processor capability or if a user installs a SIM in a device that is not configured with a service processor capability the user service usage permissions are modified. In some embodiments this modification can include altering the allowed network destinations altering the allowed network services altering the allowed network resources quarantining access or blocking access.

In some embodiments the presence of a device service processor in combination with a SIM results in the service controller providing advantageous network access services to the user. Examples include but are not limited to the sponsored services discussed herein user paid application based services e.g. user paid services where access for one or more device applications is included in a service allowance with potentially lower cost than overall internet access user paid destination services e.g. user paid services where access for one or more network destinations or resources is included in a service allowance with potentially lower cost than overall internet access roaming services e.g. services that aid the user when the device is connected to a roaming network such as by informing the user that she is roaming and asking if she wishes to continue or block roaming service usage up to date roaming service usage indication or cost indication roaming service rate indications allowing a user to decide which device service usage classifications he wishes to allow while roaming etc. or service usage notification services e.g. providing the user with an update of how much service usage or cost has been incurred informing the user of what service plans are available informing the user when a service plan sign up may be advantageous to the user based on an activity or group of activities the user is attempting or providing the user with a set of service plan sign up choices that can be selected and purchased in a device user interface UI etc. . In some embodiments these user services are made possible by the capabilities of the service processor on the device in conjunction with a specific configuration of a service controller or other network elements on an access service provider network.

In some embodiments if the SIM for a first network service provider is removed from the device and another SIM for a second network or service provider is installed the user may not have access to the same services. In some embodiments the service processor on the device detects that the SIM has been changed and informs the user through a device user interface UI notification that if the user changes SIMS or service provider networks the user will lose certain services. In some embodiments the services that will be lost are listed in a UI notification. In some embodiments the UI notification states that if the user wishes to regain access to certain services the user can re install the original SIM.

The above description is provided to enable any person skilled in the art to make and use the invention. Various modifications to the embodiments are possible and the principles described herein may be applied to these and other embodiments and applications without departing from the spirit and scope of the invention. Thus the invention is not intended to be limited to the embodiments and applications shown but is to be accorded the widest scope consistent with the principles features and teachings disclosed herein.

The invention can be implemented in numerous ways including as a process an apparatus a system a composition of matter a computer program product embodied on a computer readable storage medium and or a processor such as a processor configured to execute instructions stored on and or provided by a memory coupled to the processor. In this specification these implementations or any other form that the invention may take may be referred to as techniques. In general the order of the steps of disclosed processes may be altered within the scope of the invention. Unless stated otherwise a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. As used herein the term processor refers to one or more devices circuits and or processing cores configured to process data such as computer program instructions.

While various embodiments of the present invention have been described above it should be understood that they have been presented by way of example only and not of limitation. Likewise the various diagrams may depict an example architectural or other configuration for the invention which is done to aid in understanding the features and functionality that can be included in the invention. The invention is not restricted to the illustrated example architectures or configurations but the desired features can be implemented using a variety of alternative architectures and configurations. Indeed it will be apparent to one of skill in the art how alternative functional logical or physical partitioning and configurations can be implemented to implement the desired features of the present invention. Also a multitude of different constituent module names other than those depicted herein can be applied to the various partitions. Additionally with regard to flow diagrams operational descriptions and method claims the order in which the steps are presented herein shall not mandate that various embodiments be implemented to perform the recited functionality in the same order unless the context dictates otherwise.

Although the invention is described above in terms of various exemplary embodiments and implementations it should be understood that the various features aspects and functionality described in one or more of the individual embodiments are not limited in their applicability to the particular embodiment with which they are described but instead can be applied alone or in various combinations to one or more of the other embodiments of the invention whether or not such embodiments are described and whether or not such features are presented as being a part of a described embodiment. Thus the breadth and scope of the present invention should not be limited by any of the above described exemplary embodiments.

Terms and phrases used in this document and variations thereof unless otherwise expressly stated should be construed as open ended as opposed to limiting. As examples of the foregoing the term including should be read as meaning including without limitation or the like the term example is used to provide exemplary instances of the item in discussion not an exhaustive or limiting list thereof the terms a or an should be read as meaning at least one one or more or the like and adjectives such as conventional traditional normal standard known and terms of similar meaning should not be construed as limiting the item described to a given time period or to an item available as of a given time but instead should be read to encompass conventional traditional normal or standard technologies that may be available or known now or at any time in the future. Likewise where this document refers to technologies that would be apparent or known to one of ordinary skill in the art such technologies encompass those apparent or known to the skilled artisan now or at any time in the future.

The presence of broadening words and phrases such as one or more at least but not limited to or other like phrases in some instances shall not be read to mean that the narrower case is intended or required in instances where such broadening phrases may be absent. The use of the term module does not imply that the components or functionality described or claimed as part of the module are all configured in a common package. Indeed any or all of the various components of a module whether control logic or other components can be combined in a single package or separately maintained and can further be distributed in multiple groupings or packages or across multiple locations.

Additionally the various embodiments set forth herein are described in terms of exemplary block diagrams flow charts and other illustrations. As will become apparent to one of ordinary skill in the art after reading this document the illustrated embodiments and their various alternatives can be implemented without confinement to the illustrated examples. For example block diagrams and their accompanying description should not be construed as mandating a particular architecture or configuration.

