---

title: Method and system for dynamically allocating services for subscribers data traffic
abstract: Access services are dynamically allocated for processing received data traffic by creating routing information for data traffic associated with a particular subscriber, subscriber equipment and/or network address information. The routing information identifies services that the data traffic can be subjected to and the order in which the services are provided. When an attached request is received, appropriate services for the requesting subscriber are retrieved from a database based on particular identifying information which may include the identification of the subscriber, subscriber equipment, network address or other information. The services are organized in a routing path and the allocated network address and the routing path are transferred to a smart router. Data traffic, associated with the allocated network address is then routed through servers to provide the identified services.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09071505&OS=09071505&RS=09071505
owner: Flash Networks Ltd
number: 09071505
owner_city: Herzlia
owner_country: IL
publication_date: 20141007
---
This application is a continuation application of the non provisional application Ser. No. 12 946 363 filed on Nov. 15 2010 under 35 USC 111 and 37 CFR 1.53 b and claiming the benefit under 35 USC 119 e of the benefit of the prior filing date of the U.S. Provisional Application for patent that was filed on Nov. 19 2009 and assigned Ser. No. 61 262 824 each of which are hereby incorporated by reference in their entirety.

The present disclosure relates to the field of data communication over a packet switch network and more particularly to service allocation for subscriber s data traffic.

Today more and more access network operators ANO deliver personalized access services in addition to general access services. Exemplary personalized services at an access point can include spam filtering antivirus services filtering access to certain content servers control access to different restricted IP networks data optimization etc.

A subscriber of such a network can purchase one or more sets of the personalized services. Consequently to deliver a personalized set of access services to a certain subscriber a complex system and method configuration is needed. The necessity for the complex system and method configuration is at least partly due to the variety type of services subscribers demands or preferences of subscribers types of subscriber equipment SE etc. When subscribers have access to multiple services and or to different restricted IP networks with a variety of types of SE the network configuration becomes complex.

The network system and method becomes even more complex when an ANO access network operator offers on line purchasing of services features etc. or on line changing of the personalized set of access services by using a Call Center or a Self Care web site for example. An exemplary Call Center or Self Care server can enable a subscriber to modify his her personal set of access services thus forcing a change in the SE configuration and or network configuration. Managing supporting and provisioning of such changes can result in higher costs for providing service provisioning and management of frequent updates troubleshooting and technical support for subscribers. Furthermore such support and flexibility can be considerably time consuming and result in significant administration cost etc.

Exemplary access network operators can be a cellular operator a cable TV operator a Public Land Mobile Network PLMN operator a Public Switched Telephone Network PSTN operator etc. Throughout the disclosure the above listed types of access networks may be used interchangeably and the cellular network can be used as a representative example of an access network. Exemplary SE subscriber equipment can be mobile telephones cellular telephones smart phones such as but not limited to IPHONE a trademark of Apple computers Inc PDA s Personal Digital Assistants laptops notebooks personal computers or other computing device with communication capabilities. In the disclosure the above listed types of SE may be used interchangeably and the term mobile telephones can be used as a representative example of a generic type of SE.

In a common cellular packet switched network such as a General Packet Radio Service GPRS network a Gateway GPRS Support Node GGSN can act as a gateway between the GPRS network and an Internet Protocol IP network. When a subscriber located in the GPRS network wishes to have wireless attachment connectivity or otherwise communicative coupling to a data network such as but not limited to an IP network the Gateway GPRS Support Node GGSN can be the gateway for translating between protocols used over the two networks. The term attachment communicatively coupled connected connectivity or the like refer to the ability for two devices systems or elements to share communications and may or may not include a physical and or dedicated connection and the term attachment may be used throughout to generically described a communication path between two devices systems etc.

When a subscriber wishes to establish an IP session his her SE transmits a data session activation message toward an access server at a cellular access network operator ANO for example. The data session activation message is used to attach or communicatively connect or couple an SE to a cellular access network. An exemplary access server can be a Serving GPRS Support Node SGSN . An exemplary Internet session activation message can include a subscriber ID such as an International Mobile Subscriber Identity IMSI or a Mobile Station International Subscriber Directory Number MSISDN and information on the SE capabilities etc. The SGSN can be the gateway for allowing or denying access attachment .

Typical methods that are commonly used for allocating access services can include authenticating the SE based on a subscriber name and a password for example. However such a method can result in configuration problems and require a subscriber to take certain actions such as configuring their own SE. Requiring the user to take such actions can be time consuming and in some situations the subscriber may simply not be sophisticated enough to take such actions.

Another typical method that is used today for providing different sets of access services to different subscribers utilizes an access point name APN . In such techniques each subscriber is provided with an APN from an operator. The APN reflects or is associated with a set of access services that the subscriber can receive or is authorized to utilize. In such access networks an attachment message will typically include the subscriber s APN number.

After validating the subscriber s rights or authorizations such as is typically accomplished by employing the use of a Home Location Register HLR and or an Authentication Authorization and Accounting server AAA a public IP address for accessing the Internet is allocated to the SE. The allocated public IP address is then used during the current session. A typical ANO has a pool of public IP addresses that can be allocated. The pool of public IP addresses can be divided into groups of public IP addresses and each group can be associated with a set of access services to be executed on a data communication session. Some ANO may allocate a private IP address to an incoming packet. The private IP address can be allocated based on an associate APN. When the packet leaves the access network the private IP address is replaced with a public IP address based by a network address translation NAT for example.

To deliver the large variety of sets of services to appropriate subscribers who purchase those sets an exemplary access network operator can utilize one or more routers. The routers operate to intercept the data traffic between the subscribers and the external network such as the Internet or some other network and then route the packets to the appropriate set of services according to the set of services that the subscriber is entitled to use or access. As an example a router can be configured to route packets from a subscriber to the Internet and vice versa via a certain set of services based at least in part on the public IP address utilized in the transmitted packets and the type of the application of the session. A few non limiting examples of routers that can be utilized include the Service Control Engine SCE product line manufactured by CISCO or Content Inspection Director CID product line manufactured by RADWARE or the BIG IP manufactured by F5 etc. Alternatively or in addition a chain of routers can be used with each router being located at the egress of a service and configured to route the data packets toward a next service according to public IP address associated with the data packets and a routing table. Consequently a multiple routers equipment is needed to supply the various services for each APN.

As the technology quickly advances new personal services are created. Several complications are encountered during typical operations because new personal services are frequently added. When new services are added the operator needs to be frequently updated regarding the new services. In addition routing tables associating the public IP addresses and the set of access services need to be updated with the new services and changes the groups of IP addresses also need to be updated. The relationship between the numbers of sets of services for each new added service is a permutation relation not a linear relation thus the up dating process is a long and complicated effort.

Furthermore this method is limited to a certain number of combinations of services because the pool of public IP addresses of the ANO is limited. Because the number of public IP address in each group is limited the number of subscribers with similar access services and similar APN that can be served simultaneously is also limited. Furthermore changing the access services that a subscriber can purchase and or changing the personalized set of services and or the SE can also require changing the configuration of the routers and or changing the APN at the SEs and or the groups in the pool of the public IP addresses.

We found there is a need in the art for a technique that can enable a subscriber to update his her requested personal services and dynamically supply those services when the subscriber sets an attachment to a data network. Further there is a need for such a technique to be simple or uncomplicated. Further there is a need for such technique to not be limited to the current techniques available. Yet further there is a need in the art for a solution that will prevent the limitation on the number of subscribers with similar sets of access services that can be served simultaneously. These and other needs in the art are uniquely satisfied by the various embodiments described within this specification.

Exemplary embodiments of a dynamic service allocator that are presented in the present disclosure provide novel systems and employ novel methods for solving the above described needs in the art. In general for each request received from a subscriber such as a request to attach access to a data network i.e the Internet or any public or private network various embodiments of the dynamic service allocator may operate to collect information on the latest personalized set of access services to which the subscriber is entitled. Because the information for various embodiments of the dynamic service allocator is on a subscriber basis rather than a fix set services basis groups of APN there is no need to reallocate the subscribers public IP address from a specific limited group of public IP address numbers. Thus the subscriber can receive a random IP public address number from the entire pool of public IP addresses that are available to the ANO. Some ANO may allocate a private IP address to an incoming packet. The private IP address can be allocated based on an associate APN. When the packet leaves the access network the private IP address is replaced with a public IP address based on a network address translation NAT for example.

Based on the latest or current information pertaining to the subscriber various embodiments of the dynamic service allocator can instruct a novel smart router as to which access services to route the data traffic. An exemplary smart router can operate to intercept the data traffic between the subscriber and the Internet. Such a smart router may be installed in an access network between an access gateway and a border gateway. As a non limiting example within a cellular access network an access gateway can include an SGSN followed by a GGSN and the border gateway can be a common IP router. In some embodiments the border gateway may include NAT functionality.

In an exemplary embodiment of the dynamic service allocator can be installed at an access network between a subscriber and the Internet at an ANO premises ANOP . In such an example the ANO can be a telecom operator such as but not limited to a cellular operator a satellite communication service provider a Public Switched Telephone Network PSTN operator etc. Other exemplary embodiments of the dynamic service allocator can be installed at an Internet Service Provider ISP premises etc.

An exemplary dynamic service allocator can include but is not limited to a service orchestration server SOS and a smart router that has been configured to accept and process routing instructions received from the SOS. Based on the routing instruction the smart router can update a routing table with regards to which services ports to route packets received from a relevant subscriber. In addition to its common operation an exemplary ANOP can be adapted to respond to a request to attach to a data network. For example if the ANOP receives an attachment request from a subscriber at an access gateway service gateway the ANOP can inform the SOS about the requested new data session. An exemplary access gateway can be an SGSN. The access gateway can deliver information about the subscriber to the SOS. The delivered information may include the subscriber s ID such as an International Mobile Subscriber Identity IMSI or a Mobile Station International Subscriber Directory Number MSISDN etc. The information can further include an allocated random public IP address for that subscriber that is selected from a pool of public IP addresses of the ANOP. The allocated public IP address can be one selected from the entire pool of public IP addresses of the ANO rather than having to be restricted to a group of IP addresses within the pool of IP addresses recognized or associated with certain services. In some embodiments as mentioned above a private IP address can be used in the access network.

Upon receiving the indication of the establishment the new session from the SGSN the SOS can collect information about the access services that the requesting subscriber is entitled to access or utilize. The access service information can be collected by the SOS from different resources such as an AAA server HLR Home location register server self care server ANO s databases etc. The SOS can find and locate the access service information for the subscriber using various searching techniques such as searching on the subscribers ID. In some embodiments the different resources of the access service information can be configured to update an access services database with the latest information on the access services a subscriber is entitled or authorized to access or utilize. The subscriber s ID as well as additional or alternative information i.e the identification information can be a subscriber ID SE identification information or any of a variety of information can be used as an index to the access services database. It should be noted that the terms databases database and access services database are used interchangeably herein and represent one or more databases in the ANOP that contains information on the latest access services a subscriber is entitle to and are organized according to the subscriber s ID.

The collected access service information for the subscriber can be processed and a routing path can be prepared created or obtained from a database of routing paths based at least in part on the access service information. The routing path among other things can define which of the smart router ports are to be used for the subscriber data traffic for instance defining a list of access services through which the data packets may be passed . The routing path can be translated to an API application program interface according to the API of the utilized by the router a generic API that can later be converted or a proprietary format and custom routers may be used or off the shelf routers may be modified to be compatible with the proprietary format. In accordance with the routing path the data traffic of the subscriber can be passed through one access service returned to the smart router passed to the next access service returned to the smart router and so on.

The routing path can be sent to the smart router together with the subscriber allocated public IP address. Based at least in part on the received information including the routing path and the subscriber allocated public IP address the smart router can update the routing table using the allocated public IP address as an index for example. Thus in an exemplary embodiment the routing information is for the particular subscriber for the current access session. In such an embodiment an explicit personal set of services are given that particular subscriber according to current public IP address allocated for that particular subscriber.

Upon receiving data packets that are sent between any such subscribers and the Internet the smart router based at least in part on the allocated public IP address with or without the port number of the packet operates to search the routing table and according to the routing plan for that current allocated public IP address current subscriber the smart router routes the packet directly toward its destination the Internet or the subscriber or through the one or more purchased access services.

Various embodiments of the dynamic service allocator can enable dynamic decision making regarding which access services to grant to each subscriber. Exemplary dynamic decision making can be based on different real time variables. As non limiting examples the real time variables can include one or more of the time of day the location the load the BW consumption the type of subscriber equipment the surfing history of the subscriber and so on. Utilizing such a feature the SOS can check each subscriber request and other external parameters before automatically routing to a certain access service. If according to the specific request and the external parameter there is no need to route the traffic through a certain access service then the SOS can decide to skip that service. For example if the subscriber is entitled to receive content filtering such as porn sites the SOS route utilize the filter service to prevent a subscriber or someone utilize the subscriber s SE from having access to such content. As another example based on the current time i.e. late at night the SOS may assume that that an adult is surfing the web and not a child and thus the SOS can decide not to route the request through content filtering service. Real time location of the subscriber can also be used for determining which access service to offer certain news local advertisement for example and so on. Advantageously such a feature can result in a cost saving as some access services charge a fee. Thus if certain traffic does not require a particular service even though the subscriber is entitled to that service the operator or SOS can decide to deny that service and to save cost and time.

In yet another exemplary embodiment the novel SOS can instruct the smart router to route traffic through default access services that all subscribers data traffic can automatically pass through. The default access services can be used if there is no information regarding the subscriber s rights. In some other exemplary embodiments a packet can first be transferred to a deep packet inspection server DPI . Such a DPI can inform the SOS with regards to parameters that can be used during a data session. For example a typical parameter can be a URL of a certain request. According to information received from the DPI the SOS can update the routing instructions. Consequently embodiments of the dynamic service allocator can dynamically update the routing instructions between the different access services that a subscriber may utilize.

Another advantage of exemplary embodiments of the dynamic service allocator is the elimination of the need for splitting the ANO s pool of public IP addresses into a plurality of groups where each group is associated with a certain set of access services. Simplifying the management efforts required for handling a variety of groups of public IP addresses helps to improve the flexibility in allocating a large number of similar services simultaneously. This advantage is realized by the fact that the entire pool can be used for a single set of services instead of a single group. Furthermore various embodiments of the dynamic service allocator operate to alleviate the need for complicated and frequent configuring calculation and updating of different entities that are involved in allocating access services. For example entities such as chains of routers SEs SGSM server etc. Embodiments of the dynamic service allocator can broaden the capabilities of the operator enabling the operator to make dynamic decision that will improve the systems overall performance results and improve the subscriber experience.

Another advantageous feature that can be included in various embodiments of the dynamic service allocator is that the number or routers required to process the data traffic of a subscriber can be reduced. For instance various embodiments of the dynamic service allocator may operate by routing the data traffic of the subscriber in accordance with the routing path received from SOS by passing the data traffic through one purchased access service which is then returned to the smart router then passing the data traffic to the next purchased service which also returns to data traffic to the smart router and so on. This process can be repeated until the last purchased service has processed the data traffic and then the data traffic is passed to the Internet Intranet. Thus this method reduces the number of routers needed for passing a subscriber data traffic when the data traffic requires multiple access services. In addition the capability of the SOS to control the allocation of the access services per each user may save resources of certain services that a certain user is not interesting to get.

The foregoing summary is not intended to summarize each potential embodiment or every aspect or feature of the various embodiments of the dynamic service allocator and other features and advantages will become apparent upon reading the following detailed description of the embodiments with the accompanying drawings and appended claims.

Furthermore although specific exemplary embodiments are described in detail to illustrate the inventive concepts to a person skilled in the art such embodiments can be modified to various modifications and alternative forms. Accordingly the figures and written description are not intended to limit the scope of the inventive concepts in any manner.

Other objects features and advantages of the present invention will become apparent upon reading the following detailed description of the embodiments with the accompanying drawings and appended claims.

Turning now to the figures in which like numerals represent like elements throughout the several views various embodiments of disclosure dynamic service allocator are described. For convenience only some elements of the same group may be labeled with numerals. The purpose of the drawings is to describe exemplary embodiments and not for production. Therefore features shown in the figures are chosen for convenience and clarity of presentation only.

An ANOP can provide different access services to a plurality of different types of subscriber equipment SE . Non limiting examples of a few types of SE can include laptop computers mobile telephones PDA personal digital assistance computers etc. To further illustrate various embodiments of the dynamic service allocator a few not limiting examples of typical access services may include Spam filtering content filtering bandwidth consumption distribution etc. A typical ANOP can operate to identify a plurality of subscribers and the subscriber equipment SE utilized by such subscribers at its ingress by an Access gateway AGW for example. Non limiting examples of such an Access gateway include a Serving GPRS Support Node SGSN with a Gateway GPRS Support Node GGSN operating in a typical GSM network a PDSN and a Home Agent operating in a CDMA network etc. An exemplary ANOP can operate to identify the services a subscriber is entitled to utilize or access route data traffic of the subscriber through the appropriate services and output the served traffic through a border gateway BGW for example.

Each subscriber can be connected to the AGW through different communication links . The communication links in various environments may include but are not limited to wireless links wired links ADSL links cellular links etc. An ANOP may also include border gateway BGW at the interface to a network. The BGW can be a common Internet Protocol IP router for example. In some embodiments BGW may comprise NAT functionality.

In some exemplary embodiments of the dynamic service allocator not shown in the drawings the communication links can be based on an IP network. In such embodiments the communication links can be connected directly to an IP gateway that can be included in the AGW or exist separate from the AGW . For example when the ANOP is a GSM network the AGW can include an SGSN and a GGSN. In such environments the links can be connected directly to the GGSN.

The BGW can be connected to a plurality of packet data networks such as but not limited to the Internet or other global or wide area network. The BGW can also be connected to private packet data networks such as but not limited to an Intranet a private local area networks LANs etc. The communication between the BGW and the packet data network and or private packet data network can be data packet communication based on IP. The communication links between the subscribers and the AGW can be access communication links based on the packet data protocol PDP for example.

The ANOP can further comprise a packet data network which can receive data packet communication from subscribers through the AGW . Exemplary packet data networks can include a portion of the AGW . A smart router SR operating in conjunction with the ANOP can intercept and route the packet data traffic between the AGW and the BGW using one or more access services. The SR may be communicatively coupled to one or more service servers through one or more ports Pa Pd. The SR can route IP packets which it receives at its ingress port Pint from the AGW for example to one or more of the different service servers communicatively coupled to the SR through one or more of ports Pa d. The service servers may operate to provide access services such as but not limited to deep packet inspection DPI virus detection Spam rejection authentication content filtering data compression etc. Based on routing instructions received from a Service Orchestration Server SOS the SR can route a data packet through an appropriate set of services. The routing plan between the access services and the order of invocation of the access services can be determined at least in part on the public IP address that has been allocated to the subscriber for the data access session. The served data packet traffic once processed can be output via port Pex from the Smart router toward the BGW .

Data packet communication arriving from the packet data networks and or private packet data networks and directed toward a subscriber can pass through the BGW toward the SR . The access services that the data packets will be subjected to by the SR can be similar to the access services invoked for the data packets that the subscriber sent but the service may be invoked in a different order such as in the opposite order for example. Therefore the SR can search for the public IP address in the destination address fields of the header of the packet and route the data packets according to a routing plan associated with the public IP address.

The SOS and the AGW can be assisted by or query and or otherwise utilize one or more databases an ANOP management server ANS and a Call Center or Self Care server . The ANOP management servers ANS can be one or more servers such as but not limited to a home location register HLR in a cellular ANO a Policy Charging Rule Function PCRF server and or an Authentication Authorization Accounting AAA server for example. The databases can include information on the different subscribers on the types of subscriber equipment information on the access services that each subscriber is entitle to access or utilize subscriber preferences etc. The ANOP management server ANS can be responsible for authenticating subscribers authorizing their access to the network processing billing issues etc.

A subscriber can purchase through the Call Center or Self Care server different access services. The Call Center or Self Care server can update the databases with the latest information on the access services that a subscriber is entitle to utilize. The updated database can be used by the SOS for determining through which access services the data traffic of a subscriber needs to or may be routed. Internal control and information communication can be transferred between the different units in the ANOP. The control and information communication represented as doted arrows in the drawing can be transferred via one or more LANs using protocols such as but not limited to RADIUS GX etc. for example. More details on the operation and configuration of the SR and the SOS are disclosed below in conjunction with the description of and .

In some embodiments the different resources of information such as the ANS and the SCS can be configured to update a centralized access services database with the latest information on the access services a subscriber is entitle to utilize. The subscriber s ID as well as additional or alternative information can be used as an index to the access services database. It should be noted that the terms databases database and access services database are used interchangeably herein and represent one or more databases and sources for information in the ANOP that contains information on the latest access services a subscriber is entitled to and are organized according to the subscriber s ID or other key. In addition the database may be external to the ANOP and accessed when needed in either a push or pull manner.

An exemplary Call Center or Self Care server can enable a subscriber to modify his her personal set of access services. For example a subscriber can access the Call Center or Self Care server through an audio telephone a browser interface etc. A subscriber can be identified by a user name and password for example. An operator human or machine at the SCS can communicate or interact with the subscriber. In some embodiments a self care server can communicate with a subscriber through the BGW . The BGW can route to SCS IP data packets coming from the external networks and or from the SE and having the IP address of SCS as their destination IP address. For instance such packets may relate to updating interactions of the services which the subscriber wishes to purchase or to change and accordingly the SCS can operate to update the DB . The SCS destined packets may be generated by a program or system provided to allow the subscriber to modify change add and or delete access services or may be generated by other systems that automatically operate to modify change add and or delete services based on the interaction with the subscriber. For instance if the subscriber is utilizing INTERNET EXPLORER to access certain content the SE may send particular configuration information to the SCS whereas if the subscriber is using an email program different configuration information may be sent to the SCS . In some embodiments SOS may apply to SR for collecting information on a certain user. The information can include the bandwidth consumption of the user during the last session the time in the day that the user accesses the Internet etc. The SOS may store the collected information in DB for example.

An exemplary network interface to the SR NISR can act as an interface between the SR and the internal units of the SOS for example. The communicative coupling to the SR can be via a LAN for example. The NISR can obtain routing instructions from the SRC . The routing instruction can include or identify one or more access services and the invocation order for these access services. The instructions can be received via a queue a FIFO stack prioritized queue etc. The NISR can translate if necessary the routing instructions to comply with an API used between the SOS and the SR . An exemplary API can define the fields in which the allocated public IP address is written a field which indicates the type of the event attach or detach fields for the access services according to the order through which the packets having the relevant public IP address will be transferred etc. The NISR can also receive and transfer commands such as but not limited to initiating the current SR routing table etc.

The SOS can further include an SOS manager SOSM for example. The SOSM can control the internal units of the SOS . The SOSM can initiate the SOS internal units upon power on the SOS . The SOSM can allocate and introduce different units internal and external units and resources important to the SOS function upon power up and so on. The SOSM can be a processor that can communicate with the different servers in the ANOP . In some embodiments SOSM at the end of each event may apply to SR via NISR for collecting information on the certain event. The information can include the user ID bandwidth consumption of the user during the last event the time in the day etc. The SOSM may transfer the collected information to DB via NIA for example

For each attach event the smart router controller SRC can be responsible for planning a routing path for any of the packets associated with the public IP address which is mentioned or otherwise identified or associated with the attach event. The routing path defines the different service servers and the order through which the SR will transfer the received packets from to the SE to from the data packet network or . Based on the subscriber ID or other key the SRC can access the database via NIA and fetch an entry that is associated with the ID. Information can also be collected from the ANS . The SRC can then operate to parse the information stored in the entry and determine the relevant services to which the subscriber is entitle to utilize or access. The subscriber ID or other key can be or include portions or all of the International Mobile Subscriber Identity IMSI a Mobile Station International Subscriber Directory Number MSISDN and or other information for example. In some embodiments rather than employing an NISR the SRC can include an API application program interface for translating the routing instruction according to the API used with that the particular SR . The SRC forwards the routing path information to the SR through the NISR for example.

In some embodiments additional information can be fetched by the SOSM and be used by the SRC in order to define the current access services to be used. The additional information can be real time information such as but not limited to the current load over the ANOP the current time of day the location of the subscriber equipment surfing history of the subscriber the user ID of the subscriber using the SE i.e. when the SE is utilized my multiple users and so on. Based at least in part on the information found on the subscriber in the database and the real time information the SRC can plan a routing path for the data packets begin sent from or to the SE. The SR can save the received routing instructions in a routing table. Each entry in the routing table can be associated with a current allocated public IP address a current allocated public IP address and additional information may also be used. In some embodiments when a routing path is changed due to real time conditions such as but not limited to load then a report may be sent to ANS and or stored in DB .

A detach event can be converted by the SRC according to the API used by the SR into a detach instruction that includes the allocated public IP address and the detach indication. The detach routing instruction can be transferred via the NISR to the SR which in its turn operates to delete the entries in the routing table that are associated with the allocated public IP address. In some embodiment a detach event may lead to creating a report on the certain event.

After updating its routing table the SR can be configured to parse the network layer of data packets sent from the SE to the Packet data networks or Private data networks . Based at least in part on the source IP address of the received packet or other relevant information depending on the particular implementation a relevant entry in the routing table is searched and the packet is transferred via one or more access services by the SR . After transferring the packets via the relevant access services the packets are transferred toward the external networks . For data traffic traveling in the opposite direction the SR parses the network layer of data packets received from the external networks or . Based at least in part on the IP destination address or other relevant information depending on the particular implementation . the SR identifies the relevant entry in the routing table for the data packet. The received data packet can be routed through similar access services as the data packet received from that subscriber would pass but possibly in a different order i.e. the opposite order . Thus a single entry in the database can be used to store the routing information for data traffic in both directions and the order of the routing information modified simply based on the direction of the data traffic or other information such as the time of day the user ID etc.

In an alternate embodiment the SRC can act as the SOS manager . In such an embodiment there is no need for a separate unit SOSM as the SOSM can be implemented as part of the SRC . Yet in another exemplary embodiment the SOS can further include an SOS attached table SAT not shown on drawing . The SAT can be updated with relevant information for each new attached subscriber. Each entry in the SAT can be associated with a subscriber according to his her ID or other information about the subscriber or otherwise and the allocated IP address and so on. The SAT can also be updated each time a subscriber is detached and the relevant information on that subscriber can be either deleted or saved. Periodically the SAT can be searched and checked to determine if there are any sessions that were requested to be detached but were not and so on. Other exemplary embodiments of the SOS can further or alternatively include a confirmation entity that can validate each IP public address if no other subscriber is already using that IP public address and inform the SRC accordingly for example.

At T the Access Gateway AGW can then check with the ANOP management server ANS to determine if the subscriber and or the SE is entitled to attach to the Internet. The AGW and the ANS can communicate between each other via a LAN or other means in the ANOP using any of a variety of protocols such as the Radius protocol for example. The ANS can include an AAA server an HLR server and or a PCRF server for example. If the subscriber is entitled to access the Internet at time T the ANS can return an OK to attach message to the AGW . At time T the AGW can then allocate a public IP address to be used by the subscriber and or SE for accessing the Internet . The allocated address is sent to the requesting SE as approving of the request to attach the to data packet network. At time T the SOS can be informed that the subscriber having the relevant ID number has received access to the Internet by using the allocated public IP address. The allocated public IP address can be an available public IP address taken from a pool of IP addresses used by the ANO. In some ANOPs the GGSN section of the AGW can allocate the public IP address. In some embodiment a private IP address can be allocated instead of public IP address. The private IP address can be replaced by a public IP address by BGW when the packet leaves the ANOP to the Internet.

Next at time T the SOS can search the databases for an entry that is associated with the subscriber s ID or other information used as an access key for example. The entry is fetched and parsed to determine the latest access services associated with the subscriber or SE . The databases can also include real time policies or the real time policies or information can be injected or included when the information is fetched. The policies can lead to dynamically changes according to communication loads time of day day of the week month location of the subscriber etc. Once the SOS receives the information from the databases and or ANS at time T then the SOS can plan the routing path that the data packets to and from the subscriber need to pass. The SOS can then send at time T the planed routing path associated with the allocated public IP address to the SR . The routing path can include instructions regarding which services to pass the traffic through on its way to and or from that subscriber. The routing path can be saved in a routing table in the SR in an entry associated to the subscriber allocated public IP address for example.

At time T the first IP data packet is sent from the subscriber toward the AGW . The AGW can then at time T transfer the IP data packet to the SR . The smart router based at least in part on the allocated IP address or other additional or alternative information and the routing plan stored in the routing table can start at time T a loop in which the subscriber IP data packet passes through all the services that are required or desired. In cases in which the SR does not have a routing plan for a certain public IP address then the SR can route the packet via a default routing path which was configured by the ANO for example. An exemplary routing path can be SR passes at time T the IP data packet through port A of the SR to service server A SSa . Service server A processes the IP data packet and returns at time T the processed IP data packet to SR . Next the SR according to the routing plan transfers at time T the IP data packet through port D of the SR to service server D SSd . Service server D modifies the IP data packet and returns at time T the modified IP data packet to the SR . This loop or process may also include more services. At time T the modified IP data packet is transferred out of the SR toward the BGW and at time T the modified IP data packet is transferred toward an external network via BGW .

At time T an IP data packet can be received from the external network directed toward the subscriber through the BGW for example. At time T the BGW can transfer the received IP data packet to the smart router . At time T the SR can start an internal loop for the received IP data packet based at least in part on the IP destination number and or other information. The SR can fetch the routing plan for the public IP address included as the IP destination address of the data packet. The internal loop can be through the same service servers as the IP data packet sent from the subscriber but in a different order as demonstrated in the drawing . In some cases a packet from the Internet targeted to a SE may have other services than the packets that come from the SE toward the Internet. The routing path between the access services for both ways to and from the UE can be set by SRC which the UE attached to the access network. At time T the SR can pass the received IP data packet through port Pd service server D . At time T the modified received IP data packet is returned to the SR . At time T the SR passes the received IP data packet through port Pa service server A . At time T the modified received IP data packet is returned to the SR . This loop can include more services. At time T the SR can output the modified received IP data packet toward the AGW . And at time T the AGW can output the modified received IP data packet toward the subscriber via the AGW . In some embodiments the internal loop for the packets targeted toward the SE can be through different service servers than the packets transmitted from the SE .

The process can be continued until the subscriber request to detach from the data network by sending a detach request not shown in the drawing to the AGW . The AGW can inform the SOS that there is a detach event from the subscriber with subscriber ID and the used public IP address. The SOS can update the SR with an instruction to delete from the routing table the entry associated with that IP number or additional or alternative information. For instance a combination of a user ID and an IP number. In some embodiments the SR may use a timeout mechanism that deletes or modifies an entry in the routing table that was not active for a predefine period of time.

After the initial process a loop can be initiated. In the loop the next event from the SRC queue can be fetched and parsed . Next the type of event can be determined such as whether the event is an attach request detach request or other. If it is determined that the event is an attach request then based on the subscriber ID the databases is searched for relevant information and policies associated with the subscriber. The subscriber ID can be an IMSI or MSISDN for example or additional or alternative information can be used as a key to the database . Accessing the database can be done via the NIA for example. If information on that subscriber exists then a list of services that the subscriber is entitled to utilize or access the policies and real time information on that subscriber is fetched . The process then determines according to the information received together with real time data which services the subscriber will receive. The real time information can include the load on the communication lines the time of day the subscriber or SE location etc. Based at least in part on this information a routing path is planed for the subscribers data packets. The routing plan may be associated with an allocated public IP address that is embedded within the received attach event. The routing path with the allocated public IP address can be translated to comply with the API used by the SR and then be sent toward the SR via the NISR . Next the process returns to action block .

Returning to the decision process if no information is found on that subscriber then the process can determine through which default services to pass the subscribers packets. The process can determine and plan the routing path according to real time information such as the time of day the load on the communication lines etc. For example if the request is an Email message then process can determine to pass the subscribers packets through a Spam filter server. If the request is a web site then process can determine to pass the subscriber s packets through parental control and so on. The routing path can be translated to an API and sent together with the allocated public IP address to the SR via the NISR . Next the process returns to action block . The routing plan can include a port number that defines the application that is involved with the data packets. For example port can indicate on HTTP application port can indicate an email etc.

Returning now to the decision block if the event is a detach event then a release instruction is created in the API format together with the allocated public IP address. The release instruction can then be sent to the SR via the NISR and process can return to action block .

If the event is not an attach or a detach request the SOS can parse the event. If the event is related to the SR then the routing plan is updated and transferred to the SR . If it is not related to the SR then the event can be ignored.

In the description and claims of the present application each of the verbs comprise include and have and conjugates thereof are used to indicate that the object or objects of the verb are not necessarily a complete listing of members components elements or parts of the subject or subjects of the verb.

In this application the words unit element and module are used interchangeably. Anything designated as a unit or module may be a stand alone unit or a specialized module. A unit or a module may be modular or have modular aspects allowing it to be easily removed and replaced with another similar unit or module. Each unit or module may be any one of or any combination of software hardware and or firmware. Software of a logical module can be embodied on a computer readable medium such as a read write hard disc CDROM Flash memory ROM etc. In order to execute a certain task a software program can be loaded to an appropriate processor as needed.

The present invention has been described using detailed descriptions of embodiments thereof that are provided by way of example and are not intended to limit the scope of the invention. The described embodiments comprise different features not all of which are required in all embodiments of the invention. Some embodiments of the present invention utilize only some of the features or possible combinations of the features. Many other ramification and variations are possible within the teaching of the embodiments comprising different combinations of features noted in the described embodiments.

It will be appreciated by persons skilled in the art that the present invention is not limited by what has been particularly shown and described herein above. Rather the scope of the invention is defined by the claims that follow.

