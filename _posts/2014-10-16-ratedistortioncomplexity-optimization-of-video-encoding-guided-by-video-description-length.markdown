---

title: Rate-distortion-complexity optimization of video encoding guided by video description length
abstract: A system and method provide a video description length (VDL) guided constant quality video encoding strategy with bitrate constraint and a video coding system for optimizing encoding bitrate, distortion and complexity of an input video. The method obtains an overall VDL, temporal VDL and spatial VDL of the input video and compares the overall VDL, temporal VDL and spatial VDL of the input video with a reference VDL, temporal VDL and spatial VDL. Based on the comparison, the method adjusts the encoding bitrate, the overall encoding complexity, temporal encoding complexity and spatial encoding complexity of the input video and encodes the input video with the adjusted encoding bitrate, overall encoding complexity, temporal encoding complexity and spatial encoding complexity of the input video.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09225983&OS=09225983&RS=09225983
owner: Google Inc.
number: 09225983
owner_city: Mountain View
owner_country: US
publication_date: 20141016
---
This application is a continuation of co pending U.S. application Ser. No. 13 275 090 filed Oct. 17 2011 which is incorporated by reference in its entirety.

The invention relates generally to video hosting systems and more particularly to a video coding system for transcoding of videos with optimized visual quality under encoding time and bitrate constraints.

Video hosting services such as YOUTUBE allow users to post videos. Most video hosting services transcode an original source video from its native encoded format e.g. MOV into one or more output formats e.g. ADOBE FLASH or Windows Media Video WMV . Transcoding comprises decoding the source video from the native format into an unencoded representation using a video codec for the native format and then encoding the unencoded representation with video codecs for the output formats. Transcoding can be used to reduce storage requirements and also to reduce the bandwidth requirements for serving the video to clients.

One challenge in designing a video coding system for video hosting services with millions of videos is to transcode and to store the videos with acceptable visual quality and at a reasonable computing cost. A particular problem is the efficient allocation of coding bits and computations to achieve an optimized rate distortion R D and computing time of a source video. Generally given a target resolution and frame rate a video s visual quality is determined by its encoding bitrate computed using a rate control algorithm. Conventional video encoding systems use a variety of encoding strategies to obtain an optimized rate distortion of a source video including one pass and multi pass Average Bitrate Encoding ABR Constant Bitrate Encoding CBR Constant Quantizer Encoding CQP and Constant Rate Factor Encoding CRF .

Conventional encoding strategies fail to provide encoded videos with constant visual quality while meeting the bitrate constraint associated with the videos and do not optimize bitrate distortion and complexity jointly. For example an ABR encoding strategy uses scaling factors and long term and short term compensation to achieve a target bitrate and to meet network bandwidth constraint. But the visual quality of ABR encoding may fluctuate when video scenes change. A CBR encoding strategy is designed for real time streaming with constant bitrate which is controlled by a storage buffer with a fixed size. CBR provides the highest encoding speed but the lowest R D performance among the above mentioned conventional encoding strategies. A CQP encoding strategy maintains a constant quantizer and compresses every frame using the same quantization parameter QP . CQP may cause temporal perceptual fluctuation of encoded videos especially when it uses large quantizers on videos with intensive scene changes. A CRF encoding strategy aims to achieve a constant visual quality with a constant rate factor. CRF encodes a video with a nominal quantizer but increases the QP when a scene has a lot of action and motion and vice versa. The disadvantage of CRF encoding is that the output video file size is unpredictable due to the varying scenes in the video content. Thus it is hard to choose appropriate constant rate factor values to meet a required bitrate constraint of a network or storage system.

A method system and computer program product provides optimized transcoding of videos with constant quality and bitrate constraints guided by video description lengths for video hosting services.

In one embodiment the method obtains for an input video measures of overall complexity temporal complexity and spatial complexity and compares the overall complexity temporal and spatial complexity measures with reference complexity temporal and spatial complexity measures. The measures of complexity overall temporal and spatial of the input video are represented by certain video description length VDL of the input video. VDL is the bitrate needed to encode the video at certain visual quality. An overall VDL indicates the overall content complexity of the input video. The temporal VDL of the input video reflects the temporal complexity of the video. The spatial VDL of the input video reflects the spatial complexity of the video. Based on the comparison the method adjusts the overall encoding complexity temporal and spatial encoding complexity of the input video and encodes the input video with the adjusted overall encoding complexity temporal and spatial encoding complexity of the input video.

Encoding the input video with the adjusted overall encoding complexity temporal and spatial encoding complexity of the input video can be further enhanced by using a trained CRF reference bitrate model and a revised CRF bitrate model. The CRF reference bitrate model is trained on a large corpus of videos to model the relationship between CRF values and the average bitrate of CRF encoding. The revised CRF bitrate model is adapted to encode the input video with optimization.

Another embodiment includes a computer system that comprises a video description length module and a transcoding module for optimizing encoding bitrate distortion and complexity of an input video. A further embodiment includes a non transitory computer readable medium that stores executable computer program instructions for compressing images in the manner described above.

The features and advantages described in the specification are not all inclusive and in particular many additional features and advantages will be apparent to one of ordinary skill in the art in view of the drawings specification and claims. Moreover it should be noted that the language used in the specification has been principally selected for readability and instructional purposes and may not have been selected to delineate or circumscribe the disclosed subject matter.

The figures depict various embodiments of the invention for purposes of illustration only and the invention is not limited to these illustrated embodiments. One skilled in the art will readily recognize from the following discussion that alternative embodiments of the structures and methods illustrated herein may be employed without departing from the principles of the invention described herein.

Turning to the individual entities illustrated on each client is used by a user to request video hosting services. For example a user uses a client to send a request for uploading a video for sharing or playing a video. The client can be any type of computer device such as a personal computer e.g. desktop notebook laptop computer as well as devices such as a mobile telephone personal digital assistant IP enabled video player. The client typically includes a processor a display device or output to a display device a local storage such as a hard driver or flash memory device to which the client stores data used by the user in performing tasks and a network interface for coupling to the video hosting service via the network .

A client also has a video player e.g. the Flash player from Adobe Systems Inc. or the like for playing a video stream. The video player may be a standalone application or a plug in to another application such as a network browser. The player may be implemented in hardware or a combination of hardware and software. All of these implementations are functionally equivalent in regards to the invention. The player includes user interface controls and corresponding application programming interfaces for selecting a video feed starting stopping and rewinding a video feed. Also the player can include in its user interface a video display format selection configured to indicate which video display format e.g. a standard definition TV or a high definition TV . Other types of user interface controls e.g. buttons keyboard controls can be used as well to control the playback and video format selection functionality of the player .

The network enables communications between the clients and the video hosting service . In one embodiment the network is the Internet and uses standardized internetworking communication technologies and protocols known now or subsequently developed that enable the clients to communicate with the video hosting service .

The video hosting service comprises a RDC based video coding system a video server an ingest server and a video database . The ingest server receives user uploaded videos and stores the videos in the video database . The video server serves the videos from the video database in response to user video hosting service requests. The video database stores user uploaded videos and videos transcoded by the RDC based video coding system . In one embodiment the video database stores a large video corpus e.g. 20 000 user uploaded videos for the RDC based video coding system to train rate distortion complexity optimization models.

The RDC based video coding system comprises a RDC training module and a RDC based video transcoding module . The RDC training module trains a constant rate factor CRF bitrate model and an encoding computation profile ECP mapping module offline from videos stored in the video database . As explained further below the RDC based video transcoding module transcodes a given source video with a video description length VDL guided constant quality video encoding strategy under bitrate constraint with RDC optimization. The RDC optimization is achieved by finding RDC optimal encoding strategies for each encoding complexity levels with Pareto Optimal Set via the CRF bitrate model and the ECP mapping module. As a beneficial result a source video is transcoded to an output video that has an optimized visual quality under bitrate constraints associated with the target output video formats of the source video.

To further illustrate the system operation of the video hosting service is a flow diagram illustrating of the RDC based video coding system within the video hosting service . A user sends a request to the video hosting service for uploading a source video . The RDC based video coding system receives the source video in its native format and processes the source video by the RDC based video transcoding module . The source video in its native format has multiple video encoding parameters and video source information including e.g. frame rate spatial resolution and bitrate.

The source video can be also stored in a video database e.g. video database of and becomes a part of the video corpus stored in the video database. The video corpus is processed by the RDC training module . In one embodiment the RDC training module comprises a video encoder a CRF reference bitrate model and an ECP mapping module . The RDC training module encodes the videos in the video corpus using CRF encoding and trains the CRF reference bitrate model and ECP mapping module on the video corpus off line. The CRF reference bitrate model models the relationship between constant rate factor and bitrate of the CRF encoding. The ECP mapping module maps computation complexity levels from CRF encoding to encoding computation profiles and number of encoding passes.

The RDC based video transcoding module transcodes the source video guided by the CRF reference bitrate model and ECP module of the RDC training module . In one embodiment the RDC based video transcoding module comprises a revised CRF bitrate model a video description length module and a RDC based transcoder . The revised CRF bitrate model describes the relationship between the constant rate factor and the actual bitrate to encode the source video . The revised CRF bitrate model is revised based on the CRF reference bitrate model for encoding an input video. The video description length model describes computation complexity including overall temporal and spatial content complexity of encoding the source video . The RDC based video transcoding module transcodes the source video based on the relationships between the constant rate factor and the actual bitrate and the computation complexity represented by the video description length of the source video .

CRF encoding strategy aims to achieve a constant visual quality of encoding a video using a constant rate factor. Generally the CRF selected for a video represents a desired visual quality level to encode the video in one encoding pass. A large CRF value for encoding a video results in a large quantization parameter QP high compression ratio and thus low visual quality. A small CRF results in a small QP low compression ratio and thus high visual quality. A CRF value of zero means lossless compression and thus the highest visual quality. The CRF encoding compresses different frames of a video differently by dynamically adjusting the QP according to the amount of motion in the video frames.

The video compression performance using CRF encoding can be modeled by a CRF reference bitrate model e.g. the CRF reference bitrate model of where video compression quality can be represented by suitable CRF values. Using a trained CRF reference bitrate model the RDC based video coding system selects an appropriate CRF value for a source video which enables the actual bitrate used in encoding the source video to be close to the target bitrate associated with the target output video format of the source video. Further a trained CRF reference bitrate model provides an indication on how much average bitrate is needed to encode a video using a CRF encoding strategy. The actual bitrate to encode the source video with CRF obtained from the trained CRF reference bitrate can be used to revise a CRF bitrate model when encoding a given source video to achieve constant visual quality within the bitrate constraint associated with the target output video format of the source video.

Using the RDC training module of as an example the RDC training module trains the CRF reference bitrate model on the videos in the video corpus . The video corpus stores a large number of multi scene video sequences with multiple spatial resolutions frame rates and bitrates. The video encoder of the RDC training module encodes each video selected from the video corpus with a pre selected CRF value using CRF encoding and obtains an actual bitrate from the encoding. Any existing video encoding scheme known to those of ordinary skill in the art can be used by the video encoder to encode the video. In one embodiment the video encoder is a x.264 video encoder that encodes a selected video into H.264 MPEG 4 AVC format. Other embodiments of the video encoder may use a VP8 encoder or other available video encoders.

The CRF reference bitrate model uses crf bitrate pairs from encoding the videos in the video corpus as training samples to model the relationship between CRF and bitrate of CRF encoding. The relationship between CRF and average bitrate of a video of a video corpus is dependent on the spatial resolution the temporal resolution of the video and encoding algorithm which is fixed in default x.264 CRF encoding. The relationship between an average bitrate and spatial resolution temporal resolution and CRF is described as following 1 where B is the average bitrate M is the number of pixels of luminance component of a frame of the video i.e. the spatial resolution and T is the number of frames per second i.e. the temporal resolution. Since parameter crf M and T are mostly independent of each other the average bitrate described in Equation 1 can be represented as following . 2 The CRF reference bitrate model represents the fitting samples as quads crf M T B found by a least square method.

For average performance of video encoding that encodes single scene and multi scene videos the CRF reference bitrate model weighs the resulting bitrate from encoding a video by the number of scenes in the video and normalizes the bitrate by the total number of scenes in a selected number of training videos as follows 

Generally temporal resolution is evaluated by frame rate in the unit of frame per second fps . To study the temporal resolution effect on the CRF reference bitrate model the videos selected for training the CRF reference bitrate model are downsampled along temporal axis and the downsampled videos are encoded with half of the original frame rate of the videos. In this manner an original video and its downsampled version has the same display time. The CRF reference bitrate model is trained to obtain the average bitrate on videos with respect to each spatial resolution e.g. fps 12.5 and fps 25 fps 15 and fps 30.

The training result shows that bitrate almost increases linearly with encoding frame rate fps in other words 

To explore the relationship between average bitrate and spatial resolution M described in Equation 4 the CRF reference bitrate model is trained on simulated derived videos with hierarchical spatial resolution obtained by low pass filtering and downsampling on the original videos. For example the video encoder applies a low pass filter to the original videos with spatial resolution 704x576 for anti aliasing. The video encoder downsamples these videos to obtain lower resolution versions of the videos having sizes 352x288 and 176x144. The video encoder encodes the original 704x576 videos and their downsampled lower resolution versions with the same CRF values to determine the relationship between bitrate and the spatial resolution with respect to each CRF value. The training result shows that the bitrate spatial resolution polylines corresponding to different CRF values are nearly parallel. The bitrate increasing rate when decreasing CRF values is gradually decreasing along with the increase of the spatial resolution. The CRF reference bitrate model is further trained with videos having a variety of spatial resolutions and the training result shows similar relationship among bitrate spatial resolution and CRF values as the one for simulated videos.

Based on the training result the CRF reference bitrate model models the relationship between average bitrate and spatial resolution as follows 8 where 0

CRF values can take floating point values. In one embodiment the CRF values are in the range 0 51 for x.264 CRF encoding. CRF 0 is for lossless encoding and CRF 51 is for lossy compression with the smallest file size and the smallest peak signal to noise ratio PSNR . Using floating point CRF values to train the CRF reference bitrate model only CRF value is changed and the other encoding parameters e.g. frame rate are fixed by default for encoding videos to certain target spatial and temporal resolution. Sample CRF values of 12 14 . . . and 34 are used to encode videos into PSNR of 28 55 dB with visually acceptable and satisfactory compression quality.

The relationship between average rate and CRF under certain spatial and temporal resolution can be described in Equation 9 below . 9 

To model the Equation 9 parameter m is set to be 1380 and parameter n is set to be 0.20. The fitting error is evaluated by SSE 540.3 and RMSE 7.351. The average bitrate B and CRF relationship crf M T B described in Equation 4 can be represented by Equation 10 below 

To encode an input video with a CRF obtained from the trained CRF reference bitrate model the actual bitrate from encoding the input video may deviate from the target bitrate associated with the input video. A revised CRF bitrate model between CRF and actual bitrate is needed to adjust the actual bitrate towards the target bitrate for encoding an input video. In one embodiment the RDC based video transcoding module uses the revised CRF bitrate model to adapt CRF values to encode an input video. The revised CRF bitrate model can be revised using Equation 15 below 15 where k is a revising factor associated with an input video to be encoded.

To further illustrate the revision the revised CRF bitrate model first obtains a CRF from the mapping between CRF and average bitrate described in Equation 12 by substituting parameter B with the target bitrate associated with the input video. The resulting actual bitrate of encoding the input video and its corresponding CRF i.e. actual bitrate CRF is used to determined the revising factor k of Equation 15 as the following 

Using the trained CRF reference bitrate model and the revised CRF bitrate model the RDC based video transcoding module can encode an input video with constant visual quality within the bitrate constraint associated with the input video. The following algorithm represents one embodiment of encoding an input video with constant visual quality within the bitrate constraint associated with the input video.

The algorithm described here is one type of multi pass CRF encoding with CRF values evaluated from the trained and revised CRF bitrate models. The convergence criterion in step 6 is that the difference between the actual bitrate B and the target bitrate Bfalls in 10 of the target bitrate.

Encoding an input video towards the target bitrate associated with the input video the testing results show that the number of encoding passes is 1.8 in average. If the input video has content complexity close to the average one pass CRF encoding with CRF value found by the CRF reference bitrate model will encode the video towards the target bitrate. If the input video has content complexity deviating from the average multi pass CRF encoding is needed with CRF values found by the adaptively revised CRF bitrate model .

Varying contents in scenes captured by video sequences lead to various amount of information contained in the video sequences. Given a large video corpus of a video hosting service applying same encoding bitrate to different video content leads to different video qualities. Furthermore the video hosting service serves a variety of video output formats for each video uploaded to the video hosting service . Different output formats have different video processing goals in terms of target playback platforms e.g. mobile phone and high definition TV delivery constraints e.g. real time video streaming and video on demand and user expectations.

One solution to transcode videos having a variety of video formats and content complexity is to apply different bitrate control strategies to different videos. In one embodiment the RDC based video coding system chooses at least one of the three different bitrate control strategies and encoding parameters for a given video output format 

A control bitrate strategy is to achieve the actual bitrate of encoding a video as close as possible to the target bitrate of the video. This bitrate control strategy is suitable for mobile video streaming and video streaming using dial up Internet connections.

A control quality strategy is to achieve a constant target visual quality irrespective of the bitrate required to achieve it. Control quality strategy is used for encoding videos with varying complexity faces varying actual bitrates e.g. high bitrate for encoding complex videos and low bitrate for simple videos. This bitrate control strategy is suitable for video processing and streaming in a distributed video processing environment and for high visual coding quality transcoding e.g. lossless coding quality .

A control quality bounded bitrate strategy is to achieve a constant target visual quality as much as possible while maintaining an upper bound on the bitrate. Thus the visual quality is allowed to degrade below the target quality level only for complex videos where this quality is unachievable within the allocated maximum bitrate constraint. For simpler videos the bitrate can be lower than this maximum bitrate as long as the desired target quality level is achieved.

To further improve video transcoding performance the RDC based video coding system supports graded computation levels for a transcoder using a given bitrate control strategy. Specifically for a bitrate control strategy e.g. control quality bounded bitrate strategy there may be e.g. five different encoding computation levels supported by the RDC based video coding system 

FASTEST Provides the fastest transcoding time but does not necessarily produce the most compact output bit stream or the highest visual quality for the same bitrate. For most bitrate control strategies and output formats one pass encoding is conducted.

FAST Provides a reasonably fast encoding. For most bitrate control strategies and output formats one pass encoding is conducted.

MEDIUM Provides an encoding time versus encoding efficiency trade off that is suitable for most bitrate control strategies and output formats.

SLOW Uses more computationally expensive tools for encoding in order to produce transcoded videos at higher encoding efficiency i.e. higher visual quality at the same bitrate. For example video codec x.264 sets compression efficiency control parameter preset slower or preset placebo to encode videos with high visual quality.

SLOWEST Uses computationally demanding and sophisticated tools for encoding in order to produce the most compact output bit stream and the highest perceptual quality video such as movie studio quality videos. When measured in terms of PSNR the visual quality at this encoding computation level may be equal or lower than that achieved by the SLOW mode.

With a number of encoding computational levels available for a transcoder the RDC based video coding system implements various transcoding policies to adapt the encoding computation levels depending on factors such as current system load on servers in a network e.g. cloud computing network demand for live streaming or allowable transcoding latency. For example multiple initial streaming transocoding can be conducted at a low computational level to reduce latency for live video streaming. A video streaming rerun on the other hand can be conducted with a higher computational level with acceptable latency where the rerun is to respond to the increased popularity of the video.

To optimize the various bitrate control strategies and to support the graded encoding computation levels for each bitrate control strategy the RDC based video coding system follows a systematic procedure which not only evaluates multiple ways of implementing different bitrate control strategies but also considers the optimal allocation of computation for each bitrate control strategy. In one embodiment the RDC based video coding system trains an encoding computation profile ECP mapping module to model the computation efficiency trade off in a fine grained manner.

ECP is a computational complexity allocation control parameter which could be easily integrated in x.264 encoding. The ECP parameter takes a floating point value between 0 and 1 and can be used to fine tune the trade off among bitrate distortion and computation complexity. Existing bitrate control strategies focus on trade off between rate and distortion of video encoding. However when computation of encoding is considered as a criterion for evaluating encoding efficiency the trade off between rate and distortion needs to be adjusted together with the computation of encoding.

For example in a two pass encoding scheme the first encoding pass is typically conducted faster than the second one because the first encoding pass is used to obtain some statistic information of the video. The overall two pass encoding generally consumes higher computations than an one pass encoding scheme. However it is not obvious whether an one pass encoding with high computational complexity is more efficient or less efficient than a two pass encoding with less computational complexity. The ECP mapping module of the RDC based video coding system is designed to find the optimal allocation of computation for multi pass based video transcoding e.g. x.264 based multi pass transcoding as well as number of encoding passes for a given encoding computation level.

Turning now to the ECP mapping module of the RDC training module is trained on the videos stored in the video corpus . For each encoding strategy the ECP mapping module is trained over different possible implementations and different possible computation levels for multi pass transcoding to obtain raw rate distortion complexity data. The ECP mapping module is further optimized for example using a multi criteria Pareto optimal set analysis on the raw rate distortion complexity data to derive the best transcoding implementation and computation allocation for each of the bitrate control strategy at multiple equally spaced encoding computation levels e.g. in one embodiment there may be five encoding computation levels FASTEST FAST MEDIUM SLOW and SLOWEST computation levels .

Taking multi pass x.264 transcoding as an example the ECP mapping module represents the computation allocation for a two pass encoding by a pair ecp ecp. ecprepresents the computational complexity of one pass bitrate encoding or a first pass of a two pass bitrate encoding. ecprepresents the computational complexity of a second pass of a two pass bitrate encoding. For example 0.07 NULL represents the computational complexity of one pass bitrate encoding implementation and 0.07 0.71 is an example computational complexity of a two pass bitrate encoding implementation.

For each bitrate control strategy ECP mapping module is trained offline on a set of videos from the video corpus . Each training sample is associated with a rate distortion complexity performance a R D C triplet where the actual encoding bitrate R is obtained from the training the distortion D is measured by the mean square error MSE of luminance component of video frames and the complexity C is represented by encoding time per frame. Following is an algorithm for training the ECP mapping module for control bitrate bitrate control strategy with a multi pass x.264 transcoding scheme 

The optimized computation allocations for five computation levels with control bitrate control strategy is illustrated in TABLE 1 below 

As illustrated in TABLE I for each computation level the ECP mapping module provides a pair of ECP values ecp ecp indicating the number of encoding passes and computational complexity allocation control parameter values needed. For example for encoding a video having a medium computation complexity using control bitrate control strategy two encoding passes can be used to achieve optimized rate distortion complexity trade off and for the first encoding pass the ECP value is 0.07 and 0.50 for the second encoding pass. To encode a video for real time streaming encoding time needs to be fast without unacceptable delay. The RDC based video coding system can choose one pass encoding with ECP value of 0.35 to balance the rate distortion complexity trade off.

In another embodiment the ECP mapping module is trained using another video encoding scheme VP8 also referred to as WebM . Instead of using encoding computation profile parameters i.e. ecp ecp VP8 uses encoding speed control ES parameters to manage the trade off among rate distortion and computation complexity. TABLE 2 shows an example of computation allocations for five computation levels with control bitrate control strategy using VP8 encoding scheme 

The ECP mapping module is similarly trained on the videos from the video corpus for other bitrate control strategies such as control quality strategy and control quality bounded bitrate strategy. TABLE 3 shows the optimized computation allocations for five computation level with control quality control strategy with x.264 encoding scheme and corresponding computation allocations for VP8 encoding scheme. To achieve a constant target quality only one pass encoding is suggested by the ECP mapping module to the RDC based video transcoding. TABLE 4 shows the optimized computation allocations for five encoding computation level with control quality bounded bitrate control strategy with x.264 encoding scheme and corresponding computation allocations for VP8 encoding scheme.

RDC based video coding system can optimize multi pass encoding performance by adjusting encoding parameters of subsequent encoding passes based on previous encoding pass. For example in a two pass encoding scheme to encode an input video the RDC based video coding system can adapt the encoding parameters e.g. bitrate motion estimation methods and motion vector search range of the second encoding pass based on the encoding parameters of the first encoding pass. If the actual bitrate of the first encoding pass is less than an average bitrate encoded with the same ECP value it indicates that the input video has simpler video content than an average video the ECP value of the second encoding pass can be decreased to save computations for encoding the input video while keeping the same rate distortion performance. If the actual bitrate of the first encoding pass is larger than an average bitrate encoded with the same ECP value the ECP value of the second encoding pass can be increased to achieve more rate distortion performance gain for encoding the input video.

To transcode a source video with acceptable visual quality at minimal cost needs effectively evaluates the video encoding complexity of the source video. Ignoring the impact of video content complexity on transcoding a video degrades the visual quality of the transcoded video and user experience. The information about how many bitrates are needed to encode videos at certain visual quality is useful for video encoding efficiency optimization because the bitrate information for encoding an input video reflects the video content complexity of the source video.

In one embodiment the RDC based video coding system uses video description length to represent the video content complexity of a video. VDL is the bitrate needed to encode the video at a certain visual quality. Different videos have different VDLs. Videos with slow motion and smooth images have short VDLs indicating that the videos are easy to encode with small bitrate but high visual quality. On the other hand videos with intensive motion and complex textural content have long VDLs indicating that the videos are difficult to encode.

Video description length is very useful for many applications like adaptive video encoding and decoding. For video transcoding VDL guides a RDC based video transcoder to choose a target bitrate or a target constant rate factor to encode the video into its output video formats efficiently. The RDC based video transcoder can compare the complexity of an input video with a reference video in terms of their associated VDLs and determines the proper encoding parameters for the input video by referring to the existing reasonable encoding parameters of the reference video.

The overall VDL is the actual bitrate of a video when it is encoded with CRF 26 complexity fastest. The CRF value is a configurable parameter and experimental data shows that a video is in good visual quality when the video is encoded with CRF 26 with CRF encoding.

The temporal VDL is the difference of the actual bitrate of a video when it is encoded with two different complexities e.g. CRF 26 complexity fast and CRF 26 complexity fastest . The temporal VDL of a video reflects the temporal complexity of the video. Videos having different temporal complexity differ mostly from how fast to process motion detected in the videos. How fast a detected motion in a video to be processed depends on one or more factors such as motion estimation method and number of reference frames used for the motion estimation. One embodiment of representing the temporal VDL is using the bitrate difference of a video when encoding the video at different complexity levels.

The spatial VDL is the difference of the actual bitrate of a video when it is encoded with two different CRFs e.g. CRF 26 complexity fastest and CRF 28 complexity fastest . Generally complexity of residual signal predicted by a motion estimation algorithm reflects the complexity of video frames and the transform coefficients of residual signal undergo quantization represented by CRF values. Therefore the difference of bitrates of a video encoded with different CRF values but same complexity level reduces the temporal factor influence and reflects the spatial complexity of the video. A video with a larger spatial VDL has more complex spatial content in the video.

The overall VDL temporal VDL and spatial VDL of a video can be used to guide RDC based video transcoding. For example with reference to the video description length module of the RDC based video transcoding module obtains overall VDL temporal VDL and spatial VDL of an input video from encoding the input video. The obtained VDL data of the input video is stored in a dynamic VDL database as reference VDL for the input video. For example the video description length module maintains a dynamic reference table for overall VDL where each table entry stores the identification of the input video the overall VDL of the input video the temporal resolution and spatial resolution of the input video. After transcoding the video the video description length module deletes the VDL reference of the input video. The video description length module similarly maintains a dynamic reference table for temporal VDL and spatial VDL respectively. The overall VDL obtained for one video output format of the input video can be used to guide the encoding of the input video for other video output formats. The temporal and spatial VDL obtained for one video output format of the input video can be similarly used for other video output formats of the input video.

In another embodiment the RDC based video coding system generates a static VDL reference table for overall VDL temporal VDL and spatial VDL of videos of the video corpus based on the VDL data stored in the dynamic VDL reference tables. For example the static VDL reference table for overall VDL stores the averaged overall VDL data for each individual input data for a selected temporal resolution and another static VDL reference table for overall VDL for a selected spatial resolution. Static VDL reference tables for temporal VDL and spatial VDL for a selected temporal resolution or a spatial resolution can be similarly generated. The static VDL reference tables can be updated each time a record in the dynamic VDL reference table is generated or updated.

For a given input video the video description length module computes the overall VDL temporal VDL and spatial VDL of the input video as described above and communicates with the RDC based transcoder for rate distortion complexity optimization. For example in response to the overall VDL of an input video less than the target bitrate of the input video the video description length module sets the overall VDL of the input video as the target bitrate. Setting the overall VDL as the target bitrate of the input video helps obtain a good visual quality. In response to the spatial VDL of the input video larger than the spatial VDL of a reference video the video description length module instructs the RDC based transcoder to increase complexity level of encoding regarding spatial processing e.g. changes the complexity level from e.g. medium to fast. Similarly the video description length module instructs the RDC based transcoder to adjust complexity level of encoding regarding temporal processing of the input video based on the comparison between the temporal VDL of the input video with that of a reference video.

The video description length module compares the overall VDL of the input video with the target bitrate of the input video and adjusts the target bitrate of the input video based on the comparison e.g. setting the overall VDL of the input video as the target bitrate of the input video responsive to the overall VDL smaller than the target bitrate . The video description length module compares the temporal VDL of the input video with a reference temporal VDL and adjusts the video encoding complexity temporally based on the comparison. The video description length module compares the spatial VDL of the input video with a reference spatial VDL and adjusts the video encoding complexity spatially based on the comparison. The RDC based transcoder encodes the input video with the adjusted target bitrate temporal encoding complexity and spatial encoding complexity as illustrated in . The adjusted target bitrate temporal or spatial encoding complexity indicate that different ECP values and number of encoding passes are needed to reflect the target bitrate and encoding complexity updates.

The above description is included to illustrate the operation of the preferred embodiments and is not meant to limit the scope of the invention. The scope of the invention is to be limited only by the following claims. From the above discussion many variations will be apparent to one skilled in the relevant art that would yet be encompassed by the spirit and scope of the invention.

The invention has been described in particular detail with respect to one possible embodiment. Those of skill in the art will appreciate that the invention may be practiced in other embodiments. First the particular naming of the components capitalization of terms the attributes data structures or any other programming or structural aspect is not mandatory or significant and the mechanisms that implement the invention or its features may have different names formats or protocols. Further the system may be implemented via a combination of hardware and software as described or entirely in hardware elements. Also the particular division of functionality between the various system components described herein is merely exemplary and not mandatory functions performed by a single system component may instead be performed by multiple components and functions performed by multiple components may instead performed by a single component.

Some portions of above description present the features of the invention in terms of algorithms and symbolic representations of operations on information. These algorithmic descriptions and representations are the means used by those skilled in the data processing arts to most effectively convey the substance of their work to others skilled in the art. These operations while described functionally or logically are understood to be implemented by computer programs. Furthermore it has also proven convenient at times to refer to these arrangements of operations as modules or by functional names without loss of generality.

Unless specifically stated otherwise as apparent from the above discussion it is appreciated that throughout the description discussions utilizing terms such as processing or computing or calculating or determining or displaying or the like refer to the action and processes of a computer system or similar electronic computing device that manipulates and transforms data represented as physical electronic quantities within the computer system memories or registers or other such information storage transmission or display devices.

Certain aspects of the invention include process steps and instructions described herein in the form of an algorithm. It should be noted that the process steps and instructions of the invention could be embodied in software firmware or hardware and when embodied in software could be downloaded to reside on and be operated from different platforms used by real time network operating systems.

The invention also relates to an apparatus for performing the operations herein. This apparatus may be specially constructed for the required purposes or it may comprise a general purpose computer selectively activated or reconfigured by a computer program stored on a computer readable medium that can be accessed by the computer. Such a computer program may be stored in a computer readable storage medium such as but is not limited to any type of disk including floppy disks optical disks CD ROMs magnetic optical disks read only memories ROMs random access memories RAMs EPROMs EEPROMs magnetic or optical cards application specific integrated circuits ASICs or any type of media suitable for storing electronic instructions and each coupled to a computer system bus. Furthermore the computers referred to in the specification may include a single processor or may be architectures employing multiple processor designs for increased computing capability.

The algorithms and operations presented herein are not inherently related to any particular computer or other apparatus. Various general purpose systems may also be used with programs in accordance with the teachings herein or it may prove convenient to construct more specialized apparatus to perform the method steps. The structure for a variety of these systems will be apparent to those of skill in the along with equivalent variations. In addition the invention is not described with primary to any particular programming language. It is appreciated that a variety of programming languages may be used to implement the teachings of the invention as described herein and any reference to specific languages are provided for disclosure of enablement and best mode of the invention.

The invention is well suited to a wide variety of computer network systems over numerous topologies. Within this field the configuration and management of large networks comprise storage devices and computers that are communicatively coupled to dissimilar computers and storage devices over a network such as the Internet.

Finally it should be noted that the language used in the specification has been principally selected for readability and instructional purposes and may not have been selected to delineate or circumscribe the inventive subject matter. Accordingly the disclosure of the invention is intended to be illustrative but not limiting of the scope of the invention which is set forth in the following claims.

