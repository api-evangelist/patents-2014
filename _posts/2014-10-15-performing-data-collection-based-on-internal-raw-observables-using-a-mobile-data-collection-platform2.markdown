---

title: Performing data collection based on internal raw observables using a mobile data collection platform
abstract: An image that includes a point of interest is captured using an image capturing device that is part of the mobile data collection platform. Raw observables are obtained from a GNSS chipset that is internal to the mobile data collection platform. A position fix of the mobile data collection platform is determined based on the raw observables where the position fix defines a location of an antenna. A location of an entrance pupil is calculated as an offset of the location of the antenna. Orientation information comprising a tilt angle and an azimuth angle is determined. The position fix and the orientation information are associated with a three dimensional location that the mobile data collection platform is at when the image was captured. Scale information is captured. The image, the position fix, the scale information, and the orientation information are stored in hardware memory of the mobile data collection platform.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09538336&OS=09538336&RS=09538336
owner: Trimble Inc.
number: 09538336
owner_city: Sunnyvale
owner_country: US
publication_date: 20141015
---
This application claims priority and is a continuation in part application of co pending U.S. patent application Ser. No. 14 035 884 filed on Sep. 24 2013 entitled EXTRACTING PSEUDORANGE INFORMATION USING A CELLULAR DEVICE by Rudow et al.

U.S. patent application Ser. No. 14 035 884 claimed priority to and benefit of then U.S. Provisional Patent Application No. 61 746 916 filed on Dec. 28 2012 entitled IMPROVED GPS GNSS ACCURACY FOR A CELL PHONE by Rudow et al. and assigned to the assignee of the present application the contents of U.S. Provisional Patent Application No. 61 746 916 were incorporated by reference into U.S. patent application Ser. No. 14 035 884.

Application Ser. No. 14 035 884 also claimed priority to and is a continuation in part to the co pending patent application Ser. No. 13 842 447 entitled OBTAINING PSEUDORANGE INFORMATION USING A CELLULAR DEVICE by Richard Rudow with filing date Mar. 15 2013 and assigned to the assignee of the present application the disclosure of which was incorporated by reference into application Ser. No. 14 035 884.

The Global Positioning System GPS and its extensions in the Global Navigation Satellite Systems GNSS have become thoroughly pervasive in all parts of human society worldwide. GPS and GNSS receivers in the form of chipsets have become widely incorporated into cell phones and other types of cellular devices with cellular based communications equipment.

Typically cellular devices include highly integrated GNSS chipsets that are designed to work with the E 911 service primarily and are not designed to provide anywhere near a full range of features and outputs. They do provide a position fix but are not designed to make available very many other parameters of interest. All GNSS receivers must acquire track and decode a data message that conveys information about the location of the satellites in space and time information. The principal additional parameter obtained is the pseudorange. However conventionally this set of data is not available as an output from the cellular device s GNSS chipsets for use by the cellular device itself. Conventionally in circumstances where it is available it is under access control by the vendor.

Reference will now be made in detail to various embodiments of the subject matter examples of which are illustrated in the accompanying drawings. While various embodiments are discussed herein it will be understood that they are not intended to limit to these embodiments. On the contrary the presented embodiments are intended to cover alternatives modifications and equivalents which may be included within the spirit and scope the various embodiments as defined by the appended claims. Furthermore in the following Description of Embodiments numerous specific details are set forth in order to provide a thorough understanding of embodiments of the present subject matter. However embodiments may be practiced without these specific details. In other instances well known methods procedures components and circuits have not been described in detail as not to unnecessarily obscure aspects of the described embodiments.

Unless specifically stated otherwise as apparent from the following discussions it is appreciated that throughout the description of embodiments discussions utilizing terms such as accessing calculating extracting using providing applying correcting smoothing reconstructing modeling improving adjusting filtering discarding removing processing determining selecting locating positioning increasing differentiating integrating bridging displaying performing obtaining receiving storing notifying matching creating generating communicating transmitting requesting activating deactivating initiating terminating interpolating changing replacing causing transforming data modifying data to transform the state of a computer system or the like refer to the actions and processes of a computer system data storage system storage system controller microcontroller hardware processor or similar electronic computing device or combination of such electronic computing devices. The computer system or similar electronic computing device manipulates and transforms data represented as physical electronic quantities within the computer system s device s registers and memories into other data similarly represented as physical quantities within the computer system s device s memories or registers or other such information storage transmission or display devices.

Cellular devices such as cell phones and non voice enabled cellular devices possesses pseudorange information that can be used in surveying and other positioning operations. Conventionally however the pseudorange information from cellular device chipsets are only available under a limited set of conditions usually only when performing a E 911 service call and then only for use by the Assisted GPS service located in conjunction with the E 911 service facility. Therefore according to one embodiment an embedded GNSS chipset is employed with in a cellular device which a calculates pseudorange information for use by the GNSS chipset and b permits extraction of this pseudorange information by the cellular device in which it is embedded. As will be discussed the pseudorange information from the GNSS chipset is extracted for use elsewhere in the cellular device outside of the GNSS chipset.

As depicted in the cellular device includes a GNSS chipset a GNSS receiver a processor that is part of the GNSS receiver a chipset accessor logic a pseudorange information extractor logic an improved accuracy Secure User Platform Location SUPL client a pseudorange information bridger logic a pseudorange information processing logic an operating system a location manager logic a location displayer logic hardware that is outside of the GNSS receiver . According to one embodiment the chipset accessor logic the pseudorange information extractor logic the pseudorange information processing logic and the pseudorange information bridger logic are a part of the improved accuracy SUPL client .

According to one embodiment the hardware includes a hardware processor and memory . An example of a hardware processor is a central processing unit. An example of hardware memory is computer readable storage such as but not limited to a disk a compact disk CD a digital versatile device DVD random access memory RAM or read only memory ROM . The hardware memory is physical and therefore tangible according to one embodiment. The hardware memory according to another embodiment is non transitory.

According to one embodiment the processor and the GNSS receiver are a part of the GNSS chipset . According to one embodiment the chipset accessor logic pseudorange information extractor logic the pseudorange information bridger logic the improved accuracy SUPL client the operating system and the processor are located in a portion of the cellular device that is outside of the GNSS chipset . The location manager logic can be a part of the operating system and external to the GNSS chipset . According to one embodiment the location displayer logic is a part of the location manager logic . According to one embodiment the chipset accessor logic pseudorange information extractor logic the pseudorange information processing logic pseudorange information bridger logic and improved accuracy SUPL client are application programming interfaces API function applications that reside in memory of the cellular device and are executed by a processor of the cellular device .

According to one embodiment the GNSS receiver is capable of receiving signals from GPS satellites GLONASS satellites or from a combination of satellites from different constellations. The GNSS receiver can perform GPS measurements to derive raw measurement data for a position of the cellular device . The raw measurement data can provide an instant location of the cellular device . According to one embodiment the raw measurement data is the pseudorange information that is extracted also referred to as extracted pseudorange information . Examples of the extracted pseudorange information are uncorrected pseudorange information observed pseudorange information or unsmoothed pseudorange information or a combination thereof. Conventionally the raw measurement data is only for use by the GNSS chipset and the GNSS chipset calculates pseudorange information that is only for use by the GNSS chipset . Examples of pseudorange information are uncorrected pseudorange information smoothed pseudoranges and corrected pseudoranges. Examples of corrections used to improve accuracy of a position fix include differential GNSS corrections DGPS high precision GNSS satellite orbital data GNSS satellite broadcast ephemeris data and ionospheric and tropospheric error corrections and error projections based on location.

The GNSS chipset has a processor and therefore is capable of processing information such as pseudorange information itself. However according to various embodiments information that the GNSS chipset has can be extracted from the GNSS chipset and processed outside of the GNSS chipset instead of by the GNSS chipset using its own processor in order to provide an improved accuracy position fix.

The chipset accessor logic is configured for accessing the GNSS chipset . The pseudorange information extractor logic is configured for extracting the pseudorange information from the accessed GNSS chipset . The extracted pseudorange information can be received and stored continuously. The pseudorange information bridger logic is configured for bridging the pseudorange information from the GNSS chipset to the location manager logic that resides in the operating system of the cellular device .

According to one embodiment the chipset accessor logic the pseudorange information extractor logic the pseudorange information processing logic and pseudorange information bridger logic are a part of an improved accuracy SUPL client . For example The SUPL client can interface between the GNSS chipset and the location manager logic which resides in the operating system .

The pseudorange information can be obtained from the processor of the GNSS receiver . The GNSS chipset may be designed for example by the manufacturer of the GNSS chipset to provide requested information such as pseudorange information in response to receiving the command. The pseudorange information may be extracted from the GNSS chipset using the command that the manufacturer has designed the GNSS chipset with. For example according to one embodiment the GNSS chipset is accessed using an operation that is a session started with a message that is an improved accuracy Secure User Platform Location SUPL start message or a high precision SUPL INIT message. According to one embodiment the message is a custom command that is specific to the GNSS chipset also referred to as a GNSS chipset custom command and by which the improved accuracy SUPL client can gain access to the raw measurements of the GNSS chipset . Access may be controlled by the chipset manufacturer and a suitable key made available for use in the SUPL for obtaining access to the pseudoranges. A suitable key is an example of a custom command. 

A worker thread associated with the SUPL client can monitor the raw measurements delivered by the GNSS chipset into the GNSS chipset s memory buffers cache the raw measurements and use the raw measurements to determine a position fix. The pseudorange information extractor logic and the pseudorange information processing logic can be associated with the worker thread. For example the pseudorange information extractor logic can cache the raw measurements and the pseudorange information processing logic can determine the location.

According to one embodiment a worker thread is a light weight process that executes a specific sequence of tasks in the background. The tasks can be of long term and or at times periodic in nature. The worker thread can assist in helping the main thread which may also be referred to as the main program or main task with specific functions. Worker threads can be started when these functions of the sequence of tasks are to be executed. A worker thread can remain in the active state as long as its respective functions are being executed. A worker thread may terminate itself when it completes its functions or when it reaches a point where it can no longer continue to function for example due to an irrecoverable error. A worker thread can post its status to the main thread when it ends. Examples of posted status are completion or termination. A worker thread may also post to the main thread the level of progress of its functions periodically. At a given point in time there may be many such worker threads in progress at the same time. Worker threads may maintain some sort of synchronization amongst themselves depending upon the tasks they are intended for. The main thread may terminate a worker thread for example when the functions of that worker thread are no longer needed or due to other execution changes in the system.

According to one embodiment the cellular device can improve the accuracy of the extracted pseudorange information. For example the pseudorange information processing logic can improve the accuracy of the extracted pseudorange information as will become more evident.

The output of the pseudorange information processing logic can be used for determining the location of the cellular device . For example a latitude longitude and altitude can be determined based on the output of the pseudorange information processing logic which can be displayed by the location displayer logic .

According to one embodiment the pseudorange information bridger logic communicates the output from the pseudorange information processing logic to the location manager logic in the operating system . According to one embodiment the output of the pseudorange information processing logic is a location that is defined in terms of latitude longitude and altitude. The methods are well known in the GPS arts. The pseudoranges are used to first determine a location the WGS 84 coordinate system of the Global Positioning System and then converted into latitude longitude and elevation.

The location displayer logic can display the location with respect to a digital representation of a map available for example from third parties via download to the cellular device.

Examples of satellite based augmentation system SBAS are Indian GPS aided Geo Augmented Navigation System GAGAN European Geostationary Navigation Overlay Service EGNOS Japanese Multi functional Satellite Augmentation System MSAS John Deere s StarFire WAAS and Trimble s OmniStar.

As depicted in the pseudorange information processing logic includes pseudorange correction logic pseudorange carrier phase smoothing logic position accuracy improvement determination logic B and determining position fix logic B. Examples of improving are smoothing or correcting or a combination thereof. The pseudorange correction logic includes WAAS logic A DGPS logic B Precise Point Positioning PPP logic C RTK logic D VRS Virtual Reference Station logic E and RTX logic F. The pseudorange carrier phase smoothing logic includes real carrier phase logic A and reconstructed carrier phase logic B. According to one embodiment the accessing logic B and the processing logic reside in the improved accuracy SUPL client .

Examples of pseudorange information are extracted pseudoranges corrected pseudoranges smoothed pseudoranges or a combination thereof among other things. Examples of pseudorange corrections include Wide Area Augmentation System WAAS corrections Differential Global Positioning System DGPS corrections Precise Point Positioning PPP corrections Real Time Kinematic RTK corrections and Virtual Reference Station VRS corrections. Examples of carrier phase information include real carrier phase and reconstructed carrier phase information.

The extracting logic B can extract various types of information from the GNSS chipset as discussed herein. For example the extracting logic B includes pseudorange information extracting logic WAAS extracting logic B Doppler extracting logic B and carrier phase measurement extracting logic B . According to one embodiment the extracting logic B can be used to extract these various types of information from the GNSS chipset in a similar manner that the pseudorange information extractor logic extracts pseudorange information from the GNSS chipset for example using an SUPL Client that employs a command designed or provided by the manufacturer of the GNSS chipset as described herein. More specifically the WAAS extracting logic B the Doppler extracting logic B and carrier phase measurement extracting logic B can employ commands designed or provided by the manufacturer of the GNSS chipset to extract respectively WAAS Doppler information and carrier phase measurements for real carrier phase information.

The receiving logic B receives other types of information that are not extracted from the GNSS chipset . The receiving logic B can receive the information in response to a request also commonly known as pulling or receive the information without the information being requested also commonly known as pushing . Obtaining and accessing can be used interchangeably according to various embodiments.

Table 1 depicts the types of information that are extracted from the GNSS chipset or received without extraction as discussed herein according to various embodiments.

The information depicted in the extracted column can be extracted from the GNSS chipset using the SUPL client in a manner similar to extracting pseudorange information as discussed herein. WAAS may be extracted or received for example over the Internet. When this Doppler shift information is available but real carrier phase information is not the extracted Doppler shift information can be integrated by processor for example to reconstruct carrier phase information. Techniques for reconstructing carrier phase information from Doppler shift information are well known in the art. Any one or more of the information depicted in Table 1 can be processed by the cellular device for example using the processor that is outside of the GNSS chipset .

The pseudorange carrier phase smoothing logic can smooth pseudorange information by applying carrier phase information to the pseudorange information.

The pseudorange carrier phase smoothing logic receives raw pseudorange information from the accessing logic B. The carrier phase information may be reconstructed carrier phase information or real carrier phase information.

The pseudorange correction logic can correct pseudorange information. For example the pseudorange correction logic can receive pseudorange information and apply pseudorange corrections to the pseudorange information. Examples of the pseudorange information received by the pseudorange correction logic include extracted pseudorange information DGPS corrected pseudoranges and smoothed pseudoranges that were smoothed for example using either real carrier phase information or reconstructed carrier phase information. Examples of pseudorange corrections that can be applied to the received pseudorange information are WAAS corrections DGPS corrections PPP corrections RTK corrections and VRS corrections. The PPP logic C performs Precise Point Positioning PPP processing on pseudorange information. According to one embodiment RTX is proprietary form of PPP developed by Trimble Navigation Limited. It should be appreciated that there are other forms of Precise Point Positioning which may operate using similar principles.

The pseudorange information processing logic may also include a determining position fix logic B that performs for example a least squares solution B can be performed after the extracted pseudorange information is improved by the pseudorange correction logic or the pseudorange carrier phase smoothing logic or a combination thereof and prior to transmitting the output to the pseudorange information bridger logic . According to one embodiment the determining position fix logic B resides in the processing logic . Least squares solution methods are well known in the position determination arts.

According to one embodiment extracted pseudorange information is passed from the extracting pseudorange information logic to the smoothing logic where it is smoothed at either real carrier phase logic A or reconstructed carrier phase logic B. According to one embodiment the smoothed pseudorange information is communicated from the smoothing logic to the correcting logic for further correction where one or more corrections may be performed. If a plurality of corrections is performed they can be performed in various combinations. If carrier phase smoothing is not possible the extracted pseudorange information can be communicated from extracting pseudorange information logic to correction logic . One or more of the logics A B A E F in the processing logic can communicate with any one or more of the logics A B A E F in various orders and combinations. Various embodiments are not limited to just the combinations and orders that are described herein. According to one embodiment extracted pseudorange information may not be smoothed or corrected. In this case unsmoothed uncorrected pseudorange information can be communicated from logic to logic B.

The cellular device may also include a position accuracy improvement determination logic B for determining whether to apply any improvements and if so the one or more position accuracy improvements to apply to the extracted pseudorange information. For example the cellular device may be preconfigured based on the signals that are available to the cellular device or a user of the cellular device may manually configure the cellular device . For example the cellular device can display the signals that are available to the user and the user can select which signals they desire from the displayed list of signals. The configuration information whether preconfigured or manually configured by the user can be stored for example in a look up table in the cellular device . Examples of position improvements that can be determined by the position accuracy improvement determination logic B are real carrier phase information reconstructed carrier phase information WAAS DGPS PPP RTX RTK and VRS. The position accuracy improvement determination logic B can be used to determine to reconstruct carrier phase information based on Doppler shift if real carrier phase information is not available for example. The position accuracy improvement determination logic B according to one embodiment is a part of the SUPL client .

Extracted pseudorange information without any additional improvements provides 4 5 meters of accuracy. Various combinations of position accuracy improvements can be applied to extracted pseudorange information EPI according to various embodiments where examples of position accuracy improvements include but are not limited to Wide Area Augmentation System WAAS pseudorange corrections Differential GPS DGPS pseudorange corrections Precise Point Positioning PPP processing RTX Real Time Kinematic RTK Virtual Reference Station VRS corrections real carrier phase information real CPI smoothing and reconstructed carrier phase information reconstructed CPI smoothing.

One or more of the logics B B B B B B A B Aj F B B can be executed for example by the processor of the cellular device that is located outside of the GNSS chipset .

Table 2 depicts combinations of information that result in a position fix B according to various embodiments. However various embodiments are not limited to the combinations depicted in Table 2.

According to one embodiment a first position is determined by an available means. For example the first position may be based on uncorrected unsmoothed extracted pseudorange information cellular tower triangulation WiFi triangulation or other means. A level of precision may be selected for example by a user or preconfigured into the cellular device where DGPS or one or more of SBAS WAAS RTX PPP would be used to achieve that level of precision. The decision logic H can access the level of precision and receive two or more reference station locations by sending a message to a database inquiring about nearby reference stations for DGPS. The decision logic H can determine the distance between the cellular device and the nearest reference station. If the distance is greater than some selected distance threshold the decision logic H can use PPP RTX SBAS or WAAS instead of DGPS. If the distance is less than the selected distance threshold the decision logic H can use DGPS instead of PPP RTX SBAS or WAAS. According to one embodiment a range for a distance threshold is approximately 20 to 60 miles. According to one embodiment the distance threshold is approximately 60 miles.

If the decision logic H determines to apply DGPS corrections at DGPS logic B resulting in DGPS corrected smoothed pseudoranges further corrections can be made using the orbit clock information contained in the PPP corrections. For example a position fix can be determined based on the DGPS corrected smoothed pseudoranges and the PPP corrections. The position fix can be determined external to the GNSS chipset for example at the processing logic .

The cellular device may be configured with the distance threshold for example by the manufacturer of the cellular device or by a user of the cellular device . The cellular device may be configured with the distance threshold through service that is remote with respect to the cellular device or may be configured locally. The distance threshold can be selected based on a degree of position accuracy that is desired.

As described herein various information can be extracted from the GNSS receiver such as pseudorange information Doppler Shift Information Real Carrier Phase Measurement WAAS and SBAS. Other types of processing information output by the GNSS receiver can be ignored.

A Cell device D s hardware architecture includes discreet physical layout and interconnection of multiple chipsets for processing and for special purposes such as a GNSS chipset . In addition newer architectures involve further integration of chipsets in the system on a chip SoC configuration. In this configuration the GNSS chipset can still be a complete element capable of delivering a PVT position velocity and time solution. However in an embodiment the pseudorange information carrier phase and or Doppler measurements along with WAAS corrections if available are extracted prior to further signal processing in the GNSS chipset and are processed using different algorithms and corrections data for developing an improved accuracy PVT solution. In so doing the deleterious effects of multipath and other error sources may be minimized. Further the GNSS chipset outputs are ignored and not displayed when the external processing is employed and the higher accuracy PVT data is available.

The cellular device includes a bus a satellite receiver a GNSS receiver an FM radio receiver a processor memory a cellular transceiver a display audio Wi Fi transceiver IMU image capturing device and operating system . Components and are all connected with the buss .

In a plurality of broadcast sources is used to convey data and media to a cellular device . As an example cellular device can receive broadcast signals from communication satellites e.g. two way radio satellite based cellular such as the Inmarsat or Iridium communication networks etc. global navigation satellites which provide radio navigation signals e.g. the GPS GNSS GLONASS GALILEO BeiDou Compass etc. and terrestrial radio broadcast e.g. FM radio AM radio shortwave radio etc. 

A cellular device can be configured with a satellite radio receiver coupled with a communication bus for receiving signals from communication satellites a GNSS receiver coupled with bus for receiving radio navigation signals from global navigation satellites and for deriving a position of cellular device based thereon. Cellular device further comprises an FM radio receiver coupled with bus for receiving broadcast signals from terrestrial radio broadcast . Other components of cellular device comprise a processor coupled with bus for processing information and instructions a memory coupled with bus for storing information and instructions for processor . It is noted that memory can comprise volatile memory and non volatile memory as well as removable data storage media in accordance with various embodiments. Cellular device further comprises a cellular transceiver coupled with bus for communicating via cellular network . Examples of cellular networks used by cellular device include but are not limited to GSM cellular networks GPRS cellular networks GDMA cellular networks and EDGE cellular networks. Cellular device further comprises a display coupled with bus . Examples of devices which can be used as display include but are not limited to liquid crystal displays LED based displays and the like. It is noted that display can be configured as a touch screen device e.g. a capacitive touch screen display for receiving inputs from a user as well as displaying data. Cellular device further comprises an audio output coupled with bus for conveying audio information to a user. Cellular device further comprises a Wi Fi transceiver and an inertial measurement unit IMU coupled with bus . Wi Fi transceiver may be configured to operate on any suitable wireless communication protocol including but not limited to WiFi WiMAX implementations of the IEEE 802.11 specification implementations of the IEEE 802.15.4 specification for personal area networks and a short range wireless connection operating in the Instrument Scientific and Medical ISM band of the radio frequency spectrum in the 2400 2484 MHz range e.g. implementations of the Bluetooth standard .

Improvements in GNSS GPS positioning may be obtained by using reference stations with a fixed receiver system to calculate corrections to the measured pseudoranges in a given geographical region. Since the reference station is located in a fixed environment and its location can be determined very precisely via ordinary survey methods a processor associated with the Reference Station GNSS GPS receivers can determine more precisely what the true pseudoranges should be to each satellite in view based on geometrical considerations. Knowing the orbital positions via the GPS almanac as a function of time enables this process first proposed in 1983 and widely adopted ever since. The difference between the observed pseudorange and the calculated pseudorange for a given Reference station is called the pseudorange correction. A set of corrections for all the global navigation satellites in view is created second by second and stored and made available as a service utilizing GPS GNSS reference stations and correction services . The pseudoranges at both the cellular device GPS receiver and those at the reference stations are time tagged so the corrections for each and every pseudorange measurement can be matched to the local cell phone pseudoranges. The overall service is often referred to as Differential GPS or DGPS. Without any corrections GNSS GPS receivers produce position fixes with absolute errors in position on the order of 4.5 to 5.5 m per the GPS SPS Performance Standard 4Ed. 2008. In one or more correction services convey these corrections via a cellular network or the Internet . Internet is in turn coupled with a local Wi Fi network which can convey the corrections to cellular device via Wi Fi transceiver . Alternatively cellular network can convey the corrections to cellular device via cellular transceiver . In some embodiments correction services are also coupled with a distribution service which conveys the corrections to an FM radio distributor . FM radio distributor can broadcast corrections as a terrestrial radio broadcast . It should be appreciated that an FM signal is being described as a subset of possible terrestrial radio broadcasts which may be in a variety of bands and modulated in a variety of manners. In some embodiments cellular device includes one or more integral terrestrial radio antennas associated with integrated terrestrial receivers FM radio receiver is one example of such a terrestrial receiver which would employ an integrated antenna designed to operate in the correct frequency band for receiving a terrestrial radio broadcast . In this manner in some embodiments cellular device can receive the corrections via FM radio receiver or other applicable type of integrated terrestrial radio receiver . In some embodiments correction services are also coupled with a distribution service which conveys the corrections to a satellite radio distributor . Satellite radio distributor can broadcast corrections as a broadcast from one or more communications satellites . In some embodiments cellular device includes one or more integral satellite radio antennas associated with integrated satellite radio receivers . Satellite radio receiver is one example of such a satellite receiver which would employ an integrated antenna designed to operate in the correct frequency band for receiving a corrections or other information broadcast from communication satellites . In this manner in some embodiments cellular device can receive the corrections via satellite radio receiver .

Examples of a correction source that provides pseudorange corrections are at least correction service FM radio distribution or satellite radio distributor or a combination thereof. According to one embodiment a correction source is located outside of the cellular device .

Examples of image capturing device are a camera a video camera a digital camera a digital video camera a digital camcorder a stereo digital camera a stereo video camera a motion picture camera and a television camera. The image capturing device may use a lens or be a pinhole type device.

The blocks that represent features in can be arranged differently than as illustrated and can implement additional or fewer features than what are described herein. Further the features represented by the blocks in can be combined in various ways. A cellular device can be implemented using software hardware hardware and software hardware and firmware or a combination thereof. Further unless specified otherwise various embodiments that are described as being a part of the cellular device whether depicted as a part of the cellular device or not can be implemented using software hardware hardware and software hardware and firmware software and firmware or a combination thereof. Various blocks in refer to features that are logic such as but not limited to B A B A G B which can be implemented using software hardware hardware and software hardware and firmware software and firmware or a combination thereof.

The cellular device according to one embodiment includes hardware such as the processor memory and the GNSS chipset . An example of hardware memory is a physically tangible computer readable storage medium such as but not limited to a disk a compact disk CD a digital versatile device DVD random access memory RAM or read only memory ROM for storing instructions. An example of a hardware processor for executing instructions is a central processing unit. Examples of instructions are computer readable instructions for implementing at least the SUPL Client that can be stored on a hardware memory and that can be executed for example by the hardware processor . The SUPL client may be implemented as computer readable instructions firmware or hardware such as circuitry or a combination thereof.

A GNSS receiver also referred to as a receiver according to various embodiments makes a basic measurement that is the apparent transit time of the signal from a satellite to the receiver which can be defined as the difference between signal reception time as determined by the receiver s clock and the transmission time at the satellite as marked in the signal. This basic measurement can be measured as the amount of time shift required to align the C A code replica generated at the receiver with the signal received from the satellite. This measurement may be biased due to a lack of synchronization between the satellite and receiver clock because each keeps time independently. Each satellite generates a respective signal in accordance using a clock on board. The receiver generates a replica of each signal using its own clock. The corresponding biased range also known as a pseudorange can be defined as the transit time so measured multiplied by the speed of light in a vacuum.

There are three time scales according to one embodiment. Two of the time scales are the times kept by the satellite and receiver clocks. A third time scale is a common time reference GPS Time GPST also known as a composite time scale that can be derived from the times kept by clocks at GPS monitor stations and aboard the satellites.

Let be the transit time associated with a specific code transition of the signal from a satellite received at time t per GPST. The measured apparent range r called pseudorange can be determined from the apparent transmit time using equation 1 as follows measured pseudorange at arrival time at emission time at . Eq. 1 

Both t and are unknown and can be estimated. In this discussion of pseudoranges measurements from a GPS satellite are dealt with in a generic way to make the notation simple making no reference to the satellite ID or carrier frequency L1 or L2 .

Equations 2 and 3 depict how to relate the time scales of the receiver and the satellite clocks with GPST arrival time at receiver clock at Eq. 2 arrival time at satellite clock error at Eq. 3 

where receiver clock error represents the receiver s clock bias and satellite clock error represents the bias in the satellite s clock and both the receiver clock and the satellite clock are measured relative to GPST as shown in . Receiver clock error and satellite clock error represent the amounts by which the satellite and receiver clocks are advanced in relation to GPST. The satellite clock error is estimated by the Control Segment and specified in terms of the coefficients of a quadratic polynomial in time. The values of these coefficients can be broadcast in the navigation message.

Accounting for the clock biases the measured pseudorange Eq. 1 can be written as indicated in equation 4 receiver clock error at satellite clock error at miscellaneous errors at receiver clock errors at satellite clock error at miscellaneous errors at Eq. 4 where miscellaneous errors represent unmodeled effects modeling error and measurement error. The transmit time multiplied by the speed of light in a vacuum can be modeled as satellite position at t . Ionosphere error and troposphere error reflect the delays associated with the transmission of the signal respectively through the ionosphere and the troposphere. Both ionosphere error and troposphere error are positive.

For simplicity explicitly reference to the measurement epoch t has been dropped and the model has been rewritten for the measured pseudorange as indicated in equation 5. receiver clock error satellite clock error ionosphere error troposphere error miscellaneous errors Eq. 5 where PR is the measured pseudorange r is the true range from the receiver to the satellite receiver clock error is the difference between the receiver clock and the GPSTIME satellite clock error is the difference between the satellite clock and GPSTIME GPSTIME is ultimately determined at the receiver as part of the least squared solution determined by the least squares solution B so that all clock errors can be resolved to some level of accuracy as part of the position determination process and miscellaneous errors include receiver noise multipath and the like.

At least one source of error is associated with satellite positions in space. The navigation message in the GPS signal contains Keplerian parameters which define orbital mechanics mathematics and thus the positions of the satellites as a function of time. One component of WAAS and RTX contains adjustments to these parameters which form part of the constants used in solving for the position fix at a given time. Taking account of the corrections is well known in the GPS position determining arts.

Ideally the true range r to the satellite is measured. Instead what is available is PR the pseudorange which is a biased and noisy measurement of r. The accuracy of an estimated position velocity or time which is obtained from these measurements depends upon the ability to compensate for or eliminate the biases and errors.

The range to a satellite is approximately 20 000 kilometers km when the satellite is overhead and approximately 26 000 km when the satellite is rising or setting. The signal transit time varies between about 70 millisecond ms and 90 ms. The C A code repeats each millisecond and the code correlation process essentially provides a measurement of pseudo transmit time modulo 1 ms. The measurement can be ambiguous in whole milliseconds. This ambiguity however is easily resolved if the user has a rough idea of his location within hundreds of kilometers. The week long P Y code provides unambiguous pseudoranges.

The receiver clocks are generally basic quartz crystal oscillators and tend to drift. The receiver manufacturers attempt to limit the deviation of the receiver clock from GPST and schedule the typical once per second measurements at epochs that are within plus or minus 1 millisecond ms of the GPST seconds. One approach to maintaining the receiver clock within a certain range of GPST is to steer the receiver clock continuously. The steering can be implemented with software. The second approach is to let the clock drift until it reaches a certain threshold typically 1 ms and then reset it with a jump to return the bias to zero.

An example of pseudorange measurements with a receiver using the second approach shall now be described in more detail. Assume that there are pseudorange measurements from three satellites which rose about the same time but were in different orbits. Assume that one comes overhead and stays in view for almost seven hours. Assume that the other two stay lower in the sky and could be seen for shorter periods. There are discontinuities common to all three sets of measurements due to the resetting of the receiver clock. A determination can be made as to whether the receiver clock is running fast or slow and its frequency offset from the nominal value of 10.23 megahertz MHz can be estimated.

For more information on pseudorange information refer to Global Positioning Systems by Pratap Misra and Per Eng Ganga Jamuna Press 2001 ISBN 0 9709544 0 9.

The pseudorange information processing logic can include various types of logic for improving the position accuracy of the extracted pseudorange information as described herein. Table 2 as described herein depicts various combinations of position accuracy improvements for improving extracted pseudorange information according to various embodiments. Table 3 also depicts various combinations of position accuracy improvements for improving extracted pseudorange information according to various embodiments.

Table 3 includes columns for combination identifier operation description and accuracy. The combination identifier column indicates an identifier for each combination of improvements. The operation column specifies operations of various flowcharts in for the corresponding combination. The description column specifies various combinations of position accuracy improvements that can be applied to extracted pseudorange information EPI according to various embodiments where examples of position accuracy improvements include but are not limited to Wide Area Augmentation System WAAS pseudorange corrections real carrier phase smoothing real CPI information reconstructed carrier phase smoothing information reconstructed CPI Differential GPS DGPS pseudorange corrections and Precise Point Positioning PPP processing. The accuracy column specifies levels of accuracy provided by the corresponding combination.

Combination 1 is extracted pseudorange information without any additional improvements which provides 4 5 meters of accuracy. Combination 1 is described in Table 3 to provide a comparison with the other combinations 2 13.

According to one embodiment the SUPL client can also include a position accuracy improvement determination logic B for determining the one or more position accuracy improvements to apply to the extracted pseudorange information based on one or more factors such as cost quality of service and one or more characteristics of the cellular device. For example different costs are associated with different position accuracy improvements. More specifically extracted pseudorange information WAAS and Doppler information are typically free. There is a low cost typically associated with DGPS and real carrier phase information. There is typically a higher cost associated with PPP. Therefore referring to Table 3 according to one embodiment combinations 1 2 and 3 are typically free combinations 4 7 typically are low cost and combinations 8 12 are typically higher cost.

Various cellular devices have different characteristics that make them capable of providing different types of position accuracy improvements. For example one type of cellular device may be capable of providing WAAS but not be capable of providing Doppler information. In another example some types of cellular devices may be capable of providing DGPS but not capable of providing PPP. In yet another example different activities may require different levels of improvement. For example some activities and or people may be satisfied with 4 5 meters others may be satisfied with 1.7 meters. Yet others may be satisfied with less than 1 meter and still others may only be satisfied with 2 centimeters. Therefore different users may request different levels of accuracy.

Table 4 depicts sources of the various position accuracy improvements according to various embodiments.

The first column of Table 4 provides the name of the position accuracy improvement. The second column of Table 4 specifies the source for the corresponding position accuracy improvement.

According to various embodiments a cellular device can initially provide a position that is within 4 5 meters using for example unimproved extracted pseudorange information and the position can continually be improved using various position accuracy improvements as described herein as long as the antennae of the cellular device is clear of obstructions to receive various position accuracy improvements.

A Global Navigation Satellite System GNSS is a navigation system that makes use of a constellation of satellites orbiting the earth to provide signals to a receiver such as GNSS receiver which estimates its position relative to the earth from those signals. Examples of such satellite systems are the NAVSTAR Global Positioning System GPS deployed and maintained by the United States the GLObal NAvigation Satellite System GLONASS deployed by the Soviet Union and maintained by the Russian Federation and the GALILEO system currently being deployed by the European Union EU .

Each GPS satellite transmits continuously using two radio frequencies in the L band referred to as L1 and L2 at respective frequencies of 1575.41 MHz and 1227.60 MHz. Two signals are transmitted on L1 one for civil users and the other for users authorized by the Unites States Department of Defense DoD . One signal is transmitted on L2 intended only for DoD authorized users. Each GPS signal has a carrier at the L1 and L2 frequencies a pseudo random number PRN code and satellite navigation data.

Two different PRN codes are transmitted by each satellite A coarse acquisition C A code and a precision P Y code which is encrypted for use by authorized users. A receiver such as GNSS receiver designed for precision positioning contains multiple channels each of which can track the signals on both L1 and L2 frequencies from a GPS satellite in view above the horizon at the receiver antenna and from these computes the observables for that satellite comprising the L1 pseudorange possibly the L2 pseudorange and the coherent L1 and L2 carrier phases. Coherent phase tracking implies that the carrier phases from two channels assigned to the same satellite and frequency will differ only by an integer number of cycles.

Each GLONASS satellite transmits continuously using two radio frequency bands in the L band also referred to as L1 and L2. Each satellite transmits on one of multiple frequencies within the L1 and L2 bands respectively centered at frequencies of 1602.0 MHz and 1246.0 MHz. The code and carrier signal structure is similar to that of NAVSTAR. A GNSS receiver designed for precision positioning contains multiple channels each of which can track the signals from both GPS and GLONASS satellites on their respective L1 and L2 frequencies and generate pseudorange and carrier phase observables from these. Future generations of GNSS receivers will include the ability to track signals from all deployed GNSSs.

Differential GPS DGPS utilizes a reference station which is located at a surveyed position to gather data and deduce corrections for the various error contributions which reduce the precision of determining a position fix. For example as the GPS signals pass through the ionosphere and troposphere propagation delays may occur. Other factors which may reduce the precision of determining a position fix may include satellite clock errors GPS receiver clock errors and satellite position errors ephemerides . The reference station receives essentially the same GPS signals as cellular devices which may also be operating in the area. However instead of using the timing signals from the GPS satellites to calculate its position it uses its known position to calculate timing. In other words the reference station determines what the timing signals from the GPS satellites should be in order to calculate the position at which the reference station is known to be. The difference in timing can be expressed in terms of pseudorange lengths in meters. The difference between the received GPS signals and what they optimally should be is used as an error correction factor for other GPS receivers in the area. Typically the reference station broadcasts the error correction to for example a cellular device which uses this data to determine its position more precisely. Alternatively the error corrections may be stored for later retrieval and correction via post processing techniques.

DGPS corrections cover errors caused by satellite clocks ephemeris and the atmosphere in the form of ionosphere errors and troposphere errors. The nearer a DGPS reference station is to the receiver the more useful the DGPS corrections from that reference station will be.

The system is called DGPS when GPS is the only constellation used for Differential GNSS. DGPS provides an accuracy on the order of 1 meter or 1 sigma for users in a range that is approximately in a few tens of kilometers kms from the reference station and growing at the rate of 1 m per 150 km of separation. DGPS is one type of Differential GNSS DGNSS technique. There are other types of DGNSS techniques such as RTK and Wide Area RTK WARTK that can be used by high precision applications for navigation or surveying that can be based on using carrier phase measurements. It should be appreciated that other DGNSS which may utilize signals from other constellations besides the GPS constellation or from combinations of constellations. Embodiments described herein may be employed with other DGNSS techniques besides DGPS.

A variety of different techniques may be used to deliver differential corrections that are used for DGNSS techniques. In one example DGNSS corrections are broadcast over an FM subcarrier. U.S. Pat. No. 5 477 228 by Tiwari et al. describes a system for delivering differential corrections via FM subcarrier broadcast method.

An improvement to DGPS methods is referred to as Real time Kinematic RTK . As in the DGPS method the RTK method utilizes a reference station located at determined or surveyed point. The reference station collects data from the same set of satellites in view by the cellular device in the area. Measurements of GPS signal errors taken at the reference station e.g. dual frequency code and carrier phase signal errors and broadcast to one or more cellular devices working in the area. The one or more cellular devices combine the reference station data with locally collected position measurements to estimate local carrier phase ambiguities thus allowing a more precise determination of the cellular device s position. The RTK method is different from DGPS methods in that the vector from a reference station to a cellular device is determined e.g. using the double differences method . In DGPS methods reference stations are used to calculate the changes needed in each pseudorange for a given satellite in view of the reference station and the cellular device to correct for the various error contributions. Thus DGPS systems broadcast pseudorange correction numbers second by second for each satellite in view or store the data for later retrieval as described above.

RTK allows surveyors to determine a true surveyed data point in real time while taking the data. However the range of useful corrections with a single reference station is typically limited to about 70 km because the variable in propagation delay increase in apparent path length from satellite to a receiver of the cellular device or pseudo range changes significantly for separation distances beyond 70 km. This is because the ionosphere is typically not homogeneous in its density of electrons and because the electron density may change based on for example the sun s position and therefore time of day.

Thus for surveying or other positioning systems which must work over larger regions the surveyor must either place additional base stations in the regions of interest or move his base stations from place to place. This range limitation has led to the development of more complex enhancements that have superseded the normal RTK operations described above and in some cases eliminated the need for a base station GPS receiver altogether. This enhancement is referred to as the Network RTK or Virtual Reference Station VRS system and method.

Network RTK typically uses three or more GPS reference stations to collect GPS data and extract information about the atmospheric and satellite ephemeris errors affecting signals within the network coverage region. Data from all the various reference stations is transmitted to a central processing facility or control center for Network RTK. Suitable software at the control center processes the reference station data to infer how atmospheric and or satellite ephemeris errors vary over the region covered by the network.

The control center computer processor then applies a process which interpolates the atmospheric and or satellite ephemeris errors at any given point within the network coverage area and generates a pseudo range correction comprising the actual pseudo ranges that can be used to create a virtual reference station. The control center then performs a series of calculations and creates a set of correction models that provide the cellular device with the means to estimate the ionospheric path delay from each satellite in view from the cellular device and to take account other error contributions for those same satellites at the current instant in time for the cellular device s location.

The cellular device is configured to couple a data capable cellular telephone to its internal signal processing system. The user operating the cellular device determines that he needs to activate the VRS process and initiates a call to the control center to make a connection with the processing computer.

The cellular device sends its approximate position based on raw GPS data from the satellites in view without any corrections to the control center. Typically this approximate position is accurate to approximately 4 7 meters. The user then requests a set of modeled observables for the specific location of the cellular device . The control center performs a series of calculations and creates a set of correction models that provide the cellular device with the means to estimate the ionospheric path delay from each satellite in view from the cellular device and to take into account other error contributions for those same satellites at the current instant in time for the cellular device s location. In other words the corrections for a specific cellular device at a specific location are determined on command by the central processor at the control center and a corrected data stream is sent from the control center to the cellular device . Alternatively the control center may instead send atmospheric and ephemeris corrections to the cellular device which then uses that information to determine its position more precisely.

These corrections are now sufficiently precise that the high performance position accuracy standard of 2 3 cm may be determined in real time for any arbitrary cellular device s position. Thus a GPS enabled cellular device s raw GPS data fix can be corrected to a degree that makes it behave as if it were a surveyed reference location hence the terminology virtual reference station. 

An example of a network RTK system in accordance with embodiments of the present invention is described in U.S. Pat. No. 5 899 957 entitled Carrier Phase Differential GPS Corrections Network by Peter Loomis assigned to the assignee of the present invention.

The Virtual Reference Station method extends the allowable distance from any reference station to the cellular devices . Reference stations may now be located hundreds of miles apart and corrections can be generated for any point within an area surrounded by reference stations. However there are many construction projects where cellular coverage is not available over the entire physical area under construction and survey.

To achieve very accurate positioning to several centimeters or less of a terrestrial mobile platform of a cellular device relative or differential positioning methods are commonly employed. These methods use a GNSS reference receiver located at a known position in addition to the data from a GNSS receiver on the mobile platform to compute the estimated position of the mobile platform relative to the reference receiver.

The most accurate known method uses relative GNSS carrier phase interferometry between the GNSS cellular device s receiver and GNSS reference receiver antennas plus resolution of integer wavelength ambiguities in the differential phases to achieve centimeter level positioning accuracies. These differential GNSS methods are predicated on the near exact correlation of several common errors in the cellular device and reference observables. They include ionosphere and troposphere signal delay errors satellite orbit and clock errors and receiver clock errors.

When the baseline length between the mobile platform and the reference receiver does not exceed 10 kilometers which is normally considered a short baseline condition the ionosphere and troposphere signal delay errors in the observables from the cellular device and reference receivers are almost exactly the same. These atmospheric delay errors therefore cancel in the cellular device s reference differential GNSS observables and the carrier phase ambiguity resolution process required for achieving centimeter level relative positioning accuracy is not perturbed by them. If the baseline length increases beyond 10 kilometers considered a long baseline condition these errors at the cellular device and reference receiver antennas become increasingly different so that their presence in the cellular device s reference differential GNSS observables and their influence on the ambiguity resolution process increases. Ambiguity resolution on single cellular device s reference receiver baselines beyond 10 kilometers becomes increasingly unreliable. This attribute limits the precise resolution of a mobile platform with respect to a single reference receiver and essentially makes it unusable on a mobile mapping platform that covers large distances as part of its mission such as an aircraft.

A network GNSS method computes the estimated position of a cellular device s receiver using reference observables from three or more reference receivers that approximately surround the cellular device s receiver trajectory. This implies that the cellular device s receiver trajectory is mostly contained by a closed polygon whose vertices are the reference receiver antennas. The cellular device s receiver can move a few kilometers outside this polygon without significant loss of positioning accuracy. A network GNSS algorithm calibrates the ionosphere and troposphere signal delays at each reference receiver position and then interpolates and possibly extrapolates these to the cellular device s position to achieve better signal delay cancellation on long baselines than could be had with a single reference receiver. Various methods of signal processing can be used however they all yield essentially the same performance improvement on long baselines.

Kinematic ambiguity resolution KAR satellite navigation is a technique used in numerous applications requiring high position accuracy. KAR is based on the use of carrier phase measurements of satellite positioning system signals where a single reference station provides the real time corrections with high accuracy. KAR combines the L1 and L2 carrier phases from the cellular device and reference receivers so as to establish a relative phase interferometry position of the cellular device s antenna with respect to the reference antenna. A coherent L1 or L2 carrier phase observable can be represented as a precise pseudorange scaled by the carrier wavelength and biased by an integer number of unknown cycles known as cycle ambiguities. Differential combinations of carrier phases from the cellular device and reference receivers result in the cancellation of all common mode range errors except the integer ambiguities. An ambiguity resolution algorithm uses redundant carrier phase observables from the cellular device and reference receivers and the known reference antenna position to estimate and thereby resolve these ambiguities.

Once the integer cycle ambiguities are known the cellular device s receiver can compute its antenna position with accuracies generally on the order of a few centimeters provided that the cellular device and reference antennas are not separated by more than 10 kilometers. This method of precise positioning performed in real time is commonly referred to as real time kinematic RTK positioning. The separation between a cellular device and reference antennas shall be referred to as cellular device reference separation. 

The reason for the cellular device reference separation constraint is that KAR positioning relies on near exact correlation of atmospheric signal delay errors between the cellular device and reference receiver observables so that they cancel in the cellular device s reference observables combinations for example differences between cellular device and reference observables per satellite . The largest error in carrier phase positioning solutions is introduced by the ionosphere a layer of charged gases surrounding the earth. When the signals radiated from the satellites penetrate the ionosphere on their way to the ground based receivers they experience delays in their signal travel times and shifts in their carrier phases. A second significant source of error is the troposphere delay. When the signals radiated from the satellites penetrate the troposphere on their way to the ground based receivers they experience delays in their signal travel times that are dependent on the temperature pressure and humidity of the atmosphere along the signal paths. Fast and reliable positioning requires good models of the spatio temporal correlations of the ionosphere and troposphere to correct for these non geometric influences.

When the cellular device reference separation exceeds 10 kilometers as maybe the case when the cellular device has a GNSS receiver that is a LEO satellite receiver the atmospheric delay errors become de correlated and do not cancel exactly. The residual errors can now interfere with the ambiguity resolution process and thereby make correct ambiguity resolution and precise positioning less reliable.

The cellular device s reference separation constraint has made KAR positioning with a single reference receiver unsuitable for certain mobile positioning applications where the mission of the mobile platform of the cellular device will typically exceed this constraint. One solution is to set up multiple reference receivers along the mobile platform s path so that at least one reference receiver falls within a 10 km radius of the mobile platform s estimated position.

Network GNSS methods using multiple reference stations of known location allow correction terms to be extracted from the signal measurements. Those corrections can be interpolated to all locations within the network. Network KAR is a technique that can achieve centimeter level positioning accuracy on large project areas using a network of reference GNSS receivers. This technique operated in real time is commonly referred to as network RTK. The network KAR algorithm combines the pseudorange and carrier phase observables from the reference receivers as well as their known positions to compute calibrated spatial and temporal models of the ionosphere and troposphere signal delays over the project area. These calibrated models provide corrections to the observables from the cellular device s receiver so that the cellular device s receiver can perform reliable ambiguity resolution on combinations of carrier phase observables from the cellular device and some or all reference receivers. The number of reference receivers required to instrument a large project area is significantly less than what would be required to compute reliable single baseline KAR solutions at any point in the project area. See for example U.S. Pat. No. 5 477 458 Network for Carrier Phase Differential GPS Corrections and U.S. Pat. No. 5 899 957 Carrier Phase Differential GPS Corrections Network . See also Liwen Dai et al. Comparison of Interpolation Algorithms in Network Based GPS Techniques Journal of the Institute of Navigation Vol. 50 No. 4 Winter 1003 1004 for a comparison of different network GNSS implementations and comparisons of their respective performances.

A virtual reference station VRS network method is a particular implementation of a network GNSS method that is characterized by the method by which it computes corrective data for the purpose of cellular device s position accuracy improvement. A VRS network method comprises a VRS corrections generator and a single baseline differential GNSS position generator such as a GNSS receiver with differential GNSS capability. The VRS corrections generator has as input data the pseudorange and carrier phase observables on two or more frequencies from N reference receivers each tracking signals from M GNSS satellites. The VRS corrections generator outputs a single set of M pseudorange and carrier phase observables that appear to originate from a virtual reference receiver at a specified position hereafter called the VRS position within the boundaries of the network defined by a polygon or projected polygon having all or some of the N reference receivers as vertices. The dominant observables errors comprising a receiver clock error satellite clock errors ionosphere and troposphere signal delay errors and noise all appear to be consistent with the VRS position. The single baseline differential GNSS position generator implements a single baseline differential GNSS position algorithm of which numerous examples have been described in the literature. B. Hofmann Wellenhof et al. Global Positioning System Theory and Practice 5th Edition 1001 hereinafter Hofmann Wellenhof 1001 gives comprehensive descriptions of different methods of differential GNSS position computation ranging in accuracies from one meter to a few centimeters. The single baseline differential GNSS position algorithm typically computes differences between the cellular device and reference receiver observables to cancel atmospheric delay errors and other common mode errors such as orbital and satellite clock errors. The VRS position is usually specified to be close to or the same as the roving receiver s estimated position so that the actual atmospheric errors in the cellular device receiver s observables approximately cancel the estimated atmospheric errors in the VRS observables in the cellular device s reference observables differences.

The VRS corrections generator computes the synthetic observables at each sampling epoch typically once per second from the geometric ranges between the VRS position and the M satellite positions as computed using well known algorithms such as those given in IS GPS 200G interface specification tilted Naystar GPS Space Segment Navigation User Interfaces and dated 5 Sep. 2012. It estimates the typical pseudorange and phase errors comprising receiver clock error satellite clock errors ionospheric and tropospheric signal delay errors and noise applicable at the VRS position from the N sets of M observables generated by the reference receivers and adds these to the synthetic observables.

A network RTK system operated in real time requires each GNSS reference receiver to transmit its observables to a network server computer that computes and transmits the corrections and other relevant data to the GNSS cellular device s receiver . The GNSS reference receivers plus hardware to assemble and broadcast observables are typically designed for this purpose and are installed specifically for the purpose of implementing the network. Consequently those receivers are called dedicated network reference receivers.

An example of a VRS network is designed and manufactured by Trimble Navigation Limited of Sunnyvale Calif. The VRS network as delivered by Trimble includes a number of dedicated reference stations a VRS server multiple server reference receiver bi directional communication channels and multiple server cellular device bi directional data communication channels. Each server cellular device bi directional communication channel serves one cellular device . The reference stations provide their observables to the VRS server via the server reference receiver bi directional communication channels. These channels can be implemented by a public network such as the Internet. The bi directional server cellular device communication channels can be radio modems or cellular telephone links depending on the location of the server with respect to the cellular device .

The VRS server combines the observables from the dedicated reference receivers to compute a set of synthetic observables at the VRS position and broadcasts these plus the VRS position in a standard differential GNSS DGNSS message format such as one of the RTCM Radio Technical Commission for Maritime Services formats an RTCA Radio Technical Commission for Aeronautics format or a proprietary format such as the CMR Compact Measurement Report or CMR format which are messaging system communication formats employed by Trimble Navigation Limited. Descriptions for numerous of such formats are widely available. For example RTCM Standard 10403.1 for DGNSS Services Version 3 published Oct. 26 2006 and Amendment to the same published Aug. 31 2007 is available from the Radio Technical Commission for Maritime Services 1800 N. Kent St. Suite 1060 Arlington Va. 22209. The synthetic observables are the observables that a reference receiver located at the VRS position would measure. The VRS position is selected to be close to the cellular device s estimated position so that the cellular device s VRS separation is less than a maximum separation considered acceptable for the application. Consequently the cellular device receiver must periodically transmit its approximate position to the VRS server. The main reason for this particular implementation of a real time network RTK system is compatibility with RTK survey GNSS receivers that are designed to operate with a single reference receiver.

Descriptions of the VRS technique are provided in U.S. Pat. No. 6 324 473 of hereinafter Eschenbach see particularly col. 7 line 21 et seq. and U.S. Patent application publication no. 2005 0064878 of B. O Meagher hereinafter O Meagher which are assigned to Trimble Navigation Limited and in H. Landau et al. Virtual Reference Stations versus Broadcast Solutions in Network RTK GNSS 2003 Proceedings Graz Austria 2003 .

The term VRS as used henceforth in this document is used as shorthand to refer to any system or technique which has the characteristics and functionality of VRS described or referenced herein and is not necessarily limited to a system from Trimble Navigation Ltd. Hence the term VRS is used in this document merely to facilitate description and is used without derogation to any trademark rights of Trimble Navigation Ltd. or any subsidiary thereof or other related entity.

Descriptions of a Precise Point Positioning PPP technique are provided in U.S. Patent application publication 20110187590 of Leandro which is assigned to Trimble Navigation Limited. Trimble Navigation Limited has commercialized a version of PPP corrections which it calls RTX . PPP corrections can be any collection of data that provides corrections from a satellite in space clock errors ionosphere or troposphere or a combination thereof. According to one embodiment PPP corrections can be used in instead of WAAS or RTX .

The term Precise Point Positioning PPP as used henceforth in this document is used as shorthand to refer to any system or technique which has the characteristics and functionality of PPP described or referenced herein and is not necessarily limited to a system from Trimble Navigation Ltd. Hence the term PPP is used in this document merely to facilitate description and is used without derogation to any trademark rights of Trimble Navigation Ltd. or any subsidiary thereof or other related entity. Techniques for generating PPP corrections are well known in the art. In general a PPP system utilizes a network which may be global of GNSS reference receivers tracking navigation satellites such as GPS and GLONASS satellites and feeding data back to a centralized location for processing. At the centralized location the precise orbits and precise clocks of all of the tracked navigation satellites are generated and updated in real time. A correction stream is produced by the central location the correction stream contains the orbit and clock information. This correction stream is broadcast or otherwise provided to GNSS receivers such as a GNSS receiver in the field conventionally by satellite service or cellular link Corrections processors in the GNSS receivers utilize the corrections to produce centimeter level positions after a short convergence time e.g. less than 30 minutes . A main difference between PPP and VRS is that PPP networks of reference receivers are typically global while VRS networks may be regional or localized with shorter spacing between the reference stations in a VRS network.

Wide Area Augmentation System WAAS corrections are corrections of satellite position and their behavior. WAAS was developed by the Federal Aviation Administration FAA . WAAS includes a network of reference stations that are on the ground located in North America and Hawaii. The reference stations transmit their respective measurements to master stations which queue their respective received measurements. The master stations transmit WAAS corrections to geostationary WAAS satellites which in turn broadcast the WAAS corrections back to earth where cellular devices that include WAAS enabled GPS receivers can receive the broadcasted WAAS corrections. According to one embodiment the GNSS receiver is a WAAS enabled GPS receiver. The WAAS corrections can be used to improve the accuracy of the respective cellular devices positions for example by applying the WAAS corrections to extracted pseudoranges. WAAS operation and implementation is well known in the art.

According to one embodiment a GNSS chipset provides real carrier phase information also referred to as actual carrier phase information . The cellular device can extract real carrier phase information from the GNSS chipset in a manner similar to extracting pseudorange information from the GNSS chipset where the extracted carrier phase information is for use elsewhere in the cellular device outside of the GNSS chipset as described herein for example with flowchart of .

The filtering processing described herein lies in the family of errors in pseudorange processing that affect code and carrier measurements in the same way. In various embodiments the code phase pseudorange measurements are disciplined by subtracting out a more constant equivalent pseudorange like distance measurement derived from the carrier phase. Next a filtering on the net subtracted signal is performed which allows various embodiments to eliminate multipath induced errors in the raw and corrected pseudorange data. This method does not deal with ionospheric effects according to one embodiment.

In operation A of extracted pseudorange information and carrier phases for a first epoch are collected. In one embodiment these extracted pseudorange information and carrier phases are received at carrier phase smoothing logic from the GNSS receiver .

In operation A of pseudorange corrections are collected and applied to the first set of extracted pseudoranges collected in operation A. In one embodiment these corrections themselves may be smoothed at the reference receiver e.g. at GPS GNSS reference stations so that the delivered pseudorange corrections themselves are less noisy. Smoothing the pseudorange corrections derived at the GPS GNSS reference stations using the same carrier phase method of flowchart A can vastly improve the quality of the delivered pseudorange corrections delivered to cellular device for use by a position determination processor e.g. GNSS receiver or pseudorange information processing logic . Such corrected pseudoranges that are also smoothed may be used by the cellular device and fetched if available.

In operation A of delta carrier phase measurements for the same epoch are created using real carrier phase information. In accordance with various embodiments this replicates creating a second distance measurement similar to the reconstructed carrier phase information based on integrated Doppler Shift.

In operation A of the delta carrier phase measurements are subtracted from the corrected extracted pseudoranges. In accordance with various embodiments this provides a fairly constant signal for that epoch and is equivalent to the corrected extracted pseudorange at the start of the integration interval. In accordance with various embodiments this is referred to as a disciplining step that smoothes out the corrected extracted pseudorange signal and therefore reduces the instant errors in the later computed position fixes.

In operation A of the signal is filtered after the subtraction of operation A to reduce noise. In accordance with one embodiment this is performed by averaging the carrier phase yardsticks over a series of epochs.

In operation A of the delta carrier phase measurements from the real carrier phase processing operation is added back into the filtered signal of operation A.

In operation A of the new filtered and corrected extracted pseudorange signal is processed for example at the pseudorange information processing logic to derive a position fix B.

Carrier Phase Information can be reconstructed referred to herein as reconstructed carrier phase based on Doppler Shift. Doppler Shift is the change in frequency of a periodic event also known as a wave perceived by an observer that is moving relative to a source of the periodic event. For example Doppler shift refers to the change in apparent received satellite signal frequency caused by the relative motion of the satellites as they either approach the cellular device or recede from it. Thus any measurement of Doppler frequency change is similar to differentiating carrier phase. It is therefore possible to reconstruct the carrier phase by integrating the Doppler shift data. In an embodiment the GNSS chipset of GNSS receiver may provide Doppler information it determines through other means. This Doppler frequency shift information or Doppler may be collected at each GPS timing epoch e.g. one second and integrated over a sequence of the one second epochs to produce a model of carrier phase. This Doppler derived carrier phase model may be substituted for the real carrier phase data and used in the same manner as shown in the flow chart for carrier phase smoothing of . Doppler Shift signal processing is well known in the art.

In operation B of Doppler information from a GNSS receiver of a GNSS chipset is received by pseudorange carrier phase smoothing logic .

In operation B of a series of Doppler information is integrated. As described above Doppler frequency shift information may be collected at each GPS timing epoch e.g. one second and stored for use in producing a model of carrier phase.

In operation B of a model of carrier phase is created based on integrated Doppler information. As discussed above with reference to operation B a series of Doppler information for a plurality of timing epochs is integrated. In one embodiment this Doppler information is integrated over a sequence of the one second epochs to produce a model of carrier phase. The sequence may include 10 100 epochs or seconds. The model of carrier phase smoothing is used as the reconstructed carrier phase information.

In operation B of the modeled carrier phase which is also referred to as reconstructed carrier phase information is supplied to pseudorange carrier phase smoothing logic . As described above method of flowchart B can be implemented at GPS GNSS reference stations and the reconstructed carrier phase information can then be broadcast to cellular device .

At the cellular device accesses the GNSS chipset embedded within the cellular device where the GNSS chipset calculates pseudorange information for use by the GNSS chipset . For example the GNSS receiver can perform GPS measurements to derive raw measurement data for a position of the cellular device . The raw measurement data provides an instant location of the cellular device . The GNSS chipset calculates pseudorange information that is for use by the GNSS chipset . According to one embodiment the raw measurement data is the pseudorange information that will be extracted. Examples of pseudorange information are uncorrected pseudorange information differential GNSS corrections high precision GNSS satellite orbital data GNSS satellite broadcast ephemeris data and ionospheric projections.

A chipset accessor logic according to one embodiment is configured for accessing the GNSS chipset . According to one embodiment the chipset accessor logic is a part of an SUPL client .

The pseudorange information can be obtained from the processor of the GNSS receiver using a command. The GNSS chipset may be designed for example by the manufacturer of the GNSS chipset to provide requested information such as pseudorange information in response to receiving the command. The pseudorange information may be extracted from the GNSS chipset using the command that the manufacturer has designed the GNSS chipset with. For example according to one embodiment the GNSS chipset is accessed using an operation that is a session started with a message that is an improved accuracy Secure User Platform Location SUPL start message or a high precision SUPL INIT message. According to one embodiment the message is a custom command that is specific to the GNSS chipset also referred to as a GNSS chipset custom command and the improved accuracy SUPL client can access to the raw measurements of the GNSS chipset .

Examples of chipset manufacturers include Qualcomm Texas Instruments FastraX Marvel SIRF Trimble SONY Furuno Nemerix Phillips and XEMICS to name a few.

At the cellular device extracts the pseudorange information from the GNSS chipset for use elsewhere in the cellular device outside of the GNSS chipset . For example pseudorange information extractor logic may be associated with a worker thread of the SUPL client . The worker thread associated with the SUPL client can monitor the raw measurements delivered by the GNSS chipset into the GNSS chipset s memory buffers cache the raw measurements and use the raw measurements to determine a position fix. The pseudorange information extractor logic and the pseudorange information processing logic can be associated with the worker thread. For example the pseudorange information extractor logic can cache the raw measurements and the pseudorange information processing logic can determine the location.

According to one embodiment the raw measurement data is the pseudorange information that is extracted. According to one embodiment the raw measurement data is pseudorange information that is calculated by the GNSS chipset and is only for use by the GNSS chipset .

According to one embodiment a determining position fix logic B may perform a least squares solution B on the extracted pseudorange information prior to transmitting the output to the pseudorange information bridger logic . According to another embodiment the extracted pseudorange information is improved using various embodiments described in prior to performing a least squares solution B as will be described herein.

The extracted pseudorange information without further improvements can be used to provide an instant location as described herein. The extracted pseudorange information can be improved by applying position accuracy improvements that include but are not limited to those depicted in Tables 2 and 3. The instant location or the improved location can be communicated to location manager logic as discussed herein that displays the instant location or the improved location with respect to a map.

At A the pseudorange correction logic provides Wide Area Augmentation System WAAS corrected pseudoranges by applying WAAS corrections to the extracted pseudorange information. For example the pseudorange correction logic receives the extracted pseudorange information that was extracted from the GNSS chipset at of . The cellular device receives the WAAS corrections as described herein and provides the WAAS corrections to the pseudorange correction logic . The pseudorange correction logic provides Wide Area Augmentation System WAAS corrected pseudoranges by applying the received WAAS corrections to the extracted pseudorange information.

At B the pseudorange carrier phase smoothing logic provides smoothed pseudorange information by performing pseudorange smoothing on the extracted pseudorange information based on carrier phase information. For example if real carrier phase information is available the cellular device can extract it as discussed herein. Otherwise the cellular device can derive reconstructed carrier phase information as described herein and provide the reconstructed carrier phase information to the pseudorange carrier phase smoothing logic . The pseudorange carrier phase smoothing logic can receive the extracted pseudorange information that was extracted from the GNSS chipset at of . The pseudorange carrier phase smoothing logic can apply either the real carrier phase information or the real carrier phase information to the extracted pseudorange information to provide smoothed pseudorange information.

At B a position fix is determined based on the smoothed pseudorange information and WAAS pseudorange corrections. For example the pseudorange correction logic receives the smoothed pseudorange information and receives WAAS pseudorange corrections and determines a position fix based on the smoothed pseudorange information and the WAAS pseudorange corrections.

According to one embodiment a determining position fix logic B may perform a least squares solution B on the output of flowchart A and B prior to transmitting the output to the pseudorange information bridger logic .

At A the pseudorange correction logic provides Differential Global Positioning System DGPS corrected pseudoranges by applying DGPS corrections to the extracted pseudorange information.

For example the pseudorange correction logic receives the extracted pseudorange information that was extracted from the GNSS chipset at of . The cellular device receives the DGPS corrections as described herein and provides the DGPS corrections to the pseudorange correction logic . The pseudorange correction logic provides Differential Global Positioning System DGPS corrected pseudoranges by applying the received DGPS corrections to the extracted pseudorange information.

At A the pseudorange correction logic provides WAAS DGPS corrected pseudoranges by applying Wide Area Augmentation System WAAS to the DGPS corrected pseudoranges.

For example the pseudorange correction logic accesses the DGPS corrected pseudoranges determined at A of . The cellular device receives the WAAS corrections as described herein and provides the WAAS corrections to the pseudorange correction logic . The pseudorange correction logic provides WAAS DGPS corrected pseudoranges by applying Wide Area Augmentation System WAAS to the DGPS corrected pseudoranges.

At B a position determination decision is made as to whether to proceed to B or B. For example at operation B the position accuracy improvement determination logic B can determine whether to proceed to B or B as discussed herein.

At B DGPS corrected smoothed pseudoranges are provided by applying corrections to the smoothed pseudorange information. For example the pseudorange correction logic can provide DGPS corrected smoothed pseudoranges by applying DGPS corrections to the smoothed pseudoranges determined at either B or B.

At B WAAS DGPS corrected smoothed pseudoranges are provided by applying WAAS to the DGPS corrected smoothed pseudoranges. For example the pseudorange correction logic can provide WAAS DGPS corrected smoothed pseudoranges by applying WAAS corrections to the DGPS corrected smoothed pseudoranges.

According to one embodiment a determining position fix logic B may perform a least squares solution B on the output of flowcharts A or B prior to transmitting the output to the pseudorange information bridger logic .

At A DGPS corrected pseudoranges are determined by applying DGPS pseudorange corrections to extracted pseudorange information. For example the pseudorange correction logic receives extracted pseudorange information from the pseudorange information extractor logic and applies the DGPS pseudorange corrections to the extracted pseudorange information.

At A the pseudorange correction logic can determine a position fix based on the DGPS corrected pseudoranges and PPP corrections.

At B smoothed pseudorange information is provided by performing pseudorange smoothing on the extracted pseudorange information using carrier phase information. For example the pseudorange carrier phase smoothing logic provides smoothed pseudorange information by performing pseudorange smoothing on the extracted pseudorange information which can be obtained as discussed herein based on carrier phase information. If real carrier phase information is available the cellular device can extract the real carrier phase information as discussed herein. Otherwise the cellular device can derive reconstructed carrier phase information as described herein and provide the reconstructed carrier phase information to the pseudorange carrier phase smoothing logic .

At B DGPS corrected smoothed pseudoranges are provided by applying DGPS pseudorange corrections to the smoothed pseudorange information. For example the pseudorange correction logic can receive the smoothed pseudorange information from the pseudorange carrier phase smoothing logic . The pseudorange correction logic can determine the corrected smoothed pseudoranges by applying DGPS pseudorange corrections to the smoothed pseudorange information.

At B a position fix can be determined based on the DGPS corrected smoothed pseudoranges and PPP corrections. For example the pseudorange correction logic can determine a position fix based on the DGPS corrected smoothed pseudoranges and PPP corrections.

According to one embodiment a determining position fix logic B may perform a least squares solution B on the output of flowcharts A and B prior to transmitting the output to the pseudorange information bridger logic .

At the pseudorange carrier phase smoothing logic smoothes the extracted pseudorange information based on carrier phase smoothing. For example the pseudorange carrier phase smoothing logic receives extracted pseudorange information from the pseudorange information extractor logic and receives carrier phase information which may be either real carrier phase information or reconstructed carrier phase information as described herein. The pseudorange carrier phase smoothing logic smoothes the extracted pseudorange information based on carrier phase smoothing.

At the PPP logic C provides a smoothed improved accuracy position fix by performing Precise Point Positioning PPP processing on the smoothed extracted pseudorange information. For example the PPP logic C receives the smoothed extracted pseudorange information provided by the pseudorange carrier phase smoothing logic at . The PPP logic C provides a smoothed improved accuracy position fix by performing Precise Point Positioning PPP processing on the smoothed extracted pseudorange information

At the pseudorange correction logic can optionally correct the smoothed improved accuracy position fix by applying Differential Global Positioning System DGPS corrections to the smoothed improved accuracy position fix. For example pseudorange correction logic receives the smoothed improved accuracy position fix provided by the PPP logic C at . The pseudorange correction logic receives DGPS corrections as described herein. The pseudorange correction logic corrects the smoothed improved accuracy position fix by applying Differential Global Positioning System DGPS corrections to the smoothed improved accuracy position fix thus providing a corrected smoothed improved accuracy position fix. Operation is optional according to one embodiment.

According to one embodiment a determining position fix logic B may perform a least squares solution B on the output of flowchart prior to transmitting the output to the pseudorange information bridger logic .

At various types of information can be accessed. Examples of accessing are extracting information and receiving information. Unsmoothed uncorrected pseudorange information can be extracted at A WAAS corrections can be extracted at B SBAS corrections can be extracted at E Doppler shift can be extracted at C and carrier phase measurements can be extracted at D. Accessing and obtaining can be used interchangeably. Table 1 depicts types of information that can be extracted at operation from the GNSS chipset and types of information that are received at operation instead of being extracted. However various embodiments are not limited to the types of information that can be extracted or received depicted in Table 1.

What or whether to apply position accuracy improvements can be determined at for example by the position accuracy improvement determination logic B. Examples of position accuracy improvements are real carrier phase information reconstructed carrier phase information WAAS SBAS DGPS PPP RTK VRS and RTX corrections. The determination logic B can determine whether one or more and in what order logics A B A F are performed according to one embodiment. Tables 2 and 3 are examples of carrier phase information or corrections or a combination thereof that the position accuracy improvement determination logic B may determine as discussed herein.

The information can be smoothed at . Examples of smoothing are real carrier phase smoothing and reconstructed carrier phase smoothing .

Either unsmoothed information or smoothed information can be corrected at . For example unsmoothed information from or smoothed information from can be corrected at . Examples of correcting are SBAS correcting G WAAS correcting A DGPS correcting B PPP correcting C RTK correcting D VRS correcting E and RTX correcting F. The smoothed information or unsmoothed information can be corrected using one or more of operations A G. According to one embodiment WAAS correcting A is an example of SBAS correcting G.

Unsmoothed information from smoothed information from corrected unsmoothed information from or corrected smoothed information from can be used to determine a position fix B at for example by performing a least squares solution B at . The output of flowchart is a position fix B. Table 2 and Table 3 depict combinations of information that result in a position fix B according to various embodiments.

According to one embodiment accessing extracting extracting pseudorange information A extracting SBAS E extracting WAAS B extracting Doppler C extracting carrier phase measurement D receiving smoothing correcting determining a position fix and performing a least squares solution can be performed respectively by logic B B B B B B and B. Real carrier phase smoothing reconstructed carrier phase smoothing correcting A G can be performed respectively by logic A B A E F G.

Any one or more of A E A G can be performed. Further any one or more of A E B C E A G can be performed in various orders. Various embodiments are not limited to just the combinations that are described herein.

According to one embodiment a Global Navigation Satellite System GNSS chipset embedded within the cellular device is accessed at where the GNSS chipset calculates pseudorange information for use by the GNSS chipset. The pseudorange information is extracted at from the GNSS chipset for use elsewhere in the cellular device outside of the GNSS chipset. The accessing and the extracting A can be performed by the cellular device that includes hardware .

The extracted pseudorange information can be smoothed at . The smoothing can be based on reconstructed carrier phase information or real carrier phase information. The smoothed pseudorange information can be corrected at . Examples of the types of corrected pseudoranges are Wide Area Augmentation System WAAS Differential Global Positioning System DGPS Precise Point Positioning PPP and Real Time Kinematic RTK . Pseudorange corrections can be accessed . The corrected pseudorange information can be derived for example at by applying the pseudorange corrections to the extracted pseudorange information.

The operations depicted in transform data or modify data to transform the state of a cellular device . For example by extracting pseudorange information from a GNSS chipset for use elsewhere the state of the cellular device is transformed from a cellular device that is not capable of determining a position fix itself into a cellular device that is capable of determining a position fix itself. In another example operations depicted in flowcharts transform the state of a cellular device from not being capable of providing an improved accuracy position fix to be capable of providing an improved accuracy position fix.

The above illustration is only provided by way of example and not by way of limitation. There are other ways of performing the method described by flowcharts .

The operations depicted in can be implemented as computer readable instructions hardware or firmware. According to one embodiment hardware associated with a cellular device can perform one or more of the operations depicted in .

With reference now to a block diagram is shown of an embodiment of an example GNSS receiver which may be used in accordance with various embodiments described herein. In particular illustrates a block diagram of a GNSS receiver in the form of a general purpose GPS receiver capable of demodulation of the L1 and or L2 signal s received from one or more GPS satellites. A more detailed discussion of the function of a receiver such as GPS receiver can be found in U.S. Pat. No. 5 621 416 by Gary R. Lennen is titled Optimized processing of signals for enhanced cross correlation in a satellite positioning system receiver and includes a GPS receiver very similar to GPS receiver of .

In received L1 and L2 signals are generated by at least one GPS satellite. Each GPS satellite generates different signal L1 and L2 signals and they are processed by different digital channel processors which operate in the same way as one another. shows GPS signals L1 1575.42 MHz L2 1227.60 MHz entering GPS receiver through a dual frequency antenna . Antenna may be a magnetically mountable model commercially available from Trimble Navigation of Sunnyvale Calif. Master oscillator provides the reference oscillator which drives all other clocks in the system. Frequency synthesizer takes the output of master oscillator and generates important clock and local oscillator frequencies used throughout the system. For example in one embodiment frequency synthesizer generates several timing signals such as a 1st local oscillator signal LO1 at 1400 MHz a 2nd local oscillator signal LO2 at 175 MHz an SCLK sampling clock signal at 25 MHz and a MSEC millisecond signal used by the system as a measurement of local reference time.

A filter LNA Low Noise Amplifier performs filtering and low noise amplification of both L1 and L2 signals. The noise figure of GPS receiver is dictated by the performance of the filter LNA combination. The downconvertor mixes both L1 and L2 signals in frequency down to approximately 175 MHz and outputs the analogue L1 and L2 signals into an IF intermediate frequency processor . IF processor takes the analog L1 and L2 signals at approximately 175 MHz and converts them into digitally sampled L1 and L2 inphase L1 I and L2 I and quadrature signals L1 Q and L2 Q at carrier frequencies 420 KHz for L1 and at 2.6 MHz for L2 signals respectively.

At least one digital channel processor inputs the digitally sampled L1 and L2 inphase and quadrature signals. All digital channel processors are typically are identical by design and typically operate on identical input samples. Each digital channel processor is designed to digitally track the L1 and L2 signals produced by one satellite by tracking code and carrier signals and to from code and carrier phase measurements in conjunction with the GNSS microprocessor system . One digital channel processor is capable of tracking one satellite in both L1 and L2 channels. Microprocessor system is a general purpose computing device such as computer system of which facilitates tracking and measurements processes providing pseudorange and carrier phase measurements for a determining position fix logic . In one embodiment microprocessor system provides signals to control the operation of one or more digital channel processors . According to one embodiment the GNSS microprocessor system provides one or more of pseudorange information Doppler Shift information and real Carrier Phase Information to the determining position fix logic . One or more of pseudorange information Doppler Shift information and real Carrier Phase Information can also be obtained from storage . One or more of the signals can be conveyed to the cellular device s processor such as processor that is external to the GNSS chipset . Determining position fix logic performs the higher level function of combining measurements in such a way as to produce position velocity and time information for the differential and surveying functions for example in the form of a position fix . Storage is coupled with determining position fix logic and microprocessor system . It is appreciated that storage may comprise a volatile or non volatile storage such as a RAM or ROM or some other computer readable memory device or media. In some embodiments determining position fix logic performs one or more of the methods of position correction described herein.

In some embodiments microprocessor and or determining position fix logic receive additional inputs for use in receiving corrections information. According to one embodiment an example of the corrections information is WAAS corrections. According to one embodiment examples of corrections information are differential GPS corrections RTK corrections signals used by the previously referenced Enge Talbot method and wide area augmentation system WAAS corrections among others.

Although depicts a GNSS receiver with navigation signals L1I L1Q L2I L2Q various embodiments are well suited different combinations of navigational signals. For example according to one embodiment the GNSS receiver may only have an L1I navigational signal. According to one embodiment the GNSS receiver may only have L1I L1Q and L2I.

Various embodiments are also well suited for future navigational signals. For example various embodiments are well suited for the navigational signal L2C that is not currently generally available. However there are plans to make it available for non military receivers.

According to one embodiment either or both of the accessing logic B and the processing logic reside at either or both of the storage and GNSS microprocessor system .

According to one embodiment the GNSS receiver is an example of a GNSS receiver see e.g. and . According to one embodiment the determining position fix logic is an example of determining position fix logic B . According to one embodiment position fix is an example of a position fix B .

A basic Kalman filter implemented using Kalman filtering process typically has at least two major components states and covariances . States represent variables that are used to describe a system being modeled at a particular moment in time. Covariances are represented in a covariance matrix that describes uncertainty or lack of confidence of states with respect to each other at that same moment in time. Kalman filtering process also handles noise or unpredictable variability in the model. There are two principle types of noise observation noise and process noise . A Kalman filter may handle additional noise types in some embodiments. Process noise describes noise of the states as a function of time. Observation noise is noise that relates to the actual observation s e.g. observed measurements that are used as an input update to Kalman filtering process .

A prediction phase is the first phase of Kalman filtering process . Prediction phase uses predictive models to propagate states to the time of an actual observation s . Prediction phase also uses process noise and predictive models to propagate the covariances to time of the actual observation s as well. The propagated states are used to make predicted observation s for the time of actual observation s .

A correction phase is the second phase in the Kalman filtering process . During correction phase Kalman filtering process uses the difference between the predicted observation s and the actual observation s to create an observation measurement residual which may commonly be called the measurement residual. Observation noise can be noise in actual observation s and or noise that occurs in the process of taking the actual observation s . A Kalman gain is calculated using both the covariances and the observation noise . The states are then updated using the Kalman Gain multiplied by the observation measurement residual . The covariances are also updated using a function related to the Kalman gain for example in one embodiment where Kalman gain is limited to a value between 0 and 1 this function may be 1 minus the Kalman gain. This updating is sometimes referred to as the covariance update. In some embodiments if no actual observation is available Kalman filtering process can simply skip correction phase and update the states and covariances using only the information from prediction phase and then begin again. Using the new definitions of the states and covariances Kalman filtering process is ready to begin again and or to be iteratively accomplished.

Unless otherwise specified any one or more of the embodiments described herein can be implemented using non transitory computer readable storage medium and computer readable instructions which reside for example in computer readable storage medium of a computer system or like device. The non transitory computer readable storage medium can be any kind of physical memory that instructions can be stored on. Examples of the non transitory computer readable storage medium include but are not limited to a disk a compact disk CD a digital versatile device DVD read only memory ROM flash and so on. As described above certain processes and operations of various embodiments of the present invention are realized in one embodiment as a series of computer readable instructions e.g. software program that reside within non transitory computer readable storage memory of a cellular device and are executed by a hardware processor of the cellular device . When executed the instructions cause a computer system to implement the functionality of various embodiments of the present invention. For example the instructions can be executed by a central processing unit associated with the cellular device . According to one embodiment the non transitory computer readable storage medium is tangible.

Unless otherwise specified one or more of the various embodiments described herein can be implemented as hardware such as circuitry firmware or computer readable instructions that are stored on non transitory computer readable storage medium. The computer readable instructions of the various embodiments described herein can be executed by a hardware processor such as central processing unit to cause the cellular device to implement the functionality of various embodiments. For example according to one embodiment the SUPL client and the operations of the flowcharts depicted in are implemented with computer readable instructions that are stored on computer readable storage medium which can be tangible or non transitory or a combination thereof and can be executed by a hardware processor of a cellular device .

Reference will now be made in detail to various embodiments of the subject matter examples of which are illustrated in the accompanying drawings. While various embodiments are discussed herein it will be understood that they are not intended to be limited to these embodiments. On the contrary the presented embodiments are intended to cover alternatives modifications and equivalents which may be included within the spirit and scope the various embodiments as defined by the appended claims. Furthermore in the following Description of Embodiments numerous specific details are set forth in order to provide a thorough understanding of embodiments of the present subject matter. However embodiments may be practiced without these specific details. In other instances well known methods procedures components and circuits have not been described in detail as not to unnecessarily obscure aspects of the described embodiments.

Unless specifically stated otherwise as apparent from the following discussions it is appreciated that throughout the description of embodiments discussions utilizing terms such as collecting capturing obtaining determining storing calculating calibrating receiving designating performing displaying positioning accessing transforming data modifying data to transform the state of a computer system or the like refer to the actions and processes of a computer system data storage system storage system controller microcontroller hardware processor such as a central processing unit CPU or similar electronic computing device or combination of such electronic computing devices. The computer system or similar electronic computing device manipulates and transforms data represented as physical electronic quantities within the computer system s device s registers and memories into other data similarly represented as physical quantities within the computer system s device s memories or registers or other such information storage transmission or display devices.

According to one embodiment a mobile data collection platform captures an image that depicts at least one point of interest. The location and orientation of the mobile data collection platform may be captured at the time the image is captured. The orientation of the mobile data collection platform is with respect to a local gravity vector that is local to the mobile data collection platform. The orientation according to one embodiment is given by a three axis tilt angle sensor and the direction of the tilt angle may be determined from the tilt angles for the x axis sensor and the y axis sensor as determined by aiming the measurement platform towards the point of interest. The tilt sensor measures degree of departure from local gravity vertical in 2 or 3 axes. The location and orientation can be associated with the image for example by the user holding the mobile data collection platform still during the period of time that the image is captured and the location and orientation of the mobile data collection platform are determined. In another example when a user of the mobile data collection platform presses a button the image the location and the orientation can all be obtained and stored in response to the user pressing the button. Therefore location and orientation can be associated with the image by determining the location and orientation and capturing the image in a time period that is short enough to avoid any significant user movement of the mobile data collection platform during the capture process.

Scale Information may be used as a part of determining a distance between the mobile data collection platform and the point of interest. The scale information may be the depiction of an object which has a known dimension in the captured image. A single measurement can be made if the plane of scale object is parallel to the plane of the image capture device. This is hard to achieve so two images are usually required. In another example a second image that depicts the point of interest captured with the image capturing device that is at a second location and orientation where the first location and the second location are separated by a known distance. Since the mobile data collection platform has a position determination system the distance between the first location and the second location can be easily determined as will become more evident. In this case scale information can include one or more of the first and second images the first and second locations and orientations that were used when the respective first and second images were captured and the known distance between the first and second locations.

The mobile data collection platform includes a cellular device processing logic an image capturing device an orientation system an inertial orientation system tilt sensor compass and hardware . The cellular device includes a display GNSS chipset and an antenna . The hardware includes the image capturing device the orientation system the inertial orientation system hardware memory and hardware processor . The antenna the display the processing logic the hardware are part of the mobile data collection platform and outside of the GNSS chipset .

According to one embodiment the orientation system includes a compass and an inertial orientation system . According to one embodiment the inertial orientation system includes a three axis tilt sensor . According to one embodiment the tilt sensor is a three axis inertial measurement unit IMU . According to one embodiment the tilt sensor is a three axis accelerometer. According to one embodiment the tilt sensor is a two axis accelerometer where the axes are for the x and y directions in the platform coordinate system.

The orientation system according to one embodiment determines orientation information that represents an orientation of the mobile data collection platform . The orientation information includes according to one embodiment inertial orientation information and azimuth angle. According to one embodiment the inertial orientation information includes a tilt angle from the tilt sensor .

Angles such as the azimuth angle are measured in 360 degrees as is well known in the art. However other metrics used by surveyors for describing angular displacement including what is known as grad that uses 400 degrees in a full circle can also be used.

The tilt sensor may be used to determine the tilt angle. The tilt angle indicates the mobile data collection platform s orientation with respect to a local gravity vector as measured from a vertical or zenith point. The overall tilt angle is composed of two angles tilt in the direction of the x axis and tilt in the direction of the y axis. The vector magnitude gives a tilt angle in the direction of the vector sum of the x axis and y axis components. It may be reported as a tilt angle in polar coordinates as well. Polar coordinates the tilt angle as measured from a vertical gravity reference direction along a compass angle as determined by the vector sum of the x and y components. Tilt sensors determine the tilt angle based on Euler angles. The inertial orientation information may include the Euler angles from the tilt sensor in addition to the tilt angle or instead of the tilt angle.

The compass may be used to determine the azimuth angle. The azimuth angle indicates the orientation for example with respect to a reference direction such as true north magnetic north or a reference target at a known location from which the direction vector can be determined.

The hardware memory stores the image that depicts the point of interest the position fix and the orientation information . The antenna has a three dimensional GNSS position fix Xpf Ypf Zpf that is stored in memory as position fix .

The hardware processor is for executing the capturing of the image with the image capturing device where the image includes at least one point of interest the determining of the position fix of the mobile data collection platform based on the raw observables where the position fix provides a location of the mobile data collection platform in a GNSS coordinate system the accessing of the orientation information from the inertial orientation system and the storing of the image the position fix and the orientation information in the hardware memory of the mobile data collection platform .

The mobile data collection platform is not required to be leveled as a part of capturing the image determining the position fix and determining the orientation information . The orientation information is associated directly and automatically with a three dimensional location such as the position fix Xpf Ypf Zpf stored as position fix or the three dimensional location X0 Y0 Z0 of an entrance pupil center of the mobile data collection platform when the image was captured. The mobile data collection platform is not required to be leveled at the time that the position fix Xpf Zpf Ypf and the orientation information are determined as is common with other optical measurement devices such as theodolites or total stations.

Any one or more of the entities such as hardware image capturing device inertial orientation system compass hardware memory hardware processor that are part of the mobile data collection platform and outside of the cellular device can instead be inside of the cellular device . According to one embodiment the mobile data collection platform is a cellular device. For example a tablet computer may contain all the recited hardware plus a separate cellphone module which itself can contain some of the hardware items including a GNSS chipset. Conversely the tablet may contain a GNSS chipset whose raw observables may be made available to any of the processors associated with the tablet.

Various types of information can be stored for example in an EXIF file associated with the image . Examples of information that can be written into the EXIF file are the GPS position fix orientation information the tilt angle the direction of an azimuth angle also referred to as an azimuth direction or tilt direction scale information and antenna to entrance pupil center geometric information. Any type of information that can be used for determining one or more of a three dimensional position of the entrance pupil center of the image capturing device a distance from the entrance pupil center to a point of interest and a location of a point of interest as will become more evident can be stored in the EXIF file. Alternatively any or more of the same information can be stored as reference information in a suitable reference file associated with the particular mobile data collection platform.

The mobile data collection platforms and depicted in and include a cellular device . According to one embodiment the cellular device can include cellular devices such as cellular device or any other cellular device described herein or any communications system capable of connecting with a cellular telephone system private or public for the purpose of transmitting and receiving voice data and messaging information.

An example of an image capturing device is a digital camera or portion thereof which includes an electronic image sensor e.g. a charge coupled device CCD image sensor an Active Pixel Sensor APS image sensor or other form of electronic image sensor . An example of hardware memory is memory . An example of hardware processor is hardware processor . An example of a GNSS chipset is GNSS chipset . According to one embodiment the mobile data collection platform includes a SUPL client as described herein. The SUPL client can be inside of the cellular device or can be in the mobile data collection platform and outside of the cellular device .

According to various embodiments the mobile data collection platform can include any one or more of features described herein. For example the mobile data collection platform can include at least any one or more features depicted in and can perform at least any one or more operations as depicted in .

For example the processing logic includes orientation information determination logic inertial orientation information determination logic store location of point of interest determination information logic and a true north declination angle application .

Orientation information can include one or more of tilt angle and azimuth angle. Orientation information determination logic includes the inertial orientation information determination logic according to one embodiment. However and can be separate. For example instructions for and may be part of the same procedure or function or may be part of separate procedures or functions.

The inertial orientation information determination logic that receives Euler angles from the inertial orientation system and processes the Euler angles to provide the tilt angle of the mobile data collection platform. The Euler angles may be stored in hardware memory .

The orientation information determination logic receives information from the compass and determines the tilt direction according to one embodiment.

The orientation information according to one embodiment includes information that provides a three dimensional position of the mobile data collection platform . The orientation information and the position fix can be used for determining the three dimensional position X0 Y0 Z0 of and or associated with the mobile data collection platform in a local three dimensional coordinate system.

Since the inertial orientation system provides information pertaining to the tilt angle of the mobile data collection platform the mobile data collection platform is not required to be leveled as a part of obtaining the location of point of interest determination information.

The store location of point of interest determination information logic according to one embodiment can store location of point of interest determination information such as the position fix the image and the orientation information into the hardware memory of the mobile data collection platform.

For example in an embodiment a mobile data collection platform captures an image that depicts a point of interest for the purpose of determining a distance between a three dimensional position of the mobile data collection platform such as the three dimensional position of the entrance pupil center and the point of interest. The mobile data collection platform collects various types of information that can be used for calculating the distance between the point of interest and the three dimensional position of the data collection platform . The collected information that can be used for determining the distance shall be referred to as location of point of interest determination information. 

According to one embodiment the location of point of interest determination information includes more than one image . The location of point of interest determination information can include any type of information that can be used for determining the location of the point of interest according to one embodiment. The location of point of interest determination information may include any type of information that can be used for determining the location of the point of interest in a three dimensional coordinate system according to one embodiment. According to one embodiment the three dimensional coordinate system that the point of interest can be located in is the well known latitude longitude and altitude or height system used in mapping. The GNSS receiver first locates itself in the WGS 84 World Geodetic System standard coordinate system widely accepted for use in cartography geodesy and navigation and used to describe the shape and coordinates of the earth. The WGS 84 datum includes the definition of a reference ellipsoid which approximates the earth s geoid. The WGS 84 datum is used for referencing GNSS derived positions to the earth. Models are available for relating WGS 84 derived heights to mean sea level geoid heights such as the Earth Gravitational Model 1996. According to one embodiment WGS 84 coordinate system includes WGS 84 datum. A conversion system within the GNSS receiver converts the GNSS determined WGS 84 data into latitude longitude and altitude information which are then used in the local coordinate system. Data on points of interest will be measured and transformed into the same local coordinate system. According to one embodiment the information includes any type of information that can be used for determining the location of the point of interest in a three dimensional coordinate system so that the mobile data collection platform is not required to be leveled as a part of determining the location of the point of interest.

According to one embodiment a true north declination angle application provides a declination angle for true north from the latitude and longitude associated with a position fix such as the position fix Xpf Ypf Zpf of an antenna . For example according to one embodiment the orientation of the mobile data collection platform at the time the image depicting the point of interest includes a tilt direction that is determined with respect to a reference direction. According to one embodiment the reference direction is true north.

Compasses provide the direction to magnetic north. True north can be determined by applying compensations to the direction of magnetic north provided by a compass.

One of the functions of the true north declination angle application that is used according to various embodiments is obtaining compensations that can be applied to the direction of magnetic north provided by a compass to obtain true north. For example the true north declination angle application can communicate with a database provided by the U.S. government that provides the declination angle for true north from the latitude and longitude associated with a position fix such as the position fix Xpf Ypf Zpf of an antenna . Therefore according to various embodiments the true north declination angle application can provide the position fix Xpf Ypf Zpf of the current location of the antenna to the U.S. governments database. The U.S. government s database can use the position fix Xpf Ypf Zpf to locate compensations such as declination angle for true north from the latitude and longitude associated with a position fix Xpf Ypf Zpf and return the compensations to the true north declination angle application . Magnetic north while the platform is at the same position Xpf Ypf Zpf can be obtained from the compass . True north can be derived for example by applying the compensations to the magnetic north.

The processing logic according to one embodiment provides instructions for communicating the position fix Xpf Ypf Zpf to the true north declination angle application and requesting compensations that correlate with the position fix Xpf Ypf Zpf receiving the compensations receiving magnetic north from the compass and determining true north by applying the compensations to magnetic north.

Data Collection Utilities Processing Logic according to one embodiment includes image outliner feature identification pattern recognition and image editor . The processing logic may include processing logic .

According to one embodiment a captured image can be displayed on the display . The user of the mobile data collection platform can outline a point of interest that is represented in image depicted on display . The user can specify that a point or feature is a point of interest for example by outlining it. The image outliner can receive information indicating the outline that the user drew around the point of interest. Therefore a point of interest that has been outlined is an example of a user specified point of interest. As will become more evident a user can also specify a point of interest using crosshairs shown in the display and aligned with the major axis of the image capturing device s lens also known as an entrance pupil . Feature identification can be performed for example by feature identification on a user specified point of interest. Pattern recognition can be performed on a user specified point of interest.

The user can use the image editor to annotate the image for example with audio or text or a combination thereof. The annotation can be a description of a point of interest. For example the user can indicate in the annotation that the point of interest is a standard survey target device consisting of concentric circles with alternating black and white sections or the upper right corner of a door or other point of interest or pseudo point of interest as described herein. These are just a couple of examples of annotations. Therefore a point of interest that a user specifies using an annotation is another example of a user specified point of interest. The annotation can include other information such as a description of the area or a job site where the image was taken.

For more information on cellular communications Bluetooth communications image outliner feature identification pattern recognition and image editor refer to U.S. 2012 0163656 filed on Jun. 28 2012 entitled Method Apparatus for image based positioning by Soubra et al and assigned to the assignee of the present application. Refer also to the contents of U.S. 2012 0330601 filed on Feb. 15 2012 entitled Determining Tilt Angle and Tilt Direction Using Image Processing by Soubra et al and assigned to the assignee of the present application.

Referring to the processing logic includes crosshairs processing logic bubble level processing logic and distance between two positions logic . The processing logic may include processing logic or processing logic or a combination thereof.

The crosshairs processing logic receives and processes information with respect to a crosshair display overlay as will become more evident.

The bubble level processing logic can receive information from the tilt sensor and use the received information to display a graphical visual representation of a bubble inside of the electronic bubble level overlay as will become more evident.

According to one embodiment the distance between two positions processing logic obtains the position fixes associated with two locations that a mobile data collection platform took images of a point of interest and determines a distance between the two locations based on the position fixes.

According to one embodiment one or more of the processing logics are executed by one or more hardware processors that are part of the mobile data collection platform and outside of the GNSS chipset .

Due to the orientation of mobile data collection platform the image plane that defines the orientation of an image captured with the image capturing device of mobile data collection platform would be defined by the x axis and z axis and the ground plane that is approximately parallel to the ground would be defined by the x axis and the y axis.

The body of mobile data collection platform is often tipped so that it is no longer in a vertical orientation. In this case the image capture device may view the nearby ground as well as objects in the foreground. No loss of functionality of position shift motion detection occurs for the LMM system.

Photogrammetry is the practice of determining the geometric properties of objects from photographic images. In the simplest example the distance between two points that lie on a plane parallel to the photographic image plane can be determined by measuring their distance on the image if the scale s of the image is known. This is done by multiplying the measured distance by a scale factor 1 S.

One way of finding points uses features to identify the desired object or point on a desired object. An example of an object is a door and an example of points on the object are the corners of the door. The points may be described by a feature description of the object. For example the door s corners may be represented by a small collection of closely associated details or image bits which form a distinct and recognizable image pattern. Modern image processing methods are available for identifying such grouping of image bits as feature points. 

According to one embodiment there are two types of calibration that enable satisfactory operation of an image capturing device with photogrammetric analyses. The first type of calibration is a determination of the angular displacement associated with each pixel or charge coupled device capture element. This may be done mathematically for example by determining the entire field of view of the image capturing device using external means and then dividing this angular field of view by the number of pixel elements in each dimension horizontally and vertically. This external mathematical means is well known in the art and includes measuring a distance from a reference plane such as a wall to the entrance pupil of the image capturing device and then marking the edges of the field of view horizontally and vertically for example on the image plane also known as a reference plane . The distance from each edge horizontally and vertically plus the distance from the entrance pupil to the image plane enable creation of a triangle whose angles for horizontal and vertical can be determined thus defining the field of view in horizontal and vertical planes relative to the image plane. An example of an image plane is illustrated in .

The second type of calibration deals with lens aberrations. Image capturing devices that are a part of cellular devices also referred to as internal image capturing devices typically have poor quality lenses where the image is distorted by a variety of lens aberrations so that what is a uniform distance metric in an image such as a checkerboard square pattern becomes less uniform particular near the edges of the field of view. Therefore according to one embodiment the image capturing device namely the camera and its lens must be calibrated.

Calibration can be done for a family of lenses associated with a particular image capturing device or may be done on an individual basis for each mobile data collection platform. The purpose of calibration is to 1 limit the useful area of the captured image data to only those pixels on the charge coupled device CCD that have a satisfactorily uniform image transform from the real world to the image capturing device s collection of CCD pixels or 2 to define the variation of transform information for the entire field of view in order to create a correction map for segments of pixels where distortion is greatest namely at the periphery of the field of view.

As stated poor quality lenses cause aberrations and or distortions. For example if an image of the pattern is captured using a poor quality lens the features such as the checkers in depicted in the image will not have the same proportions as the pattern . The distortion tends to increase toward the peripheries of the lens also known as stretch distortion . The kind and range of distortions in lenses are well known in the image processing arts. For example toward the center of the captured image the dimensions of the checkers will tend to be 1.00 by 1.00. However the dimensions of the checkers will increasingly be distorted the further the checkers are from the center. For example the checker at the center may have a height of 1.00 and a width of 1.00 and then as moved out the checker may have a height of 1.00 and a width of 1.05 and then as move still further toward the periphery the checker may have a height of 1.00 by width of 1.06. The pixel correction datum is a correction map for segments of pixels where distortion is greatest namely at the periphery of the field of view according to one embodiment. The pixel correction datum can be stored in the hardware memory .

There are other types of distortion effects besides a linear stretching such as pin cushion and barrel distortions for which alternate specifications for a distortion limit are available as is well known in the art.

According to one embodiment a quality threshold metric is used to determine the acceptable region within the boundary where the distortion is within an acceptable level. For example if the calibration image displaying the width of the squares as move toward the periphery do not differ by more than 5 percent from the width of a square closest to the pointing vector PV then the pixels for that square are included in the acceptable region . According to another embodiment if the width of the squares nearing the periphery do not differ by more than 2 percent from the width of the square closet to the pointing vector PV then the pixels for that square are included in the acceptable region . Thus a boundary can be determined for the CCD image capturing device such that image data in the acceptable region inside the boundary is used for photogrammetry analysis purposes and unacceptable region between the boundary and the periphery is ignored.

According to one embodiment calibrations are not performed for every single mobile data collection platform that is manufactured. According to one embodiment calibrations are performed for each type of mobile data collection platform. For example if there are two types of mobile data collection platforms that are manufactured and there are 1000 mobile data collection platforms for each of the two types two calibrations are performed instead of 2000. According to one embodiment calibrations are performed for each type of lens or are performed for each type of image capturing device.

A mobile data collection platform can be calibrated for example before it is purchased or after it is purchased. The mobile data collection platform can be calibrated for example at the manufacturing facility or by a user who bought the mobile data collection platform.

A mobile data collection platform accesses an internal GNSS chipset extracts raw observables from the internal GNSS chipset and determines a position fix Xpf Ypf Zpf based on the extracted raw observables according to various embodiments described herein. The extracted raw observables can include raw pseudoranges. Although various embodiments are described in the context of a GPS position fix since various position fixes are determined based on GNSS raw observables the term GPS shall be understood as including GNSS. 

 Raw observables shall be used to refer to the specific data comprising raw observables that are extracted from the internal GNSS chipset. The raw observables can include real carrier phase information or Doppler Shift Information. The raw pseudoranges may be smoothed based on real carrier phase information or reconstructed carrier phase information according to various embodiments described herein. The pseudoranges may be corrected for example based on external corrections obtained from correction sources that are external to a mobile data collection platform as described herein. A position fix may be smoothed based on locally measured movement information as described herein. The pseudoranges that are used for determining a position fix of the mobile data collection platform may be uncorrected unsmoothed pseudoranges corrected unsmoothed pseudoranges uncorrected smoothed pseudoranges or corrected smoothed pseudoranges as described herein. The position fixes may or may not be smoothed based on locally measured movement information as described herein.

A data collection platform captures an image that depicts a point of interest for the purpose of determining a distance between a three dimensional position of the data collection platform such as the three dimensional position of the entrance pupil center and the point of interest by photogrammetric methods. Other dimensions between other points in the image may also be determined.

According to one embodiment a point of interest is stationary. According to one embodiment a point of interest has a three dimensional coordinate. Examples of a point of interest are corners in an outdoor setting or indoor setting wall mounted fixture of various kinds such as lights switches window ledges window corners in an indoor setting a property boundary point a point of significance to a current or proposed construction project and or the like. A point of interest is also commonly referred to as target point or object point. A point of interest may be any point on an object that is of interest. It may be a topographic feature a manmade structure or component thereof such as a corner of a building the edge of a wall the point at which either of these contacts the ground. A single pixel or a group of pixels in an image can represent or be a point of interest.

Points of interest on moving objects may also be captured by the mobile data collection platform. With the mobile data collection platform time of data capture location of the platform and an image of the moving object can be obtained. Such mobile points of interest may include features on a vehicle including but not limited to door handles wheels logos emblems windows edges or corners.

According to one embodiment the pointing vector represents a line that points from the entrance pupil center to the point of interest. However embodiments are also well suited for using a point of interest that the pointing vector was not pointing directly at as long as the point of interest is in the image . For example if the pointing vector is not pointing at the real point of interest then the point that the pointing vector is pointing at can be used as a pseudo point of interest. The real point of interest that is also depicted in the image can be identified for example in relation to the pseudo point of interest. The pseudo point of interest can be represented by a single pixel or a group of pixels in an image where the single pixel or the group of pixels represents anything in the field of view captured with the image . For example a pseudo point of interest can be any type of point or feature that a point of interest can be. Further the pseudo point of interest may represent something that is not a real point of interest. For example the pseudo point of interest may be anywhere on a wall where there are no corners windows or doors or other features.

Photogrammetric techniques that are well known in the art can be used to determine the three dimensional location of the real point of interest for example based on the three dimensional relationship between the real point of interest and the pseudo point of interest and angles and scale factors determined during a data capture event.

A real point of interest and or a pseudo point of interest can be selected after or before the image has been captured.

A mobile data collection platform has an orientation when an image capturing device captures an image that depicts a point of interest. The orientation of the mobile data collection platform when the image is captured is stored as orientation information . Examples of orientation information includes one or more of tilt angle and tilt direction as determined by the azimuth angle given by the internal compass . Inertial orientation information includes tilt angle.

The tilt angle refers to an angle between a real world vertical axis e.g. local gravity vector and a vertical axis of the mobile data collection platform. The tilt direction refers to orientation typically relative to the local vertical axis in the x and y directions or may be represented in a polar coordinate system Azimuth angle or referred to as just azimuth refers to an angle between a reference direction and a line from the user of the mobile data collection platform to the point of interest as projected on the same plane as the reference direction typically a horizontal plane. Examples of a reference direction are true north magnetic north or a reference target at a known location from which the direction vector can be determined for example.

The local coordinate system includes the X local axis which represents east the Y local axis which represents north and the Z local axis which represents the local gravity vector .

The platform coordinate system of the mobile data collection platform includes the x platform axis the y platform axis and the z platform axis . According to one embodiment the y platform axis is parallel with the MDCP s length the z platform axis is parallel with the MDCP s depth and the x platform axis is parallel with the MDCP s width.

One end of the pointing vector PV is located at the entrance pupil center X0 Y0 Z0 of the image capturing device and the other end of the pointing vector PV is located at the point of interest or a pseudo point of interest. The pointing vector PV lies along the center line of the axis of the lens and its pupil.

The horizontal plane HP is about the three dimensional coordinates X0 Y0 Z0 of the entrance pupil s center. The horizontal line HL is in the horizontal plane HP. One end of the horizontal line HL is located at the entrance pupil center s coordinates X0 Y0 Z0. The horizontal line HL is directly below the pointing vector PV so that the horizontal line HL and the pointing vector PV are in the same vertical plane.

The tilt angle T is between the Z local axis and the y platform axis . The azimuth angle AZ is between the Y local axis north and the horizontal line HL. The elevation angle EL is between the horizontal line HL and the pointing vector PV. According to one embodiment the tilt angle T and the elevation angle EL measure have the same measurement by congruent triangles. Therefore the measurement of the tilt angle T can be used as the measurement of the elevation angle EL.

Point is located in the horizontal line HL and is directly below the point of interest . There is a distance between the point of interest and the point . The line that represents the distance is parallel with the local gravity vector .

The pointing vector PV is in the negative direction of the z platform axis . The x platform axis and the y platform axis are horizontal and vertical measurements of the image view. For example the y platform axis is the vertical dimension of an image and the x platform axis is the horizontal dimension of the image .

According to one embodiment the mobile data collection platform is or includes a tilt sensor that is 2 or 3 axis accelerometer. Typically modern smart phones and tablets include a 2 or 3 axis accelerometer. Therefore the mobile data collection platform is sensing the earth s gravity vector and as a result can automatically perform the same function that is manually performed for a typical optical total station that is known as leveling. Therefore a mobile data collection platform can determine the tilt angle T as measured from a local gravity vector which is vertical for any orientation of the mobile data collection platform .

The body of a mobile data collection platform and its principal axes are not the same axes that are represented in the local coordinates. As discussed herein the local gravity vector is used as the Z local axis true north is used as the Y local axis and east is used as the X local axis as depicted in . The axes of the platform coordinate system are the x platform axis the z platform axis and the y platform axis as depicted in and are the principal axes of the body of the mobile data collection platform .

According to one embodiment when a user points their mobile data collection platform at a point of interest the mobile data collection platform has a vector direction along the optical axis of the image capturing device which may be referred to as one of the principal axes of the mobile data collection platform . Herein it is referred to as the pointing vector PV but may also be referred to as a negative z platform axis . In this case the image displayed on the display represents an x and y pair of platform axes . According to the right hand rule x platform axis may represent the horizontal directions y platform axis may represent vertical directions which are parallel to the local gravity vector or the Z vector of the local coordinate system. Therefore z platform axis may represent negative direction towards the point of interest and the positive z platform axis direction in the platform coordinate system is toward the user of the mobile data collection platform not toward the point of interest .

Because of the capability of a tilt sensor that is 2 or 3 axis accelerometer the orientation of the mobile data collection platform relative to the local gravity vector in the local coordinate system is always available. The tilt angle T as measured from the local gravity vector to the z platform axis also known as the vector direction along the optical axis is independent of the orientation of the mobile data collection platform about the optical axis depicted as pointing vector PV in . Therefore any rotation of the mobile data collection platform about the optical axis PV does not affect the tilt angle . The tilt angle T may be displayed on the display . The tilt angle may be extracted from the tilt sensor for example using an API from a suite of API s that the tilt sensor provides.

Due to the independence between the tilt angle T and the orientation of the mobile data collection platform about the optical axis PV the handheld operation of the mobile data collection platform is foolproof with respect to measuring a vertical tilt angle T towards a point of interest as centered by appropriate manipulation of the mobile data collection platform towards the point of interest . The mobile data collection platform may be rotated about the optical axis PV and the determination of the tilt angle T determination and resulting determination of the elevation angle EL will always be the same for example as long as the photographic image of the point of interest is visible within the crosshair display overlay as depicted in . Therefore handheld operation of the mobile data collection platform is greatly simplified and no tripod or monopod is required.

According to one embodiment there are no intermediate operations required to determine the tilt angle . If the point of interest is in the center of the crosshairs display overlay then the tilt angle with respect to the point of interest is defined. If the point of interest is not in the center of the crosshairs display overlay also referred to as misalignment of the point of interest with respect to the crosshairs center the misalignment can be compensated for based on the number of pixels in the image from a pixel in the image that is represented by the center to a location of a pixel that represents the point of interest in the image and applying the angular correction appropriate for each pixels angular displacement.

Because the tilt angle T that is obtained from the tilt sensor is measured with respect to the local gravity vector by congruent triangles this tilt angle T is exactly the same as the elevation angle EL that is used for polar coordinate operations to convert the mobile data collection platform s data into the local coordinates.

The position fix of a mobile data collection platform is determined at the location of the antenna . However the position of an image is defined to be at the entrance pupil of the mobile data collection platform. The local gravity vector and the tilt angle are determined using the orientation system . Information relating the geometric relationship between the entrance pupil and the antenna also referred to as antenna to entrance pupil center geometric information or known spatial relationship can be used according to various embodiments.

The y platform axis is oriented along the length of the mobile data collection platform and the z platform axis is oriented along the depth of the mobile data collection platform . The horizontal line HL is horizontal with ground level and the entrance pupil center is one end of the horizontal line HL.

The pointing vector PV is from the entrance pupil center to the point of interest and the distance is between the entrance pupil center and the point of interest . The pointing vector PV is perpendicular to the front face of the mobile data capturing platform . For example the pointing vector PV is at a right angle with both the y platform axis and the x platform axis .

The line is an imaginary line that represents the local gravity vector . The tilt angle and the tilt direction are used to place the imaginary line that represents the local gravity vector through the center of the entrance pupil. The imaginary line that represents the local gravity vector could be drawn other places besides through the entrance pupil center based on the tilt angle and tilt direction.

The elevation angle El is the angle between the horizontal line HL and the pointing vector PV. The tilt angle is the angle between the local gravity vector and the y platform axis .

According to one embodiment z platform coordinate system is defined by x y z platform axes or also referred to as axes of the platform coordinate system associated respectively with the three sides of a mobile data collection platform . The mobile data collection platform can be tilted with respect to one or more of the x y and z platform axes and of the platform coordinate system. The tilt angle and tilt direction reflect the tilt of the mobile data collection platform with respect to the one or more x y and z platform axes of the platform coordinate system according to one embodiment.

According to one embodiment the image capturing device is in a known spatial relationship with the mobile data collection platform. For example one or more of the offsets depicted in and or the offsets and in can be used for defining the known spatial relationship between the image capturing device and the mobile data collection platform. According to one embodiment the known spatial relationship is also a known physical relationship or a known physical spatial relationship.

The antenna to entrance pupil center geometric information may be used to translate the GNSS position fix Xpf Ypf Zpf from the antenna to the position of the entrance pupil center or vice versa. Any combination of the GNSS position fix Xpf Ypf Zpf and the position X0 Y0 Z0 of the entrance pupil center can be related to each other using one or more of y axis offset x axis offset and z axis offset .

Referring to one or more of and the GPS position fix is a three dimensional position of and obtained from the antenna in the GNSS coordinate system. As depicted the GPS position fix is Xpf Ypf and Zpf respectively for latitude longitude and altitude. The local gravity vector true north and east are respectively the Z local axis the Y local axis and the X local axis of the local coordinate system. Note that the local coordinate frame and the definition just given are not the same as the coordinate frame for the mobile data collection platform. However data in one coordinate system may be translated into data in the other coordinate system for example using known spatial relationships as discussed herein. X0 Y0 Z0 is the three dimensional position of the entrance pupil center in the local coordinate system. The known spatial relationship between the antenna and the entrance pupil center and the orientation information which includes the tilt angle and tilt direction can be used to translate the GPS position fix Xpf Ypf Zpf into the three dimensional position X0 Y0 Z0 of the entrance pupil center in the local coordinate system. The known spatial relationship also known as antenna to entrance pupil center geometric information between the antenna and the entrance pupil center include one or more of the y axis offset the x axis offset and the z axis offset .

By way of clarification the side view of the mobile data collection platform in shows a reference coordinate system for the platform and for the local coordinate system. This is further exemplified in where the platform coordinates are shown and the world coordinates as defined by the local coordinate system are shown.

According to one embodiment the mobile data collection platform is not required to be level as a part of capturing an image determining a position fix and determining orientation information . The mobile data collection platform may be level if so desired. Leveling may be obtained by adjusting the mobile data collection platform s orientation using a support structure such as a tripod and using the tilt information to determine a 90 degree platform angle relative to the gravity vector. For example when both of the platform axes are 90 degrees relative to the local gravity vector then the mobile data collection platform is level.

However the mobile data collection platform is not required to be level to determine a tilt angle as is necessary in a more conventional total station. Further the tilt angle is obtained directly regardless of any rotation of the mobile data collection platform with respect to the pointing vector. When making measurements of objects on the ground or below the user it may be useful to actually level the platform. In this case both sides of the mobile data collection platform must be perpendicular to the local gravity vector then the mobile data collection platform is level. However since the mobile data collection platform provides orientation information via the 2 or 3 axis accelerometer and orientation system it is not required to be level.

Referring to scale information that may be used as a part of determining a distance between the mobile data collection platform and the point of interest can also be obtained. The scale information may be the depiction of an object which has a known dimension in the captured image. Examples of a known dimension are length width and diameter that are known. For example the dimensions of a ruler or a quarter are known. E.g. a US quarter is 24.3 mm in diameter. In another example a feature that appears in the image may be measured and the measurement may be used as the scale information. More specifically one side of a window a door or side of a building for example that appears in the image could be measured and used as scale information. To do this with a single image capture the camera must be on a pointing vector line that is perpendicular to the midpoint of the scale object. As this is hard to do a second image may be captured and processed photogrammetrically. In yet another example a second image that also depicts the point of interest is captured with the image capturing device at a second location where the first location and the second location are separated by a known distance. In this case the scale information can include one or more of the first and second images the first and second locations such as position fixes and orientations of the mobile data collection platform when the first and second images were captured and the known distance between the first and second locations where the two images were captured. The distance between the first and second locations may be determined from the position fixes obtained at those two locations.

According to one embodiment the scale information is any information that can be used in determining the distance between the point of interest and and the three dimensional location X0 Y0 Z0 of the entrance pupil center . Scale information can also be referred to as distance between point of interest and mobile data collection platform information. 

According to one embodiment scale information can be both the depiction of an object with at least one known dimension in an image and a distance between two positions P1 P2 that two images of a point of interest were captured from.

According to one embodiment a mobile data collection platform includes a user interface that can be displayed on the mobile data collection platform s display . depicts a user interface according to one embodiment.

The user interface includes a crosshair display overlay also referred to as crosshairs and a graphical bubble level overlay also referred to as graphical bubble level or bubble level .

The crosshair display overlay depicts a photographic image of the point of interest . As depicted in the photographic image is not in the center of the intersection of the two crosshairs but instead is slightly down and to the left of the center . If a photographic image of a point of interest is in the center of the crosshair display overlay then the optical axis from the entrance pupil center is in alignment with the point of interest . The pointing vector PV is coaxial with the optical axis according to one embodiment. According to one embodiment if the photographic image of a point of interest appears anywhere in the crosshair display overlay when the user presses the accept data button the point of interest is a user selected point of interest.

According to one embodiment a mobile data collection platform includes a bubble level processing logic and an image capturing device . The better the mobile data collection platform itself is aligned with a point of interest the better the accuracy of the determined position of the point of interest may be. In an embodiment mobile data collection platforms that are equipped with both an image capturing device and a tilt sensor may be used to aid in positioning the image capturing device more precisely over a target point of interest .

Referring now to mobile data collection platform may be held so it is looking downward over the point of interest as is shown in . The image captured depicts according to one embodiment the point of interest the object and the reference point . In accordance with one embodiment the bubble level processing logic provides an aiming pointing aide such as a graphical bubble level overlay with a set of concentric circles or concentric squares or other such visual aide around the center of the graphical bubble level overlay which can be displayed on the display of mobile data collection platform when the image capturing device is activated and displaying an image . According to one embodiment the crosshair display overlay overlays the image displayed on the display . Similarly the tilt sensor may have its output conditioned to display the degree of alignment of the display with a horizontal plane one that is perpendicular to a local gravity vector that represents vertical. That is tilt sensor may be used as an indicator of how level the body of mobile data collection platform is by indicating the tilt angles from vertical in two dimensions left right and up down relative to the view screen of mobile data collection platform when it is held horizontally with the screen of display face up. The coordinates are North South and East West in the coordinate space. Alternatively bubble level processing logic can display a graphical version of a bubble level such as the graphical bubble and the bubble level overlay in which a small circle representing a bubble is constrained to move within a pair of concentric circles emulating a mechanical bubble level. The graphical bubble position as depicted by the bubble within the pair of circles as depicted by the bubble level overlay is moved in proportion to the degree of tilt in the two orthogonal axes of the mobile data collection platform .

In an embodiment a single measurement of the degree of tilt from vertical given in degrees either from vertical or from a horizontal plane from the tilt sensor may be displayed. The direction of the tilt angle as projected on a horizontal plane may be determined from the compass heading when the tilt of the body of the mobile data collection platform is aligned with the major axis of the body of the mobile data collection platform.

In an embodiment better accuracy in locating a desired point of interest may be obtained by incorporating the offset distance e.g. offset of between the entrance pupil center of image capturing device and the location of the GNSS GPS antenna .

In the example depicted in the photographic image of the point of interest is not yet in the exact center of the aiming crosshairs of the crosshair display overlay . Embodiments are well suited to the photographic image of the point of interest being located in the center or not being located in the center as discussed herein. In bubble level processing logic has generated a graphical bubble level overlay to facilitate a user in aligning the mobile data collection platform relative to the local gravity vector.

In accordance with one embodiment bubble level processing logic can incorporate the offset distances and to more precisely determine the coordinates of the point of interest especially when the photographic image of the point of interest is in the center of the crosshair display overlay .

In one embodiment the position of reference point and of mobile data collection platform can be determined using photogrammetric processing of an image captured by mobile data collection platform . For example in accordance with one embodiment mobile data collection platform can access a remotely located database of geo tagged images wherein an image of the reference point is captured by the image capturing device and delivered to the database of geo tagged images for matching using photogrammetric processing. Therefore according to one embodiment the reference point is what is referred to as a georeference point of interest or a georeference feature. A position fix for a location of a georeference point of interest is referred to as a georeference position fix. For more information about georeference points of interest or georeference features and georeference position fix refer to U.S. 2011 0064312 filed on Sep. 14 2009 entitled Image Based Georeferencing by Janky et al and assigned to the assignee of the present application. Once the reference point has been identified in the database the coordinates of reference point can be delivered from the database to mobile data collection platform . The coordinates of the reference point may be three dimensional coordinates.

Object is an object of known width or dimensions that can be used for example as scale information. Since the object has a known width or dimension it can provide a scale that can be used for determining the distance between the point of interest and the mobile data collection platform .

Although has been described in the context of mobile data collection platform embodiments that pertain to are suitable for being used for other mobile data collection platforms such as as described herein.

According to one embodiment the entrance pupil center is one end of the pointing vector and the pseudo point of interest is located at the other end of the pointing vector . Therefore according to one embodiment the pixel or group of pixels that represents the pseudo point of interest would be located at the crosshair display overlay s center .

The crosshairs processing logic receives and processes information with respect to the crosshair display overlay . For example the crosshairs processing logic can receive information indicating that a photographic image of a point of interest is inside of the crosshair display overlay and use the received information to mark the point of interest as a user specified point of interest. In another example the crosshair display overlay can be used to measure how closely the axis with respect to being in alignment with the point of interest . For example if the photographic image is right in the center then the axis is in alignment with the point of interest . If the photographic image is inside of the crosshair display overlay but off center the crosshairs processing logic can measure how far the photographic image is from the center and in what direction. The measurement may be a two dimensional measurement since the crosshair display overlay is two dimensional.

The bubble level processing logic can receive information from the tilt sensor and use the received information to display a graphical visual representation of a bubble inside of the electronic bubble level overlay . According to one embodiment the bubble level that is used according to various embodiments is not a physical or mechanical bubble level that has a physical or mechanical bubble but instead is a bubble level that is displayed in a graphical display also referred to herein as a graphical bubble level .

As depicted in the mobile data collection platform s front is pointing downwards at the ground. However embodiments are well suited to using the mobile data collection platform when the mobile data collection platform s front is facing forward and or perpendicular to the ground for example as depicted in . According to various embodiments the bubble level can be used when the mobile data collection platform is facing downwards as depicted in or facing forward and or perpendicular to the ground as depicted in . For example a user can select between a downward facing mode or a forward facing mode using a graphical user interface displayed on the mobile data collection platform s display . If the downward facing mode is selected then the bubble level can be in a downward facing orientation as depicted in . If the forward facing mode is selected then the bubble level can be used in a forward facing orientation as would be the case for .

According to one embodiment the distance between two positions processing logic obtains the position fixes associated with two locations that a mobile data collection platform took images of a point of interest and determines a distance between the two locations based on the position fixes.

Referring to the image taken with a mobile data collection platform associated with the coordinates X0 Y0 Z0 according to one embodiment includes the point of interest and the object . The object is an object of a known dimension such as one or more of width diameter length that can be used for example as scale information as described herein. For example the object could be a yardstick. The object could be affixed to the wall by the operator of the Mobile Data Collection Platform .

Z0 is the point where the pointing vector PV and the local gravity vector which represents the Z local axis intersect. The tilt angle is the angle between the entrance pupil center and the local gravity vector represented by the Z local axis . The tilt direction indicates the direction the mobile data collection platform is tilted with respect to the local gravity vector . In this example the top of the mobile data collection platform is further back than the bottom of the mobile data collection platform .

The radial distance between distance D and the point of interest may be determined once observations are taken at two spaced apart locations P1 and P2 for the mobile data collection platform. The principles are well known in the photogrammetric arts. As depicted in a first image of the point of interest is taken at position P1 and a second image of the point of interest is taken at position P2. The two positions P1 and P2 are separated by a distance D also referred to as the distance line D K . According to one embodiment the distance between two positions processing logic obtains the position fixes associated with two locations P1 P2 that a mobile data collection platform took images of a point of interest and determines the distance D between the two locations P1 P2 based on the position fixes. Respective first and second orientation information of the mobile data collection platform is associated with the positions P1 and P2. depicts respective pointing vectors PV1 and PV2 from the entrance pupil center to the point of interest for the respective positions P1 and P2.

As depicted in there is a first line from P1 in the direction of true north also referred to as first true north line and a second line from P2 in the direction of true north also referred to as second true north line . The two lines and are parallel to each other since they are both in the direction of true north. Both of the lines and are perpendicular to the line that represents the distance D. These are examples for the sake of explanation. The directions may be arbitrarily chosen.

The three dimensional coordinates of the positions P1 and P2 are GPS positions and are known. The GPS three dimensional coordinates for P1 are X1 Y1 Z1. The GPS three dimensional coordinates for P2 are X2 Y2 Z2. P1 and P2 are three dimensional positions in the GNSS coordinate system. Distance D can be calculated by subtracting the GPS position fixes X1 Y1 Z1 for P1 and X2 Y2 Z2 for P2 using the vector equation D P1 P2.

Referring to the scale information can include one or more of the first image taken from P1 and the second image taken from P2 the first coordinates X1 Y1 Z1 for the location P1 the second coordinates X2 Y2 Z2 for the location P2 the respective orientations of the mobile data collection platform when it captured images at P1 and P2 and the known distance D between the first location P1 and the second location P2.

According to one embodiment scale information can be both the depiction of an object with at least one known dimension in an image and a distance D between two positions P1 P2 that two images of a point of interest were captured from.

The two images position fixes of the MDCP when at positions P1 and P2 orientation information of the MDCP at positions P1 and P2 and the distance D can be stored in the hardware memory .

At the display of the graphical bubble level overlay and graphical bubble on the display is activated.

At tilt and orientation information is obtained. For example the tilt angle and tilt direction can be obtained respectively from the tilt sensor and the compass .

At the display of the bubble on display is updated in real time as new Euler angles are obtained from the tilt sensor .

At a position determination mode is selected. In accordance with one embodiment if no position determination mode is selected the last operating position fix system is automatically selected.

At Euler angles from the tilt sensor are stored for example in hardware memory as the Euler angles become available.

At an image that includes at least one point of interest is captured where an image capturing device that is an integral part of the mobile data collection platform captures the image .

At raw observables for the mobile data collection platform are obtained. For example a GNSS chipset of the mobile data collection platform is accessed and raw observables also referred to as internal raw observables are extracted from the mobile data collection platform s GNSS chipset . In another example the raw observables also referred to as external raw observables are received by the mobile data collection platform from an optional external GNSS raw observables provider . The external GNSS raw observables provider according to one embodiment is physical coupled with the mobile data collection platform thus maintaining a known spatial relationship as described herein. A mobile data collection platform can use the raw observables received from the optional external GNSS raw observables provider even if the mobile data collection platform has an internal GNSS chipset .

The raw observables from either the internal GNSS chipset or the external GNSS raw observables provider are for use outside the internal GNSS chipset and elsewhere in the mobile data collection platform for example in a supl client as discussed herein. Other examples of outside the GNSS chipset and elsewhere in the mobile data collection platform include processing logic and . Examples of for use elsewhere include being executed by a hardware processor that is inside the mobile data collection platform and outside of the GNSS chipset . According to one embodiment the hardware processor executes the processing logic and .

At a position fix of the mobile data collection platform is determined based on the raw observables. For example the raw observables that are extracted from the GNSS chipset can be processed according to various embodiments described herein to determine a position fix Xpf Ypf Zpf. The position fix Xpf Ypf Zpf according to one embodiment provides a location of the mobile data collection platform in a GNSS coordinate system. In another example the position fix may be determined based on the external raw observables that are communicated from the external GNSS raw observables provider .

The position fix Xpf Ypf Zpf that is determined based on the internal raw observables from the internal GNSS chipset defines a location of the antenna . The position fix that is determined based on the external raw observables from the external GNSS raw observables provider defines the location of the antenna .

Various embodiments described herein can be used for smoothing pseudoranges correcting pseudoranges before determining the position fix Xpf Ypf Zpf and or as described herein. Various embodiments can be used for applying locally measured movement information to a position fix Xpf Ypf Zpf and or to determine a locally measured movement smoothed position fix. In this case the position fix is a locally measured movement smoothed position fix. Any embodiments described herein that can be used for improving position determination can be used to improve a position fix Xpf Ypf Zpf and or . depicts examples of processing logic that can be used to improve a position fix by correcting and or smoothing a position fix.

For example if the raw observables that were obtained in are from an internal GNSS chipset then the location would be for the antenna . The offset in this case would be one or more geometric offsets between the entrance pupil center and the antenna and .

However if the raw observables that were obtained in are from the external GNSS raw observables provider then the location would be for the antenna . The offset in this case would be one or more of distances in .

For example the orientation information can be obtained from one or more sensors that are part of the mobile data collection platform . Orientation information can include tilt angle and azimuth angle AZ as discussed herein. According to one embodiment Euler angles are obtained from the tilt sensor and translated into the tilt angle . The azimuth angle AZ can be obtained based on information from the compass .

The tilt angle and the azimuth angle AZ can be determined based on data from an accelerometer type tilt sensor . An accelerometer type tilt sensor is able to determine the tilt angle of the sensor s X and Y axis relative to gravity in addition to determining the tilt angle . The tilt angle is often used to mean both of the sensor s X and Y axis. The magnetic sensor triad of the accelerometer type tilt sensor can then be used to determine the azimuth angle AZ. For more information refer to Tilt Measurement Using a Low g 3 axis Accelerometer published April 2010 document ID 17289 Rev also known as AN3461 from Freescale incorporated herein by reference.

The tilt angle is between the mobile data collection platform and a local gravity vector and the azimuth angle AZ is between true north and a pointing vector PV of the mobile data collection platform. The position fix Xpf Ypf Zpf and or and the orientation information are associated with a three dimensional location X0 Y0 Z0 of the mobile data collection platform when the image was captured. According to one embodiment the three dimensional location X0 Y0 Z0 is the three dimensional position of the entrance pupil center .

The position fix Xpf Ypf Zpf and or and the orientation can be associated with the image by the mobile data collection platform s user holding the mobile data collection platform in the same position during the capturing of the image the determining of the position fix Xpf Ypf Zpf and or and the determining of the orientation according to one embodiment. Examples of orientation are the tilt angle and the tilt direction also known as the azimuth angle . In another example the position fix Xpf Ypf Zpf and or and the orientation information can be associated with the image by simultaneously or nearly simultaneously capturing of the image determining of the position fix and determining of the orientation information . An example of nearly simultaneously is performing the capturing of the image determining of the position fix and determining of the orientation information in a short period of time where user movement is small to non existent. More specifically modern electronics are capable of performing the capturing of the image the determining of the position fix Xpf Ypf Zpf and or and the determining of the orientation information within 0.25 second for example in response to a button of the mobile data collection platform being pressed. Alternatively a timer can be used instead of the button to trigger performing the capturing of the image the determining of the position fix Xpf Ypf Zpf and or and the determining of the orientation information within 0.25 second for example.

One example of scale information is an object depicted in the image where the object has one or more known dimensions. The depiction of the scale information in the image is an example of capturing the scale information. Referring to another example of scale information is the known distance D between two positions P1 P2 where two respective images were captured where both images depict of the point of interest . For example the first image which depicts the point of interest may be captured with an image capturing device from position P1 and the second image which also depicts the point of interest may be captured with the mobile data collection platform from position P2. Examples of capturing the known distance D are a person determining or measuring the distance D or determining the distance D by subtracting a first position fix Xpf Ypf Zpf and or for a the first position P1 from a second position fix Xpf Ypf Zpf and or for the second position P2.

At the image the position fix Xpf Ypf Zpf and or the scale information and the orientation information are stored in hardware memory of the mobile data collection platform . For example the image captured in can be stored in hardware memory as image . The position fix Xpf Ypf Zpf and or that was determined in can be stored in hardware memory as position fix . The orientation information determined in can be stored as orientation information .

The image the position fix Xpf Ypf Zpf and or and the orientation information can be used to determine a location of a point of interest in the image using for example photogrammetry. Photogrammetry is well known in the arts. According to one embodiment the image the position fix and the orientation information can be used to determine a three dimensional location Xpt Ypt Zpt of the point of interest . According to one embodiment the three dimensional location Xpt Ypt Zpt of the point of interest is determined in the local coordinate system.

According to one embodiment the method can be performed for example within a fraction of a second so that the mobile data collection platform is at the position fix Xpf Ypf Zpf and or and in the orientation described by orientation information at the time that the image is captured.

Various embodiments provide for capturing depiction an object with at least one known dimension wherein the image depicts the object with the at least one known dimension.

Various embodiments provide for capturing a first image and a second image that both depict the point of interest wherein the first image is captured from a first position P1 and the second image is captured from a second position P2 and for calculating a distance D between the first position P1 and the second position P2.

According to one embodiment the capturing 3560 of the scale information further comprises calculating a distance D between the first position P1 P2 and the second position.

Various embodiments provide for determining a first position P1 where the first position P1 is selected from a group consisting of a position of a georeference point of interest and a position fix Xpf Ypf Zpf and or of the mobile data collection platform where the point of interest is in a field of view of the image capturing device determining a second position P2 wherein the second position P2 is selected from the group consisting of the position of the georeference point of interest and the position fix Xpf Ypf Zpf and or of the mobile data collection platform where the point of interest in the field of view and determining a reference distance D between the first position P1 and the second position P2.

According to one embodiment the position fix Xpf Ypf Zpf and or is a first position P1 and various embodiments provide for determining a second position P2 of a georeference point of interest and determining a distance D between the first position P1 and the second position P2.

An embodiment provides for determining the orientation information comprising the tilt angle and the azimuth angle wherein the tilt angle is between a y platform axis of the mobile data collection platform and a local gravity vector and the azimuth angle is between a reference direction and a pointing vector of the mobile data collection platform. For example the determined orientation information can include the tilt angle and the azimuth angle AZ wherein the tilt angle is between a y platform axis of the mobile data collection platform and a local gravity vector and the azimuth angle AZ is between a reference direction such as magnetic north or true north and a pointing vector PV of the mobile data collection platform .

According to one embodiment the pointing vector PV is in a known orientation relative to a compass heading such as magnetic north. According to one embodiment the pointing vector PV is aligned with the compass heading.

According to one embodiment the pointing vector PV is aligned with the compass heading. For example the user of the mobile data collection platform can hold the MDCP so that the pointing vector PV is aligned with the compass heading from the compass .

Various embodiments provide for capturing angular displacement from a first point on a scalar reference to a second point on the scalar reference visible in a field of view as given by a pixel count from the first point to the second point. For example the angular displacement from one end of a scalar reference to the other end of the scalar reference visible in the field of view of an image can be captured by counting the pixels from the one end to the other end of the scalar reference .

Various embodiments provide for calibrating the mobile data collection platform by determining a pixel calibration datum providing the angular displacement of each pixel in two dimensions depicted in a calibration image taken with the image capturing device. For example according to one embodiment the mobile data collection platform can be calibrated by determining a pixel calibration datum providing the angular displacement of each pixel in a calibration image in two dimensions where the calibration image is taken with an image capturing device of a pattern .

Various embodiments provide for calibrating the mobile data collection platform by determining an acceptable region in a calibration image taken with the image capturing device where the acceptable region includes a subset of pixels of the calibration image where the pixels do not exceed a specified level of distortion also known as an acceptable level of distortion . For example according to one embodiment the mobile data collection platform is calibrated by determining an acceptable region in a calibration image taken with the image capturing device that includes a subset of the calibration image s pixels that do not exceed an acceptable level of distortion. According to one embodiment the acceptable region includes a subset of the calibration image s pixels because the pixels in the unacceptable region that is between the boundary of the acceptable region and the periphery of the calibration image are not included in the subset.

Various embodiments provide for receiving outline information describing an outline of the point of interest and designating the point of interest as a user specified point of interest based on the outline information. For example according to one embodiment outline information describing an outline of the point of interest is received and the point of interest is designated as a user specified point of interest based on the outline information.

Various embodiments provide for designating the point of interest as a user specified point of interest based on orientation information from crosshairs processing logic associated with the mobile data collection platform when crosshairs are aligned with the point of interest and an image capture button is pressed. For example according to one embodiment designating the point of interest as a user specified point of interest based on orientation information from the orientation system associated with the mobile data collection platform when the crosshairs of the crosshair display overlay are aligned with the point of interest and an image capture button is pressed to capture the image .

Various embodiments provide for designating the point of interest as a user specified point of interest based on an annotation from an image editor associated with the mobile data collection platform. For example according to one embodiment the point of interest is designated as a user specified point of interest based on an annotation from an image editor associated with the mobile data collection platform .

Various embodiments provide for receiving annotation information and associating the annotation information with the image. For example according to one embodiment the annotation information is received and associated with the image . The annotation information can be associated with the image using an EXIF file. The annotation information can be associated with the file using other techniques that are well known in the art such as tables pointers identifiers.

Various embodiments provide for performing feature identification on at least a subset of the image. For example according to one embodiment feature identification is performed on at least a subset of the image .

Various embodiments provide for performing pattern recognition on at least a subset of the image. For example according to one embodiment pattern recognition is performed on at least a subset of the image .

Various embodiments provide for displaying crosshair display overlay on a display of the mobile data collection platform displaying a photographic image of the point of interest in relation to the crosshair display overlay and positioning the photographic image with respect to the crosshair display overlay based on an alignment of an entrance pupil of the mobile data collection platform with the point of interest. For example according to one embodiment crosshair display overlay is displayed on a display of the mobile data collection platform a photographic image of the point of interest positioned in relation to the crosshair display overlay and the photographic image is displayed with respect to the crosshair display overlay based on an alignment of an entrance pupil center of the mobile data collection platform with the point of interest .

Various embodiments provide for displaying a bubble level overlay on a display of the mobile data collection platform displaying a graphical bubble in relation to the bubble level overlay and positioning the graphical bubble with respect to the bubble level overlay based on a degree of tilt of the mobile data collection platform. For example according to one embodiment a bubble level overlay is displayed on a display of the mobile data collection platform a graphical bubble is displayed in relation to the bubble level overlay and the graphical bubble is positioned with respect to the bubble level overlay based on a degree of tilt for example of two orthogonal axes of the mobile data collection platform .

According to various embodiments determining one or more geometric offsets between the entrance pupil and the antenna. For example according to one embodiment one or more geometric offsets such as one or more geometric offsets between the entrance pupil center and the antenna and or one or more of the distances between an antenna of the GNSS raw observables provider and the entrance pupil center can be determined. More specifically the mobile data collection platform may have been configured by the manufacturer to include the one or more geometric offsets or the one or more geometric offsets may have been uploaded into the mobile data collection platform for example into hardware memory. The one or more geometric offsets can be accessed and used according to various embodiments.

According to one embodiment as described herein a mobile data collection platform is a cellular device.

At an image that depicts a point of interest is captured using a cellular device. For example the image that depicts the point of interest may be captured using the image capturing device .

At raw observables are obtained. For example the raw observables may be either internal raw observables obtained from an internal GNSS chipset or external raw observables obtained from an optional external GNSS raw observables provider as described herein.

At a position fix is determined based on the raw observables. For example a position fix Xpf Ypf Zpf may be determined based on internal raw observables obtained at from an internal GNSS chipset as described herein. In another example a position fix may be determined based on external raw observables obtained from an optional external GNSS raw observables provider as described herein.

At a three dimensional position associated with the cellular device is determined based on a local gravity vector and a position fix of the cellular device.

For example the local gravity vector can be determined using the information from the tilt sensor . The position fix Xpf Ypf Zpf according to one embodiment is the location of the antenna . In another example the position fix is the location of the antenna .

An example of a three dimensional position associated with the MDCP is the three dimensional position X0 Y0 Z0 of the entrance pupil center that is determined based on a local gravity vector and a position fix Xpf Ypf Zpf or .

The three dimensional position X0 Y0 Z0 is in the local coordinate system and the local gravity vector is one of the axes of the local coordinate system.

Referring to and the local gravity vector true north and east respectively are the Z local axis also known as the local gravity vector the Y local axis and the X local axis for the local coordinate system. The GPS position fix Xpf Ypf Zpf is a three dimensional position of the antenna in the GNSS coordinate system. The entrance pupil center has a three dimensional position X0 Y0 Z0 in the local coordinate system. One or more of the antenna to entrance pupil center geometric information such as one or more geometric offsets the tilt angle the tilt direction and the local gravity vector can be used to translate the GPS position fix Xpf Ypf Zpf in the GNSS coordinate system into the entrance pupil center s three dimensional location X0 Y0 Z0 in the local coordinate system.

In another example a GPS position fix can be determined based on raw observables obtained from an optional external GNSS raw observables provider . One or more of the antenna to entrance pupil center geometric information such as one or more of distances between an antenna of the optional external GNSS raw observables provider and the entrance pupil center of the MDCP the tilt angle the tilt direction and the local gravity vector can be used to translate the GPS position fix in the GNSS coordinate system into the entrance pupil center s three dimensional location X0 Y0 Z0 in the local coordinate system.

Other examples of a three dimensional position that can be used are the locations of the antenna or the antenna . For example the tilt angle the tilt direction and the local gravity vector can be used to translate a position fix of either antenna or antenna into the local coordinate system.

One example of scale information is an object depicted in the image where the object has one or more known dimensions. The depiction of the scale information in the image is an example of capturing the scale information. Referring to another example of scale information is the known distance D between two positions P1 P2 where two respective images were captured where both images depict of the point of interest . For example the first image which depicts the point of interest may be captured with an image capturing device from position P1 and the second image which also depicts the point of interest may be captured with the image capturing device from position P2. Examples of capturing the known distance D are a person determining or measuring the distance D or determining the distance D by subtracting a first position fix of the MDCP for a the first position P1 from a second position fix of the MDCP for the second position P2.

At the image the scale information and the three dimensional position are stored in hardware memory. For example the image captured in the scale information captured in and the three dimensional position X0 Y0 Z0 determined in can be stored in hardware memory of the mobile data collection platform .

The MDCP is at the three dimensional position when the image is captured. According to various embodiments the location of the entrance pupil center the antenna or the antenna can be used as the three dimensional position that is determined in . Therefore the entrance pupil center the antenna or the antenna is at the three dimensional position when the image is captured.

The MDCP is not required to be perpendicular to the local gravity vector at the time of collecting of data. For example none of the platform axis of cellular device z00 are required to be perpendicular to the local gravity vector at the time of the capturing of the image and the determining of the three dimensional position X0 Y0 Z0.

According to one embodiment the method can be performed for example within a fraction of a second so that the mobile data collection platform is at the position fix which would be of either antenna or antenna and in the orientation described by orientation information at the time that the image is captured.

According to various embodiments method is performed by a mobile data collection platform and outside of the internal GNSS chipset . Although many embodiments are described herein in the context of a mobile data collection platform various embodiments are also well suited for mobile data collection platform .

Either method or can be used with use cases depicted in . Either method or can be used for performing data collection at position P1 and position P2 as depicted in . For example method or could be used at position P1 to perform data collection and used at position P2 to perform data collection.

According to one embodiment capturing an item such as an image scale information distance angular displacement and so on includes storing the item for example in hardware memory such as hardware memory .

Referring to and according to one embodiment the tilt angle is between the mobile data collection platform and a local gravity vector and the azimuth angle AZ is between a reference direction such as true north and a pointing vector PV of the mobile data collection platform .

Various embodiments provide for obtaining a tilt angle and a tilt direction of the cellular device and determining the three dimensional position associated with the cellular device based at least in part on the tilt angle and the tilt direction in relation to the local gravity vector. For example according to one embodiment a tilt angle and a tilt direction of the MDCP are obtained and the three dimensional position X0 Y0 Z0 associated with the MDCP is determined based at least in part on the tilt angle and the tilt direction in relation to the local gravity vector .

Various embodiments provide for determining the three dimensional position associated with the cellular device based at least in part on geometric information relating an antenna of the cellular device with an entrance pupil center of the cellular device. For example according to one embodiment the three dimensional position X0 Y0 Z0 associated with the MDCP is determined based at least in part on geometric information such as relating an antenna of the MDCP with an entrance pupil center of the MDCP for example as depicted in and . In another example the three dimensional position X0 Y0 Z0 associated with the MDCP is determined based at least in part on geometric information such as relating an antenna of the GNSS raw observables provider with the entrance pupil center as depicted in and .

Various embodiments provide for designating the point of interest as a user specified point of interest based on information selected from a group consisting of annotation from an image editor an outline of the point of interest and a photographic image of the point of interest being visibly displayed within crosshair display overlay. For example according to one embodiment the point of interest is designated as a user specified point of interest based on information selected from a group consisting of annotation from an image editor an outline of the point of interest and a photographic image of the point of interest being visibly displayed within crosshair display overlay .

Various embodiments provide for displaying crosshair display overlay on a display of the cellular device displaying a photographic image of the point of interest in relation to the crosshair display overlay and positioning the photographic image with respect to the crosshair display overlay based on an alignment of an entrance pupil of the cellular device with the point of interest. For example according to one embodiment crosshair display overlay is displayed on a display of the MDCP a photographic image of the point of interest is positioned in relation to the crosshair display overlay and the photographic image is displayed with respect to the crosshair display overlay based on an alignment of an entrance pupil center of the MDCP with the point of interest .

Various embodiments provide for displaying a bubble level overlay on a display of the cellular device displaying a graphical bubble in relation to the bubble level overlay and positioning the graphical bubble with respect to the bubble level overlay based on a degree of tilt of the cellular device. For example according to one embodiment a bubble level overlay is displayed on a display of the mobile data collection platform a graphical bubble is displayed in relation to the bubble level overlay and the graphical bubble is positioned with respect to the bubble level overlay based on a degree of tilt for example of two orthogonal axes of the MDCP .

Various embodiments provide for determining a first position wherein the first position is selected from a group consisting of a position of a georeference point of interest and a position fix of the cellular device determining a second position wherein the second position fix is selected from the group consisting of the position of the georeference point of interest and the position fix of the cellular device and determining a distance between the first position and the second position. For example according to one embodiment a first position and a second position are determined where the first position and the second position are selected from a group consisting of a position of a georeference point of interest and a position fix Xpf Ypf Zpf of the mobile data collection platform and determining a distance between the first position and the second position.

Various embodiments provide for determining a known spatial relationship between an entrance pupil center of the cellular device and an antenna of the cellular device based on one or more geometric offsets between the entrance pupil center and the antenna. For example according to one embodiment a known spatial relationship between an entrance pupil of the image capturing device and an antenna of the cellular device is determined based on one or more geometric offsets between the entrance pupil center and the antenna and .

According to one embodiment the MDCP is not required to be perpendicular to the local gravity vector at the time that any of the operations depicted in flowchart or are performed.

The mobile data collection platform includes a bus various types of software one or more hardware processors computer usable non volatile memory ROM computer usable volatile memory RAM hardware memory that includes data a display a graphical user interface GUI input output device platform orientation system cellular communications other communications receivers image capturing device bubble level system and short range communications .

The bus is connected with the one or more processors the ROM the RAM the memory the display the GUI the input output device the platform orientation system the cellular communications the other communications receivers the image capturing device the bubble level system and the short range communications . The MDCP can communicate with an optional external GNSS raw observables provider and a peripheral computer readable storage media .

Examples of software are an operating system applications and modules . Examples of an operating system applications modules include at least operating systems applications and modules as discussed herein.

The memory stores data . Examples of data include one or more images one or more position fixes orientation information and any other type of data that may be used by an MDCP or that is described herein or a combination thereof.

The ROM RAM and the memory is for storing information and instructions for the one or more processors .

The display may be a liquid crystal device cathode ray tube plasma display device or other display device suitable for creating graphic images and alphanumeric characters recognizable to a user.

The GUI includes the graphical user interface . The GUI may include other types of GUIs that may be used with an MDCP .

The input output device is for coupling the MDCP with external entities. For example in one embodiment I O device is a modem for enabling wired or wireless communications between an MDCP and an external network such as but not limited to the Internet.

Examples of other communications receivers are satellite radio terrestrial radio digital radio analog radio Wi Fi and Bluetooth protocol.

The peripheral computer readable storage media can be connected with the bus . Examples of peripheral computer readable storage media are a disk DVD or CD.

According to one embodiment an external GNSS raw observables provider provides higher quality reception of GNSS satellite signals than the GNSS chipset that is internal the cellular device of a mobile data collection platform . For example in typical GNSS antennae currently used in cellular devices the GNSS antennae are usually configured for linear polarization and not a circularly polarized design. This results in a significant loss of signal from orbiting GNSS satellites at least 3 dB. However according to one embodiment the external GNSS raw observables provider utilizes a circularly polarized GNSS antenna such as a patch antenna quadrifilier helix antenna and planar quadrifiler antenna. The circularly polarized GNSS antenna of the external GNSS raw observables provider has higher quality reception than linearly polarized antenna of an MDCP. Although many cellular devices antennas such as antenna are linearly polarized embodiments are well suited for cellular devices with high quality antennas such as antennas with a circularly polarized design.

The optional external GNSS raw observables provider can communicate with the MDCP via the short range communications . The external GNSS raw observables provider can receive raw observables communicate the raw observables to the MDCP and the MDCP can determine a position fix based on the raw observables from the external GNSS raw observables provider . The raw observables from the external GNSS satellite system are also referred to herein as external raw observables since they are received from a GNSS raw observables provider that is external to the MDCP . The raw observables obtained from the GNSS chipset that is internal to the MDCP shall be referred to as internal raw observables. 

The external raw observables from the external GNSS raw observables provider can include raw pseudoranges and one or more of real carrier phase information and Doppler Shift Information. The raw pseudoranges the real carrier phase information and the Doppler Shift Information from the external GNSS raw observables provider shall be called respectively external raw pseudoranges external Doppler Shift Information and external real carrier phase information. The MDCP can process the external raw observables according to various embodiments described herein to provide a position fix . The MDCP can use the external raw observables to determine a position fix for example instead of the internal raw observables from the GNSS chipset that is part of the MDCP . The external raw pseudoranges can be corrected or smoothed or a combination thereof as described herein. A position fix determined based on uncorrected unsmoothed external raw pseudoranges corrected unsmoothed external raw pseudoranges uncorrected smoothed external raw pseudoranges corrected smoothed external raw pseudoranges can be smoothed using locally measured movement information as described herein. The external raw pseudoranges can be smoothed using either the external Doppler Shift Information or the external real carrier phase information according to various embodiments described herein. A position fix that is determined based on external raw observables can be stored as position fix .

According to one embodiment the external GNSS raw observables provider has the type of GNSS chipset that is used in cellular devices. Therefore the GNSS chipset in the GNSS raw observables provider and the GNSS chipset in the mobile data collection platform may provide the same functionality. The GNSS chipset in the GNSS raw observables provider may provide more accuracy as is known in the GNSS receiver art than the GNSS chipset in the mobile data collection platform . An example of an optional external GNSS raw observables provider according to one embodiment is a GNSS receiver positioning system described in U.S. patent application Ser. No. 14 134 437 by Large et al. entitled GNSS Receiver Positioning System filed Dec. 19 2013.

The known spatial relationship can be one or more distances also known as offsets between an antenna of the GNSS raw observables provider and the entrance pupil center of the MDCP along respective x platform axis y platform axis and z platform axis . More specifically there may be a first distance between the GNSS raw observables provider and the entrance pupil center of the MDCP along the x platform axis a second distance between the GNSS raw observables provider and the entrance pupil center of the MDCP along the y platform axis and a third distance between the GNSS raw observables provider and the entrance pupil center of the MDCP along the z platform axis . One or more of these distances and can be used as a known spatial relationship between the GNSS raw observables provider and the MDCP . Therefore various embodiments provide for receiving external raw observables from an external GNSS raw observables provider that is external to the mobile data collection platform wherein an antenna of the external GNSS raw observables provider and an entrance pupil center of the mobile data collection platform are in a known spatial relationship and . A position fix that is determined based on external raw observables one or more of the distances the tilt angle and the tilt direction can be used to determine the three dimensional position X0 Y0 Z0 of the entrance pupil center in the local coordinate system according to various embodiments described herein.

Various embodiments provide a mobile data collection platform system the mobile data collection platform system comprising the mobile data collection platform that includes a cellular device that includes an antenna a display and an internal Global Navigation Satellite System GNSS chipset wherein the antenna receives GNSS positioning signals that define a location of the antenna and wherein the display is for displaying images an image capturing device that captures an image through an entrance pupil of the mobile data collection platform an orientation system that includes a tilt sensor and a compass and determines orientation information that includes tilt angle obtained from the tilt sensor and heading information obtained from the compass wherein the tilt angle is between the mobile data collection platform and a local gravity vector and the heading information is an azimuth angle AZ between a pointing vector PV of the image capturing device and a reference direction hardware memory that stores the image a position fix Xpf Ypf Zpf and the orientation information and one or more hardware processors that executes instructions which receive raw observables from the internal GNSS chipset capture the image with the image capturing device wherein the image depicts a point of interest and wherein the image is captured while the antenna is at the location determine the position fix associated with the mobile data collection platform based on the raw observables wherein the position fix provides the location of the antenna in a GNSS coordinate system calculate a location of the entrance pupil as an offset such as one or more geometric offsets from the location of the antenna access the orientation information from the orientation system wherein the orientation information and heading information are associated with a three dimensional location such as the position fix Xpf Ypf Zpf or the three dimensional location X0 Y0 Z0 of the entrance pupil of the mobile data collection platform when the image was captured and store the image the position fix and the orientation information and heading information in the hardware memory of the mobile data collection platform wherein the hardware memory and the one or more hardware processors are outside of the internal GNSS chipset. Examples of a reference direction are true north magnetic north or a reference target at a known location from which the direction vector can be determined for example using vector algebra.

A mobile data collection platform system the mobile data collection platform system comprising an external Global Navigation Satellite System GNSS raw observables provider includes an antenna wherein the antenna receives GNSS positioning signals that define a location of the antenna wherein the external GNSS raw observables provider is external to and physically coupled with a mobile data collection platform the mobile data collection platform that includes a cellular device that includes a display for displaying images and an internal GNSS chipset an image capturing device that captures an image through an entrance pupil of the mobile data collection platform an orientation system that includes a tilt sensor and a compass and determines orientation information that includes tilt angle obtained from the tilt sensor and heading information obtained from the compass wherein the tilt angle is between the mobile data collection platform and a local gravity vector and the heading information is an azimuth angle AZ between a pointing vector PV of the image capturing device and a reference direction such as true north depicted in depicted in magnetic north or a reference target at a known location from which a direction vector can be determined hardware memory that stores the image a position fix and the orientation information and one or more hardware processors that executes instructions which receive external raw observables from the external GNSS raw observables provider capture the image with the image capturing device wherein the image depicts a point of interest and wherein the image is captured while the antenna is at the location determine the position fix associated with the mobile data collection platform based on the external raw observables wherein the position fix provides the location of the antenna in a GNSS coordinate system calculate a location of the entrance pupil as an offset such as one or more of the distances in of the location of the antenna access the orientation information from the orientation system wherein the orientation information and heading information AZ are associated with a three dimensional location such as the position fix or the three dimensional location X0 Y0 Z0 of the entrance pupil of the mobile data collection platform when the image was captured and store the image the position fix and the orientation information and the heading information AZ in the hardware memory of the mobile data collection platform wherein the hardware memory and the one or more hardware processors are outside of the internal GNSS chipset . Examples of a reference direction are true north magnetic north or a reference target at a known location from which the direction vector can be determined for example using vector algebra.

According to one embodiment the raw observables include raw pseudoranges and at least one of real carrier phase information and Doppler Shift Information. For example the pseudoranges and the at least one real carrier phase information and Doppler Shift Information may be internal raw observables from an internal GNSS chipset or the pseudoranges and the at least one real carrier phase information and Doppler Shift Information may be external raw observables from an external GNSS raw observables provider .

According to one embodiment the image capturing device is embedded in the cellular device as an integrated subsystem in a known location relative to a GNSS antenna of the cellular device. For example the image capturing device is embedded in the cellular device as an integrated subsystem in a known location relative to a GNSS antenna of the cellular device . For example offsets depicted in and can be used for determining the known location.

According to one embodiment the display emulates a pair of crosshairs indicative of an axial direction of an entrance pupil of the image capturing device when displaying the image. For example the display emulates a pair of crosshairs of the crosshair display overlay indicative of an axial direction of an entrance pupil center of the image capturing device when displaying the image .

According to one embodiment the mobile data collection platform includes a graphical user interface and wherein the mobile data collection platform further comprise a bubble level processing logic coupled with the orientation system that displays a virtual representation of a bubble level on the display. For example the mobile data collection platform includes a graphical user interface . The mobile data collection platform includes bubble level processing logic coupled with the orientation system that displays a virtual representation of a bubble level on the display .

According to one embodiment a position of a virtual representation of a bubble on the display is determined based on the orientation of the mobile data collection platform. For example a position of a virtual representation of a bubble on the display is determined based on the orientation of the mobile data collection platform . More specifically if the mobile data collect platform is level the virtual representation of the bubble will be in the center of the graphical bubble level overlay . However if the mobile data collect platform is tilting in one or more directions then the virtual representation of the bubble will move in a direction that corresponds with the one or more directions that the mobile data collection platform is tilting. For example the graphical user interface emulates a mechanical bubble level.

According to one embodiment the virtual representation of the bubble is visible when a tilt angle from the orientation system is less than a selected number in the range from 1 to 10 degrees from a horizontal reference. For example the virtual representation of the bubble is visible when a tilt angle from the inertial orientation system is less than a specified number in the range from 1 to 10 degrees from a horizontal reference. An example of a horizontal reference is a plane such as horizontal plane HP or a line such as second line HL that is perpendicular to the local gravity vector.

According to one embodiment the hardware processor executes instructions that provide smoothed pseudoranges by smoothing raw pseudoranges based on carrier phase information wherein the raw observables include the raw pseudoranges provide corrected smoothed pseudoranges by correcting the smoothed pseudoranges based on external corrections and determine the position fix Xpf Ypf Zpf and or based on the corrected smoothed pseudoranges.

According to one embodiment the hardware processor executes instructions that receive tilt angle information such as information about tilt angle from an at least one tilt sensor associated with the inertial orientation system receive azimuth angle information such as information about azimuth angle AZ from an azimuth sensor such as compass and determine a direction of a pointing vector PV emanating from an entrance pupil of the image capturing device . The tilt angle information and the azimuth angle information can be used to define the orientation of the mobile data collection platform relative to a local gravity vector .

According to one embodiment the image depicts an object with a known dimension. The object may be a coin a ruler or a yardstick for example which was placed in the field of view. The object may be a feature in the field of view that was not purposely placed there. For example the object may be the side of a window or a door where the length of the side is known and therefore be used as scale information.

According to one embodiment the location is a first location P1 the image is a first image the position fix is a first position fix and the orientation information is first orientation information. Further according to one embodiment the one or more hardware processors further execute instructions that capture a second image with the image capturing device wherein the second image includes the point of interest determine a second position fix of the mobile data collection platform wherein the second position fix provides a second location P2 of the antenna in the GNSS coordinate system access second orientation information from the orientation system wherein the second orientation information includes a second tilt angle and a second azimuth angle that corresponds with the mobile data collection platform when the second image was captured and store the second image the second position fix and the second orientation information in the hardware memory .

According to one embodiment the hardware processor executes instructions that calculates a distance D between the first location P1 and the second location P2 by calculating a difference between the first position fix for location P1 and the second position fix for location P2 wherein the distance D is scale information and stores the distance D in the hardware memory .

According to one embodiment the mobile data collection platform includes a tilt sensor and a compass the tilt sensor determines a tilt angle and the compass determines an azimuth angle AZ .

In the event that the obtained raw observables are from an external GNSS raw observables provider according to one embodiment the antenna is a first antenna the GNSS positioning signals are first GNSS positioning signals and wherein the cellular device further comprises a second antenna that receives second GNSS positioning signals that defines a location of the second antenna wherein the external GNSS raw observables provider and the internal GNSS chipset are separate from each other.

According to one embodiment the mobile data collection platform receives external raw observables from an external GNSS raw observables provider that is external to the mobile data collection platform wherein an antenna of the external GNSS raw observables provider and an entrance pupil center of the mobile data collection platform are in a known spatial relationship as described herein.

According to one embodiment the antenna is a first antenna the GNSS positioning signals are first GNSS positioning signals and wherein the cellular device further comprises a second antenna that receives second GNSS positioning signals that defines a location of the second antenna wherein the external GNSS raw observables provider and the internal GNSS chipset are separate from each other.

According to one embodiment the hardware processor further executes instructions that determine a location of the entrance pupil center based on the known spatial relationship such as one or more of distances or one or more geometric offsets between the antenna and the entrance pupil center .

Unless otherwise specified any one or more of the embodiments described herein can be implemented using non transitory computer readable storage medium and computer readable instructions which reside for example in computer readable storage medium of a computer system or like device. The non transitory computer readable storage medium can be any kind of physical memory that instructions can be stored on. Examples of the non transitory computer readable storage medium include but are not limited to a disk a compact disk CD a digital versatile device DVD read only memory ROM flash and so on. As described above certain processes and operations of various embodiments of the present invention are realized in one embodiment as a series of computer readable instructions e.g. software program that reside within non transitory computer readable storage memory of a computer system and are executed by the hardware processor of the computer system. When executed the instructions cause a computer system to implement the functionality of various embodiments of the present invention. For example the instructions can be executed by a central processing unit associated with the computer system. According to one embodiment the non transitory computer readable storage medium is tangible.

Unless otherwise specified one or more of the various embodiments described in the context of can be implemented as hardware such as circuitry firmware or computer readable instructions that are stored on non transitory computer readable storage medium. The computer readable instructions of the various embodiments described in the context of can be executed by a hardware processor such as central processing unit to cause a computer system to implement the functionality of various embodiments. For example according to one embodiment various embodiments described herein are implemented with computer readable instructions that are stored on computer readable storage medium that can be tangible or non transitory or a combination thereof.

The blocks that represent features in can be arranged differently than as illustrated and can implement additional or fewer features than what are described herein. Further the features represented by the blocks in can be combined in various ways. The mobile data collection platform and can be implemented using hardware hardware and software hardware and firmware or a combination thereof. Further unless specified otherwise various embodiments that are described as being a part of the mobile data collection platform whether depicted as a part of the mobile data collection platform or not can be implemented using hardware hardware and software hardware and firmware or a combination thereof.

The above illustration is only provided by way of example and not by way of limitation. There are other ways of performing the method described by the flowchart depicted herein.

Although specific operations are disclosed in various flowcharts depicted herein such operations are exemplary. That is embodiments of the present invention are well suited to performing various other operations or variations of the operations recited in the flowcharts. It is appreciated that the operations in the flowcharts may be performed in an order different than presented and that not all of the operations in the flowcharts may be performed.

The operations depicted in depicted in the flowcharts herein can be implemented as computer readable instructions hardware or firmware. According to one embodiment a mobile data collection platform and can perform one or more of the operations depicted in flowcharts herein.

The embodiments described herein transform data or modify data to transform the state of a mobile data collection platform for at least the reason that by extracting pseudorange information from a GNSS chipset for use elsewhere the state of the mobile data collection platform is transformed from an entity that is not capable of determining a position fix itself into a mobile data collection platform that is capable of determining a position fix itself. In another example embodiments described herein transform the state of a mobile data collection platform and from not being capable of providing an improved accuracy position fix to being capable of providing an improved accuracy position fix.

Example embodiments of the subject matter are thus described. Although the subject matter has been described in a language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

Various embodiments have been described in various combinations and illustrations. However any two or more embodiments or features may be combined. Further any embodiment or feature may be used separately from any other embodiment or feature. Phrases such as an embodiment one embodiment among others used herein are not necessarily referring to the same embodiment. Features structures or characteristics of any embodiment may be combined in any suitable manner with one or more other features structures or characteristics.

