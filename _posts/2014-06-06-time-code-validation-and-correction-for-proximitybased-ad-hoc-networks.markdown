---

title: Time code validation and correction for proximity-based ad hoc networks
abstract: A system and method is described herein for managing power consumption by a plurality of sensors in a proximity-based ad hoc network. The system and method receives sensor data that is provided from a plurality of sensors and constructs a proximity-based ad hoc network among the plurality of sensors based on the sensor data. The system and method also receives and analyzes power status information from each sensor in a group of spatially and temporally proximate sensors in the proximity-based ad hoc network. Based on the analysis, the system and method then modifies a manner in which at least one sensor in the group provides sensor data.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09467808&OS=09467808&RS=09467808
owner: Yahoo! Inc.
number: 09467808
owner_city: Sunnyvale
owner_country: US
publication_date: 20140606
---
The present invention generally relates to systems and methods for validating and correcting time codes generated by devices in a network such as devices in a proximity based ad hoc network.

Location based services are services that provide location specific content or assistance to users. Location based services typically depend on the ability to track the location of a user device or object a process that is sometimes referred to as positioning. Some examples of location based services include personal navigation resource location resource trucking proximity based notification location based billing and emergency services.

Various systems currently exist for automatically determining the location of a user device or object. These systems include for example the Global Positioning System GPS WiFi based positioning systems cellular telephony based positioning systems and Bluetooth based positioning systems. Each of these systems provides its own set of relative advantages and disadvantages. For example GPS can provide extremely precise location estimates but does not work well in indoor environments or in areas prone to multipath effects such as urban canyons. WiFi based positioning systems work better than GPS in indoor environments but require that the user be within transmission range of a number of wireless access points in order to operate. Cellular telephony based and Bluetooth based positioning systems have their own advantages and disadvantages as well.

Although multiple type of positioning systems exist networks and telecommunications carriers typically adopt only one type of system for the provision of location based services. Thus users of each network carrier must live with the particular set of disadvantages associated with the type of positioning system that is adopted. This may include for example the generation of unreliable location information at certain times or under certain conditions or the generation of location information having limited or divergent granularity.

Furthermore since different network carriers use different positioning technology there is presently a lack of sophisticated location based services for users that extend across multiple network or carriers. Additionally there exists no system that can advantageously connect and leverage these various sources of location information each of which may be producing location information in a different manner and having a different format to produce an improved or more comprehensive set of location information. Indeed since the beacons associated with certain positioning systems namely WiFi based cellular telephony based and Bluetooth based positioning systems have very different transmission ranges and signal strengths there is a strong incentive to maintain information generated by these systems in separate information silos.

What is needed then is a system and method that can leverage the information generated by a variety of different sensor enabled devices and objects included sensor enabled devices objects associated with different types of positioning systems and with different networks and carriers to generate a database of real time device object locations that can be used for the provision of location based services and other types of services. The desired system and method should advantageously be configured to leverage time codes embedded in the information generated by the sensor enabled devices objects to achieve this end. Furthermore the desired system and method should advantageously be configured to validate and or correct time codes generated by the sensor enabled devices objects to improve the integrity of such time code information and any location information generated therefrom.

A system and method is described herein for validating and correcting time codes generated by a plurality of sensor enabled devices and objects wherein such time codes are used to establish a proximity based ad hoc network among the devices objects referred to herein for simplicity as sensors . The system and method leverages information concerning the temporal and spatial proximity of sensors in the ad hoc network to perform this function. In one embodiment collaborative filtering is applied to time codes generated by co located sensors to validate and or correct the time codes generated by those sensors. In another embodiment geographic location information associated with or propagated among certain sensors in the ad hoc network is used to obtain a local time that can then be used to correct and validate time codes generated by co located sensors. In either embodiment the detection of an incorrect time code may be addressed by implementing a time code offset for a particular sensor and or by automatically or manually modifying the state of a clock associated with the sensor.

In particular a method for correcting time codes generated by a plurality of sensors is described herein. In accordance with the method sensor data is received from each sensor in the plurality of sensors wherein the sensor data received from each sensor includes a time code generated by the sensor. A proximity based ad hoc network is then constructed among the plurality of sensors based on the received sensor data. The time codes generated by a group of spatially proximate sensors in the proximity based ad hoc network are then analyzed. Based on the analysis a time code generated by at least one sensor in the group is modified.

In accordance with the foregoing method analyzing the time codes generated by the group may include assigning a confidence value to each of the time codes generated by the group. A confidence value may be assigned to a time code based at least in part on the number of sensors in the group that generated that time code and or on an indicator of the reliability of a sensor that generated that time code. Modifying a time code generated by at least one sensor in the group based on the analysis may include selecting one of the time codes generated by the group based on the confidence values and replacing a time code generated by at least one sensor in the group by the selected time code.

The foregoing method may further include applying an offset to subsequently received rime codes generated by the at least one sensor in the group automatically modifying a state of a clock associated with the at least one sensor in the group or notifying a user of the at least one sensor in the group that a state of a clock associated with the sensor should be modified.

A system is also described herein. The system includes a communications manager a location tracking manager and a time code manager. The communications manager is configured to receive sensor data from each sensor in a plurality of sensors wherein the sensor data received from each sensor includes a time code generated by the sensor. The location tracking manager configured to construct a proximity based ad hoc network among the plurality of sensors based on the received sensor data. The time code manager configured to analyze the time codes generated by a group of spatially proximate sensors in the proximity based ad hoc network and to modify a time code generated by at least one sensor in the group based on the analysis.

In the foregoing system the time code manager may be configured to assign a confidence value to each of the time codes generated by the group to select one of the time codes generated by the group based on the confidence values and to replace a time code generated by at least one sensor in the group by the selected time code. The time code manager may be configured to assign a confidence value to each of the time codes generated by the group based at least in part on the number of sensors in the group that generated that time code or on an indicator of the reliability of a sensor that generated that time code.

The time code manager may be further configured to apply an offset to subsequently received time codes generated by the at least one sensor in the group to automatically modify a state of a clock associated with the at least one sensor in the group or to notify a user of the at least one sensor in the group that a state of a clock associated with the sensor should be modified.

An additional method for correcting time codes generated by a plurality of sensors is also described herein. In accordance with the method sensor data is received from each sensor in the plurality of sensors wherein the sensor data received from each sensor includes a time code generated by the sensor. A proximity based ad hoc network is then constructed among the plurality of sensors based on the received sensor data. A geographic location of a first sensor in the proximity based ad hoc network is then determined and local time information is obtained based on the geographic location of the first sensor. The local time information is then used to correct a time code generated by a second sensor that is spatially proximate to the first sensor in the proximity based ad hoc network.

The foregoing method may further include applying an offset to subsequently received time codes generated by the second sensor automatically modifying a state of a clock associated with the second sensor or notifying a user of the second sensor that a state of a clock associated with the second sensor should be modified.

An additional system is described herein. The system includes a communications manager a location tracking manager and a time code manager. The communications manager is configured to receive sensor data from each sensor in a plurality of sensors wherein the sensor data received from each sensor includes a time code generated by the sensor. The location tracking manager is configured to construct a proximity based ad hoc network among the plurality of sensors based on the received sensor data and to determine a geographic location of a first sensor in the proximity based ad hoc network. The time code manager is configured to obtain local time information based on the geographic location of the first sensor and to use the local time information to correct a time code generated by a second sensor that is spatially proximate to the first sensor in the proximity based ad hoc network.

In the foregoing system the time code manager may be further configured to apply an offset to subsequently received time codes generated by the second sensor to automatically modify a state of a clock associated with the second sensor or to notify a user of the second sensor that a state of a clock associated with the second sensor should be modified.

Further features and advantages of the invention as well as the structure and operation of various embodiments of the invention are described in detail below with reference to the accompanying drawings. It is noted that the invention is not limited to the specific embodiments described herein. Such embodiments are presented herein for illustrative purposes only. Additional embodiments will be apparent to persons skilled in the relevant art s based on the teachings contained herein.

The features and advantages of the present invention will become more apparent from the detailed description set forth below when taken in conjunction with the drawings in which like reference characters identify corresponding elements throughout. In the drawings like reference numbers generally indicate identical functionally similar and or structurally similar elements. The drawing in which an element first appears is indicated by the leftmost digit s in the corresponding reference number.

First interface is configured to allow users to interact with LBS delivery engine for the purpose of specifying whether or not they wish to opt in to receive location based services from LBS delivery engine . First interface may be further configured to allow a user to specify which location based services should be provided to the user and to specify preferences concerning how such services should be delivered. First interface may be still further configured to allow a consumer to specify preferences concerning the manner in which one or more sensor enabled devices or objects associated with the user are to be tracked by LBS delivery engine . In one embodiment of the present invention first interface comprises an application programming interface API that can be used to build applications by which user systems devices may interact with LBS delivery engine although the invention is not so limited.

Second interface is configured to allow location based services providers to interact with LBS delivery engine for the purpose of providing location specific services and or content to registered users of LBS delivery engine . Second interface may also be configured to perform other functions to be described in more detail herein. In one embodiment of the present invention second interface comprises an API that can be used to build applications by which systems owned or operated by location based services providers may interact with LBS delivery engine although the invention is not so limited.

LBS delivery engine is a system that is configured to track the location of sensor enabled devices and objects associated with users over time and to use this location information to support the provision of location based services and content to those users. As will be described in more detail herein LBS delivery engine is configured to perform the location tracking function in part by receiving sensor data from sensor enabled devices objects over sensor network and by constructing a proximity based ad hoc network among the sensor enabled devices objects based on this sensor data. In one embodiment the location based services and content delivered by LBS delivery engine are also delivered over sensor network although this need not be the case.

Sensor enabled devices objects are intended to represent any device or object that can include sensing technology including but not limited to handheld user devices e.g. mobile telephones personal digital assistants handheld computers media players handheld navigation devices handheld scanners cameras vehicles e.g. automobiles airplanes trucks trains office equipment e.g. computers printers copiers appliances inventory freight parcels or commercial products to name only a few. The sensing technology may include but is not limited to WiFi sensing technology cellular telephone sensing technology Bluetooth sensing technology or radio frequency identification RFID sensing technology.

Communication between LBS delivery engine and sensor network takes place over third interface . In one embodiment of the present invention third interface comprises an API that can be used to build applications by which sensor enabled devices objects can communicate with LBS delivery engine although the invention is not so limited.

User interface is a component that is configured to allow a user to interact with LBS delivery engine from a remote location for the purpose of specifying whether or not the consumer wishes to receive location based services from LBS delivery engine and to optionally specify preferences concerning the manner in which such services are to be delivered. User interface may also be configured to allow a user to provide information relating to the manner in which one or more devices or objects associated with the user are to be tracked by LBS delivery engine . Information provided by a user via user interface is stored in user data database . User interface may be implemented using a Web service and a standard set of Web APIs for utilizing the Web service. Web applications built upon the Web service may be published by an entity that owns and or operates LBS delivery engine or by other entities. Such Web applications are accessed by users using Web browsers in a well known fashion.

The system device used by the user to interact with user interface may be one of sensor enabled devices depicted in or some other system device. In one embodiment communication between users and user interface occurs over the Internet. However the invention is not so limited and communication between users and user interface may occur over any type of network or combination of networks including wide area networks local area networks private networks public networks packet networks circuit switched networks and wired or wireless networks.

User data database is configured to store data associated with particular users that is used by LBS delivery engine to determine which location based services should be provided to a particular user and the manner in which such services should be provided. To this end user data database includes a list of the location based services that a user has registered to use and associated user preference information regarding how such services should be delivered.

User data database is also configured to store user provided information identifying one or more sensor enabled devices or objects that are to be tracked by LBS delivery engine for the purposes of determining device object location s and receiving services based on those location s . User data database may also be configured to store user preferences concerning how and when such sensor enabled devices objects are to be tracked.

User data database may also be configured to store other data about a user that can be used to perform targeted delivery of location based services or content to the user such as data relating to a user s identity activities interests preferences or social network. This data may be actively provided by a user such as via user interface collected from sensor enabled devices via sensor network or some other channel provided to LBS delivery engine from some other network system or database that aggregates such data or by any combination of the foregoing. An example of a system that uses a sensor network to collect user data of this type is described in commonly owned co pending U.S. patent application Ser. No. 11 562 976 entitled Methods. Systems and Apparatus for Delivery of Media. the entirety of which is incorporated by reference herein.

LBS provider interface is a component that is configured to allow location based service providers and their systems to interact with LBS delivery engine from a remote location for the purpose of creating or otherwise providing location based content or services for distribution to users us well as to perform other functions. Such other functions may include specifying targeting criteria that are used to match location based content or services to users. Information provided by a location based service provider through interaction with LBS provider interface is stored in LBS data database .

In one embodiment electronic content and other data necessary for providing a location based service is provided or created by a location based services provider via LBS provider interface and stored in LBS data database . This data may then be used by LBS delivery engine to automatically create and deliver location based content or services to users based on the current location of sensor enabled devices objects associated with the users. For example if the location based content included a location specific advertisement the advertisement could be stored in LBS data database and then delivered to users when such users carry mobile devices through or near a particular location. However this example is not intended to be limiting and persons skilled in the relevant art s will readily appreciate that a wide variety of electronic content and other data may be stored in LBS data database to support the delivery of location based services.

In an alternate embodiment a location based service provider provides location based content and services in real time to LBS delivery engine via LBS provider interface for delivery to users based on the location of sensor enabled devices objects associated with the users as determined by LBS delivery engine . In this case LBS delivery engine is not responsible for generating or accessing location based content from LBS data database rather such content is provided directly from the location based service provider. In a still further embodiment location based content and services may be provided using a combination of content and data provided from the location based services provider and from LBS data database .

Location based services that may be provided by LBS delivery engine in this manner include but are not limited to personal navigation services resource location e.g. providing an identification of a local business professional or service such as an ATM doctor or restaurant responsive to a user query resource tracking e.g. tracking of objects such as packages and train boxcars resource tracking with dynamic distribution e.g. fleet scheduling and tracking of taxis service people rental equipment doctors etc. proximity based notification e.g. alerts or notices such as notification of a sale on gas warning of a traffic jam or co presence of an actual or potential business or social contact location based content delivery e.g. local weather targeted advertising or coupons location based billing e.g. EZ pass and toll watch and emergency services. Persons skilled in the relevant art s will appreciate that other location based services not listed here may also be delivered using LBS delivery engine .

In one embodiment of the present invention location based service providers and their systems communicate with LBS provider interface using applications built upon a predefined API. Such applications may be published by an entity that owns and or operates LBS delivery engine or by other entities. Communication between the location based service providers and LBS provider interface may occur over the Internet. However the invention is not so limited and communication between the location based service providers and LBS provider interface may occur over any type of network or combination of networks including wide area networks local area networks private networks public networks packet networks circuit switched networks and wired or wireless networks.

As noted above certain information provided by a location based service provider through interaction with LBS provider interface is stored in LBS data database . This information may include for example data about each location based service provider that has registered to use LBS delivery engine as well as electronic content and other data related to or necessary for providing one or more location based services.

Communications manager is a component that is configured to manage all communication between LBS delivery engine and sensor enabled devices objects residing on or currently connected to sensor network . Communications manager is configured to perform among other functions the transmission of location based content and other data associated with location based services to sensor enabled devices over sensor network . Communications manager is also configured to receive sensor data from sensor enabled devices objects and store it in a sensor logs database for use in performing location tracking functions by LBS delivery engine . Depending upon the implementation communications manager may also be configured to interoperate with third party carriers and networks to effect communications.

As noted above sensor data received from sensor enabled devices objects is stored in sensor logs database . This sensor data is then used by location tracking manager to construct and or update a proximity based ad hoc network used to track the location of the sensor enabled devices objects .

As will be described in more detail herein this sensor data may include a unique identifier ID of the reporting sensor enabled device object one or more unique IDs corresponding respectively to one or more beacons sensed by the reporting sensor enabled device object and one or more time codes indicating when each of the one or more beacons was respectively sensed by the reporting sensor enabled device object. Other information that may be provided as part of the sensor data may include a signal strength associated with each of the one or more beacons and a time of transmission of the sensor data from the reporting sensor enabled device object to LBS delivery system . The sensor data may still further include metadata associated with the reporting sensor enabled device object such as location information or other information associated with the reporting sensor enabled device object.

Location tracking manager is a component that is configured to use sensor data from sensor logs database to construct and or update a proximity based ad hoc network used to track the location of the sensor enabled devices objects . The manner in which location tracking manager operates to perform this function will be described in detail below. Once location tracking manager has determined the current relative or actual location of a sensor enabled device object it uses that information to map the sensor enabled device object into a location graph that represents all sensor enabled devices objects being tracked by LBS delivery engine and their current locations.

Matching manager is a component that is configured to match information concerning the current location of one or more sensor enabled devices objects associated with a user as determined from location graph to a location based service being provided to that user so that the location based service can take into account such location information. Matching manager is further configured to provide location based content or other information to the user wherein such content or other information takes into account the current position of the sensor enabled device s objects s . In one embodiment matching manager performs this function by selecting or customizing content from LBS data database and transmitting it to the user while in another embodiment matching manager performs this function by receiving content from a location based service provider via LBS provider interface and transmitting it to the user. In either case any resulting communication to the user is transmitted over sensor network via communications manager .

Matching manager may also be configured to take into account other information about a user when determining whether or not to provide location based content or other information to a user. This information may include for example data relating to a user s identity activities interests preferences or social network. Matching manager may access this data from user data database .

As discussed above location tracking manager within LBS delivery engine constructs a proximity based ad hoc network among a plurality of sensor enabled devices and objects to track the location of such sensor enabled devices and objects referred to hereinafter for simplicity as sensors . In particular location tracking manager uses time coded data received from each of the sensors to determine a current proximity of each of the sensors to one or more beacons. As used herein the term beacon broadly refers to any unique device or object that is discoverable or detectable by a sensor. Then by leveraging information relating to the effective transmission ranges of the beacons location tracking manager determines the relative location of each of the plurality of sensors with respect to other sensors within the plurality of sensors. Where actual as opposed to relative location information is available for a particular sensor it can then be used to generate or augment location information associated with other sensors known to be spatially and temporally proximate to the particular sensor. The current location information for each of the sensors is then mapped to location graph for use in providing location based services.

Sensor and beacon may comprise any of a wide variety of well known sensor and beacon types. For example sensor may comprise a first WiFI device and beacon may comprise a second WiFi device wherein the first WiFi device is capable of detecting the second WiFi device in a well known manner. Each of the first and second WiFi devices may comprise for example a WiFi user device or access point. As will be appreciated by persons skilled in the relevant art s . WiFi refers to wireless networking technology built around the family of IEEE 802.11 standards. Conventional WiFi devices typically have a transmission range from 0 up to approximately 100 meters. A typical WiFi device can act as both a sensor and a beacon so it is possible that beacon is also capable of detecting other WiFi devices and of reporting related sensing information to LBS delivery engine . WiFi devices can be either stationary or mobile so sensor and beacon may also be stationary or mobile in this case.

As another example sensor may comprise a cellular telephone and beacon may comprise a cellular tower wherein the cellular telephone is capable of detecting the cellular tower in a well known manner. A conventional cellular tower has a transmission range from 0 up to approximately 10 000 meters. Cellular telephones are capable of being carried from location to location by a user while cellular towers are stationary so in this case sensor may be stationary or mobile while beacon will be stationary.

As a further example sensor may comprise a first Bluetooth device and beacon may comprise a second Bluetooth device wherein the first Bluetooth device is capable of detecting the second Bluetooth device in a well known manner. As will be appreciated by persons skilled in the relevant art s Bluetooth refers to an industrial standard for wireless personal area networks PANs that is based on specifications developed and licensed by the Bluetooth Special Interest Group. Conventional Bluetooth devices typically have a transmission range from 0 up to approximately 10 meters. A typical Bluetooth device can act as both a sensor and a beacon so it is possible that beacon is also capable of detecting other Bluetooth devices and of reporting related sensing information to LBS delivery engine . Bluetooth devices can be either stationary or mobile so sensor and beacon may also be stationary or mobile in this case.

Table 1 below shows various sensor and beacon mobility use cases that may be supported by an embodiment of the present invention. In particular each entry in Table 1 describes a sensor beacon combination that can result in the generation and reporting of sensor data to LBS delivery engine .

In accordance with one embodiment of the present invention LBS delivery engine maintains information indicating whether one or more sensors or beacons are mobile or stationary and uses such information to enhance the manner in which location tracking manager constructs the proximity based ad hoc network. Depending upon the implementation this information may be obtained through manual user input or and or is automatically determined by LBS delivery engine . Depending on how the automatic determination algorithm is implemented periodic updates may be advisable to ensure that a sensor or beacon that was deemed stationary has not become mobile.

Depending on the sensor beacon type the unique IDs associated with sensor and beacon may be MAC addresses respectively associated with sensor and beacon . This approach may be used for example where sensor and beacon are WiFi or Bluetooth devices. However other methods of assigning unique IDs to sensor and beacon may be used.

As shown in sensor beacon has entered into or resides in a current transmission range of sensor beacon and is therefore capable of detecting transmissions from sensor beacon . Likewise sensor beacon has entered into or resides in a current transmission range of sensor beacon and is therefore capable of detecting transmissions from sensor beacon . Responsive to detecting sensor beacon sensor beacon sends sensor data to LBS delivery engine via sensor network that includes a unique ID of sensor beacon a unique ID associated with sensor beacon and a time code indicating when sensor beacon was sensed by sensor beacon as well as other information as discussed in previous examples. Likewise responsive to detecting sensor beacon sensor beacon sends sensor data to LBS delivery engine via sensor network that includes the unique ID of sensor beacon the unique ID of sensor beacon and a time code indicating when sensor beacon was sensed by sensor beacon as well as other information as discussed in previous examples.

Proximity sensing manager is configured to scan one or more wireless channels via network interface in order to detect the transmissions of any proximally located beacons. If a beacon is detected proximity sensor manager obtains a unique ID associated with the beacon either from the originally received beacon transmission or via a subsequent exchange of messages with the beacon and optionally measures or otherwise obtains a signal strength associated with transmissions from the beacon. Proximity sensing manager is also configured to generate a time code indicating a time at which the beacon was detected. Proximity sensing manager is further configured to provide the IDs of the currently sensed beacons the associated time codes and optionally the signal strength data to sensor data publisher . Proximity sensing manager is configured to perform this scanning function which is also referred to herein as polling on a periodic basis. In an embodiment the frequency at which polling is performed may be controlled by modifying a configurable polling frequency parameter.

Depending upon the implementation proximity sensing manager may also provide additional information to sensor data publisher concerning the currently sensed beacons such as the channel on which a beacon was sensed an indication of beacon type or an indication of directionality of a currently sensed beacon.

Sensor data publisher receives the foregoing information from proximity sensing manager and accumulates it in a buffer for subsequent transmission to LBS delivery engine . Sensor data publisher may add additional metadata to the information before sending it to LBS delivery engine . This additional metadata may include for example location information associated with sensor beacon . Such location information may include for example location information provided by a GPS module or other positioning module within sensor beacon . Alternatively such location information may include location information e.g. a zip code street address or the like manually provided by a user of sensor beacon via a user interface of sensor beacon not shown in . Such location information may further include event information manually provided by a user of sensor beacon from which a location may be inferred. Additionally such location information may be obtained by mapping a user to a particular event e.g. by accessing a user calendar or by some other means wherein the event is associated with a particular location. Still further such location information may include location information received by sensor beacon from another device via a local connection wherein the local connection may be for example a Bluetooth link an infrared link or some other wired or wireless link.

Sensor data publisher is configured to transmit this accumulated sensor data on a periodic basis to LBS delivery engine . In an embodiment the frequency at which such reporting is performed may be controlled by modifying a configurable reporting frequency parameter.

Like sensor beacon sensor beacon also includes a number of communicatively connected components including a network interface a proximity sensing manager and a sensor data publisher . These components perform similar functions to network interface proximity sensing manager and sensor data publisher respectively as described above in reference to sensor beacon .

Although depicts two sensor beacons and each of which is capable of sensing the other it is noted that such proximity sensing need not be bi directional. In other words in alternate embodiments sensor beacon may be capable of detecting sensor beacon or sensor beacon may be capable of detecting sensor beacon but not both. It is also noted that the foregoing functions of proximity sensing and reporting of sensor data as performed by each sensor beacon and may advantageously be performed without pairing with the other device.

As shown in the method of flowchart begins at step in which a sensor detects one or more proximally located beacons. Step may occur responsive to the performance of a periodic polling function by the sensor as described above. At step the sensor obtains one or more unique IDs respectively associated with each of the one or more proximally located beacons. Step may also include obtaining other information associated with each of the one or more proximally located beacons including but not limited to a signal strength associated with each of the one or more proximally located beacons a channel on which each beacon was sensed an indication of each beacon type or an indication of directionality of each currently sensed beacon. At step the sensor generates one or more time codes indicating a time at which each of the proximally located beacons was respectively detected. At step the sensor optionally adds metadata including but not limited to sensor generated or user provided location data to the foregoing sensor data. At step the sensor transmits a unique ID of the sensor the unique ID s and other information associated with the proximally located beacon s the time codes and the metadata to an LBS delivery engine. Step may occur responsive to the performance of a periodic reporting function by the sensor as described above.

Thus in accordance with an embodiment of the present invention numerous sensors including sensors that also operate as beacons provide sensor data to LBS delivery engine wherein such sensor data identifies beacons that are currently detectable by each sensor and sensor beacon. This is illustrated in which shows a plurality of sensors shown as boxes labeled with an S wherein each sensor reports sensor data to LBS delivery engine via sensor network . LBS delivery engine uses such sensor data to determine the relative location of each sensor in plurality of sensors with respect to the other sensors in plurality of sensors and to construct a proximity based ad hoc network among the plurality of sensors based on such relative location information. LBS delivery engine may advantageously perform this function by obtaining sensor data from a variety of different sensor types e.g. WiFi cellular or Bluetooth and from sensors associated with different networks or telecommunications carriers.

The manner in which LBS delivery engine operates to construct a proximity based ad hoc network based on the sensor data will now be described with reference to flowchart of . As shown in the method begins at step in which communications manager receives sensor data from a plurality of sensors wherein the sensor data received from each of the plurality of sensors includes at least a unique ID associated with the sensor one or more unique IDs associated respectively with one or more beacons detected by the sensor and one or more time codes indicating when each of the one or more beacons was respectively detected by the sensor. Communications manager stores this sensor data in sensor logs database where it is accessible by location tracking manager .

At step location tracking manager accesses sensor logs database and extracts temporally proximate sensor data from the sensor data that was received in step . Location tracking manager performs this function by extracting sensor data that corresponds to a unique detection time or detection time period. By identifying sensor data corresponding to a unique detection time or detection time period location tracking manager is able to obtain a subset of the received sensor data corresponding to a particular instance in time or to a particular time window. In an embodiment this step is performed by analyzing the time codes associated with each Net of sensor data wherein each time code indicates a time that a particular beacon was identified by a particular sensor. Because the time codes may be generated by sensors using local sensor time this step may also include normalizing the time codes. Normalizing the time codes may include for example converting each of the time codes to a system time.

At step location tracking manager identifies spatially and temporally proximate sensors in the plurality of sensors based on the detected beacons identified by the temporally proximate sensor data. This step may include for example comparing the beacons detected by each of the sensors at the same time or during the same time period to determine which sensors are proximate to each other. For example if two sensors detect the same beacon as the same time or during the same time period it can be assumed that the two sensors are temporally and spatially proximate. As another example if two sensors that can also act as beacons detect each other at the same time or during the same time period it can be assumed that the two sensors are temporally and spatially proximate.

The manner in which the temporally proximate sensor data is analyzed by location tracking manager to perform the function of step may vary depending on the implementation and the amount of sensor data available for each sensor. For example the analysis performed by location tracking manager may lake into account other information provided as part of the sensor data in determining whether sensors are temporally and spatially proximate such as the signal strength associated with each detected beacon a beacon type or an indication of directionality associated with each detected beacon. In determining temporal and spatial proximity location tracking manager may also utilize known information concerning the maximum transmission ranges associated with certain beacon types.

At step location tracking manager constructs or updates an ad hoc network among the spatially and temporally proximate sensors. The ad hoc network may be considered virtual in the sense that the sensors included in the network are not physically connected to each other but instead are logically connected to each other by virtue of spatial and temporal relationships identified and maintained by location tracking manager .

By analyzing the relationships in then it can be seen that sensor may also be spatially and temporally proximate to an additional number of sensors other than sensors and i.e. any of sensors and . In an embodiment of the present invention location tracking manager can leverage information concerning the transmission ranges of the beacons detected by each of these sensors as well as other information such as beacon signal strength if available to estimate the distance between sensor and the sensors to which it is connected only by virtue of its connections to sensors and . The foregoing analysis may be repeated to identify sensors that are even further removed from sensor and to estimate the distance between sensor and such sensors. By applying this analysis to sensor and other sensors an entire ad hoc network may be logically constructed.

Once an ad hoc network has been constructed or updated if one version of the ad hoc network is being modified to generate a more current one then location tracking manager can advantageously use the ad hoc network to propagate location information among spatially and temporally proximate sensors. This feature will now be described in reference to flowchart of .

As shown in the method of flowchart begins at step in which location tracking manager obtains location information associated with a first sensor in a plurality of sensors represented in the proximity based ad hoc network. The location information associated with the first sensor may include an estimate or indication of the actual location of the first sensor that is provided with the sensor data transmitted by the first sensor to LBS delivery system . This estimate or indication of the actual location of the first sensor may be generated by a positioning module or service present on the first sensor such as but nut limited to a GPS positioning module or service a WiFi based positioning module or service a cellular telephone based positioning module or service or a Bluetooth based positioning module or service. This estimate or indication of the actual location of the first sensor may also be provided by a user of the first sensor via a user interface of the first sensor. For example the estimate or indication of the actual location of the first sensor may be a zip code or street address provided by the user of the first sensor.

Alternatively location tracking manager may obtain the location information associated with the first sensor by generating or augmenting location information associated with the first sensor based on location information associated with one or more other sensors in the plurality of sensors that have been determined to be spatially and temporally proximate to the first sensor. In other words the location information associated with the first sensor may be propagated to the first sensor from one or more other spatially and temporally proximate sensors.

As yet another example location tracking manager may obtain the location information associated with the first sensor by accessing location information associated with a network gateway used by the first sensor. For example as will be appreciated by persons skilled in the relevant art s . IP addresses associated with geo coded network gateways can be mapped to corresponding geographic areas.

Still further location tracking manager may obtain the location information associated with the first sensor by calculating the location of the first sensor by virtue of its proximity to a plurality of beacons. For example triangulation may be used to calculate the location of the first sensor by virtue of its proximity to a plurality of beacons. The proximity of the first sensor to each of the beacons may be determined based on sensor data provided by the first sensor or by one or more sensors that have been determined to be spatially and temporally proximate to the first sensor.

At step location tracking manager identifies a second sensor in the plurality of sensors that is spatially and temporally proximate to the first sensor. One manner by which location tracking manager may identify spatially and temporally proximate sensors was described above in reference to flowchart of .

At step location tracking manager generates or augments location information associated with the second sensor based on the location information associated with the first sensor. Location tracking manager may perform this step for example by using an estimate or indication of the actual location of the first sensor as an estimate or indication of the actual location of the second sensor. For example if a zip code has previously been associated with the first sensor then location tracking manager may also associate the zip code with the second sensor based on the spatial and temporal proximity of the two sensors. The same approach may be used for example to assign geographic coordinates a street address or any other representation of a location associated with the first device to the second device.

Location tracking manager may also perform step by modifying an estimate or indication of the actual location of the first sensor by an offset wherein the offset is intended to represent the distance between the two sensors. For example location tracking manager may modify geographic coordinates representing the location of the first sensor to account for an estimated relative distance between the first sensor and the second sensor. As discussed above the relative distance between sensors may be determined by leveraging sensor data such as beacon IDs beacon types and signal strengths provided by the plurality of sensors in the proximity based ad hoc network.

Location tracking manager may also perform step by augmenting location information previously associated with the second sensor based on the location information associated with the first sensor. For example the location information previously associated with the second sensor may be limited or may lack the same granularity as the location information associated with the first sensor. In this case location manager may use the location information associated with the first sensor to render the location information associated with the second sensor more complete or granular. Thus an embodiment of the present invention can combine location information from a plurality of spatially and temporally proximate sensors to generate refined location information.

The foregoing examples of the manner in which location tracking manager may perform step were provided by way of example only and are not intended to limit the present invention. Persons skilled in the relevant art s will readily appreciate that other methods may be used to generate or augment location information associated with the second sensor based on the location information associated with the first sensor.

Where actual location information is available for a number of spatially and temporally proximate sensors in the ad hoc network an embodiment of the present invention can advantageously select the best available location information for propagation among surrounding sensors. The determination of what constitutes the best available location information may be based for example on the granularity of the location information or some other indicia of the accuracy of the location information. Such other indicia may include the type of sensor that reported the location information the conditions under which the location information was reported the accuracy of previously reported location information from the same sensor or the similarity or difference between location information being reported by a particular sensor as compared to other spatially and temporally proximate sensors.

Furthermore where actual location information is available for a number of spatially and temporally proximate sensors in the ad hoc network an embodiment of the present invention can advantageously use the multiple instances of actual location information to detect bad sensor readings. For example where a majority of a group of spatially and temporally proximate sensors are reporting actual location information corresponding to a first location or area and a minority of the same group is reporting actual location information corresponding to a second location or area that is geographically remote from the first area an embodiment of the present invention can determine that the actual location information being reported by the minority is incorrect. Such an embodiment can also attempt to correct or override the bad location information with an estimated location based on the good location information being provided by surrounding sensors.

Once location tracking manager has created updated the proximity based ad hoc network and propagated actual location information among the sensors of that network as discussed above location tracking manager then maps each of the sensors into location graph which represents all the sensors currently being tracked by LBS delivery engine and their current relative or actual locations. Matching manager then uses location graph to enable the delivery of location based services in a manner that has been previously described.

The foregoing approach to location tracking is advantageous for a number of reasons. For example the foregoing approach enables sophisticated location based services to be delivered to users across multiple networks carriers signal types and protocols. As described above it can be used to unify multiple sources and formats of location information into a real time graph or mesh of sensors. It can also be used to deliver location based services of multiple divergent granularities through a single proximity based ad hoc network.

Furthermore because the foregoing approach utilizes propagation of location information among spatially and temporally proximate sensors it optimizes the value of available location information and enables all sensors in the ad hoc network to be positioned with great accuracy regardless of sensor type. This approach also permits data that has heretofore been spread among different information silos to be recreated in a single database through location metadata analysis and optimization thereby minimizing information bottlenecks and gate keepers.

Additionally in accordance with an embodiment of the invention user devices may be utilized as sensors and beacons to produce a recurring optimized location tracking model instead of as simple dumb terminals that are only relevant when engaged with a user.

Although the foregoing section describes a method for tracking the relative and actual location of sensors within the context of a proximity based ad hoc network it is noted that the foregoing approach can advantageously be used to track the relative and actual locations of devices and objects that are configured to or capable of acting as beacons only. So long as such beacons are detected by at least one sensor that is currently reporting sensor data to LBS delivery engine those beacons can also be located within the proximity based ad hoc network by location tracking manager . Consequently location tracking manager can determine the relative and actual location of beacons in a like manner to that described above for sensors and such beacons can then also receive location based services or other services based on this functionality.

Furthermore although the foregoing section describes a method of location tracking that is premised in part on the sensing of signals transmitted or broadcast by beacons the invention is not limited to that approach. For example additional methods may be used to determine that users are proximally located to each other. In one embodiment a camera acts a sensor by capturing an image of a user s face and LBS delivery engine uses facial recognition technology to match the user s face to an online user identity thereby placing the photographed user in proximity to the bearer of the camera. In another embodiment a user manually enters personal identification information about a proximally located user e.g. a user name e mail address telephone number or the like into a user device. Upon receipt of such information LBS delivery engine is then able to place the user identified by the personal identification information in proximity to the bearer of the user device.

C. Power Management for Proximity Based Ad Hoc Networks in Accordance with an Embodiment of the Present Invention

As noted above in an embodiment of the present invention the sensors providing sensor data to LBS delivery engine may comprise sensor enabled mobile devices or objects. These mobile sensors typically have limited access to power. For example these mobile sensors may depend upon batteries or some other limited power supply to facilitate mobility.

Generally speaking LBS delivery engine benefits from the frequent collection and reporting of sensor data by the sensors because this allows LBS delivery engine to construct or maintain a more up to date proximity based ad hoc network which in turn facilitates better location tracking. However the collection and reporting of sensor data consumes sensor power which as described above may be limited. If a sensor runs out of power it will be incapable of providing sensor data to LBS delivery engine which may limit the ability of LBS delivery engine to perform its location tracking function. Furthermore if a sensor is also a user device when the sensor runs out of power it will be incapable of performing any other functions for the user which is undesirable from the user perspective.

Thus it would be beneficial if the need for frequent collection and reporting of sensor data by LBS delivery engine could somehow be balanced with the power requirements and constraints of each sensor in the proximity based ad hoc network.

As shown in . LBS delivery engine includes a number of communicatively connected elements including a user interface an LBS provider interface a communications manager a user data database an LBS data database a location tracking manager a location graph a matching manager and a sensor logs database . With the exception of certain functions to be described immediately below each of these elements performs essentially the same functions as described above in reference to like named elements of LBS delivery engine .

As also shown in LBS delivery engine further includes a power management manager . Power management manager is configured to obtain power status information associated with each of a plurality of sensor currently reporting sensor data to LBS delivery engine . This power status information is reported by each of the plurality of sensors via sensor network . In an embodiment the power status information is transmitted by each sensor as part of or along with sensor data transmitted to LBS delivery engine and is stored by communications manager in sensor logs database . The power status information for a sensor may include but is not limited to a measure of a current or projected amount of power available to the sensor and or a measure of a current or projected amount of power required by the sensor.

Power management manager is further configured to obtain information concerning the spatial and temporal proximity of the sensors currently reporting sensor data to LBS delivery engine from a location graph maintained by location tracking manager . Location tracking manager is configured to construct and maintain location graph in the same manner as described above in reference to location tracking manager and location graph of LBS delivery engine and thus no further description of that process need be provided.

Power management manager is still further configured to use both the proximity and power status information associated with each of the plurality of sensors currently reporting sensor data to LBS delivery engine to make power management decisions concerning those sensors. The manner in which these power management decisions are made will be described in more detail below. Power management manager may implement the power management decisions by dynamically and adaptively controlling the manner in which one or more of the sensors collects and reports sensor data. Power management manager is configured to control these sensor functions by sending configuration commands to each of the one or more sensors over sensor network via communications manager .

As shown in sensor also includes power management logic . Power management logic is configured to provide power status information associated with sensor to sensor data publisher for transmission to LBS delivery engine . In an embodiment sensor data publisher includes the power status information as part of or along with other sensor data that sensor data publisher periodically transmits to LBS delivery engine . In an alternate embodiment sensor data publisher transmits the power status information separately from such sensor data. Depending upon the implementation sensor data publisher may transmit the power status information at the same frequency or at a different frequency than the frequency with which it transmits the other sensor data. Sensor data publisher may also transmit the power status information with a time code that indicates at what time the power status information was generated.

Power management logic is also configured to modify the manner in which certain power consuming functions are performed by sensor responsive to configuration commands received from LBS delivery engine over sensor network . The configuration commands are received by network interface and then passed to power management logic for processing.

As will be described in more detail herein responsive to processing the configuration commands power management logic may modify the manner in which sensor provides sensor data to LBS delivery engine . Responsive to processing the configuration commands power management logic may also modify a manner in which sensor acts as a beacon if sensor includes beacon functionality or cause sensor to stop reporting positioning information if sensor includes positioning logic.

The manner in which LBS delivery engine manages power consumption among a plurality of sensors such as sensor in a proximity based ad hoc network will now be described with reference to flowchart of . Although the steps of flowchart will be described with continued reference to components of LBS delivery engine and sensor persons skilled in the relevant an s will readily appreciate that the method is not limited to those implementations and that other means may be used to carry out the method.

As shown in the method of flowchart begins at step in which communications manager receives sensor data provided from a plurality of sensors. Communications manager stores this sensor data in sensor logs database where it is accessible by location tracking manager . At step location tracking manager constructs a proximity based ad hoc network among the plurality of sensors based on the received sensor data. One manner in which location tracking manager may construct a proximity based ad hoc network was described above in reference to location tracking manager of LBS delivery engine and thus no further description of that process need be provided.

At step communications manager also receives power status information associated with each sensor in the plurality of sensors. This power status information may be included with the sensor data received in step or may be transmitted independently of that data. The power status information for a particular sensor may also be provided at the same frequency as the sensor data received from that sensor in step or at a different frequency. For example in one example embodiment the power status information for a particular sensor is provided much less frequently than the sensor data associated with that sensor. This type of implementation may make sense where the power state of the sensor is not anticipated to change as quickly as the location of the sensor. The power status information may also be received with a time code indicating when the sensor generated the power status information. The power status information received by communications manager in step is stored in sensor logs database logs .

At step power management manager analyzes the power status information associated with each sensor in a group of spatially and temporally proximate sensors in the proximity based ad hoc network. This group comprises two or more sensors across which power management manager can implement a power management scheme by virtue of their spatial and temporal proximity. As described herein the power management scheme may include assigning more power consuming tasks relating to sensor data collection and reporting to certain sensors in a group as opposed to other sensors in the group based on the power state of each sensor in the group.

At step power management manager modifies the manner in which at least one sensor in the group of spatially and temporally proximate sensors provides sensor data based on the analysis of the power status information. Performance of this step by power management manager includes sending one or more configuration commands to a sensor via sensor network . Responsive to receiving a configuration command power management logic within the sensor such as power management logic of sensor modifies the manner in which the sensor provides sensor data.

One type of power management scheme that can be implemented by power management manager in accordance with the foregoing method involves requiring certain sensors in a group of spatially and temporally proximate sensors to perform more frequent sensor data polling and or reporting as compared to other sensors in the same group based on the power state of each sensor. In this way sensors with more power can be required to carry more of the polling reporting burden as compared to other sensors in the group that have less power. This scheme is premised on the insight that in a sufficiently dense group of temporally and spatially proximate sensors sensor data need not be collected from each sensor at the same frequency in order to construct and maintain an up to date proximity based ad hoc network. Thus this power management scheme may also take into account the current density of the group as well as the power status information associated with the sensors in the group.

Changing the sensor data polling frequency may involve tending a configuration command to a sensor wherein the configuration command changes a parameter that is used by the sensor to determine the rate at which to scan for proximally located beacons. Likewise changing the rate at which a sensor reports sensor data to LBS delivery engine may comprise sending a configuration command to a sensor wherein the configuration command changes a parameter that is used by the sensor to determine the rate at which the sensor reports sensor data. Changing the sensor data polling frequency may include temporarily turning off the polling functionality for a sensor. Likewise changing the rate at which a sensor reports sensor data may include temporarily turning off the sensor data reporting functionality for a sensor.

Where the group of spatially and temporally proximate sensors is dense enough power management manager may also change the manner in which at least one sensor in the group acts as a beacon. For example power management manager may turn off beacon functionality in one or more sensors where providing such functionality is not necessary in order to obtain a reasonably up to date picture of the proximity based ad hoc network.

In addition to taking into account the current density of a group of spatially and temporally proximate sensors power management manager may also take into account the polling frequency required for a given sensor to provide useful sensor data on an ongoing basis. For example if a sensor is stationary and the beacons in the proximity of the sensor are stationary then the polling frequency can be reduced to an extremely low level which conserves power. In contrast if a sensor is moving and the beacons in the proximity of the sensor are also moving then the polling frequency may need to be relatively high in order to capture useful sensor data. Power management manager may take such factors into account when reducing or increasing the polling frequencies associated with different sensors in the group.

Power management manager may also take into account the amount of power that must be supplied to antennas associated with sensors in the group in order for those sensors to return useful sensor data. Thus for example power management manager may determine that increasing the gain of an antenna associated with a first type of sensor will yield more useful data than increasing the gain of an antenna associated with a second type of sensor in the same group. In this situation power management manager may increase the power supplied to the antenna of the first type of sensor while maintaining or reducing the power supplied to the antenna of the second type of sensor thereby conserving power in the second type of sensor.

Power management manager may further take into account whether positioning information currently being generated by a sensor in the group is useful or accurate. For example where other devices in the group are providing the same or more accurate positioning information power management manager may cause the sensor to stop reporting such positioning information thereby saving power for that sensor. One example of this is turning off the reporting of positioning data from a GPS enabled sensor when the sensor is in an area where GPS does not work well e.g. when the sensor is indoors .

In accordance with another power management scheme power management manager may cause a selected sensor in the group to collect sensor data from one or more other sensors in the group over a local network connection and to provide the collected sensor data to LBS delivery engine on behalf of the other sensor s . Power management manager may also cause the selected sensor to receive data related to location based services from LBS delivery engine on behalf of the other sensor s and to disseminate this data to the other sensor s . This allows the selected sensor which may have more available power to act as a communication hub for other sensors that have les available power.

An example of this power management scheme is illustrated in block diagram of which shows a first sensor and a second sensor in a group of spatially and temporally proximate sensors. As shown in second sensor receives sensor data from first sensor over a local network connection and provides the sensor data on behalf of the first sensor to LBS delivery engine over sensor network . As also shown in second sensor receives location based services data from LBS delivery engine over sensor network on behalf of first sensor and disseminates the location based services data to first sensor .

Power management manager may automatically identify groups of spatially and temporally proximate sensors over which power management is to be performed. Such groups may be identified based on spatial and temporal proximity power resources or other factors. The size of such groups may vary depending upon the implementation or mode of operation. At one extreme the group may encompass all of the sensors in the proximity based ad hoc network constructed by location tracking manager . At the other extreme the group may consist of only two sensors. Still further power management manager may perform power management for individual sensors. For example power management manager may apply any of the aforementioned methods for reducing power consumption in a sensor such as a sensor that is reporting a low power condition without regard to the power state of any spatially and temporally proximate sensors.

An embodiment of the present invention also advantageously allows a user to override or control the manner in which power management manager performs the power management function. For example in one embodiment the user is allowed to reduce the frequency with which sensor data is collected and or reported by a sensor or to turn off the polling or reporting functionality entirely. This permits a user to conserve sensor power that can then be dedicated to other functions if desired. Turning off these functions may also be desirable for reasons relating to protecting user privacy or conserving costs associated with communicating with LBS delivery engine . Such user control mechanisms may be contained within the sensor itself or implemented through user communication with LBS delivery system .

In an alternative embodiment the user is allowed to fix the frequency with which sensor data is collected and or reported by a sensor regardless of the power management functionality. This might be used for example by a parent to ensure that a sensor associated with a child continues to provide sensor data even when the sensor is in a low power state thereby allowing the location of the child to be continuously tracked by LBS delivery system .

In accordance with another embodiment users may define groups of sensors over which power management manager should perform power management functions. For example a user may specify a group of sensors associated with the members of a family the members of a business organization or participants in an activity or event over which power management should be performed. This advantageously allows for power sharing and loud balancing among the sensors used by a particular group of people. In a further embodiment a user may define a hierarchy associated with the sensors in the user defined group wherein the power of the sensors at the bottom of the hierarchy is to be consumed prior to or at a greater rate than the power of the sensors at the top of the hierarchy. This may involve for example increasing the rate at which sensor data is collected or reported by one or more sensors at the bottom of the hierarchy or causing one or more sensors at the bottom of the hierarchy to act as a communication hub with LBS delivery engine .

As discussed above power management manager analyzes power status information associated with each sensor in a group of spatially and temporally proximate sensors and then implements a power management scheme based on the analysis. In one embodiment power management manager uses the power status information to predict the future power usage of each of the sensors the data transmission methods associated therewith and the combination of all of these working in parallel in order to achieve a balance between maximum operation time and accurate location proximity sensing and reporting.

In a further embodiment power management manager takes into account an estimate of when a user will next recharge a sensor in determining a power management scheme for that sensor or for a group of sensors. This estimate may be based for example on historical information relating to when the user recharged the sensor in the past or on the current proximity of the sensor to a recharging source.

To implement the foregoing approach to power management an embodiment of the present invention may need to manage the CPU priority of the sensing software operating on a sensor. This may involve dynamically changing the standby mode settings for the sensor so that the sensor does not automatically enter into a power down or standby state after a certain period of inactivity thereby disabling the collection and reporting of sensor data.

In one embodiment of the present invention power management manager may change the priority or rate of collection of sensor data by a sensor based in part on a prediction of change. For example the polling frequency of a sensor may be increased when new sensors or beacons are encountered and decreased if the surrounding sensors or beacons are more static.

In a further embodiment of the present invention a sensor may include an encounters management system that organizes collected sensor data based on encounters with other sensors or beacons. The encounters management system may manage or track certain information associated with each encounter such as a start time end time location target device and source device. The encounters management system may include a store and forward mechanism to optimize outgoing sensor data and to manage the frequency with which such data is reported. Optimization of the reporting frequency may be performed on a per encounter basis. Prioritization may be performed based on device type whether the encounter is a first encounter updating an end time of the encounter less urgent frequent contact type e.g. friend or stranger or the like.

As discussed above in one embodiment of the present invention the sensor data provided from each sensor to the LBS delivery engine includes at least a unique ID associated with the sensor one or more unique IDs respectively associated with each of the beacons currently detected by the sensor and one or more time codes indicating when each beacon was respectively sensed by the sensor. The LBS delivery engine uses the time codes included in this sensor data to determine which sensors are detecting which beacons at a given moment in time or during a given window of time. This ability of the LBS delivery engine to correlate sensor data based on time codes is critical in building and maintaining a proximity based ad hoc network that is useful for location tracking.

A problem arises however when a sensor generates time codes using a notion of time that is different than the notion of time held by other sensors reporting sensor data to the LBS delivery engine. When this occurs the ability of the LBS delivery engine to correctly correlate sensor data received from all the sensors based on time codes is impaired. This may occur for example when a sensor in a network uses a local clock to generate time codes while other sensors in the same network use a network clock to generate time codes and the local clock and the network clock are not synchronized. This may also occur for example when a sensor in a first network uses a first network clock to generate time codes while a sensor in a second network users a second network clock to generate time codes wherein the first network clock and the second network clock are not synchronized.

As shown in LBS delivery engine includes a number of communicatively connected elements including a user interface an LBS provider interface a communications manager a user data database an LBS data database a location tracking manager a location graph a matching manager and a sensor logs database . With the exception of certain functions to be described immediately below each of these elements performs essentially the same functions as described above in reference to like named elements of LBS delivery engine .

As also shown in LBS delivery engine further includes a time code manager . Time code manager is configured to obtain time codes generated by each of a plurality of sensors currently reporting sensor data to LBS delivery engine . As discussed above these time codes comprise part of sensor data that is periodically transmitted by each of the plurality of sensors to LBS delivery engine via sensor network and that is stored by communications manager in sensor logs database . Depending upon the implementation time code manager may obtain time codes by extracting them from sensor logs database or from location graph in an embodiment in which time codes are maintained in association with sensors mapped to location graph by location tracking manager .

Time code manager is further configured to obtain information concerning the spatial and temporal proximity of the sensors currently reporting sensor data to LBS delivery engine from location graph maintained by location tracking manager . Location tracking manager is configured to construct and maintain location graph in the same manner as described above in reference to location tracking manager and location graph of LBS delivery engine .

Time code manager is still further configured to use both the proximity information and time codes associated with each of the plurality of sensors currently reporting sensor data to LBS delivery engine to automatically validate and or correct the time codes generated by those sensors. The manner in which these functions are performed by time code manager will now described with reference to flowcharts depicted in .

In particular. depicts a flowchart of a first method by which LBS delivery engine validates and corrects time codes generated by a plurality of sensors in accordance with an embodiment of the present invention. Although the steps of flowchart will be described with continued reference to components of LBS delivery engine persons skilled in the relevant art s will readily appreciate that the method is not limited to those implementations and that other means may be used to carry out the method.

As shown in the method of flowchart begins at step in which communications manager receives sensor data provided from a plurality of sensors wherein the sensor data received from each sensor includes a time code generated by the sensor. Communications manager stores this sensor data in sensor logs database where it is accessible by location tracking manager . At step location tracking manager constructs a proximity based ad hoc network among the plurality of sensors based on the received sensor data. One manner in which location tracking manager may construct a proximity based ad hoc network based on the received sensor data was described above in reference to location tracking manager of LBS delivery engine and thus no further description of that process need be provided.

At step time code manager identifies a group of two or more spatially and temporally proximate sensors in the proximity based ad hoc network for which time code validation and or correction will be performed. The manner in which time code manager identifies the group of sensors may vary depending upon the implementation and mode of operation of time code manager . For example time code manager may identify a group based on a physical or logical partitioning of the sensors in the ad hoc network wherein such partitioning may be based on for example a predefined group size or group density or on the relative or actual location of sensors within the ad hoc network. Time code manager may also identify a group based on a perceived discrepancy between time codes generated by sensors in the group or by a measure of the degree of such discrepancy.

Despite the discrepancies between these time codes location tracking manager is capable of determining that sensors and are co located by virtue of the sensor data reported by those sensors and the sensors surrounding them. For example location tracking manager may determine that sensors and are co located at a particular time or during a particular time period because other spatially proximate sensors in group reported detecting those sensors at the same time or during the same time period. As another example location tracking manager may determine that sensors and are co located at a particular time or during a particular time period because each of these sensors reported detecting the same stationary beacon within a particular time interval. However these examples are not intended to be limiting and other methods of identifying co located sensors reporting different time codes may also be used.

Although location tracking manager is capable of determining that sensors and are co located even when such sensors are reporting different time codes it would be advantageous to validate and when appropriate correct the time codes generated by these sensors. By performing this function time code manager can improve the integrity of sensor data subsequently received from these sensors which in turn improves the ability of location tracking manager to correlate sensor data based on time codes and to identify with greater case and precision the time periods during which sensors are co located. Furthermore by performing this function time code manager enables clocks associated with the sensors to be automatically or manually reset to correct future time code generation when appropriate.

Returning now to the method of flowchart after time code manager has identified a group of spatially and temporally proximate sensors for which time code validation and or correction will be performed time code manager analyzes the time codes generated by the identified group as shown at step . In one embodiment this step comprises assigning a confidence value to each of the time codes generated by the group. The confidence value assigned to a time code is essentially a measure of the likelihood that the time code is the most accurate among all the time codes being analyzed. Accuracy may be measured relative to a notion of time maintained by other sensors in the proximity based ad hoc network or to a notion of time maintained by LBS delivery engine .

Time code manager may take into account a variety of factors in assigning a confidence value to a particular time code. For example time code manager may assign a confidence value to a time code based at least in pan on the number of sensors in the group that generated that time code wherein the more sensors that generated the time code the higher the confidence value. Time code manager may construct a histogram of the time codes generated by the group in order to perform this function.

Time code manager may assign a confidence value to a time code based at least in part on an indicator of the reliability of a sensor or sensors that generated that time code. Thus for example time code manager may assign a lower confidence value to a time code when that time code was generated by a sensor operating under adverse sensing conditions e.g. a sensor detecting beacons over a channel experiencing interference or a sensor moving at a high velocity or when that time code was generated by a sensor that has historically generated inaccurate time codes or poor sensor data.

At step time code manager modifies a time code generated by at least one sensor in the group based on the analysis performed in step . This step may include for example selecting one of the time codes generated by the group based on confidence values assigned to the time codes and or on some other factor s and then replacing a time code generated by at least one sensor in the group by the selected time code. In another embodiment this step may comprise combining or averaging one or more time codes generated by the group based on the confidence values assigned to the time codes and or on some other factor s to generate a combined time code and then replacing a time code generated by at least one sensor in the group by the combined time code. This step may also comprise adding or subtracting a time offset to a time code generated by at least one sensor in the group.

The foregoing method advantageously applies collaborative filtering to time codes generated by co located sensors to validate and or correct the time codes generated by those sensors. In further accordance with this embodiment once time code manager has identified a sensor that has generated an inaccurate time code it can take steps to ensure that future time codes provided by the same sensor are more accurate. For example time code manager can apply a predetermined offset to subsequently received time codes generating by the same sensor to ensure that such time codes are more accurate. Alternatively time code manager can send a command to the sensor wherein the command causes the state of a clock used by the sensor to generate time codes to be modified automatically. Still further time code manager can send a notification to a user of the sensor indicating that a state of a clock associated with the sensor should be modified so that the user can modify the clock manually.

As shown in the method of flowchart begins at step in which communications manager receives sensor data provided from a plurality of sensors wherein the sensor data received from each sensor includes a time code generated by the sensor. Communications manager stores this sensor data in sensor logs database where it is accessible by location tracking manager . At step location tracking manager constructs a proximity based ad hoc network among the plurality of sensors based on the received sensor data. One manner in which location tracking manager may construct a proximity based ad hoc network based on the received sensor data was described above in reference to location tracking manager of LBS delivery engine and thus no further description of that process need be provided.

At step location tracking manager determines a geographic location of a first sensor in the proximity based ad hoc network. Location tracking manager may determine the geographic location of the first sensor by analyzing location information that is provided by the first sensor to LBS delivery engine along with other sensor data. Such location information may include for example location information provided by a GPS module or other positioning module within the first sensor or location information e.g. a zip code street address or the like provided by a user of the first sensor. Alternatively location tracking manager may determine the geographic location of the first sensor by propagating location information from a spatially and temporally proximate sensor to the first sensor in a like manner to that described above in reference to flowchart of .

At step time code manager obtains local time information based on the geographic location of the first sensor. For example time code manager may use the geographic location of the first sensor to determine the time zone in which the first sensor is currently located and to determine a local time associated with the time zone.

At step time code manager uses the local time information to correct a time code generated by a second sensor that is spatially proximate to the first sensor in the proximity based ad hoc network. For example time code manager may compare the time code generated by the second sensor to the local time determined in step and correct the time code responsive to detecting a discrepancy.

The foregoing method advantageously uses geographic location information associated with or propagated among certain sensors in the ad hoc network to obtain a local time that can then be used to validate and correct time codes generated by co located sensors. In further accordance with this embodiment once time code manager has identified a sensor that has generated an inaccurate time code it can take steps to ensure that future time codes provided by the same sensor are more accurate. For example time code manager can apply a predetermined offset to subsequently received time codes generating by the same sensor to ensure that such time codes are more accurate. Alternatively time code manager can send a command to the sensor wherein the command causes the state of a clock used by the sensor to generate time codes to be modified automatically. Still further time code manager can send a notification to a user of the sensor indicating that a state of a clock associated with the sensor should be modified so that the user can modify the clock manually.

It would be advantageous if users of portable electronic devices could easily transfer data between such devices. However conventional protocols for establishing a communication link between compatible devices can be time consuming. For example in order to pair two Bluetooth devices together at least one of the two devices must be placed in a mode in which it can discover the other device. Once the other device has been discovered the same passkey must be entered into each of the two devices. Only after this process is complete can data be shared between the two devices. This is a cumbersome process. Furthermore where user devices are not compatible e.g. where one device supports only Bluetooth communication and the other supports only WiFi communication direct data transfer between the devices is simply not possible.

It would also be beneficial if information could be automatically transferred between user devices responsive to co location of those devices. Such a system could advantageously be used for example to exchange information or notifications among users who are personally and or professionally related or users who are likely to form such a relationship at a point in time when such users are proximally located. Such a system could also advantageously be used to distribute marketing information or other commercial information to and among proximally located users. These are only a few examples of the benefits of such a system. However such automatic data transfer should be carried out in a manner that protects user privacy.

As shown in LBS delivery engine includes a number of communicatively connected elements including a user interface an LBS provider interface a communications manager a user data database an LBS data database a location tracking manager a location graph a matching manager and a sensor logs database . With the exception of certain functions to be described immediately below each of these elements performs essentially the same functions as described above in reference to like named elements of LBS delivery engine .

As also shown in LBS delivery engine further includes a data sharing manager . Data sharing manager is configured to facilitate the transfer of user data between and among proximally located sensors by receiving user data from a first sensor and then transferring such user data to one or more other sensors when such other sensor s is are temporally and spatially proximate to the first sensor. Thus data sharing manager allows LBS delivery engine to act as an intermediary between the first sensor and the other sensor s for the purposes of such data transfer. This is illustrated in which shows a system in which a first sensor transfers user data to LBS delivery engine and in which LBS delivery engine transfers copies of the user data to each of a plurality of proximally located sensors .

To perform this function data sharing manager is configured to determine which sensors are proximally located by accessing the current graph of sensor locations which is maintained by location tracking manager in a manner described in detail above. Data sharing manager is also configured to determine whether other conditions beyond sensor proximity have been satisfied prior to performing a data transfer. These conditions may include user specified conditions or preferences relating to privacy to eligible data transfer sources or targets or to other aspects of data transfer that are stored in user data database . These user specified conditions or preferences may be provided or set by a user via user interface .

Depending upon the implementation user data eligible for transfer is provided to data sharing manager from a user device via sensor network and or via user interface . Such user data may be directly provided to data sharing manager or may be stored in user data database and accessed by data sharing manager when certain conditions for data transfer are satisfied.

By acting as an intermediary between co located sensors for the purposes of data transfer data sharing manager facilitates data sharing in a manner that does not require a local link to be established between or among those sensors. As noted above establishing such a link can be time consuming and burdensome for users. Furthermore in instances where such local links are more bandwidth constrained than links to LBS delivery engine data transfer via LBS delivery engine may be significantly more efficient than a transfer between sensors over a local communication link.

Also by acting as an intermediary between co located sensors for the purposes of data transfer data sharing manager allows data to be shared between sensors that would otherwise be incapable of detecting and or communicating with each other. For example data sharing manager can transfer data between and among WiFi devices cellular telephones and Bluetooth devices that would not normally be able to detect or communicate with each other.

Furthermore by acting as an intermediary between co located sensors for the purposes of data transfer data sharing manager can automatically cause data to be transferred between such devices based on proximity and any of a variety of other factors such as commonality of user interests and or activities or membership in a social network. However because data sharing manager acts as the intermediary in brokering such transfers it can advantageously implement filters to validate user data and protect user privacy.

One manner by which LBS delivery engine transfers data between and among sensors in accordance with an embodiment of the present invention will now be described in reference to flowchart of . Although the steps of flowchart will be described with continued reference to components of LBS delivery engine persons skilled in the relevant art s will readily appreciate that the method is not limited to those implementations and that other means may be used to carry out the method.

As shown in the method of flowchart begins at step in which communications manager receives sensor data provided from each of a plurality of sensors. Communications manager stores this sensor data in sensor logs database where it is accessible by location tracking manager . At step location tracking manager constructs a proximity based ad hoc network among the plurality of sensors based on the received sensor data. One manner in which location tracking manager may construct a proximity based ad hoc network based on the received sensor data was described above in reference to location tracking manager of LBS delivery engine and thus no further description of that process need be provided.

At step data sharing manager determines that a first sensor in the plurality of sensors is spatially and temporally proximate to a second sensor in the plurality of sensors based on the proximity based ad hoc network. In one embodiment data sharing manager performs this function by accessing the current graph of sensor locations which is maintained by location tracking manager in a manner described above.

At step data sharing manager transfers user data received from the first sensor to the second sensor responsive to at least determining that the first sensor is spatially and temporally proximate to the second sensor. The user data is transferred to the second sensor via sensor network .

The user data that is received from the first sensor may be any type of user data including but not limited to any type of text graphics audio and or video content or files. The user data may also include a link or permission to access and optionally modify network accessible content or data. The user data may be intended for delivery to a single individual or entity or for broadcast to a plurality of individuals or entities. Where the data transfer functionality of LBS delivery engine is used to introduce proximally located users for the purposes of building a personal or business relationship the user data may comprise a user profile a business card a classified advertisement a personals advertisement a resume or a help wanted posting. Other examples of user data in the nature of personal broadcasts are described in co owned and commonly pending U.S. patent application Ser. No. 11 957 052 entitled Personal Broadcast Engine and Network and filed on Dec. 14 2007 the entirety of which is incorporated by reference herein.

The user data that is received from the first sensor may be received by communications manager from sensor network and then provided directly to data sharing manager for transfer to the second sensor. Alternatively the user data that is received from the first sensor may be received via user interface and then stored in user data database . In this case data sharing manager accesses the user data stored in user data database when certain conditions for data transfer are satisfied. The data transfer process may be initiated by a user or a process running on a sensor or LBS delivery engine .

As noted above data sharing manager is capable of transferring data between individual sensors as well as broadcasting data from a first sensor to a plurality of other sensors. Thus in step transferring the user data received from the first sensor to the second sensor may include transferring the user data to a plurality of sensors that are spatially and temporally proximate to the first sensor.

As also noted above by acting as an intermediary between co located sensors for the purposes of data transfer data sharing manager allows data to be shared between sensors that would otherwise be incapable of detecting and or communicating with each other. Thus in accordance with the method of flowchart the first sensor may be of a first device type and the second sensor may be of a second device type that is incapable of directly communicating with the first device type. Such device types may include WiFi devices cellular telephones and Bluetooth devices.

The foregoing method also allows the first and second sensor to share data even when those sensors are not currently capable of detecting each other. For example location tracking manager may determine that the first and second sensors are proximally located by determining that each sensor is proximally located to a third sensor in the plurality of sensors. This third sensor may be sensed by both the first or second sensors or by sensors that are proximally located to those sensors. Thus LBS delivery engine allows data to be transferred between sensors that are only indirectly connected through a number of intermediate nodes e.g. sensors or beacons in the proximity based ad hoc network constructed and maintained by location tracking manager .

The data transfer between the first sensor and the second sensor in step may advantageously be conditioned on the identification of relationship between a user of the first sensor and a user of the second sensor. This relationship may be based on user data relating to one or more activities interests preferences and or social networks associated with each user. Where data transfer is automatic such filtering allows data to be transferred only to users that share some sort of commonality with the source of the data.

The data transfer between the first sensor and the second sensor in step may also be conditioned on a determination as to whether the transfer is authorized. This ensures that user privacy is protected. Data sharing manager may make this determination for example based on permissioning rules associated with a user of the first sensor and or a user of the second sensor. Such permissioning rules may be stored in user data database and accessed when required by data sharing manager .

Although the foregoing section describes a method for sharing data between proximally located sensors in a proximity bused ad hoc network it is noted that the foregoing approach can advantageously be used to share data with or between devices and objects that are configured to or capable of acting as beacons only. So long as such beacons are detected by at least one sensor that is currently reporting sensor data to LBS delivery engine those beacons can also be located within the proximity based ad hoc network by location tracking manager . Consequently such beacons can then also participate in data sharing activities with other sensors or beacons in the proximity based ad hoc network in a like manner to that described above.

The foregoing data sharing method can beneficially be used to easily share information with proximally located users. For example the foregoing data sharing method can be used to easily share data prepared for or generated during a meeting among the meeting participants such as meeting notes audio and or video recordings photos follow up meeting information or other data. The method can also be used for example to generate invitations or requests to other proximally located users to connect on any online social network event meeting trip or the like.

The foregoing data sharing method can advantageously provide users with real time information about proximally located people. As a result the foregoing data sharing method can advantageously be used to obtain information about a person that a user is currently meeting in real time. This may include querying a person s CV online or performing a web search about a person. The foregoing data sharing method can also be used to maintain a history of people encountered by a user over time and to display history information to the user. For example the history information for a given encounter may include such information as a time place duration event name event type or the like.

In accordance with one embodiment of the present invention the sharing of data with proximally located users facilitates the creation of a graph of user encounters. For example a sensor can create a mesh of encounters or connections between all discoverable devices in range. Such encounter information can be used for example to provide users with notifications concerning current or past user encounters and or to build a social graph based on accumulated real world encounters.

In a further embodiment of the present invention a user may create a tag for a proximally located person. This tag may then be displayed on a public profile associated with that person. In one implementation the person must approve of the tag before it is displayed on the public profile.

Each of the components of the LBS delivery engines and sensors described herein may be implemented alone or in combination by any well known processor based computer system. An example of such a computer system is depicted in .

As shown in computer system includes a processing unit that includes one or more processors. Processor unit is connected to a communication infrastructure which may comprise for example a bus or a network.

Computer system also includes a main memory preferably random access memory RAM and may also include a secondary memory . Secondary memory may include for example a hard disk drive a removable storage drive and or a memory stick. Removable storage drive may comprise a floppy disk drive a magnetic tape drive an optical disk drive a flash memory or the like. Removable storage drive reads from and or writes to a removable storage unit in a well known manner. Removable storage unit may comprise a floppy disk magnetic tape optical disk or the like which is read by and written to by removable storage drive . As will be appreciated by persons skilled in the relevant art s removable storage unit includes a computer usable storage medium having stored therein computer software and or data.

In alternative implementations secondary memory may include other similar means for allowing computer programs or other instructions to be loaded into computer system . Such means may include for example a removable storage unit and an interface . Examples of such means may include a program cartridge and cartridge interface such as that found in video game devices a removable memory chip such as an EPROM or PROM and associated socket and other removable storage units and interfaces which allow software and data to be transferred from the removable storage unit to computer system .

Computer system may also include a communications interface . Communications interface allows software and data to be transferred between computer system and external devices. Examples of communications interface may include a modem a network interface such as an Ethernet card a communications port a PCMCIA slot and card or the like. Software and data transferred via communications interface are in the form of signals which may be electronic electromagnetic optical or other signals capable of being received by communications interface . These signals are provided to communications interface via a communications path . Communications path carries signals and may be implemented using wire or cable fiber optics a phone line a cellular phone link an RF link and other communications channels.

As used herein the terms computer program medium and computer usable medium are used to generally refer to media such as removable storage unit removable storage unit a hard disk installed in hard disk drive and signals received by communications interface . Computer program medium and computer useable medium can also refer to memories such as main memory and secondary memory which can be semiconductor devices e.g. DRAMs etc. . These computer program products are means for providing software to computer system .

Computer programs also called computer control logic programming logic or logic are stored in main memory and or secondary memory . Computer programs may also be received via communications interface . Such computer programs when executed enable the computer system to implement features of the present invention as discussed herein. Accordingly such computer programs represent controllers of the computer system . Where the invention is implemented using software the software may be stored in a computer program product and loaded into computer system using removable storage drive interface or communications interface .

The invention is also directed to computer program products comprising software stored on any computer useable medium. Such software when executed in one or more data processing devices causes a data processing device s to operate as described herein. Embodiments of the present invention employ any computer useable or readable medium known now or in the future. Examples of computer useable mediums include but are not limited to primary storage devices e.g. any type of random access memory and secondary storage devices e.g. hard drives floppy disks CD ROMS zip disks tapes magnetic storage devices optical storage devices MEMs nanotechnology based storage device etc. .

While various embodiments of the present invention have been described above it should be understood that they have been presented by way of example only and not limitation. It will be understood by those skilled in the relevant art s that various changes in form and details may be made therein without departing from the spirit and scope of the invention as defined in the appended claims. Accordingly the breadth and scope of the present invention should not be limited by any of the above described exemplary embodiments but should be defined only in accordance with the following claims and their equivalents.

