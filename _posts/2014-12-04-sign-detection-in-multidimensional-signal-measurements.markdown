---

title: Sign detection in multi-dimensional signal measurements
abstract: Systems, methods, circuits and computer-readable mediums are disclosed for sign detection in multi-dimensional signal measurements. In some implementations, orthogonally oriented antennas are configured to generate signals in response to a magnetic field, where the signals correspond to components of magnetic field vectors in space. A circuit is coupled to the antennas and configured to: determine polarities of the signals based on phase measurements between the signals; reduce a possible number of magnetic field vector interpretations based on the determined polarities of the signals; reduce a possible number of angles or angle differences between the magnetic field vectors based on the reduced possible number of magnetic field vector interpretations; compare the reduced possible number of angles or angle differences to predetermined angle or angle differences; and detect a relay attack based on results of the comparing.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09355509&OS=09355509&RS=09355509
owner: Atmel Corporation
number: 09355509
owner_city: San Jose
owner_country: US
publication_date: 20141204
---
This application claims priority to U.S. Provisional Application Ser. No. 62 084 517 filed on Nov. 25 2014 the entire contents of which are hereby incorporated by reference.

Contactless data communication has been employed in multiple industries including the automotive industry. There contactless data communication is used to gain access to a vehicle. A key or key fob is held by a person and is operable to communicate with a vehicle when the key fob is within range of wireless communication with the vehicle. The person may press a button on the vehicle or lift the handle of a door of the vehicle to initiate communication between the vehicle and the key or key fob. Once communication is initiated the vehicle and the key or key fob may exchange messages to allow the person access to the vehicle. For example the key or key fob may transmit one or more authentication messages that the vehicle validates.

One problem that has arisen with contactless data communication is that it is susceptible to a relay attack. In the context of access to vehicles this attack includes a person initiating the communication with the vehicle by pushing a button on the vehicle or lifting a handle on the vehicle s door. The vehicle then transmits a signal which is captured by the person and relayed to a remote device using a transceiver. The remote device may be located away from the vehicle but in proximity to the key or key fob. For example the vehicle may be in a parking lot of a restaurant and the owner of the vehicle may be in the restaurant. The remote device may be located inside the restaurant and may relay the signal transmitted by the vehicle in the restaurant. The key fob while in the possession of the owner may receive the signal transmitted by the vehicle as a result of the remote device and may respond with authentication signals. The remote device may capture the authentication signals and transmit them to the person in proximity with the vehicle who initiated the communication. The transceiver held by the person may transmit the authentication signals to the vehicle and the vehicle may validate the authentication signals. This may allow an unauthorized person access to the vehicle.

Systems methods circuits and computer readable mediums are disclosed for sign detection in multi dimensional signal measurements.

In some implementations a system includes orthogonally oriented antennas that are configured to generate signals in response to a magnetic field where the signals correspond to components of magnetic field vectors in space. A circuit is coupled to the antennas and configured to determine polarities of the signals based on phase measurements between the signals reduce a possible number of magnetic field vector interpretations based on the determined polarities of the signals reduce a possible number of angles or angle differences between the magnetic field vectors based on the reduced possible number of magnetic field vector interpretations compare the reduced possible number of angles or angle differences to predetermined angle or angle differences and detect a relay attack based on results of the comparing.

In some implementations a method comprises generating by orthogonally oriented antennas of a system signals in response to a magnetic field where the signals correspond to components of magnetic field vectors in space determining by a circuit of the system polarities of the signals based on phase measurements between the signals reducing by the circuit a possible number of magnetic field vector interpretations based on the determined polarities of the signals reducing by the circuit a possible number of angles or angle differences between the magnetic field vectors based on the reduced possible number of magnetic field vector interpretations comparing by the circuit the reduced possible number of angles or angle differences to predetermined angle or angle differences and detecting by the circuit a relay attack based on results of the comparing.

In some implementations a non transitory computer readable storage medium includes instructions which when executed by one or more processors causes the one or more processors to perform operations comprising generating by orthogonally oriented antennas of a system signals in response to a magnetic field where the signals correspond to components of magnetic field vectors in space determining by a circuit of the system polarities of the signals based on phase measurements between the signals reducing by the circuit a possible number of magnetic field vector interpretations based on the determined polarities of the signals reducing a possible number of angles or angle differences between the magnetic field vectors based on the reduced possible number of magnetic vector interpretations comparing the reduced possible number of angles or angle differences to predetermined angles or angle differences and detecting a relay attack based on results of the comparing.

One type of contactless data communication for vehicles is the passive entry passive start PEPS system. The PEPS system uses several low frequency LF antennas within a vehicle that are operated sequentially together with a key or key fob incorporating a three dimensional 3D magnetic antenna to detect a transmitted magnetic field from the LF vehicle antennas. The key or key fob includes an LF receiver that provides three communication channels to receive the 3 orientations x y z of a magnetic field transmitted by the LF vehicle antennas. The three communication channels provide voltages that can be measured and used to calculate a received signal strength indicator RSSI .

The measured channel voltages x y z represent a vector per each transmitting vehicle antenna having an amplitude and an orientation within a 3D space where the amplitude is given by Amplitude square root over . 1 

To avoid the relay attack scenario described above the angles between the vectors can be calculated. Indeed an embodiment provides that angles between vectors can be used for defending against relay attacks for two antennas that are operated sequentially or at the same time. When two vehicle antennas are operated sequentially two individual triples x y z of voltages can be measured sequentially from the LF receiver channels representing the two vectors generated by the two car antennas.

As an example assume that two vectors and are measured having components 1 4 2 and 3 3 1 respectively. The amplitudes of these vectors can be calculated Amplitude square root over 1 4 2 4.58 Amplitude square root over 3 3 1 4.36

As can be seen in this example the individual vector components x y z can have different polarities according to the orientation and the position of the receiving 3D antenna e.g. key or key fob and the transmitting vehicle antenna. Receivers that are in the market today do not measure the polarity of the channel voltages. For example there can be eight possible interpretations of the measured vector components x y z . In the above example vector a could be interpreted as 1 4 2 1 4 2 1 4 2 1 4 2 1 4 2 1 4 2 1 4 2 and 1 4 2 . The eight interpretations of vector could be interpreted as 3 3 1 3 3 1 3 3 1 3 3 1 3 3 1 3 3 1 3 3 1 and 3 3 1 . The resulting vector amplitudes are not affected by the multiple interpretations by the term . The resulting calculations will result in 8 8 64 different interpretations where some of these are equal. For the vectors a and b in the above example results in the following 64 values 

Due to the chosen example many of the samples are equal but even in this case eight different values are possible 7 7 11 11 13 13 17 17 . This results in 64 calculated angles.

Out of the 64 angles possible angles there are eight different angles 69.5 56.6 148.3 130.6 49.4 31.7 123.4 110.5 . Due to the variety of angle interpretations and taking some measurement tolerances into account it is not reliably possible to use the calculated angle for relay attack purposes. As can be observed by the above example it is desirable to greatly reduce the number of possible angle interpretations. As described in detail below the number of possible angle interpretations can be reduced by measuring the polarity of the individual vector components x y z .

Referring to a diagram is shown with three signals. Signal shows the input signal of an individual channel x y z . Signal represents the threshold signal of the comparator. Signal represents the output of the comparator.

To detect the polarity between two individual channels x y or x z or y z the comparator output signals comp out of two individual channels are combined by an AND function. If comp out x AND comp out y is TRUE at any time y is in phase with x. If comp out x AND comp out z is TRUE at any time z is in phase with x. If comp out y AND comp out z is TRUE at any time z is in phase with y.

It can be observed from the examples shown in that there is usually some phase tolerance for in phase channels and opposite polarity channels which will influence the selection of the comparator threshold value. To ensure that in phase channels are detected securely the comparator value should be low. To prevent that channels with opposite polarity are falsely recognized as in phase the comparator value should be high. In some implementations an optimum compromise is to set the comparator threshold value where it is exceeded by 50 of the time during the positive half wave 90 . Thus the comparator threshold value can be set to

In some implementations the polarity information can be used to improve the evaluation of the measured vector components x y z that are measured from several antennas Ax Ay Az . For example angle and or angle difference determination between vectors resulting from different vehicle transmit antennas can be calculated. In some implementations ratios between the same vector component measurements from different vehicle transmit antennas can be determined such as Vx A1 VxA2 VyA1 VyA2 VzA1 Vz2 where A1 A2 are two different vehicle transmit antennas. In some implementations ratios between different vector component measurements from different vehicle transmit antennas can be determined such as VxAn VyAn VxAn VzAn VyAn VzAn. The ratios can be extended to any number of vehicle transmit antennas.

In this example implementation the amplifier output signals are compared at 70.7 of their peak voltage by channel comparators while the peak value of all channels is equal due to the RSSI control mechanism. The comparator output signals of the individual channels have a duty cycle of 25 90 of 360 and are compared to each other by logic gates which in this example are implemented as AND functions e.g. AND gates as follows 

Outputs are generated by AND gates when two comparator output signals are present at the same time thereby indicating that the two channels being compared are in phase. If two channels are in phase they have the same polarity being out of phase indicates that they have opposite polarity.

Returning to the previous example described in reference to the 8 possible vector interpretations without sign detection are 1 4 2 1 4 2 1 4 2 1 4 2 1 4 2 1 4 2 1 4 2 and 1 4 2 . Using the sign detection process implemented by system and noting that channels x and y are in phase and channels x and z are not in phase the 8 possible vector interpretations are reduced to two vector interpretations 1 4 2 and 1 4 2 . This example reduction in vector interpretations was accomplished by detecting via the sign detection mechanism that channel x has the same polarity as channel y and channel z has opposite polarity in respect to channel x. The only vector interpretations in the example set of 8 vector interpretations that meet this reduction criterion are 1 4 2 and 1 4 2 .

Likewise the possible vector interpretations without sign detection are 3 3 1 3 3 1 3 3 1 3 3 1 3 3 1 3 3 1 3 3 1 and 3 3 1 . Using the sign detection process implemented by system the 8 possible vector interpretations are reduced to two vector interpretations 3 3 1 and 3 3 1 . With sign detection implemented results in 2 2 4 possible vector interpretations which in this example are 7 7 7 7 . The angle calculation of Equation 2 results in 69.5 110.5 110.5 69.5 which means that only two different angles 69.6 110.5 need to be evaluated for relay attack prevention in a PEPS system.

In some embodiments transceiver SE comprises three antennas EA EA and EA that are oriented orthogonally relative to each other. Receiving antennas EA EA and EA are coupled to signal amplifiers V V and V respectively. Signal amplifiers V V and V are coupled to inputs EAD EAD and EAD of an analog to digital A D converter AD respectively. Furthermore each input EAD EAD and EAD of the A D converter AD is coupled with input ED ED and ED of a demodulator DEM respectively. In this manner the signal received by each one of the receiving antennas EA EA and EA can be individually demodulated to obtain and evaluate the data being carried by the modulated signal as received by each of the receiving antennas. The A D converter AD and the demodulator DEM are also each respectively coupled with a signal processor SP which in turn is further coupled with a memory unit MEM. In some embodiments elements similar to A D converter AD demodulator DEM signal processor SP and memory unit MEM may be included in transceiver SE.

In some embodiments signal processor SP includes hardware for executing instructions such as those making up a computer program. As an example and not by way of limitation to execute instructions signal processor SP may retrieve or fetch the instructions from an internal register an internal cache memory unit MEM or storage decode and execute them and then write one or more results to an internal register an internal cache memory unit MEM or storage. In particular embodiments signal processor SP may include one or more internal caches for data instructions or addresses. This disclosure contemplates signal processor SP including any suitable number of any suitable internal caches where appropriate.

This disclosure contemplates one or more computer readable storage media implementing any suitable storage. In particular embodiments a computer readable storage medium implements one or more portions of signal processor SP such as for example one or more internal registers or caches one or more portions of memory unit MEM or a combination of these where appropriate. In particular embodiments a computer readable storage medium implements RAM or ROM. In particular embodiments a computer readable storage medium implements volatile or persistent memory. In particular embodiments one or more computer readable storage media embody software. Herein reference to software may encompass one or more applications byte code one or more computer programs one or more executable one or more instructions logic machine code one or more scripts or source code and vice versa where appropriate. In particular embodiments software includes one or more application programming interfaces APIs . This disclosure contemplates any suitable software written or otherwise expressed in any suitable programming language or combination of programming languages. In particular embodiments software is expressed as source code or object code. In particular embodiments software is expressed in a higher level programming language such as for example C Perl or a suitable extension thereof. In particular embodiments software is expressed in a lower level programming language such as assembly language machine code or hardware description language.

In some implementations process can begin by receiving orthogonal channel signals . For example the signals can be analog signals received from 3 orthogonally oriented antennas that are converted e.g. AD to digital signals that can be processed by digital processor e.g. SP .

Process can continue by measuring the channel signals including determining sign information . For example the channel signals can be inputs to comparator functions to determine if the channels are in phase same sign or polarity or out of phase different sign or polarity where each channel represents a vector component of a received magnetic field. The comparing function can be implemented in hardware or software by a signal processor or a combination of both hardware and software components.

Process can continue by reducing the possible number of vector interpretations based on the sign information . For example if the x and y channels have the same signs same polarity and the x and z channel signals have different signs different polarity than the vector interpretations that have different signs for the x and y channels or the same sign for the x and z channels are excluded from further processing for angle or angle difference evaluations or vector component ratios.

Process can continue by detecting a relay attack based on the reduced set of vector determinations . For example the reduced vector interpretations determined in step can be used to generate a set of angles or angle differences or vector component ratios between the reduced set of vectors which can be compared together with the RSSI value with a predetermined or expected set of angles or angle differences or vector component ratios to determine if the expected criteria to detect a relay attack situation are met. If these criteria are met within a certain tolerance range the key or key fob will not transmit an authentication code to the vehicle thereby preventing relay attacks.

Although in example step the reduced possible number of magnetic vector interpretations is used to detect relay attacks against for example a PEPS system process can also be applied to any application that could benefit from reducing a possible number of vector interpretations in a vector space and thus should not be construed to be limited to magnetic field vectors or detecting relay attacks.

While this document contains many specific implementation details these should not be construed as limitations on the scope what may be claimed but rather as descriptions of features that may be specific to particular embodiments. Certain features that are described in this specification in the context of separate embodiments can also be implemented in combination in a single embodiment. Conversely various features that are described in the context of a single embodiment can also be implemented in multiple embodiments separately or in any suitable sub combination. Moreover although features may be described above as acting in certain combinations and even initially claimed as such one or more features from a claimed combination can in some cases be excised from the combination and the claimed combination may be directed to a sub combination or variation of a sub combination.

