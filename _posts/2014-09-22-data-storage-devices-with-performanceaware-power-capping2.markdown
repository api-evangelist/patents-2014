---

title: Data storage devices with performance-aware power capping
abstract: Systems, methods, and firmware for power control of data storage devices are provided herein. In one example, a data storage device is presented. The data storage device includes a storage control system to identify a power threshold for the data storage device. The data storage device determines power consumption characteristics for the data storage device and enters into a power controlled mode for the data storage device that adjusts at least a storage transaction queue depth in the data storage device to establish the power consumption characteristics as below the power threshold for the data storage device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09541988&OS=09541988&RS=09541988
owner: Western Digital Technologies, Inc.
number: 09541988
owner_city: Irvine
owner_country: US
publication_date: 20140922
---
Computer and network systems such as personal computers workstations server systems and cloud storage systems typically include data storage systems for storing and retrieving data. These data storage systems can include data storage devices such as hard disk drives solid state storage devices tape storage devices and other mass storage devices.

The recent demand for digital contents and big data are fueling the need for more denser and larger data centers. Power dissipation of data centers is a matter of concern. Data centers are frequently constrained by the allowed peak power at their disposal. Peak power capacity is important because both the power conditioning and distribution infrastructure and the cooling systems must be sized based on their combined peak power requirements.

Data center operators oversubscribe data centers power supply with more machine servers and users than the maximum allowable at any time to maximize their utilization. Power capping has been employed in data centers to set maximum power usages for the various computing systems contained in the data centers. However power dissipation by individual components of the computing systems is limited to very coarse adjustments such as sleep modes or powering down of unused computing elements.

Systems methods and firmware for power control of data storage devices are provided herein. In one example a data storage device is provided. The data storage device includes a storage control system to identify a power threshold for the data storage device. The data storage device determines power consumption characteristics for the data storage device and enters into a power controlled mode for the data storage device that adjusts at least a storage transaction queue depth in the data storage device to establish the power consumption characteristics as below the power threshold for the data storage device.

Data storage systems employ various mass storage devices such as hard disk drives solid state drives among other storage devices. However these storage devices can use high levels of power which can lead to excessive power consumption by data centers which aggregate many data storage systems together. In the examples discussed below various methods systems apparatuses and firmware allow for fine grained control of power consumption in the various mass storage devices used in data servers and data storage systems. For example a hard disk drive can be placed into a power capped mode which modifies parameters of the hard disk drive to allow storage operations to fall below a power threshold for that hard disk drive. Other examples of power capping and power control of data storage devices are discussed below.

As a first example is presented. illustrates storage system for performance aware power capping in data storage devices. Storage system comprises data storage device and host system . Data storage device and host system communicate over link . Data storage device comprises storage media storage control system and queue . Storage media includes any physical media which can be used to store the desired information and that can be accessed by an instruction execution system such as storage control system . Storage control system includes processing circuitry and memory for accessing storage media . Queue comprises a data structure of commands for data storage device such as read or write commands. Host system includes one or more computing and network systems such as personal computers servers or other computer and network systems. In operation host system transfers power threshold and or queue depth to data storage device . Data storage device receives power threshold and or queue depth from host system .

In a first example of data storage device performs the operations of although it should be understood that operations in can be performed by host system as mentioned above. Data storage device identifies power threshold for data storage device . Power threshold indicates allowable maximum or minimum power consumption characteristics for data storage device . Power threshold specifies power consumption threshold values in Watts or other units of power or energy dissipation which can be based on a current draw and supply voltage of data storage device . Data storage device determines power consumption characteristics for data storage device . Power consumption characteristics can be defined in various ways. For example power consumption characteristics may indicate maximum allowable power dissipation per a unit of time or per a transaction for data storage device . Data storage device enters into a power controlled mode for data storage device .

A power controlled mode is an operating mode for data storage device that provides a fine degree of control over the power consumption characteristics of data storage device by controlling queue depth . Two possible power controlled modes include latency mode and throughput mode obtained by tuning queue . Latency mode offers fast response time by decreasing queue depth . Throughput mode offers efficient performance for data streams by increasing queue depth . Data storage device responsively adjusts at least queue depth in data storage device . Queue depth can be controlled by storage control system or host system . Latency mode and throughput mode can be achieved by controlling queue depth . Data storage device establishes power consumption characteristics as below power threshold for data storage device . Data storage device monitors power consumption characteristics of data storage device and responsively adjusts power controlled modes and queue depth to establish and maintain desirable power consumption characteristics. Power consumption characteristics monitoring may be either continuous or discrete.

As further examples of controlling power consumption in data storage drives are presented. further illustrate methods of operating storage system for performance aware power capping in data storage devices. illustrates a method of operating storage system performed by data storage device for performance aware power capping in data storage devices. illustrates a method of operating storage system performed by host system for performance aware power capping in data storage devices.

Referring back to the elements of storage system are further described below. Data storage device can be a hard disk drive HDD solid state storage drive SSD flash memory drive phase change memory drive optical memory drive or some other type of data storage device including combinations and variations thereof. Data storage device includes electrical components such as host interfaces processing circuitry data buffers memory and read write heads.

Storage media includes any physical media which can be used to store the desired information and that can be accessed by an instruction execution system such as storage control system . Examples of storage media include random access memory read only memory magnetic disks optical disks flash memory phase change memory virtual memory and non virtual memory magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and that can be accessed by an instruction execution system as well as any combination or variation thereof or any other type of storage media.

Storage control system includes processing circuitry and memory for accessing storage media . Storage control system which further includes processing circuitry memory host interface and buffer. Memory also includes firmware which is executed by at least storage control system to operate and respond to read and write commands received over link .

Host system can include one or more computing and network systems such as personal computers server computers rack servers web servers cloud computing platforms packet networks management systems and data center equipment as well an any other type of physical or virtual server machine and any variation or combination thereof. In operation host system issues read and write commands to data storage device over link . In further examples host system can issue one or more commands for data storage device to enter into a power controlled mode.

Link can include one or more links. Link comprises metallic wireless optical or some other network link including combinations thereof. Link can comprise any storage or disk interface such as Serial Attached ATA SATA Serial Attached SCSI SAS FiberChannel Universal Serial Bus USB SCSI InfiniBand Peripheral Component Interconnect Express PCIe Ethernet Internet Protocol IP or other parallel or serial storage or peripheral interfaces including variations and combinations thereof. Link utilizes various communication and control protocols such as LTE GSM CDMA Internet Protocol IP Ethernet Session Initiation Protocol SIP Diameter Real time Transfer Protocol RTP and or some other format including combinations thereof.

Data storage device comprises storage media storage control system queue and power measurement system . Data storage device may be a hard disk drive a removable disk storage drive a solid state drive a tape drive or some other storage device having power consumption characteristics affected by queue depth .

Storage control system includes processing circuitry and memory. Processing circuitry can comprise one or more microprocessors and other circuitry that retrieves and executes firmware from memory. Processing circuitry can be implemented within a single processing device but can also be distributed across multiple processing devices or sub systems that cooperate in executing program instructions. Examples of processing circuitry include general purpose central processing units application specific processors and logic devices as well as any other type of processing device combinations or variations thereof. Storage control system may increase queue depth to increase throughput above a throughput threshold while power consumption characteristics are maintained below power threshold . Alternatively storage control system may decrease queue depth to reduce latency to below a latency threshold while the power consumption characteristics are maintained below the power threshold. Storage control system may configure a sampling rate establish a measurement period and select among a time based power measurement and a transaction based power measurement. Host system is capable of performing the same operations as storage control system .

Storage media includes random access memory read only memory magnetic disks optical disks flash memory phase change memory magnetic tape or other storage media including combinations and variations thereof. In many examples data storage device includes various mechanical electrical and electromechanical components for reading and writing to storage media such as read write heads armatures optical read write elements servos preamps amplifiers or other components including combinations thereof.

Power measurement system measures at least power usage by data storage device . Power measurement system may take power measurements instantaneously over a specified time period or per data storage device transaction. The operation of power measurement system of data storage device may be controlled by host system . Power measurement system may continuously and periodically communicate with host system for power measurement system settings.

Host system comprises processor and memory . Host system can include one or more computing and network systems such as personal computers servers cloud storage systems packet networks management systems or other computer and network systems including combinations and variations thereof. In operation host system issues read and write commands to data storage device over link . In some examples host system issues commands to data storage device . For example host system can enable or disable power measurement system and issue measurement commands to power measurement system . Host system can also command data storage device to enter into a power controlled mode. Host system is also capable of adjusting queue depth to establish desirable power consumption characteristics for data storage device . Host system transfers power threshold and or queue depth to data storage device . Host system configures sampling rate establishes a measurement period and selects between a time based power measurement and a transaction based power measurement.

Processor comprises one or more microprocessors and other circuitry that retrieves and executes firmware from memory. Processing circuitry can be implemented within a single processing device but can also be distributed across multiple processing devices or sub systems that cooperate in executing program instructions. Examples of processing circuitry include general purpose central processing units application specific processors and logic devices as well as any other type of processing device combinations or variations thereof.

Memory comprises file system . Examples of memory include random access memory read only memory magnetic disks optical disks flash memory virtual memory and non virtual memory magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and that can be accessed by an instruction execution system as well as any combination or variation thereof or any other type of storage media.

File system can be a disk file system optical disk file system flash file system tape file system a transactional file system networked file system shared disk file system device file systems and other files systems. Disk file system may include FAT FAT12 FAT16 FAT32 exFAT NTFS HFS HFS HPFS UFS ext2 ext4 XFS btrfs ISO 9660 Files 11 Verita File System VMFS ZFS ReiserFS UDF or some other file system. Optical disk file system may include ISO 9660 Universal Disk Format UDF Mount Rainier or some other optical disk file system. Tape file system may include IBM Linear Tape File System Single Drive Edition LTFS SDE or some other tape file system. Transactional file system may include Transactional NTFS Valor Amino LFS Transactional ext3 or some other transactional file system. Some examples of networked file systems may include clients for NFS AFS SMD protocols and file system like client for FTP and WEBDAV. Some examples of shared disk file systems include GFS2 GPFS SFS CXFS StorNext or some other shared disk file system.

Power threshold indicates allowable maximum or minimum power consumption characteristics for data storage device . Power threshold specifies power consumption threshold values in Watts or other units of power or energy dissipation. Power threshold may limit power consumption on a time or transaction basis. For example power threshold may specify that data storage device may only use a peak amount of power during a particular period of time. Alternatively power threshold may specify that data storage device limit power consumption to a specified amount of power per transaction. Power threshold may be continuously variable or constant.

Queue depth may be tuned to establish desirable power consumption characteristics of data storage device . Data storage device is configured to enter into a power controlled mode and responsively adjust at least queue depth to establish power consumption characteristics as below power threshold . Power controlled modes include a throughput mode and a latency mode. Throughput power controlled mode increases the queue depth to allow high throughput above a throughput threshold while the power consumption characteristics are maintained below the power threshold. Latency power controlled mode decreases the queue depth to reduce latency to below a latency threshold while the power consumption characteristics are maintained below the power consumption threshold.

Link can include one or more links although a single link is shown in . Link can comprise any storage or disk interface such as Serial Attached ATA SATA Serial Attached SCSI SAS FiberChannel Universal Serial Bus USB SCSI InfiniBand Peripheral Component Interconnect Express PCIe Ethernet Internet Protocol IP or other parallel or serial storage or peripheral interfaces including variations and combinations thereof.

In normal operating mode the read write head start at an initial position A and must travel in a first direction to get to second position B and then move in an opposite direction to get to the third position C . Note that the read write head position is not efficiently controlled with respect to time and uses more power than it needs. Queue does not have sufficient depth to be manipulated by storage control system or host system for more efficient read write head positioning. Power consumption characteristics are therefore related to queue depth .

In a first example of data storage device performs the operations of although it should be understood that operations in can be performed in host system as mentioned above. Data storage device identifies power threshold for data storage device . Power threshold indicates allowable maximum or minimum power consumption characteristics for data storage device . Power threshold specifies power consumption threshold values in Watts or other units of power or energy dissipation. Data storage device configures a sampling rate establishes a measurement period and selects among a time based or transaction based power measurement to determine power consumption characteristics . Power consumption characteristics may be measured using various methods. Both data storage device and host system are capable of configuring sampling rates establishing measurement periods and selected among a time based or transaction based power measurement offering a high degree of flexibility and control over power measurements. In some examples data storage device includes power measurement system . Data storage device determines power consumption characteristics for data storage device from power measurement system . Power consumption characteristics can be defined in various ways. For example power consumption characteristics may indicate maximum allowable power dissipation per unit or time or per a transaction for data storage device . Enter into a power controlled mode for data storage device to establish the power consumption characteristics as below power threshold . A power controlled mode is an operating mode for data storage device that provides a fine degree of control over the power consumption characteristics of data storage device by controlling queue depth .

Throughput mode and latency mode are two performance oriented modes a storage device can work in while being power controlled. These modes are discussed herein. In throughput mode storage control system or host system dedicates a maximum queue depth to increase throughput above a throughput threshold while power consumption characteristics are maintained below the power threshold . In latency mode storage control system or host system decreases queue depth to reduce latency below a latency threshold while the power consumption characteristics are maintained below the power threshold . Data storage device and host system may alternate between throughput mode and latency mode to achieve the desired power consumption characteristics of data storage device . Storage control system or host system adaptively adjust queue depth proportional to the difference between the actual power consumption characteristics and the target power consumption characteristics . Communicate power meter settings and feedback between host system and data storage device . Data storage system provides host system with power consumption characteristics. Control the operation of power measurement system by host system . Power measurement system is configured to accept commands from host system. Size ranges within queue can be set as well instead of a single queue depth.

File system can be a disk file system optical disk file system flash file system tape file system a transactional file system networked file system shared disk file system device file systems and other files systems. Disk file system may include FAT FAT12 FAT16 FAT32 exFAT NTFS HFS HFS HPFS UFS ext2 ext4 XFS btrfs ISO 9660 Files 11 Verita File System VMFS ZFS ReiserFS UDF or some other file system. Optical disk file system may include ISO 9660 Universal Disk Format UDF Mount Rainier or some other optical disk file system. Tape file system may include IBM Linear Tape File System Single Drive Edition LTFS SDE or some other tape file system. Transactional file system may include Transactional NTFS Valor Amino LFS Transactional ext3 or some other transactional file system. Some examples of networked file systems may include clients for NFS AFS SMD protocols and file system like client for FTP and WEBDAV. Some examples of shared disk file systems include GFS2 GPFS SFS CXFS StorNext or some other shared disk file system. File system comprises power cap block I O interface module .

Power cap block I O interface comprises power capping monitor performance monitor and I O execution control . Performance monitor communicates with I O execution control and power capping monitor . In operation power capping monitor identifies power threshold and communicates power threshold to performance monitor . Performance monitor selects and performs the power controlled mode for data storage device based upon power threshold . Performance monitor sends commands to I O execution control . I O execution control provides feedback to power capping monitor and performance monitor allowing the ability to fine tune the system s operation.

I O execution control controls block I O requests based upon commands received from performance monitor . I O execution control communicates feedback to performance monitor and power capping monitor to allow fine tuning of the block I O requests . I O execution control commands block I O scheduler to adjust queue depth and optimize block I O requests. Block I O scheduler transfers commands and data to data storage device . Data storage device provides feedback information to power capping module.

Computing system may be implemented as a single apparatus system or device or may be implemented in a distributed manner as multiple apparatuses systems or devices. Computing system comprises communication transceiver and processing system . Processing system comprises processor circuitry and memory system . Memory system comprises software that includes throughput mode latency mode and power consumption module .

Processing system loads and executes in processor circuitry software from memory system . When executed by processing system for performance aware power capping of a data storage device software directs processing circuitry to operate as described herein for at least the various processes operational scenarios and sequences discussed in the foregoing implementations with performance aware power capping of a data storage device. Computing system may optionally include additional devices features or functionality not discussed for purposes of brevity.

Processing circuitry may comprise a micro processor and other circuitry that retrieves and executes software from memory . Processing circuitry may be implemented within a single processing device but may also be distributed across multiple processing devices or sub systems that cooperate in executing program instructions. Examples of processing circuitry include general purpose central processing units application specific processors and logic devices as well as any other type of processing device combinations or variations thereof.

Memory system may comprise any non transitory computer readable storage media readable by processing system and capable of storing software . Memory system may include volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Examples of storage media include random access memory read only memory magnetic disks optical disks flash memory virtual memory and non virtual memory magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other suitable storage media.

In addition to computer readable storage media in some implementations memory system may also include computer readable communication media over which software may be communicated internally or externally. Memory system may be implemented as a single storage device but may also be implemented across multiple storage devices or sub systems co located or distributed relative to each other. Memory system may comprise additional elements such as a controller capable of communicating with processing system or possibly other systems.

Software may be implemented in program instructions and among other functions may when executed by processing system direct processing system to operate as described with respect to the various operational scenarios sequences and processes illustrated herein. For example software may include program instructions for implementing a code service and its associated functionality.

In particular the program instructions may include various components or modules that cooperate or otherwise interact to carry out the various processes and operational scenarios described herein. The various components or modules may be embodied in compiled or interpreted instructions or in some other variation or combination of instructions. The various components or modules may be executed in a synchronous or asynchronous manner serially or in parallel in a single threaded environment or multi threaded or in accordance with any other suitable execution paradigm variation or combination thereof. Software may include additional processes programs or components such as operating system software or other application software. Software may also comprise firmware or some other form of machine readable processing instructions executable by processing system .

In general software may when loaded into processing system and executed by processing circuity transform a suitable apparatus system or device of which computer system is representative overall from a general purpose computer system into a special purpose computer system customized to facilitate enhanced component interoperability. Indeed encoding software on memory system may transform the physical structure of memory system . The specific transformation of the physical structure may depend on various factors in different implementations of this description. Examples of such factors may include but are not limited to the technology used to implement the storage media of memory system and whether the computer storage media are characterized as primary or secondary storage as well as other factors.

For example if the computer readable storage media are implemented as semiconductor based memory software may transform the physical state of the semiconductor memory when the program instructions are encoded therein such as by transforming the state of transistors capacitors or other discrete circuit elements constituting the semiconductor memory. A similar transformation may occur with respect to magnetic or optical media. Other transformations of physical media are possible without departing from the scope of the present description with the foregoing examples provided only to facilitate the present discussion.

It may be understood that computing system is generally intended to represent a computing system or systems on which software may be deployed and executed in order to implement enhanced component interoperability. However computing system may also be suitable as any computing system on which software may be staged and from where one or both may be distributed transported downloaded or otherwise provided to yet another computing system for deployment and execution or yet additional distribution.

In at least one implementation the program instructions can include throughput mode module latency mode module and power consumption module . Throughput mode module includes establishing a queue depth of a storage drive to cap power consumption of the storage drive while maintaining a desired throughput rate. Latency mode module includes establishing a queue depth of the storage drive to cap power consumption of the storage drive while maintaining a desired read write latency for data stored on the storage drive. Power consumption module measures and monitors power consumption of the storage drive. Power consumption module can receive power measurement data from external systems such as power monitoring circuitry implemented on the storage drive. The power measurement data can include a digitized representation of a present power draw of the storage drive. Power consumption module can receive the power measurement data over communication transceiver . Power consumption module can transfer power measurement data to any of throughput mode module latency mode module for use in determining queue depths that establish either the throughput mode or latency mode of operation of the storage drive.

Communication transceiver may include communication connections and devices that allow for communication with other computing systems not shown over communication networks not shown . Examples of connections and devices that together allow for inter system communication may include network interface cards antennas power amplifiers RF circuitry transceivers and other communication circuitry. The connections and devices may communicate over communication media to exchange communications with other computing systems or networks of systems such as metal glass air or any other suitable communication media. The aforementioned media connections and devices are well known and need not be discussed at length here.

User interface system is optional and may include a keyboard a mouse a voice input device a touch input device for receiving a touch gesture from a user a motion input device for detecting non touch gestures and other motions by a user and other comparable input devices and associated processing elements capable of receiving user input from a user. Output devices such as a display speakers haptic devices and other types of output devices may also be included in user interface system . In some cases the input and output devices may be combined in a single device such as a display capable of displaying images and receiving touch gestures. The aforementioned user input and output devices are well known in the art and need not be discussed at length here.

User interface system may also include associated user interface software executable by processor circuitry in support of the various user input and output devices discussed above. Separately or in conjunction with each other and other hardware and software elements the user interface software and user interface devices may support a graphical user interface a natural user interface or any other type of user interface.

Communication between computing system and other computing systems not shown may occur over a communication network or networks and in accordance with various communication protocols combinations of protocols or variations thereof. Examples include intranets internets the Internet local area networks wide area networks wireless networks wired networks virtual networks software defined networks data center buses computing backplanes or any other type of network combination of network or variation thereof. The aforementioned communication networks and protocols are well known and need not be discussed at length here. However some communication protocols that may be used include but are not limited to the Internet protocol IP IPv4 IPv6 etc. the transfer control protocol TCP and the user datagram protocol UDP as well as any other suitable communication protocol variation or combination thereof.

In any of the aforementioned examples in which data content or any other type of information is exchanged the exchange of information may occur in accordance with any of a variety of protocols including FTP file transfer protocol HTTP hypertext transfer protocol REST representational state transfer WebSocket DOM Document Object Model HTML hypertext markup language CSS cascading style sheets HTML5 XML extensible markup language JavaScript JSON JavaScript Object Notation and AJAX Asynchronous JavaScript and XML as well as any other suitable protocol variation or combination thereof.

The included descriptions and figures depict specific embodiments to teach those skilled in the art how to make and use the best mode. For the purpose of teaching inventive principles some conventional aspects have been simplified or omitted. Those skilled in the art will appreciate variations from these embodiments that fall within the scope of the invention. Those skilled in the art will also appreciate that the features described above can be combined in various ways to form multiple embodiments. As a result the invention is not limited to the specific embodiments described above but only by the claims and their equivalents.

