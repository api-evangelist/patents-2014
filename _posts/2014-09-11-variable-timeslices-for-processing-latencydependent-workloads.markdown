---

title: Variable timeslices for processing latency-dependent workloads
abstract: A virtualization host may implement variable timeslices for processing latency dependent workloads. Multiple virtual compute instances on a virtualization host may utilize virtual central processing units (vCPUs) to obtain physical processing resources, such as one or more central processing units (CPUs). A vCPU currently utilizing a CPU to performing processing work according to a scheduled timeslice may be preempted by a latency dependent vCPU before completion of the scheduled timeslice. The latency-dependent vCPU may complete processing work, and utilization of the CPU may be returned to the vCPU. A preemption compensation may be determined for the scheduled timeslice to increase the scheduled timeslice for the vCPU such that utilization for the vCPU is performed according to the increased scheduled timeslice.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09529633&OS=09529633&RS=09529633
owner: Amazon Technologies, Inc.
number: 09529633
owner_city: Reno
owner_country: US
publication_date: 20140911
---
The advent of virtualization technologies for commodity hardware has provided benefits with respect to managing large scale computing resources for many customers with diverse needs allowing various computing resources to be efficiently and securely shared by multiple customers. For example virtualization technologies may allow a single physical computing machine to be shared among multiple users by providing each user with one or more virtual machines hosted by the single physical computing machine with each such virtual machine being a software simulation acting as a distinct logical computing system that provides users with the illusion that they are the sole operators and administrators of a given hardware computing resource while also providing application isolation and security among the various virtual machines. As another example virtualization technologies may allow data storage hardware to be shared among multiple users by providing each user with a virtualized data store which may be distributed across multiple data storage devices with each such virtualized data store acting as a distinct logical data store that provides users with the illusion that they are the sole operators and administrators of the data storage resource.

Virtualization technologies may be leveraged to create many different types of services or perform different functions for client systems or devices. For example virtual machines may be used to implement a network based service for external customers such as an e commerce platform. Virtual machines may also be used to implement a service or tool for internal customers such as information technology IT service implemented as part of an internal network for a corporation. Utilizing these virtual resources efficiently however may require flexible utilization options for many different types of virtual resource workloads. In some environments multiple virtual machines may be hosted together on a single host creating the possibility for contention and conflicts when utilizing different virtual computing resources that may rely upon the same physical computer resources.

While embodiments are described herein by way of example for several embodiments and illustrative drawings those skilled in the art will recognize that the embodiments are not limited to the embodiments or drawings described. It should be understood that the drawings and detailed description thereto are not intended to limit embodiments to the particular form disclosed but on the contrary the intention is to cover all modifications equivalents and alternatives falling within the spirit and scope as defined by the appended claims. The headings used herein are for organizational purposes only and are not meant to be used to limit the scope of the description or the claims. As used throughout this application the word may is used in a permissive sense i.e. meaning having the potential to rather than the mandatory sense i.e. meaning must . Similarly the words include including and includes mean including but not limited to.

The systems and methods described herein may implement variable timeslices for latency dependent workloads at a virtualization host according to some embodiments. Virtualization hosts may provide virtualized devices or resources as part of implementing virtual compute instances. These virtualized devices may provide a virtual compute instance with access to an underlying physical resource corresponding to the virtual resource. For example a virtual central processing unit vCPU may be implemented for a compute instance which can in turn be utilized to access a physical central processing unit CPU .

As differing virtual compute instances may perform different tasks or functions so too may vCPUs implemented for the virtual compute instances processing different types of workloads. Some processing workloads may be processing intensive and thus may be performed without waiting on another component or device to perform in various embodiments. Other processing workloads may enter wait states until the completion of some other operation such as an input output I O operation. Implementing scheduling techniques to handle these different workloads often optimizes one type of workload at the expense of another. Variable timeslices may be implemented to provide for optimal handling of different workloads.

Timeslices may be implemented to determine an amount of time up to which a vCPU may utilize a processing resource such as a central processing unit CPU . A scheduling technique may be implemented to select a vCPU to utilize the processing resource according to a timeslice. If for example a vCPU is selected that performs intensive processing operations the first vCPU may utilize the entire timeslice and not finish performing the processing operations. If another vCPU is selected that only performs a few operations and then waits on the response then the vCPU may spend the rest of the timeslice waiting on a response if none is received then a subsequent time slice may provide sufficient time for the response . Instead of waiting the other vCPU may yield the remaining timeslice and resume processing when the response is received. In such a scenario the other vCPU may preempt another vCPU utilizing the processing resource to continue processing based on the response.

Preempting a running vCPU to allow another vCPU to utilize a processing resource may trigger a context switch in various embodiments. A context switch may involve changing register values for the processing resource as well as loading different data into a cache which is used for performing processing for the vCPU taking over the processing resource. Context switching consumes a portion of a timeslice allotted to a vCPU. Moreover as the preempting vCPU performs tasks the data in a cache may be changed from the data used by the preempted vCPU . If a processing intensive vCPU like the first example vCPU given runs for an entire timeslice multiple other vCPUs may potentially preempt the long running vCPU and reducing the amount of the timeslice available for processing for each context switch performed as well as the time to return the state of a cache to include data for the long running vCPU increasing processing throughput. If preemption occurs too often a preempted vCPU may make little progress due to side effects such as cache thrashing. In various embodiments preemption compensation may be provided to vCPUs that are preempted to allow latency dependent vCPUs to utilize the processing resource. A preemption compensation may increase the timeslice of for a preempted vCPU. The preemption compensation may be determined based at least in part on a reduction in throughput of the preempted vCPU as a result of performing the preemption

At time T8 vCPU begins utilizing the physical CPU. However a preemption event occurs at T10 switching utilization of the physical CPU to vCPU . As noted above vCPU may be latency dependent. Thus as illustrated in the utilization of the physical CPU by vCPU is small relative to the utilization vCPU e.g. completing utilization at T11 . Upon resuming utilization of the physical CPU by vCPU a preemption compensation may be determined. The preemption compensation may be used to increase the timeslice for vCPU e.g. increasing the timeslice to end at T18 . Multiple preemptions may occur for a vCPU during a timeslice. For example increased timeslice for vCPU illustrates two different preemption events and to allow vCPU to utilize the physical CPU. Preemption compensation for a timeslice may be dynamic increasing as the number of preemption events increases. For example preemption compensation for vCPU appears larger than preemption compensation for vCPU as the number of preemptions for vCPU was greater .

Increasing a timeslice for a vCPU may be limited to the timeslice in which a preemption event occurs. For example the next time vCPU utilizes the physical CPU a default timeslice e.g. timeslice may be again scheduled for vCPU . Yet in some embodiments preemption compensation may be provided to increase the timeslice for multiple timeslices for a particular vCPU e.g. based on analysis of historical preemption events for a vCPU increasing the timeslice may be performed proactively .

Please note that previous descriptions are not intended to be limiting but are merely provided as an example of variable timeslices for processing latency dependent workloads. The timeslices preemptions number of vCPUs or CPUs may all be different. Moreover representations as to the length of utilization for long running vCPUs or latency dependent vCPUs are not necessarily drawn to scale. For example the length of a preemption compensation may not be equivalent to the length of time a preempting vCPU utilizes the CPU. Moreover although some vCPUs are depicted as latency dependent and some are not a vCPU may switch from becoming latency dependent to not latency dependent or vice versa .

This specification next includes a general description of a provider network which may implement variable timeslices for latency dependent workloads at a virtualization host. Then various examples of a provider network are discussed including different components modules or arrangements of components module that may be employed as part of the provider network. A number of different methods and techniques to implement variable timeslices for latency dependent workloads at a virtualization host are then discussed some of which are illustrated in accompanying flowcharts. Finally a description of an example computing system upon which the various components modules systems devices and or nodes may be implemented is provided. Various examples are provided throughout the specification.

Different clients implementing virtual computing resources have different resource demands. For example some clients workloads are not predictable and may not utilize fixed resources efficiently. Virtual compute instances implementing resource credits for scheduling virtual computing resources may provide dynamic utilization of resources to provide flexible high performance without wasting unutilized fixed resources. Resource credits may be accumulated for individual virtual compute instances and maintained as part of an individual resource credit balance. When a virtual compute instance needs to perform work at high performance the resource credits may be applied to the work effectively providing full utilization of underlying physical resources for the duration of the resource credits. When a virtual compute instance is using less than its share of resources e.g. little or no work is being performed credits may be accumulated and used for a subsequent task. Resources may in various embodiments be any virtualized computer resource that is implemented or performed by a managed physical computer resource including but not limited to processing resources communication or networking resources and storage resources.

In various embodiments provider network may implement a control plane in order to manage the computing resource offerings provided to clients by provider network . Control plane may implement various different components to manage the computing resource offerings. Control plane may be implemented across a variety of servers nodes or other computing systems or devices such as computing system described below with regard to . It is noted that where one or more instances of a given component may exist reference to that component herein may be made in either the singular or the plural. However usage of either form is not intended to preclude the other.

In at least some embodiments control plane may implement interface . Interface may be configured to process incoming requests received via network and direct them to the appropriate component for further processing. In at least some embodiments interface may be a network based interface and may be implemented as a graphical interface e.g. as part of an administration control panel or web site and or as a programmatic interface e.g. handling various Application Programming Interface API commands . In various embodiments interface may be implemented as part of a front end module or component dispatching requests to the various other components such as resource management reservation management resource monitoring and billing . Clients in various embodiments may not directly provision launch or configure resources but may send requests to control plane such that the illustrated components or other components functions or services not illustrated may perform the requested actions.

Control plane may implement resource management module to manage the access to capacity of mappings to and other control or direction of computing resources offered by provider network. In at least some embodiments resource management module may provide both a direct sell and 3party resell market for capacity reservations e.g. reserved compute instances . For example resource management module may allow clients via interface to learn about select purchase access to and or reserve capacity for computing resources either from an initial sale marketplace or a resale marketplace via a web page or via an API. For example resource management component may via interface provide listings of different available compute instance types each with a different credit accumulation rate. Additionally in some embodiments resource management module may be configured to offer credits for purchase in addition to credits provided via the credit accumulation rate for an instance type for a specified purchase amount or scheme e.g. lump sum additional periodic payments etc. . For example resource management module may be configured to receive a credit purchase request e.g. an API request and credit the virtual instance balance with the purchased credits. Similarly resource management module may be configured to handle a request to increase a credit accumulation rate for a particular instance. Resource management may also offer and or implement a flexible set of resource reservation control and access interfaces for clients via interface . For example resource management module may provide credentials or permissions to clients such that compute instance control operations interactions between clients and in use computing resources may be performed.

In various embodiments reservation management module may be configured to handle the various pricing schemes of instances at least for the initial sale marketplace in various embodiments. For example network based virtual computing service may support several different purchasing modes which may also be referred to herein as reservation modes in some embodiments for example term reservations i.e. reserved compute instances on demand resource allocation or spot price based resource allocation. Using the long term reservation mode a client may make a low one time upfront payment for a compute instance or other computing resource reserve it for a specified duration such as a one or three year term and pay a low hourly rate for the instance the client would be assured of having the reserved instance available for the term of the reservation. Using on demand mode a client could pay for capacity by the hour or some appropriate time unit without any long term commitments or upfront payments. In the spot price mode a client could specify the maximum price per unit time that it is willing to pay for a particular type of compute instance or other computing resource and if the client s maximum price exceeded a dynamic spot price determined at least in part by supply and demand that type of resource would be provided to the client.

During periods when the supply of the requested resource type exceeded the demand the spot price may become significantly lower than the price for on demand mode. In some implementations if the spot price increases beyond the maximum bid specified by a client a resource allocation may be interrupted i.e. a resource instance that was previously allocated to the client may be reclaimed by the resource management module and may be allocated to some other client that is willing to pay a higher price. Resource capacity reservations may also update control plane data store to reflect changes in ownership client use client accounts or other resource information.

In various embodiments control plane may implement resource monitoring module . Resource monitoring module may track the consumption of various computing instances e.g. resource credit balances resource credit consumption consumed for different virtual computer resources clients user accounts and or specific instances. In at least some embodiments resource monitoring module may implement various administrative actions to stop heal manage or otherwise respond to various different scenarios in the fleet of virtualization hosts and instances . Resource monitoring module may also provide access to various metric data for client s as well as manage client configured alarms.

In various embodiments control plane may implement billing management module . Billing management module may be configured to detect billing events e.g. specific dates times usages requests for bill or any other cause to generate a bill for a particular user account or payment account linked to user accounts . In response to detecting the billing event billing management module may be configured to generate a bill for a user account or payment account linked to user accounts.

A virtual compute instance may for example comprise one or more servers with a specified computational capacity which may be specified by indicating the type and number of CPUs the main memory size and so on and a specified software stack e.g. a particular version of an operating system which may in turn run on top of a hypervisor . A number of different types of computing devices may be used singly or in combination to implement the compute instances of network based virtual computing service in different embodiments including general purpose or special purpose computer servers storage devices network devices and the like. In some embodiments instance clients or other any other user may be configured and or authorized to direct network traffic to a compute instance .

Compute instances may operate or implement a variety of different platforms such as application server instances Java virtual machines JVMs general purpose or special purpose operating systems platforms that support various interpreted or compiled programming languages such as Ruby Perl Python C C and the like or high performance computing platforms suitable for performing client applications without for example requiring the client to access an instance . There may be various different types of compute instances. In at least some embodiments there may be compute instances that implement resource credit balances for scheduling virtual computer resource operations. This type of instance may perform based on resource credits where resource credits represent time an instance can spend on a physical resource doing work e.g. processing time on a physical CPU time utilizing a network communication channel etc. . The more resource credits an instance has for computer resources the more time it may spend on the physical resources executing work increasing performance . Resource credits may be provided at launch of an instance and may be defined as utilization time e.g. CPU time such as CPU minutes which may represent the time an instance s virtual resources can spend on underlying physical resources performing a task.

In various embodiments resource credits may represent time or utilization of resources in excess of a baseline utilization guarantee. For example a compute instance may have a baseline utilization guarantee of 10 for a resource and thus resource credits may increase the utilization for the resource above 10 . Even if no resource credits remain utilization may still be granted to the compute instance at the 10 baseline. Credit consumption may only happen when the instance needs the physical resources to perform the work above the baseline performance. In some embodiments credits may be refreshed or accumulated to the resource credit balance whether or not a compute instance submits work requests that consume the baseline utilization guarantee of the resource.

Different types of compute instances implementing resource credits for scheduling computer resources may be offered. Different compute instances may have a particular number of virtual CPU cores memory cache storage networking as well as any other performance characteristic. Configurations of compute instances may also include their location in a particular data center availability zone geographic location etc. . . . and in the case of reserved compute instances reservation term length. Different compute instances may have different resource credit accumulation rates for different virtual resources which may be a number of resource credits that accumulate to the current balance of resource credits maintained for a compute instance. For example one type of compute instance may accumulate 6 credits per hour for one virtual computer resource while another type of compute instance may accumulate 24 credits per hour for the same type of virtual computer resource in some embodiments. In another example the resource credit accumulation rate for one resource e.g. vCPU may be different than the resource credit accumulation rate for a different virtual computer resource e.g. networking channel for the same virtual compute instance. In some embodiments multiple different resource credit balances may be maintained for a virtual compute instance for the multiple different virtual computer resources used by the virtual compute instances. A baseline performance guarantee may also be implemented for each of the virtual computer resources which may be different for each respective virtual computer resource as well as for the different instance types.

Baseline performance guarantees may be included along with the resource credit accumulation rates in some embodiments. Thus in one example an instance type may include a specific resource credit accumulation rate and guaranteed baseline performance for processing and another specific resource credit accumulation rate and guaranteed baseline performance rate for networking channels. In this way provider network may offer many different types of instances with different combinations of resource credit accumulation rates and baseline guarantees for different virtual computer resources. These different configurations may be priced differently according to the resource credit accumulation rates and baseline performance rates in addition to the various physical and or virtual capabilities. In some embodiments a virtual compute instance may be reserved and or utilized for an hourly price. While a long term reserved instance configuration may utilize a different pricing scheme but still include the credit accumulation rates and baseline performance guarantees.

As illustrated in a virtualization host such as virtualization hosts through may implement and or manage multiple compute instances in some embodiments and may be one or more computing devices such as computing system described below with regard to . A virtualization host may include a virtualization management module such as virtualization management modules through capable of instantiating and managing a number of different client accessible virtual machines or compute instances . The virtualization management module may include for example a hypervisor and an administrative instance of an operating system which may be termed a domain zero or dom0 operating system in some implementations. The dom0 operating system may not be accessible by clients on whose behalf the compute instances run but may instead be responsible for various administrative or control plane operations of the network provider including handling the network traffic directed to or from the compute instances . Virtualization management module may be configured to implement variable timeslices for processing latency dependent workloads for different instances .

Client s may encompass any type of client configurable to submit requests to provider network . For example a given client may include a suitable version of a web browser or may include a plug in module or other type of code module configured to execute as an extension to or within an execution environment provided by a web browser. Alternatively a client may encompass an application such as a dashboard application or user interface thereof a media application an office application or any other application that may make use of compute instances to perform various operations. In some embodiments such an application may include sufficient protocol support e.g. for a suitable version of Hypertext Transfer Protocol HTTP for generating and processing network based services requests without necessarily implementing full browser support for all types of network based data. In some embodiments clients may be configured to generate network based services requests according to a Representational State Transfer REST style network based services architecture a document or message based network based services architecture or another suitable network based services architecture. In some embodiments a client e.g. a computational client may be configured to provide access to a compute instance in a manner that is transparent to applications implement on the client utilizing computational resources provided by the compute instance .

Clients may convey network based services requests to network based virtual computing service via network . In various embodiments network may encompass any suitable combination of networking hardware and protocols necessary to establish network based communications between clients and provider network . For example a network may generally encompass the various telecommunications networks and service providers that collectively implement the Internet. A network may also include private networks such as local area networks LANs or wide area networks WANs as well as public or private wireless networks. For example both a given client and network based virtual computing service may be respectively provisioned within enterprises having their own internal networks. In such an embodiment a network may include the hardware e.g. modems routers switches load balancers proxy servers etc. and software e.g. protocol stacks accounting software firewall security software etc. necessary to establish a networking link between given client and the Internet as well as between the Internet and provider network . It is noted that in some embodiments clients may communicate with provider network using a private network rather than the public Internet.

In virtualization management module may implement resource credit balance scheduler . Resource credit balance scheduler may act as a meta scheduler managing tracking applying deducting and or otherwise handling all resource credit balances for each of compute instances . In various embodiments resource credit balance scheduler may be configured to receive virtual compute resource work requests from computes instances. Each work request may be directed toward the virtual computer resource corresponding to the compute instance that submitted the work. For each request resource credit balance scheduler may be configured to determine a current resource credit balance for the requesting compute instance and generate scheduling instructions to apply resource credits when performing the work request. In some embodiments resource credit balance scheduler may perform or direct the performance of the scheduling instructions directing or sending the work request to the underlying physical computing resources to be performed. For example in some embodiments different hardware queues may be implemented and resource credit balance scheduler may be used to place tasks for performing work requests in the queues according to the applied resource credits e.g. queuing tasks according to the amount of time of applied resource credits . However in some embodiments the resource scheduling instructions may be sent to virtual compute resource scheduler which may be a scheduler for the physical resources such as CPU s implemented at virtualization host . Resource credit balance scheduler and or virtual compute resource scheduler may be configured to perform the various techniques described below with regard to in order to provide preemption compensation for work performed on behalf of different vCPUs for instances apply resource credits deduct resource credits and or otherwise ensure that work requests are performed according to the applied resource credits. For example resource credit balance scheduler and or virtual compute resource scheduler may determine preemption compensation for a vCPU that has been preempted by a latency dependent vCPU. A scheduled timeslice for the preempted vCPU may be increased according to the determined preemption compensation. Resource credits for the preemption may be deducted from a resource credit balance for the compute instance associated with the latency dependent vCPU that preempted the vCPU.

In some embodiments in response to receiving the scheduling instructions virtual compute resource scheduler may provide physical scheduling instructions for work requests to physical computing resources such as physical CPU s in various embodiments. In at least some embodiments virtual compute resource scheduler may be a credit based scheduler for one or more CPUs.

Resource credit balance scheduler may also report credit balance and usage metrics to monitoring agent which may in turn report these metrics along with any other host metrics health information etc. to resource monitoring module .

The examples of implementing variable timeslices for processing latency dependent workloads discussed above with regard to have been given in regard to virtual computing resources offered by a provider network. Various other types or configurations of virtualization hosts or other virtualization platforms may implement these techniques which may or may not be offered as part of a network based service. For example other scheduling techniques different than a credit based scheduling technique may be implemented to schedule vCPUs for utilizing a physical processing resource. is high level flowchart illustrating various methods and techniques for implementing variable timeslices for processing latency dependent workloads according to some embodiments. These techniques may be implemented using various components of network based virtual computing service as described above with regard to or other virtual computing resource hosts.

As indicated at utilization of a central processing unit CPU for a virtual central processing unit vCPU may be initiated according to a scheduled timeslice for the vCPU in various embodiments. A scheduler or similar component may be implemented as part of a virtualization host and may for instance evaluate multiple vCPUs implemented for virtual compute instances at a virtualization host and select a vCPU to utilize the CPU. Different scheduling policies or techniques may be implemented such as a fair share scheduling round robin scheduling or any other scheduling technique. In at least some embodiments a credit based scheduler may select vCPUs to utilize the CPU based on a resource credit balance maintained for a virtual compute instance for processing resources. As noted above in resource credits may be applied to increase utilization e.g. above a baseline utilization of a physical computer resource for a virtual compute instance. Thus resources credits may be applied by a scheduler for determining which vCPU selection to make for utilizing the CPU.

When selected for utilization of the CPU a given vCPU may have a scheduled timeslice e.g. 20 ms during which the vCPU may utilize the CPU. In at least some embodiments a default sized timeslice may be provided for each vCPU selected to begin utilizing the CPU. As workloads for vCPUs may vary with some vCPU workloads being processing intensive while other CPU workloads perform smaller tasks a given vCPU may or may not utilize all of the scheduled timeslice. Some vCPUs may utilize the CPU to perform tasks that are complete without dependence on any other physical computer resource whereas some vCPUs may perform tasks that depend upon operations performed by other physical computer resources to complete e.g. various input output I O operations for storage input devices or networking resources . Latency dependent workloads for vCPUs may be dependent upon the performance of an I O operation or other physical computer resource in order to continue to make progress with the performance of tasks. Thus a latency dependent vCPU may in various embodiments enter a wait state prior to the completion of a scheduled timeslice for the latency dependent vCPU until the performance of the I O operation or other physical computer resource is complete. For example vCPUs that perform tasks to send out requests via a network to another computing system and do not take further action until a response is received back may be considered latency dependent. In at least some embodiments a latency dependent vCPU may be I O bound. The processing workloads of some vCPUs may utilize the CPU for the entire scheduled timeslice and beyond if not limited to the scheduled timeslice and may be sensitive to providing a certain level of throughput for performing tasks. For example a vCPU workload may be performing various calculations as part of an analysis task which may not be dependent upon another physical computer resource to be performed . In at least some embodiments vCPUs that utilize the entire scheduled timeslice may be CPU bound.

The amount of time utilized by latency dependent vCPUs may be relatively small when compared with vCPUs that utilize the entire scheduled timeslice. Instead of blocking latency dependent vCPUs from performing work behind vCPUs that utilize an entire scheduled timeslice preemption may be performed when for example the I O or other physical computer resource operation for which the latency dependent vCPU was waiting to complete is finished. Preemption may in various embodiments be performed to switch utilization of the CPU from one vCPU to another vCPU e.g. a latency dependent vCPU . A preemption event may be detected for instance when a latency dependent vCPU is ready to begin utilizing the CPU again e.g. the latency dependent vCPU is no longer in a wait state . In various embodiments a latency dependent vCPU may be identified when it is determined that a vCPU did not utilize all of the immediately previous timeslice for the vCPU e.g. the last time the vCPU utilized the CPU the vCPU only utilized the CPU for 3 ms out of a 20 ms timeslice . In some embodiments a latency processing option may be maintained for each vCPU. If the latency processing option is enabled for a vCPU then preemption may be performed for a vCPU that is identified as latency dependent. If the latency processing option is not enabled for vCPU then preemption may not be performed for a vCPU whether or not the vCPU utilized all of the immediately previous timeslice for the vCPU . In at least some embodiments a latency dependent vCPU may be I O bound.

As indicated by the negative exit from if a preemption event is not detected then the vCPU may continue utilizing the CPU for processing. If the timeslice for the vCPU expires as indicated by the positive exit from then a new vCPU may be selected and begin utilization of the CPU for the selected vCPU. It follows that for some vCPUs a scheduled timeslice may not be increased in contrast with the scheduled timeslice for some preempted vCPUs as discussed below . If the scheduled timeslice has not expired as indicated by the negative exit from then utilization of the CPU by the vCPU may continue until preemption at or upon expiration of the timeslice at .

If the vCPU is preempted by a latency dependent vCPU as indicated by the positive exit from then utilization of the CPU may be paused for the vCPU as indicated at . Preemption may be performed by storing a state of the tasks processes or other operations performed for the vCPU e.g. storing register values . The latency dependent vCPU may utilize the CPU for processing within a scheduled timeslice which may or may not be the same as the scheduled timeslice for the vCPU that was preempted. In at least some embodiments the timeslice for the latency dependent vCPU may be decreased so as leave room in the overall utilization of the CPU for a preemption compensation as discussed below .

Upon resuming utilization of the CPU for the vCPU which may be after the latency dependent vCPU has completed utilization of the CPU a preemption compensation may be determined for the scheduled timeslice of the vCPU. In some embodiments a preemption compensation may be a pre defined value e.g. 1 ms . In some embodiments the preemption compensation may be determined based at least in part on a reduction in throughput of the given vCPU as a result of the preemption. For example the number of CPU cycles to perform operations to restore register values and reload data for performing the processes tasks or other operations of the vCPU into a cache may be calculated or timed as they are performed. In some embodiments a linear function may be implemented such that the preemption compensation is determined based at least in part on the amount of time the latency dependent vCPU utilized the CPU. Other compensation models or functions such as exponential decay may be implemented. In some embodiments the cache miss counter for the given vCPU may be monitored e.g. indicating the amount of time spent reloading data into the cache which reduces throughput of the given vCPU than if the values still remained in the cache . Preemption compensation may be determined dynamically or on the fly such that additional time may be added to the timeslice as the effects of the preemption become known e.g. more cache misses occur . The scheduled timeslice for the vCPU may then be increased according to the preemption compensation determined for the scheduled timeslice as indicated at . For instance if the preemption compensation is determined to be 3 ms then 3 ms may be added to a timer tracker or other component that determines the amount of a timeslice consumed for a vCPU and to increase the amount of time that the vCPU may utilize the CPU. In a credit based scheduler such as discussed above with regard to resource credits may not be deducted for additional time provided by preemption compensation in some embodiments.

As illustrated by the arrow from element to element the utilization of the vCPU may be preempted again by another latency dependent vCPU either the same or a different latency dependent vCPU . For instance some vCPUs may be preempted multiple times however the corresponding preemption compensations for the preemptions may allow the vCPU to achieve the same throughput for a single timeslice as if no preemptions had occurred during the timeslice reducing or eliminating the impact of multiple context switches and or other operations when a preemption occurs . If no further preemptions occur and or the increased timeslice expires as indicated by the positive exit from then a next vCPU may begin utilization of the CPU.

As indicated at an interrupt to resume processing for a latency dependent vCPU may be detected in various embodiments. For example a network packet may be received a storage device may return data or an acknowledgment of a write or any other I O operation or other physical computer resource operation upon which the latency dependent vCPU depends may complete and trigger an interrupt or event which may place the latency dependent vCPU into a ready to process state. Various scheduling techniques may be used to bump or increase the priority of the latency dependent vCPU to trigger a preemption event. As indicated at a vCPU currently utilizing the CPU may be preempted to allow the latency dependent vCPU to utilize the CPU in various embodiments. When the latency dependent vCPU is finished utilizing the CPU the resource credit balance for the latency dependent vCPU may be updated as indicated at to deduct credit s for utilization of the latency dependent vCPU and credits for providing a preemption compensation for the currently processing vCPU in various embodiments. Latency processing may in such embodiments be effectively more costly in terms of resource credits than non latency processing. However in this way latency processing may provide faster and therefore lower latency response for latency dependent vCPUs and allowing the cost for such processing to be borne by the vCPU initiating the preemption instead of the vCPU being preempted.

The methods described herein may in various embodiments be implemented by any combination of hardware and software. For example in one embodiment the methods may be implemented by a computer system e.g. a computer system as in FIG. that includes one or more processors executing program instructions stored on a computer readable storage medium coupled to the processors. The program instructions may be configured to implement the functionality described herein e.g. the functionality of various servers and other components that implement the network based virtual computing resource provider described herein . The various methods as illustrated in the figures and described herein represent example embodiments of methods. The order of any method may be changed and various elements may be added reordered combined omitted modified etc.

Embodiments of variable timeslices for processing latency dependent workloads as described herein may be executed on one or more computer systems which may interact with various other devices. is a block diagram illustrating an example computer system according to various embodiments. For example computer system may be configured to implement nodes of a compute cluster a distributed key value data store and or a client in different embodiments. Computer system may be any of various types of devices including but not limited to a personal computer system desktop computer laptop or notebook computer mainframe computer system handheld computer workstation network computer a consumer device application server storage device telephone mobile telephone or in general any type of computing device.

Computer system includes one or more processors any of which may include multiple cores which may be single or multi threaded coupled to a system memory via an input output I O interface . Computer system further includes a network interface coupled to I O interface . In various embodiments computer system may be a uniprocessor system including one processor or a multiprocessor system including several processors e.g. two four eight or another suitable number . Processors may be any suitable processors capable of executing instructions. For example in various embodiments processors may be general purpose or embedded processors implementing any of a variety of instruction set architectures ISAs such as the x86 PowerPC SPARC or MIPS ISAs or any other suitable ISA. In multiprocessor systems each of processors may commonly but not necessarily implement the same ISA. The computer system also includes one or more network communication devices e.g. network interface for communicating with other systems and or components over a communications network e.g. Internet LAN etc. . For example a client application executing on system may use network interface to communicate with a server application executing on a single server or on a cluster of servers that implement one or more of the components of the provider network described herein. In another example an instance of a server application executing on computer system may use network interface to communicate with other instances of the server application or another server application that may be implemented on other computer systems e.g. computer systems .

In the illustrated embodiment computer system also includes one or more persistent storage devices and or one or more I O devices . In various embodiments persistent storage devices may correspond to disk drives tape drives solid state memory other mass storage devices or any other persistent storage device. Computer system or a distributed application or operating system operating thereon may store instructions and or data in persistent storage devices as desired and may retrieve the stored instruction and or data as needed. For example in some embodiments computer system may host a storage system server node and persistent storage may include the SSDs attached to that server node.

Computer system includes one or more system memories that are configured to store instructions and data accessible by processor s . In various embodiments system memories may be implemented using any suitable memory technology e.g. one or more of cache static random access memory SRAM DRAM RDRAM EDO RAM DDR 10 RAM synchronous dynamic RAM SDRAM Rambus RAM EEPROM non volatile Flash type memory or any other type of memory . System memory may contain program instructions that are executable by processor s to implement the methods and techniques described herein. In various embodiments program instructions may be encoded in platform native binary any interpreted language such as Java byte code or in any other language such as C C Java etc. or in any combination thereof. For example in the illustrated embodiment program instructions include program instructions executable to implement the functionality of a provider network and or virtualization host in different embodiments. In some embodiments program instructions may implement multiple separate clients server nodes and or other components.

In some embodiments program instructions may include instructions executable to implement an operating system not shown which may be any of various operating systems such as UNIX LINUX Solaris MacOS Windows etc. Any or all of program instructions may be provided as a computer program product or software that may include a non transitory computer readable storage medium having stored thereon instructions which may be used to program a computer system or other electronic devices to perform a process according to various embodiments. A non transitory computer readable storage medium may include any mechanism for storing information in a form e.g. software processing application readable by a machine e.g. a computer . Generally speaking a non transitory computer accessible medium may include computer readable storage media or memory media such as magnetic or optical media e.g. disk or DVD CD ROM coupled to computer system via I O interface . A non transitory computer readable storage medium may also include any volatile or non volatile media such as RAM e.g. SDRAM DDR SDRAM RDRAM SRAM etc. ROM etc. that may be included in some embodiments of computer system as system memory or another type of memory. In other embodiments program instructions may be communicated using optical acoustical or other form of propagated signal e.g. carrier waves infrared signals digital signals etc. conveyed via a communication medium such as a network and or a wireless link such as may be implemented via network interface .

In some embodiments system memory may include data store which may be configured as described herein. In general system memory e.g. data store within system memory persistent storage and or remote storage may store data blocks replicas of data blocks metadata associated with data blocks and or their state configuration information and or any other information usable in implementing the methods and techniques described herein.

In one embodiment I O interface may be configured to coordinate I O traffic between processor system memory and any peripheral devices in the system including through network interface or other peripheral interfaces. In some embodiments I O interface may perform any necessary protocol timing or other data transformations to convert data signals from one component e.g. system memory into a format suitable for use by another component e.g. processor . In some embodiments I O interface may include support for devices attached through various types of peripheral buses such as a variant of the Peripheral Component Interconnect PCI bus standard or the Universal Serial Bus USB standard for example. In some embodiments the function of I O interface may be split into two or more separate components such as a north bridge and a south bridge for example. Also in some embodiments some or all of the functionality of I O interface such as an interface to system memory may be incorporated directly into processor .

Network interface may be configured to allow data to be exchanged between computer system and other devices attached to a network such as other computer systems which may implement one or more components of the distributed system described herein for example. In addition network interface may be configured to allow communication between computer system and various I O devices and or remote storage . Input output devices may in some embodiments include one or more display terminals keyboards keypads touchpads scanning devices voice or optical recognition devices or any other devices suitable for entering or retrieving data by one or more computer systems . Multiple input output devices may be present in computer system or may be distributed on various nodes of a distributed system that includes computer system . In some embodiments similar input output devices may be separate from computer system and may interact with one or more nodes of a distributed system that includes computer system through a wired or wireless connection such as over network interface . Network interface may commonly support one or more wireless networking protocols e.g. Wi Fi IEEE 802.11 or another wireless networking standard . However in various embodiments network interface may support communication via any suitable wired or wireless general data networks such as other types of Ethernet networks for example. Additionally network interface may support communication via telecommunications telephony networks such as analog voice networks or digital fiber communications networks via storage area networks such as Fibre Channel SANs or via any other suitable type of network and or protocol. In various embodiments computer system may include more fewer or different components than those illustrated in e.g. displays video cards audio cards peripheral devices other network interfaces such as an ATM interface an Ethernet interface a Frame Relay interface etc. 

It is noted that any of the distributed system embodiments described herein or any of their components may be implemented as one or more network based services. For example a compute cluster within a computing service may present computing services and or other types of services that employ the distributed computing systems described herein to clients as network based services. In some embodiments a network based service may be implemented by a software and or hardware system designed to support interoperable machine to machine interaction over a network. A network based service may have an interface described in a machine processable format such as the Web Services Description Language WSDL . Other systems may interact with the network based service in a manner prescribed by the description of the network based service s interface. For example the network based service may define various operations that other systems may invoke and may define a particular application programming interface API to which other systems may be expected to conform when requesting the various operations. though

In various embodiments a network based service may be requested or invoked through the use of a message that includes parameters and or data associated with the network based services request. Such a message may be formatted according to a particular markup language such as Extensible Markup Language XML and or may be encapsulated using a protocol such as Simple Object Access Protocol SOAP . To perform a network based services request a network based services client may assemble a message including the request and convey the message to an addressable endpoint e.g. a Uniform Resource Locator URL corresponding to the network based service using an Internet based application layer transfer protocol such as Hypertext Transfer Protocol HTTP .

In some embodiments network based services may be implemented using Representational State Transfer RESTful techniques rather than message based techniques. For example a network based service implemented according to a RESTful technique may be invoked through parameters included within an HTTP method such as PUT GET or DELETE rather than encapsulated within a SOAP message.

Although the embodiments above have been described in considerable detail numerous variations and modifications may be made as would become apparent to those skilled in the art once the above disclosure is fully appreciated. It is intended that the following claims be interpreted to embrace all such modifications and changes and accordingly the above description to be regarded in an illustrative rather than a restrictive sense.

