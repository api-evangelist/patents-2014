---

title: Service selection set published to device agent with on-device service selection
abstract: Disclosed herein are various embodiments for publishing a service selection set to a device agent on an end-user device and for on-device selection of a service. In some embodiments, a network system publishes a service selection set to an end-user device over a wireless access network, receives a selection set user selection from the end-user device, and provisions one or more network functions based on the selection set user selection.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09572019&OS=09572019&RS=09572019
owner: Headwater Partners LLC
number: 09572019
owner_city: Tyler
owner_country: US
publication_date: 20141124
---
With the advent of mass market digital communications and content distribution many access networks such as wireless networks cable networks and DSL Digital Subscriber Line networks are pressed for user capacity with for example EVDO Evolution Data Optimized HSPA High Speed Packet Access LTE Long Term Evolution WiMax Worldwide Interoperability for Microwave Access and Wi Fi Wireless Fidelity wireless networks increasingly becoming user capacity constrained. Although wireless network capacity will increase with new higher capacity wireless radio access technologies such as MIMO Multiple Input Multiple Output and with more frequency spectrum being deployed in the future these capacity gains are likely to be less than what is required to meet growing digital networking demand.

Similarly although wire line access networks such as cable and DSL can have higher average capacity per user wire line user service consumption habits are trending toward very high bandwidth applications that can quickly consume the available capacity and degrade overall network service experience. Because some components of service provider costs go up with increasing bandwidth this trend will also negatively impact service provider profits.

The invention can be implemented in numerous ways including as a process an apparatus a system a composition of matter a computer program product embodied on a computer readable storage medium and or a processor such as a processor configured to execute instructions stored on and or provided by a memory coupled to the processor. In this specification these implementations or any other form that the invention may take may be referred to as techniques. In general the order of the steps of disclosed processes may be altered within the scope of the invention. Unless stated otherwise a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. As used herein the term processor refers to one or more devices circuits and or processing cores configured to process data such as computer program instructions.

A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention. The invention is described in connection with such embodiments but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives modifications and equivalents. Numerous specific details are set forth in the following description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.

There are many new types of digital devices where it is becoming desirable for example to connect these devices to wireless networks including wireless wide area networks WWAN such as 3G and 4G and or wireless local area WLAN networks. These devices include for example consumer electronics devices business user devices and machine to machine devices that benefit from flexible wide area data connections and the Internet. Example devices include netbooks notebooks mobile Internet devices personal navigation e.g. GPS enabled devices music and multimedia players eReaders industrial telemetry automotive emergency response and diagnostics 2 way home and industrial power metering and control vending machines parking meters and many other devices. For example it is highly advantageous to offer service usage and service billing plans for such devices that are more optimal for each type of device and each type of desired user experience. To accomplish this more sophisticated service usage measuring and service usage billing systems are needed as compared to the conventional network based techniques in existence today. By providing more flexibility in service measurement and billing more advantageous and cost effective service plans can be created for for example the new WWAN connected devices cited above for all three markets e.g. consumer business and machine to machine that still maintain the necessary profit margins for the WWAN carriers to be successful with these various service businesses.

Accordingly various embodiments disclosed herein provide for a new and flexible augmentation or replacement for existing carrier network service usage measurement service usage accounting and service usage billing systems and techniques.

A charging data record CDR is a term that as used herein defines a formatted measure of device service usage information typically generated by one or more network functions that supervise monitor and or control network access for the device. CDRs typically form the basis for recording device network service usage and often form the basis for billing for such usage. Various embodiments are provided herein for device assisted CDR creation mediation and billing. There are many limitations to the capabilities of service usage recording aggregation and or billing when CDRs are generated exclusively by network based functions or equipment. Accordingly by either augmenting network based service usage measures with device based service usage measures or by replacing network based service usage measures with device based service usage measures it is possible to create a CDR generation aggregation mediation and or billing solution that has superior or more desirable capabilities features. While in theory many of the service usage measures that can be evaluated on a device can also be evaluated in the network data path using various network equipment technologies including but not limited to deep packet inspection DPI there are many examples where measuring service usage at the device is either more desirable or more practical or in some cases it is the only way to obtain the desired measure. Such examples include but are not limited to the following 

In some embodiments techniques such as a system and or process that utilize device assisted service usage measures include one or more of the following 1 receiving a service usage measure from a device in communication with a wireless network 2 verifying or protecting the validity of the service usage measure 3 generating a CDR based on the service usage measure e.g. device assisted CDR 4 aggregating CDRs and 5 mediating the CDR with network CDRs. In some embodiments the techniques also include providing a design and provisioning of devices network equipment to recognize the CDRs. In some embodiments the techniques also include provisioning to recognize that the device belongs to a Device Assisted Services DAS device group and that corresponding CDRs should be accepted and mediated. In some embodiments the device assisted CDRs are also generated using formats network communications protocols network device authentication and or provisioning to allow device assisted CDRs into the network CDR system encryption and or signatures as required by the network e.g. to comply with network generated CDR requirements or based on any other network and or service provider requirements and or standards .

In some embodiments mediation rules include multi device multi user single user devices and or intermediate networking devices that can be single user or multi user as described herein.

In some embodiments a device assisted CDR generator collects device based service usage measures that are used as the basis for or as an enhancement e.g. as a supplement or in addition to one or more e.g. network generated CDRs that provide one or more networking functions with properly formatted service usage reports that the network function s accepts as being transmitted from an authorized source read and utilized for helping to determine the service usage of a device or group of devices. In some embodiments the network functions that the device assisted CDR generator shares CDRs with typically include one or more of the following service usage CDR aggregation and or mediation servers gateways routers communication nodes Mobile Wireless Centers MWCs including HLRs databases AAA systems billing interfaces and billing systems. For example the process of CDR creation in the CDR generator typically includes either using one or more device based measures of service usage or one or more device based measures of service usage in combination with one or more network based measures of service usage possibly processing one or more of such service usage measures according to a set of CDR creation CDR aggregation and or CDR mediation rules to arrive at a final device usage measure that is for example then formatted with the proper syntax framed possibly encrypted and or signed and encapsulated in a communication protocol or packet suitable for sharing with network functions. In some embodiments the CDR generator resides in the device. In some embodiments the CDR generator resides in a network server function that receives the device assisted service usage measures along with possibly network based usage measures and then creates a CDR e.g. in the service controller .

In some embodiments the device assisted CDR generator can reside in the service processor e.g. service processor for example in the service usage history or billing server functions. In some embodiments the device assisted CDR generator resides in the device itself for example within the service processor functions such as the billing agent or the service monitor agent.

There are several factors that are considered in the various embodiments in order to create a useful reliable and secure device assisted CDR system including for example but not limited to 

In some embodiments verification of the relative accuracy of the device assisted service usage measure is provided. Given that for example the service usage measure is often being generated on an end user device or a device that is readily physically accessed by the general public or other non secure personnel from a network management viewpoint in some embodiments the device agents used in one or more of the service processor agents are protected from hacking spoofing and or other misuse. Various techniques are provided herein for protecting the integrity of the agents used for generating the device assisted service usage measures.

In some embodiments the service usage measures are verified by network based cross checks using various techniques. For example network based cross checks can provide valuable verification techniques because for example it is generally not possible or at least very difficult to defeat well designed network based cross checks using various techniques such as those described herein even if for example the measures used to protect the device agents are defeated or if no device protection measures are employed. In some embodiments network based cross checks used to verify the device assisted service usage measures include comparing network based service usage measures e.g. CDRs generated by service usage measurement apparatus in the network equipment such as the BTS BSCs RAN Gateways Transport Gateways Mobile Wireless Center HLRs AAA Service Usage History CDR Aggregation Mediation Feed or other network equipment sending secure query response command sequences to the service processor agent s involved in device assisted CDR service usage measurement or CDR creation sending test service usage event sequences to the device and verifying that the device properly reported the service usage and using various other techniques such as those described herein with respect to various embodiments.

In some embodiments one or more of the following actions are taken if the device based service usage measure is found to be in error or inaccurate bill the user for usage overage or an out of policy device suspend the device quarantine the device SPAN the device and or report the device to a network administration function or person.

In some embodiments the CDR syntax used to format the device assisted service usage information into a CDR and or network communication protocols for transmitting CDRs are determined by industry standards e.g. various versions of 3GPP TS 32.215 format and 3GPP2 TSG X X.S0011 or TIA 835 format . In some embodiments for a given network implementation the network designers will specify modifications of the standard syntax formats and or network communication transmission protocols. In some embodiments for a given network implementation the network designers will specify syntax formats and or network communication transmission protocols that are entirely different than the standards.

In some embodiments within the syntax and formatting for the CDR the device assisted service usage is typically categorized by a transaction code. For example the transaction code can be similar or identical to the codes in use by network equipment used to generate CDRs or given that the device is capable of generating a much richer set of service usage measures the transaction codes can be a superset of the codes used by network equipment used to generate CDRs e.g. examples of the usage activities that can be labeled as transaction codes that are more readily supported by device assisted CDR systems as compared to purely network based CDR systems are provided herein .

In some embodiments the device sends an identifier for a usage activity tag an intermediate server determines how to aggregate into CDR transaction codes and which CDR transaction code to use.

In some embodiments the device service processor compartmentalizes usage by pre assigned device activity transaction codes e.g. these can be sub transactions within the main account transactions within a given bill by account transaction or sub transactions within a bill by account transaction . The device implements bill by account rules to send different usage reports for each bill by account function. In some embodiments the service controller programs the device to instruct it on how to compartmentalize these bill by account service usage activities so that they can be mapped to a transaction code.

In some embodiments the device reports less compartmentalized service usage information and the service controller does the mapping of service usage activities to CDR transaction codes including in some cases bill by account codes.

In some embodiments the CDR sent to or other network equipment for example can include various types of transaction codes including but not limited to a raw device usage CDR a bill by account e.g. a sub activity transaction code CDR a billing offset CDR and or a billing credit CDR. For example the decision logic also referred to as business rules or CDR aggregation and mediation rules that determines how these various types of CDR transaction codes are to be aggregated and mediated by the core network and the billing system can be located in the network equipment e.g. a network element such as service usage in the service controller and or in the billing system .

In some embodiments the device assisted CDR generator uses the device assisted service usage measures to generate a CDR that includes service usage information service usage transaction code s and in some embodiments network information context. In some embodiments the service usage information transaction code and or network information context is formatted into communication framing syntax encryption signature security and or networking protocols that are compatible with the formatting used by conventional networking equipment to generate CDRs. For example this allows networking equipment used for CDR collection recording aggregation mediation and or conversion to billing records to properly accept read and interpret the CDRs that are generated with the assistance of device based service usage measurement. In some embodiments the device assisted service measures are provided to an intermediate network server referred to as a service controller e.g. service controller . In some embodiments the service controller uses a CDR feed aggregator for a wireless network to collect device generated usage information for one or more devices on the wireless network and provides the device generated usage information in a syntax e.g. charging data record CDR and a communication protocol e.g. 3GPP or 3GPP2 or other communication protocol s that can be used by the wireless network to augment or replace network generated usage information for the one or more devices on the wireless network.

In some embodiments mediation rules include multi device multi user single user devices intermediate networking devices that can be single user or multi user. For example the device assisted CDRs can be formatted by the device assisted CDR generator to include a transaction code for one user account even though the CDRs originate from multiple devices that all belong to the same user. This is an example for a multi user device assisted CDR billing solution. In another example for a multi user device assisted CDR billing solution device assisted CDRs from multiple devices and multiple users can all be billed to the same account e.g. a family plan or a corporate account but the bill by account CDR transaction records can be maintained through the billing system so that sub account visibility is provided so that the person or entity responsible for the main account can obtain visibility about which users and or devices are creating most of the service usage billing. For example this type of multi user multi device device assisted CDR billing solution can also be used to track types of service usage and or bill for types of service usage that are either impossible or at least very difficult to account and or bill for with purely network based CDR systems. In some embodiments bill by account CDR transaction records can be used to provide sponsored transaction services account for network chatter provide service selection interfaces and other services for multi user or multi device service plans.

In addition to conventional single user devices e.g. cell phones smart phones netbooks notebooks mobile internet devices personal navigation devices music players electronic eReaders and other single user devices device assisted service usage measurement and CDRs are also useful for other types of network capable devices and or networking devices such as intermediate networking devices e.g. 3G 4G WWAN to WLAN bridges routers gateways femto cells DOCSIS modems DSL modems remote access backup routers and other intermediate network devices . For example in such devices particularly with a secure manner to verify that the device assisted service usage measures are relatively accurate and or the device service processor software is not compromised or hacked many new service provider service delivery and billing models can be supported and implemented using the techniques described herein. For example in a WiFi to WWAN bridge or router device multiple user devices can be supported with the same intermediate networking device in a manner that is consistent and compatible with the central provider s CDR aggregation and or billing system by sending device assisted CDRs as described herein that have a service usage and or billing code referenced to the end user and or the particular intermediate device.

In some embodiments the device assisted CDRs generated for the intermediate networking device are associated with a particular end user in which there can be several or many end users using the intermediate networking device for networking access and in some embodiments with each end user being required to enter a unique log in to the intermediate networking device. For example in this way all devices that connect using WiFi to the intermediate networking device to get WWAN access generate CDRs can either get billed to a particular end user who is responsible for the master account for that device or the CDRs can get billed in a secure manner with verified relative usage measurement accuracy to multiple end users from the same intermediate networking device. In another example an end user can have one account that allows access to a number of intermediate networking devices and each intermediate networking device can generate consistent device assisted CDRs with transaction codes for that end user regardless of which intermediate networking device the end user logs in on.

In some embodiments some of the services provided by the intermediate networking device are billed to a specific end user device assisted CDR transaction code while other bill by account services are billed to other transaction code accounts such as sponsored partner transaction service accounts network chatter accounts sponsored advertiser accounts and or service sign up accounts. For example in this manner various embodiments are provided in which intermediate networking devices e.g. a WWAN to WiFi router bridge can sold to one user but can service and be used to bill other users e.g. and this can be covered in the first purchasing user s service terms perhaps in exchange for a discount or such intermediate networking devices can be located wherever access is desired without concern that the device will be hacked into so that services can be acquired without charge.

In some embodiments various types of service usage transactions are billed for on the intermediate networking device to any of one or more users in which the information required to bill for such services is not available to the central provider or MVNO network equipment just as is the case with for example conventional single user devices. In view of the various embodiments and techniques described herein those skilled in the art will appreciate that similar service models are equally applicable not just to WWAN to WiFi intermediate networking devices but also to the Femto Cell remote access router DOCSIS DSL and other intermediate WWAN to WiFi networking devices.

As shown in a CDR storage aggregation mediation feed e.g. service usage including a billing aggregation data store and rules engine is a functional descriptor for in some embodiments a device network level service usage information collection aggregation mediation and reporting function located in one or more of the networking equipment components attached to one or more of the sub networks shown in e.g. central provider access network and or central provider core network which is in communication with the service controller and a central billing interface . As shown in service usage is shown as a function in communication with the central provider core network . In some embodiments the CDR storage aggregation mediation feed function is located elsewhere in the network or partially located in elsewhere or integrated with as part of other network elements. In some embodiments CDR storage aggregation mediation feed functionality is located or partially located in the AAA server and or the mobile wireless center Home Location Register HLR as shown in communication with a DNS DHCP server . In some embodiments service usage functionality is located or partially located in the base station base station controller and or base station aggregator collectively referred to as base station in . In some embodiments CDR storage aggregation mediation feed functionality is located or partially located in a networking component in the central provider access network a networking component in the core network the central billing system the central billing interface and or in another network component or function. This discussion on the possible locations for the network based and device based service usage information collection aggregation mediation and reporting function e.g. CDR storage aggregation mediation feed can be easily generalized as described herein and as shown in the other figures described herein by one of ordinary skill in the art. Also as shown in the service controller is in communication with the central billing interface also sometimes referred to as the external billing management interface or billing communication interface which is in communication with the central billing system . As shown an order management and subscriber management are also in communication with the central provider core network for facilitating order and subscriber management of services for the devices in accordance with some embodiments.

In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements provides a device network level service usage information collection aggregation mediation and reporting function. In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements collects device generated usage information for one or more devices on the wireless network e.g. devices and provides the device generated usage information in a syntax and a communication protocol that can be used by the wireless network to augment or replace network generated usage information for the one or more devices on the wireless network. In some embodiments the syntax is a charging data record CDR and the communication protocol is selected from one or more of the following 3GPP 3GPP2 or other communication protocols. In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements includes a service usage data store e.g. a billing aggregator and a rules engine for aggregating the collected device generated usage information. In some embodiments the syntax is a charging data record CDR and the network device is a CDR feed aggregator and the CDR storage aggregation mediation feed and or other network elements or combinations of network elements also aggregates CDRs for the one or more devices on the wireless network applies a set of rules to the aggregated CDRs using a rules engine e.g. bill by account transactional billing and or any other billing or other rules for service usage information collection aggregation mediation and reporting and communicates a new set of CDRs for the one or more devices on the wireless network to a billing interface or a billing system e.g. providing a CDR with a billing offset by account service . In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements communicates a new set of CDRs for the one or more devices on the wireless network to a billing interface or a billing system. In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements communicates with a service controller to collect the device generated usage information for the one or more devices on the wireless network. In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements communicates with a service controller in which the service controller is in communication with a billing interface or a billing system. In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements communicates the device generated usage information to a billing interface or a billing system. In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements communicates with a transport gateway and or a Radio Access Network RAN gateway to collect the network generated usage information for the one or more devices on the wireless network. In some embodiments the service controller communicates the device generated service usage information to the CDR storage aggregation mediation feed and or other network elements or combinations of network elements .

In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements performs rules for performing a bill by account aggregation and mediation function. In some embodiments the service controller in communication with the CDR storage aggregation mediation feed and or other network elements or combinations of network elements performs a rules engine for aggregating and mediating the device generated usage information. In some embodiments a rules engine device in communication with the CDR storage aggregation mediation feed and or other network elements or combinations of network elements performs a rules engine for aggregating and mediating the device generated usage information.

In some embodiments the rules engine is included in e.g. integrated with part of the CDR storage aggregation mediation feed . In some embodiments the rules engine and associated functions as described herein is a separate function device. In some embodiments the service controller performs some or all of these rules engine based functions as described herein and communicates with the central billing interface . In some embodiments the service controller performs some or all of these rules engine based functions as described herein and communicates with the central billing system .

In some embodiments duplicate CDRs are sent from the network equipment to the billing system that is used for generating service billing. In some embodiments duplicate CDRs are filtered to send only those CDRs records for devices controlled by the service controller and or service processor e.g. the managed devices . For example this approach can provide for the same level of reporting lower level of reporting and or higher level of reporting as compared to the reporting required by the central billing system .

In some embodiments a bill by account billing offset is provided. For example bill by account billing offset information can be informed to the central billing system by providing a CDR aggregator feed that aggregates the device based service usage data feed to provide a new set of CDRs for the managed devices to the central billing interface and or the central billing system . In some embodiments transaction billing is provided using similar techniques. For example transaction billing log information can be provided to the central billing interface and or the central billing system .

In some embodiments the rules engine e.g. performed by the service usage or another network element as described herein provides a bill by account billing offset. For example device generated usage information e.g. charging data records CDRs includes a transaction type field e.g. indicating a type of service for the associated service usage information . The rules engine can apply a rule or a set of rules based on the identified service associated with the device generated usage information to determine a bill by account billing offset e.g. a new CDR can be generated to provide the determined bill by account billing offset . In some examples the determined bill by account billing offset can be provided as a credit to the user s service usage account e.g. a new CDR can be generated with a negative offset for the user s service usage account such as for network chatter service usage or transactional service usage or for any other purposes based on one or more rules performed by the rules engine .

As another example for a transactional service a first new CDR can be generated with a negative offset for the user s service usage account for that transactional service related usage and a second new CDR can be generated with a positive service usage value to charge that same service usage to the transactional service provider e.g. Amazon eBay or another transactional service provider . In some embodiments the service controller generates these two new CDRs and the service usage stores aggregates and communicates these two new CDRs to the central billing interface . In some embodiments the service controller generates these two new CDRs and the service usage stores aggregates and communicates these two new CDRs to the central billing interface in which the central billing interface applies rules e.g. performs the rules engine for determining the bill by account billing offset .

In some embodiments the service controller sends the device generated CDRs to the rules engine e.g. service usage and the rules engine applies one or more rules such as those described herein and or any other billing service usage related rules as would be apparent to one of ordinary skill in the art. In some embodiments the service controller generates CDRs similar to other network elements and the rules e.g. bill by account are performed in the central billing interface . For example for the service controller to generate CDRs similar to other network elements in some embodiments the service controller is provisioned on the wireless network and behaves substantially similar to other CDR generators on the network as would be apparent to one of ordinary skill in the art.

In some embodiments the service controller is provisioned as a new type of networking function that is recognized as a valid and secure source for CDRs by the other necessary elements in the network e.g. the Service Usage History CDR Aggregation and Mediation Server . In some embodiments in which the network apparatus typically only recognize CDRs from certain types of networking equipment e.g. RAN Gateway or Transport Gateway as shown in then the Service Controller can provide authentication credentials to the other networking equipment that indicate it is one of the approved types of equipment e.g. for purposes of generating providing CDRs . In some embodiments the link between the Service Controller and the necessary CDR aggregation and mediation equipment is secured authenticated encrypted and or signed.

In some embodiments the CDR storage aggregation mediation feed discards the network based service usage information e.g. network based CDRs received from one or more network elements. In these embodiments the service controller can provide the device based service usage information e.g. device based CDRs to the CDR storage aggregation mediation feed e.g. the CDR storage aggregation mediation feed can just provide a store aggregate and communication function s and the device based service usage information is provided to the central billing interface or the central billing system .

In some embodiments the device based CDRs and or new CDRs generated based on execution of a rules engine as described herein is provided only for devices that are managed and or based on device group service plan or any other criteria categorization and or grouping.

As shown includes a 4G 3G 2G wireless network operated by for example a central provider. In some embodiments each of the wireless devices includes a service processor as shown and each service processor connects through a secure control plane link to a service controller . In some embodiments the network based service usage information e.g. network generated CDRs is obtained from Radio Access Network RAN gateway s and or transport gateway s . In some embodiments device based service usage information e.g. device assisted CDRs are generated by the service processor and or service controller for some or all of the wireless devices using similar techniques as described herein and in some embodiments such device based service usage information e.g. device assisted CDRs is sent to the CDR storage aggregation mediation feed e.g. the CDR storage aggregation mediation feed can just provide a store aggregate and communication function s and or to the central billing interface or the central billing system as similarly described herein with respect to various embodiments.

In some embodiments provisioning of various network equipment is provided to recognize a given device as belonging to a device group that supports a service usage and or billing plan that relies upon and or utilizes device assisted CDRs.

In some embodiments the CDR formats transaction codes and CDR transmission destinations are programmed for each device that generates CDRs including the service controller e.g. in some embodiments the service controller is the intermediary for CDRs and or service processor e.g. in some embodiments the device sends CDRs to network CDR aggregation or billing interface billing system with no intermediate server function .

In some embodiments device assisted CDRs are sent from the service controller to CDR storage aggregation mediation feed and communicated to the billing system as shown in solid lines with arrows in . In some embodiments CDR storage aggregation mediation feed uses DAS service usage CDRs to augment network generated based CDRs with bill by account transaction codes e.g. as similarly described herein . In some embodiments CDR storage aggregation mediation feed implements aggregation and or mediation rules to account for DAS CDR usage amount in a new bill by account transaction code and removes the same service usage amount from the bulk device account transaction code. In some embodiments a first DAS CDR is sent for the new bill by account transaction code and a second DAS CDR is sent to be used as a correction credit to the main device usage account transaction code and CDR storage aggregation mediation feed implements the rules to perform this mediation. In some embodiments a first DAS CDR is used for a given bill by account transaction code and a second DAS CDR is used as the main device account transaction code in which the service controller or device has already implemented the mediation rules so that CDR storage aggregation mediation feed simply passes such DAS CDRs to billing after aggregating them.

In some embodiments service controller sends DAS CDRs to billing for various uses by the billing system . In some embodiments the billing system uses DAS service usage CDRs to augment network based CDRs with bill by account transaction codes. In some embodiments the billing system implements aggregation and or mediation rules to account for DAS CDR usage amount in a new bill by account transaction code and removes the same service usage amount from the bulk device account transaction code. In some embodiments a first DAS CDR is sent for the new bill by account transaction code and a second DAS CDR is sent to be used as a correction credit to the main device usage account transaction code and the billing system implements the rules to perform this mediation. In some embodiments a first DAS CDR is used for a given bill by account transaction code and a second is used as the main device account transaction code in which the service controller or device has already implemented the mediation rules so that the billing system simply passes such DAS CDRs after aggregating them.

As shown in service processor includes a service control device link . For example as device based service control techniques involving supervision across a network become more sophisticated it becomes increasingly important to have an efficient and flexible control plane communication link between the device agents and the network elements communicating with controlling monitoring or verifying service policy. In some embodiments the service control device link provides the device side of a system for transmission and reception of service agent to from network element functions. In some embodiments the traffic efficiency of this link is enhanced by buffering and framing multiple agent messages in the transmissions. In some embodiments the traffic efficiency is further improved by controlling the transmission frequency or linking the transmission frequency to the rate of service usage or traffic usage. In some embodiments one or more levels of security or encryption are used to make the link robust to discovery eavesdropping or compromise. In some embodiments the service control device link also provides the communications link and heartbeat timing for the agent heartbeat function. As discussed below various embodiments disclosed herein for the service control device link provide an efficient and secure solution for transmitting and receiving service policy implementation control monitoring and verification information with other network elements.

As shown in the service controller includes a service control server link . In some embodiments device based service control techniques involving supervision across a network e.g. on the control plane are more sophisticated and for such it is increasingly important to have an efficient and flexible control plane communication link between the device agents e.g. of the service processor and the network elements e.g. of the service controller communicating with controlling monitoring or verifying service policy. For example the communication link between the service control server link of service controller and the service control device link of the service processor can provide an efficient and flexible control plane communication link a service control link as shown in and in some embodiments this control plane communication link provides for a secure e.g. encrypted communications link for providing secure bidirectional communications between the service processor and the service controller . In some embodiments the service control server link provides the network side of a system for transmission and reception of service agent to from network element functions. In some embodiments the traffic efficiency of this link is enhanced by buffering and framing multiple agent messages in the transmissions e.g. thereby reducing network chatter . In some embodiments the traffic efficiency is further improved by controlling the transmission frequency and or linking the transmission frequency to the rate of service usage or traffic usage. In some embodiments one or more levels of security and or encryption are used to secure the link against potential discovery eavesdropping or compromise of communications on the link. In some embodiments the service control server link also provides the communications link and heartbeat timing for the agent heartbeat function.

In some embodiments the service control server link provides for securing signing encrypting and or otherwise protecting the communications before sending such communications over the service control link . For example the service control server link can send to the transport layer or directly to the link layer for transmission. In another example the service control server link further secures the communications with transport layer encryption such as TCP TLS SSH version 1 or 2 or another secure transport layer protocol. As another example the service control server link can encrypt at the link layer such as using IPSEC various possible VPN services other forms of IP layer encryption and or another link layer encryption technique.

As shown in the service controller includes an access control integrity server . In some embodiments the access control integrity server collects device information on service policy service usage agent configuration and or agent behavior. For example the access control integrity server can cross check this information to identify integrity breaches in the service policy implementation and control system. In another example the access control integrity server can initiate action when a service policy violation or a system integrity breach is suspected.

In some embodiments the access control integrity server and or some other agent of service controller acts on access control integrity agent reports and error conditions. Many of the access control integrity agent checks can be accomplished by the server. For example the access control integrity agent checks include one or more of the following service usage measure against usage range consistent with policies e.g. usage measure from the network and or from the device configuration of agents operation of the agents and or dynamic agent download.

In some embodiments the access control integrity server and or some other agent of service controller verifies device service policy implementations by comparing various service usage measures e.g. based on network monitored information such as by using IPDRs or CDRs and or local service usage monitoring information against expected service usage behavior given the policies that are intended to be in place. For example device service policy implementations can include measuring total data passed data passed in a period of time IP addresses data per IP address and or other measures such as location downloads email accessed URLs and comparing such measures expected service usage behavior given the policies that are intended to be in place.

In some embodiments the access control integrity server and or some other agent of service controller verifies device service policy and the verification error conditions that can indicate a mismatch in service measure and service policy include one or more of the following unauthorized network access e.g. access beyond ambient service policy limits unauthorized network speed e.g. average speed beyond service policy limit network data amount does not match policy limit e.g. device not stop at limit without re up revising service policy unauthorized network address unauthorized service usage e.g. VOIP email and or web browsing unauthorized application usage e.g. email VOIP email and or web service usage rate too high for plan and policy controller not controlling throttling it down and or any other mismatch in service measure and service policy. Accordingly in some embodiments the access control integrity server and or some other agent of service controller provides a policy service control integrity service to continually e.g. periodically and or based on trigger events verify that the service control of the device has not been compromised and or is not behaving out of policy.

As shown in service controller includes a service history server . In some embodiments the service history server collects and records service usage or service activity reports from the Access Network AAA Server and the Service Monitor Agent . For example although service usage history from the network elements can in certain embodiments be less detailed than service history from the device the service history from the network can provide a valuable source for verification of device service policy implementation because for example it is extremely difficult for a device error or compromise event on the device to compromise the network based equipment and software. For example service history reports from the device can include various service tracking information as similarly described above. In some embodiments the service history server provides the service history on request to other servers and or one or more agents. In some embodiments the service history server provides the service usage history to the device service history . In some embodiments for purposes of facilitating the activation tracking service functions described below the service history server maintains a history of which networks the device has connected to. For example this network activity summary can include a summary of the networks accessed activity versus time per connection and or traffic versus time per connection. As another example this activity summary can further be analyzed or reported to estimate the type of service plan associated with the traffic activity for the purpose of bill sharing reconciliation.

As shown in service controller includes a policy management server . In some embodiments the policy management server transmits policies to the service processor via the service control link . In some embodiments the policy management server manages policy settings on the device e.g. various policy settings as described herein with respect to various embodiments in accordance with a device service profile. In some embodiments the policy management server sets instantaneous policies on policy implementation agents e.g. policy implementation agent . For example the policy management server can issue policy settings monitor service usage and if necessary modify policy settings. For example in the case of a user who prefers for the network to manage their service usage costs or in the case of any adaptive policy management needs the policy management server can maintain a relatively high frequency of communication with the device to collect traffic and or service measures and issue new policy settings. In this example device monitored service measures and any user service policy preference changes are reported periodically and or based on various triggers events requests to the policy management server . In this example user privacy settings generally require secure communication with the network e.g. a secure service control link such as with the policy management server to ensure that various aspects of user privacy are properly maintained during such configuration requests policy settings transmitted over the network. For example information can be compartmentalized to service policy management and not communicated to other databases used for CRM for maintaining user privacy.

In some embodiments the policy management server provides adaptive policy management on the device. For example the policy management server can issue policy settings and objectives and rely on the device based policy management e.g. service processor for some or all of the policy adaptation. This approach can require less interaction with the device thereby reducing network chatter on service control link for purposes of device policy management e.g. network chatter is reduced relative to various server network based policy management approaches described above . This approach can also provide robust user privacy embodiments by allowing the user to configure the device policy for user privacy preferences settings so that for example sensitive information e.g. geo location data website history is not communicated to the network without the user s approval. In some embodiments the policy management server adjusts service policy based on time of day. In some embodiments the policy management server receives requests or otherwise obtains a measure of network availability and adjusts traffic shaping policy and or other policy settings based on available network capacity.

As shown in service controller includes a network traffic analysis server . In some embodiments the network traffic analysis server collects receives service usage history for devices and or groups of devices and analyzes the service usage. In some embodiments the network traffic analysis server presents service usage statistics in various formats to identify improvements in network service quality and or service profitability. In other embodiments the network traffic analysis server estimates the service quality and or service usage for the network under variable settings on potential service policy. In other embodiments the network traffic analysis server identifies actual or potential service behaviors by one or more devices that are causing problems for overall network service quality or service cost.

As shown in service controller includes a beta test server . In some embodiments the beta test server publishes candidate service plan policy settings to one or more devices. In some embodiments the beta test server provides summary reports of network service usage or user feedback information for one or more candidate service plan policy settings. In some embodiments the beta test server provides a mechanism to compare the beta test results for different candidate service plan policy settings or select the optimum candidates for further policy settings optimization.

As shown in service controller includes a service download control server . In some embodiments the service download control server provides a download function to install and or update service software elements e.g. the service processor and or agents components of the service processor on the device as described herein.

As shown in service controller includes a billing event server . In some embodiments the billing event server collects billing events provides service plan information to the service processor provides service usage updates to the service processor serves as interface between device and central billing server and or provides trusted third party function for certain ecommerce billing transactions.

As shown in the Access Network AAA server is in network communication with the access network . In some embodiments the Access Network AAA server provides the necessary access network AAA services e.g. access control and authorization functions for the device access layer to allow the devices onto the central provider access network and the service provider network. In some embodiments another layer of access control is required for the device to gain access to other networks such as the Internet a corporate network and or a machine to machine network. This additional layer of access control can be implemented for example by the service processor on the device. In some embodiments the Access Network AAA server also provides the ability to suspend service for a device and resume service for a device based on communications received from the service controller . In some embodiments the Access Network AAA server also provides the ability to direct routing for device traffic to a quarantine network or to restrict or limit network access when a device quarantine condition is invoked. In some embodiments the Access Network AAA server also records and reports device network service usage e.g. device network service usage can be reported to device service history .

As shown in the device service history is in network communication with the access network . In some embodiments the device service history provides service usage data records used for various purposes in various embodiments. In some embodiments the device service history is used to assist in verifying service policy implementation. In some embodiments the device service history is used to verify service monitoring. In some embodiments the device service history is used to verify billing records and or billing policy implementation. In some embodiments the device service history is used to synchronize and or verify the local service usage counter.

As shown in the central provider billing server is in network communication with the access network . In some embodiments the central provider billing server provides a mediation function for central provider billing events. For example the central provider billing server can accept service plan changes. In some embodiments the central provider billing server provides updates on device service usage service plan limits and or service policies. In some embodiments the central provider billing server collects billing events formulates bills bills service users provides certain billing event data and service plan information to the service controller and or device .

As shown in in some embodiments modem selection and control selects the access network connection and is in communication with the modem firewall and modem drivers convert data traffic into modem bus traffic for one or more modems and are in communication with the modem selection and control . In some embodiments different profiles are selected based on the selected network connection e.g. different service profiles policies for WWAN WLAN WPAN Ethernet and or DSL network connections which is also referred to herein as multimode profile setting. For example service profile settings can be based on the actual access network e.g. home DSL cable or work network behind the Wi Fi not the fact that it is Wi Fi or any other network such as DSL cable satellite or T 1 which is viewed as different than accessing a Wi Fi network at the coffee shop. For example in a Wi Fi hotspot situation in which there are a significant number of users on a DSL or T 1 backhaul the service controller can sit in a service provider cloud or an MVNO cloud the service controls can be provided by a VSP capability offered by the service provider or the service controller can be owned by the hotspot service provider that uses the service controller on their own without any association with an access network service provider. For example the service processors can be controlled by the service controller to divide up the available bandwidth at the hotspot according to QoS or user sharing rules e.g. with some users having higher differentiated priority potentially for higher service payments than other users . As another example ambient services as similarly described herein can be provided for the hotspot for verified service processors.

In some embodiments the service processor and service controller are capable of assigning multiple service profiles associated with multiple service plans that the user chooses individually or in combination as a package. For example a device starts with ambient services that include free transaction services wherein the user pays for transactions or events rather than the basic service e.g. a news service eReader PND service pay as you go session Internet in which each service is supported with a bill by account capability to correctly account for any subsidized partner billing to provide the transaction services e.g. Barnes and Noble may pay for the eReader service and offer a revenue share to the service provider for any book or magazine transactions purchased from the device . In some embodiments the bill by account service can also track the transactions and in some embodiments advertisements for the purpose of revenue sharing all using the service monitoring capabilities disclosed herein. After initiating services with the free ambient service discussed above the user may later choose a post pay monthly Internet email and SMS service. In this case the service controller would obtain from the billing system in the case of network based billing or in some embodiments the service controller billing event server in the case of device based billing the billing plan code for the new Internet email and SMS service. In some embodiments this code is cross referenced in a database e.g. the policy management server to find the appropriate service profile for the new service in combination with the initial ambient service. The new superset service profile is then applied so that the user maintains free access to the ambient services and the billing partners continue to subsidize those services the user also gets access to Internet services and may choose the service control profile e.g. from one of the embodiments disclosed herein . The superset profile is the profile that provides the combined capabilities of two or more service profiles when the profiles are applied to the same device service processor. In some embodiments the device service processor can determine the superset profile rather than the service controller when more than one stackable service is selected by the user or otherwise applied to the device. The flexibility of the service processor and service controller embodiments described herein allow for a large variety of service profiles to be defined and applied individually or as a superset to achieve the desired device service features.

As shown in an agent communication bus represents a functional description for providing communication for the various service processor agents and functions. In some embodiments as represented in the functional diagram illustrated in the architecture of the bus is generally multipoint to multipoint so that any agent can communicate with any other agent the service controller or in some cases other components of the device such user interface and or modem components. As described below the architecture can also be point to point for certain agents or communication transactions or point to multipoint within the agent framework so that all agent communication can be concentrated or secured or controlled or restricted or logged or reported. In some embodiments the agent communication bus is secured signed encrypted hidden partitioned and or otherwise protected from unauthorized monitoring or usage. In some embodiments an application interface agent not shown is used to literally tag or virtually tag application layer traffic so that the policy implementation agent s has the necessary information to implement selected traffic shaping solutions. In some embodiments an application interface agent not shown is in communication with various applications including a TCP application an IP application and a voice application .

In some embodiments device assisted services DAS techniques for providing an activity map for classifying or categorizing service usage activities to associate various monitored activities e.g. by URL by network domain by website by network traffic type by application or application type and or any other service usage activity categorization classification with associated IP addresses are provided. In some embodiments a policy control agent not shown service monitor agent or another agent or function or combinations thereof of the service processor provides a DAS activity map. In some embodiments a policy control agent service monitor agent or another agent or function or combinations thereof of the service processor provides an activity map for classifying or categorizing service usage activities to associate various monitored activities e.g. by Uniform Resource Locator URL by network domain by website by network traffic type by application or application type and or any other service usage activity classification categorization with associated IP addresses. In some embodiments a policy control agent service monitor agent or another agent or function or combinations thereof of the service processor determines the associated IP addresses for monitored service usage activities using various techniques to snoop the DNS request s e.g. by performing such snooping techniques on the device the associated IP addresses can be determined without the need for a network request for a reverse DNS lookup . In some embodiments a policy control agent service monitor agent or another agent or function or combinations thereof of the service processor records and reports IP addresses or includes a DNS lookup function to report IP addresses or IP addresses and associated URLs for monitored service usage activities. For example a policy control agent service monitor agent or another agent or function or combinations thereof of the service processor can determine the associated IP addresses for monitored service usage activities using various techniques to perform a DNS lookup function e.g. using a local DNS cache on the monitored device . In some embodiments one or more of these techniques are used to dynamically build and maintain a DAS activity map that maps for example URLs to IP addresses applications to IP addresses content types to IP addresses and or any other categorization classification to IP addresses as applicable. In some embodiments the DAS activity map is used for various DAS traffic control and or throttling techniques as described herein with respect to various embodiments. In some embodiments the DAS activity map is used to provide the user various UI related information and notification techniques related to service usage as described herein with respect to various embodiments. In some embodiments the DAS activity map is used to provide service usage monitoring prediction estimation of future service usage service usage billing e.g. bill by account and or any other service usage billing categorization techniques DAS techniques for ambient services usage monitoring DAS techniques for generating micro CDRs e.g. also referred to as service usage partition service usage recording partition service charging bucket device generated CDRs such as in the case where the device and not a network component are generating the usage records ambient usage records specialized service usage records or other terms to indicate a service usage data record generated to provide a more refined or detailed breakdown of service usage for the device and or any of the various other DAS related techniques as described herein with respect to various embodiments.

In some embodiments all or a portion of the service processor functions disclosed herein are implemented in software. In some embodiments all or a portion of the service processor functions are implemented in hardware. In some embodiments all or substantially all of the service processor functionality as discussed herein is implemented and stored in software that can be performed on e.g. executed by various components in device . In some embodiments it is advantageous to store or implement certain portions or all of service processor in protected or secure memory so that other undesired programs and or unauthorized users have difficulty accessing the functions or software in service processor . In some embodiments service processor at least in part is implemented in and or stored on secure non volatile memory e.g. non volatile memory can be secure non volatile memory that is not accessible without pass keys and or other security mechanisms. In some embodiments the ability to load at least a portion of service processor software into protected non volatile memory also requires a secure key and or signature and or requires that the service processor software components being loaded into non volatile memory are also securely encrypted and appropriately signed by an authority that is trusted by a secure software downloader function such as service downloader as shown in . In some embodiments a secure software download embodiment also uses a secure non volatile memory. Those of ordinary skill in the art will also appreciate that all memory can be on chip off chip on board and or off board.

In some embodiments the service monitor agent and or other agents implement virtual traffic tagging by tracking or tracing packet flows through the various communication stack formatting processing and encryption steps and providing the virtual tag information to the various agents that monitor control shape throttle or otherwise observe manipulate or modify the traffic. This tagging approach is referred to herein as virtual tagging because there is not a literal data flow traffic flow or packet tag that is attached to flows or packets and the book keeping to tag the packet is done through tracking or tracing the flow or packet through the stack instead. In some embodiments the application interface and or other agents identify a traffic flow associate it with a service usage activity and cause a literal tag to be attached to the traffic or packets associated with the activity. This tagging approach is referred to herein as literal tagging. There are various advantages with both the virtual tagging and the literal tagging approaches. For example it can be preferable in some embodiments to reduce the inter agent communication required to track or trace a packet through the stack processing by assigning a literal tag so that each flow or packet has its own activity association embedded in the data. As another example it can be preferable in some embodiments to re use portions of standard communication stack software or components enhancing the verifiable traffic control or service control capabilities of the standard stack by inserting additional processing steps associated with the various service agents and monitoring points rather than re writing the entire stack to correctly process literal tagging information and in such cases a virtual tagging scheme may be desired. As yet another example some standard communication stacks provide for unused unspecified or otherwise available bit fields in a packet frame or flow and these unused unspecified or otherwise available bit fields can be used to literally tag traffic without the need to re write all of the standard communication stack software with only the portions of the stack that are added to enhance the verifiable traffic control or service control capabilities of the standard stack needing to decode and use the literal tagging information encapsulated in the available bit fields. In the case of literal tagging in some embodiments the tags are removed prior to passing the packets or flows to the network or to the applications utilizing the stack. In some embodiments the manner in which the virtual or literal tagging is implemented can be developed into a communication standard specification so that various device or service product developers can independently develop the communication stack and or service processor hardware and or software in a manner that is compatible with the service controller specifications and the products of other device or service product developers.

It will be appreciated that although the implementation use of any or all of the measurement points illustrated in is not required to have an effective implementation such as was similarly shown with respect to various embodiments described herein various embodiments can benefit from these and or similar measurement points. It will also be appreciated that the exact measurement points can be moved to different locations in the traffic processing stack just as the various embodiments described herein can have the agents affecting policy implementation moved to different points in the traffic processing stack while still maintaining effective operation. In some embodiments one or more measurement points are provided deeper in the modem stack where for example it is more difficult to circumvent and can be more difficult to access for tampering purposes if the modem is designed with the proper software and or hardware security to protect the integrity of the modem stack and measurement point s .

Referring to describing the device communications stack from the bottom to the top of the stack as shown the device communications stack provides a communication layer for each of the modems of the device at the bottom of the device communications stack. Example measurement point VI resides within or just above the modem driver layer. For example the modem driver performs modem bus communications data protocol translations modem control and configuration to interface the networking stack traffic to the modem. As shown measurement point VI is common to all modem drivers and modems and it is advantageous for certain embodiments to differentiate the traffic or service activity taking place through one modem from that of one or more of the other modems. In some embodiments measurement point VI or another measurement point is located over within or below one or more of the individual modem drivers. The respective modem buses for each modem reside between example measurement points V and VI. In the next higher layer a modem selection control layer for multimode device based communication is provided. In some embodiments this layer is controlled by a network decision policy that selects the most desirable network modem for some or all of the data traffic and when the most desirable network is not available the policy reverts to the next most desirable network until a connection is established provided that one of the networks is available. In some embodiments certain network traffic such as verification control redundant or secure traffic is routed to one of the networks even when some or all of the data traffic is routed to another network. This dual routing capability provides for a variety of enhanced security enhanced reliability or enhanced manageability devices services or applications. In the next higher layer a modem firewall is provided. For example the modem firewall provides for traditional firewall functions but unlike traditional firewalls in order to rely on the firewall for verifiable service usage control such as access control and security protection from unwanted networking traffic or applications the various service verification techniques and agents described herein are added to the firewall function to verify compliance with service policy and prevent tampering of the service controls. In some embodiments the modem firewall is implemented farther up the stack possibly in combination with other layers as indicated in other Figures. In some embodiments a dedicated firewall function or layer is provided that is independent of the other processing layers such as the policy implementation layer the packet forwarding layer and or the application layer. In some embodiments the modem firewall is implemented farther down the stack such as within the modem drivers below the modem drivers or in the modem itself. Example measurement point IV resides between the modem firewall layer and an IP queuing and routing layer. As shown an IP queuing and routing layer is separate from the policy implementation layer where the policy implementation agent implements a portion of the traffic control and or service usage control policies. As described herein in some embodiments these functions are separated so that a standard network stack function can be used for IP queuing and routing and the modifications necessary to implement the policy implementation agent functions can be provided in a new layer inserted into the standard stack. In some embodiments the IP queuing and routing layer is combined with the traffic or service usage control layer. For example a combined routing and policy implementation layer embodiment can also be used with the other embodiments such as shown in . Measurement point III resides between the IP queuing and routing layer and a policy implementation agent layer. Measurement point II resides between the policy implementation agent layer and the transport layer including TCP UDP and other IP as shown. The session layer resides above the transport layer which is shown as a socket assignment and session management e.g. basic TCP setup TLS SSL layer. The network services API e.g. HTTP HTTPS FTP File Transfer Protocol SMTP Simple Mail Transfer Protocol POP3 DNS resides above the session layer. Measurement point I resides between the network services API layer and an application layer shown as application service interface agent in the device communications stack of .

As shown in the application service interface layer is above the standard networking stack API and in some embodiments its function is to monitor and in some cases intercept and process the traffic between the applications and the standard networking stack API. In some embodiments the application service interface layer identifies application traffic flows before the application traffic flows are more difficult or practically impossible to identify farther down in the stack. In some embodiments the application service interface layer in this way assists application layer tagging in both the virtual and literal tagging cases. In the case of upstream traffic the application layer tagging is straight forward because the traffic originates at the application layer. In some downstream embodiments where the traffic or service activity classification relies on traffic attributes that are readily obtainable such as source address or URL application socket address IP destination address time of day or any other readily obtained parameter the traffic type can be identified and tagged for processing by the firewall agent or another agent as it initially arrives. In other embodiments as described herein in the downstream case the solution is generally more sophisticated when a traffic parameter that is needed to classify the manner in which the traffic flow is to be controlled or throttled is not readily available at the lower levels of the stack such as association with an aspect of an application type of content something contained within TLS IPSEC or other secure format or other information associated with the traffic. Accordingly in some embodiments the networking stack identifies the traffic flow before it is fully characterized categorized or associated with a service activity and then passes the traffic through to the application interface layer where the final classification is completed. In such embodiments the application interface layer then communicates the traffic flow ID with the proper classification so that after an initial short traffic burst or time period the policy implementation agents can properly control the traffic. In some embodiments there is also a policy for tagging and setting service control policies for traffic that cannot be fully identified with all sources of tagging including application layer tagging.

As shown in a service monitor agent which is also in communication with the agent communication bus communicates with various layers of the device communications stack. For example the service monitor agent performs monitoring at each of measurement points I through VI receiving information including application information service usage and other service related information and assignment information. An access control integrity agent is in communication with the service monitor agent via the agent communications bus as also shown.

Referring to describing the device communications stack from the bottom to the top of the stack as shown the device communications stack provides a communication layer for modem MAC PHY layer at the bottom of the device communications stack. Measurement point IV resides above the modem MAC PHY layer. The modem firewall layer resides between measurement points IV and III. In the next higher layer the policy implementation agent is provided in which the policy implementation agent is implemented on the modem e.g. on modem hardware . Measurement point II resides between the policy implementation agent and the modem driver layer which is then shown below a modem bus layer. The next higher layer is shown as the IP queuing and routing layer followed by the transport layer including TCP UDP and other IP as shown. The session layer resides above the transport layer which is shown as a socket assignment and session management e.g. basic TCP setup TLS SSL layer. The network services API e.g. HTTP HTTPS FTP File Transfer Protocol SMTP Simple Mail Transfer Protocol POP3 DNS resides above the session layer. Measurement point I resides between the network services API layer and an application layer shown as application service interface agent in the device communications stack of .

In some embodiments device includes a 3G and or 4G network access connection in combination with the Wi Fi LAN connection to the device . For example the intermediate device or networking device combination can be a device that simply translates the Wi Fi data to the WWAN access network without implementing any portion of the service processor as shown in . In some embodiments an intermediate device or networking device combination includes a more sophisticated implementation including a networking stack and some embodiments a processor as is the case for example if the intermediate networking device or networking device combination includes a router function in which case the service processor can be implemented in part or entirely on the intermediate modem or networking device combination. The intermediate modem or networking device combination can also be a multi user device in which more than one user is gaining access to the 3G or 4G access network via the Wi Fi LAN connection. In the case of such a multi user network the access network connection can include several managed service links using multiple instantiations of service processor each instantiation for example being implemented in whole or in part on device with the intermediate modem or networking device combination only providing the translation services from the Wi Fi LAN to the WWAN access network.

Referring now to in some embodiments the service processors are implemented in part or in whole on the intermediate modem or networking device combination. In the case where the service processor is implemented in part or in whole on the intermediate modem or networking device combination the service processor can be implemented for each device or each user in the network so that there are multiple managed service provider accounts all gaining access through the same intermediate modem or networking device combination. In some embodiments the functions of service processor are implemented on an aggregate account that includes the WWAN access network traffic for all of the users or devices connected to the Wi Fi LAN serviced by the intermediate modem or networking device combination. In some embodiments the central provider can also provide an aggregated account service plan such as a family plan a corporate user group plan and or an instant hotspot plan. In the case where there is one account for the intermediate modem or networking device combination the intermediate modem or networking device combination can implement a local division of services to one or more devices or users in which the services are controlled or managed by the intermediate modem or networking device combination or the device but the management is not subject to service provider control and is auxiliary to the service management or service policy implementation performed by service processors . In some embodiments another service model can also be supported in which there is an aggregate service provider plan associated with one intermediate modem or networking device combination or a group of intermediate modems or networking device combinations but where each user or device still has its own service plan that is a sub plan under the aggregate plan so that each user or device has independent service policy implementation with a unique instantiation of service processor rather than aggregate service policy implementation across multiple users in the group with a single instantiation of service processor .

As shown in in some embodiments device includes a Wi Fi modem a Wi Fi modem combined with a 3G and or 4G WWAN modem on intermediate modem or networking device combination and the intermediate modem or networking device combination forwards WWAN access network traffic to and from device via the Wi Fi link. For example the service processor can be implemented in its entirety on device and the service provider account can be associated exclusively with one device. Similarly as shown in such an implementation can be provided using a different access modem and access network such as a 2G and or 3G WWAN DSL wire line cable DOCSIS wire line or fiber wire line configuration in place of the 3G and or 4G access network connection to the intermediate modem or networking device combination . In addition various other embodiments similarly use DSL as shown in USB Ethernet Bluetooth or another LAN or point to point connection from device to the intermediate modem or networking device combination or a femto cell modem and DSL cable T1 other combination as shown in .

In some embodiments it may not be possible to accurately identify every network service access attempt or service usage e.g. or traffic access as belonging to a given service usage partition e.g. a given ambient service usage background network chatter usage user service plan usage emergency service usage and or other type of service usage . As used herein the terms service usage partition service usage recording partition service charging bucket and micro CDRs are used interchangeably. Accordingly it is desirable to provide a service charging bucket for traffic that is allowed and not definitively identified as belonging to a known service charging bucket. This allows for techniques to employ an allow but verify approach to traffic that is likely to be legitimately associated with an ambient service or a user service or a network service that is intended to be allowed but is not definitively identified as being associated with an allowed service.

As an example there may be a web site access associated with an ambient service that does not have a reference identifier or other traffic parameter that allows the service processor to associate it with the correct ambient service. In this case a set of rules can be applied to determine if it is likely that the web site access is a legitimate access given the access control policies that are in place and if it is the access can be allowed and the traffic usage either recorded in the ambient service charging bucket that it is suspected to be associated with or the traffic usage can be charged to a network chatter service usage bucket or the traffic usage can be charged to the user service usage bucket or the traffic usage may be recorded in a not classified but allowed service charging bucket. In some embodiments in which such traffic is charged to the not classified but allowed service usage charging bucket additional verification measures are employed to ensure that the amount of traffic that is not classified but allowed does not grow too large or become a back door for service usage errors. For example the access control policy rules for allowing unclassified traffic can be relatively loose as long as the amount of service usage charges accumulating in the not classified charging bucket remains within certain bounds and or the rate of service usage charged to the not classified bucket remains within certain bounds but if the not classified traffic becomes large or the rate of not classified traffic growth becomes large then the rules governing when to allow not classified traffic can be tightened.

As another example a browser application can access a web site that is known to be an ambient service website and that web site might serve back a series of traffic flows some of which are associated with the ambient service website through URL identifiers that are known to be part of the website and other traffic can be associated with the ambient service website by virtue of a referring website tag or header and some traffic can be returned to the same application with a relatively close time proximity to the other traffic as being identified as ambient traffic. In this example as long as the not classified traffic service charging bucket does not exceed a given pre set policy limit on its size and or does not grow faster than a given pre set policy rate and or is received within a certain pre set policy period of time difference from the time that other ambient service charging bucket traffic is received then the not classified traffic is continued to be allowed. However if the not classified traffic amount or rate of growth exceeds the pre set policy limits or if the period of time between when verified ambient service traffic is received and the not classified traffic is received exceeds policy limits then the not classified traffic can be blocked or other action can be taken to further analyze the not classified traffic.

In some embodiments it is important to provide a hierarchy of service usage charging rules for the various service usage partitions on a device. As an example for a given service plan there can be two ambient service charging buckets a network chatter e.g. or network overhead service charging bucket and a user service plan service charging bucket and it is desirable to make sure that no ambient services or network overhead service or unclassified service is charged to the user service plan and it is also desirable to ensure that all known ambient service traffic is charged to the appropriate ambient service partner and it is desirable to ensure that no network overhead service or unclassified service is charged to ambient service partners. In such situations a service charging bucket hierarchy can be provided as follows determine if a traffic flow e.g. or socket is associated with network overhead and if so allow it and charge that service bucket then determine if a traffic flow or socket is associated with ambient service and if so allow it and charge that service bucket then determine if a traffic flow or socket is associated with ambient service and if so allow it and charge that service bucket then determine if a traffic flow or socket is associated with not classified traffic and if so allow it and charge that service bucket then if the traffic is not associated with any of the above service charging buckets allow it and charge it to the user service plan charging bucket. In another example if the user has not yet chosen to pay for a user service plan then the same hierarchical access control and service charging policy can be used except the final step would be then if the traffic is not associated with any of the above service charging buckets block the traffic. Hierarchical service charging bucket identification such as depicted in these examples can be a crucial aspect of a robust access control policy and or service charging policy system. Many other access control policy hierarchies and service charging bucket policy hierarchies will now be apparent to one of ordinary skill in the art.

In some embodiments the not classified traffic is charged according to service charging rules that rely on the most likely candidate service charging bucket for the traffic. As another example if the not classified traffic is being delivered to the same application as other known ambient service traffic and the time difference between delivery of the known ambient service traffic and the not classified traffic is small then the not classified traffic can be charged to the ambient service in accordance with a pre set charging policy rule specifying these conditions. Other embodiments that will now be apparent to one of ordinary skill in the art. For example another charging rule for not classified traffic could be to perform a pro rata allocation of the not classified traffic to all of the other service charging buckets with the pro rata allocation being based on the percentage of the total traffic used by the device for each service charging bucket. As another example the not classified traffic can be charged to a subset of the service charging buckets for the device e.g. all ambient services plus the network overhead service in accordance with the pro rata share for each service included in the pro rata split.

In some embodiments the user service plan agreement is structured so that the user acknowledges that ambient services in which the access connection to the service is sponsored paid for and or partially subsidized by an entity other than the user are a benefit to the user and or the user acknowledges that there is no inherent right to free ambient services and that the service usage accounting system may not always properly characterize usage for a sponsored or subsidized ambient service e.g. or some other specialized service in the correct accounting service charging bucket and thus the user service plan account can be charged and or billed with some of this traffic. By having the user acknowledge a service use agreement of this form then some ambient traffic can be charged to the user service plan account including for example allowed but not classified traffic excess ambient service usage beyond pre set policy limits ambient service usage during busy network periods or on congested network resources and or other criteria measures. In some embodiments the user might be notified that they are being charged for service activities that are sometimes subsidized or free to the user. As discussed above it is important to ensure that a not classified service charging bucket does not become a back door for service charging errors or hacking. It will now be apparent to one of ordinary skill in the art that the not classified service usage charges can be verified in a variety of manners including for example observing the size of the not classified service charging bucket as compared to other service usage charges on the device e.g. total device service usage ambient service usage user bucket service usage and or other criteria measures capping the not classified bucket and or capping the rate of growth of the not classified bucket.

In some embodiments it is important to verify not only that the total device service usage amount is correct but that the service usage is being reported in the proper service charging buckets. For example if the service processor software can be hacked so that it correctly reports the total service usage but reports user service plan traffic under one or more ambient service buckets then simply verifying that the total amount of service usage is correct will not be sufficient to prevent the device from obtaining free user service that can be charged to ambient service partners. There are a variety of direct and indirect embodiments to accomplish this verification of service charging bucket divisions. For example in direct verification embodiments one or more alternative measures of service usage are employed to cross check the accuracy of the service charging bucket divisions. In indirect embodiments one of two classes of verification are employed the size and rate of growth for service charging buckets is analyzed and compared to a pre set group of policies to detect and or modify service charging bucket growth that is out of policy and or the proper operation of the service processor elements involved in service charging bucket partitioning is verified.

Various embodiments involving direct verification of service charging bucket usage and or accounting include the use of network based service usage measures such as CDRs IPDRs flow data records e.g. FDRs detailed reports of service usage for each service flow such as network socket connection opened and used to transmit data to or from the device accounting records interim accounting records or other similar usage records to verify that the device is within service policy and or the device based service usage reports are accurate. Use of such network generated service usage records to directly verify service charging and or proper service usage policy adherence are described herein. When network address destination and or source information is available in these records as described herein this can be used in some embodiments to verify the service charging bucket accounting provided by the device service processor. In some embodiments some types of service usage records include real time data but not necessarily all of the useful information needed to help verify service charging bucket accounting while other types of service usage records provide more detail e.g. IP address for destination and source but do not always arrive in real time. For example in some embodiments FDRs are created each time a new service flow e.g. network socket connection is opened and then closed. At the time the service flow is closed a e.g. possibly time stamped data usage record indicating source address destination address and amount of data transmitted is created and sent to a charging aggregation function in the network. The charging aggregation function can then forward the FDRs to the service controller for verification or direct accounting of service charging bucket accounting. By comparing the FDR addresses with known ambient service traffic address associations the partitioning of service charging buckets between one or more ambient services and other services such as a user service plan service charging bucket may be verified. However in some cases it can be a long period of time for an FDR to be generated when a device service flow e.g. socket remains open for a long period of time as in the case for example with a long file download a peer to peer connection with a socket keep alive or a proxy server service with a socket keep alive. In such cases it can be disadvantageous to have large amounts of data to be transferred without an FDR to confirm device service processor based reports and in some cases this can provide an opportunity for service processor service reporting hacks. This can be remedied in a variety of ways by using other network reported service usage information to augment the FDR information. For example start and stop accounting records can sometimes be obtained in some embodiments from a network element such as a service gateway or the AAA servers e.g. or other network equipment elements depending on the network architecture . Although start and stop records do not possess the detail of service usage information that FDRs CDRs IPDRs interim accounting records or other service usage records posses they do inform the service controller that a device is either connected to the network or has stopped connecting. If a device is connected to the network and is not transmitting device usage reports or heartbeats then the service controller is alerted that an error or hacking condition is likely. As another example of how two or more types of network reported service usage information may be used to create a better real time or near real time check on device service usage if both FDRs and start stop accounting records are available the service controller can send a stop then resume service command to the device e.g. or alternatively send a stop then resume service command to a network equipment element which will cause the device to terminate all open service flows before re initiating them and once the service flows are stopped then the FDR flow records will be completed and transmitted for any service flows that were in process but unreported when the stop service command was issued. This will cause any long term open socket file transfers to be reported in the FDR flow records thus plugging the potential back door hole in the FDR service usage accounting verification method.

As another example showing how multiple types of network generated service usage accounting records may be used to complement each other and strengthen the verification of service charging bucket accounting partitions interim data records can be used with FDRs. Interim data records are available in accordance with some embodiments n which the interim data records are generated on a regularly scheduled basis by a network element e.g. gateway base station HLR AAA and or other network element function . Interim data records are typically near real time records that report the aggregate traffic usage for the device as of a point in time but often do not include traffic address information or other traffic details. In embodiments in which both interim accounting records and FDRs are available when the interim accounting records are indicating service usage that is not being reported in the FDR stream this is evidence that a device has one or more long term socket connections that are open and are not terminating. In this case the service controller can verify that the device based usage reports are properly accounting for the total amount of service usage reported by the interim accounting records and or the service controller can force an FDR report for the open sockets by issuing a stop resume service command as similarly discussed above.

As described herein other embodiments involving direct verification of service charging bucket accounting can be provided. One example is to route ambient service traffic to a proxy server or router programmed to support only the network access allowed for the ambient service and to account for the ambient service usage. Additional proxy servers or routers can be similarly programmed for each ambient service that is part of the device service plan and in some embodiments another proxy server or router is programmed to support traffic control and account for the user service plan service access. By comparing the service usage accounting for each of these proxy servers or routers the device generated service charging bucket accounting can be directly verified. In some embodiments the usage accounting provided by the proxy servers or routers is used directly for service usage accounting.

In some embodiments ambient service partner feedback is used to verify service charging bucket accounting. For example web servers used by ambient service partners to provide ambient services can identify a user device based on header information embedded in the HTML traffic and then account for either the service used by the device during the ambient service sessions or account for the number of transactions the user completes. If service usage is recorded then it can be reported to the service controller and be used directly to verify ambient service charging bucket accounting. If transactions are all that are recorded then this can be reported to the service controller and the amount of ambient service used by the device can be compared with the number of transactions completed to determine if the ambient service usage is reasonable or should be throttled or blocked. It will now be apparent to one of ordinary skill in the art that other embodiments can be provided that employ more than one type of network generated service usage records to verify service usage accounting and or verify service charging bucket accounting.

Other embodiments involving indirect methods for verifying or controlling service charging bucket accounting include monitoring the size and or growth rate of ambient service usage. In some embodiments the access control policy rules call for restricting a given ambient service access when the amount of service usage charges accumulating in the ambient service charging bucket exceed a pre set policy limit and or when the rate of service usage for the ambient service exceeds a pre set policy limit. For example once these limits are reached the ambient service can be throttled back for a period of time blocked for a period of time or charged to the user service plan charging bucket. In some embodiments before these actions are taken the user UI can be used to notify the user of the service policy enforcement action. In some embodiments indirect verification of service charging bucket accounting includes the various techniques described herein for verifying proper operation of the service processor agent software and or protecting the service processor agent software from errors manipulation or hacking.

In some embodiments the device service processor directs traffic destined for a given ambient service to a proxy server or router programmed to support that ambient service and any traffic control policies and or access control policies for the ambient service are implemented in the proxy server or router. For example in such embodiments the proxy server or router can be programmed to only allow access to one or more ambient services that are authorized by the device service plan with the proxy server or router controlling device access so that other network destinations cannot be reached. Continuing this example embodiment the proxy server or router can account for the ambient service usage in an ambient service charging bucket as discussed elsewhere. In such proxy server or router ambient service control embodiments the same traffic association techniques described elsewhere that allow incoming traffic associated with an ambient service website or other service to be identified allowed or blocked potentially throttled and accounted for in a service charging bucket can be implemented in the proxy server or router programming. Such proxy server or router embodiments can also implement user service plan service charging buckets user service plan traffic controls and user service plan access control as discussed herein. In some embodiments the proxy server or router analyzes the HTML traffic content of the traffic flows as described herein to perform such associations traffic control and or service usage accounting. Similarly in some embodiments a proxy server or router can provide the surf out capabilities described herein by performing the same surf out traffic associations e.g. HTML branch reference associations and or other branch associations described herein. It will now be apparent to one of ordinary skill in the art that many of the adaptive ambient service control and service usage charging functions described herein for a service processor can be readily implemented with a proxy server or router that is appropriately programmed.

In some embodiments routing of device traffic for one or more ambient services and or user service plan services to a proxy server or router is accomplished by the device service processor using the device service processor traffic control embodiments described herein. In some embodiments routing of device traffic for one or more ambient services and or user service plan services to a proxy server or router is accomplished by dedicated network equipment such as the gateways e.g. SGSN GGSN PDSN or PDN home agents HLRs or base stations with the network equipment being provisioned by a service controller e.g. or other interchangeable network element with similar functions for this purpose to direct the device traffic to the proxy server or router. In some embodiments the ambient service traffic or the user service plan traffic is controlled by the proxy server according to a service plan policy set supplied by the service controller e.g. or equivalent network function for this purpose . The traffic control service policy thus implemented by the proxy server can control traffic based on one or more of the following period of time network address service type content type application type QoS class time of day network busy state bandwidth and data usage.

In some embodiments a proxy server or router is used to verify accounting for a given service for example an ambient service. In some embodiments this is accomplished by the device service processor directing the desired service flows to a proxy server or router programmed to handle the desired service flows with the proxy server or router being programmed to only allow access to valid network destinations allowed by the access control policies for the desired service and the proxy server or router also being programmed to account for the traffic usage for the desired services. In some embodiments the proxy service usage accounting may then be used to verify device based service usage accounting reported by the service processor. In some embodiments the accounting thus reported by the proxy server or router can be used directly to account for service usage such as ambient service usage or user service plan service usage.

In some embodiments in which a proxy server is used for device service usage accounting the proxy server maintains a link to the device service notification UI via a secure communication link such as the heartbeat device link described herein. For example the proxy server or router can keep track of device service usage versus service plan usage caps limits and notify the user device UI through the device communication link e.g. heartbeat link between the service controller and the device. In some embodiments the proxy server router communicates with a device UI in a variety of ways such as follows UI connection through a device link e.g. heartbeat link through a device link connected to a service controller e.g. or other network element with similar function for this purpose presenting a proxy web page to the device providing a pop up page to the device and or installing a special portal mini browser on the device that communicates with the proxy server router. In some embodiments the UI connection to the proxy server router is used as a user notification channel to communicate usage notification information service plan choices or any of the multiple services UI embodiments described herein.

In some embodiments for the proxy server router techniques for implementing service traffic access controls and or service charting bucket accounting it is desirable to have the same information that is available to the service processor on the device including for example application associated with the traffic network busy state QoS level or other information about the service activity that is available at the device. For example such information can be used to help determine traffic control rules and or special services credit is due e.g. ambient services credit . In some embodiments information available on the device can be communicated to the proxy server router and associated with traffic flows or service usage activities in a variety of ways. For example side information can be transmitted to the proxy server router that associates a traffic flow or service activity flow with information available on the device but not readily available in the traffic flow or service activity flow itself. In some embodiments such side information may be communicated over a dedicated control channel e.g. the device control link or heartbeat link or in a standard network connection that in some embodiments can be secure e.g. TLS SSL or a secure tunnel . In some embodiments the side information available on the device can be communicated to the proxy server router via embedded information in data e.g. header and or stuffing special fields in the communications packets . In some embodiments the side information available on the device can be communicated to the proxy server router by associating a given secure link or tunnel with the side information. In some embodiments the side information is collected in a device agent or device API agent that monitors traffic flows collects the side information for those traffic flows and transmits the information associated with a given flow to a proxy server router. It will now be apparent to one of ordinary skill in the art that other techniques can be used to communicate side information available on the device to a proxy server router.

For example just as the hierarchy of charging rules can be important for implementations in which the service processor is creating the service charging bucket accounting it can also important in implementations that use a proxy server or router for service charging bucket accounting. Accordingly various embodiments described herein for creating a hierarchy of service usage charging rules can be applied to proxy server or proxy router embodiments. It will be apparent to one of ordinary skill in the art that the service charging bucket embodiments and traffic control and access control embodiments described herein for allowed but not classified buckets apply equally to the proxy server router embodiments. For example pre defined service policy rules can be programmed into the proxy server router to control the traffic flows and or place usage limits or access limits on an ambient service or a user service plan service. It will also now be apparent to one of ordinary skill in the art that the embodiments described herein disclosing an initial allowed service access list temporarily allowing additional service activities until they are determined to be allowed or not allowed expanding the allowed service activity list maintaining a not allowed service activity list and expanding the not allowed service activity list also apply equally to proxy server router embodiments. Similarly it will now be apparent to one of ordinary skill in the art that the proxy server router embodiments can be employed to directly generate the service charging bucket or micro CDR usage reports used to provide further detail and or billing capabilities for service usage. In some embodiments in which the device service processor directs traffic to a proxy server router there are advantageous design feature embodiments available that can reduce the need to provision network to detect and force specialized device service traffic to the appropriate proxy server router. For example this can be done by creating a usage credit system for the services supported by the proxy server outer. Total service usage is counted on the one hand by the device service processor or by other network equipment or by both. Credit on the other hand for ambient service or other specialized access service usage that is not charged to the user is then provided for services that the device directs through the proxy server router destination e.g. URL or route hop supporting the particular ambient service or other specialized access service. If the device correctly directs traffic to the proxy server router then the counting and or access rules are correctly implemented by the proxy server router. The service can be thus controlled and or accounted for. When the service is accounted for the proxy server router reports the service charging bucket accounting back to the service controller e.g. or other network equipment responsible for service charging bucket micro CDR mediation and the user service plan service charging bucket account can be credited for the services. Traffic that reaches the proxy server router is controlled by the access rules and or traffic control rules and or QoS control rules of the proxy server router programming so there is no question regarding the type of service that is supported with the service charging buckets that are reported to mediation functions e.g. mediation functions can be performed by one or more of service controller usage mediation billing AAA and or HLR home agent . As the proxy server router is in the network and can be physically secured and protected from hacking there is high confidence that the service control and or charging rules intended for ambient services or some other specialized service are properly implemented and that the proxy server router connection is being used for the intended service and not some other unintended hacked service. If the device is somehow hacked or otherwise in error so that the traffic is not directed through the appropriate proxy server router then the proxy server router does not log the traffic in micro CDRs buckets and no specialized service usage credit is sent to the mediation functions so there is no usage credit deducted from the device user service plan service usage totals. Thus the user pays for the services when the device is hacked to avoid the proxy server router. The user account service agreement can specify that if the user tampers with software and traffic is not routed to servers then credit will not be provided and user plan will be charged.

In some proxy server router embodiments the usage credit is sometimes recorded by the proxy server router detecting which device is performing the access. Device identification can be accomplished in a variety of ways including a header tag inserted into the traffic by the device a route in the network specified for that device a secure link e.g. TLS SSL IP Sec or other secure tunnel a unique device IP address or other credential e.g. where proxy server router has access to an active IP address look up function a unique proxy server router address and or socket for the device.

In some embodiments the coordination of the device service controller traffic control elements with a proxy server outer can make it simpler to locate install provision and operate the proxy servers. The proxy server routers do not need to be located in line with the access network because it is the device s responsibility to make sure the traffic is routed to the servers routers or else there is not credit and the user account is charged. In some embodiments this makes it unnecessary or reduces the need to force device traffic routes in carrier network. In some embodiments the proxy server routers can be located in carrier network or on the Internet. If the proxy server routers are on Internet then traffic can be authenticated in a firewall before being passed to server routers to enhance security to attack.

In some embodiments the service charging bucket recording software in the proxy server router can be programmed into an ambient service partners network equipment directly thus eliminating the need for special apparatus. The ambient service partner s equipment e.g. a web server load balancer or router can recognize the device using one of the techniques described above aggregate the device service charging bucket accounting and periodically send the usage accounting to the service controller or other network service usage mediation function.

Programming and or provisioning the types of ambient services user service plan services and or specialized services disclosed in various embodiments described herein can be a complex process. In some embodiments a simplified user programming interface also referred to herein as a service design interface is used to program the necessary policy settings for such services is desirable. For example a service design interface is provided that organizes and or categorizes the various policy settings that are required to set up an ambient service e.g. or other service including one or more of the following a policy list of service activities that are allowed under the ambient service e.g. or other service access control policies rules for implementing and or adapting an allowed list of network destinations rules for implementing and or adapting a blocked list of network destinations service charging bucket policies user notification policies service control and or service charging bucket verification policies actions to be taken upon verification errors. In some embodiments the required information for one or more of these policy sets is formatted into a UI that organizes and simplifies the programming of the policies. In some embodiments the UI is partly graphical to help the user understand the information and what settings need to be defined in order to define the service. In some embodiments the UI is created with an XML interface. In some embodiments the UI is offered via a secure web connection. In some embodiments a basic service policy for an ambient service e.g. or another service is created that includes one or more of the above service policy settings and then this service policy set becomes a list or an object that can be replicated and used in multiple service plan policy set definitions e.g. dragged and dropped in a graphical UI . In some embodiments the resulting set of policies created in this service design interface are then distributed to the necessary policy control elements in the network and or on the device that act in coordination to implement the service policy set for a given device group. For example if a service processor is used in conjunction with a service controller then the service design interface can load the service policy settings subsets that need to be programmed on the service controller and the device service processor into the service controller and the service controller loads the service controller policy settings subset into the service controller components that control the policies and loads the device policy settings subset to the devices that belong to that device group. In embodiments in which a proxy server router is used to help control and account for services in some embodiments the service design interface loads the service policy settings subsets that need to be programmed on the proxy server router into the proxy server router. In embodiments where other network equipment e.g. gateways base stations service usage recording aggregation feed equipment AAA home agent HLR mediation system and or billing system need to be provisioned or programmed in some embodiments the service design interface also loads the appropriate device group policy subsets to each of the equipment elements. Accordingly various techniques can be used as described herein to greatly simplify the complex task of translating a service policy set or service plan into all the myriad equipment and or device settings programming and or provisioning commands required to correctly implement the service. It will now be apparent to one of ordinary skill in the art that several of these techniques can similarly be used for the VSP service design interface.

Those of ordinary skill in the art will appreciate that various other rules can be provided for the rules engine as described herein. Those of ordinary skill in the art will also appreciate that the functions described herein can be implemented using various other network architectures and network implementations e.g. using various other networking protocols and corresponding network equipment and techniques .

In device assisted service DAS systems end user device agents can assist the network in policy implementation or enforcement. For example device agents can assist the network in recordkeeping to allocate costs when end user devices access data services over an access network enforcing access control or service limit policies for the device enforcing usage limits or assisting in notification policies for information regarding network access services that are in communication with the device end user. If a device is configured with a device agent configured to assist the network in policy implementation or enforcement there may be a device portion of a network policy that is enforced on the device and a network portion of an access network service policy that is enforced by network elements in the network. In some access networks network based systems are employed to implement the network portion of the access network service policy such as for example to manage the authentication process of allowing a device onto a network or to determine one or more network policies that should be enforced by the network elements such as access control policy service usage limits service usage accounting or billing policy or service usage notification policy.

To achieve an overall network service policy the network portion of the access network service policy may be configured to work in conjunction with the device based portion of the access network service policy to achieve an overall combined network service policy. If the device agents required to implement the device portion of the access network service policy are not present on the device or are not properly configured then the overall combined network service policy can be in error or may not be possible to achieve potentially resulting in an undesired network service policy implementation. In such cases it is desirable for a network system to be employed to detect this condition and modify the network portion of an access network service policy enforced by the network based elements so that a desired network service policy enforcement may be achieved.

In some embodiments a device agent that can assist the network in policy implementation or enforcement may be termed a device policy implementation agent which in some embodiments may be part of the service processor.

Examples of when it may be advantageous to adapt the network portion of an access network service policy in order to account for a missing or improperly configured service processor include but are not limited to i a device credential has been moved to a device that does not have a service processor ii a device credential has been moved to a device with a service processor with a different configuration than the service processor originally associated with the device credential iii a device service processor has been tampered with or has an improper configuration.

In some embodiments the service processor is used to assist in classifying service usage into sub categories for the purpose of usage accounting policy enforcement access control policy enforcement service usage limits or notification policy enforcement that differs according to the category. In some embodiments the classification can be for one or more device applications. In some embodiments the classification can be for one or more network destinations. In some embodiments the classification can be for one or more network types. In some embodiments a classification of service usage herein referred to as a sponsored service or an ambient service can be performed to facilitate allocating access network costs in whole or in part associated with the sponsored or ambient service to a service sponsor the service sponsor being an entity other than the device user.

What is needed is a network system that detects the presence and proper configuration of a service processor or lack thereof in the end user device wherein the service processor if present enforces a device portion of an access network service policy on a device configured with a device credential and if the service processor is present and properly configured that causes a first network portion of an access network service policy to be enforced in the network the first network portion of an access network service policy being configured to provide counterpart policy enforcement to a device portion of an access network service policy to achieve a first desired overall access network service policy and if the service processor is not present and properly configured that causes a second network portion of an access network service policy to be enforced in the network that is configured to operate without a device counterpart policy to achieve a second desired overall access network service policy.

In some embodiments a network system is used to detect when unscrupulous users attempt to acquire free data services by tampering with a service processor in order to use one service and have the service usage accounting allocated to a second service that is sponsored. For example if a device sends reports of its data usage to the network a user might attempt to hack the device so that its reports contain information that is more favorable to the user than it should be e.g. by reporting less data usage than the device actually used. As another example a device may contain a sponsored SIM card or another credential that allows the device to use a fixed amount of data possibly associated with a particular service at a reduced charge or at no charge to the user. Unscrupulous users may attempt to find ways to increase their quantity of free or subsidized data usage with sponsored SIM cards.

Bandwidth limitations in the wireless access network are making unlimited data plans less attractive to service providers. At the same time users of end user devices want to have more control over their devices data usage to control costs. The ability to track a device s data usage with high accuracy on a more granular level than simply by measuring aggregate data usage is an important enabler new service offerings that meet both of these needs. For example accurate tracking of a device s data usage on a service by service or application by application basis or on even finer levels will allow service providers to offer a la carte service plans that allow users to choose customized application or service specific data plans.

Therefore there is a need for security measures to prevent policy errors caused by changing device credentials improper configuration of a service processor or fraud in DAS systems. In particular there is a need for tools that allow the network to detect fraudulent end user device activity.

Disclosed herein are various embodiments to prevent detect or take action in response to moving a device credential from one device to another improper configuration of a service processor a missing service processor or tampering with a service processor in device assisted services DAS systems.

In some embodiments the service controller in the network authenticates the service processor and checks that it is reporting the end user device s usage in the expected manner e.g. at expected times including expected information with expected indicia of authenticity etc.

In some embodiments when the end user device reports usage the service controller checks whether the reports sent by the service processor are consistent with reports from a trusted source such as a network element.

In some embodiments when the service controller detects fraudulent or potentially fraudulent activities the service controller notifies a network administrator or network resource which can then further evaluate the situation and decide how to respond. In some embodiments the subscriber s billing rate is increased.

In some embodiments a device client configured to implement a device portion of a network access service policy e.g. an access control policy or traffic control policy a device software or operating environment security policy a service usage limit a service accounting or charging policy a service notification policy or another policy may be termed a device policy implementation client which in some embodiments may be part of the service processor. Also without loss of generality the term service controller may be used to refer to a service processor authentication and management system. Both the service processor and service controller may have functions in addition to those described herein.

In some embodiments a device is configured with a properly configured service processor responsible for implementing or enforcing a device portion of a first access network service policy. In some embodiments the device is configured without a properly configured service processor. In some embodiments a service controller can be configured to determine whether the service processor is present on the device and if so whether it is properly configured.

In some embodiments if the service controller determines that the device is configured with a properly configured service processor the service controller causes a network based access network service policy enforcement system to implement or enforce a first network based portion of the first access network service policy. In this case because the service controller has verified that a properly configured service processor is present on the device the service controller system operates under the premise that the device is properly implementing or enforcing the device portion of the first access network service policy. If however the service controller determines that a properly configured device service processor is not present on the device the service controller causes a network based access network service policy enforcement system to implement or enforce a second network based portion of the first access network service policy. In this case the service controller system operates under the premise that the device is not properly implementing or enforcing a device portion of an access network service policy.

In some embodiments an end user device is configured with 1 a wireless modem to connect to a wireless access network or another network access modem to connect to another type of access network 2 one or more device credential sources e.g. a SIM card a soft SIM a universal SIM an IMSI source a wireless modem a phone number source an IMEI source an MEID source a user password or PIN a MAC address source an IP address source a secure device identifier source a device secure communication encryption key source etc. that store a device credential and provide the device credential to one or more network service policy enforcement elements e.g. AAA HLR PCRF access network authentication system admission system or log in system for the purpose of seeking or gaining admission to the wireless access network or other access network and 3 a service processor e.g. a device client configured to implement or enforce a device based portion of a wireless access network service policy and communicate with a network based service controller in order to provide service processor authentication information configured to allow verification that the service processor is present and properly configured on the device.

In some embodiments a network based system is configured with 1 one or more network based device authentication or admission elements e.g. AAA HLR PCRF access network authentication system admission system log in system etc. configured to receive a device credential from an end user device that is attempting to receive or is receiving access network services 2 one or more service policy enforcement elements e.g. a network gateway router GGSN SGSN proxy charging element notification trigger element etc. configured to implement an access network service policy that is associated with the device credential 3 a service processor authentication and management system e.g. a service controller configured to receive service processor authentication information and use the information to verify that the service processor is present and properly configured on the device. In some embodiments the service processor authentication and management system is further configured to a in the event that the service processor is present and properly configured on the device cause the access network service policy that is associated with the device credential to be executed as a first network portion of an access network service or b in the event that the service processor is not present on the device and properly configured cause the access network service policy that is associated with the device credential to be executed as a second network portion of an access network service.

Without loss of generality in the following related embodiments the terms SIM card and SIM are used to represent a device credential source. As would be appreciated by one of ordinary skill in the art other device credential sources e.g. a soft SIM a universal SIM an IMSI source a wireless modem a phone number source an IMEI source an MEID source a MAC address source an IP address source a secure device identifier source a device secure communication encryption key source etc. can be interchanged with SIM card in many of the embodiments. For example in embodiments in which a SIM card is moved from one device to another another type of device credential could be moved instead e.g. soft SIM universal SIM an IMSI source a wireless modem a phone number source an IMEI source an MEID source a MAC address source an IP address source a secure device identifier source a device secure communication encryption key source etc. . As another example when a user tampers with a service processor associated with a SIM the user could be tampering with a service processor associated with another type of device credential e.g. soft SIM universal SIM an IMSI source a wireless modem a phone number source an IMEI source an MEID source a MAC address source an IP address source a secure device identifier source a device secure communication encryption key source etc. . There are many other example embodiments where the term SIM can be exchanged for another source of device credentials with the embodiments being too numerous to list and yet evident to one of ordinary skill in the art in the context of the teachings herein.

In some embodiments the one or more device credential sources include a SIM card. In some embodiments the service controller can be configured to recognize which device or service processor the SIM is associated with use the SIM and device association to look up a desired device portion of a wireless access network service policy and communicate the policy to the appropriate device service processor. In some embodiments the two different device portions of a wireless access network policy are determined according to a device group or user group service policy definition that includes one or more SIM credentials and or one or more service processor credentials and these policy definitions are entered in a virtual service provider work station that manages the service controller and or device service processor policies.

In some embodiments the service controller is configured to recognize when the SIM card from a first device with a first service processor has been moved to a second device with a second service processor. In some such embodiments the service controller can be configured to recognize which device or service processor the SIM is associated with use the SIM and device association to look up a desired network portion of a wireless access network service policy and cause the network portion of a wireless access network service policy to be implemented or enforced in one or more network service policy enforcement elements. In some embodiments the two different network portions of a wireless access network policy are determined according to a device group or user group service policy definition that includes one or more SIM credentials and or one or more service processor credentials and these policy definitions are entered in a virtual service provider work station that manages the service controller and or network service policy enforcement element policies.

In some embodiments the one or more device credential sources include a SIM card. In some embodiments the service controller is configured to detect when a device user has moved the SIM card from a first device configured with a properly configured service processor to a second device that is not configured with a properly configured service processor. In some embodiments the service controller can be configured to determine that the first device is configured with a properly configured service processor and communicate a device portion of a wireless access network service policy to the appropriate device service processor. In some embodiments the device portion of a wireless access network policy is determined according to a device group or user group service policy definition that includes a SIM credential and or a service processor credential and these policy definitions are entered in a virtual service provider work station that manages the service controller and or device service processor policies. In some embodiments the service controller is configured to determine that the first device is configured with a properly configured service processor and cause a first network portion of a wireless access network service policy to be implemented or enforced in one or more network service policy enforcement elements. In some embodiments the service controller is configured to determine that the second device is not configured with a properly configured service processor and cause a second network portion of a wireless access network service policy to be implemented or enforced in one or more network service policy enforcement elements. In some embodiments the device portion of a wireless access network policy is determined according to a device group or user group service policy definition that includes a SIM credential and these policy definitions are entered in a virtual service provider work station that manages the service controller and or network service policy enforcement element policies.

In some of these embodiments the differences between the first network portion of a wireless access network service policy and the second network portion of a wireless access network service policy can include a difference in network access privileges a difference in allowable network destinations a difference in service usage accounting or billing for bulk access a difference in service usage accounting or billing for a classification of access a difference in service usage accounting rates or billing rates for bulk access a difference in service usage accounting rates or billing rates for a classification of access a difference in sponsored ambient service accounting or billing a difference in service speed or quality a difference in which networks the device or user has access to a difference in the service usage notification that is provided to the end user a difference in roaming service policies or permissions or accounting billing rates a quarantining of the device or user access capabilities differences between e.g. disabling or otherwise modifying one or more features of device operation or suspending the device from access to the network.

In some embodiments a SIM and a service processor are associated with a classification of service usage and a corresponding device portion of access network service policy enforcement. The service controller is then responsible for properly authenticating the proper configuration of the service processor in association with the SIM in order to determine the appropriate network portion of network access service policy that should be enforced.

In some embodiments a SIM and a service processor are associated with one or more application specific services wherein the device network access service has policy elements that are specific to a device software or firmware application. A software or firmware application specific service can include but is not limited to a service with specific policy elements associated with a user application program an operating system program library or function a background application service such as an application update content caching software update or other background application service.

In some embodiments a SIM and a service processor are associated with one or more network destination specific services wherein the device network access service has policy elements that are specific to a network destination or resource. A network destination or resource can include but is not limited to a server gateway destination address domain website or URL.

In some embodiments a SIM and a service processor are associated with any combination of a device application network destination or resource a type of network a roaming condition e.g. a home or roaming network a time period a level of network congestion a level of network quality of service QoS and a background or foreground communication.

In some embodiments a SIM and a service processor are associated with one or more sponsored services also referred to herein as ambient services wherein a portion or all of the service usage accounting for one or more classifications of service usage are accounted to charged to or billed to a service sponsor rather than the device user or party who pays for the user service plan. The portion of service that is sponsored can be all of the device access or a portion or classification of the device access. In some embodiments the classification of the sponsored portion of service e.g. the identification of the portion of the device s use of the access network that should be allocated to the service sponsor is accomplished on the device with a service processor. In some embodiments the classification of the sponsored portion of service is accomplished in the network using DPI elements gateway elements server elements proxy elements website elements or web service elements. In some embodiments the classification of the sponsored portion of service is accomplished with a classification policy implemented by a combination of a service processor on the device e.g. steering a classification of service to a given network element via a re direction re route or tunnel e.g. secure SSL VPN APN or other tunnel protocol and one or more network elements e.g. DPI elements gateway elements server elements proxy elements website elements or web service elements . In some embodiments the portion of service that is sponsored includes service for one device application or a group of device applications. In some embodiments the portion of service that is sponsored includes service for a network destination or resource a server or website or a group of network destinations servers or websites. In some embodiments the portion of service that is sponsored includes service on a specific type of network. In some embodiments the portion of service that is sponsored includes service on a home network or a roaming network. In some embodiments the portion of service that is sponsored includes service during a time period. In some embodiments the portion of service that is sponsored includes service for a certain range of network congestion. In some embodiments the portion of service that is sponsored can include service for a certain range of network QoS. In some embodiments the portion of service that is sponsored includes service for a network background or foreground data communication. In some embodiments the portion of service that is sponsored includes any combination of device application network destination or resource a type of network a roaming condition e.g. home or roaming network a time period a level of network congestion a level of network QoS and a background or foreground communication.

In some embodiments a SIM or other source of user credential or device credential as explained previously is installed in or present in association with a device configured with a device service processor configuration that provides access network policy enforcement. In such embodiments one or more network elements can implement or enforce a network based portion of access network policy enforcement and the device service processor can be configured to implement or enforce a device based portion of access network policy enforcement. In some embodiments one or more SIM credentials can be used at least in part to identify the network based portion of access network policy. In some embodiments one or more SIM credentials can be used at least in part to identify the device based portion of access network policy.

In some embodiments that include a SIM module policy association the policy enforcement includes one or more of access control policy enforcement service usage limit access accounting policy enforcement and access service user notification policy enforcement. In some embodiments the access control policy enforcement includes one or more of allowing limiting blocking deferring delaying or traffic shaping device network access for bulk access e.g. not classified access or one or more specific classifications of access network service activities. In some embodiments the access accounting policy enforcement includes one or more of counting an amount of bulk e.g. unclassified access network service usage or counting an amount of access network service usage for one or more specific classifications of access network service activities. In some embodiments the access service notification policy enforcement includes one or more of notifying an end user when a pre defined service usage condition occurs for bulk e.g. unclassified access network service usage or notifying an end user when a pre defined service usage condition occurs for one or more specific classifications of access network service activities. Examples of specific classifications of access network service activities include access by an application or OS function access to one or more network destinations or network resources such as a web site domain IP address or other address identifier URL socket tuple network server network route or APN network gateway or proxy network content source or sub network . Additional examples of specific classifications of access network service activities include device access to network services with different QoS service levels. In some embodiments a portion of the policies associated with specific classifications of access network service are implemented or enforced with a device based service processor and other portions of access network service policy are enforced in one or more network based elements.

In some embodiments in which one or more network elements implement or enforce a network based portion of access network policy enforcement and a device service processor is configured to implement or enforce a device based portion of access network policy enforcement one or more device SIM credentials are identified and used at least in part to determine the policies enforced by the network. In such embodiments the device service processor can be relied upon to implement or enforce certain aspects of access network service policy that are not implemented or enforced in the network.

In some embodiments a first portion of access network service policy is determined at least in part by one or more SIM credentials and is implemented by one or more network elements and a second portion of access network service policy is intended to be implemented by a device based service processor but the SIM is installed in a device that is not configured with a service processor capable of implementing the second portion of access network service policy. In some such embodiments a network element identifies whether the SIM is installed in a device that is configured with a service processor capable of implementing the second portion of access network service policy intended to be implemented on the device. In some embodiments the identification is accomplished by a network system that implements one or more of the following device configuration detection and network policy selection functions 1 Identify when a SIM whose credentials are used at least in part to identify a network based portion of access network policy is installed in a device configured to include a service processor capable of implementing or enforcing a device based portion of access network service policy and provision a first network based service policy in one or more network based policy enforcement elements that implement or enforce access network service policy 2 Identify when a SIM whose credentials are used at least in part to identify the network based portion of access network policy is installed in a device that is not configured to include a service processor capable of implementing or enforcing a device based portion of access network service policy and implement a second network based service policy in one or more network based policy enforcement elements that implement or enforce access network service policy.

In some embodiments when it is determined that a SIM whose credentials are used at least in part to identify the network based portion of access network policy is installed in a device configured to include a service processor capable of implementing or enforcing a device based portion of access network service policy a network based service policy provisioning system provisions a first network based service policy into one or more network elements e.g. programs or sends the policy to one or more network elements and also provisions a device based service policy into a device service processor. In some embodiments when it is determined that a SIM whose credentials are used at least in part to identify the network based portion of access network policy is installed in a device that is not configured to include a service processor capable of implementing or enforcing a device based portion of access network service policy a network based service policy provisioning system provisions a second network based service policy into one or more network elements and there is no policy provisioning for a device based service processor.

Such embodiments are advantageous for example when a device based service processor is capable of implementing or enforcing a network access service policy that has fine grain classification aspects that are not otherwise implemented or enforced in the network. For example in some embodiments a SIM is installed in a first device configuration that includes a device based service processor capable of classifying access network service usage associated with one or more device software applications and enforce a policy for access control service limit access accounting or access service notification for that classification. In this case a first set of network based access network service policies may be provisioned into the network elements that implement or enforce access network service policy. If the same SIM is installed in a second device configuration that does not include the described service processor capability a second set of network based access network service policies may be provisioned into the network elements that implement or enforce access network service policy. In such embodiments the first device configuration can include a trusted access control or service limit policies in the service processor that determine the network access allowances for one or more applications and the first network service policies are configured to facilitate this device based application access control or service limitation. In contrast the second device configuration having no service processor has no trusted access control or service limitation policies and therefore the second network service policies may be configured in a manner that allows access only if the service plan or service account associated with the SIM or second device or SIM user includes permissions for bulk access unclassified access or access that is classified by the network and not by the device.

In some embodiments the second network service policies are configured to modify the classification of network access services in accordance with capabilities that exist only in the network without the assistance of a device assisted classification component.

In some embodiments the second network service policies include a second access service accounting or charging rate that is different than the access service accounting or charging rate of the first network service policies. For example the method of service accounting or service charging to the end user in the case where the SIM is installed in a device configuration that includes a service processor capability e.g. the device is capable of performing service classification accounting control or notification functions can be different than the method of service accounting or service charging to the end user in the case where the SIM is installed in a device configuration that does not include the service processor capability. For example if the SIM is installed in a device configuration that includes a service processor capability a given application e.g. social networking application email application search application voice application news application etc. might have a first service accounting or charging policy defining a first charging measure e.g. time based usage for an application website content type service type QoS class or e.g. megabyte based usage for an application website content type service type QoS class etc. and or first charging rate e.g. X per minute or e.g. Y per megabyte etc. when the device configuration includes a service processor capability whereas when the SIM is not installed in a device configuration that includes a service processor capability all traffic may be rated in the same manner e.g. time based or megabyte based potentially with a higher price. In some embodiments when the SIM is not installed in a device configuration that includes a service processor capability the device network access permissions are altered or the device s communications may be quarantined or blocked.

In some embodiments when a SIM is installed in a device with a first device configuration the service processor is configured to differentially treat one or more classifications of access network service activities based on network congestion level time of day QoS level or background foreground access e.g. background content caching or background upload of device user analytics background software or OS updates background application server communications etc. but the same SIM can alternatively be installed in a device without such service processor capabilities e.g. a device with a second device configuration . In such an embodiment one or more of the network based portions of access control or service limitation policy network based portion of accounting or charging policy or network based portion of user notification policy can be varied depending on whether the SIM is installed in a device with the first device configuration or the second device configuration. For example if the SIM is recognized by the network in association with the first device configuration a lower accounting rating or service usage price can be applied to traffic that is i allocated to background status ii is controlled based on network congestion level iii is controlled based on time of day iv is controlled based on a lower QoS classification allowance etc. whereas if the SIM is recognized by the network in association with the second device configuration a single potentially higher accounting rating or service usage price can be applied. In some embodiments if the SIM is recognized by the network in association with the second device configuration the device network access permissions can be altered or the device s communications can be quarantined or blocked.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that includes a service processor service usage charging capability one or more network elements are configured to zero rate the device access i.e. the one or more network elements will not apply the service usage accounting recorded by one or more network elements to the user s bill and user service accounting or charging is turned over to a service controller that receives service usage accounting or charging information from the service processor.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers one or more network elements are configured to zero rate the device access i.e. the one or more network elements will not apply the service usage accounting recorded by one or more network elements to the user s bill and user service accounting or charging is turned over to one or more proxy gateway servers configured to account or charge for device service usage.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers the one or more proxy gateway servers perform additional traffic access control or service limitation policy implementation or enforcement for the one or more classifications of service usage.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers the one or more proxy gateway servers perform additional service usage classification for the purpose of service usage accounting access control service limiting or user notification.

In some embodiments when a SIM is determined by a network element to be installed in a device configuration that does not include a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers network elements other than the proxy gateway servers account for service usage potentially at a different rate than when a SIM is determined by a network element to be installed in a device configuration that includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications.

In some embodiments in which the device configuration includes a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers the device routing re directing or steering is accomplished by routing re directing or steering the device traffic for one or more service usage classifications to a specific network destination or resource associated with the proxy gateway server. In some embodiments the routing re directing or steering is accomplished using a secure tunnel through the network. In some embodiments the routing re directing or steering is accomplished with a VPN or APN tunnel.

In some embodiments a network based service charging policy system is used in conjunction with a user service agreement confirmation system wherein the user agreement confirmation system provides confirmation that the user has agreed to access service usage terms that stipulate a first rate of access service usage accounting or charging when a SIM is detected in association with a device configuration that includes a service processor capability and a second rate of access service usage accounting or charging when a SIM is detected in association with a device configuration that does not include a service processor capability. In some embodiments if a user removes or tampers with a device configuration that includes a service processor capability or if a user installs a SIM in a device that is not configured with a service processor capability the user service usage billing conditions are changed. In some embodiments depending on the device configuration e.g. with or without a service processor capability the user is billed at a different rate for bulk service usage or is billed at a different rate for one or more classifications of service usage.

In some embodiments a network based service charging policy system is used in conjunction with a user service agreement confirmation system wherein the user agreement confirmation system provides confirmation that the user has agreed to access service usage terms that stipulate a first set of access service privileges when a SIM is detected in association with a device configuration that includes a service processor capability and a second set of access service privileges when a SIM is detected in association with a device configuration that does not include a service processor capability. In some embodiments if a user removes or tampers with a device configuration that includes a service processor capability or if a user installs a SIM in a device that is not configured with a service processor capability the user service usage permissions are modified. In some embodiments this modification can include altering the allowed network destinations altering the allowed network services altering the allowed network resources quarantining access or blocking access.

In some embodiments the presence of a device service processor in combination with a SIM results in the service controller providing advantageous network access services to the user. Examples include but are not limited to the sponsored services discussed herein user paid application based services e.g. user paid services where access for one or more device applications is included in a service allowance with potentially lower cost than overall internet access user paid destination services e.g. user paid services where access for one or more network destinations or resources is included in a service allowance with potentially lower cost than overall internet access roaming services e.g. services that aid the user when the device is connected to a roaming network such as by informing the user that she is roaming and asking if she wishes to continue or block roaming service usage up to date roaming service usage indication or cost indication roaming service rate indications allowing a user to decide which device service usage classifications he wishes to allow while roaming etc. or service usage notification services e.g. providing the user with an update of how much service usage or cost has been incurred informing the user of what service plans are available informing the user when a service plan sign up may be advantageous to the user based on an activity or group of activities the user is attempting or providing the user with a set of service plan sign up choices that can be selected and purchased in a device user interface UI etc. . In some embodiments these user services are made possible by the capabilities of the service processor on the device in conjunction with a specific configuration of a service controller or other network elements on an access service provider network.

In some embodiments if the SIM for a first network service provider is removed from the device and another SIM for a second network or service provider is installed the user may not have access to the same services. In some embodiments the service processor on the device detects that the SIM has been changed and informs the user through a device user interface UI notification that if the user changes SIMS or service provider networks the user will lose certain services. In some embodiments the services that will be lost are listed in a UI notification. In some embodiments the UI notification states that if the user wishes to regain access to certain services the user can re install the original SIM.

In some embodiments one or more network elements determine whether an end user device has an active service processor. In some embodiments a service controller in the network authenticates the service processor.

In some embodiments the service controller performs authentication of the service processor to ensure that it is present and properly configured to implement a device portion of an access network service policy. show a system diagram for a device service processor to service controller communication link that can aid in secure communication and service processor authentication and verification functions.

In some embodiments all of service control device link communications are transformed into a continuous control plane connection with a frequency based on the rate of service usage a minimum set period between connections and or other methods for establishing communication frequency. In some embodiments this heartbeat function provides a continuous verification link by which the service controller verifies that the service processor and or device are operating properly with the correct service policies being implemented. In view of the following heartbeat function embodiments described herein it will be apparent to one of ordinary skill in the art that different approaches for implementing the various heartbeat embodiments are possible and it will be clear that there are many ways to achieve the essential features enabling a reliable sometimes continuous control link and verification function for the purpose of assisting control of service usage in a verifiable manner. As shown inside service processor service control device link includes heartbeat send counter in communication with agent communication bus . For example heartbeat send counter can provide a count for triggering when a service processor communication e.g. periodic communication based on a heartbeat mechanism should be sent to service controller and heartbeat buffer also in communication with agent communication bus buffers any such information for the next service processor communication in accordance with various heartbeat based embodiments as similarly described herein. Heartbeat buffer is in communication with framing element and encrypt element for framing and encrypting any service processor communications transmitted to service controller by transport services stack over service control link . Similarly as shown inside service controller service control server link includes heartbeat send counter in communication with service controller network and heartbeat buffer also in communication with service controller network which buffers any such information for the next service controller communication in accordance with various heartbeat based embodiments as similarly described herein. Heartbeat buffer is in communication with framing element and encrypt element for framing and encrypting any such service controller communications transmitted to service processor by transport services stack over service control link .

As also shown inside service processor of service control device link includes decode element for decoding any received service controller communications e.g. decrypting encrypted communications unpack element for unpacking the received service controller communications e.g. assembling packetized communications and agent route for routing the received service controller communications e.g. commands instructions heartbeat related information or status reports policy related information or configuration settings and or updates challenge response queries agent refreshes and or new software for installation to the appropriate agent of service processor . Similarly as shown inside service controller service control server link also includes decode element for decoding any received service processor communications e.g. decrypting encrypted communications unpack element for unpacking the received service processor communications e.g. assembling packetized communications and agent route for routing the received service processor communications e.g. responses to instructions and or commands heartbeat related information or status reports policy related information or configuration settings and or updates challenge response queries agent status information network service cost usage and or any other reporting related information to the appropriate agent of service controller . Accordingly as described herein with respect to various embodiments the various secure communications between service controller and service processor can be performed using the embodiment as shown in and those of ordinary skill in the art will also appreciate that a variety of other embodiments can be used to similarly provide the various secure communications between service controller and service processor e.g. using different software and or hardware architectures to provide secure communications such as using additional and or fewer elements functions or other design choices for providing such secure communications .

In some embodiments an efficient and effective communication framing structure between the service processor and service controller is provided and the following embodiments e.g. as shown and described with respect to teach such a structure that packs the various service processor agent control plane communications and the various service controller element control plane connections into a format that does not consume excessive bandwidth to enable a continuous control plane connection between the device and service controller. In some embodiments an efficient and effective communication framing structure between the service processor and service controller is provided to buffer such communication messages for some period of time before framing and transmitting such as in a heartbeat frequency that is based on rate of service usage. In some embodiments an efficient and effective communication framing structure between the service processor and service controller is provided to allow for the frame to be easily packed encrypted decoded unpacked and the messages distributed. In view of the various embodiments described herein it will be apparent to one of ordinary skill in the art that many framing structures will work for the intended purpose of organizing or framing agent communications and the uniqueness and importance of combining such a system element with the device service controller functions the service processor functions the service control verification functions and or the other purposes.

One or more authentication errors may occur when service controller attempts to authenticate service processor . For example service processor may have invalid credentials. As another example service processor may send invalid application or kernel signatures. As another example service processor may report end user device root detection errors. As another example service processor may contact service controller using an identifier that is already in use by a different end user device.

If service controller does not receive the request from service processor within the pre determined time or if service controller is unable to authenticate service processor for some reason service controller assumes that either 1 end user device does not contain a service processor and is therefore unable to participate in device assisted services or 2 although end user device has a service processor service processor has been disabled. Service controller sends a notification No active SP message to data rating element to indicate that end user device does not have the ability to provide the information necessary for data mediation element to generate detailed data usage reports e.g. micro CDRs. In some embodiments service controller sends a trigger to the network to indicate that end user device should be charged for usage at standard bulk rates. In some embodiments service controller specifies a standard bulk rate charging code in the CDRs it sends to data mediation element . In some embodiments data rating element determines data usage by end user device based on carrier based records.

If service controller receives the login or authentication request from service processor within the pre determined time and successfully authenticates service processor service controller sends a notification Device OK message to data rating element to indicate that end user device has a service processor and is capable of supporting device assisted services. In some embodiments data rating element expects to receive micro CDR reports from data mediation element when service controller has determined that end user device has an active service processor. In some embodiments data rating element determines usage based on the micro CDRs which contain more granular information than ordinary CDRs. For example whereas an ordinary CDR might simply report that an end user device used 100 Megabytes MB of data a set of micro CDRs might report that the end user device used 15 MB of e mail 35 MB of social networking and 50 MB of streaming video.

In some embodiments data mediation element sends carrier based usage reports e.g. CDRs to service controller . Service controller queries usage database for device based usage reports e.g. micro CDRs for end user device . Service controller determines the data usage of end user device from the carrier based usage reports. Service controller determines the data usage of end user device from the device based usage reports. Service controller compares the usage determined from the carrier based usage reports to the usage determined from the device based usage reports. If service controller determines that the two usage measures do not match e.g. are not identical or are not within a threshold of each other service controller sends a notification e.g. a fraud alert to data rating element to indicate that the end user device is in a fraud state and data rating element should bill usage for end user device based on carrier based usage reports. Service controller sends the carrier based usage reports and device based usage reports to data mediation element .

When the GPRS detach message is received by SGSN SGSN sends a notification to service controller that the data session for end user device is closed.

As discussed above in some embodiments a device service processor can provide information to assist in classification of service usage for any combination of device application network destination or resource a type of network roaming condition e.g. home or roaming network a time period a level of network congestion a level of network QoS and a background or foreground communication. In some embodiments when a service processor provides service usage for a classification of service usage involving one or more of device application network destination or resource a type of network roaming condition e.g. home or roaming network a time period a level of network congestion a level of network QoS and a background or foreground communication service processor generates a service usage report called a micro CDR that is then communicated to a network element e.g. a service controller . The micro CDR provides a service usage accounting breakdown in finer detail e.g. including information about a device application network destination or resource a type of network roaming condition e.g. home or roaming network a time period a level of network congestion a level of network QoS and a background or foreground communication than a bulk CDR that does not provide such a usage accounting breakdown.

In some embodiments a device is configured to receive access network services and is further configured to include a service processor capability to account for one or more service activity classifications and send the accounting to a service controller. In some embodiments the service controller is configured to communicate at least a portion of the service processor service accounting as a service usage credit to a service usage reconciliation system. Note that a service usage reconciliation system is also referred to herein in various embodiments as a service usage mediation system or similar term involving mediation. In some embodiments the service usage reconciliation system is configured to remove a credit from a user service accounting or usage bill. In some embodiments the service usage credit that is removed from a user service accounting or usage bill is allocated to sponsor service accounting or bill.

In some embodiments it is advantageous to reconcile the micro CDR service usage accounting reports received from a service processor against a trusted source. In some embodiments this is accomplished through a system that provides usage credit for one or more micro CDR usage reports that are reconciled with or validated by a trusted source. In some embodiments if such credit is provided the corresponding usage is removed from the user bulk usage and re assigned to the user according to service usage accounting rules associated with the micro CDR classification. In some embodiments the micro CDR accounting rules can be designed to account micro CDR service usage report accounting to a paid user service classification e.g. a device application based service accounting a network destination or resource based service accounting a roaming service usage accounting etc. . In some embodiments the micro CDR accounting rules can be designed to account micro CDR service usage report accounting to a sponsored service classification e.g. a sponsored device application based service accounting a sponsored network destination or resource based service accounting a sponsored background classification of service usage a sponsored content source classification of service usage a sponsored shopping service etc. .

In some embodiments the trusted source used to validate micro CDR service usage classification reports is an FDR flow data record source that reports a detailed level of classification that indicates network source or destination e.g. domain URL IP address etc. and possibly one or more ports and protocols. In some embodiments the source of the FDR is a network element. In some embodiments the source of the FDR is a device agent. In some embodiments the agent that generates the FDR report is located in a secure execution environment on the device. In some embodiments the agent that generates the FDR report is located in a secure hardware environment on the device. In some embodiments the agent that generates the FDR report uses a secure transmission protocol with the service controller that is sequenced and signed and or encrypted in a manner wherein if the sequence of FDR reports or the content of FDR reports is tampered with then an FDR integrity violation may be detected by the service controller. In some embodiments a communication from the service controller to the agent generating the FDR reports is sequenced and signed and or encrypted in a manner wherein if the sequence of FDR reports or the content of FDR reports is tampered with then an FDR integrity violation may be detected by the agent generating the FDR reports. In some embodiments when the agent generating the FDR reports detects an FDR integrity violation the agent generating the FDR reports causes device access to be quarantined or blocked for one or more access networks. In some embodiments other device communication links than access network links can also be quarantined or blocked including one or more of wired device access ports e.g. Ethernet USB firewire etc. Bluetooth WiFi and near field communications.

In some embodiments the trusted source used to validate micro CDR service usage classification reports is a network based element such as a server gateway proxy or router that processes the classification of service associated with the micro CDR. In some embodiments the network based element classifies service usage associated with the micro CDR measures the service usage and provides a service usage classification report back to a service controller so that it can be reconciled against the micro CDR reports.

In some embodiments a device is configured to receive access network services and is further configured to include a service processor capability to route re direct or otherwise steer traffic for one or more service activity classifications to one or more proxy gateway servers. In some such embodiments a service usage reconciliation system is configured to receive device service usage information e.g. a credit amount from the one or more proxy gateway servers and the service usage information is used in removing an amount e.g. a credit amount from service usage allocated to or charged to a user bill by the service usage reconciliation system. In some embodiments the device routing is accomplished by routing re directing or steering device traffic for one or more service usage classifications to a specific network destination or resource associated with the proxy gateway server. In some embodiments the routing re directing or steering is accomplished using a secure tunnel through the network. In some embodiments the routing re directing or steering is accomplished using an SSL VPN or APN tunnel.

In some embodiments a device service processor classifies service usage according to a service classification policy and routes re directs or steers the traffic associated with the classification policy to a network element e.g. a server gateway proxy or router that processes the classification of service associated with the micro CDR that generates the micro CDR for that service usage accounting. In this manner the device can associate service usage for device applications or OS functions with a specific network destination that in turn further processes the traffic and generates the appropriate micro CDRs that are sent to the service controller for reconciliation e.g. mediation as described above. The service processor can steer the traffic classified according to the classification policy by re directing the traffic to the network destination associated with the appropriate network element routing the traffic to the network destination associated with the appropriate network element or tunneling or securely tunneling e.g. SSL VPN APN the traffic to the network destination associated with the appropriate network element.

In some embodiments the trusted source used to validate micro CDR service usage classification reports is a server or website that provides the service and the validation is provided in the form of good customer feedback associated with a user credential a service processor credential or a device credential that can be used to determine which device or user to provide the credit to. For example if a website is associated with the service usage classification defined for a micro CDR and the website is visited by a device with a given device credential or user credential and the website servers track the number of visits number of transactions amount of business generated amount of data communicated or another measure of device interaction with the website then a summary of this device interaction with the website can be communicated to the service controller and the service controller can provide credit for the micro CDR.

In some embodiments another means of limiting the possibility of improper service usage accounting due to improper configuration of a service processor or tampering with a service processor can be accomplished by capping the amount of service over a given period of time that is allowed for a given micro CDR service usage classification category e.g. by limiting the amount of service usage in a given period of time for one or more service usage classifications including a device application network destination or resource a type of network a roaming condition e.g. home or roaming network a time period a level of network congestion a level of network QoS or a background or foreground communication . In some embodiments capping the amount of service over a given period of time that is allowed for a given micro CDR service usage classification category is advantageous as a way of limiting service usage costs for a user paid service that is based on a specific classification of service usage. In some embodiments capping the amount of service over a given period of time that is allowed for a given micro CDR service usage classification category is advantageous as a way of limiting service usage costs for a sponsored service that is based on a specific classification of service usage. In some embodiments the possibility of service usage report tampering for one or more micro CDR service usage classification categories is limited by combining reconciliation of service usage using one or more of start stop accounting CDR feedback FDR feedback etc. and setting a limit on the usage that is allowed for one or more of the micro CDR service usage classification categories.

In some embodiments the possibility of service usage report tampering for one or more micro CDR service usage classification categories is limited by comparing the total service usage for all combined micro CDR service usage classifications against the total amount of service used in bulk CDR reports received from a trusted source.

In some embodiments using associative classification also referred to as adaptive ambient service usage classification some service usage that can not be directly identified as belonging to a give micro CDR service usage classification is assigned to the micro CDR service usage classification based on one or more of i time proximity with one or more known service usage flows identified as belonging to the micro CDR classification ii a maximum amount of service usage e.g. byte count that has occurred since one or more known service usage flows that belong the micro CDR classification were identified or iii the fact that the unidentified service usage is associated with the same application as one or more known service usage flows that belong to the micro CDR classification.

In some such associative classification adaptive ambient service classification embodiments service usage fraud exposure can be limited by setting a limit on the amount of service usage that can be unaccounted for so that if the majority of usage can be classified as belonging to a micro CDR service usage classification category the unaccounted for service usage is allowed to be accounted for in the same micro CDR accounting. In this manner if fraudulent service usage activity results in a large percentage of service usage that is not known to be classified as belonging to the micro CDR usage classification category a micro CDR accounting integrity violation can be declared. Service usage above the limits that cannot be reconciled accounted for can alternatively be accounted for e.g. charged to the user at an agreed upon contract rate. In some embodiments the agreed upon rate is as high or higher than the rate for user paid bulk services e.g. higher than the rate at which sponsored and specialized application or website based services are billed . In some embodiments the user is sent a notification by the service controller that the user is being billed at the higher rate. In some embodiments the user signs up to a service agreement wherein the user agrees to be billed at the higher rate in the event that the service processor is compromised or the micro CDR accounting is compromised.

In some embodiments the micro CDR reports include the amount of service usage that was identified by the service processor as known to belong to the micro CDR service usage category. In some embodiments a flow identifier e.g. domain URL IP address port or device application associated with originating or terminating the flow can be provided in the micro CDR reports for service usage known to belong to the micro CDR classification. In some embodiments the service controller samples or scans these known good micro CDR flow identifiers to ensure that the flows do in fact belong to the micro CDR service usage classification and if they do not a micro CDR accounting integrity violation can be declared. In some embodiments a flow identifier e.g. domain URL IP address port or device application associated with originating or terminating the flow can be provided in the micro CDR reports for service usage that cannot be classified as belonging to the micro CDR classification. In some embodiments the service controller samples or scans these unknown micro CDR flow identifiers to determine if the service destination patterns indicate fraudulent service usage that is inconsistent with micro CDR classification policies and if so a micro CDR accounting integrity violation can be declared.

In some embodiments a SIM that is expected to be installed in a device configured with a properly configured service processor is allocated a relatively small service usage cap in a network portion of an access network service usage policy so that the device can connect to the network and allow the service processor to authenticate with the service controller. By limiting the initial amount of service usage allowed prior to the service processor authentication with the service controller it is not possible to get a large amount of service prior to ensuring that a properly configured service processor is present on the device. In some embodiments once the device service processor is authenticated an increment can be added to the usage limit in the network portion of the access network service policy. In some embodiments additional usage limit increments can be added to the network portion of the access network service policy as device service processor generated CDRs FDRs or micro CDRs are received by the service controller. In some embodiments if at any time the flow of CDRs FDRs or micro CDRs from the device is tampered with or stopped the service controller stops incrementing the usage limit in the network portion of access network service policy and the device access is denied. Alternatively in some embodiments rather than stopping service when a service processor is removed or tampered with the network portion of the access network service policy calls for the application of a higher rate of billing as compared to one or more micro CDR billing rates for micro CDR credits provided by the service controller e.g. user paid application based services user paid website based services user paid content services sponsored application based services sponsored website based services or sponsored content based services . In some embodiments if the service processor ceases to send micro CDRs to the service controller the user ceases to be credited for the micro CDR service usage and all usage is billed at a bulk rate that may be higher than the micro CDR service rates.

In some embodiments a SIM is provided or sold to a user wherein the SIM is associated with sponsored services that are based on network access service policies configured in the network policy enforcement elements and a service controller. In such embodiments the problem arises that the SIM may be installed in a device that does not have a properly configured service processor giving rise to the possibility that a user could receive unintended free services with the sponsored SIM. Embodiments described above can be used to limit the amount of access the SIM is allowed to receive prior to service processor authentication with the service controller by limiting the initial service usage amount allowed in the initial network portion of access network service policy. However if a number of sponsored SIMs are readily available and inexpensive or free a user could potentially swap several SIMs into the device and remove each SIM when the service controller fails to authenticate the service processor. In some embodiments the service controller recognizes the SIM and a second device credential e.g. an IMEI a modem credential or a device credential the first time the sponsored SIM acquires service usage and fails to authenticate the service processor for that device. Once the service processor fails to authenticate with the service controller the service controller re sets the network portion of the access network service policy to deny service the next time a SIM attempts to authenticate with the device credential associated with the original SIM.

In some embodiments good customer feedback may be used as a micro CDR credit source directly without a service processor on the device. For example in some embodiments a website is associated with the service usage classification defined for a micro CDR and the website or server that is visited by a device with a given device credential or user credential tracks one or more of the number of visits number of transactions amount of business generated amount of data communicated or another measure of device interaction with the website or server creates a summary report of this device interaction with the website or server and then communicates the summary report to a service controller. The service controller can then reconcile the good customer feedback summary report of the device interaction with the website or server by applying a user service usage credit rating rule to deduct a bulk portion of service usage from the user account and add a classification of service usage to the user account that is rated for billing purposes by a rating rule for the given micro CDR classification. Alternatively the service controller can deduct a portion of the good customer micro CDR service usage accounting or billing from the user account and add it to a sponsor entity account such as the entity that provides the website or server service. In this way a micro CDR service usage charging system can be implemented in a network for classification service usage with specialized service usage classification rating for both user paid classification and sponsored classifications without the need for a service processor on the device.

Carrier generated charging data records CDRs or real time reporting records RTRs or other real time or near real time usage record formats such as e.g. FDRs batch processed usage records continuous usage record event feeds or SMS formatted usage record messages flow from carrier which can be e.g. a real time reporting system a network gateway a network usage charging system element a AAA an HLR a billing element etc. to load balancer to RTR filtering element .

In some embodiments load balancer selects one of many CDR RTR processing threads that are available in the service controller information processing system. In some embodiments the processing thread is an asynchronous software or firmware program running on a gateway or server CPU. In some embodiments the processing thread is a virtual machine processing thread that exists in a resource pool of gateway or server CPUs or virtual machines which may include geographically separated or redundant resource pools. As illustrated in each processing thread includes the functional steps of CDR RTR filtering JMS queue CDR RTR processor and the interface to CDR RTR database . In some embodiments processing threads are asynchronous in that they are initiated when load balancer directs one or more CDR RTR data transfers to the thread and terminated when the processed CDR RTR information has been processed and deposited into CDR RTR database . Note that shows only one of potentially many available CDR RTR processing threads.

CDR RTR filtering element selects the records that are associated with devices that include a device client that communicates with the service controller e.g. the device client can be a service processor configured to provide service usage notification updates on device service plan purchase or activation with UI options display and user selection actions device assisted access control policy enforcement device assisted service usage charging policy enforcement device assisted service notification messages etc. . In some embodiments devices supporting DAS are identified by device credentials or user credentials that are communicated to the service controller as described herein where the device credential or user credential are members of a device group or user group that is managed by the service controller.

In some embodiments CDR RTR filtering element may be used advantageously to quickly receive and acknowledge a CDR RTR record to provide asynchronous functionality because of real time processing requirements server processing thread scalability and maintainability requirements or server processing thread geographic redundancy requirements. In some embodiments filtering eliminates unnecessary load on JMS queue and or CDR RTR database . CDR RTR filtering element places the records from end user devices known to be configured with a device client e.g. a service processor configured to provide service usage notification updates on device service plan purchase or activation with UI options display and user selection actions device assisted access control policy enforcement device assisted service usage charging policy enforcement device assisted service notification messages that communicates with the service controller through Java messaging service JMS queue . In some embodiments CDR RTR filtering element filters out device records for devices that may have a form of service processor but the service processor has not properly authenticated with the service controller. In some embodiments the device clients that are known to be configured with a device client that communicates with the service controller are determined by looking up a device credential or user credential associated with CDRs or RTRs in a device group or user group management database e.g. in SDC database or subscriber management system shown e.g. in .

JMS queue buffers the CDR RTR information remaining after CDR RTR filtering and allocates one or more CDRs RTRs to a service usage processing thread in CDR RTR processor . In some embodiments JMS queue is a persistent queue. In some embodiments JMS queue is a primary messaging system between applications.

CDR RTR processor retrieves the records from JMS queue transforms the records and stores them in CDR RTR database . In some embodiments CDR RTR processor is an application or a process thread. In some embodiments CDR RTR processor pulls a CDR RTR record from JMS queue transforms the record and stores the transformed record in CDR RTR database in one transaction in order to provide fault tolerance in the case of system failure. In some embodiments CDR RTR processor formats the CDR RTR information to provide a common service usage information format to facilitate one or more of service usage processing reporting analysis comparison mediation and reconciliation operations performed within the service controller system. In some embodiments CDR RTR processor observes CDR RTR time stamps and time synchronizes time aligns or time aggregates multiple CDR RTR reports so that a more consistent measure of usage with a common time reference can be achieved within the service controller system for one or more of service usage processing reporting analysis comparison mediation and reconciliation purposes.

In some embodiments end user devices capable of DAS reporting e.g. devices configured with a device client that communicates with the service controller such as a service processor described herein connect periodically or on occasion to usage reporting gateway to report their data usages. In some embodiments DAS reporting information includes but is not limited to one or more of user service plan purchase or activation selection choices device user service policy configuration preference selections e.g. user generated service policy assignments for applications websites network types or home roaming policies DAS service usage reports DAS device policy state reports DAS software environment integrity reports and other reports listed in the tables in .

In some embodiments DAS device usage reports and analytics flow from carrier device network e.g. devices configured with service processors that are in communication with the service controller to load balancer to usage reporting gateway . In some embodiments load balancer selects one of many usage reporting processing threads that are available in the service controller information processing system. In some embodiments the usage reporting processing thread is an asynchronous software or firmware program running on a gateway or server CPU. In some embodiments the usage reporting processing thread is a virtual machine processing thread that exists in a resource pool of gateway or server CPUs or virtual machines which may include geographically separated or redundant resource pools. As illustrated in each usage reporting processing thread consists of the functional steps of usage reporting gateway JMS queue report processor and the interface to usage report database . In some embodiments usage reporting processing threads are asynchronous in that they are initiated when load balancer directs one or more usage reporting data transfers to a thread and terminated when the processed usage reporting information has been processed and deposited into usage report database . Note that shows only one of potentially many available usage reporting processing threads.

Usage reporting gateway accepts reports from devices configured with a device client e.g. a service processor configured to provide service usage notification updates on device service plan purchase or activation with UI options display and user selection actions device assisted access control policy enforcement device assisted service usage charging policy enforcement device assisted service notification messages that communicates with the service controller and places the reports on JMS queue . In some embodiments usage reporting gateway only accepts device reports from device service processors that have authenticated with the service controller system. In some embodiments usage reporting gateway only accepts device reports from device service processors configured with device credentials or user credentials that are members of a device group or user group that is managed by the service controller. In some embodiments usage reporting gateway rejects reports from end user devices without authenticated service processors. In some embodiments usage reporting gateway is an application or a process thread. In some embodiments usage reporting gateway quickly receives and acknowledges end user device reports. In some embodiments usage reporting gateway provides asynchronous functionality that is advantageous to support real time processing requirements.

In some embodiments the end user device is authenticated before reports are put onto JMS queue . In some embodiments JMS queue is a persistent queue. In some embodiments JMS queue is a primary messaging system between applications.

Report processor retrieves reports from JMS queue transforms the reports and stores the transformed reports in usage report database . In some embodiments report processor is an EAI. In some embodiments report processor retrieves reports from JMS queue transforms the reports and stores the transformed reports in usage report database in a single transaction in order to provide fault tolerance in case of system failure. In some embodiments report processor formats the device usage report information to provide a common service usage information format to facilitate one or more of service usage processing reporting analysis comparison mediation and reconciliation purposes internal processing and comparison within the service controller system. In some embodiments report processor observes device usage report time stamps and time synchronizes time aligns or time aggregates multiple device usage reports so that a more consistent measure of usage with a common time reference can be achieved within the service controller system for one or more of service usage processing reporting analysis comparison mediation and reconciliation purposes.

In some embodiments CDR RTR filtering CDR RTR processor report processor and usage reporting gateway share a host.

In some embodiments micro CDR generator retrieves records from CDR RTR database and retrieves reports from usage report database . In some embodiments micro CDR generator determines a service usage amount for a micro CDR service usage classification assigns a usage accounting identifier to the micro CDR report that identifies the usage as being accounted to a device user for the device associated with a device credential or user credential and reports this amount of service usage to the carrier network in the exemplary embodiment of through JMS queue and FTP or publisher . In some embodiments micro CDR generator determines a service usage amount for a micro CDR service usage classification assigns a usage accounting identifier to the micro CDR report that identifies the usage as being accounted to a service sponsor and reports this amount of service usage to carrier network . In some embodiments the micro CDR for the sponsored service usage report also includes an identifier for a device credential or user credential. In some embodiments the amount of service usage accounted for in the micro CDR is mediated or reconciled off of a device or user bulk service usage accounting. In some embodiments micro CDR generator sends micro CDRs to JMS queue . In some embodiments FTP or publisher retrieves micro CDRs from JMS queue and pushes the micro CDRs to carrier .

In some embodiments fraud analyzer retrieves records from CDR RTR database . In some embodiments fraud analyzer retrieves reports form usage report database . In some embodiments fraud analyzer retrieves micro CDRs from micro CDR generator . In some embodiments fraud analyzer performs a fraud analysis using one or more of the record and report information sources consisting of CDR RTR database usage report database and micro CDR generator . In some embodiments fraud analyzer compares usage records associated with a specific device or user credential from one or more of CDR RTR database usage report database and micro CDR generator to determine if service usage is outside of pre defined service usage policy behavior limits. In some embodiments fraud analyzer compares service usage information associated with a specific device or user credential from one or more of CDR RTR database usage report database and micro CDR generator to determine if a pre defined service usage limit has been reached or exceeded. In some embodiments fraud analyzer compares service usage information associated with a specific device or user credential from one or more of CDR RTR database usage report database and micro CDR generator to determine if the specific device or user is exhibiting a service usage behavior that is outside of pre defined statistical limits as compared to the service usage behavior of a device or user population. In some embodiments fraud analyzer stores the results of its fraud analysis in data warehouse . In some embodiments fraud analyzer sends fraud alerts to carrier network .

In some embodiments a service design center is used to create service offers e.g. service plan offers to purchase or activate a bulk service plan an application specific service plan an application group specific service plan a website service plan a website group service plan etc. . In some embodiments the service offers are published to DAS enabled devices. To publish an offer to one or more devices in carrier device network carrier enters information in service design center . Service design center SDC stores the offer set in SDC database . The offer set then flows to device message queue . In some embodiments device message queue is a database backed persistent queue. In some embodiments when an end user device with an authenticated service processor connects to offer set gateway offer set gateway pushes the offer set to the end user device. In some embodiments offer set gateway pushes the offer set to the end user device at the next usage report. In some embodiments the new offer is an offer to purchase or activate a service plan and the offer notification is configured with offer acceptance features that allow the device user to select an option to purchase or activate the service offer in the device UI.

In some embodiments a list of service offers that are available to a device group or user group wherein the list of service offers is created in a service design center user interface is stored in SDC database and published to the devices that belong to the device group or user group.

In some embodiments an offer set is defined in service design center SDC . In some embodiments this offer set includes multiple service plans that can be communicated to the device service processor for display to the device end user for service plan selection purchase or activation through the device UI. In some embodiments the offer set UI display is configured to allow the user to purchase or activate a service plan within the offer set in real time or near real time. In some embodiments the offer set information is received from the service controller and the offer set information is processed for UI display by a device service processor. In some embodiments service processor offer set information processing and UI display is configured to allow the user to purchase or activate a service plan within the offer set in real time or near real time. In some embodiments the user s selection of a service plan for purchase or activation is communicated to the user via an offer set UI display that is configured by a service processor and the service processor communicates with a service controller via a communication interface to the notification and offer set gateway to purchase or activate the service plan in real time or near real time. In some embodiments the notification and offer set gateway communicates the user selection of service plan to the offer user selection receiver which then causes the service plan policy enforcement settings corresponding to the user s service plan selection to be implemented by communicating the user s service plan selection to network provisioning system or subscriber management order management mobile wireless center billing etc. which in turn communicates with carrier network to cause the proper service plan policy enforcement settings to be programmed in the various network elements responsible for service plan policy enforcement. In this manner in some embodiments the network service policy enforcement required to implement the new service plan for the device can be provisioned in the various network elements responsible for network based policy enforcement e.g. aggregation transport gateways e.g. PDN or GGSN mobile wireless center e.g. HLR AAA server RAN access gateway e.g. SGSN PDSN BSC . In some embodiments the network service policy enforcement that implement the new service plan for the device can be provisioned in the various service processor device agents responsible for network based policy enforcement. In some embodiments when the service plan policy provisioning is complete the service controller communicates with the device service processor that the new service plan has been purchased or activated. In some embodiments the service processor communicates a message from the service controller to the device UI that the new service plan has been purchased or activated.

In some embodiments the service processor offer set information processing and UI display is configured to allow the user to purchase or activate a service plan within the offer set in real time or near real time. In some embodiments the user s selection of a service plan for purchase or activation is accepted by an offer set UI display that is configured by a service processor and the service processor communicates with a service controller to allow the user to purchase or activate the service plan in real time or near real time and the service plan policy settings are communicated by the service controller to the service processor so that the service processor policy enforcement agents that implement the new service plan for the device can be provisioned.

In some embodiments the provisioning of the various network elements responsible for network based policy enforcement so that the device can receive the proper service plan allowances and policies can take a considerable amount of time for example minutes or even longer and this can create a poor user experience that is not real time or near real time. In such cases the service controller can create a temporary service lease by provisioning a subset of the various network elements responsible for network based policy enforcement to allow for a temporary service plan that is put in place before all of the required network elements responsible for network based policy enforcement and possibly service usage accounting or billing can be provisioned. For example the temporary lease can provision some or all of the required traffic path or data path processing elements to allow the device service usage classifications that correspond to the allowable service usage classifications in the service plan that the user has selected but do not account the usage to the correct service usage accounting or billing system configuration until the provisioning of the accounting or billing elements is complete. As another example during the temporary service lease period before the provisioning of the accounting or billing elements is complete the service controller can track service usage that is incurred during the temporary service lease period and after the provisioning of the accounting or billing elements is complete transfer the service usage that is incurred during the temporary service lease period to the appropriate service usage record database so that the usage incurred during the temporarily service lease period is properly accounted for or billed. In another example embodiment during the temporary service lease the service controller causes a temporary service provisioning to take effect in the various network elements responsible for network access control wherein the temporary service provisioning provides for all or a subset of the necessary data path provisioning required to allow the service plan allowances that correspond to the access control policies for the service plan the user has selected and the service usage incurred during the temporary service lease period is accounted to a temporary accounting other than the final accounting that will be in effect once the provisioning of the new user selected service plan is in full effect. In some embodiments the temporary accounting is a catch bucket account that is configured to track device usage during the temporary lease period. In some embodiments the temporary accounting has a service usage rating other than the service usage rating that will be in effect after the new user selected service plan is fully provisioned e.g. a zero rated accounting . In some embodiments the service usage during the temporary lease period is tracked and then transferred to the appropriate service accounting after the new user selected service plan is fully provisioned.

In some embodiments some of the delay in activating a new service plan directly on a device UI can be related to performing a credit check or user service standing check for the user s credit credentials or service account credentials. In such cases embodiments similar to those disclosed above can be used to provide a temporary service lease possibly with temporary service accounting that is eventually transferred to the final usage accounting. If during the temporary service lease period an indication is returned to the service controller that the user s credit or user service standing is insufficient to provide the service plan the user has selected then the user can be notified of this issue possibly with instructions on how to resolve the issue and the temporary service lease can be revoked thus disabling the network access permissions that would have been provided to the device if the credit check had been approved and the final service plan provisioning had taken place. In such embodiments the usage can be tracked during the temporary lease period prior to revoking the temporary lease and this service usage can be accounted to an account used for the purpose of tracking usage lost due to failed credit checks or failed user service standing checks. In some embodiments the usage incurred during a temporary lease that is eventually revoked due to a failed credit check or failed user service standing check can be accounted back to another user accounting or billing and in some embodiments this is in accordance with a user service agreement.

As one of ordinary skill in the art will now recognize prior to the time that the network can fully provision a new service plan selected by a device user on a device UI there are many additional related embodiments too numerous to list here to facilitate rapidly enabling device network access permissions that are identical to or similar to the network access permissions the device would eventually be allowed after the new user selected service plan is fully provisioned so that the device user can enjoy a relatively short time delay from the time the user selects a service plan for purchase or activation on a device and the time the network is fully provisioned to implement the new service plan.

In some embodiments the service processor is configured to display one or more service plan offers to the device end user and the time at which this display takes place is determined by what the user is doing with the device or where the device is located e.g. the end user device attempts to access the network an application on the device attempts to access the network a given application or set of applications are used or attempted to be used the device enters a roaming state etc. . In some embodiments the service processor determines the time at which the one or more service offers are to be displayed to the device user by detecting what the user is doing with the device or a condition of the device caused by the user e.g. that the device is roaming etc. .

In some embodiments a service design center is used to create device user notification messages e.g. a service offer message a service usage notification message a message indicating an amount of bulk service used a notification indicating an amount of a micro CDR service classification used a notification indicating that a bulk usage limit has been reached a notification indicating that a micro CDR usage classification usage limit has been reached etc. . In some embodiments the notification messages are published to a device service processor or a group of device service processors that belong to a device group or a user group and the service processor determines when a trigger condition exists for displaying a specific notification message. In some embodiments a service usage notification trigger condition e.g. a state of device usage such as a state of bulk service usage or attempted usage application usage or attempted usage website usage or attempted usage home roaming usage or attempted usage cellular WiFi usage or attempted usage etc. is associated with each message. In some embodiments the service processor on a device determines when the trigger condition has been met and displays a pre stored notification message associated with the trigger condition. In some embodiments a network element determines when the trigger condition has been met and uses the notification and offer set gateway via device message queue to transmit the notification message to the device for display by the device service processor. In some embodiments a device service notification message includes a service usage update from CDR RTR database which is sent through notification and offer set gateway via device message queue . In some embodiments a device service notification message includes a service usage update from micro CDR generator which is sent through notification and offer set gateway via device message queue . In some embodiments service usage updates from one or more of CDR RTR database or micro CDR generator are sent through the notification and offer set gateway via device message queue on a recurring basis. In some embodiments the recurring basis is based on a pre determined amount of usage being reached e.g. a pre determined byte count pre determined time count or pre determined percentage of a pre determined limit etc. . In some embodiments the recurring basis is based on a usage notification update frequency or time interval.

A second source not shown generates or provides second service usage measures . In some embodiments the second source is a network element such as a mediation element a gateway a real time reporting element a charging element a billing element or the like. In some embodiments the second source is a database. In some embodiments the second source is a roaming partner network element. In some embodiments the second source is an element on end user device that generates secure device data records. In some embodiments the second source is a partner network destination that provides information about customer usage of or transactions with that destination. In some embodiments the second source is an application on end user device .

Based on the second service usage measures the second source sends second usage records described below to service controller or service controller obtains the second usage records from the second source. Service controller processes the second usage records in record normalization time reconciliation and pre preprocessing . In some embodiments record normalization time reconciliation and pre preprocessing modifies the format of the second usage records to facilitate one or more of service usage processing reporting analysis comparison mediation and reconciliation operations performed within the service controller system. In some embodiments record normalization time reconciliation and pre preprocessing observes the second usage records and time stamps and time synchronizes time aligns or time aggregates multiple second usage records so that a more consistent measure of usage with a common time reference can be achieved within the service controller system for one or more of service usage processing reporting analysis comparison mediation and reconciliation purposes. Service controller stores the second usage records in second source usage records .

Service controller applies reconciliation and verification processing algorithms to reconcile records in device usage records with records in second source usage records and to validate records in device usage records . Service controller stores information based on the results of reconciliation and verification processing algorithms in data warehouse .

In some embodiments reconciliation and verification processing algorithms reconcile detailed classifications of service usage e.g. micro CDRs off of a bulk service usage accounting and onto a micro CDR classification of service usage accounting. In some embodiments reconciliation and verification processing algorithms accomplish charging for a detailed classifications of service usage by providing a detailed micro CDR charging code identifier in the micro CDR usage record communicated to the carrier network mediation or billing system. In some embodiments reconciliation and verification processing algorithms accomplish charging for a detailed classification of service usage by mediating out or subtracting the amount of service usage reported in the micro CDR from the amount of service usage accounted to bulk service usage. In some embodiments reconciliation and verification processing algorithms sends charging data records e.g. CDRs micro CDRs etc. to operator data mediation .

In some embodiments reconciliation and verification processing algorithms perform a fraud analysis using information from one or both of second source usage records and device usage records . In some embodiments reconciliation and verification processing algorithms compares usage records associated with a specific device or user credential from one or both of second source usage records and device usage records to determine if service usage is outside of pre defined service usage policy behavior limits. In some embodiments reconciliation and verification processing algorithms compares service usage information associated with a specific device or user credential from one or both of second source usage records and device usage records to determine if a pre defined service usage limit has been reached or exceeded. In some embodiments reconciliation and verification processing algorithms compares service usage information associated with a specific device or user credential from one or both of second usage records and device usage records to determine if the specific device or user is exhibiting a service usage behavior that is outside of pre defined statistical limits as compared to the service usage behavior of a device or user population. In some embodiments reconciliation and verification processing algorithms stores the results of its fraud analysis in data warehouse . In some embodiments reconciliation and verification processing algorithms sends fraud alerts to operator CRM system e.g. a carrier fraud processing system carrier personnel a device user a system administrator etc. .

In some embodiments the second usage records comprise information from multiple other measures or reports. In some embodiments the second usage records are based on information measures or reports from end user device . In some embodiments the second usage records are based on information measures or reports from other end user devices. In some embodiments the second usage records are determined based on information measures or reports from one or more network elements e.g. a base station the RAN the core or using device assisted means etc. .

In some embodiments the second usage records comprise a measure of bulk e.g. aggregate or unclassified data usage by end user device . For example in some embodiments the second usage records comprise a bulk usage report specific to end user device generated by the network by an application service provider or by a server. In some embodiments the second usage records are based on information in one or more previous reports sent by end user device .

In some embodiments the second usage records comprise information associated with the access network state. In some embodiments the second usage records are determined from network state tagged information. In some embodiments the second usage records comprise information from a device data record DDR which may indicate the network busy state and the network type. In some embodiments the second usage records are determined from DDR network state tagged information.

In some embodiments the second usage records comprise information from flow data record. In some embodiments the flow data record FDR reports a detailed level of service usage classification that indicates service usage broken down by network source or destination e.g. domain URL IP address etc. and possibly one or more ports and protocols. In some embodiments the FDR reports a detailed level of service usage classification that indicates usage broken down by device user application or OS application. In some embodiments the FDR reports a detailed level of service usage classification that indicates service usage broken down by time of day network congestion state or service QoS level. In some embodiments the FDR reports a detailed level of service usage broken down by network type e.g. 2G 3G 4G WiFi etc. . In some embodiments the FDR reports a detailed level of service usage broken down by home or roaming network.

In some embodiments the FDRs are sourced from a network element capable of classifying traffic e.g. a deep packet inspection DPI gateway a proxy server a gateway or server dedicated to a given service classification a good customer feedback source described elsewhere herein etc. . In some embodiments the second usage records are derived from a device service monitor. In some embodiments the second usage records are derived from a trusted device service monitor. In some embodiments the trusted device service monitor is located in a secure execution environment on the device that cannot be accessed by a user or user installed application software.

In some embodiments the second usage records allow service controller to determine whether the access behavior of end user device given the network state indicates that end user device is implementing the correct policy controls. In some embodiments service controller confirms that service processor is reporting the correct network state in its data usage reports. In some embodiments a network element determines the correct network state based on a group of devices. The information is reported to service controller or another suitable network function. Service controller or other suitable network function characterizes portions of the sub network e.g. base stations base station sectors geographic areas radio access network RAN etc. based on the population of end user devices connected to that sub network portion. The network element can also gather network busy state measures from network equipment such as from base stations or by sampling the RAN to determine the second measure.

In some embodiments the second usage records provide information about a cap on the aggregate amount of data usage by end user device . Service controller verifies that the total data usage by end user device as reported in the first usage records does not exceed the cap. If the first usage records provide data usage amounts for individual services used by end user device service controller verifies that the sum of the usage amounts for the individual services does not exceed the cap.

In some embodiments the network classifies FDRs to known service components determines credits of classified usage for each service component ensures that the service component usage does not exceed specified limits or matches end user device reports for the component and checks whether the sum of the components matches the bulk measure.

There are several potentially fraudulent circumstances that may be detected by service controller using one or more of the embodiments disclosed herein such as the example embodiment illustrated in . In some embodiments service controller generates a fraud alert if it receives carrier based usage reports from a network element and UDRs from service processor but the usage counts contained in the reports are not in agreement within a specified tolerance. In order to generate a fraud alert under these circumstances in some embodiments service controller accounts for unsent usage reports that may still be on end user device .

The exemplary system illustrated in operates on the same principles as the exemplary system illustrated in . Detailed usage reporting for micro CDR generation is obtained from an FDR source in carrier network e.g. the source may be a DPI gateway proxy server dedicated service server good customer feedback etc. . The FDRs from the FDR source are passed by load balancer to detailed usage reporting gateway . In some embodiments detailed usage reporting gateway observes FDR time stamps and time synchronizes time aligns or time aggregates multiple FDR reports so that a more consistent measure of usage with a common time reference can be achieved within the service controller system for one or more of service usage processing reporting analysis comparison mediation and reconciliation purposes. The processed FDRs are passed by detailed usage reporting gateway to JMS queue which in turn passes them to detailed report processor . The other functions in are similar to those described in the context of . As would be appreciated by one of ordinary skill in the art the exemplary embodiment of provides the advantages of micro CDR service usage accounting for user paid application and website services or sponsored application or website services.

In some embodiments the FDR flow data record reports a detailed level of service usage classification that indicates service usage broken down by network source or destination e.g. domain URL IP address etc. and possibly one or more ports and protocols. In some embodiments the FDR reports a detailed level of service usage classification that indicates usage broken down by device user application or OS application. In some embodiments the FDR reports a detailed level of service usage classification that indicates service usage broken down by time of day network congestion state or service QoS level. In some embodiments the FDR reports a detailed level of service usage broken down by network type e.g. 2G 3G 4G WiFi etc. . In some embodiments the FDR reports a detailed level of service usage broken down by home or roaming network.

In some embodiments the FDRs are sourced from a network element capable of classifying traffic e.g. the source is a deep packet inspection DPI gateway a proxy server a gateway or server dedicated to a given service classification etc. . In some embodiments the FDRs are derived from a device service monitor. In some embodiments the FDRs are derived from a trusted device service monitor. In some embodiments the trusted device service monitor is located in a secure execution environment on the device that can not be accessed by a user or user installed application software.

In some embodiments the FDRs not only report service usage that is attempted and allowed by a device but also service usage that is attempted and not allowed by a device. In some embodiments an FDR that reports service usage that is attempted but not allowed can include the various classification capabilities described herein. In this manner an FDR can not only detect bulk service usage or classified service usage for an application website network type etc. but can also detect when a user is attempting to gain access services for bulk services or classified services for an application website network type etc.

In some embodiments the micro CDR usage accounting derived from network usage monitoring sources is fed back to a user service usage notification function in a device service processor in order to provide a service usage classification breakdown for user paid application and website services or sponsored application or website services. This path is indicated in by the dashed line connection from micro CDR generator to device message queue and the subsequent processing and transmission of a micro CDR service usage classification update to the device service processor vial notification and offer set gateway .

In some embodiments the service processor is configured to display one or more service plan offers to the device end user and the time at which this display takes place is determined by what the user is doing with the device e.g. the user attempts to access the network an application on the device attempts to access the network a given application or set of applications are used or attempted to be used the device enters a roaming state etc. . In some embodiments the service controller determines the time at which the one or more service offers are to be displayed to the device user by detecting what the user is doing with the device. In some embodiments the service controller detects what the user is doing with the device by observing the access patterns or attempted access patterns in the FDRs or micro CDRs. In some embodiments the service controller observes FDRs that report an access service attempt from the device that was denied and this triggers the service processor to initiate a device notification message that provides a service offer and the service offer notification is transmitted via the notification and offer set gateway . In some embodiments the service controller observes FDRs that report an access service attempt from the device for a classification of service usage such as an application or website that was denied and this triggers the service processor to initiate a device notification message that provides a service offer for an application service or a website service and the service offer notification is transmitted via the notification and offer set gateway .

In some embodiments the interface protocols for notification and offer set gateway can be exposed to device OEMs or application developers in the form of an API. In some embodiments the API for notification and offer set gateway provides for a uniform means for device application software or OS software developers to write various application software that can utilize a uniform interface for requesting from a service controller a listing of service offers that are available to a device and displaying the listing to the device user interface. In some embodiments a list of service offers that are to be made available to a device group or user group is created using a service design center user interface stored in an SDC database and published to the API for notification and offer set gateway . In some embodiments the service plan enforcement policies for one or more of network access permissions or traffic control service usage limitations service usage charging or accounting or service usage notification can also be configured in service design center . In some embodiments the API for notification and offer set gateway provides for a uniform means for device application software or OS software developers to write various application software that can utilize a uniform interface for providing user service plan choices for service purchase or activation in a device UI collect the user choice and transmit the user choice to a service controller that then activates the new service for the device. In some embodiments the available service plan listing or service plan purchase or activation user selection components of the API for notification and offer set gateway is created with an XML interface. In some embodiments the available service plan listing or service plan purchase or activation user selection components of the API for notification and offer set gateway is offered via a secure web connection.

In some embodiments the interface protocols for notification and offer set gateway can be exposed to sponsored device providers or sponsored application providers in the form of an API. In some embodiments the API for notification and offer set gateway provides for a uniform means for sponsored service providers to develop device application software or OS software that can utilize a uniform interface for requesting from a service controller activation of a sponsored service plan for the device from a service controller. In some embodiments the sponsored service plan offered and activated through the API is for sponsoring all device access. In some embodiments the sponsored service plan offered and activated through the API is for sponsoring an application or group of applications. In some embodiments the sponsored service plan offered and activated through the API is for sponsoring a website or group of websites. In some embodiments the API for notification and offer set gateway provides for a uniform means for sponsored device application software or OS software developers to write various application software that can utilize a uniform interface for activating a sponsored service plan for the device an application or a website.

In some embodiments the interface protocols for notification and offer set gateway can be exposed to device OEMs or application developers in the form of an API that provides a uniform interface for device application software or OS software to request service usage information updates from a service controller. In some embodiments the service usage information updates are provided by the service controller in the form of bulk service usage. In some embodiments the service usage information updates are provided by the service controller in the form of service usage classification or micro CDR service usage updates. In some embodiments a device user software application or OS function is configured to utilize a uniform interface for obtaining service usage updates from a service controller and displaying the service usage updates to a device user interface. In some embodiments the service usage update displayed to the device UI is in the form of a gauge meter bar amount used amount remaining percent used or percent remaining. In some embodiments a device user software application or OS function is configured to utilize a uniform interface for obtaining service usage updates for a classification of service usage e.g. an application classification or website classification or another classification from a service controller and displaying the service usage updates to a device user interface. In some embodiments a group of one or more service usage notifications that are to be provided by the API for notification and offer set gateway to devices that belong to a device group or user group are created using a service design center user interface stored in SDC database and published to the API for notification and offer set gateway . In some embodiments the service plan notification policies e.g. the conditions that trigger a given service usage notification and the information content of the notification can also be configured in service design center . In some embodiments the service usage notification interface component of the API for notification and offer set gateway is created with an XML interface. In some embodiments the service usage notification interface component of the API for notification and offer set gateway is offered via a secure web connection.

In some embodiments the API for notification and offer set gateway comprises a secure interface that can only be accessed by providing a device credential corresponding to a known device or user account on the network e.g. a SIM card credential an IMSI a phone number an MDID a signed API communication an encrypted API communication or another form of secure device agent communication with the API . In some embodiments the API for notification and offer set gateway comprises a secure interface that can only be accessed by providing a user credential corresponding to a known device or user account on the network e.g. a user PIN password secure question answer biometric credential or other secure user credential available in general only to a device user or an entity trusted by the device user . In some embodiments the API for notification and offer set gateway comprises a secure interface that can only be accessed by providing an application credential e.g. application certificate signature hash information signed communication encrypted communication encrypted message or other application credential that securely identifies an application or OS function corresponding to a known application that is allowed to access the API for notification and offer set gateway . In some embodiments a device software application or OS function must provide a secure device credential secure application credential or secure user credential in accordance with a proper pre defined API format to obtain service usage notification information from the API for notification and offer set gateway . In some embodiments a device software application or OS function must provide a secure device credential secure application credential or secure user credential in accordance with a proper pre defined API format to obtain service offer set information from the API for notification and offer set gateway . In some embodiments a device software application or OS function must provide a secure device credential secure application credential or secure user credential in accordance with a proper pre defined API format to communicate user service plan selection information to the API for notification and offer set gateway . In some embodiments a device software application or OS function must provide a secure device credential secure application credential or secure user credential to the API for notification and offer set gateway in order to receive a sponsored service. In some embodiments the API for notification and offer set gateway comprises a secured XML interface. In some embodiments the API for notification and offer set gateway comprises a secure web connection.

Although the foregoing embodiments have been described in some detail for purposes of clarity of understanding the invention is not limited to the details provided. There are many alternative ways of implementing the invention. The disclosed embodiments are illustrative and not restrictive.

The following U.S. applications are hereby incorporated by reference for all purposes application Ser. No. 13 239 321 filed Sep. 21 2011 entitled SERVICE OFFER SET PUBLISHING TO DEVICE AGENT WITH ON DEVICE SERVICE SELECTION application Ser. No. 13 237 827 filed Sep. 20 2011 entitled ADAPTING NETWORK POLICIES BASED ON DEVICE SERVICE PROCESSOR CONFIGURATION now U.S. Pat. No. 8 832 777 issued Sep. 9 2014 application Ser. No. 12 695 019 filed Jan. 27 2010 entitled DEVICE ASSISTED CDR CREATION AGGREGATION MEDIATION AND BILLING now U.S. Pat. No. 8 275 830 issued Sep. 25 2012 application Ser. No. 12 380 780 entitled AUTOMATED DEVICE PROVISIONING AND ACTIVATION filed Mar. 2 2009 now U.S. Pat. No. 8 839 388 issued Sep. 16 2014 application Ser. No. 12 380 778 filed Mar. 2 2009 entitled VERIFIABLE DEVICE ASSISTED SERVICE USAGE BILLING WITH INTEGRATED ACCOUNTING MEDIATION ACCOUNTING AND MULTI ACCOUNT now U.S. Pat. No. 8 321 526 issued Nov. 27 2012 Provisional Application No. 61 206 354 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Jan. 28 2009 Provisional Application No. 61 206 944 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Feb. 4 2009 Provisional Application No. 61 207 393 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Feb. 10 2009 Provisional Application No. 61 207 739 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Feb. 13 2009 Provisional Application No. 61 270 353 filed on Jul. 6 2009 entitled DEVICE ASSISTED CDR CREATION AGGREGATION MEDIATION AND BILLING Provisional Application No. 61 264 126 filed Nov. 24 2009 entitled DEVICE ASSISTED SERVICES ACTIVITY MAP Provisional Application No. 61 384 456 entitled SECURING SERVICE PROCESSOR WITH SPONSORED SIMS filed Sep. 20 2010 and Provisional Application No. 61 385 020 entitled SERVICE USAGE RECONCILIATION SYSTEM OVERVIEW filed Sep. 21 2010.

