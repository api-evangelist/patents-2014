---

title: Searchable encryption for cloud storage
abstract: A method implements searchable encryption of cloud stored data by appending tokenized keywords to an encrypted file destined for a cloud storage service. In some embodiments, the tokenized keywords are appended to the header of the encrypted file. Searching of cloud-stored encrypted files using the native search capability of the cloud storage service is then possible by performing the search using the tokenized keywords. In alternate embodiments of the present invention, a method enables searching of cloud stored encrypted file using a cloud search appliance.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09454673&OS=09454673&RS=09454673
owner: Skyhigh Networks, Inc.
number: 09454673
owner_city: Campbell
owner_country: US
publication_date: 20141107
---
This application claims priority to U.S. Provisional Patent Application No. 61 902 104 entitled SEARCHABLE ENCRYPTION FOR CLOUD STORAGE filed Nov. 8 2013 which is incorporated herein by reference for all purposes.

Cloud computing is the use of computing resources including hardware and software that are delivered as a service over a network typically the Internet. As cloud computing achieves increased popularity and adoption of cloud based services by businesses increases concerns over security and risks of using these cloud based services become significant. Traditionally systems and software applications were deployed in enterprise environments such as within an enterprise s own private data network with strict controls and policies to ensure that data and usage are compliant with the enterprise s standards. However the adoption of cloud based services offered by third parties creates a potential mismatch or complete absence of expected enterprise level controls. Enterprises are faced with the challenge of accessing risk exposure associated with the use of cloud based services in order to apply compensating controls.

With cloud based services coming into widespread use data security for data and files stored on the cloud based service providers become an important issue. In particular cloud based data storage has also come into widespread use. With more and more user data and files being stored in cloud based data storage data security for data and files stored on the cloud based storage data has become an important issue.

The invention can be implemented in numerous ways including as a process an apparatus a system a composition of matter a computer program product embodied on a computer readable storage medium and or a processor such as a processor configured to execute instructions stored on and or provided by a memory coupled to the processor. In this specification these implementations or any other form that the invention may take may be referred to as techniques. In general the order of the steps of disclosed processes may be altered within the scope of the invention. Unless stated otherwise a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. As used herein the term processor refers to one or more devices circuits and or processing cores configured to process data such as computer program instructions.

A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention. The invention is described in connection with such embodiments but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives modifications and equivalents. Numerous specific details are set forth in the following description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.

According to embodiments of the present invention a method implements searchable encryption of cloud stored data by appending tokenized keywords to an encrypted file destined for a cloud storage service. In some embodiments the tokenized keywords are appended to the header of the encrypted file. Searching of cloud stored encrypted files using the native search capability of the cloud storage service is then possible by performing the search using the tokenized keywords. In alternate embodiments of the present invention a method enables searching of cloud stored encrypted file using a cloud search appliance.

In the present description a cloud based service or cloud service refers to computing resources including hardware and software that are delivered as a service over a data network. In most cases the cloud service is deployed on the publicly available Internet. In embodiments of the present invention the cloud based service may also be deployed on a private data network of an enterprise or be deployed on a third party private data network or be deployed on a personal data network. Furthermore in the present description cloud content or cloud data refers to data or files being processed or stored on a cloud based service on behalf of an enterprise. The cloud based service may be a cloud storage service customer relationship management CRM services information technology IT services or other types of cloud services. The cloud data or content may be stored as data files or in other formats.

With the proliferation of cloud based services an enterprise may wish to adopt one or more cloud based services for data storage or other applications. Furthermore the enterprise may deploy security measures to monitor and control the use of the cloud based services from the enterprise s own private data network or by the enterprise s employees and users. In some cases an enterprise data network redirects network traffic between a client device and a cloud based service through a network intermediary. The client device may be situated within the enterprise data network or be associated with the enterprise. The network intermediary may provide monitoring and assessment of the enterprise s cloud usage. In some cases the network intermediary is used to provide additional security function such as file encryption for uploaded data.

To ensure security associated with the use of one or more cloud based services the enterprise may redirect all network traffic destined for one or more cloud service providers through a network intermediary which can be implemented as a network proxy server. In the present description a proxy server refers to a server which can be a computer system or a software application that acts as an intermediary for requests from clients seeking resources from other servers. The network intermediary may be configured as reverse forward proxies. Thus requests and data from the user device are intercepted by the network intermediary before reaching the cloud storage service . In one embodiment the network intermediary is a cloud based service and may be deployed on the publicly accessible Internet such as public data network . In other embodiments the network intermediary may be deployed on a private data network of an enterprise or be deployed on a third party private data network.

In the following description the term data will be used to refer to data or files in any format that is being exchanged in the network environment described herein. In the present example the cloud based service may be a cloud storage service such as Box.com or collaboration services such as Office . The cloud based service may also be a customer relationship management CRM service information technology IT service or other types of cloud services.

In some embodiments the network intermediary performs encryption of data and files before sending the data and files onto the cloud storage service . Accordingly in some embodiments the network proxy server includes an encryption system which encrypts and decrypts file content based on one or more encryption algorithms. The content can be a file or list of words from the file. The encryption system may utilize keys algorithms pseudo random number generators and encoding algorithms suitable for encrypting the files from the user.

As thus configured a user in an enterprise data network wishing to use a cloud based data storage service for storing data files uses a computing device to access the cloud storage service . The user s request is redirected to the network proxy server acting as the network intermediary. The network proxy server may be configured as reverse forward proxies. Thus requests and files from the user are intercepted by the network proxy server before reaching the cloud storage service . The network proxy server performs among other things encryption of the files before sending the files onto the cloud storage service for storage. In this manner data security is ensured as files are stored on the cloud service provider as encrypted files and any one accessing the file on the cloud service provider directly will only see the encrypted text. When the file is to be retrieved from the cloud service provider the network intermediary retrieves the file and also decrypts the file. The decrypted file is then provided to the user device through the enterprise data network .

While file level encryption ensures data security encryption prevents the stored files from being searched using the cloud service provider s native search routine. For example cloud based storage service provides search option where the stored files can be searched for keywords and this search functionality will not work if the files are encrypted.

In embodiments of the present invention a method to implement searchable encryption of cloud stored data generates tokenized keywords for a file to be encrypted and attaches the tokenized keywords to the encrypted file. In one embodiment the tokenized keywords are appended to the header of encrypted file. The encrypted file with the modified header is stored on a cloud service provider. With the encrypted file thus stored with the modified header the cloud stored encrypted file can be searched using the tokenized keywords.

At the network proxy server the method then extracts the content of the file . For instance all the keywords of the file are extracted. The method may generate a dictionary of these unique keywords from the content. In the present embodiment keywords of a file represent some or all of the unique words in the file. The method then tokenizes each keyword identified . In one example the method tokenizes the keywords using a hash based message authentication code HMAC . For example the method may generate MAC message authentication code using the HMACSha1 Base64 encoding. After tokenization the method then aggregates the tokenized keywords the MACs by appending the tokenized keywords together into a string with each tokenized keyword being separated by a separator . In one embodiment the tokenized keywords are appended together using a space as the separator.

The method encrypts and encodes the file using an encryption algorithm . In one example the encryption algorithm is an AES256 GCM authenticated encryption. The method then appends the string of tokenized keywords to the encrypted file as a file header . That is the tokenized keyword string is used as a file header or is added to the native file header to form a modified file header to the encrypted file. The file header is also referred to as a keyword header in the present description. The method then sends the encrypted file with the keyword header to the cloud storage service . In the present description the string of tokenized keywords is appended to the file header of the encrypted file. In other embodiments the string of tokenized keywords can be appended to the tail of the encrypted file. The specific location where the tokenized keyword string is attached is not critical to the practice of the present invention.

At the cloud storage service the encrypted file including the keyword header is indexed to enable searching at the cloud storage service. That is the tokenized keywords in the keyword header are indexed by the cloud storage service. Thus the encrypted file is now searchable using the native search functionality of cloud storage service by providing the tokenized keywords as search terms.

Upon receiving the search request the method tokenizes the search term in the search request . The search term is tokenized using the same encoding algorithm used previously to generate the tokenized keywords of the encrypted file. In this manner the tokenized search term will correspond to the tokenized keywords previously generated. The method then sends the search request with the tokenized search term to the cloud storage service . At the cloud storage service the search is executed using the tokenized search term. The cloud storage service uses its native search functionality to search for the tokenized search term in the indexed content. Because the cloud storage service has previously indexed the tokenized keywords in the keyword header of the encrypted file the cloud storage service is able to detect a match of the tokenized search term to the tokenized keyword.

At the method receives the search result from the cloud storage service. At the method provides the search result to the user device.

When the network proxy server intercepts a request to download a file stored on the cloud storage device the network proxy server retrieves the encrypted file and decrypts the file based on the encryption algorithm previously used. The decoded or unencrypted file is then provided to the user device.

In some situations the files stored in the cloud storage service for a user may have some files that are encrypted and some files that are not. In that case the searchable encryption method described above can be applied by using folder level encryption where all encrypted files are stored in a folder and the search requests will be directed to the encrypted folder which has the keyword header with tokenized keywords.

According to another aspect of the present invention a cloud search appliance is coupled to the network proxy server to provide search functionality for encrypted files stored in cloud storage services. is a block diagram illustrating a cloud search appliance providing searching of cloud stored encrypted files in embodiments of the present invention. Referring to an enterprise data network is configured to redirect network traffic to a network intermediary . The network intermediary or network proxy server encrypts files on behalf of the enterprise data network for storage on the cloud storage service as described above with reference to . To enable searching of the cloud stored encrypted files a cloud search appliance is deployed to store a search index to facilitate searching of cloud stored encrypted files at one or more cloud service providers. In some embodiments the search index is an encrypted search index so that information and data of the enterprise do not exist as clear data outside of the enterprise data network.

In embodiments of the present invention the cloud search appliance is deployed on the publicly accessible Internet such as public data network . In other embodiments the cloud search appliance may be deployed on a private data network of an enterprise or be deployed on a third party private data network. The cloud search appliance provides searching functions for the enterprise data network especially for cloud stored encrypted data and files. In some embodiments the cloud search appliance provides an API application programming interface for receiving search requests and providing search results.

In some embodiments the network proxy server receives a file from the enterprise data network destined to the cloud storage service . The network proxy server extracts the keywords from the content of the file and encrypts the file. The keywords are tokenized using a searchable encryption algorithm. The tokenized keyword and the file identifier are then added to an encrypted search index in the cloud search appliance . The network proxy server then sends the encrypted file to the cloud storage service for storage. In some embodiments the file identifier includes an address pointer or a location pointer indicating the location at which the encrypted file is stored.

Accordingly when the user from the enterprise data network executes a search request the network proxy server receives the search request and forwards the search request to the cloud search appliance . In particular the network proxy server encrypts or tokenize the search term and forwards the tokenized search term to the cloud search appliance . The cloud search appliance searches the indexed content and returns the search result to the network proxy server . The search result includes one or more file identifiers identifying the locations at which one or more files containing the search term are stored. The network proxy server can provide the search result to the user or can retrieve the one or more indexed encrypted files from the cloud storage service and return one or more decrypted files to the user.

At the network proxy server the method then extracts the content of the file . For instance all the keywords of the file are extracted. The method may generate a dictionary of these unique keywords from the content. In the present embodiment keywords of a file represent some or all of the unique words in the file. The method then tokenizes each keyword identified . In one example the method tokenizes the keywords using a searchable encryption algorithm.

The method then stores the tokenized keywords and the associated file identifier in the cloud search appliance . In particular the tokenized keywords and file identifier are added to a search index in the cloud search appliance. In some embodiments the file identifier includes an address pointer or a location pointer indicating the location at which the encrypted file is stored.

The method encrypts and encodes the file using an encryption algorithm . In one example the encryption algorithm is an AES256 GCM authenticated encryption. The method then sends the encrypted file to the cloud storage service .

Upon receiving the search request the method tokenizes the search term in the search request . The search term is tokenized using the same encoding algorithm used previously to generate the tokenized keywords of the encrypted file. In this manner the tokenized search term will correspond to the tokenized keywords previously generated. The method then sends the search request with the tokenized search term to the cloud search appliance . At the cloud search appliance the search is executed using the tokenized search term. The cloud search appliance searches its search index for the tokenized search term. In response to a match being found the cloud search appliance returns the one or more file identifiers. At the method receives the search result from the cloud search appliance. At the method provides the search result to the user device.

According to embodiments of the present invention a network proxy server and a cloud search appliance are deployed within an enterprise data network or deployed on a private data network of an enterprise to provide search functionality for encrypted files stored in cloud storage services. is a block diagram illustrating a cloud search appliance providing searching of cloud stored encrypted files in alternate embodiments of the present invention. Referring to an enterprise data network is configured to redirect network traffic to a network intermediary . In the present embodiment the network intermediary is deployed within the enterprise data network . In other examples the network intermediary may be deployed in a private data network under the control of the enterprise. The network intermediary or network proxy server encrypts files on behalf of the enterprise data network for storage on the cloud storage service . The encrypted file is provided to the enterprise edge and then is sent to the cloud storage service . To enable searching of the cloud stored encrypted files a cloud search appliance is deployed to store a search index to facilitate searching of cloud stored encrypted files at one or more cloud service providers. In the present embodiment the cloud search appliance is deployed within the enterprise data network . In other examples the cloud search appliance may be deployed in a private data network under the control of the enterprise.

As thus configured the cloud search appliance exists behind the firewall of the enterprise data network . Accordingly the cloud search appliance may employ a search index is not encrypted and contains keywords in clear text. The network intermediary encrypts files for storage on one or more cloud service providers . However the network intermediary stores keywords in the cloud search appliance in clear text format.

In some embodiments the network proxy server receives a file from a user device of the enterprise data network destined to the cloud storage service . The network proxy server extracts the keywords from the content of the file and also encrypts the file. The keywords and the file identifier are added to a search index in the cloud search appliance . The network proxy server then sends the encrypted file through the enterprise edge to the cloud storage service for storage. In some embodiments the file identifier includes an address pointer or a location pointer indicating the location at which the encrypted file is stored.

Accordingly when the user from the enterprise data network executes a search request the network proxy server receives the search request and forwards the search request to the cloud search appliance . In particular the network proxy server forwards the search term to the cloud search appliance as clear text. The cloud search appliance searches the indexed content and returns the search result to the network intermediary . The search result includes one or more file identifiers identifying the locations at which one or more files containing the search term are stored. The network intermediary can provide the search result to the user or can retrieve the one or more indexed encrypted files from the cloud storage service and return one or more decrypted files to the user.

At the network proxy server the method then extracts the content of the file . For instance all the keywords of the file are extracted. The method may generate a dictionary of these unique keywords from the content. In the present embodiment keywords of a file represent some or all of the unique words in the file. The method then stores the keywords and the associated file identifier in the cloud search appliance . In particular the keywords and file identifier are added to a search index in the cloud search appliance. In some embodiments the file identifier includes an address pointer or a location pointer indicating the location at which the encrypted file is stored.

The method encrypts and encodes the file using an encryption algorithm . In one example the encryption algorithm is an AES256 GCM authenticated encryption. The method then sends the encrypted file to the cloud storage service .

Upon receiving the search request the method sends the search request with the search term in clear text to the cloud search appliance . At the cloud search appliance the search is executed using the search term in clear text. The cloud search appliance searches its search index for the search term. In response to a match being found the cloud search appliance returns the one or more file identifiers. At the method receives the search result from the cloud search appliance. At the method provides the search result to the user device. In some embodiments the method may further retrieve the indexed encrypted file or files from the cloud storage service .

Although the foregoing embodiments have been described in some detail for purposes of clarity of understanding the invention is not limited to the details provided. There are many alternative ways of implementing the invention. The disclosed embodiments are illustrative and not restrictive.

