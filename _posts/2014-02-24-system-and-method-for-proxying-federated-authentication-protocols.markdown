---

title: System and method for proxying federated authentication protocols
abstract: A system and method that include receiving a service provider identity request through a federated authentication protocol; transmitting a proxy identity request to a configured identity provider; receiving an identity assertion; facilitating execution of a second layer of authentication; determining a proxy identity assertion based on the identity assertion and the second layer of authentication; and transmitting the proxy identity assertion to the service provider.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08893230&OS=08893230&RS=08893230
owner: Duo Security, Inc.
number: 08893230
owner_city: Ann Arbor
owner_country: US
publication_date: 20140224
---
This application claims the benefit of U.S. Provisional Application Ser. No. 61 768 233 filed on 22 Feb. 2013 which is incorporated in its entirety by this reference.

This invention relates generally to the authentication and authorization field and more specifically to a new and useful system and method for proxying authentication providers in the authentication and authorization field.

Security Assertion Markup Language SAML is an XML based data format used for security assertions. Service providers SP will typically allow an entity e.g. a user administrator or enterprise to configure the system for SAML delegation to an identity provider IdP . For an enterprise instead of making employees maintain multiple authentication credentials for internal enterprise system and for the service provider the service provider can use the IdP so only one set of credentials may be used by an employee. When the user attempts to use a service of the service provider the SP can request to authenticate the user through the IdP. Based on an identity assertion response of the IdP the SP can make an access control decision. Many service providers only allow a single IdP service to be configured. However such implementation limits authentication security to the security level of the IdP. Thus there is a need in the authentication and authorization field to create a new and useful system and method for proxying authentication providers. This invention provides such a new and useful system and method.

The following description of preferred embodiments of the invention is not intended to limit the invention to these preferred embodiments but rather to enable any person skilled in the art to make and use this invention.

As shown in a system of a preferred embodiment can include a federated authentication proxy system comprising an identity provider IdP interface a service provider SP emulator and secondary layer authentication engine . The system can be used to implement a SAML proxy an OpenID Connect OIDC proxy a federated authentication translation proxy a multi authentication service proxy and or any suitable proxy for identity assertion service. The system functions to enable existing authentication delegation implementations to leverage additional factors of security. For example SAML delegations and OpenID connect implementations can leverage the system in integrating at least a second factor of authentication. The system is preferably used to add a two factor authentication component on top of the identity security of an IdP. Furthermore the system can be added nearly transparently without re architecting the service provider system or the IdP system. In alternative embodiments the federated authentication proxy system can be used to implement an access control proxy .

As shown in the system may additionally or alternatively be implemented to add additional factors of security to SP even with IdPs that do not support the protocol of the SP. For example the system may be used so that a company that has a LDAP RADIUS backend may use the system to use that identity provider for a service that supports SAML e.g. a federated authentication translation proxy . Herein the preferred embodiment of SAML proxying for an IdP and an alternative embodiment of OpenID connect proxying for an OpenID connect provider i.e. an OP is used but in alternative embodiments any suitable authentication provider may be proxied. A principal entity e.g. an enterprise company a web application service service provider etc. preferably elects to use the system to add the secondary layer of authentication. A principal entity will preferably have a plurality of user accounts that may use the system in attempting to access a SP associated with the principal entity through a user agent. The system may be implemented as a cloud hosted service used by a plurality of entities. For example the system may be a multitenant service platform composed of a plurality of federated authentication proxy systems . Alternatively the system may be implemented as a private proxy for a single entity and the system may additionally be hosted within an internal network as an on premise system solution. The system may be used in combination with a second layer authentication system service such as a two factor authentication system but may alternatively be integrated with an outside second layer authentication system service or any suitable secondary authentication system.

The federated authentication proxy system of the preferred embodiment is a network accessible resource that interfaces with a service provider an IdP two factor authentication transactions and a user agent. The federated authentication proxy system may be configured to run on a server a cluster of servers a distributed computing system or any suitable network accessible computing infrastructure. The federated authentication proxy system can be a cloud hosted or externally hosted component but the federated authentication proxy system can alternatively be an on premise component operating on machines controlled a SP or at least within a local network of the SP. The proxy system additionally includes any suitable databases load balancers processors or components. The SAML preferably includes an account system such that a principal entity may configure at least one IdP to be used when a corresponding user account makes an access request of a service provider.

In one variation the federated authentication proxy system is a SAML proxy as shown in . A SAML proxy functions to proxy as the IdP for a SAML integration of a SP. Many SPs may have existing infrastructure that depend on SAML based IdPs. The SAML based SP will include IdP addressing configuration for a particular account or system instance. The federated authentication proxy can include different sets of certificates and addressing configurations to manage frontend e.g. SP facing and backend e.g. IdP facing legs of the process. The SAML proxy addressing configuration can include an IdP URI parameter an IdP certificate token attribute mappings and or other suitable settings. The addressing configuration can be updated to direct identity requests to the SAML proxy. The SAML proxy can similarly include IdP addressing configuration in the SP emulator which is preferably set to properties of the original IdP previously used by the SP or otherwise intended as an eventual identity provider . This can include setting registering the SP emulator of the SAML proxy as the SP for the IdP. The federated authentication protocol used between the SP and the SAML proxy and between the SAML proxy and the IdP is preferably SAML. Other variations of the proxy system can similarly use SAML on at least one leg of the SP proxy and IdP network such as in the federated authentication translation proxy .

In another preferred variation the federated authentication proxy system is an OpenID Connect proxy as shown in . The OpenID Connect proxy functions to proxy as the OpenID Connect Provider OP for an OpenID Connect integration of an OpenID Connect relying party RP . An OP is understood to substantially parallel the components of an IdP in the SAML variation a RP is understood to substantially parallel the components of SP. Herein use of SP and IdP will be readily understood to respectively describe an RP and an OP by one skilled in the art.

Similar to how the SAML configuration is set up to integrate the SAML proxy as an intermediary component in an SP IdP authentication network the OpenID Connect proxy is preferably an intermediary component in the RP OP authentication network. OpenID Connect integration with a service provider can include registering the SP emulator with the OP. A URI of the OpenID Connect proxy e.g. a URI of the service provider emulator endpoint can be set in the OP. The OP may provide a client ID and a client secret certificate token as well as an authorize endpoint URI token endpoint URI and a user info endpoint URI. Similar properties are then set in the OpenID Connect proxy to configure the SP emulator using Within the IdP interface of the OpenID Connect proxy similar configurable attributes can be provided such that properties provided by the RP can be entered in the proxy such that the RP uses the OpenID Connect proxy as an OP.

In another variation the federated authentication proxy system can be a general purpose multi protocol system that functions to proxy and optionally translate between a variety of federated authentication protocols. The SP protocol can be automatically detected and relayed converted or translated for an external IdP. A service provider could be SAML based OpenID Connect based or based on any suitable federated authentication protocol. And similarly an IdP could be SAML based OpenID Connect based or based on any suitable federated authentication protocol. The SP and the IdP can use different protocols as shown in the multi authentication service proxy variation in . And multiple SPs can depend on a single IdP solution. In other variations a federated authentication translation proxy translates from one type of SP protocol to one type of IdP protocol as shown in .

The IdP interface of the preferred embodiment functions to simulate an authentication provider of the service provider. A service provider can preferably be configured to communicate with the IdP interface no in place of an existing IdP. As mentioned above the SP may alternatively use other authentication providers in which case the IdP interface no and the proxy system preferably proxies as a compatibility layer for the associated authentication provider e.g. LDAP RADIUS . From the point of view of the SP the proxy system can appear as a standard authentication provider. The IdP interface no is preferably integrated within the proxy system but the IdP interface no may alternatively be a component communicatively coupled to the proxy system . The IdP interface no manages communication with the SP receiving SP identity requests and transmitting assertions. The assertions to the SP will preferably be based on the combined assertions of the IdP i.e. the authentication provider and at least the second factor of authentication.

IdP or an OP in the variation of OpenID Connect or more generally an authentication provider can depend on various attributes as in SAML or scopes as in OpenID Connect . These attributes can be detected and automatically translated for use with the protocol of the intended IdP. These attributes are preferably passed into the IdP interface translated or reformatted and delivered through the SP emulator . The system can include automatic protocol detector that uses attributes and protocol communications to automatically select and engage different forms of protocols of the SP and or the SP.

The SP emulator of the preferred embodiment functions to simulate the requesting SP to an outside IdP. The SP emulator may use the SP identity requests received by the IdP interface no. Alternatively the SP emulator may process modify supplement generate or augment SP identity requests sent to the IdP. The IdP will preferably perform the regular authentication process since the emulation of a SP by the SAML proxy is preferably substantially transparent to the IdP. As described above the SP emulator may additionally or alternatively be configured to interface with other types of authentication providers such as LDAP RADIUS systems.

The secondary layer authentication engine of the preferred embodiment functions to facilitate a second factor of authentication. The secondary layer authentication engine may be an implementation of two factor authentication TFA but alternatively the secondary layer authentication engine may be an interface to a two factor authentication service or other service for an additional factor of authentication. The SAML proxy may additionally include any suitable number of additional factors of authentication. There can be an authorization layer a secondary device factor of authentication a biosecurity factor of authentication an informational challenge layer a permissions layer or any suitable additional layer of authentication or authorization to supplement the services of the IdP. The secondary layer authentication engine can be executed in parallel to IdP but may alternatively be sequence e.g. as an initial stage before IdP or as a follow up stage after use of the IdP . The SAML proxy may additionally be configured to use any suitable logic to direct the use of additional authentication factors. For example some requests may be processed with one form of two factor authentication and other types of requests may be processed with a second form of two factor authentication.

The system is preferably configured such that authentication requests are initiated by the service provider. As an alternative or additional configuration the system can be integrated in a system architecture where an authentication assertion is initiated by the IdP entity. For example single sign on systems can function as an interface to an IdP like service but instead of pushing an authentication to an external IdP the single sign on system can generate an authentication assertion and then publish the assertion to one or more service providers through an access control proxy as shown in .

The system can additionally include an account system that includes account databases and records to coordinate multi tenant use of the services of a proxy service. The account system manages different SP IdP and or secondary layer of authentication configuration. In one exemplary implementation a plurality of proxy systems can be implemented with a loadbalancer or other suitable work distributor. The authentication requests and similarly any authentication assertions can be distributed to different proxy server instances which functions to allow multiple different service providers to use the system for different customized types of authentication. General IdP interfaces e.g. one URI can be used wherein authentication requests are processed according to account instance identifier attributes submitted in a request. Alternatively individually assigned IdP interfaces can be used to further distinguish between authentication requests of different service providers.

As shown in a method of a preferred embodiment can include receiving a service provider SP identity request through an identity provider interface S transmitting a proxy identity request to a configured identity provider IdP through an SP emulator S receiving an identity assertion S performing a second layer of authentication S determining a proxy identity assertion from the identity assertion and results of the second layer of authentication S and transmitting a proxy identity assertion to the service provider S. The method functions to provide additional forms of authentication within federated authentication protocol solutions. In one preferred implementation of the method the method functions to perform SAML authentication and or authorization delegation in combination with two factor authentication. The use of a federated authentication proxy is preferably transparent to the SP and to the IdP. The operation of the federated authentication proxy service preferably simulates an IdP from the viewpoint of an SP and simulates an SP from the viewpoint of an IdP. In alternative embodiments the method may be implemented for proxying other types authentication providers. For example the method may additionally or alternatively be extended to use an IdP that has a LDAP RADIUS backend instead of an SAML. In such an alternative the federated authentication proxy preferably proxies for the appropriate authentication provider and emulates SP communication to the alternative authentication provider. The method can additionally be applied to OpenID Connect federated authentication implementations or any suitable type of federated authentication.

As described above a federated authentication proxy is preferably employed when a principal entity e.g. an enterprise with a plurality of employees using a service wants to enable a second layer of authentication and or authorization security on top of an existing IdP. The principal entity i.e. the managing account preferably configures federated authentication proxy settings of an SP to use a URI or other suitable identifier of the IdP interface of the federated authentication proxy service. Additionally the principal entity can configure the federated authentication proxy service with an IdP. For example Company A will set the SAML delegation URI field in a Sales Service Provider from a previous setting of idp.example.com to idp proxy.duosecurity.com and configure account settings of the SAML proxy to use idp.example.com and a two factor authentication service. In such an exemplary use case scenario the principal entity can use existing IdP systems while adding additional authentication and authorization security through use of the SAML proxy. Other variations of federated authentication proxy solutions can similarly be implemented such as an OpenID Connect proxy.

The method can include configuring a managing account instance with SP configuration secondary layer authentication configuration and or IdP configuration S which functions to set a federated authentication proxy to setup an IdP a two factor authentication system or service an SP and or any suitable settings of the proxy. Configuring the managing account instance can include providing an administration interface to the federated authentication proxy server service. Each entity preferably configures use of the federated authentication proxy at least partially through account settings as shown in . In configuring a SAML based IdP an entity or a managing account preferably provides the IdP identifier e.g. a URL in a manner that is substantially similar to configuring the IdP of the SP. IdPs and additional factors of authentication may be configured with customized authentication flow logic to determine how authentication should be performed. OpenID Connect and other federated authentication protocols may similarly be set up as appropriate for the protocol. There is preferably a SP configuration leg and an IdP configuration leg. The SP configuration leg defines parameters and settings for the SP to use the federated authentication proxy. The IdP configuration leg defines parameters and settings for the federated authentication proxy to simulate an SP using the IdP. The setup of authentication and or authorization may use a variety of security flows based on the services and or features desired by the principal entity. For example two optional IdPs may be configured and prior to a user agent being redirected to an IdP the user agent is allowed to select a preferred IdP.

The SP configuration is provided through the administration interface i.e. a control panel such that an account user of the SP can set up their SP account to use the proxy server as a federated authentication proxy server. The IdP configuration is provided through the administration interface such that the account user can additionally configure the proxy server to simulate a service provider to a selected IdP.

Providing the administration interface can additionally include providing an automatic configuration interface wherein the SP and or the IdP are automatically configured by authenticating with the SP and or the IdP in an administrator control panel of the proxy service. In one variation read write privileges of the existing IdP settings in the SP and or IdP can be granted to the proxy service. If the SP exposes an API for setting of the IdP service the system of the federated authentication proxy may programmatically set the federated authentication proxy as the IdP service. The existing configuration are accessed to determine the original SP and IdP setup then the configuration settings are modified to splice the authentication proxy server as an intermediary authentication node that supplements federated authentication with an additional layer of authentication. Alternatively a user can select the SP and the IdP authenticate with both services and the settings are modified based on the selection.

In one preferred implementation the federated authentication proxy is used as a multitenant federated authentication proxy shared by a plurality of entities. Each entity may additionally be configured for individually configured IdP services and or two factor or alternative authentication authorization. Preferably an IdP interface URI that is unique to each entity account may be provided to the respective entity. In that way when an SP makes requests to the federated authentication proxy server the federated authentication proxy server can determine which entity account and or IdP configuration to use. An entity account may additionally include a plurality of proxy settings for various service providers. In an alternative implementation the SAML proxy is a service component or components operating within an internal network of a principal entity as an on premise solution.

In one preferred implementation the federated authentication proxy is provided in combination with a two factor authentication service. The settings of an existing two factor authentication system may be applied to account settings of the federated authentication proxy. In an alternative implementation configuring a two factor authentication service may include receiving two factor authentication account credentials.

Step S which includes receiving a service provider SP identity request through an identity provider interface functions to emulate an IdP during execution of the authentication protocol from the perspective of the SP. The SP will preferably be configured to communicate with the federated authentication proxy. The SP will preferably identify an identifier of the federated authentication proxy when identifying a preferred IdP of a user agent and redirect the user agent to the federated authentication proxy. The identifier of the federated authentication proxy is preferably a URI and more preferably a URL but may be any suitable identifier. Communication to the URL is preferably retrieved and managed by the IdP interface of the federated authentication proxy. The SP will preferably be anticipating an IdP assertion response according to the federated authentication protocol. An SP configured to use a SAML based IdP will use the SAML protocol. An SP configured to use OpenID Connect will follow the OpenID Connect communication protocol. Upon initially receiving the SP authentication request the federated authentication proxy initiates a process of submitting the request to an IdP and conditionally performing a second factor of authentication.

Step S which includes transmitting a proxy identity request to a configured identity provider IdP through a SP emulator functions to convert the identity request of the SP to be a proxy identity request from the federated authentication proxy to the IdP. From the perspective of the IdP the federated authentication proxy is a SP. Blocks S and S which function to retrieve an identity assertion from an IdP include emulating a service provider in a second instance of a federated authentication protocol when transmitting receiving or performing other stages of the authentication protocol. When initiating communication e.g. transmitting the proxy identity request an appropriate IdP and configuration is selected. The selection of the IdP is preferably based on the identifying properties of the identity request from the SP. An identifier. In one variation a unique URI is given to the SP to be used for a particular managing account instance.

Preferably a user agent that had been directed to the federated authentication proxy in Step S will be subsequently redirected to the configured IdP. The redirection to the IdP can be transparent such that the user experiences the SP simply directing to the IdP as shown in . This variation preferably includes the second layer of authentication happening sequentially after completing authentication with the IdP as shown in . In another variation the federated authentication proxy transmits the proxy identity subsequent to and conditional upon successful authentication with the secondary layer of authentication as shown in . This variation preferably includes the second layer of authentication occurring sequentially before engaging the IdP. In another variation the transmitting of a proxy identity request to a configured IdP through a SP emulator is performed in combination or in parallel with a second layer of authentication. In one variation the parallel execution of the primary identity authentication and the secondary layer authentication can be appear as a single process to a user as shown in .

In one preferred implementation the SP and the IdP use common federated authentication protocols. In alternative implementations the second instance of the authentication protocol is a different protocol and the SP emulator or another suitable component translates from an authentication protocol of the SP to an authentication protocol or the IdP. For example a SAML based SP can use an OpenID Connect based IdP. Similarly the converse can occur for translating from an OpenID Connect protocol to a SAML protocol. The translation can be automatically invoked based on the configuration of the SP and or the IdP. Translation between SAML and OpenID Connect can include translation between attributes of SAML and scope properties of OpenID. In one implementation a table of attribute mappings can be maintained that provide attribute translation patterns between the protocols. One exemplary mapping could translate based on an attribute name e.g. OIDC given name vs SAML givenName . Translation can additionally occur on attribute values. For example the OIDC address attribute can be changed to a JSON structured object. Additionally differents in the format of the protocols spoken e.g. between SAML and OIDC translation of attribute envelope messages can further be used e.g. JSON claims in OIDC vs XML in SAML .

The IdP preferably performs the identity authentication and or authorization of the IdP. In one variation the IdP collects username and password information which can be validated by the IdP. The IdP preferably includes user account databases that can be used to authenticate credentials and then perform any suitable signing or cryptographic procedures to assert valid authentication back to the SP. The assertion of the IdP successful or unsuccessful is then transmitted back to the configured SP of the IdP in this leg of communication the configured SP of the IdP is the service provider emulator of the federated authentication proxy server . The federated authentication proxy is preferably agnostic to the operational details of the IdP as the IdP is preferably an outside service selected and controlled by a principal entity. In one preferred implementation the federated authentication proxy server and the IdP are established within a firewall of an internal network such that username password credentials or any suitable credentials are not exposed to the external network. In an alternative embodiment the IdP may be any suitable alternative service capable of performing identity verification and responding with some form of identity assertion such as a LDAP RADIUS system OpenID Connect and the like.

Step S which includes receiving an identity assertion functions to receive the primary stage layer of identity assertion provided by an IdP. In the case of SAML the IdP preferably responds with an XHTML form response including a SAML response parameter. The identity assertion of the IdP preferably indicates if the identity was successfully authenticated and or authorized. If the identity assertion indicated the IdP successfully validated the request then the federated authentication proxy preferably proceeds to block S. If the identity assertion indicated the IdP denied or unsuccessfully validated the identity request then S may be optionally skipped and the failed assertion is transmitted to the SP as in block S. The transmission preferably indicates that the identity request failed to be validated. Block S can still be implemented in a modified form such as to notify the user of the failed attempt through a secondary device used in two factor authentication. In an alternative variation the second layer of authentication is initially completed and the end assertion result depends on the identity assertion of the IdP. Alternatively block S and block S may be performed in parallel as described above.

Step S which includes performing a second layer of authentication functions to execute and insert an additional factor of authentication authorization and or identity security into the identity authentication process. The second layer of authentication is preferably a form of two factor authentication through a registered device of the identity authenticated. Performing two factor authentication will preferably include receiving verifying credentials such as a knowledge factor e.g. something the user knows a possession factor e.g. something the user has and or an inherence factor e.g. something the user is . Additional layers of authentication preferably of different variations can additionally be performed. Preferably performing two factor authentication includes verifying a possession factor by transmitting an authentication message to a user device. The authentication message in one variation will include interactive response capabilities to confirm ignore cancel and or perform any suitable authentication response. The authentication message in a second variation will transmit a code. In this variation the user agent is preferably directed to an interface to enter and confirm receipt of the code. The interface is preferably presented through an interface enabled through the IdP interface of the federated authentication proxy by simulating an interface of the IdP. The interface may alternatively be presented in an alternative destination such as an accompanying application on a mobile computing device the web or other suitable destination. The two factor authentication may alternatively be performed in any suitable manner such as by confirming a disconnected token a connected token single use password biometric reading location information or any suitable form of two factor authentication. In an alternative variation a two factor authentication service is messaged with appropriate identifiers of the user account entity attempting to authenticate. Alternatively the second factor identity security may be configured for authorization. For example a permissions service may be used to check authorization of the requested action or a second user may be messaged and or prompted to authorize the identity request. The method may include the process of performing the at least second factor of authentication authorization but alternatively the SAML proxy may interface with an outside service used as the second factor of authentication.

Prior to performing the second layer of authentication the method can include setting second layer of authentication properties of a user identity S which functions to set up the user for executing the two factor authentication or other suitable form of additional layers of authentication as shown in . The authentication properties could include an endpoint address of an authenticating device e.g. a phone number or an application instance identifier for push notifications or app messaging answers to a set of security questions a set of biometric samples synchronization of one time password tokens synchronization of a or any suitable properties used to later verify authentication properties.

The federated authentication proxy preferably maintains a record of second layer authentication properties for a given identity and a given managing account. When an identity request comes in a unique identifier of the identity in question is preferably used to access and select the corresponding second layer authentication properties which are used in executing the second layer of authentication. The managing account is preferably established by the entity configuring the SP the proxy server and the IdP. For example the managing account could be controlled by the IT department of an enterprise company that wants to use the SP and IdP for their employees. In this example the employees would each have a user identity that may be authenticated. Each user identity that the managing account wants to authenticate with the additional factors of authentication provided by the federated authentication proxy server must be set with second layer authentication properties.

In one variation an application programming interface API admin control portal interface or any suitable interface provides a mechanism through which the managing account can set the properties for selected user identities. Additionally the federated authentication proxy server can process identity requests differently depending on the status of user identity authentication properties when processing a corresponding identity request. In one implementation only select user identities are configured with the second layer of authentication. Only identity requests for these users trigger use of the second layer of authentication other user identity requests are processed only with the IdP. Alternatively default authorization properties can be set so that any non registered user identity request goes through a second layer of authorization by another entity. For example the first time a user tries to authenticate in an SP the IT department can be notified and asked to verify the identity request. This can provide a channel through which an IT department may efficiently enroll new user identities on demand without blocking access while a user waits for the second layer of authentication to be set up.

In another variation the federated authentication proxy server can automatically initiate enrollment of a new user identity when authenticating a user without configured second layer authentication properties. When an identity authentication request is received if the identity is not in the database of configured user identities a prompt could be displayed for a user to set the authentication properties. The second layer of authentication is then subsequently dependent on the authentication properties set during the initial setting or prior edits of the properties. The identity request is still preferably verified by the IdP.

The result of the second layer of authentication is preferably collected received or obtained by the federated authentication proxy service. The second layer of authentication may alternatively be performed in parallel to the IdP identity validation of Steps S and S. If the two factor authentication determines the user is not authentic and or authorized prior to a response from the IdP then the SAML proxy may immediately proceed to Step S transmitting a proxy identity assertion that indicates the identity request failed to be validated which parallels the alternative embodiment of Step S.

Alternative or additional forms of authentication authorization may be used in place of or in addition to the two factor authentication. Herein the system and method uses two factor authentication as the preferred form of secondary authentication authentication service but any suitable secondary authentication and or service may be used as one skilled in the art would appreciate. In one preferred embodiment the federated authentication proxy is a component of the two factor authentication service. With an integrated two factor authentication service or other suitable service of an additional authentication layer the method can include the processes relating to the form of the second layer of authentication. For example a two factor authentication service preferably includes identifying a device endpoint mapped to the user identity messaging the device endpoint receiving authentication confirmation through messaging the device endpoint and verifying authentication confirmation. The two factor authentication can depend on user entry of a pincode transferred to the device endpoint application confirmation with cryptographically secured verification or any form of confirmation. In one implementation the two factor authentication uses push notifications as described in patent application Ser. No. 13 039 209 filed 2 Mar. 2011 which is hereby incorporated in its entirety by this reference.

Block S which includes determining a proxy identity assertion from the identity assertion and results of the second layer of authentication functions to apply logic in determining the resulting assertion from the set of information including the identity assertion and results of the second layer of authentication. Since the federated authentication proxy preferably requires at least two forms layers of identity validation if either the IdP or the two factor authentication fail to confirm that the identity request is indeed valid authentic and or authorized then the response to the SP preferably reflects the invalidity of the identity request. A positive confirmed or verified proxy identity assertion is determined by the combination of a successful identity assertion and successful completion of the second layer of authentication. In one variation the result of the IdP identity assertion is not inspected by the federated authentication proxy the proxy identity assertion packages the result of the IdP identity assertion to be dependent on the success or failure of the second layer of authentication. In this variation the SP will determine the identity assertion to be successful only if the assertion from the second layer of authentication is successful when the IdP had been successful. In an alternative embodiment at least a second IdP may additionally be configured. Steps S and S may be repeated for each additional IdP configured for the principal entity. Similarly block S can be repeated for additional layers of authentication

Step S which includes transmitting a proxy identity assertion to the service provider functions to send a response to the initial request of the service provider. The federated authentication proxy preferably considers the identity assertion of the at least one IdP and the result of the two factor authentication. Preferably all forms of identity security e.g. the identity assertion and the two factor authentication positively confirm approve or validate the request of the SP. In one alternative variation if one of the security factors fails to adequately validate the request then a subsequent security factor or security channel may be used. Similarly the federated authentication proxy may be configured to trigger some outside response for particular security validation scenarios. For example if the IdP validates the request and two factor authentication does not then the federated authentication proxy may trigger an account alert send an email to an appropriate destination alter account user identity privileges or security measures or perform any suitable action in addition to transmitting the proxy identity assertion to the service provider. In an alternative variation the proxy identity assertion can be posted to a status resource. The status resource can be a URI where an encrypted assertion result can be accessed. The status resource is preferably used if and when the authentication protocol dictates that the SP polls the status resource for results.

In an alternative embodiment a method S for single sign on proxying can include receiving an identity assertion of an identity provider through a federated identity protocol S facilitating execution of a second layer of authentication S and transmitting a proxy identity assertion to a service provider through a second instance of a federated authentication protocol comprising emulating an identity provider in the second instance of a federated authentication protocol S as shown in .

The method S can share substantial similarities to the variations and aspects of the method S above. However S is preferably initiated by an identity assertion from an identity provider as opposed to the embodiment described above that preferably initiates in response to an identity request of a service provider. The method can include in association with a managing account instance configuring the first instance of a federated authentication protocol and the second instance of a federated authentication protocol and prior to transmitting the proxy identity assertion selecting the second instance according to an identifier of the managing account from the first instance in manner substantially similar to selecting an identity provider of a service provider in method S. The second layer of authentication is preferably used as an additional check that must be determined to be successful before a positive identity assertion is delivered to the service provider. If the second layer of authentication is unsuccessful the proxy server can return an error message to the identity provider send an unsuccessful identity assertion to the service provider ignore the identity assertion the identity request or perform any suitable action in response to an unsuccessful second layer authentication authorization.

As in method S method S can be applied to a variety of protocols. As one example a first party protocol of a single sign on service can interface with the federated authentication proxy server. In another example the IdP and or the SP can user ADFS active directory federation service or any suitable claim based access control authorization protocol. The method S can additionally include translating between federated authentication protocols. For example when the protocol between the identity provider and the federated authentication proxy server i.e. a first protocol instance and the protocol between the federated authentication proxy server and a service provider i.e. a second protocol instance the method can include translating attributes between the first type of protocol and the second type of protocol.

The system and methods of the preferred embodiment and variations thereof can be embodied and or implemented at least in part as a machine configured to receive a computer readable medium storing computer readable instructions. The instructions are preferably executed by computer executable components preferably integrated with the SAML proxy and or two factor security system. The computer readable medium can be stored on any suitable computer readable media such as RAMs ROMs flash memory EEPROMs optical devices CD or DVD hard drives floppy drives or any suitable device. The computer executable component is preferably a general or application specific processor but any suitable dedicated hardware or hardware firmware combination device can alternatively or additionally execute the instructions.

Although omitted for conciseness the preferred embodiments include every combination and permutation of the various system components and the various method processes.

As a person skilled in the art will recognize from the previous detailed description and from the figures and claims modifications and changes can be made to the preferred embodiments of the invention without departing from the scope of this invention defined in the following claims.

