---

title: Mobile electronic communications combining voice-over-IP and mobile network services
abstract: A database stores unique associations between account identifiers and mobile-network telephone numbers assigned by a mobile network to mobile communications devices. The account identifiers are also associated with voice-over-IP (VoIP) telephone numbers. Voice calls between the mobile communications devices are made as voice-over-IP (VoIP) calls using respective VoIP telephone numbers. Tracking of the VoIP calls is performed through the mobile network using respective mobile-network telephone numbers, so that a prepaid balance can be enforced.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09621735&OS=09621735&RS=09621735
owner: TEXTNOW, INC.
number: 09621735
owner_city: Waterloo
owner_country: CA
publication_date: 20140625
---
Mobile communications technologies are continually evolving. It is common for mobile networks e.g. cellular telephone networks to support multiple different protocols and standards as mobile operators transition to newer technologies. Transition is gradual and older technologies tend to stay in service to support users who lack the impetus or finances to upgrade to newer technologies. However such users could benefit from newer technologies if such were readily available to them. In addition the need to support various protocols and standards adds complexity and cost for mobile operators their direct customers and mobile virtual network operators MNVOs .

According to one aspect of the present invention an electronic communications system includes a mobile network for providing mobile communication between a plurality of mobile communications devices based on mobile network telephone numbers associated with plurality of the mobile communications devices. The mobile network supports at least one mobile network protocol and an Internet Protocol IP . The electronic communications system further includes a wireless local area network WLAN for providing WLAN communication between the plurality of mobile communications devices and a wide area IP network. The WLAN operates on at least the Internet Protocol. The electronic communications system further includes a communications routing system coupled to the mobile network and coupled to the WLAN via the wide area IP network. The communications routing system operates on the Internet Protocol. The communications routing system includes at least one database storing a plurality of unique associations between account identifiers and the mobile network telephone numbers and further between the account identifiers and voice over IP VoIP telephone numbers. The communications routing system further includes a routing engine responsive to incoming communications events including initiation of voice calls ending of voice calls and communication of short message service SMS messages. The routing engine is configured to initiate and end voice calls between the plurality of mobile communications devices as voice over IP VoIP calls using respective VoIP telephone numbers. The routing engine is further configured to track VoIP calls made through the mobile network using respective mobile network telephone numbers.

According to another aspect of the present invention a communications routing system coupled to a mobile network and coupled to a wireless local area network WLAN via a wide area Internet Protocol IP network includes at least one database storing a plurality of unique associations between account identifiers and mobile network telephone numbers assigned by the mobile network to a plurality of mobile communications devices and further between the account identifiers and voice over IP VoIP telephone numbers. The communications routing system further includes a routing engine responsive to incoming communications events including initiation of voice calls ending of voice calls and communication of short message service SMS messages. The routing engine is configured to initiate and end voice calls between the plurality of mobile communications devices as voice over IP VoIP calls using respective VoIP telephone numbers. The routing engine is further configured to track VoIP calls made through the mobile network using respective mobile network telephone numbers.

According to another aspect of the present invention a method for electronic communications includes storing in at least one database a plurality of unique associations between account identifiers and mobile network telephone numbers assigned by a mobile network to a plurality of mobile communications devices and further between the account identifiers and voice over IP VoIP telephone numbers. The method further includes initiating and ending voice calls between the plurality of mobile communications devices as voice over IP VoIP calls using respective VoIP telephone numbers and tracking VoIP calls made through the mobile network using respective mobile network telephone numbers.

The present invention generally relates to providing wireless carrier services e.g. voice calls short message service or SMS messages general data communications etc. over the Internet Protocol IP . Substantially all communications between mobile devices are processed and routed over IP. While certain infrastructure may not operate under IP e.g. PSTNs cellular base station networks etc. communications are routed to and from such infrastructure using IP to the extent possible. The present invention also generally relates to synchronizing communications over several mobile or stationary devices operating under the same account and tracking and managing prepaid balances for traditional carrier services e.g. voice call minutes SMS messages etc. that are routed an may be delivered over IP. Other aspects of the present invention will also become apparent in light of the following detailed description.

The system includes a mobile network such as a wireless cellular network that operates under one or more known standards and technologies such as Long Term Evolution LTE Worldwide Interoperability for Microwave Access WiMAX Enhanced Voice Data Optimized EVDO Code Division Multiple Access CDMA HSPA High Speed Packet Access and similar. The mobile network provides voice data and SMS services.

The system further includes at least one wireless local area network WLAN that operates under one or more known standards and technologies such as IEEE 802.11.

The mobile network and the WLAN each connect to a wide area IP network such as the Internet. The WLAN can be connected to the wide area IP network by an Internet service provider ISP or the similar entity. The mobile network can be connected to the wide area IP network by a packet data interface.

The system can further include a push notification service such as the kind operated by Google Inc. of Mountain View Calif. and Apple Inc. of Cupertino Calif.

A plurality of mobile communications devices can connect to the mobile network via base stations and other infrastructure and can further connect to the WLAN via access points or similar. Examples of suitable mobile communications devices include devices such as cellular telephones smartphones tablet computers and the like that are provided with wireless communications interfaces suitable for the particular technologies used in the mobile network and the WLAN . For sake of discussion it is assumed that all of the mobile communications devices can connect to the mobile network and WLAN . In various implementations different mobile communications devices have different types of wireless communications interfaces different configurations and or different access rights suitable for connection to different mobile networks and different WLANs.

One or more stationary communications devices such as a desktop computer server or similar can also connect to the WLAN via a router or wired access point.

The system can further be connected to a public switched telephone networks PSTN that supports correction to a plurality of landline telephones and additional mobile networks . The additional mobile networks may have the same or similar features of the mobile network and may be operated by different carriers and or operated according to different technologies and standards when compared to the mobile network .

The system further includes at least one voice over IP VoIP service which can be configured to manage IP data streams related to VoIP communications. The VoIP service may operate using one or more protocols such as the Session Initiation Protocol SIP and one or more audio codecs such as Opus. The VoIP service can be connected to the PSTN to allow VoIP calls to be place to and from landlines and wireless devices in the additional mobile networks . In some implementations the VoIP service is a subcomponent of the mobile network .

The system further includes a communications routing system connected to the VoIP service the push notification service and the mobile network via the wide area IP network . In some implementations the VoIP service is directly connected to the communications routing system via a local IP network distinct from the wide area IP network . The communications routing system is configured to route communications of disparate types between mobile communications devices via the mobile network and the WLAN .

The system can further include a proxy connected to the communications routing system the WLAN and the mobile network via the wide area IP network . In some implementations the communications routing system and the mobile communications devices can be configured to route communications events through the proxy . The proxy can be configured to handle VoIP call handoffs as an alternative to the communications routing system handling such. In addition the proxy can be configured to prioritize communications events associated with the enhanced system as an alternative to the communications routing system doing so. For example the proxy can control quality of service QoS settings for various communications so that 911 calls are prioritized. In some implementations the VoIP service is configured to route all relevant VoIP data through the proxy . A suitable proxy service can be in the form of that available from Pravala Networks Inc. of Kitchener Ontario Canada.

The system can further include an interoperation service connecting the communications routing system to the mobile network via the wide area IP network . The communications routing system can be connected to the interoperation service via a virtual private network VPN established over the wide area IP network . The interoperation service is configured to interface with the various mobile networks . The interoperation service facilitates data communications between the communications routing system and the mobile network . The interoperation service further facilitates messaging services such as SMS and MMS between the communications routing system and the additional mobile networks . The interoperation service can be the kind provided by Syniverse of Tampa Fla.

The communications routing system includes at least one database such as an accounts database and one or more user data databases configured to store a plurality of associations between unique account identifiers e.g. user names and mobile network identifiers supported by the mobile network such as mobile directory numbers MDNs or telephone numbers . For each user name the database can store a first MDN for SMS MMS messages and VoIP calls and a second MDN for services on the mobile network . The first and second MDNs are district and mutually different. The first MDN is used at the VoIP service and the communications routing system for VoIP calls. The first MDN is also used at the interoperation service and communications routing system for communicating SMS MMS messages. In some implementations the first MDNs are landline telephone numbers obtained from at least one competitive local exchange carrier CLEC . The second MDN is used by the mobile network to track data usage by each respective mobile communication device with the communications routing system using the second MDNs to map data usage to particular accounts. The database may further store push tokens to identify mobile communications devices via the push notification service so that the communications routing system can send push notifications to the mobile communications devices . Alternatively or additionally the database may store currently assigned IP addresses for the mobile communications devices .

In some embodiments only the first VoIP MDN is used and the first MDN is registered with the mobile network for data usage at the mobile network . For such embodiments functionality described herein described with respect to the second mobile network MDN is performed using the first VoIP MDN.

The communications routing system further includes a routing engine responsive to incoming communications events. Incoming communications events can include initiation of voice calls ending of voice calls communication of SMS MMS messages requests for data. The routing engine is further configured to route data communications between the plurality of mobile communications devices over the mobile network and the WLAN using the Internet Protocol. The routing engine is further configured to initiate and end voice calls between mobile communications devices as VoIP calls using the VoIP server and to communicate SMS messages between the plurality of mobile communications devices via the mobile network and the WLAN using the Internet Protocol.

The communications routing system can further include a short message service center SMSC and a multimedia message service center MMSC configured to store forward convert and deliver SMS and MMS messages between the communications routing system and the interoperation service . The SMSC and MMSC can be configured to communicate with the interoperation service using the Short Message Peer to Peer SMPP protocol.

Each mobile communications device can be associated with one of the unique account identifiers e.g. user names stored in the database . This can be achieved by for example a client program executed on the mobile communications device requiring a user log in e.g. client of . When a user is logged in to the client program the mobile communications device becomes associated with the respective unique account identifier.

Each account identifier can be associated with a second mobile network identifier such as a first MDN that is associated with the VoIP service . Each account identifier can be associated with a second mobile network identifier such as an MDN that is associated with mobile data access on the mobile network . In some implementations the second MDN is only associated with mobile data access on the mobile network to the exclusion of access to circuit switched voice services and SMS MMS services that may be available on the mobile network . The mobile network uses the second MDN to track data usage of the mobile communications device which can be reported to the communications routing system . Hence for each account voice services via the VoIP server are conducted with one MDN and data services are conducted via the mobile network using a different MDN. The communications routing system maps each MDN to a particular account for managing overall services to that account.

An outgoing voice call from a mobile communications device is conducted as follows. The mobile communications device sends a call request to the VoIP service via the WLAN if connected or otherwise via the mobile network . The mobile communications device registers with the VoIP service if not already registered. If the destination device is on the PSTN the VoIP service completes the call via the PSTN . If the destination device has an account with the communications routing system then the VoIP service notifies the communications routing system of the call request. The communications routing system then issues a push notification to the destination device through the push notification service to notify the destination device of the call. Then the destination device which is one of the mobile communications devices registers with the VoIP service if not already registered and notifies the VoIP service of call acceptance. The VoIP service can notify the communications routing system of call initiation and ending. When the proxy is used VoIP voice data is routed through the proxy .

For mobile communications devices operating on iOS by Apple Inc. the mobile communication device receiving a push notification does not immediately trigger SIP registration. Rather the push notification informs the user of the incoming call via an alert or similar. The user can then respond to the push notification by opening the client program which then performs the SIP registration.

For mobile communications devices operating on Android by Google Inc. the mobile communication device can be configured to perform a SIP registration in response to receiving a push notification for an incoming call. That is the SIP registration process can be started before the user has accepted the call.

Incoming calls to the mobile communications devices arrive at the VoIP service via the PSTN . The VoIP service notifies the communications routing system of a call request for a particular destination mobile communications device . The communications routing system then issues a push notification to the destination mobile communications device through the push notification service to notify the destination mobile communications device of the call. If the user of the destination mobile communications device accepts the call then the destination mobile communications device registers with the VoIP service if not already registered and notifies the VoIP service of call acceptance. The VoIP service can notify the communications routing system of call initiation and ending.

Incoming and outgoing calls made to or from a mobile communications device associated with the communications routing system are made using the first MDN which is established at the VoIP service . When such a call is conducted as data via the mobile network the second MDN of the relevant mobile communications device is used to track the data usage on the mobile network .

In some embodiments caller ID is based on the VoIP MDN to the exclusion of the mobile network MDN. That is the mobile network MDN is for tracking data usage only and the VoIP MDN is the basis for outgoing and incoming calls.

An outgoing SMS MMS message can be sent by a mobile communications device as follows. One or more IP data packets containing the SMS MMS message are sent from the mobile communications device to the communications routing system via the WLAN if connected or otherwise via the mobile network . The sent data specifies a destination device using an MDN. The communications routing system determines whether the MDN is stored in the database and thus whether the destination device is a mobile communications device associated with the communications routing system . If the destination device is a mobile communications device associated with the communications routing system then the communications routing system stores the message and sends a push notification to the destination mobile communications device via the push notification service . When a user at the destination mobile communications device opens an SMS MMS application module or performs a similar action the destination mobile communications device fetches the stored message from the communications routing system . If the destination device is not associated with the communications routing system then the communications routing system sends the SMS MMS message to the destination device via the interoperation service .

Incoming SMS MMS messages for the mobile communications devices arrive at the communications routing system either directly from other mobile communications devices that have accounts at the communications routing system or via the interoperation service for devices that are not associated with the communications routing system . The communications routing system stores a particular SMS MMS message and sends a push notification to the destination mobile communications device via the push notification service . When a user at the destination mobile communications device opens an SMS MMS application module or performs a similar action the destination mobile communications device fetches the stored message from the communications routing system .

Incoming and outgoing SMS MMS messages made to or from a mobile communications device associated with the communications routing system are made using the first MDN. When messages are sent as data through the mobile network the second MDN of the respective mobile communications device is used to track the data usage on the mobile network .

Data communications between mobile communications devices and between mobile communications devices and data sources such as web sites connected to the wide area IP network are performed via the WLAN if connected and otherwise via the mobile network .

Mobile communications devices connect to the load balancer via the wide area IP network using a protocol such as HTTP HTTPS or the like. The load balancer is configured to balance requests from the mobile communications devices among the servers .

The servers are connected to the load balancer . The servers can be configured to interface with the VoIP service and the mobile network . The servers can be clones having the same functionality. The servers contain program code configured to interface with application programming interfaces APIs provided by the VoIP service and the mobile network and or provide APIs for use by the VoIP service and the mobile network . The servers can be implemented using Nginx PHP and similar technology.

The SMSC and the MMSC are connected to the servers and configured to store forward convert and deliver SMS and MMS messages between the servers and the interoperation service using for example the SMPP protocol and the MM4 protocol. The SMSC and MMSC can be configured to connect to the interoperation service via a suitable binding and through a VPN tunnel. The SMSC and MMSC expose an API to the routing engine such that the routing engine can use the API to send outgoing SMS MMS messages. For incoming messages the SMSC and MMSC are configured to invoke an API of the routing engine to cause the routing engine to store a received message and send a notification of the message to the destination mobile communications device .

The switch connects the servers to the user data databases the accounts database a cache and a queue .

The user data databases store data for each of the users identified in the accounts database . Such user data can include the mobile network MDN session ID password residential address contacts sessions in app purchases subscriptions settings balance information and communications events including call histories SMS MMS message transmission histories and SMS MMS message content. The user data databases can be configured to store communications event histories for all user names in the accounts database such that a particular user s history can be downloaded to any communications device with which the user logs in. The user data databases can be implemented as database shards.

The cache can be checked for data prior to requesting data from the user data databases . In addition requests can be queued in the queue which can be implemented using Redis or similar technology.

The accounts database stores the identity of the user data database that stores the user data associated with each account identifier user name and can further store the VoIP MDN for each user.

The accounts database associates account identifiers with user data database identifier . The accounts database further associates VoIP identifier e.g. VoIP MDN with account identifier e.g. user name .

The user data database associates mobile network identifier e.g. mobile network MDN and mobile network usage with account identifier . The user data database can also associate push notification token with account identifier .

Some of the data stored within the user data database represents a communications history that can include indications of communications events including call histories SMS MMS message transmission histories and SMS MMS message content. The routing engine writes indications of communications events to the user data database in response to incoming communications events. In some implementations the user data database can further store indications of website access chat messages history audio video stream access voicemail chat MMS images email attachments among other data events. Communications events may be associated with to remote storage such as that provided by Amazon. In particular binary assets associated with communications events e.g. MMS images can be stored remotely with the user data database storing unique identifiers such as URIs identifying the locations of the binary assets.

Communications events are handled based on various identifiers with the account identifier acting as a master identifier for the communications routing system . The routing engine receives such communications events from mobile communications devices via the wide area IP network . Hence a core principle of operation of the routing engine is to identify the source of a received communications event and identify a destination if any for the communications event. Actions discussed herein with respect to the account identifier can be performed based on the associated session identifier .

Initially a user logs in to a client program at one of the mobile communications devices . This can be achieved using log in credentials that are stored at and verified by the communications routing system . Each account identifier is associated with a set of log in credentials and this can be implemented as a user name and password combination. The routing engine can be configured to respond to a log in communications event bearing an account identifier and user entered log in credentials by verifying the user entered log in credentials with the credentials stored at the communications routing system to authenticate the user to the account identifier .

Responsive to a successful authentication the routing engine can initiate a session. The session identifier can be stored at the communications routing system such as in the user data database as well as at the mobile communications device to be used with successive communications events to identify the relevant account.

The session identifier is used by the mobile communications device to communicate with the communications routing system to initiate communications events and obtain or modify data stored in the user data database . In some implementations the push notification token is used for downlink communications from the communications routing system to the mobile communications device and the push notification service handles routing to the mobile communication device . In other implementations regarding downlink communications the accounts database or user data database can store network information that can specify an IP address a media access control MAC address a session identifier a combination of such or similar. For example a persistent socket connection can be maintained between the communications routing system and each mobile communication device . The routing engine can be configured to use the network information when routing communications to the mobile communications device so as to route to the correct one of the mobile network and WLAN depending on where the mobile communications device was last seen.

Incoming communications events may specify one or more destination mobile communications device using the VoIP identifier . When the routing engine routes the communications event to a destination mobile communications device the routing engine can reference the databases to determine a destination account identifier and thus the destination push notification token or other network information for downlink communications.

The routing engine writes indications of communications events to the user data database in response to incoming communications events. Event type as well as event data can be stored. Event type indicates the type of communications event such as calls e.g. placed answered missed ended incoming and outgoing SMS messages and similar. Event data can include an account identifier or name telephone number etc. of the other party SMS message content and the like. Hence call histories SMS message transmission histories and SMS message content can be stored. In addition any request or response for general data can be stored as discussed above.

The user data database can also store a prepaid balance for each user account. Balance may be stored as monetary amount voice call time data amount e.g. GB similar quantity or a combination of such. The routing engine can be configured to reduce prepaid balance for a particular account identifier based on mobile network usage based on tracked times of VoIP calls as tracked by the VoIP service and or the system based on other usage metrics or based a combination of such. In various implementations the routing engine can be configured to deny initiation of a voice call requested by a particular mobile communications device associated with a depleted balance when the particular mobile communications device is only connected to the mobile network and not the WLAN . In various implementations the routing engine can allow a voice call requested by the particular mobile communications device with the depleted balance when such device is connected to the WLAN . Balances can be increased based on purchase of prepaid credit via a designated type of communications event to which the routing engine responds or via a web interface available via the wide area IP network .

The communications routing system can further store authentication information as required by the mobile network to permit access to mobile data service for the mobile communications devices . Such authentication information may include one or more parameters to maintain a secure direct connection a pre specified address port general log in credentials one or more certificates a combination of such or similar. The communications routing system can access the mobile network via an API exposed by the mobile network . Alternatively a server in the mobile network can access the communications routing system via an API exposed by the communications routing system . Authentication information can be communicated between the routing engine and the mobile network as needed. In some implementations the mobile network sends mobile network usage data for each mobile network MDN periodically e.g. every 5 minutes via FTP to the communications routing system for update at the user data database . A script at the communications routing system can be configured to digest the mobile network usage information and update the user data database accordingly.

The data structure shown in also includes contact information fields stored in the user data database . Contact information fields include names and other details of a user s contacts. Contacts information can include telephone number for each contact which can be a VoIP MDN in network contacts or any other telephone number out of network contacts . Other data as discussed elsewhere herein can also be stored in the user data database and accounts database .

The mobile communications device includes a processor memory a mobile wireless interface an IEEE 802.11 Wi Fi interface a display a user input interface and a global positioning system GPS chipset . The processor memory mobile wireless interface Wi Fi interface display user input interface and GPS are electrically interconnected and can be physically contained within a small portable housing. The mobile communications device can include other components such as a battery which are omitted from view for clarity. The mobile communications device is an illustrative example of a smartphone or mobile phone suitable for use with the system discussed herein. Other examples should be apparent.

The processor is configured to execute instructions which may originate from the memory the mobile wireless interface or the Wi Fi interface . The processor may be known a CPU. The processor can include one or more sub processors or processing cores.

The memory includes a non transitory computer readable medium that is configured to store programs and data. The memory can include one or more short term or long term storage devices such as a solid state memory chip e.g. DRAM ROM non volatile flash memory a hard drive and similar. The memory can include fixed components that are not physically removable from the mobile communications device as well as removable components e.g. removable memory cards . The memory allows for random access in that programs and data may be read and written.

The mobile wireless interface can include a chipset such as an LTE chipset or similar and one or more antennas suitable for communication with the mobile network . Such a chipset may be only be configured for data communications. In some implementations the mobile communications device advantageously omits any chipset for known circuit switched communications. The mobile wireless interface may further include a subscriber identity module SIM card interface and SIM card or similar device capable of storing a mobile identifier such as an MDN.

The Wi Fi interface includes one or more adaptors and antennas configured to communicate with the WLAN . Such adaptors antenna can be compatible with one or more IEEE 802.11 protocols.

In various implementations described herein selection of the mobile wireless interface or the Wi Fi interface as the interface through which to conduct a VoIP call or communicate other communication events can be made by the VoIP service the proxy the push notification service or the like.

The display and user input interface can include a touch screen speaker microphone keypad and the like suitable for user input and output of commands voice sound images video and similar.

The GPS chipset can include a suitable antenna and support circuitry for collecting GPS satellite signals and calculating position based on same.

A data access interface is a client program stored in the memory and executable by the processor . The data access interface is configured to communicate with the communications routing system by specifying an address such as an IP address of the communications routing system on the wide area IP network . The data access interface can be configured to require authentication e.g. via user name and password with the communications routing system before allowing other applications at the mobile communications device access to the mobile network or WLAN . The data access interface is configured to communicate data with the mobile network and the WLAN via the respective interface and provide data services to applications.

A communications client program is stored in the memory and executable by the processor . The communications client program can be configured to implement any or all of the client side functionality discussed herein. The communications client program can include a call prioritizer module a phone module an SMS MMS module and a client database . The communications client program can be implemented using the model view controller MVC software architectural pattern.

The call prioritizer module provides an interface to applications and modules traditionally associated with circuit switched applications such as a phone module and an SMS MMS module . The call prioritizer module can be configured to assign priorities to requests made by other applications and modules. Such priorities can be mapped to QoS settings at the mobile network the WLAN and the proxy . For example a 911 call made through the phone module can be detected as such by the call prioritizer module which is configured to assign maximum priority to such a call and to place such a call through any available network. As the mobile network may only provide data services and or the device may lack a circuit switched chipset the specified priority is passed to the data access interface which passes same to the available network to ensure that the 911 call is given suitable network priority. The data access interface may further be configured to provide GPS and other enhanced 911 information to the network during the emergency call.

In other embodiments in which a circuit switched chipset and network e.g. CDMA are used the call prioritizer module is configured to route 911 calls through the circuit switched network and to provide GPS and other enhanced 911 information via the circuit switched network.

The call prioritizer module can also be configured to perform a speed test using the proxy if appropriate to determine whether available data throughput rate is sufficient to make a VoIP call. The measured throughput rate can be a condition for allowing a VoIP call or can be used as input to configure an audio codec. In implementations that use a circuit switched chipset if a VoIP call is requested and the throughput rate is insufficient then the call can be routed through the circuit switched chipset.

The phone module is a client program stored in the memory and executable by the processor . The phone module can be configured to support SIP or other protocol for call initiation and call ending for VoIP telephony. The phone module can include a VoIP client such as that available from Acrobits of Prague Czech Republic. Generally the phone module can issue call commands and respond to call commands via the interfaces . For initiation of VoIP calls the phone module can be configured to perform a SIP registration with the VoIP service . For receiving VoIP calls under Android or similar operating system the phone module can be configured to respond to push notifications received via the interfaces by initiating a SIP registration so as to preserve battery life by avoiding unnecessary SIP registrations that may be otherwise needed for keep alive SIP registration. Alternatively the phone module can be configured to periodically initiate a SIP registration. For receiving VoIP calls under iOS or similar operating system the phone module can be configured to initiate a SIP registration when control is passed to the communications client program such as after the user has responded to a push notification alert. The phone module can be configured to present a conventional circuit switched mobile phone dialing and answering interface to the user. In some implementations the phone module and the call prioritizer module can be distinct applications.

An SMS MMS module can be stored in the memory and executable by the processor to provide an interface for inputting reading sending and receiving SMS and optionally MMS messages. The SMS MMS module accesses the mobile network and WLAN via the data access interface and the respective interface . The SMS MMS module can be configured to present a conventional circuit switched SMS input and output interface to the user.

The client database stores communications event data locally at the mobile communications device . As communications events are composed and sent from communications client program local copies of such communications events can be stored in the client database for reference by the user of the mobile communications device . Similarly as communications events are received at the communications client program local copies of such communications events can be stored in the client database for reference by the user.

A web browser and other applications are client programs stored in the memory and executable by the processor . The web browser and other applications are configured to use the data access interface to communicate data with the mobile network and the WLAN via the respective interface . Examples of other applications include a chat application an email application a social networking client application a video streaming application and an Internet radio application. One or more of such applications may also be modules of the communications client program .

Mobile communications devices communicate with the one or more WLANs using the Internet Protocol. Such communications can include SMS data call control commands call data and general data . Mobile communications devices can be assigned a WLAN identifier such as an IP address or other identifier discussed elsewhere herein to facilitate such communication with the WLAN .

SMS data can include source and destination indicators such as telephone number as well as message content. SMS data is also representative of MMS data when implemented. Because the SMS data is transported using IP packets the SMS data can be provided in a data structure different from SMS standards such as SMPP.

Call control commands can include commands issued by a mobile communications device to initiate or end a call with another mobile communications device a stationary communications device or a different type of mobile communications device such as those not configured for communications routing via the communications routing system . Call control commands can also include commands exchanged between the VoIP service and a mobile communications device to initiate or end a call. A call control command can include a telephone number of a receiving party. Call control commands can flow in either direction and can include SIP commands.

Call data includes VoIP data carrying audio information such as digitized voice signals that is the VoIP call itself. Call data flows bidirectionally between the mobile communications devices and the WLAN . Various codecs such as Opus can be used.

General data includes other kinds of data and control information including requests for webpages webpage content email messages chat messages social media information and communications video data audio data file transfers and similar. General data flows bidirectionally between the mobile communications devices and the WLAN .

The communications routing system communicates with the mobile communications devices via the WLAN . In this way SMS data and general data can be communicated between the communications routing system and the mobile communications devices . In some implementations such as that depicted call control and call data are communicated between the WLAN and the VoIP service bypassing the communications routing system . In other implementations call control and or call data can flow through the communications routing system .

Authentication information such as log in credentials session identifiers and the like is also communicated between the communications routing system and the mobile communications devices . This allows only authorized mobile communications devices to access the communications routing system and provide for identity verification of users of the system.

The communications routing system communicates with the mobile network using the Internet Protocol via the interoperation service . The communications routing system can be configured to perform any necessary format conversion of SMS data and general data received via the WLAN for transmission to the mobile network as SMS data and general data in formats intelligible by the mobile network . Conversely the communications routing system can be configured to perform any necessary format conversion of SMS data and general data received via the mobile network for transmission to the WLAN as SMS data and general data .

The communications routing system can be configured to determine whether an outgoing SMS or MMS message contained in SMS data is directed to a mobile communication device having an account with the communications routing system . This can be achieved by checking the destination phone number against the databases . The communications routing system stores SMS MMS messages and sends push notifications to destination mobile communications devices to fetch stored messages when the destination phone number is present in the user data databases . The communications routing system directs outgoing SMS message as SMS data to the interoperation service when the destination phone number is not present in the user data databases . The interoperation service sends such messages as standard SMS messages to the destination mobile communication device .

Authentication and usage information can also be communicated between the communications routing system and the mobile network . This allows only the communications routing system to control access to the mobile data service . Authentication information such as a session identifier and an authentication key can be used. Usage information can include data usage amounts for each MDN assigned to the mobile communications devices . In some embodiments the communications routing system stores a maximum allowable data usage amount for each mobile communications device and initiates a deactivation process with the mobile network for any mobile communications device that is determined by the communications routing system to have exceeded its maximum allowable data usage amount.

Call control commands and call data which are similar to commands and data can flow between the VoIP service and the mobile network for communications devices connected to the mobile network .

The communications routing system can also be configured to receive call information from the VoIP service . Such call information can include call connection information and polls. The communications routing system can store call connection information e.g. call completed call ended missed call etc. in the user data database to track call histories. The VoIP service can be configured to poll the communications routing system when a call is requested so that the communications routing system can send a push notification to the destination mobile device to notify the user at the destination mobile device of the incoming call. The destination mobile device registers with the VoIP service which then passes relevant call connection information to the communications routing system .

The mobile communications devices are configured to communicate with the mobile network over the mobile data service . Data can be allocated to each mobile communications device using mobile network identifiers e.g. MDN . Alternatively data can be collectively allocated to all mobile communications device and tracked metered or limited using mobile network identifiers e.g. MDN . SMS MMS data call control commands call data and general data can be communicated between the mobile communications devices the mobile network . Such data can be in the same format as the data communicated via the WLAN . Advantageously mobile data service provides only data as opposed to data and circuit switched services e.g. voice minutes and SMS which can simplify operation of the system and increase efficiency.

The communications routing system can be configured to calculate and or store call length e.g. in minutes seconds etc. from call information received from the VoIP service . In some implementations call information includes call length.

In some implementations prepaid balances of the mobile communications devices are reduced based on call data routed through the mobile network while prepaid balances are not reduced based on call data routed through the WLAN . The VoIP service can be configured to request the communications routing system as call information to determine whether a call should be connected or be allowed to continue as the case may be. Periodic requests can be made for calls in progress. The communications routing system can be configured to end or deny call when a particular calling party s balance is depleted. In some implementations calls can be permitted via the WLAN irrespective of balance depletion.

The communications routing system can be configured to provide push notifications to the push notification service in response to call control commands requesting initiation of new calls. Such a push notification is issued by the push notification service to the receiving party s mobile communication device which contains the phone module that is configured to perform a SIP registration is response to such trigger. Push notifications can arrive as data via the WLAN or as data via the mobile network depending on how the destination mobile communications device is available.

The other mobile communications devices do not have accounts with the communications routing system and thus connect to the mobile network or another mobile network as is known. Hence SMS messages call control commands voice calls and general data can be communicated between the mobile communications devices and the mobile network .

As should be apparent from the above communications and are generally performed using the Internet Protocol that is in the IP domain . Such communications can be facilitated by the wide area IP network or similar IP network. Communications and between the mobile communications devices and the mobile network can be performed according to other standards and protocols.

In view of the above it should be apparent that the advantages of the communications routing system include centralized routing and tracking of all communications of the mobile communications devices where such communications are performed in the IP domain to the extent possible. In addition mobile charges need only be tracked for usage via the mobile data service which can simplify metering and billing. Voice call metering and billing can be based on data usage as measured at the mobile network VoIP call minutes as measured at the VoIP service or a combination of such. Further data usage need not be tracked or metered when conducted over the WLAN as such data is offloaded to the operator of the WLAN . This can simplify the system and lead to greater efficiency.

The mobile network includes an Evolved Packet Core EPC a Home Subscriber Server HSS a Packet Data Network PDN an IP Multimedia Subsystem IMS a 3G Packet Switched Core a 3G Circuit Switched Core an S1 Interface an Iu Interface an Evolved Universal Terrestrial Radio Access Network E UTRAN and a UTRAN .

The EPC represents the core LTE network and is configured for the overall control of the mobile communications devices and establishment of bearers. The EPC includes a Mobility Management Entity MME a Serving Gateway a Policy Control and Charging Rules Function PCRF and a Packet Data Network Gateway PDN GW .

The MME is configured for subscriber and session management including security procedures device to network session handling e.g. setting up packet data context negotiating QoS etc. and idle device location management.

The PCRF is configured to manage service policy and charging. The PCRF can be configured to allow or deny incoming media requests of the mobile communications devices with the IMS select or initiate a PDP context for each incoming request and enforce resource limits. The PCRF can also be configured to execute operator defined charging rules for service data flow based on for example application type of stream e.g. audio video etc. data rate and the like.

The PDN GW includes an interface for the EPC to communicate with one or more IP networks such as the PDN and the wide area IP network . The PDN GW can be configured to allocate IP addresses to mobile communications devices manage access charges and permissions for mobile communications devices to access the wide area IP network and perform user based packet filtering and inspection.

In the example shown the mobile network includes the PDN that connects the PDN GW to the wide area IP network . The PDN can be controlled by the operator of the mobile network and can serve local webpages and other information to a mobile communications device regardless of whether the mobile communications device is permitted to access the wide area IP network .

The PDN GW and the PDN form the interface for communication of data with the communications routing system via the interoperation service and for communication of notifications from the push notification service respectively .

The HSS stores and manages user subscription information providing services to the EPC and the 3G Cores for handling calls and sessions. The HSS is configured to store and update a database containing user subscription information including user identification and addressing information such the IMSI and MSISDN a.k.a. mobile telephone number . Such database can further contain user profile information such as service subscription information and user subscribed Quality of Service QoS information e.g. bit rate limits traffic class . The HSS can further be configured for generating security information from user identity keys for mutual network terminal authentication radio path ciphering and integrity protection so as to ensure data and signalling transmitted between the EPC and the mobile communications devices is secure.

The IMS is a framework for delivering IP multimedia services to the mobile communications devices via the UTRAN and the E UTRAN . The IMS includes a Media Gateway Controller MGC a Media Gateway MGW and various Call Session Control Functions CSCF such as a Proxy CSCF P CSCF a Serving CSCF S CSCF and an Interrogating CSCF I CSCF which can include respectively a SIP proxy a SIP server and controller and a SIP interrogating function. The MGC includes a SIP endpoint configured for call control protocol conversion between SIP and protocols e.g. ISUP and BICC used by the PSTN . The MGC controls the resources of the MGW . The MGW is configured to convert the different transmission and coding techniques used in the PSTN and in the EPC and wide area IP network . The IMS is the interface for communicating VoIP call data with the VoIP service .

The 3G Packet Switched Core includes a Serving GPRS Support Node SGSN and a Gateway GPRS Support Node GGSN . The SGSN is configured as the interface between the radio system and the fixed network for packet switched services and to handle packet transmission to from the relevant mobile communications devices . The SGSN stores subscription and location information including the cell or routing area for each relevant mobile communications device . The GGSN is configured as a gateway between a GPRS wireless data network and other networks such as the PDN . The GGSN stores subscriber data received from the HSS and the SGSN as well as the address of the SGSN where each relevant mobile communication device is registered.

The 3G Circuit Switched Core includes a Mobile Switching Centre and Visitor Location Register MSC VLR as well as a Gateway Mobile Switching Centre GMSC . The MSC is an interface between the radio system and the fixed network and is configured to handle circuit switched services to from the relevant mobile communications devices . The VLR includes a database configured to store information about mobile communications devices that are under the jurisdiction of the MSC. The GMSC connects the 3G Circuit Switched Core with the PSTN .

The S1 Interface is the interface between the E UTRAN and the EPC . The S1 Interface can be configured for exchange of signaling messages between the E UTRAN and the MME and for transport of user datagrams between the E UTRAN and the Serving Gateway .

The E UTRAN contains a plurality of base stations or eNodeBs that provide for wireless communication with the mobile communications devices .

The Iu Interface is configured to carry user traffic e.g. voice and data as well as control information between the UTRAN and the 3G Cores .

The UTRAN contains a plurality of base stations or NodeBs which provide for wireless communication with the mobile communications devices . The UTRAN further includes Radio Network Controllers RNCs which control the NodeBs .

The PDN can include SMSC MMSC and SMS MMS gateway for receiving SMS MMS data from the communications routing system via the interoperation service for sending as SMS messages destined for the mobile communications devices not associated with the communications routing system . Likewise the communications routing system can access SMS messages via the interoperation service destined for the mobile communications devices via the SMS gateway as SMS data .

The techniques discussed above show that evolving mobile network technologies such as LTE can be made available to prepaid users in a simplified efficient and efficient manner using the Internet Protocol. In addition a reduced deployment of physical infrastructure is required. Further more efficient spectrum usage can be realized.

While the foregoing provides certain non limiting example implementations it should be understood that combinations subsets and variations of the foregoing are contemplated. The monopoly sought is defined by the claims.

