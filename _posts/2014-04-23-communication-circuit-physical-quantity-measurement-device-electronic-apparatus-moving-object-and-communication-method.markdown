---

title: Communication circuit, physical quantity measurement device, electronic apparatus, moving object, and communication method
abstract: A communication circuit (an interface section) includes an input section (a input shift register) to which a data signal is input, an output section (and output shift register) adapted to output a reply signal in a case in which the data signal is input, and a command determination section adapted to perform propriety determination of a command signal included in the data signal, and the output section outputs a negative acknowledgement signal as the reply signal in a case in which it is determined in the propriety determination that the command signal is improper.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09413631&OS=09413631&RS=09413631
owner: Seiko Epson Corporation
number: 09413631
owner_city: 
owner_country: JP
publication_date: 20140423
---
The present invention relates to a communication circuit a physical quantity measurement device an electronic apparatus a moving object a communication method and so on.

In recent years devices having an interface compliant with the IC bus communication protocol using the IC a registered trademark using a master slave system have become widely used. The IC bus is composed of two serial buses formed of one clock signal line and one data signal line and by connecting one master device and a plurality of slave devices to these signal lines a high speed data communication system can be established at low cost. In for example JP A 2012 32262 there is described the fact that the IC bus can be adopted as a bus for a sensing device.

In the IC bus communication protocol the master device has the initiative of the data communication and performs the data communication with one of the slave devices connected to the IC bus. Since the master device is not allowed to perform the data communication with a plurality of slave devices at the same time a command signal output by the master device includes an address value ID called a slave address for identifying each of the slave devices. Then when the slave device having the own ID equal to the slave address included in the command signal output by the master device sends an ACK signal ACKnowledgement signal back to the master device the data communication is thereafter performed between the master device and that slave device.

Here JP A 2009 105731 discloses a data communication system including a communication control device to thereby make it possible to connect a plurality of slave devices having the same address values while using the IC bus communication protocol.

Here in order to perform the reliable communication it is preferable to perform a propriety determination of the command signal from the master device namely to determine whether or not the command signal includes an error. Further if there is an error in the command signal it is preferable for the slave device to immediately notify the master device in order to realize a high speed data communication system. This is because if the master device immediately receives the error notification a response such as retransmission becomes possible. However in the related art transmission compliant with the IC bus communication protocol the slave device is not allowed to notify the master device of the occurrence of the error unless the slave device newly receives the command signal for determining presence or absence of the error from the master device.

An advantage of some aspects of the invention is to provide a communication circuit a physical quantity measurement device an electronic device a moving object a communication method and so on capable of performing the data communication based on the communication protocol using the maser slave system and immediately notifying the master device of an abnormality of the command signal.

A communication circuit according to this application example includes an input section to which a data signal is input an output section adapted to output a reply signal in a case in which the data signal is input and a command determination section adapted to perform propriety determination of a command signal included in the data signal and the output section outputs a negative acknowledgement signal as the reply signal in a case in which it is determined in the propriety determination that the command signal is improper.

The communication circuit according to this application example is a communication circuit of a slave device for receiving the command signal from a master device. Further the communication circuit according to this application example includes the input section the output section and the command determination section. The command determination section performs the propriety determination of the command signal. For example whether or not a code a combination of 0 and 1 of the command signal is compliant with the specification is determined.

The output section outputs the result of the propriety determination of the command signal namely the negative acknowledgement signal due to the determination section to the master device.

On this occasion the master device can immediately be notified of the fact that the command signal is improper by the negative acknowledgement signal from the communication circuit according to this application example immediately after outputting the command signal. Therefore in the case in which for example the code of the command signal is wrong it is possible for the master device to make a response such as retransmission of the command signal with the code corrected. On this occasion the master device is not required to additionally output a command signal to perform the propriety determination of the command signal and thus the communication quick in response can be realized.

In other words the communication circuit according to this application example can immediately notify the master device of the defect of the command signal while performing the data communication based on the communication protocol using the master slave system.

A communication circuit according to this application example includes an input section to which a data signal is input an output section adapted to output a reply signal subsequently to the input and a command determination section adapted to perform propriety determination of a command signal included in the data signal and the output section outputs a negative acknowledgement signal as the reply signal in a case in which it is determined in the propriety determination that the command signal is improper.

The communication circuit according to this application example outputs the result of the propriety determination of the command signal namely the negative acknowledgement signal due to the determination section to the master device subsequently to the input.

On this occasion the master device can immediately be notified of the fact that the command signal is improper by the negative acknowledgement signal from the communication circuit according to this application example immediately after outputting the command signal. Therefore in the case in which for example the code of the command signal is wrong it is possible for the master device to make a response such as retransmission of the command signal with the code corrected. On this occasion the master device is not required to additionally output a command signal to perform the propriety determination of the command signal and thus the communication quick in response can be realized.

In other words the communication circuit according to this application example can immediately notify the master device of the defect of the command signal while performing the data communication based on the communication protocol using the master slave system.

In the communication circuit according to the application example described above the output section may output the negative acknowledgement signal in a case in which the command signal designates a non existent register address.

In the communication circuit according to the application example described above the output section may output the negative acknowledgement signal in a case in which the command signals are input to the input section in a sequence different from a proper sequence of a plurality of command signals constituting a connected command.

In the communication circuit according to the application example described above the connected command may correspond to software reset signal.

In the communication circuit according to the application example described above the connected command may correspond to a diagnostic command signal.

In the communication circuit according to this application example the command determination section may make a determination that the command signal is improper in the case in which the command signal designates a non existent register address as the propriety determination of the command signal. Further the command determination section may make a determination that the command signal is improper in the case in which a part of the command signals constituting the connected command used for preventing the false recognition in for example the software reset is input in a sequence different from the proper sequence. Further the command determination section may make a determination that the command signal is improper in the case in which a part of the command signals constituting the diagnostic command signal is received in a sequence different from the proper sequence. Then the output section may output the negative acknowledgement signal to the master device in the case in which the command determination section determines that the command signal received is improper.

On this occasion the communication circuit according to this application example outputs the negative acknowledgement signal not only due to for example the mismatch in the slave address but also in the case in which the defect in the code of the command signal or the defect in the sequence for receiving the command signals is detected. Therefore it is possible for the communication circuit according to this application example to immediately notify the master device of the defect in the command signal and to realize the communication quick in response.

In the communication circuit according to the application example described above the command determination section may perform the propriety determination based on a mode determined by the command signal and the command signal.

In the communication circuit according to this application example the command determination section is provided with a mode determined by the type of the command signal in execution. Further the propriety determination can efficiently be performed based on the mode and the type of the command signal received.

For example it is assumed that the command determination section can select a mode hereinafter referred to as a first mode corresponding to a command signal hereinafter referred to as a register read command signal for reading out the data of the register of the slave device and a mode hereinafter referred to as a second mode corresponding to a diagnostic command signal as an operation mode also referred to simply as a mode . It is assumed that the command signal one of the diagnostic command signals for requiring the output of the diagnostic data is received in the case in which the mode of the command determination section is set to the first mode. On this occasion since the command signal is the command mode which should be received in the case of the second mode and the mode fails to match the present mode namely the first mode the determination section can determine the command signal received is improper. As described in this example the communication circuit according to this application example can efficiently perform the propriety determination based on the modes and the types of the command signals.

In the communication circuit according to the application example described above the output section may output an acknowledgement signal as the reply signal in a case in which it is determined in the propriety determination that the command signal is proper.

In the communication circuit according to the application example described above the input section may perform the input in accordance with an IC communication protocol the acknowledgement signal may correspond to an ACK signal in the IC communication protocol and the negative acknowledgement signal may correspond to an NACK signal in the IC communication protocol.

In the communication circuit according to this application example the output section outputs the acknowledgement signal or the negative acknowledgement signal to the master device in accordance with the result of the propriety determination of the command signal namely the determination that the command signal is proper or improper made by the determination section.

On this occasion even in the case in which the master device is compliant with for example the IC bus communication protocol using the half duplex communication the master device can immediately know the fact that the command signal is improper using the acknowledgement signal e.g. the ACK signal of the IC bus communication protocol or the negative acknowledgement signal e.g. the NACK signal of the IC bus communication protocol from the communication circuit according to this application example immediately after outputting the command signal. Therefore in the case in which for example the code of the command signal is wrong it is possible for the master device to make a response such as retransmission of the command signal with the code corrected. On this occasion the master device is not required to additionally output a command signal to perform the propriety determination of the command signal and thus the communication quick in response can be realized.

In other words the communication circuit according to this application example can immediately notify the master device of the defect of the command signal while performing the data communication based on the communication protocol using the master slave system.

A physical quantity measurement device according to this application example includes the communication circuit according to any one of the application examples described above and a sensor element adapted to output a detection signal corresponding to a physical quantity.

An electronic apparatus according to this application example includes the communication circuit according to any one of the application examples described above.

A moving object according to this application example includes the communication circuit according to any one of the application examples described above.

According to the physical quantity measurement device the electronic apparatus and the moving object related to this application examples since the communication circuit described above is included it is possible to determine whether or not the command signal includes an error and then immediately notify the master device even if the error exists. Therefore the physical quantity measurement device the electronic apparatus and the moving object each high in reliability and quick in response can be realized.

A communication method according to this application example includes inputting a data signal performing propriety determination of a command signal included in the data signal and outputting a reply signal in a case in which the data signal is input and in the outputting a negative acknowledgement signal is output as the reply signal in a case in which it is determined in the propriety determination that the command signal is improper.

The communication method according to this application example is a communication method of a slave device for receiving the command signal from a master device. Even in the case in which the master device is compliant with for example the IC bus communication protocol using the half duplex communication the master device can immediately know whether or not the command signal is proper using the negative acknowledgement signal of the communication method according to this application example immediately after outputting the command signal. Therefore in the case in which for example the code of the command signal is wrong it is possible for the master device to make a response such as retransmission of the command signal with the code corrected. On this occasion the master device is not required to additionally output a command signal to perform the propriety determination of the command signal and thus the communication quick in response can be realized.

In other words the communication method according to this application example can immediately notify the master device of the defect of the command signal while performing the data communication based on the communication protocol using the master slave system.

Hereinafter a preferred embodiment of the invention will be described in detail with reference to the accompanying drawings. It should be noted that the embodiment described below does not unreasonably limit the contents of the invention as set forth in the appended claims. Further all of the constituents described below are not necessarily essential elements of the invention.

The interface section of the physical quantity measurement device and the master device are connected to each other with a serial bus and a serial bus . The interface section receives a clock signal from the master device with the serial bus . Further the interface section receives a command signal from the master device and outputs for example data required with the serial bus . In other words the serial bus is a bus for performing bidirectional data communication. Although in the present embodiment the interface section of the physical quantity measurement device and the master device perform communication in accordance with the IC bus communication protocol the communication protocol is not limited thereto but it is also possible to use a communication protocol in accordance with another master slave system. It should be noted that in terminals an SCL input terminal and an SDA input output terminal of the physical quantity measurement device described later are omitted from the graphical description.

In the data communication system shown in an SCL output terminal of the master device is connected to the SCL input terminals of the physical quantity measurement device and the slave devices and via the serial bus . Further the SDA input output terminal of the master device is connected to the SDA input output terminals of the physical quantity measurement device and the slave devices and via the serial bus . Further the serial buses are connected to a power supply via pull up resistors respectively.

The master device functions as a master in the IC bus communication protocol and the physical quantity measurement device and the slave devices and function as slaves in the IC bus communication protocol. In other words the master device has an initiative of the data communication. When performing the data communication the master device outputs transmits a clock signal from the SCL output terminal to the serial bus . When the master device does not output the clock signal from the SCL output terminal the serial bus is released and is therefore pulled up to a high level potential a power supply potential via the resistor .

The master device the physical quantity measurement device and slave devices and can output transmit the data signal to the serial bus via the SDA input output terminal and can also input the data on the serial bus . Here the data output from the master device is hereinafter referred to as command data in order to distinguish the data from other data from the slave devices. It should be noted that when neither of the master device the physical quantity measurement device and the slave devices and outputs the data to the serial bus the serial bus is released and is therefore pulled up to the high level potential the power supply potential via the resistor .

Until the data communication is started the serial bus and the serial bus are both pulled up to the high level potential. In the case of starting the data communication the master device makes a transition of the serial bus from the high level to a low level a start condition when the serial bus the clock signal is in the high level. After executing the start condition the master device outputs a predetermined command signal to thereby perform the data communication with the physical quantity measurement device and the slave devices and . In the case of terminating the data communication the master device makes a transition of the serial bus from the low level to the high level a stop condition when the serial bus the clock signal is in the high level.

Referring again to the physical quantity measurement device will be explained. The physical quantity measurement device includes a sensor element a drive section a detection section an operation setting section and a fault diagnosis section besides the interface section .

The sensor element includes for example vibrators integrated with each other to detect an angular velocity. Here a signal corresponding to the magnitude of the angular velocity and output by the sensor element is referred to as a detection signal. In the detection signal corresponds to differential signals . It should be noted that the detection signal can also be a single ended signal.

The drive section generates a drive signal and then supplies the drive signal to the vibrator and receives an excitation current from the vibrator to form an oscillation loop. The magnitude of the differential signals is proportional to the excitation current . Therefore the drive section controls the drive signal so that the amplitude of the excitation current becomes constant irrespective of a change in the measurement environment.

The detection section generates an output signal based on the differential signals . The output signal is output to the master device via the interface section . It is also possible for the detection section to receive the differential signals and perform for example a conversion into a format required by the master device to generate the output signal .

The operation setting section is capable of setting the operation of the drive section and the detection section . The operation setting section performs voltage setting and parameter setting of the drive section and the detection section and so on to thereby perform optimization corresponding to the operation environment. It should be noted that it is also possible for the master device to provide the operation setting section with instructions via the interface section .

The fault diagnosis section performs a fault diagnosis on at least one of the drive section and the detection section . In the present embodiment the fault diagnosis is performed on both of the drive section and the detection section . The fault diagnosis section receives internal signals representing the states of the drive section and the detection section to perform the fault diagnosis.

A fault diagnosis signal represents the result of the fault diagnosis performed by the fault diagnosis section . The fault diagnosis signal can also be a signal of several bits representing respective results each set to for example the high level 1 at an error of the fault diagnoses performed by the fault diagnosis section . The fault diagnosis signal can be output to the master device via the interface section .

Here the drive section the detection section the operation setting section and the fault diagnosis section a circuit group shown in except the sensor element are reset by a software reset signal . The software reset signal becomes active when the interface section receives the command signal software reset from the master device a plurality of times. In other words the software reset is a connected command signal the command of which is not executed unless a plurality of command signals is received in a predetermined sequence.

Hereinafter types and communication procedures of the command signals the interface section receives from the master device will be explained.

It should be noted that in the same applies to only the data including the command signals on the serial bus are shown and the clock signal on the serial bus is omitted. Further for the sake of easy understanding the data on the serial bus is displayed so as to be separated into the output of the master device and the output of the physical quantity measurement device . Further the number of bits is shown below each of the names of the data including the command signals . The data of 1 bit takes 0 or 1. For example a 7 bit slave address takes a value such as 0101111 and the serial bus changes to the low level corresponding to 0 or to the high level corresponding to 1. 

As shown in the master device executes the start condition S START in and then outputs the data signal including a 7 bit slave address for designating the physical quantity measurement device and a write signal W WRITE in . It should be noted that the write signal is specifically in the low level and a read signal described later is in the high level. In the case in which the correct slave address is designated the physical quantity measurement device outputs the ACK signal A ACK in as a reply signal. It should be noted that the ACK signal is specifically in the low level and an NACK signal Negative ACKnowledgement signal described later is in the high level.

Then the master device outputs the data signal including an eight bit register address to designate the register to be read. In the case in which the register address thus designated exists the physical quantity measurement device outputs the ACK signal as the reply signal.

Subsequently the master device executes a restart condition RS RESTART in and then outputs the 7 bit slave address for designating the physical quantity measurement device and the read signal R READ in . In the case in which the correct slave address is designated the physical quantity measurement device outputs the ACK signal as the reply signal. It should be noted that the restart condition is the same as the start condition and therefore the explanation thereof will be omitted.

Then the physical quantity measurement device outputs the data 16 bit register data in this example of the register address thus designated in twice. The master device outputs the ACK signal as the reply signal in the case in which the first data the first 1 byte has been received correctly and then outputs the NACK signal N NACK in as the reply signal after the second data the last 1 byte has been received. Then the master device executes the stop condition P STOP in to terminate the communication with the physical quantity measurement device .

Here the diagnostic command signal can output the diagnostic data when receiving a plurality of command signals in a predetermined proper sequence. As the diagnostic command signals according to the present embodiment there can be cited a start command for providing the fault diagnosis section with the pseudo signals and an output command signal for outputting the fault diagnosis signal which has been generated by the fault diagnosis section based on the pseudo signals to the master device . The physical quantity measurement device is required to receive the start command signal first and then receive the output command signal. In the case in which the sequence is not followed it is not allowed to generate and then output the fault diagnosis signal based on the pseudo signals.

The master device outputs the start command signal and then executes the stop condition after the physical quantity measurement device outputs the ACK signal. Subsequently the master device waits until the fault diagnosis section completes the fault diagnosis the waiting time shown in .

The master device outputs the output command signal and then executes the restart condition after the physical quantity measurement device outputs the ACK signal. Then the master device outputs the 7 bit slave address for designating the physical quantity measurement device and the read signal. In the case in which the correct slave address is designated the physical quantity measurement device outputs the ACK signal.

Then the physical quantity measurement device outputs the data 16 bit register data in this example of the fault diagnosis signal based on the pseudo signals stored in the storage section described later in twice. The master device outputs the ACK signal in the case in which the first data the first 1 byte has been received correctly and then outputs the NACK signal after the second data the last 1 byte has been received. Then the master device executes the stop condition to terminate the communication with the physical quantity measurement device .

Here is a diagram showing a configuration example of the fault diagnosis section and explains a relationship between the start command signal and the output command signal. The fault diagnosis section includes comparators CMP0 through CMP15 and compares the signals A B A B and so on representing the states of the operations of the drive section and the detection section and predetermined voltage values Vthrough Vwith each other. It should be noted that the signals A B correspond to the internal signal shown in and the signals A B correspond to the internal signal shown in .

Output signals COthrough COof the comparators CMP0 through CMP15 represent the results of the fault diagnosis and correspond to the fault diagnosis signal shown in . In this example the high level of each of the output signals COthrough COrepresents the fact that a fault has occurred and the low level thereof represents the fact that no fault has occurred but the state is normal.

Here when receiving the start command signal from the master device the physical quantity measurement device switches the signal TEST of the fault diagnosis section changes the state of the signal TEST from the low level to the high level to perform the fault diagnosis of the comparators CMP0 through CMP15 themselves. In the case in which the signal TEST shown in is in the high level voltage values Vthrough Vprepared in advance are input respectively to the comparators CMP0 through CMP15 instead of the signals A B A B and so on.

Then when receiving the output command signal from the master device the physical quantity measurement device outputs the fault diagnosis signal corresponding to the register data shown in namely the output signals COthrough COobtained using the voltage values Vthrough V. In other words if all of the bits of the 16 bit register data shown in are 0 corresponding to the low level the master device can determine that the comparators CMP0 through CMP15 operate normally.

Since the physical quantity measurement device stops operating it is necessary to avoid erroneously performing the software reset. Therefore the interface section does not set the software reset signal to the low level to reset the circuit group unless the command signal of the software reset is received continuously three times. For example even if the command signal of the software reset is accidentally received once the interface section never sets the software reset signal to the low level.

As shown in the master device executes the start condition and then outputs the 7 bit slave address for designating the physical quantity measurement device and the write signal. In the case in which the correct slave address is designated the physical quantity measurement device outputs the ACK signal.

The master device subsequently outputs the command signals of software reset 1 through software reset 5. In the case of receiving the command signals in the correct order the physical quantity measurement device outputs the ACK signal for each of the command signals. After the physical quantity measurement device outputs the ACK signal with respect to the software reset 5 the master device performs the stop condition.

On this occasion the interface section of the physical quantity measurement device sets the software reset signal to the low level to reset the circuit group at a time point tafter receiving the software reset 3 from the master device . Then the interface section resets the software reset signal to the high level at a time point tafter receiving the software reset 5 from the master device .

It should be noted that the codes combinations of 0 and 1 of the command signals of the software reset 1 through the software reset 5 can be the same as each other as in the present embodiment or can partially or wholly different from each other. Further the number of times of receiving the command signal of the software reset is not limited to five as in the present example but is sufficiently equal to or larger than two.

In the example shown in the explanation is presented assuming that no error is included in the command signal from the master device . However in the actual communication between the master device and the physical quantity measurement device it is possible that for example an erroneous command signal is output from the master device and that the signal level of a part of the command signal varies due to noise contamination of the communication path. Therefore in order to perform the reliable communication it is preferable for the interface section to perform the propriety determination of the command signal from the master device namely to determine whether or not the command signal includes an error.

Further in order to realize the high speed data communication system it is preferable for the interface section to immediately notify the master device of the fact that the command signal includes the error to ask the master device to make a response such as retransmission. Therefore in the case in which the command signal includes an error the interface section outputs the NACK signal to immediately inform the master device of the presence of the error.

The interface section includes an input shift register as an input section a command determination section the storage section buffers a selector and an output register .

The interface section converts the command signal received from the master device into a parallel signal a signal with the input register and then outputs the parallel signal to the command determination section .

The command determination section receives the command signal and then performs the propriety determination based on the mode determined by the type of the command in execution and the type of the command thus received. Details of the propriety determination of the command signal will be described later. The command determination section outputs a signal corresponding to the result of the propriety determination of the command signal to the output shift register .

Then the output shift register outputs the ACK signal NACK signal compliant with the normal IC bus communication protocol in the case in which it is determined that the command signal is proper or outputs the NACK signal in the case in which it is determined that the command signal includes an error.

The interface section takes a configuration in which the output shift register immediately outputs the NACK signal if the command determination section transmits the signal corresponding to the result of the propriety determination of the command signal to the output shift register and it is determined that the command signal is not appropriate. Therefore the interface section can immediately notify the master device of a defect in the command signal while performing the communication compliant with the IC bus communication protocol.

In particular in the case in which the communication protocol is the communication protocol e.g. the IC bus communication protocol using the master slave system as in the present embodiment the following can be said. That is in the case in which it is determined that the command signal is not appropriate the NACK signal is output as the reply signal to the master device after the interface section of the physical quantity measurement device receives the data signal including the command signal and before the transmission or the reception of the subsequent data signal is performed. In other words in the case in which it is determined that the command signal is not appropriate the interface section of the physical quantity measurement device consistently outputs the NACK signal as the reply signal in response to the reception of the data signal including the command signal from the master device . Therefore the physical quantity measurement device can immediately notify the master device of the propriety determination result of the command signal without requiring the propriety determination result to be transmitted while being included in the data signal. Further the amount of the information for notifying the master device of the propriety determination result of the command signal is as small as 1 bit of the reply signal transmitted immediately after transmitting the command signal. As a result an amount of the communication between the master device and the physical quantity measurement device can be reduced. It should be noted that the communication protocol can be another protocol similar to the IC bus communication protocol.

For example in it is assumed that the register address of the register read command signal having been received from the master device is a non existent address. On this occasion the command determination section determines that the command signal includes an error. Then the output shift register having received the signal outputs the NACK signal to the master device instead of the ACK signal denoted with the reference numeral in .

Further for example in it is assumed that despite the start command signal has already been received a command signal other than the output command signal is received from the master device . On this occasion the command determination section determines that the command signal includes an error. Then the output shift register having received the signal outputs the NACK signal to the master device instead of the ACK signal denoted with the reference numeral in .

Further for example in it is assumed that a command signal other than the software reset 2 is received from the master device in the process of the software reset as the connected command. On this occasion the command determination section determines that the command signal includes an error. Then the output shift register having received the signal outputs the NACK signal to the master device instead of the ACK signal denoted with the reference numeral in . As described above it is possible to immediately notify the master device of the fact that the command signal includes an error using the NACK signal without requiring a new command signal.

Here going back to again the configuration of the interface section will be explained. In the case in which the command signal of the software reset as the connected command signal has been received from the master device without an error the command determination section sets the software reset signal to the low level to reset the circuit group and then resets the software reset signal to the high level.

Further in the case in which the register read command signal and the diagnostic command signal the start command signal and the output command signal have been received from the master device without an error the command determination section designates the address of the register storing the data required by the master device using a signal .

The storage section is a register for storing for example the output signal from the detection section and the fault diagnosis signal from the fault diagnosis section . The storage section can be for example an SRAM a DRAM a nonvolatile memory or other memory devices. Further the storage section outputs selected data in accordance with the address the signal from the command determination section .

The buffers are temporary memory devices. In the communication of the present embodiment for example the 16 bit 2 byte data is transmitted and received in twice 8 bits 1 byte at a time. In other words the serial communication is performed in terms of bytes. Therefore the data are temporarily stored in the buffer and the buffer in a separate manner.

Further signals output from the respective buffers are selected in sequence by the selector . A signal as an output of the selector is converted into a serial signal by the output shift register and then output to the master device .

Here the details of the propriety determination of the command signal performed by the command determination section will be explained. The command determination section determines not only whether or not the code of the command signal is defined in the specification but also whether or not the command signals are compliant with a given sequence. However the sequence is given only in the command signals of a specific type. Therefore the command determination section is provided with operation modes also referred to simply as modes determined by the type of the command signal in execution and thus it is possible to efficiently perform the propriety determination based on the mode and the type of the command signal received.

In the case of performing the process according to the register read command namely during the execution of the register read command the command determination section sets the operation mode to a first mode. The command determination section sets the operation mode to a second mode during the execution of the diagnostic command the start command the output command . Further the command determination section sets the operation mode to a third mode during the execution of the software reset. For example in the case in which the mode of the command determination is the third mode when a command signal other than the software reset signal is received the command determination section can efficiently determine that the command signal includes an error.

Here the default operation mode is the first mode and when the communication is started the command determination section sets the operation mode to the first mode and then resets the operation mode to the first mode after the execution of the diagnostic command or the software reset command. Further although the software reset is the connected command and the five command signals the software reset 1 through the software reset 5 are received as shown in in the present embodiment the explanation is presented assuming that the five command signals have the same code. It should be noted that a part or the whole of the software reset 1 through the software reset 5 can also have respective codes different from each other.

The arrows shown in each represent a transition of the mode and symbols representing the type of the command signal received and which one of the ACK signal and the NACK signal is output to the master device are described together with the arrows. The command signal received is described on the left side of a separating character with the command symbol shown in . Further a character A is described on the right side of the separating character in the case of outputting the ACK signal and a character N is described there in the case of outputting the NACK signal.

For example RR SC OC NE N means that the NACK signal is output to the master device and the command determination section makes the transition of the mode as indicated by the arrow in the case of receiving the register read command signal the start command signal the output command signal or the non existent command signal. Further for example SR A means that the ACK signal is output to the master device and the command determination section makes the transition of the mode as indicated by the arrow in the case of receiving the software reset.

When the communication is started the mode of the command determination section is set to the first mode as the default mode. When receiving the register read command signal the command determination section makes the ACK signal be output to the master device and keeps the mode in the first mode RR A . When receiving the output command signal or the non existent command signal the command determination section makes the NACK signal be output to the master device and keeps the mode in the first mode OC NE N .

Here when receiving the start command signal the command determination section makes the ACK signal be output to the master device and changes the mode to the second mode SC A . Subsequently when receiving the output command signal the command determination section makes the ACK signal be output to the master device and changes the mode to the first mode OC A .

It should be noted that in the case in which the mode is set to the second mode when further receiving the start command signal the command determination section makes the NACK signal be output to the master device and keeps the mode in the second mode SC N . Further when receiving the register read command signal the software reset or the non existent command signal the command determination section makes the NACK signal be output to the master device and changes the mode to the first mode RR SR NE N .

It the case in which the mode is set to the first mode or the second mode when receiving the software reset the command determination section makes the ACK signal be output to the master device and changes the mode to the third mode 1 SR A . Subsequently when receiving the software reset four times the command determination section makes the ACK signal be output to the master device after each of the command signals and changes the mode to the third mode 2 the third mode 3 the third mode 4 and then the first mode SR A .

However in the case in which the mode is set to the third mode 1 through the third mode 4 when receiving the register read command signal the start command signal the output command signal or the non existent command signal the command determination section makes the NACK signal be output to the master device and changes the mode to the first mode RR SC OC NE N .

As described above the command determination section can efficiently perform the propriety determination based on the modes and the types of the command signals.

Then the conditional branching on whether or not the command signal received is proper namely whether or not a noncompliance an error exists in the command signal based on the result of the propriety determination corresponds to S. In the case in which the noncompliance exists Y in S the interface section outputs a reply signal output step for outputting the negative acknowledgement signal S the NACK signal to the master device . Further in the case in which the noncompliance does not exist N in S the interface section outputs the reply signal output step for outputting the acknowledgement signal S the ACK signal to the master device . The output of the ACK signal or the NACK signal is specifically performed by the output shift register which has received the signal corresponding to the result of the propriety determination of the command signal by the command determination section .

The interface section updates a mode updating step S the mode based on the type of the command signal and the present mode. As explained with reference to the update of the mode is performed by the command determination section .

Since the interface section performs such a communication method as described above it is possible to immediately notify the master device of a defect in the command signal while performing the data communication compliant with a communication protocol e.g. the IC bus communication protocol using the master slave system. Therefore the highly reliable high speed data communication becomes possible.

An electronic apparatus according to the present embodiment will be explained with reference to . It should be noted that the same constituents as those shown in are denoted with the same reference numerals and symbols and the explanation thereof will be omitted.

The physical quantity measurement device communicates with the central processing unit CPU as the master device using the interface section . It should be noted that the description of the functional blocks other than the interface section of the physical quantity measurement device is omitted in .

The CPU obtains the data from the physical quantity measurement device and performs a variety of arithmetic processes and control processes in accordance with the program stored in the ROM and so on. Further the CPU performs a variety of processes corresponding to the operation signal from the operation section a process of controlling the communication section for performing data communication with external devices a process of transmitting a display signal for making the display section display a variety of types of information a process of making the sound output section output a variety of sounds and so on.

The operation section is an input device including operation keys button switches and so on and outputs the operation signal corresponding to the operation by the user to the CPU .

The ROM stores a program data and so on for the CPU to perform a variety of arithmetic processes and control processes.

The RAM is used as a working area of the CPU and temporarily stores for example the program and data retrieved from the ROM the data input from the operation section and the calculation result obtained by the CPU performing operations in accordance with the various programs.

The communication section performs a variety of control processes for achieving the data communication between the CPU and the external devices.

The display section is a display device formed of a liquid crystal display LCD or the like and displays a variety of information based on a display signal input from the CPU .

In the electronic apparatus the CPU communicates with the physical quantity measurement device via the interface section . The interface section determines whether or not the command signal from the CPU includes an error and can immediately notify the CPU if there is an error. Therefore the electronic apparatus high in reliability and quick in response can be realized.

As the electronic apparatus a variety of devices are possible. There can be cited for example a network server a personal computer e.g. a mobile type personal computer a laptop personal computer and a tablet personal computer a mobile terminal such as a cellular phone a digital still camera an inkjet ejection device e.g. an inkjet printer a storage area network apparatus such as a router or a switch a local area network apparatus a television set a video camera a video cassette recorder a car navigation system a pager a personal digital assistance including one having a communication function an electronic dictionary an electronic calculator an electronic game machine a gaming controller a word processor a workstation a picture phone a security television monitor an electronic binoculars a POS terminal a medical instrument e.g. an electronic thermometer a blood pressure monitor a blood glucose monitor an electrocardiograph ultrasonic diagnostic equipment and an electronic endoscope a fish finder a variety of measuring instruments gauges e.g. gauges for cars aircrafts and boats and ships a flight simulator a head mount display a motion tracer a motion tracker a motion controller and a pedestrian dead reckoning PDR system.

The controller has the physical quantity measurement device including the interface section . Although the detailed explanation of other constituents will be omitted high reliability is required in order to perform the control necessary for the movement of the moving object.

Here in the system of the moving object the controller can immediately detect any error included in the command signal received. Then it is possible to notify the master device not shown of the error to request an appropriate response. Therefore the reliability as the moving object can be enhanced.

It should be noted that as such a moving object a variety of types of moving objects can be adopted and a vehicle including an electric vehicle an aircraft such a jet plane or a helicopter a ship a rocket an artificial satellite and so on can be cited.

The invention includes configurations e.g. configurations having the same function the same way and the same result or configurations having the same object and the same advantage substantially the same as the configuration described in the embodiment described above. Further the invention includes configurations obtained by replacing a non essential part of the configuration described as the embodiment. Further the invention includes configurations providing the same functions and the same advantage or configurations capable of achieving the same object as the configuration described as the embodiment. Further the invention includes configurations obtained by adding a known technology to the configuration described as the embodiment.

The entire disclosure of Japanese Patent Application No. 2013 091038 filed Apr. 24 2013 is expressly incorporated by reference herein.

