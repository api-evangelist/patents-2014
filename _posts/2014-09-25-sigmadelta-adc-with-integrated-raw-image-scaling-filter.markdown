---

title: Sigma-delta ADC with integrated raw image scaling filter
abstract: A system and method of processing raw image pixel information includes an integrated decimation filter and raw image scaling filter. The decimation filter operates in the time domain; for example, to calculate a weighted average of time samples. The raw image scaling filter operates in the spatial domain; for example, to calculate a weighted average of spatial samples. The raw image pixel information is modulated by a sigma-delta analog-to-digital modulator.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09424626&OS=09424626&RS=09424626
owner: Sony Corporation
number: 09424626
owner_city: Tokyo
owner_country: JP
publication_date: 20140925
---
This application relates generally to digital image scaling. More specifically this application relates to a raw domain image scaling system and method that maintains Bayer consistency.

In a digital image capturing system it is common that the resolution requirement for still image capture is higher than that of video output. In such a case a high resolution camera capable of supporting the resolution requirement of still image capture is often used. When the camera is used in video mode to produce a video output stream the data is scaled down to suit the resolution of the video output. For example a particular image sensor with 8 million pixels megapixels or MP can give 8 MP still images. For the same image sensor in video mode a resolution of 1080 1920 pixels or approximately 2 MP may suffice to produce 1080p high definition HD video. Therefore in 1080p video mode the image data is scaled down 3 both vertically and horizontally to provide the desired output resolution.

This scaling may be performed either in the raw domain or the RGB domain. An advantage of scaling the image data in the raw domain to the desired video resolution is that it reduces the number of pixels that must be processed through the system. As a result a majority of processing blocks in an image pipeline or post processing section can be operated at a lower clock rate than the clock rate required to support full resolution processing. Operating the processing section at a lower clock rate has significant advantages in reducing electromagnetic interference and reducing power consumption of the system. These advantages are especially valuable in such applications as mobile imaging.

The raw scaling step can be interpreted as a filtering procedure which calculates a weighted average of selected input raw pixels to produce the values of the output raw pixels. The weights used and the pixels selected in the weighted averaging has a large impact on the quality of the output image. To optimize the quality of the output images a raw domain image scaling method called a Bayer consistent raw scaling BCRS method may be used.

When BCRS or another raw domain image scaling method is implemented in an image sensor it is necessary to incorporate additional circuits either in the analog domain or in the digital domain or both to generate the scaled raw pixels. As a result it can become necessary to increase the size of the circuit inside the sensor and increase the power consumption of the sensor.

Accordingly there is a need to incorporate BCRS or another raw domain image scaling method in the sensor in a manner so as to optimize the quality and match the resolution of the sensor and display without resulting in a significant increase in circuit complexity and power consumption.

Various aspects of the present disclosure relate to a system and method for processing raw image pixel information. The system and method respectively include an integrated decimation filter and raw image scaling filter. The decimation filter operates in the time domain for example to calculate a weighted average of time samples. The raw image scaling filter operates in the spatial domain for example to calculate a weighted average of spatial samples. The raw image pixel information is modulated by a sigma delta analog to digital modulator.

In this manner various aspects of the present disclosure provide for improvements in at least the underlying technical processes of image capturing and image processing.

This disclosure can be embodied in various forms including business processes computer implemented methods computer program products computer systems and networks user interfaces application programming interfaces hardware implemented methods signal processing circuits image sensor circuits application specific integrated circuits field programmable gate arrays and the like. The foregoing summary is intended solely to give a general idea of various aspects of the present disclosure and does not limit the scope of the disclosure in any way.

In the following description numerous details are set forth such as flowcharts data tables and system configurations. It will be readily apparent to one skilled in the art that these specific details are merely exemplary and not intended to limit the scope of this application.

Image sensor includes a pixel array including a plurality of pixels arranged in rows and columns. Individual pixels include pixel elements such as a photosensitive element for example a photodiode and associated control circuits for example transistors . Image sensor further includes an analog raw scaling circuit one or more analog to digital converters ADCs which convert the pixel data values into digital form a digital raw scaling circuit and an output buffer .

ISP includes an input buffer a raw domain processing circuit a demosaic circuit one or more RGB domain processing circuits including an RGB scaling circuit and an output buffer . Various circuits within ISP are operatively connected to a memory buffer .

While the imaging system as particularly illustrated includes multiple image scaling blocks it should be understood that some of these scaling blocks may be omitted for example RGB scaling circuit may only be necessary where image scaling is performed in the RGB domain after demosaicing. Depending on the specific implementation in a practical imaging system only raw domain scaling or only RGB domain scaling may be present or both may be included. Additionally the scaling blocks are not limited to the particular order illustrated in for example a raw domain scaling block may be included in raw domain processing circuit . When multiple scaling blocks are present the user or system designer will be able to configure the system to select a desired scaling configuration to suit the needs of the system such as frame rate power consumption clock speed and the like.

Various components of the imaging system may be implemented either in hardware software or a mixture of both. Examples of hardware implementations include application specific integrated circuit ASIC field programming logic array FPGA other programmable logic circuits discrete circuit elements and the like. Examples of software implementations include firmware in an embedded chip software in digital signal processors DSP software in a simulator software in a graphics processing unit GPU software in a general purpose central processing unit CPU and the like. A mixture of hardware and software may also be used wherein some blocks in the image sensor of are implemented in hardware with the remaining blocks implemented in software.

The processing systems and techniques described herein improve the functioning of the image sensor by allowing it to produce output images of high quality with fewer artifacts using an implementation which requires fewer components and less power.

To provide for color images a color filter array CFA is provided with image sensor so that each pixel gives a data value corresponding to a single primary color. illustrates a so called Bayer CFA for use with image sensor . In this example R represents the pixels coated or provided with optical red filters which therefore give only red pixel values. Similarly B represents the pixels coated or provided with optical blue filters which therefore give only blue pixel values. Both G and G represent pixels coated or provided with green optical filters which therefore give only green pixel values. Because the green pixels sharing a row with red pixels and the green pixels sharing a row with blue pixels may have different pixel characteristics due to cross talk and other reasons they are labeled with the different notations G and G respectively. While the Bayer CFA illustrated in uses an RGB layout the CFA is not particularly limited in this regard. For example other color arrangements are possible such as red green blue white RGBW cyan magenta yellow CMY cyan magenta yellow green CMYG and the like.

In The RGB Bayer CFA comprises a tiled or repeating arrangement of 2 2 blocks of pixels comprising an R pixel in the upper left corner thereof a G pixel in the upper right corner thereof a G pixel in the lower left corner thereof and a B pixel in the lower right corner thereof. One of ordinary skill in the art will readily recognize that other orderings are possible such as B G G R G R B G G B R G and the like as well as other primary color combinations.

Specifically illustrates a first order sigma delta modulator in the time domain. Sigma delta ADC includes a difference circuit an integrator a threshold comparator for example a 1 bit ADC a 1 bit digital to analog converter DAC and a filter . Here filter is an integrated decimation filter and image scaling filter where the decimation filter operates in the time domain and the image scaling filter operates in the spatial domain. Sigma delta ADC may be represented by a sigma delta modulator corresponding to elements which outputs to filter .

Specifically illustrates a second order sigma delta modulator in the time domain. Sigma delta ADC includes a first difference circuit a first integrator a second difference circuit a second integrator a threshold comparator a 1 bit DAC and a filter . As above filter is an integrated decimation filter and image scaling filter where the decimation filter operates in the time domain and the image scaling filter operates in the spatial domain. Sigma delta ADC may be represented by a sigma delta modulator corresponding to elements which outputs to filter .

In other words first order sigma delta ADC contains a single differentiator integrator pair and second order sigma delta ADC contains two differentiator integrator pairs in sequence. This can be extended to higher orders for example a third order sigma delta ADC will contain three differentiator integrator pairs in sequence a fourth order sigma delta ADC will contain four differentiator integrator pairs and so on.

In filters to are illustrated as being downstream from the delta sigma modulators. In this manner raw scaling in the digital domain may be performed. Alternatively or additionally filters may be placed upstream from the delta sigma modulators so as to perform raw scaling in the analog domain. In implementations where filters are placed both upstream and downstream from the delta sigma modulators greater scaling flexibility may be achieved. For example one can choose to filter either in the analog or digital domain or may filter particular pixels for example filtering in the horizontal direction in the analog domain and other pixels for example filtering in the vertical direction in the digital domain.

As illustrated in filters to include decimation filters used to calculate the multi bit output values from the outputs of the corresponding sigma delta modulators. Specifically the decimation filters respectively calculate weighted averages of time samples. Filters to also include raw image scaling filter RISF circuits which process the input raw pixels to give output raw pixels at the desired output resolution. Specifically the RISF circuits calculate weighted averages of spatial samples. During operation the RISF circuits calculate weighted averages of selected input raw pixels using filter coefficient values as will be described in more detail below for raw image scaling to give the output raw pixels. For example filter coefficient values according to the BCRS method can be used to achieve high output image quality.

In practical imaging system implementations the raw domain scaling method can be implemented either in hardware or software or a mixture of both. For software implementations the calculations in the scaling method can be implemented using embedded processors digital signal processors general purpose processors software simulation units and the like. For hardware implementations the calculations in the scaling method can be implemented using digital means or analog means. Digital implementation in hardware uses digital logic elements such as gates latches arithmetic units and the like. The logic elements can be included into an ASIC an FPGA discrete elements or other programmable circuits. Analog implementation in hardware can include capacitive or resistive circuit elements such as summing junctions voltage or current dividers operational amplifiers and the like.

The raw scaling method can be considered a filtering process followed by decimation. Scaling occurs according to a scaling factor 1 N where a Bayer input region of 2N 2N is processed to produce a 2 2 Bayer output region.

Similarly the pixel values of each green pixel in red rows are considered to be in a first green pixel array G defined as g1 g1 g1 g1 and are operated on by a first green filter coefficient array I defined as i0 i1 i2 i3 to output first green pixel G the pixel values of each green pixel in blue rows are considered to be in a second green pixel array G defined as g2 g2 g2 g2 and are operated on by a second green filter coefficient array J defined as j0 j1 j2 j3 to output second green pixel G and the pixel values of each blue pixel are considered to be in a blue pixel array B defined as b b b b and are operated on by a blue filter coefficient array K defined as k0 k1 k2 k3 to output blue pixel B . In this example four filter weights are used for each color and therefore four input pixels are used to calculate each output pixel value. The region of support that is the number and location of pixels used for the RISF may be changed and the scaling factor may also be changed.

BCRS utilizes optimized filter coefficients which are described here. illustrates an exemplary set of optimized filter coefficient arrays for a scaling factor . The filter coefficients are applied to the raw pixels in the spatial domain. In other words the respective grids shown in the arrays of represent the pixel coordinates where each rectangle corresponds to a raw pixel.

One of ordinary skill will recognize that raw domain image scaling methods other than BCRS can be used in the current invention to achieve efficient implementations. Changing the raw domain scaling method simply requires changing the numerical values of individual filter weights and or the regions of support of the filter.

An example of BCRS with a scaling factor of that is N 3 is illustrated in . In this case the input raw image is divided into tiles of size 6 6 and from each 6 6 input tile the scaling method calculates a 2 2 block of the output image. As illustrated each 6 6 input tile is divided into four 3 3 sub tiles that respectively represent the physical area of virtual pixel in a block of a virtual image sensor having a lower resolution equal to the scaled resolution. That is the virtual image sensor would have the resolution both vertically and horizontally compared to the actual image sensor used for capturing the raw image data.

Sub tiles are identified by the color of the corresponding virtual pixel under the assumption that the virtual image sensor uses the same Bayer CFA as the actual image sensor. For example sub tile is identified as an R sub tile because it corresponds to virtual pixel which is positioned where the R filter would be in a Bayer CFA on the virtual image sensor. Similarly sub tile is identified as a G sub tile sub tile as a G sub tile and as a B sub tile.

A similar example of BCRS with a scaling factor of is illustrated in . That is the input raw image is divided into tiles of 8 8 and from each 8 8 input tile the scaling method calculates a 2 2 output block. Here each 8 8 tile is divided into four 4 4 sub tiles that respectively represent the physical area of a virtual pixel in a block of a virtual image sensor having a resolution equal to the resolution both vertically and horizontally compared to the actual image sensor.

In both the geometric pixel centers of the virtual pixels and are indicated by dashed lines. The corresponding physical locations are indicated by arrows in input tiles and these are collocated with the centers of the sub tiles and .

Mathematically the scaling process can be written as a convolution according to the following expression 2 

In this convolution w k l represents the filter coefficients such as those described above with regard to x k l t is the input pixel at location k l at time t and y m n t is the output raw pixel at location m n at time t. Both the input and output raw pixel values x k l t and y m n t are written with an explicit dependence on time. The RISF is a spatial filter where weighted averages of neighboring pixel values are calculated. The RISF coefficients are not dependent on time that is they are constant with respect to time and hence the time index is not needed in w k l .

The preferred filter is a decimation filter for sigma delta modulation and is a time domain filter which operates on the output samples from a sigma delta modulator at an oversampling ratio . A sinc filter of length with filter weights equal to a scaled version of the sinc function which corresponds to a box function in the frequency domain is frequently used. Mathematically this is written according to the following expression 3 

Above q k l p is the output sequence from the sigma delta modulator which are binary samples either 0 or 1 at times the Nyquist rate. Since the impulse response of a sinc filter has infinite length it is frequently truncated in practice as shown in expression 3 above. For convenience in practical implementations the impulse may be shifted by half a sampling period in the output and therefore may be represented by the following expression 3 

Either expression 3 or 3 may be used and the particular choice of expression does not impact the output signal as an accurate representation of the analog input. Other decimation filters are also possible and will be apparent to one skilled in the art.

From the above expressions the output pixel from the image sensor after image scaling can be written according to the following expression 4 

Above the term enclosed in square brackets represents the impulse response of the sinc filter scaled by the weights of the raw image scaling filter. shows an image sensor where the RISF has been integrated into the ADCF. In particular the integrated ADCF RISF in implements the logic to first calculate the following expression 5 

For each pixel location in the input image the integrated ADCF RISF calculates the output samples using an accumulator that either sums the scaled sinc filter impulse response or skips the accumulation depending on the binary sample q k l.p . This step is possible and can be calculated very easily because the samples q k l p have values equal to either 1 or 0. After the ADCF has completed calculation of the inner summation the outer summation indexed by k l are calculated by the RISF by communicating the partial sums between the accumulators. In a column based ADC where one ADC is provided for a small number for example three of columns the pixels flow sequentially into the ADC and hence the summation over k l can be performed accordingly.

Image sensors typically use many ADCs in parallel to perform analog to digital conversion of many pixels simultaneously so that high frame rates can be achieved. For example according to a column ADC architecture one or a plurality of columns one column two column sharing three column sharing etc. are connected to a single ADC.

When this is completed the filter goes to row 0 phase 1 where the red pixel at row 0 column 2 of is presented to the sigma delta ADC. This is labeled as R 0 2 in . The sigma delta modulator generates the binary samples labeled as r 0 2 0 to r 0 2 1 in . During this period the filter weight value 13 is presented which is used with the sinc filter weights in the accumulation of s m n p k l if a binary value r k l m equals 1 and skipped otherwise. This procedure is repeated during row 0 phase 2 as shown in where the filter weight value for this period equals 3.

At the end of row 0 phase 2 the filter has accumulated partial sums for the output red pixel value. The first output R value is not completely determined at this point because rows 2 and 4 have not yet been processed according to the RISF. The next step is determined by the particular image sensor implementation. In a preferred implementation where the image sensor includes a sequencer so that pixel rows can be read out that is presented to the ADC in any arbitrary ordering the next rows to be read will be row 2 and then row 4. In this case processing for the output red pixel continues with row 2 and row 4 as shown in in a similar manner to the process for row 0. At the end of row 4 phase 2 the sum required by the RISF and ADCF are computed. The sum is then divided by 64 for the RISF which can be implemented as a right shift operation and finally divided by as required by the ADCF. After this step the computed R pixel value is sent to the output and the accumulator is reset.

Similarly the first output G pixel in can be computed using a schedule as shown in . In this schedule the reading out of the rows is arranged in an ordering such that row 5 is read out first followed by row 3 and then row 1. This is preferred so that the filter weight values can be presented in the same ordering as in . Therefore considering the calculation of the first output R and G pixels the first six rows are read out in this example in the order 0 2 4 5 3 1.

The row ordering 0 2 4 5 3 1 above is an example where the ordering of presenting the filter coefficients is fixed. Other row orderings can be used for example 0 2 4 1 3 5. In such a case the ordering of presenting the filter weights will be changed accordingly.

In a three column sharing structure the G and B columns use a separate ADC from the R and G columns. The output G and B pixels are computed by their respective integrated RISF ADCF in a similar fashion. show an exemplary schedule of the integrated RISF ADCF for computing the R and G pixels. In this example pixels from column 5 are fed to the sigma delta module prior to column 3 which is prior to column 1. This ordering can be controlled by the multiplexers in .

In sensor embodiments where rows of pixels must be read out in a top to bottom ordering an integrated RISF ADCF can be implemented with additional storage and logic elements.

For example the case of the schedule of at a point where the partial sum calculations for row 0 phase 2 have been completed is considered. In this case because row 1 must be read out before row 2 the partial sum after the calculations in row 0 specifically immediately after row 0 phase 2 must be stored. This requires a memory element to store the R partial sum from the three columns. After the R partial sum is stored the accumulator in the RISF is reset and the pixels in the first three columns of row 1 are fed to the ADC. A similar procedure occurs for the other ADCs working in parallel in the image sensor. The integrated RISF ADCF follows the schedule for row 1 phases 0 2 as listed in . After row 1 phase 2 the partial sum for the first G pixel is stored. Concurrently other ADCs are performing similar operations and the partial sum for other G pixels are stored one for each three columns. At this point the stored partial sums for the R pixels are respectively loaded into the corresponding accumulators and the procedure continues from row 2 phase 0 in . This alternating procedure continues until the end of row 4 phase 2 at which point the value in each accumulator is right shifted and divided as required by the RISF and ADCF. The resulting R values one from each RISF ADCF are sent to the output. Thereafter the G partial sums are loaded into the accumulators and the schedule for row 5 in is followed. After row 5 phase 2 the value in each accumulator is right shifted and divided according to the RISF and ADCF. The resulting G values are send to the output.

Operation of the integrated RISF ADCF is described above for image sensor embodiments with a three column sharing architecture for two different types of pixel readout ordering. The method can be extended in a straightforward manner to image sensors with other ADC column sharing structures other readout orderings and for other scaling factors as will be readily recognized in the art.

With regard to the processes systems methods heuristics etc. described herein it should be understood that although the steps of such processes etc. have been described as occurring according to a certain ordered sequence such processes could be practiced with the described steps performed in an order other than the order described herein. It further should be understood that certain steps could be performed simultaneously that other steps could be added or that certain steps described herein could be omitted. In other words the descriptions of processes herein are provided for the purpose of illustrating certain embodiments and should in no way be construed so as to limit the claims.

Accordingly it is to be understood that the above description is intended to be illustrative and not restrictive. Many embodiments and applications other than the examples provided would be apparent upon reading the above description. The scope should be determined not with reference to the above description but should instead be determined with reference to the appended claims along with the full scope of equivalents to which such claims are entitled. It is anticipated and intended that future developments will occur in the technologies discussed herein and that the disclosed systems and methods will be incorporated into such future embodiments. In sum it should be understood that the application is capable of modification and variation.

All terms used in the claims are intended to be given their broadest reasonable constructions and their ordinary meanings as understood by those knowledgeable in the technologies described herein unless an explicit indication to the contrary in made herein. In particular use of the singular articles such as a the said etc. should be read to recite one or more of the indicated elements unless a claim recites an explicit limitation to the contrary.

The Abstract of the Disclosure is provided to allow the reader to quickly ascertain the nature of the technical disclosure. It is submitted with the understanding that it will not be used to interpret or limit the scope or meaning of the claims. In addition in the foregoing Detailed Description it can be seen that various features are grouped together in various embodiments for the purpose of streamlining the disclosure. This method of disclosure is not to be interpreted as reflecting an intention that the claimed embodiments require more features than are expressly recited in each claim. Rather as the following claims reflect inventive subject matter lies in less than all features of a single disclosed embodiment. Thus the following claims are hereby incorporated into the Detailed Description with each claim standing on its own as a separately claimed subject matter.

