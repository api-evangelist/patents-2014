---

title: Solid-state mass storage media having data volumes with different service levels for different data types
abstract: Methods for providing non-volatile solid-state mass storage media with different service levels for different types of data associated with different applications. The method includes partitioning the non-volatile solid-state mass storage media into at least first and second volumes, individually assigning different service levels to the first and second volumes based on a type of data to be stored in the first and second volumes and based on the first and second volumes having different data retention requirements and/or data reliability requirements, and then performing service maintenance on data stored within at least the first volume according to the service level of the first volume.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09542119&OS=09542119&RS=09542119
owner: Toshiba Corporation
number: 09542119
owner_city: Tokyo
owner_country: JP
publication_date: 20140709
---
The present invention generally relates to solid state mass storage media and their operation. More particularly the present invention relates to flash based memory devices that comprise multiple volumes and adapted to operate by exposing volumes with different service levels for different types of data.

Non volatile solid state memory technologies used with computers and other processing apparatuses host systems are currently largely focused on NAND flash memory technologies with other emerging non volatile solid state memory technologies including phase change memory PCM resistive random access memory RRAM magnetoresistive random access memory MRAM ferromagnetic random access memory FRAM organic memories and nanotechnology based storage media such as carbon nanofiber nanotube based substrates. These and other non volatile solid state memory technologies will be collectively referred to herein as solid state mass storage media. Mainly for cost reasons at present the most common solid state memory technology used in solid state drives SSDs are NAND flash memory components commonly referred to as flash based memory devices flash based storage devices flash based media or raw flash.

Similar to rotating media based hard disk drives HDDs SSDs utilize a type of non volatile memory media and therefore provide persistent data storage persistency without application of power. In comparison to HDDs SSDs can service a READ command in a quasi immediate operation yielding much higher performance especially in the case of small random access read commands. This is largely due to the fact that flash based storage devices as well as other non volatile solid state mass storage media used in SSDs are purely electronic devices that do not contain any moving parts. In addition multi channel architectures of modern NAND flash based SSDs result in sequential data transfers saturating most host interfaces. A specialized case is the integration of an SSD into a hard disk drive HDD to form what is typically referred to as a hybrid drive. However even in the case of a hybrid drive the integrated SSD is functionally equivalent to a stand alone SSD.

Another difference between HDDs and flash based SSDs relates to the write endurance of flash based media. Briefly flash based memory components store information in an array of floating gate transistors referred to as cells. NAND flash memory cells are organized in what are commonly referred to as pages which in turn are organized in predetermined sections of the component referred to as memory blocks or sectors . Each cell of a NAND flash memory component has a top gate TG and a floating gate FG the latter being sandwiched between the top gate and the channel of the cell. The floating gate is separated from the channel by an oxide layer often referred to as the tunnel oxide. Data are stored in a NAND flash memory cell in the form of a charge on the floating gate which in turn defines the channel properties of the NAND flash memory cell by either augmenting or opposing the charge of the top gate. This charge on the floating gate is achieved by applying a programming voltage to the top gate. The process of programming writing 0 s to a NAND cell requires injection of electrons into the floating gate by quantum mechanical tunneling whereas the process of erasing writing 1 s to a NAND cell requires applying an erase voltage to the device substrate which then pulls electrons from the floating gate. Programming and erasing NAND flash memory cells is an extremely harsh process utilizing strong electrical fields to move electrons through the oxide layer. After multiple writes to a flash memory cell it will inadvertently suffer from write endurance problems caused by the breakdown of the oxide layer. With smaller process geometries becoming more prevalent write endurance problems are becoming increasingly important.

Another difference between HDDs and NAND flash memory technology relates to data retention that is the maximum time after which data is written that the information is still guaranteed to be valid and correct. Whereas HDDs retain data for a practically unlimited period of time NAND flash memory cells are subjected to leakage currents that cause the programming charge to dissipate and hence result in data loss. Retention time for NAND flash memory may vary between different levels of reliability for example about five years in an enterprise environment to about one to three years in consumer products. Retention problems are also becoming increasingly important with smaller process geometries.

Data access and reliability related characteristics and requirements associated with volatile and non volatile memory components are collectively referred to herein as service levels and encompass such requirements as persistence validity write endurance retention etc. In view of the above to be considered as viable storage alternatives to HDDs SSDs using flash based solid state mass storage devices are required to meet certain service levels that include write endurance and retention time. Write endurance can be addressed by for example wear leveling techniques based on the number of P E program erase cycles among memory blocks. The retention constraint has mandated various mechanisms. As an example the number of P E cycles may be limited to satisfy the service level probability of the retention requirement. Strong error correction such as through the use of error checking and correction ECC algorithms can also be applied to reduce errors over time. With decreasing process geometries constant data scrubbing is required to counteract increasing failure rates associated with retention. As known in the art scrubbing generally refers to refreshing data by reading data from a memory component correcting any errors then writing the data back usually to a different physical location within the memory component.

Flash based memory technologies are seldom used as a system memory replacement in host systems as opposed to a mass storage replacement that takes advantage of the large capacity of flash based memory components. An intuitive example is in the use of swap files. Modern computer system memory are typically made up of random access memory RAM integrated circuit IC components often SDRAM synchronous dynamic random access memory . As the RAM area of system memory may often be limited and insufficient operating systems of computers often use the disk area of an HDD as a swap file to temporarily dump and retrieve memory. Another example of such usage is by applications such as temporary space by databases e.g. TempDB in SQL Server .

Although traditionally provided by HDDs system memory replacement does not require the long retention or even persistency offered by HDDs. A typical retention period for a swap file is very short typically a few minutes at most and can be limited to a day. Hence mechanisms that limit the P E cycles can be relaxed for such files or data as there is no requirement to be able to read the data very far into the future.

Other applications that have been introduced with flash based media can further relax more constraints. For example a flash read cache application can handle loss of data as it can use the production volume s data the cache just holds a local copy of the same data . That is the application can use error detection mechanisms to verify data correctness and can tolerate data errors returned from the flash based media. Also persistence is not required in this case as again the reference copy of the data is always available. Hence such applications can allow even lower levels of data assurance.

In view of the above different applications require different service levels from flash based media in terms of retention persistence and validity and the use of a device with the highest service level for all data places unnecessary constraints and reduces efficient utilization of flash based media.

The concept of exposing different logical unit numbers LUNs representing multiple volumes with different service levels is well known in the storage industry. For example U.S. Patent Application Publication No. 2010 0169570 addresses the issue from a performance perspective providing different quality of service QoS levels to each volume. That is volumes are configured to provide different performance metrics for example input output IO operations per second IOPS bandwidth latency etc. and assigned to different applications according to their importance and requirements.

However flash based storage is by nature a high performance volume. Hence the above service level characteristics do not apply for such volumes. Instead and as mentioned above service level characteristics for flash based storage generally relate to the endurance and retention levels of the data. These characteristics have been addressed from different perspectives. For example U.S. Pat. No. 8 621 328 discloses memory that is logically divided into regions and in which data are stored applying different error correction for dynamic data and static data.

The present invention provides methods for providing non volatile solid state mass storage media with different service levels for different types of data associated with different applications and in doing so provides the opportunity for promoting more optimal usage of the storage media.

According to an aspect of the invention a method of storing data on non volatile solid state mass storage media includes partitioning the non volatile solid state mass storage media into at least first and second volumes individually assigning different service levels to the first and second volumes based on a type of data to be stored in the first and second volumes and based on the first and second volumes having different data retention requirements and or data reliability requirements and then performing service maintenance on data stored within at least the first volume according to the service level of the first volume.

Another aspect of the invention is a non volatile solid state mass storage media adapted to perform a method comprising the steps described above.

Technical effects of the method and non volatile solid state mass storage media described above preferably include the ability to use the media as replacement or complementary memory media for volatile system memory media and HDD storage media and in particular to selectively utilize certain features and attributes of the media for such purposes including the high storage capacity and random access performance of the non volatile solid state mass storage media while also preferably accommodating and or adjusting for data retention and write endurance limitations often associated with such media.

Other aspects and advantages of this invention will be better appreciated from the following detailed description.

As represented in current host systems typically utilize DRAM as volatile system memory media and HDD storage as non volatile mass storage media. In a typical host system the DRAM area is a relatively small area with very high random access but no persistency whereas the HDD storage area is relatively large with high persistency but relatively poor random access. As also represented in non volatile solid state mass storage media which in the particular nonlimiting example of is identified as flash based memory storage flash media resides between the current computing media represented by the DRAM and HDD storage . The flash media has certain features and attributes of both DRAM and HDD storage . For example the capacity volume of flash media is generally between those of DRAM and HDD storage and flash media provide better random access performance than HDD storage though less than the DRAM . In addition whereas DRAM are volatile memory devices and therefore do not retain data in the absence of power flash media provides data persistency though for a more limited duration as compared to HDD storage .

As a result it would be desirable to utilize flash media as replacement or complementary media in a manner that addresses weaknesses in certain features of DRAM and HDD storage . In the following discussion the utilization of flash based media as replacement and or complementary memory media for volatile system memory media or non volatile mass storage media will simply be referred to as replacement memory media as a matter of convenience unless indicated otherwise. As indicated in as a replacement or complementary memory media for DRAM referred to as DRAM Replacement in or other volatile system memory media flash media would provide complementary memory space and data persistence. As a replacement or complementary memory media for HDD storage referred to as Storage Replacement in or other non volatile mass storage media flash media provides a faster tier of data storage as a result of having higher random access performance for example based on IOPS.

The DBMS is represented as using a temporary database space TempDB for maintaining calculations and other temporary information created during analysis processes. The temporary space is desirable if the DRAM e.g. DRAM of or other volatile system memory media of the host system is not sufficiently large for the desired operation of the host system. Usually the DRAM would be used as a first tier of temporary data and processed information would be placed on a dedicated temporary location e.g. SQL Server s TempDB of an HDD. represents the temporary data as being stored in a swap volume within memory space of the flash media . As swap information life expectancy is relatively short the retention of this volume may be in a range of days at most for example one to two days though longer retention is possible in which case the swap volume can be viewed as a short term storage area of the flash media . Also as the swap volume serves as replacement memory media for volatile system memory media e.g. DRAM there is no need for persistency in this volume since the data stored in volatile memory media are not persistent. However as indicated in the swap volume preferably utilizes error correction as part of an ECC algorithm that can be performed by the controller . In combination the data retention short term storage and data reliability error treatment using error detection and correction associated with the swap volume constitutes a type of service level that is different from the service level of the log volume .

The DBMS stores information in large files containing a plurality of records within the database and preferably utilizes indexes to improve performance. Although small databases can be placed entirely on a flash device typical DBMS would require a back end storage system to store all the database information. The flash media represented in can be used to accelerate the access to this information via a read cache application within an acceleration layer and a read cache volume within memory space of the flash media . Because the read cache volume serves as replacement memory media for volatile system memory media effectively enlarging the DRAM cache this volume does not require persistency or long retention and therefore can be viewed as a short term storage area of the flash media . Furthermore as the data reside in the back end storage loss of data is tolerated as long as it can be detected. Hence the read cache volume preferably utilizes error detection in other words the read cache application is made aware that errors have occurred but that the data remain in error not corrected and not to be used. Error detection utilized by the read cache volume can be performed by the controller but does not require error correction using an ECC algorithm. In combination the data retention short term storage and data reliability error treatment using error detection associated with the read cache volume constitutes a type of service level that is different from the service levels of the log and swap volumes and .

Though three different volumes and are represented in fewer and greater numbers of volumes could be partitioned on the flash media . According to particular but nonlimiting embodiments of the invention each of the volumes and can be provided by the same flash component through its controller . A user can be permitted to configure the size of each volume and and its type for example log swap or read cache . As known in the art hardware and firmware elements in the controller or otherwise associated with the flash media can be used to partition the different volumes and and assign their desired different service levels relating to data retention and write endurance and or internal components such as a flash management system can be used to relax P E cycle count limitations and or switch between error detection and error correction for the different volumes and to assign their desired different service levels. For example a user can configure the flash media via an API and management software such that the flash media exposes the volumes and to the host system. Standard storage API commands for this purpose include but are not limited to SCSI Inquiry SCSI Report LUN SCSI Get Capacity etc. The flash media may but is not required to use all flash based media in other words flash memory blocks sectors as a single pool to provide the desired volumes and and their different service levels.

As an alternative to the garbage collection scheme of represents a garbage collection process that can be performed on different volumes on flash media for example the log swap and read cache volumes and of the flash media of . Each volume and maintains a set of values and which include dirty level indicators and and erase counts and for each of individual data block and within the volumes and .

According to a nonlimiting embodiment of the invention if the number of available blocks for the log volume i.e. free blocks with low erase counts is below a threshold and the number of partially dirty blocks is above a second threshold the garbage collection process starts merging blocks from the log volume and preferred candidates for merging are blocks with the highest dirty levels and within the log volume . Also according to a nonlimiting embodiment of the invention if the number of available blocks for the swap volume is below a threshold and the number of partially dirty blocks is above a second threshold the garbage collection process starts merging blocks from the swap volume and preferred candidates for merging are blocks with the highest dirty level and within the swap volume . Still further according to a nonlimiting embodiment of the invention if the number of available blocks for the cache volume is below a threshold and the number of partially dirty blocks is above a second threshold the garbage collection process starts merging blocks from the cache volume and preferred candidates for merging are blocks with the highest dirty level and within the cache volume . Hence as a corollary of these actions each volume and can be provided with a pool of blocks for a write peak. The decision criteria for a merge in the garbage collection process can be chosen to provide different levels of reliability. In addition the criteria for the swap volume can be relaxed to reduce the chance of block shortage in a write peak.

While the invention has been described in terms of specific embodiments it is apparent that other forms could be adopted by one skilled in the art. Therefore the scope of the invention is to be limited only by the following claims.

