---

title: Method and apparatus for coordinating information request messages over an ad-hoc mesh network
abstract: An approach is provided for coordinating information request messages over an ad-hoc mesh network. A module receives at least one request to transmit one or more information request messages over an ad-hoc mesh network. The module determines context information associated with at least a portion of the ad-hoc mesh network, one or more nodes within the at least a portion of the ad-hoc mesh network, or a combination thereof. The module then determines to transmit the one or more information request messages over the ad-hoc mesh network based, at least in part, on the context information.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09485673&OS=09485673&RS=09485673
owner: Nokia Technologies Oy
number: 09485673
owner_city: Espoo
owner_country: FI
publication_date: 20140822
---
This application is a Continuation of U.S. application Ser. No. 13 307 924 filed Nov. 30 2011 which claims priority benefit to U.S. Provisional Patent Application No. 61 418 306 filed Nov. 30 2010 the content of both of which are herein incorporated by reference in their entireties.

Wireless e.g. cellular service providers and device manufacturers are continually challenged to deliver value and convenience to consumers by for example providing compelling network services applications and content. One area of development is the use of communication networks and devices to automatically determine information and context about the local environment. However technical challenges relating to power consumption signaling overhead security and privacy have hindered such development.

Therefore there is a need for an approach for efficiently coordinating information request messages over ad hoc mesh network to for instance minimize network traffic and resource use.

According to one embodiment a method comprises receiving at least one request to transmit one or more information request messages over an ad hoc mesh network. The method also comprises determining context information associated with at least a portion of the ad hoc mesh network one or more nodes within the at least a portion of the ad hoc mesh network or a combination thereof. The method further comprises determining to transmit the one or more information request messages over the ad hoc mesh network based at least in part on the context information.

According to another embodiment an apparatus comprising at least one processor and at least one memory including computer program code the at least one memory and the computer program code configured to with the at least one processor cause the apparatus to receive at least one request to transmit one or more information request messages over an ad hoc mesh network. The apparatus is also caused to determine context information associated with at least a portion of the ad hoc mesh network one or more nodes within the at least a portion of the ad hoc mesh network or a combination thereof. The apparatus is further caused to determine to transmit the one or more information request messages over the ad hoc mesh network based at least in part on the context information.

According to one embodiment a computer readable storage medium carrying one or more sequences of one or more instructions which when executed by one or more processors cause an apparatus to receive at least one request to transmit one or more information request messages over an ad hoc mesh network. The apparatus is also caused to determine context information associated with at least a portion of the ad hoc mesh network one or more nodes within the at least a portion of the ad hoc mesh network or a combination thereof. The apparatus is further caused to determine to transmit the one or more information request messages over the ad hoc mesh network based at least in part on the context information.

According to another embodiment an apparatus comprises means for receiving at least one request to transmit one or more information request messages over an ad hoc mesh network. The apparatus also comprises means for determining context information associated with at least a portion of the ad hoc mesh network one or more nodes within the at least a portion of the ad hoc mesh network or a combination thereof. The apparatus further comprises means for determining to transmit the one or more information request messages over the ad hoc mesh network based at least in part on the context information.

In addition for various example embodiments of the invention the following is applicable a method comprising facilitating a processing of and or processing 1 data and or 2 information and or 3 at least one signal the 1 data and or 2 information and or 3 at least one signal based at least in part on or derived at least in part from any one or any combination of methods or processes disclosed in this application as relevant to any embodiment of the invention.

For various example embodiments of the invention the following is also applicable a method comprising facilitating access to at least one interface configured to allow access to at least one service the at least one service configured to perform any one or any combination of network or service provider methods or processes disclosed in this application.

For various example embodiments of the invention the following is also applicable a method comprising facilitating creating and or facilitating modifying 1 at least one device user interface element and or 2 at least one device user interface functionality the 1 at least one device user interface element and or 2 at least one device user interface functionality based at least in part on data and or information resulting from one or any combination of methods or processes disclosed in this application as relevant to any embodiment of the invention and or at least one signal resulting from one or any combination of methods or processes disclosed in this application as relevant to any embodiment of the invention.

For various example embodiments of the invention the following is also applicable a method comprising creating and or modifying 1 at least one device user interface element and or 2 at least one device user interface functionality the 1 at least one device user interface element and or 2 at least one device user interface functionality based at least in part on data and or information resulting from one or any combination of methods or processes disclosed in this application as relevant to any embodiment of the invention and or at least one signal resulting from one or any combination of methods or processes disclosed in this application as relevant to any embodiment of the invention.

In various example embodiments the methods or processes can be accomplished on the service provider side or on the mobile device side or in any shared way between service provider and mobile device with actions being performed on both sides.

Still other aspects features and advantages of the invention are readily apparent from the following detailed description simply by illustrating a number of particular embodiments and implementations including the best mode contemplated for carrying out the invention. The invention is also capable of other and different embodiments and its several details can be modified in various obvious respects all without departing from the spirit and scope of the invention. Accordingly the drawings and description are to be regarded as illustrative in nature and not as restrictive.

A method and apparatus for coordinating information request messages over an ad hoc mesh network are disclosed. In the following description for the purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of the embodiments of the invention. It is apparent however to one skilled in the art that the embodiments of the invention may be practiced without these specific details or with an equivalent arrangement. In other instances well known structures and devices are shown in block diagram form in order to avoid unnecessarily obscuring the embodiments of the invention.

As used herein the term awareness information refers to any information and or context about a local environment as well as the users and communication devices within the local environment. By way of example awareness information can be used to support applications for creating social networks determining presence determining contexts associated with a device advertising searching for information etc. Although various exemplary embodiments are described with respect to coordinating messages generated using a publish subscribe mechanism e.g. as described in more detail below it is contemplated that the various embodiments of approach described herein may be used with any type of information exchange over an ad hoc mesh network. In addition the term information request messages refers to any message or other signaling related to requesting information as well as to any message or other signaling related to responding to the request.

One traditional method of information sharing is through a publish subscribe paradigm whereby information owners e.g. publishers provide information without knowing a priori the specific receivers e.g. subscribers of the information or when the subscribers intend to access the information. In other words a publish subscribe mechanism or paradigm enables the decoupling of space e.g. parties do not need to know each other and time e.g. parties do not need to be actively taking part in the interaction at the same time . Historically implementing a publish subscribe mechanism is based on creating or otherwise designating a central message broker for registering publishers and subscribers. The broker can then store the information from publishers and forward them to relevant subscribers. However in the case of various embodiments of the ad hoc mesh network described below with respect to a system of the serverless and transient nature of such a device to device network poses significant challenges for service providers and device manufacturers. Moreover because of the limited nature of the communication channels available e.g. using short range and often bandwidth limited wireless connections over the device to device network the service providers and device manufacturers seek to minimize the number of messages and transmissions arising from such information exchanges.

As shown in the system comprises one or more wireless nodes optionally having connectivity to a communication network through either operator A or operator B . The wireless nodes are mobile terminal fixed terminal or portable terminal including a mobile handset station unit device multimedia computer multimedia tablet Internet node communicator desktop computer laptop computer notebook computer netbook computer tablet computer personal communication system PCS device personal navigation device personal digital assistants PDAs audio video player digital camera camcorder positioning device television receiver radio broadcast receiver electronic book device game device or any combination thereof including the accessories and peripherals of these devices or any combination thereof. It is also contemplated that the wireless nodes can support any type of interface to the user such as wearable circuitry etc. .

In exemplary embodiments the wireless nodes form an ad hoc mesh network for sharing awareness information. The ad hoc mesh network is for instance a connectionless and serverless device to device network e.g. a mobile ad hoc network MANET created using short range radio technology e.g. wireless local area network WLAN or Bluetooth . Within the ad hoc mesh network each wireless node may be mobile and is within communication range of any number of other wireless nodes . Accordingly the set of wireless nodes that is within communication range of any a particular wireless node is transient and can change as the wireless nodes move from location to location. As noted above the serverless and transient nature of ad hoc mesh network creates challenges to implementing a publish subscribe mechanism over the network .

As discussed previously service providers and device manufacturers that are developing communication systems and networks for locating communities face many technical challenges. For example current ad hoc radios e.g. WLAN and Bluetooth are designed for connectivity e.g. connectivity via Internet protocol IP . However in an always on environment such as the ad hoc mesh network it is not practical to have a large number of wireless nodes e.g. mobile handset devices connected by for instance IP to each other for extended periods of time because of power usage and scalability problems. Specifically a multi hop connection in a large ad hoc network typically requires a significant amount of control signaling and power and can quickly deplete a mobile device s battery. Moreover scalability can be a problem because current ad hoc radios are typically limited in the number of connections and the related signaling that they can support at any given time. Another shortcoming of current ad hoc radios is that they do not adequately protect a user s privacy because they expose the user s identity through a fixed network address e.g. a media access control MAC address associated with the user s device. These problems are also relevant to the implementation of an efficient publish subscribe mechanism over the ad hoc mesh network and of a process for coordinating the associated information exchanges.

To address these problems the system creates the ad hoc mesh network for sharing awareness information in a connectionless fashion. As used herein the term connectionless refers to the ability of a node e.g. wireless node to send and of all surrounding nodes to receive awareness information without the need to send any prior control signaling. For example sending awareness information using the transmission control protocol IP TCP IP over a WLAN ad hoc is not connectionless because of the two way TCP control signaling between the sending and receiving nodes used to establish the TCP connection. The awareness information is provided for instance in small anonymous messages that are exchanged by the wireless nodes automatically without user intervention. As used herein the term anonymous means that it is not possible to infer the true identity of the sender from the message unless the true identity is intentionally included in the message e.g. by the user or another entity authorized by the user . The exchange of awareness information occurs as a broadcast message i.e. a flooding message from a wireless node to neighboring wireless nodes that are within range of the radio of the broadcasting wireless node . As neighboring wireless nodes receive the broadcasted message each receiving wireless node may in turn rebroadcast the message to other neighboring wireless nodes . In this way the originally broadcasted message propagates throughout the ad hoc mesh network . In exemplary embodiments the extent of the propagation may be limited by criteria such as distance location time etc.

Unlike traditional systems such messages typically are for carrying awareness information and are not for transporting content e.g. files or media containing voice video etc. between two wireless nodes e.g. wireless nodes and . Instead the messages generally contain pointers to the content or a small amount of data e.g. presence or context information to minimize the data traffic transported over the ad hoc mesh network . Accordingly the limited capacity of the communication channels associated with such messages pose additional challenges to providing a publish subscribe mechanism and to coordinating the exchange and or sharing of information. For example to address this problem the wireless nodes may then access the content using other communication channels e.g. via IP through the communication network . In addition the system eliminates the problems associated with traditional methods for route establishment and maintenance e.g. connection based communication protocols such as maintaining and handing off connections as mobile devices move and requiring high levels of network resources for maintaining connections in an environment with a high number or density of mobile devices. For example the event of a wireless node appearing disappearing to from the network does not generate any control signaling in the ad hoc mesh network . Similarly the system creates routing information only when needed to route replies to queries back to the querying node. The routing information is generated by using the query messages alone e.g. no control signaling is used for creating routing information . After the query and subsequent reply process is completed the routes are forgotten. In other words the query reply process of system provisions routes for a reply to provide awareness information on demand rather than pushing awareness information from one node to another. In exemplary embodiments both push e.g. information is published over the ad hoc mesh network and pull e.g. information is queried from other nodes of the ad hoc mesh network modes of disseminating awareness information are possible. In certain embodiments it is contemplated that the pull mode of operation can be used instead of the push mode to help suppress potential spam messages.

Moreover the system optimizes the power consumption of wireless nodes communicating over the ad hoc mesh network to enable always on operation without seriously affecting the battery life of the wireless nodes . For instance by utilizing only short awareness messages by eliminating the need for any route maintenance signaling by employing procedures to minimize transmission and reception of duplicative messages and by enabling an efficient sleep scheme for the short range device to device radio used within each wireless node allowed by the low latency requirements typical of an awareness information network the system can potentially provide hundreds of hours e.g. over 400 hours of continuous operation of each wireless node between battery charges in a mobile device. In one embodiment the optimization procedures also extend to minimizing the transmission and reception messages include the processes for coordinating information request messages of the various embodiments described herein. The system could be seen as a nervous system between the mobile devices where small messages nerve impulses are continuously exchanged by the mobile devices neurons in order to bring awareness to the user of a mobile device about the user s surroundings.

The system also enables the development of new services and applications based on awareness information e.g. social networking applications location based applications application for determining presence applications for determining context advertising applications . In particular the continuous and immediate nature of the awareness information with respect to local environment enables compelling new services. For instance awareness information may be combined with the increasingly available storage and computing power in mobile devices e.g. wireless nodes to create a local semantic web whereby local awareness information is created and searched for automatically by wireless nodes within the ad hoc mesh network . As used herein the term semantic web refers to a system in which the information and messages shared with the system is understandable by the nodes within the system. It is noted that establishing such a local semantic web using the system overcomes two major problems blocking the development of a global semantic web 1 lack of mechanism for providing semantic content on a large scale and 2 lack of semantically aware search engines to help users find information in a semantic web. The system can also be used for collaborative context calculation generation of collaborative recommendations based on user profile data of participating nodes publishing pointers to information or content searching for friends within a defined community finding out what is going on and what kind of people are around a user making the environment aware of the user and other like applications.

To facilitate the creation of the semantic webs and or for sharing information in general over the ad hoc mesh network the system introduces the capability to provide a publish subscribe mechanism including a publish subscribe interface to applications using distributed valuespaces efficient query response mechanisms and broadcast messages. More specifically wireless nodes that are participating in the publish subscribe mechanism have their own respective valuespaces for storing locally published information items and subscribed information items received over the ad hoc mesh network . In one embodiment there is no explicit synchronization between different wireless nodes thereby advantageously avoiding the need to implement potentially complex synchronization protocols over the ad hoc mesh network . As a result the same application executing in different wireless nodes might have different sets of information available to it e.g. in wireless node the application knows data items and but in wireless node the same application knows data items and .

In one embodiment in lieu of a traditional synchronization process the system enables the applications executing in the wireless nodes to define their own data schema within their respective valuespaces. In one embodiment the data schema defines the type and format of information that the associated application can send e.g. publish and receive e.g. subscribe within the valuespace.

Moreover it is contemplated that an application can define and use multiple data schemas or have multiple instances of the one data schema. For example to publish information an application initiates determines and or stores at least one data schema associated with the information along with the information in the valuespace of the corresponding wireless node . Placing the data schema and information in the valuespace makes the information available to other subscribing wireless nodes . In one embodiment an application executing on one or more of the subscribing nodes can initiate a query based on any corresponding subscriptions. By way of example in one embodiment a subscription from an application is implicitly turned into a query message. The query is then periodically spread to other wireless nodes in the ad hoc mesh network according to for instance the message transmission and relay processes described below.

Upon receiving the query message a receiving wireless node performs a search of the local valuespace for matching or substantially matching data schemas. If there are published information items based on the same or similar schema the results are returned as a response message. Upon reception of response messages at the subscribing node the results are inserted into the local valuespace and the subscribing applications are notified accordingly. In one embodiment the subscribing applications can also define filters so that only selected information items are queried and received.

In some embodiments by default all messages are broadcasted so a wireless node can receive responses to queries which it has not sent. Based on the knowledge that the wireless node receives response messages even though it has not sent a query the wireless node can delay sending of its own queries e.g. queries for the same or similar information contained in the received response messages because it already has up to date information. In this way the process can advantageously reduce potential traffic over the ad hoc mesh network .

In another embodiment wireless nodes that receive one or more of the responses messages may store the responses in their respective valuespaces even when the nodes have not sent a corresponding query. In this way the wireless nodes can have a store of information in the valuespace that may be responsive to future queries. In one embodiment these responses messages may be removed from the valuespace based on available memory in the valuespace time expiration period associated with respective messages and the like.

However in some cases extensive use of the publish subscribe mechanism or other forms of information sharing over the ad hoc mesh network can lead to a proliferation of information request messages. These information request messages can potentially burden the resource e.g. processing and transmission resources . Accordingly service providers and device manufacturers face significant technical challenges to enable efficient delivery of information and related information request messages between applications and nodes of the ad hoc mesh network while minimizing use of network resources and capabilities. To address this problem the system introduces the capability to designate a specific entity e.g. a query engine as described with respect to below in participating wireless nodes that coordinate information request messages and information delivery between applications in different wireless nodes 

In one embodiment the system e.g. via the query engine makes decisions concerning a time to trigger or transmit information request messages e.g. messages that seek and or provide information in order to meet the information demands of applications and nodes while minimizing network usage and traffic. By way of example the system makes message delivery or triggering decisions based at least in part on network or node context information provided over the ad hoc mesh network . Generally such context information e.g. network traffic network topology node sensor information published information exchanged messages etc. is collected as side effect of data traffic as discussed below. In yet another embodiment the system can further reduce or minimize network usage by combining one or more information request messages into a common message for transmission determining an appropriate form of transmission of them messages e.g. broadcast or unicast message and the like.

The following are exemplary use case scenarios for applications can exchange information over the ad hoc mesh network using various embodiments of the publish subscribe mechanism described herein.

In one use case an application may subscribe to user profile data publishing by neighboring wireless nodes . By way of example the user profile data may include information such as usage history user behavior user preferences and the like. The application can then use the published user profile data to generate recommendations e.g. recommendations for content applications services items etc. based on local preferences. In one embodiment the published user profile data may be limited to a community or group of wireless nodes according to the community processes discussed below. In some cases the user profile data may be encrypted so that only group or community members may access the information even if the information is received and relayed by non community members.

In another use case the awareness information alerts a user to nearby people or places. For example a user is visiting a new town when the wireless node alerts the user that Salvatore a friend of your friend David is nearby. The user may then arrange to meet Salvatore to get a recommendation for sites to visit in the new town. In another example a user is looking for a good restaurant in an unfamiliar neighborhood. An application based on awareness information may present a list of local restaurants ranked by the number of people currently eating in the restaurant that have the same food preferences as the user. Such a list can be collected based on queries and replies that contain anonymous information of people s food preferences.

In another use case an application uses the awareness information to discover events near the user. For example as a user passes a park the wireless node informs the user based on messages exchanged between nearby devices that There is a Japanese culture festival in the Tea Garden Park five members of your Kabuki community are there Zen Mi Xia Talo and Chris. The user may then decide to attend the festival.

In another use case an application provides location based or context based services using awareness information. For example a wireless node does not have positioning capabilities but nonetheless knows that it is in a grocery store based on anonymous awareness information from other nearby wireless nodes . It is contemplated that the grocery store may also place a node in the store to provide such context information possibly combined with other store specific information such as the address of the store s web page. The wireless node then reminds the user to Remember to buy dishwasher detergent based on the user s location in a grocery store. The awareness information can also be the physical position information from a neighboring wireless node that has the positioning capability. Sharing of positioning information with a neighboring node with such a capability can enable nodes without such capability to offer navigational services.

In another example a group of people are attending a meeting. The meeting invitation includes an identification code for that particular meeting that is stored in the mobile nodes of the meeting attendees e.g. the identification code may be stored in the calendar data . Using the principles set forth in this invention the nodes can exchange the meeting identification code over the ad hoc mesh network while attending the meeting. Comparing the exchanged identification code in a user s wireless device can for instance establish whether the users was indeed at the meeting corresponding to the identification code. Such accurate social context knowledge can be used for instance to adapt the service or application behavior towards the user.

In another use case an application provides for search of local information that changes rapidly and very specific to a local environment. The local information often does not reach traditional Internet search engines. For example a user bought tickets to a concert but discovers at the last minute that the user cannot attend. The user stores a string Ticket to concert X at venue Y is available into the awareness services module of the user s wireless node . As a result a nearby wireless node within a few street blocks away that searches for tickets by sending query messages with a string Ticket concert X over the multi hop ad hoc mesh network will receive the user s ticket availability message as an automatic reply.

In another use case an application enables locally targeted advertising. For example it is almost closing time for a local fresh fruit market. The merchants decide to publish an advertisement over the ad hoc mesh network that Apples are 50 off for the rest of the day. The advertisement is available to users who live nearby the market. In another example a user browses an advertisement for a new printer on a wireless node . In the browsing activity a code attached to the advertisement is stored in the awareness services module . Upon searching and finding such a code a nearby electronics store sends the user an offer to sell the printer with a 10 discount.

In another use case an application automatically creates an activity log based on the awareness information associated with a user. For example the application records the people the user meets along with other awareness information such as when where context etc. The user then meets a person while walking on the street. The person looks familiar but the user does not recall the person s name or how the user knows the person. The wireless node running the application reports that the person s name is David and that the user met him at a soccer match one year ago in London.

In another use case an application provides the capability to initiate local discussion threads and group chats over the ad hoc mesh network . For example the supporters of a football team form a community over the ad hoc mesh network wherein community members can send short text messages e.g. of small enough size to be sent directly over the ad hoc mesh network that can be received and read only by the fan club community members of that particular team.

By way of example the awareness services module includes three layers a awareness layer a community layer and a network layer . The awareness layer is the highest control layer for sharing awareness information. As shown in the awareness layer includes a control logic and item storage . The control logic for instance provides the logic for creating publishing subscribing to querying and or receiving awareness information over the ad hoc mesh network . The control logic can store the information that it either creates or receives in the item storage . In one embodiment the item storage represents at least in part the valuespace for storing published and subscribed information items. It is contemplated that the item storage may be of sufficient size to store all or a portion of the information that flows through the wireless node over a configurable period of time e.g. days months or years .

In exemplary embodiments the control logic enables querying and dissemination of awareness information by initiating the flooding of the query or information to neighboring wireless nodes within the ad hoc mesh network . For example upon receiving a query the wireless nodes in the local neighborhood that have the queried information may decide to reply to the querying node automatically. By way of example a reply message can be sent as a unicast message to the querying node or as a broadcast message to all nodes . Thus the replying node can control how information is delivered among the nodes in the network . Also the replying node can estimate whether all the possibly interested nodes in the network have had the opportunity to previously receive the reply and thus omit transmitting a reply message accordingly. In exemplary embodiments the reply information is also automatically stored in the item storage of each wireless node through which the propagating reply passes. Moreover the reply to a query may result in return of a pointer to specific content relevant to the query rather than the content itself under certain circumstances e.g. when the specific content is large in size . It is contemplated that the reply may contain direct content if the content is relatively small e.g. a few tens of bytes of information . By using a pointer the system minimizes the data traffic that flows through the ad hoc mesh network . The user may then access the content via the pointer e.g. a universal resource locator URL address IP address via a more appropriate communication protocol e.g. IP and or means of communication e.g. infrastructure networks . The receipt of the pointer e.g. IP address may automatically trigger the transfer of the content using for instance the communication protocol associated with the pointer. In the case of broadcasting or publishing information any wireless node through which the published information propagates may store the information in item storage or valuespace of the wireless node .

In other exemplary embodiments awareness information can also be published directly by flooding an awareness message. Such a push mode for the dissemination of awareness information can be used to support some applications e.g. advertising or group chatting over the ad hoc mesh network .

It is recognized that privacy and anonymity may be of concern to users of the system . Accordingly the control logic provides mechanisms for ensuring privacy and anonymity. For example the control logic can prevent the transmission of intimate information when the number of neighboring wireless nodes is small to prevent the possibility of inferring identity. As used herein the term intimate information refers to information directly related to the user e.g. the user s habits tastes or preferences musical preferences favorite restaurants etc. . In one embodiment the intimate information e.g. comprising user profile data may be transmitted using encryption so that only authorized nodes are able to access in the information.

The control logic together in co operation with the community layer may also periodically broadcast decoy queries and replies to make tracking an individual wireless node more difficult. Since an outside observer does not know the authentication key associated with a community the observer cannot distinguish a valid message from a fictitious one. Accordingly by observing decoy messages the observer is likely to detect presence of a private community when there is not one. Additionally the control logic enables to user to define filters for incoming information e.g. filter advertisements and how these filters would work e.g. ignore the information completely relay the information but do not store etc. . It is also contemplated that the user can direct the control logic to interact with the community layer to control the user s visibility on the ad hoc mesh network e.g. no visibility visible only to a certain community or other user to maintain privacy. As another mechanism for protecting privacy the control logic can interact with the community layer to anonymize a specific message and corresponding identifiers as described below with respect to the community layer .

Because one of the goals of the system is to provide a mechanism for anonymous spreading of awareness information it is recognized that undesired or unsolicited messages e.g. spam messages may become a problem. To address this problem the control logic may obtain for instance information from the lower system layers of the awareness services module about the traffic load and current average power consumption. If the traffic load is medium or high meaning that also power consumption related to system is medium or high restrictions may be set for the frequency at which flooding messages are sent by the control logic . It is also contemplated that the neighboring peer nodes can be configured to not forward any flooding messages originating from a node neglecting such message restrictions.

The awareness layer together with the community layer provide an application programming interface API to enable an application to access the functions of the control logic and the item storage . In exemplary embodiments the API enables application developers to have uniform and easy access to functions related to sharing awareness information over the ad hoc mesh network . It is contemplated that the API is extensible to accommodate any application designed to access or use awareness information. The applications in the various nodes do not have to be the same or mutually compatible. It is sufficient that the applications use the API correctly to be able to publish and search awareness information in the surrounding nodes and the applications share the same or matching data schema.

The awareness layer also has connectivity to the community layer . The community layer controls the formation and cataloging of communities of wireless nodes within the ad hoc mesh network . By way of example a user may create any number of communities for sharing awareness information. It is contemplated that a community may be either a peer community e.g. any wireless node may join a personal community e.g. a wireless node may join only if invited or the open local community that consists of all nodes in the local neighborhood. In one embodiment one or more communities may be formed to for exchanging information using a publish subscribe mechanism wherein the publishers and subscribers are members of the community. In exemplary embodiments the messages that traverse between the wireless nodes within the ad hoc mesh network belong to one of these three community types. Communities can either be private messages are encrypted or public no encryption used . In exemplary embodiments membership and status in a community affect how the wireless node shares awareness information see the discussion with respect to for additional details of community membership . For example a private community may be created for sharing published user profile data that may include personal data.

Furthermore a community may be created for any purpose or duration e.g. a permanent work community a permanent community of friends a temporary community of concert goers lasting only the duration of the concert . As shown in the community layer includes a community control module a community directory and an encryption decryption module . The community control module provides the logic for creating joining managing e.g. updating membership configuring settings and preferences setting privacy policies and deleting communities. The module also provides part of the API . In one embodiment the community layer provides information related to its management of communities and their respective members as context information coordinating information request messages over the ad hoc mesh embodiments. For example the context information provided may include information on when new nodes join or leave one or more of the communities along with respective community settings and configuration.

In some embodiments the community control module assigns a unique community identification number CID to each community for use within the ad hoc mesh network . The control module can also generate authentication keys K associated with the CID to for instance authenticate users who wish to join the community or authenticate messages directed to the community. For example a wireless node may invite another wireless node to join a community by transferring the CID and authentication keys associated with the community to the other wireless node . It is contemplated that the transfer of the CID and corresponding authentication key may occur using short range radio or using another secure mechanism e.g. short message service SMS or electronic mail . It is noted that both peer and personal communities use a CID and corresponding K whereas the open local community either can use a predetermined value for CID e.g. zero or does not use the CID at all.

To ensure privacy as discussed above the community control module interacts an encryption decryption module to anonymize the CID when including the CID in messages over the ad hoc mesh network . For example a wireless node may direct a query to a specific community using an anonymized CID e.g. a pseudonym associated with the community in lieu of the actual CID. In exemplary embodiments multiple anonymized CIDs may be used to represent a single community. In this way it is more difficult to identify queries corresponding to a particular community by monitoring traffic within the ad hoc mesh network . From the perspective of an outside observer the anonymized CIDs look random. In addition the encryption decryption module may encrypt or decrypt message data using for instance a temporary key that is periodically derived from the authentication key K associated with the CID. These measures hinder the discovery of the CID by outsiders that do not have the authentication key. By way of example the community layer inserts a special header into the messages that it receives from the awareness layer . The special header for instance contains a list of anonymized community identifiers corresponding to the communities to which the message is relevant.

When the wireless node is in the joined state the wireless node may also be in either an inactive state or an active state . To transition between the inactive state and the active state the application may issue a command to either activate or deactivate the joined state via the application programming interface . When the wireless node is in the inactive state the community layer abandons the message even though it is a member of the community. In certain embodiments the wireless node may also be invisible to other members of the community while in the inactive state . For example the wireless node may enter the inactive state when it temporarily does not want to receive or share information with the community. When the wireless node is in the active state the community layer encrypts and decrypts community messages as usual for private communities and enables all outgoing and incoming community specific messages for public communities e.g. communities with no restrictions on membership .

Within the active state the wireless node may also be in either an invisible state or a visible state . To transition between the invisible state and the visible state the application issues a command to set either the visible or invisible state. When in the invisible state the community specific identity e.g. a user alias associated with the wireless node cannot be queried by other members of the community. For example in the invisible state the community layer continues to receive and send community messages without its identity known to other community members. When in the visible state the identity of the wireless node can be queried by other members of the community.

In various embodiments the community directory of the community layer maintains for instance information on the communities that the user has joined. Such information contains at least the community identification CID . Additionally it may contain public and or private authentication keys K of the joined communities and a list of anonymized community identifiers for each community. The community control module may periodically recalculate the list of anonymized CIDs. By way of example the community layer inserts a header into the message it receives from the awareness layer . The header contains for instance a list of anonymized community identifiers identifying the communities to which the message is relevant.

It is contemplated that a special personal community can be reserved for tracking new bonds or relationships created between users. Consider for example that user A meets user B for the first time and wants to create a radio bond between the mobile devices corresponding to each user. In one embodiment user A can initiate the creation this bond with user B by transferring to user B e.g. by using a secure transfer mechanism the CID and the public K of user A s personal new bonds community. Similarly user B may give user A similar credentials corresponding to user B s new bonds community Once the credentials are exchanged and the bond has been created user A may find user B over the ad hoc mesh network by searching for members of user A s new bonds community. In other words with a simple search of a single community user A can search for all the people in user A s local neighborhood with whom user A has created a bond. This requires that a high number of community CIDs and Ks can be stored in the community directory . Also an effective lookup of the community directory must be provided. There are many existing and good solutions for such efficient lookup.

As the user creates new bonds the number community CIDs and Ks stored in the user s community directory can grow quite large. Accordingly to enable effective search of a large number of communities the community layer may generate a special community search message to initiate the search. For example the special community search message contains at least in part a list of anonymized community identifiers corresponding to the communities to be searched. To protect the privacy the community layer can generate a new set of anonymized community identifiers for each community search message. If the community layer finds a match to any of the anonymized community identifiers in any of the neighboring nodes that receives the search message the community layer generates a reply message that may contain the alias of the user in that community or other community specific information. The reply message may be encrypted with the encryption key of the community. In one embodiment the community search message may relate to queries and responses transmitted over the ad hoc mesh network in support of various embodiments of the publish subscribe mechanism described herein.

As shown in the community layer has connectivity to the awareness layer above and the network layer below. The network layer manages the rebroadcasting of received flooding messages and the routing of the unicast typically reply messages received by the wireless node . depicts a diagram of the components of the network layer according to an exemplary embodiment. The network layer includes a network control module routing table neighbor table message identification MID table and message table . The network control module directs the broadcasts of messages and information by managing and updating the routing table neighbor table MID table and message table . In certain embodiments the network control module may also assist in protecting the privacy and anonymity of users by periodically changing the network layer identification associated with the wireless node . It is noted that making such a change in the network layer identification between queries does not cause routing problems for replies because the routing information is recreated by each query in the ad hoc mesh network . In one embodiment the network layer provides context information for instance related to network topology network traffic exchanged messages published information etc. e.g. the routing table neighbor table the MID table the message table etc. to support coordination of information request messages as described below with respect to .

In exemplary embodiments the network layer may insert a header into messages it receives from the community layer to for instance direct flooding and routing of the received messages. The structure of this network layer message header is discussed with respect to . is a diagram of the data structure of a network layer message header according to an exemplary embodiment. As shown the message header contains the following fields 1 a TX field to identify the transmitter node ID NID of the last transmitting node 2 a SRC field to identify the source node ID of the node that originated the message 3 a DST field to identify the destination source ID of the intended recipient of a unicast reply message e.g. this field is give a value of zero when the message is a flooding messages 4 a MSN field to identify the message sequence number assigned by the source node 5 a hop count field that is incremented by one by each node that transmits the message and 6 a hop limit field that is decremented by one by each node that transmits the message If the hop limit field drops to zero then the a node does not retransmit the message. In certain embodiments the message header may also contain the following optional fields 7 a geographical limit field to designate the extent of the physical over which the message is intended to propagate e.g. the geographical limit field may contain a geographical position of the source node and a maximum flooding radius from that position 8 a temporal limit field e.g. the temporal limit field may contain the time when the message becomes obsolete and should be dropped and 9 a context limit field that defines the context beyond which the message is not intended to propagate e.g. a message related to a particular concert is not intended to extend beyond the concert venue .

Returning to the network layer also contains a routing table . In exemplary embodiments the routing table contains a listing of the node identification number NID of the originating wireless node e.g. source NID and the NIDs of the last known transmitters of the message. The purpose of the routing table is to enable the routing of the reply messages e.g. unicast messages back to the querying node that originated the query through a flooding message. As the message propagates through the ad hoc mesh network each subsequent wireless node that receives the message adds the NID of the last transmitter to the routing table to record the next hop neighbor towards the source node. The source node is marked as the destination node DST in the routing table. The update of the routing table is coordinated by the network control module . As shown in Table 1 the routing table lists the destination NID the transmitter NIDs associated with wireless nodes that have rebroadcasted a message. The network control module may also add additional information to the routing table like the time when the destination node was detected to be active the number of hops to the destination via a specific transmitter node. The network control module may use this information as additional parameters when it determines the best route to the destination node.

The neighbor table contains a list of the neighboring wireless nodes and an estimate of their relative radio distance see Table 3 . It is contemplated that the observed signal strength together with the known transmitting power of a neighboring wireless node is an indicator of the proximity of the wireless node and can be used to calculate the relative radio distance. The relative radio distance of the node from which the message was last received is then used as a criterion for whether or not the wireless node retransmits a received message. For instance a higher signal strength indicates closer proximity to the wireless node . The network control module monitors the signal strengths of neighboring nodes as the module receives messages from nearby devices and uses it to estimate the relative radio distance e.g. proximity of the transmitting node . It is also contemplated that the network control module may use any other mechanism for estimating the relative radio distance of neighboring nodes e.g. estimating location using global positioning satellite receivers or other positioning techniques .

In certain embodiments the network control module uses the proximity information to direct the routing and transmission of messages over the ad hoc mesh network . For example the system can reduce the potential for overloading the ad hoc mesh network by implementing a smart flooding scheme whereby only a few nodes retransmit a flooding message. Whether a node retransmits a flooding message can be dependent on the relative distance group e.g. very near near or far to which the node that is the transmitter of the message belongs. More specifically if the transmitting node is in the far or near group the receiving node can retransmit the flooding message. If the transmitting node is in the very near group the receiving node does not retransmit the flooding message. For each broadcast message received from a node in either the far or near group the network control module assigns a random delay time for relaying or rebroadcasting. The delay period for instance exhibits a distribution function based on the estimated relative radio distance as a way to randomize the delay period before transmission. The distribution should be chosen in such a way that the random delay is larger for those nodes that are near than for those that are far. This favors for instance nodes that are further away to relay the flooding message forward which results in better flooding efficiency smaller total number of transmissions . The use of a random delay time also prevents the unintended synchronization of message broadcasts as the message propagates over the ad hoc mesh network . For example unintended synchronization of the message broadcasts may result in too many nodes sending broadcasting i.e. flooding messages over the ad hoc mesh network at exactly the same time. Additionally the delay time provides an opportunity for the network control module to monitor and count rebroadcasts of the message by other neighboring wireless nodes .

The MID table contains a list of received messages. As the wireless node receives messages from neighboring nodes over the ad hoc mesh network the network control module uses the MID table to check whether the message has been received previously by for example comparing the MIDs in the MID table to that of the received message. The MID table also contains a flag indicating whether a message has been or is being transmitted by the node and the time when the entry was last updated. In exemplary embodiments the MID is the tuple SRC MSN where SRC is the NID of the source node and MSN is a message sequence number assigned by the source node. In this way the MID is a unique identifier of each message that propagates in the network . The network control module makes an entry in the MID table for all new messages that it receives. If the message has been scheduled for transmission the module increments the message counter in the message table see Table 4 .

The message table contains messages that the network control module has scheduled to transmit. For example as the node receives a flooding message that the network control module schedules for transmission the module updates the message table to include the message in the message table . Each entry in the message table contains the message itself the time when the message is scheduled to be sent and the number of receptions of the same message by the node see Table 4 . In exemplary embodiments a message is not relayed over the ad hoc mesh network if the number of times the message has been received exceeds a predefined limit. For example a message has the initial count of 0. In this example as a wireless node in the neighborhood is observed to transmit the message the message count associated with the message is increased. When the maximum message count is reached the network control module removes the message from the message table . The transmitter of each message is also associated with an estimated relative radio distance D indicating whether the transmitting node is within close proximity of the wireless node e.g. transmitting node is in the very near relative radio distance group or far from the wireless node e.g. transmitting node is in the far relative radio distance group . If the relative radio distance associated with the transmitting node indicates that the transmission of the message occurred very near the wireless node would not have to relay the message because it is assumed for instance that most of the other neighboring wireless nodes have already received the same message. By taking into account the relative radio distances of neighboring nodes the described smart flooding functionality leads to on average each flooding message being received for a few times by each node independent of the node density. The number of times a message is received by any one node affects the scalability of the network .

If the received message however is a unicast reply message that was addressed to the receiving node the network control module checks whether the destination node can be found in the routing table e.g. can be found from the destination field in the reply message or obtained from the source field of the query by the replying node . If found the routing table entry will give the NID of the neighboring node to which the reply message will be sent in the next opportunity. If the unicast transmission is not successful the next entry for the same DST will be used as the next try. If the received message is a unicast reply message that was not addressed to the receiving node and no acknowledgment from the intended receiver node was heard the node will store the message in the message table for scheduled retransmission. It is noted that unicast messages or acknowledgement messages that are not addressed to the node are normally received D2D radio layer see discussion of the D2D radio layer below but not by the awareness services module . However under certain circumstances the D2D radio layer can provide such messages to the awareness services module to schedule for retransmission. For example if no successful unicast or acknowledgement of the same message is observed by the time when the message is scheduled to be transmitted the node will transmit the unicast message to the intended recipient found from the routing table associated with the message. In this way the nodes that are not the intended recipients of the reply messages can assist in routing the message forward towards the correct destination.

As shown in the awareness services module has connectivity to a device to device D2D radio layer . The D2D radio layer enables the formation of the ad hoc mesh network and sharing of awareness information using for instance short range radio technologies such WLAN and Bluetooth . It is contemplated that the D2D radio layer may use any wireless technology for communication between devices over short ranges. The radio technology for instance enables each wireless node within the ad hoc mesh network to broadcast messages in a connectionless way to the neighboring nodes that are within radio range. As used herein the term connectionless means the wireless nodes need not use two way signaling to establish a communication channel before broadcasting a message. In exemplary embodiments the D2D radio layer may include multiple radios using one or more different technologies or protocols e.g. WLAN and Bluetooth simultaneously . A wireless node configured with multiple radios may act as a gateway node to span two or more sub networks serviced by the different wireless technologies. In this way messages broadcast on one sub network may be propagated to another sub network.

In exemplary embodiments the low latency requirements also enable saving power in the host processor e.g. as depicted in . For illustration the following description refers to the components of exemplary chip set of . The D2D radio layer is typically implemented in the ASIC module whereas the functionalities of the awareness services module can be implemented either in the ASIC or the processor . If the functionalities of the awareness services module are implemented in the processor power consumption is reduced by for instance having ASIC wake up the processor as infrequently as possible. By way of example the periodic operation of the D2D radio layer explained above enables the ASIC to collect all messages and send them to the processor at a frequency of once per active transmission period . The processor then processes all received messages and calculates new messages to be sent for the next active transmission period . The processor then sends the messages to the ASIC for transmission. Using this process a flooding message can make one hop e.g. travel from one node to another node per period which is fully acceptable for awareness information. In contrast potential delays of hundreds of milliseconds are not possible for example for voice traffic and these kinds of power savings cannot therefore be achieved in other communication systems transporting delay sensitive traffic.

By way of example the awareness services module can use the CIDs to locate and identify communities that are active e.g. transmitting or receiving community messages among one or more neighboring wireless nodes by 1 passively monitoring messages directed towards one or more communities over the ad hoc mesh network using the process described with respect to below 2 actively searching for one or more communities using a community search message as described with respect to below and or 3 actively searching for one or more members of the communities using a member search message as described with respect to . The awareness services module then updates a list of active communities based on the identification step . For example the list of active communities includes those communities to which the wireless node belongs e.g. communities that are private such as a community of personal friends and those communities that are public and open to all nodes e.g. a general community of all wireless nodes on the ad hoc network in which system wide messages may be exchanged .

In exemplary embodiments the awareness services module is continuously updating the list of active communities by for instance monitoring for messaging traffic over the ad hoc mesh network related to one or more of the active communities step . More specifically the awareness services module tracks whether there are any messages originating from or directed to one or more of the active communities over a predetermined period of time. In one embodiment the period of time can be dependent on the on the density or stability of neighboring wireless nodes . For example if the composition of the neighboring wireless nodes is changing rapidly the time period can be shorter. Similarly if the composition of the neighboring wireless nodes is more stable the time period can be longer. In either case the awareness services module observes whether there are any messages related to one or more of the active communities e.g. by checking the header information of the messages for CIDs corresponding to any of the active communities step . If no messages are observed over the predetermined period of time for a particular community the awareness services module designates that community as inactive and updates the list of active communities accordingly step . If a message related to a particular community is observed during the time period the community is considered to be still active and the awareness services module need not update the list of active communities. It is contemplated that the awareness services module can continuously or periodically perform the monitoring process to update the list of active communities.

After creating the message the awareness services module initiates broadcast of the message over the ad hoc mesh network step . In exemplary embodiments the community search message is equivalent to a query and is transmitted and replied to using the processes described with respect to below. As the message propagates over the ad hoc mesh network mobile devices that are members of one or more of the active communities associated with the anonymized CID or CIDs included in the message automatically respond to mobile device that originally sent the message. The awareness services module initiates receipt of the reply messages step . The reply message contains for instance a list of anonymized CIDs of those searched communities which have an active status in the replying node . Based on this list the awareness services module identifies each community in the list as an active community and updates the list of active communities in for instance the community directory step .

After the member search message is generated the awareness services module initiates broadcast of the member search message over the ad hoc mesh network step . In exemplary embodiments the member search message is equivalent to a query and is transmitted and replied to using the processes described with respect to below. As the message propagates over the ad hoc mesh network mobile devices that have one or more communities associated with the anonymized CID or CIDs in the visible state automatically respond to the mobile device that originally sent the message. If aliases corresponding to one or more users are also included in member search message mobile devices corresponding to the user aliases also respond. The awareness services module initiates receipt of the reply messages sent in response to the member search message step . The reply message includes for instance a list of anonymized CIDs plaintext or encrypted user aliases and possibly the plaintext or encrypted status e.g. activity state mode etc. of the community member. In certain embodiments the awareness services module uses the reply messages to update the list of visible community members in the local neighborhood step . In addition the awareness services module also uses the replies to identify active communities within the neighborhood and to update the list of active communities step . The updates are based for instance on the anonymized CIDs the community specific member identity e.g. alias o other member specific information included in the reply messages.

Moreover it is contemplated that the state of a community in a wireless node can be used to filter incoming messages. For example to block all incoming or outgoing messages a user can set the state of a community to inactive so that all messages from that particular community are disregarded. It is contemplated that a user belonging to multiple communities may independently set the visibility state for each community. By way of example to block incoming advertisements the user can set the state to inactive for the community sending the advertisements. It is also contemplated that the user can automatically set the visibility state based on criteria such as time e.g. to automatically set a visibility state at certain periods of the day location e.g. to automatically set a visibility state at certain locations such as work or school or any other context e.g. while in a meeting or at dinner .

In step the application within querying node generates a request for searching community information e.g. wireless nodes having active communities or communities with visible members over the ad hoc mesh network and sends the request to the community layer of the querying node . The community layer generates a community query message assigns a community query identification number CQID to the query message and prepares the query message for transmission over the ad hoc mesh network by marking the query with CIDs of the communities from which the user is seeking information. If the user seeks information on members of the communities and the communities are private the community layer encrypts the community specific user identity e.g. alias using the encryption keys associated with the respective CID and stored in the community directory . If the community directory contains recent information about active communities in other nodes then the community layer may return the community information step . The community layer then sends the anonymized and partly encrypted message to the network layer step .

The network layer assigns a message sequence number MID to the query message and adds fields to the network layer message header to indicate that the querying node is the source and transmitter of the query message e.g. using the NID . The network layer sends the query message to the D2D radio layer of the querying node for broadcasting in the ad hoc mesh network step .

The query message is then broadcasted to one or more relaying nodes step . All the nodes that are able to receive the broadcast message are relaying nodes. After processing by the relaying node the query message is rebroadcasted to another relaying node or to the replying node step . The processes of the replying node are described with respect to . After processing of the query message by the replying node a reply message is generated and sent to the relaying node step which routes the reply message either to another relaying node or to the querying node step based on the route stored in the routing table .

At the querying node the D2D radio layer receives and acknowledges the reply message and forwards the reply message to the network layer step . The network layer determines that the querying node is the intended destination of the reply message by checking the DST field in the network layer message header and sends the message to the community layer for processing step . In case of a private community the community layer decrypts the reply message using the appropriate encryption keys stored in the community directory . Based on the information in the reply message the community layer updates information in the community directory list of active communities and the lists of visible members in the communities and finally sends a service response to the query to the application step .

In step the D2D radio layer of the replying node receives the query message and forwards it to the network layer of the replying node . The network layer may decide to rebroadcast the query message step . On receipt the network layer forwards the query message to the community layer step .

If the community layer determines that the query message contains one or more anonymized CIDs of the active communities associated with the replying node and the query message contains encrypted user aliases the community layer decrypts the message and updates information in its community directory e.g. containing the list of active communities and the list of visible members of the communities . Next the community layer generates a reply message that contains the same CQID as the incoming query and has the source NID of the query message set as the destination NID of the reply message. If the query requests visible user aliases and the user alias in the node is set as visible then the community layer encrypts the user alias with the encryption keys associated with the community. The community layer then retrieves a new anonymized CID from the community directory and sends the reply message to the network layer step .

On receipt of the reply message the network layer assigns a new message sequence number MSN to the reply message attaches the NID of the replying node as the source and transmitter finds the NID of the relaying node for the next hop from the routing table sets the receive NID of the reply message as the next hop and sends the reply message to the D2D radio layer step . The D2D radio layer sends the reply message as a unicast message addressed to a relaying node over the ad hoc mesh network step .

Next the awareness services module determines at least one data schema or an instance of the at least one data schema associated with the information step . As previously discussed the data schema defines for instance the type and format of information that is to be sent or received by the requesting applications. By way of example the data schema may include field definitions data types data structures and the like associated with the information. In addition or alternatively the data schema may specify metadata for describing the types or formats of information requested by the application. In one embodiment the data schema is defined by the one or more applications making the request. It is contemplated that in one embodiment the applications may define more than one data schema or define multiple instances of the same schema in connection with publishing and or subscribing to information.

In yet another embodiment the subscription may also be associated with one or more filters. By way of example when an application initiates a subscription for information the application may provide subscription filters in addition to the data schema. Subscription filters specify further limitations to the subscription including for instance 1 values or value sets for files so that responses should contain the specified value constraints 2 time constraints e.g. time intervals when new information is provided to subscribing applications 3 environmental constraints e.g. information is made available to applications when neighboring nodes and or other characteristics of the ad hoc mesh network have changed above a given threshold.

After determining the at least one data schema the awareness service module initiates at least one instance of the data schema. For example initiation of the data schema may include determining to store the data schema in the valuespace of at least one corresponding wireless node of the ad hoc mesh network step . In one embodiment identification of the information for publication or subscription is based at least in part on the at least one data schema. In other words the data schema serves as criteria for associating published information against subscriptions for the information. The awareness services module then causes at least in part the valuespace to be made available for publication subscription querying or a combination thereof by one or more other nodes of the ad hoc mesh network .

For example to publish information the awareness services module initiates at least one instance of the data schema by for instance storing the data schema and corresponding information item s in the valuespace of the publishing wireless node . Then on the subscription side the awareness services module of a subscribing wireless node generates a subscription query including at least in part a target data schema that defines the information that subject to the description. In one embodiment the same applications need not be used to define the published data schema and the target or subscribed data schema. In other words a different application may be used to subscribe to information published by another application.

In some embodiments the awareness services module can generate a hash value by applying for instance a hash function to the data schema to reduce the amount of data that is to be included in the query or response messages transmitted over the ad hoc mesh network . It is also contemplated that any other form of compression may be used to reduce the memory size of the data schema message for transmission. Then the receiving wireless node can apply the same hash function or compression scheme to extract the data schema specified in either the query or response message. The process for subscribing to information over an ad hoc mesh network is described in more detail with respect to below.

If another wireless node receives the query message step the awareness services module of the receiving wireless node determines whether there are any information or data items it its valuespace that at least substantially matches the requested data schema. If there are matching information the awareness service module filters the matching data items from the valuespace and generates a response message based at least in part on the matching items step . It is noted that in one embodiment the awareness services module need not match all data types or formats specified in the data schema of the query message. Instead the awareness services module might match just one or more of the elements of the data schema e.g. compare only the name filed of a contact data structure while ignoring matches for the address fields to find responsive data or information items. The receiving wireless node then broadcasts the response message over the ad hoc mesh network step . If filtering was performed to generate the response the response message may also include the corresponding filter and or filter ID.

If the response message is received by the subscribing wireless node step the awareness services module determines whether the response message is a duplicate of one or more messages that have already been received step . If it is not a duplicate message the awareness service module determines whether the response message includes the same filter ID specified by the subscribing application step . If no filter ID is specified or the filter ID does not match the awareness services module determines to filter the information or data items from the response message step and then stores the data items in the valuespace of the subscribing wireless node step . If the filter ID matches or substantially matches the awareness services module stores the information or data items in the response message or indicated by the response message in the valuespace without further filtering. On storing the data items the awareness services module notifies the subscribing application or applications that the subscribed information is available in the valuespace and resets the query timer to determine when next to query for newly available published information step .

If at step the awareness services module determines that the response message is a duplicate message e.g. the same message has been relayed or received from another wireless node then the awareness services module disregards the message and resets and then restarts the query timer steps and .

At step the awareness services module determines whether to resend the query based on the query time. If it is time to resend the subscription query to search for newly available published information the awareness services module can then determine whether to combine the query message with other query messages originating from for instance other subscription instances or data schemas step . The query along with any specified filter to select from among responsive data items is then sent or broadcast over the ad hoc mesh network step . At the same time the query timer is restarted to continue the subscription query process step . In one embodiment the querying process is continued until a stop request is received step . In other embodiments the subscription may be associated with a specific duration or effective period. In this case the subscription querying process continues for the specified duration or until the subscription expires.

As previously described the wireless nodes e.g. nodes engaged in a publish subscribe process can optimize the signaling of its messages to reduce message traffic over the ad hoc mesh network . One process as described with respect to includes delaying queries for subscribed or published information. In step the node initiates a data schema instance to publishing and or subscribe to data items. Under the data schema instance the node publishes a data item associated with the data schema into its valuespace step . Shortly thereafter the node initiates its instance of the same or similar data schema step and also publishes a data item to its valuespace.

At step node initiates a query for published information responsive to its data schema instance. In one embodiment the query acts as a way to convey the subscription to other nodes e.g. nodes and . It is contemplated that one than one query can carry the subscription and that a single query can carry multiple subscriptions. Furthermore a query message may include multiple nested data items include subscription information one or more queries one or more query responses other data items e.g. including unrelated data items and or other messages or signaling information transmitted over the ad hoc mesh network . In this case the query is transmitted to both the node and node over the ad hoc mesh network . At step node receives the query but ignores the message because the specified data schema is unknown to it because it has not yet initiated a similar data schema instance. At step the node receives the same query and determines that it s publish item is responsive and transmits a response message received by both the node and node . The node receives the response and restarts its query time because it has received responsive information step . The node again ignores the message because it has not initiated an instance of a matching or substantially matching data schema step .

At step the node generates and transmits a query under its data schema instance. The node has responsive information and transmits a response message step . The node again ignores the message because it does not have an instance of a responsive data schema step . Meanwhile the response from the node is received at the node which also causes the node to restart its query timer because it has received responsive information based on its query . The response also reaches the node but is again ignored because the node does not have an instance of a responsive data schema step .

Next the node initiates data schema instance to subscribe to information related to the data schemas already initiated by nodes and step . The node generates and transmits a query message and starts its query time step . The query from the node is received at both the nodes and . Node generates and transmits a response step . At the response is received at node . Even though the response was broadcast in response to the query of the node the response nonetheless matches or substantially matches the subscription created the node that is carried in the query that is scheduled for retransmission at step . Accordingly the node restarts its query timer also at step which effectively delays the schedule retransmission to a later retransmission at . In this way the number of messages is advantageously reduced by delaying querying for additional information when the node already has the latest information based on the query of the node .

At step the node delays its scheduled second query because based on the response by the node to the query is responsive to the subscription initiated by the node . In this example the response is also responsive to the query of the node . Accordingly the nodes and both restart their respective query timers respectively at steps and . The restarting of the timer also effectively delays the original resending of the node s query step .

As a result the next query is effectively at step by the node based on for instance the ongoing query timers. The process then continues as previously described beginning with a response from the node with is then received at the nodes and . On receipt of the response the query timer s at the nodes and are restarted respectively at steps and . In this way the different query timers of the nodes effectively and advantageously timed to reduce overall messaging traffic arising from the various embodiments of the publish subscribe mechanism described herein.

As shown in the components include one or more applications e.g. applications with connectivity or access to the ad hoc network publish subscribe functionality . In this example the applications include any application executing at a wireless node that can request and or receive information over the ad hoc mesh network . In addition the publish subscribe functionality include the publish subscribe mechanism and its related functions and processes described with respect to above. For example the publish subscribe functionality provides publish and subscribe services to the applications . In one embodiment the publish subscribe functionality is specific to a particular wireless node e.g. acts on information requests from only those applications executing on a single wireless node . In one embodiment the components of are implemented in or refinements of the components described with respect to wherein e.g. the control logic of provides the publish subscribe functionality and or the query engine e.g. described below and the item storage of represents the published information and or the subscribed information .

In one embodiment any of the applications may publish information that the publish subscribe functionality stores in for instance the published information database . By way of example information within the system generally consists of an identification part an instantiated data schema and a value part published data which are then stored in the published information database . Accordingly an application may then subscribe to information from the published information database based on the information s data schema and or its value by specifying a subscription filter . The subscription is then stored in the subscribed information database . In one embodiment the published information database and the subscribed information database are part of the valuespace of the publish subscribe functionality of the corresponding wireless node .

In one embodiment subscriptions can generally be categorized as either a temporal subscription or a non temporal subscription. For example a temporal subscription provides information to the subscribing application periodically or according to a predetermined schedule. For example a temporal subscription may be used to subscribe to sensor readings e.g. a temperature reading that are determined at fixed intervals. A non temporal subscription provides information to the subscribing application when such information is available. For example a non temporal subscription to a blog post will provide information whenever such a post is published by the author.

In one embodiment the ad hoc network query engine implements the subscriptions e.g. temporal and non temporal subscriptions stored in the subscribed information database as a message exchange e.g. information request messages between nodes of an ad hoc mesh network . For example the query engine sends a query message for the subscribed information that spreads among the nodes of the ad hoc mesh network see also the above and below .

In one embodiment for temporal subscriptions that specify fixed or periodic intervals for obtaining the subscribed information the query engine generates and transmits the subscription query at the requested intervals. For non temporal subscriptions in one embodiment the query engine holds the corresponding subscription query and then determines when to transmit or trigger the subscription query based on context information concerning the ad hoc mesh network the nodes of the ad hoc mesh network and the like. For example the community layer and the network layer of the awareness services module can provide at least a portion of the context information for determining to when to transmit an information request message e.g. a query or a response to the query . In addition it is contemplated that query engine may also use other inputs such as published information and sensor information to determine when to transmit the information request message. In one embodiment the query engine can assign different weights to the various elements of the context information to determine when to transmit the information request message. The process for determining when to transmit information request messages is described in more detail with respect to .

The query engine then determines context information associated with at least a portion of the ad hoc mesh network one or more nodes within the at least a portion of the ad hoc mesh network or a combination thereof step . By way of example the context information may be based at least in part on network traffic network topology sensor information from the one or more nodes published information or any combination thereof. In one embodiment the context information comes from information that is already gathered as part of the operation and maintenance of the ad hoc mesh network . More specifically the community layer and the network layer of the awareness services module can provide such context information.

For example the community layer already collects and can provide context information such as which members e.g. nodes are reachable over the ad hoc mesh network . Similarly the network layer can provide context information such as 1 the number of neighboring nodes within a particular area of the ad hoc mesh network 2 the estimated number of total nodes in the network and 3 how dynamic the ad hoc network is such as how many neighboring nodes have changed e.g. join or leave the network and how the estimated size of the network is changing. It is contemplated that the community layer and the network layer may provide any information that is collected during their respective operation as context information that can be used by the query engine to coordinate the transmission of information request messages.

In one embodiment the community layer and the network layer collect the context information from data traffic that passes through a respective node . In another embodiment the community layer may also use its own community member detection protocol as described above. In addition in one embodiment the network layer has a larger view of the network topology and is therefore aware of nodes that are multiple hops away in the ad hoc mesh network .

Next the query engine determines whether weights are to be applied to the context information step . In other words different elements or pieces of the contextual information may have difference significances when determining when to trigger transmission of the information request messages. For example time since a last query might be one element of the contextual information and the number of new nodes joining the network might be another element. In this case one weighting scheme might give more weight to the number of new nodes because this might be more likely to result in new responsive information than the passage of time since a last query. If weights are to be applied the query engine determines respective weights for one or more elements of the context information step . If the weights exceed to a predetermined threshold value then the query engine proceeds to step to begin processing the information request messages for transmission. If the weights do not exceed the predetermined threshold then the query engine can continue to monitor for changes in the context information and return to step . In one embodiment the applications generating the information message requests may specify various contextual elements or types to consider and their weighting values.

If the decision at step is that no weights are to be applied the query engine can apply a simpler analysis of the contextual information. The query engine evaluates the context and determines whether it has changed such that triggering conditions are fulfilled. For example the query engine may determine whether a new node has joined the ad hoc mesh network step and transmission parameters associated with the subscription state that a query shall be sent if 1 a new node joins the network and 2 at least a given time interval has elapsed from the previous query step . If no new node has joined the network the query engine can continue to monitor for changes in the context information and return to step . If a new node has joined it is a possibility that the new node has new information that should be queried for responsiveness to an information request.

Accordingly the query engine can proceed to step to initiate a process to transmit the one or more information request messages based at least in part on the context information e.g. context meets predetermined criteria assigned weights of context elements exceeds a threshold value etc. . In other words the query engine evaluates the context information to determine the likelihood that new information is available over the ad hoc mesh network since the last query for information. If the likelihood reaches a certain threshold then the transmission of the information request messages can proceed.

In one embodiment the one or more information request messages are associated with one or more transmission parameters related to determining when to transmit the one or more information request messages. By way of example the transmission parameters may specify which of the contextual elements are to be considered when coordinating the transmission of associated information request messages. The parameters also may specify for instance criteria or thresholds for evaluating the contextual elements. For example one transmission parameter may be based on rate of messages e.g. number of message per a given period of time transmitted over the ad hoc mesh network and another parameter may specify the threshold rate. It is contemplated that the subscribing applications may specify any transmission parameter e.g. time message frequency network turnover etc. for use by the query engine in determining when to trigger information request messages.

In one embodiment to initiate the transmission process the query engine can optionally determine to optimize one or more of the information request messages for transmission step . For example the query engine can determine to concatenate at least a portion of the one or more information requests messages into a common message for transmission. More specifically the query engine any one or more concatenation strategies. In one embodiment the query engine may combine queries originating from different application subscriptions as a single query by concatenating the queries using the logical OR operation. If a node receiving the combined query has information about any of the query parts then it returns a reply combining that information. This advantageously minimizes the number of information request message e.g. query and reply messages . In another embodiment the query engine may include published information in a query message. Thus the query engine can at the same time both send its own published information and request for information in other nodes . If an application does not specify explicit transmission parameters for a subscription then the publish subscribe functionality and or the query engine may specify default transmission parameters for the subscription. A default transmission parameters may be e.g. a new node joins the ad hoc network AND at least 30 seconds has been elapsed from a previous query. 

In yet another embodiment the query engine may determine how the information request messages should be transmitted e.g. as broadcast message or a unicast message . For example the query engine may decide to send a reply as a broadcast message instead of a unicast message directed to the querying node . Thus the information can be delivered more widely in the ad hoc mesh network to reach other nodes that may potentially want the same information. Conversely the query engine may decide to send the reply as a unicast message if the replying node has just previously broadcasted the same information. Thus only the querying node will receive the information without burden other potential relaying nodes . In yet another embodiment the query engine may decide not to send a reply to a query if it has just delivered the information via a query message or a broadcast reply message.

Following the determination to transmit and or optimization of the one or more information request messages the query engine determines or causes at least in part transmission of the one or more information request messages over the ad hoc mesh network step . This transmission occurs using the process for propagating messages over the ad hoc mesh network described above.

As previously noted a periodic or temporal subscription indicates that an application requests the subscribed information periodically. In one embodiment information request messages for temporal subscriptions are coordinated without determining context information because they are time dependent. Instead the period information request messages are transmitted based on the specified frequency interval or schedule. At step an application of the querying node initiates a periodic subscription to information using the publish subscribe functionality . The publish subscribe functionality then requests that the query engine initiate a corresponding periodic query for the subscribed information step .

Accordingly the query engine initiates a periodic query timer. On expiration of the query time step the query engine transmits a the periodic subscription query that causes propagation of the query message over the ad hoc mesh network to the relaying node the replying nodes and and the query engine of the replying node . The query results in corresponding query reply messages from the replying nodes and which provide new information to the query engine of the querying node . If the replying nodes and respond with responsive information the query engine informs the application of the new information.

This process is then repeated periodically. Thus as the query timer expires again and is reset for the next query step the query engine causes another propagation of the query and resulting replies to generate new information .

As previously noted a non temporal subscription provides subscribed information the subscribing application whenever the information is available rather than on a fixed schedule or frequency. In one embodiment information request messages for non temporal subscriptions are coordinated by triggering the transmission of information request messages based at least in part on context information available over the ad hoc mesh network . At step an application of the querying node initiates a non temporal subscription to information using the publish subscribe functionality . The publish subscribe functionality then requests that the query engine initiate a corresponding query for the subscribed information step .

In this example the query engine generates a query for the subscribe information but does not immediately transmit it over the ad hoc mesh network . Instead the query engine waits to detect a change in the environment or context information of the ad hoc mesh network according to for instance the process of . On detecting such a change or when the context information indicates that it is appropriate to initiate the query the query engine transmits a the non temporal subscription query that causes propagation of the query message over the ad hoc mesh network to the relaying node the replying nodes and and the query engine of the replying node . The query results in corresponding query reply messages from the replying nodes and which provide new information to the query engine of the querying node . If the replying nodes and respond with responsive information the query engine informs the application of the new information. This process is then repeated as needed based on the context information and the subscription parameters.

The processes described herein for coordinating information request messages over an ad hoc mesh network may be advantageously implemented via software hardware firmware or a combination of software and or firmware and or hardware. For example the processes described herein may be advantageously implemented via processor s Digital Signal Processing DSP chip an Application Specific Integrated Circuit ASIC Field Programmable Gate Arrays FPGAs etc. Such exemplary hardware for performing the described functions is detailed below.

A bus includes one or more parallel conductors of information so that information is transferred quickly among devices coupled to the bus . One or more processors for processing information are coupled with the bus .

A processor or multiple processors performs a set of operations on information as specified by computer program code related to coordinating information request messages over an ad hoc mesh network. The computer program code is a set of instructions or statements providing instructions for the operation of the processor and or the computer system to perform specified functions. The code for example may be written in a computer programming language that is compiled into a native instruction set of the processor. The code may also be written directly using the native instruction set e.g. machine language . The set of operations include bringing information in from the bus and placing information on the bus . The set of operations also typically include comparing two or more units of information shifting positions of units of information and combining two or more units of information such as by addition or multiplication or logical operations like OR exclusive OR XOR and AND. Each operation of the set of operations that can be performed by the processor is represented to the processor by information called instructions such as an operation code of one or more digits. A sequence of operations to be executed by the processor such as a sequence of operation codes constitute processor instructions also called computer system instructions or simply computer instructions. Processors may be implemented as mechanical electrical magnetic optical chemical or quantum components among others alone or in combination.

Computer system also includes a memory coupled to bus . The memory such as a random access memory RAM or any other dynamic storage device stores information including processor instructions for coordinating information request messages over an ad hoc mesh network. Dynamic memory allows information stored therein to be changed by the computer system . RAM allows a unit of information stored at a location called a memory address to be stored and retrieved independently of information at neighboring addresses. The memory is also used by the processor to store temporary values during execution of processor instructions. The computer system also includes a read only memory ROM or any other static storage device coupled to the bus for storing static information including instructions that is not changed by the computer system . Some memory is composed of volatile storage that loses the information stored thereon when power is lost. Also coupled to bus is a non volatile persistent storage device such as a magnetic disk optical disk or flash card for storing information including instructions that persists even when the computer system is turned off or otherwise loses power.

Information including instructions for coordinating information request messages over an ad hoc mesh network is provided to the bus for use by the processor from an external input device such as a keyboard containing alphanumeric keys operated by a human user or a sensor. A sensor detects conditions in its vicinity and transforms those detections into physical expression compatible with the measurable phenomenon used to represent information in computer system . Other external devices coupled to bus used primarily for interacting with humans include a display device such as a cathode ray tube CRT a liquid crystal display LCD a light emitting diode LED display an organic LED OLED display a plasma screen or a printer for presenting text or images and a pointing device such as a mouse a trackball cursor direction keys or a motion sensor for controlling a position of a small cursor image presented on the display and issuing commands associated with graphical elements presented on the display . In some embodiments for example in embodiments in which the computer system performs all functions automatically without human input one or more of external input device display device and pointing device is omitted.

In the illustrated embodiment special purpose hardware such as an application specific integrated circuit ASIC is coupled to bus . The special purpose hardware is configured to perform operations not performed by processor quickly enough for special purposes. Examples of ASICs include graphics accelerator cards for generating images for display cryptographic boards for encrypting and decrypting messages sent over a network speech recognition and interfaces to special external devices such as robotic arms and medical scanning equipment that repeatedly perform some complex sequence of operations that are more efficiently implemented in hardware.

Computer system also includes one or more instances of a communications interface coupled to bus . Communication interface provides a one way or two way communication coupling to a variety of external devices that operate with their own processors such as printers scanners and external disks. In general the coupling is with a network link that is connected to a local network to which a variety of external devices with their own processors are connected. For example communication interface may be a parallel port or a serial port or a universal serial bus USB port on a personal computer. In some embodiments communications interface is an integrated services digital network ISDN card or a digital subscriber line DSL card or a telephone modem that provides an information communication connection to a corresponding type of telephone line. In some embodiments a communication interface is a cable modem that converts signals on bus into signals for a communication connection over a coaxial cable or into optical signals for a communication connection over a fiber optic cable. As another example communications interface may be a local area network LAN card to provide a data communication connection to a compatible LAN such as Ethernet. Wireless links may also be implemented. For wireless links the communications interface sends or receives or both sends and receives electrical acoustic or electromagnetic signals including infrared and optical signals that carry information streams such as digital data. For example in wireless handheld devices such as mobile telephones like cell phones the communications interface includes a radio band electromagnetic transmitter and receiver called a radio transceiver. In certain embodiments the communications interface enables connection to the communication network for coordinating information request messages over an ad hoc mesh network.

The term computer readable medium as used herein refers to any medium that participates in providing information to processor including instructions for execution. Such a medium may take many forms including but not limited to computer readable storage medium e.g. non volatile media volatile media and transmission media. Non transitory media such as non volatile media include for example optical or magnetic disks such as storage device . Volatile media include for example dynamic memory . Transmission media include for example twisted pair cables coaxial cables copper wire fiber optic cables and carrier waves that travel through space without wires or cables such as acoustic waves and electromagnetic waves including radio optical and infrared waves. Signals include man made transient variations in amplitude frequency phase polarization or other physical properties transmitted through the transmission media. Common forms of computer readable media include for example a floppy disk a flexible disk hard disk magnetic tape any other magnetic medium a CD ROM CDRW DVD any other optical medium punch cards paper tape optical mark sheets any other physical medium with patterns of holes or other optically recognizable indicia a RAM a PROM an EPROM a FLASH EPROM an EEPROM a flash memory any other memory chip or cartridge a carrier wave or any other medium from which a computer can read. The term computer readable storage medium is used herein to refer to any computer readable medium except transmission media.

Logic encoded in one or more tangible media includes one or both of processor instructions on a computer readable storage media and special purpose hardware such as ASIC .

Network link typically provides information communication using transmission media through one or more networks to other devices that use or process the information. For example network link may provide a connection through local network to a host computer or to equipment operated by an Internet Service Provider ISP . ISP equipment in turn provides data communication services through the public world wide packet switching communication network of networks now commonly referred to as the Internet .

A computer called a server host connected to the Internet hosts a process that provides a service in response to information received over the Internet. For example server host hosts a process that provides information representing video data for presentation at display . It is contemplated that the components of system can be deployed in various configurations within other computer systems e.g. host and server .

At least some embodiments of the invention are related to the use of computer system for implementing some or all of the techniques described herein. According to one embodiment of the invention those techniques are performed by computer system in response to processor executing one or more sequences of one or more processor instructions contained in memory . Such instructions also called computer instructions software and program code may be read into memory from another computer readable medium such as storage device or network link . Execution of the sequences of instructions contained in memory causes processor to perform one or more of the method steps described herein. In alternative embodiments hardware such as ASIC may be used in place of or in combination with software to implement the invention. Thus embodiments of the invention are not limited to any specific combination of hardware and software unless otherwise explicitly stated herein.

The signals transmitted over network link and other networks through communications interface carry information to and from computer system . Computer system can send and receive information including program code through the networks among others through network link and communications interface . In an example using the Internet a server host transmits program code for a particular application requested by a message sent from computer through Internet ISP equipment local network and communications interface . The received code may be executed by processor as it is received or may be stored in memory or in storage device or any other non volatile storage for later execution or both. In this manner computer system may obtain application program code in the form of signals on a carrier wave.

Various forms of computer readable media may be involved in carrying one or more sequence of instructions or data or both to processor for execution. For example instructions and data may initially be carried on a magnetic disk of a remote computer such as host . The remote computer loads the instructions and data into its dynamic memory and sends the instructions and data over a telephone line using a modem. A modem local to the computer system receives the instructions and data on a telephone line and uses an infra red transmitter to convert the instructions and data to a signal on an infra red carrier wave serving as the network link . An infrared detector serving as communications interface receives the instructions and data carried in the infrared signal and places information representing the instructions and data onto bus . Bus carries the information to memory from which processor retrieves and executes the instructions using some of the data sent with the instructions. The instructions and data received in memory may optionally be stored on storage device either before or after execution by the processor .

In one embodiment the chip set or chip includes a communication mechanism such as a bus for passing information among the components of the chip set . A processor has connectivity to the bus to execute instructions and process information stored in for example a memory . The processor may include one or more processing cores with each core configured to perform independently. A multi core processor enables multiprocessing within a single physical package. Examples of a multi core processor include two four eight or greater numbers of processing cores. Alternatively or in addition the processor may include one or more microprocessors configured in tandem via the bus to enable independent execution of instructions pipelining and multithreading. The processor may also be accompanied with one or more specialized components to perform certain processing functions and tasks such as one or more digital signal processors DSP or one or more application specific integrated circuits ASIC . A DSP typically is configured to process real world signals e.g. sound in real time independently of the processor . Similarly an ASIC can be configured to performed specialized functions not easily performed by a more general purpose processor. Other specialized components to aid in performing the inventive functions described herein may include one or more field programmable gate arrays FPGA not shown one or more controllers not shown or one or more other special purpose computer chips.

In one embodiment the chip set or chip includes merely one or more processors and some software and or firmware supporting and or relating to and or for the one or more processors.

The processor and accompanying components have connectivity to the memory via the bus . The memory includes both dynamic memory e.g. RAM magnetic disk writable optical disk etc. and static memory e.g. ROM CD ROM etc. for storing executable instructions that when executed perform the inventive steps described herein to coordinate information request messages over an ad hoc mesh network. The memory also stores the data associated with or generated by the execution of the inventive steps.

Pertinent internal components of the telephone include a Main Control Unit MCU a Digital Signal Processor DSP and a receiver transmitter unit including a microphone gain control unit and a speaker gain control unit. A main display unit provides a display to the user in support of various applications and mobile terminal functions that perform or support the steps of coordinating information request messages over an ad hoc mesh network. The display includes display circuitry configured to display at least a portion of a user interface of the mobile terminal e.g. mobile telephone . Additionally the display and display circuitry are configured to facilitate user control of at least some functions of the mobile terminal. An audio function circuitry includes a microphone and microphone amplifier that amplifies the speech signal output from the microphone . The amplified speech signal output from the microphone is fed to a coder decoder CODEC .

A radio section amplifies power and converts frequency in order to communicate with a base station which is included in a mobile communication system via antenna . The power amplifier PA and the transmitter modulation circuitry are operationally responsive to the MCU with an output from the PA coupled to the duplexer or circulator or antenna switch as known in the art. The PA also couples to a battery interface and power control unit .

In use a user of mobile terminal speaks into the microphone and his or her voice along with any detected background noise is converted into an analog voltage. The analog voltage is then converted into a digital signal through the Analog to Digital Converter ADC . The control unit routes the digital signal into the DSP for processing therein such as speech encoding channel encoding encrypting and interleaving. In one embodiment the processed voice signals are encoded by units not separately shown using a cellular transmission protocol such as enhanced data rates for global evolution EDGE general packet radio service GPRS global system for mobile communications GSM Internet protocol multimedia subsystem IMS universal mobile telecommunications system UMTS etc. as well as any other suitable wireless medium e.g. microwave access WiMAX Long Term Evolution LTE networks code division multiple access CDMA wideband code division multiple access WCDMA wireless fidelity WiFi satellite and the like or any combination thereof.

The encoded signals are then routed to an equalizer for compensation of any frequency dependent impairments that occur during transmission though the air such as phase and amplitude distortion. After equalizing the bit stream the modulator combines the signal with a RF signal generated in the RF interface . The modulator generates a sine wave by way of frequency or phase modulation. In order to prepare the signal for transmission an up converter combines the sine wave output from the modulator with another sine wave generated by a synthesizer to achieve the desired frequency of transmission. The signal is then sent through a PA to increase the signal to an appropriate power level. In practical systems the PA acts as a variable gain amplifier whose gain is controlled by the DSP from information received from a network base station. The signal is then filtered within the duplexer and optionally sent to an antenna coupler to match impedances to provide maximum power transfer. Finally the signal is transmitted via antenna to a local base station. An automatic gain control AGC can be supplied to control the gain of the final stages of the receiver. The signals may be forwarded from there to a remote telephone which may be another cellular telephone any other mobile phone or a land line connected to a Public Switched Telephone Network PSTN or other telephony networks.

Voice signals transmitted to the mobile terminal are received via antenna and immediately amplified by a low noise amplifier LNA . A down converter lowers the carrier frequency while the demodulator strips away the RF leaving only a digital bit stream. The signal then goes through the equalizer and is processed by the DSP . A Digital to Analog Converter DAC converts the signal and the resulting output is transmitted to the user through the speaker all under control of a Main Control Unit MCU which can be implemented as a Central Processing Unit CPU not shown .

The MCU receives various signals including input signals from the keyboard . The keyboard and or the MCU in combination with other user input components e.g. the microphone comprise a user interface circuitry for managing user input. The MCU runs a user interface software to facilitate user control of at least some functions of the mobile terminal to coordinate information request messages over an ad hoc mesh network. The MCU also delivers a display command and a switch command to the display and to the speech output switching controller respectively. Further the MCU exchanges information with the DSP and can access an optionally incorporated SIM card and a memory . In addition the MCU executes various control functions required of the terminal. The DSP may depending upon the implementation perform any of a variety of conventional digital processing functions on the voice signals. Additionally DSP determines the background noise level of the local environment from the signals detected by microphone and sets the gain of microphone to a level selected to compensate for the natural tendency of the user of the mobile terminal .

The CODEC includes the ADC and DAC . The memory stores various data including call incoming tone data and is capable of storing other data including music data received via e.g. the global Internet. The software module could reside in RAM memory flash memory registers or any other form of writable storage medium known in the art. The memory device may be but not limited to a single memory CD DVD ROM RAM EEPROM optical storage magnetic disk storage flash memory storage or any other non volatile storage medium capable of storing digital data.

An optionally incorporated SIM card carries for instance important information such as the cellular phone number the carrier supplying service subscription details and security information. The SIM card serves primarily to identify the mobile terminal on a radio network. The card also contains a memory for storing a personal telephone number registry text messages and user specific mobile terminal settings.

While the invention has been described in connection with a number of embodiments and implementations the invention is not so limited but covers various obvious modifications and equivalent arrangements which fall within the purview of the appended claims. Although features of the invention are expressed in certain combinations among the claims it is contemplated that these features can be arranged in any combination and order.

