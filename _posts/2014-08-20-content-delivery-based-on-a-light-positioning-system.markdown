---

title: Content delivery based on a light positioning system
abstract: Systems an methods are provided that disclose providing a positioning service for devices based on light received from one or more light sources. This light based positioning service uses light information transmitted by each light source to determine the position of the device. The positioning information can include three dimension position information in a building that can then be used to deliver services and information to a mobile device. The content delivered to a mobile device can include multimedia, text, audio, and/or pictorial information. The positioning information along with other location or positioning information can be used in providing augmented reality or location aware services. The light sources can be independent beacons that broadcast information in visible light at a rate that is undetectable by the human eye. Content can be retrieved from a server over a communications connection.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09055200&OS=09055200&RS=09055200
owner: BYTELIGHT, INC.
number: 09055200
owner_city: Boston
owner_country: US
publication_date: 20140820
---
This application is a continuation of U.S. patent application Ser. No. 13 369 147 filed Feb. 8 2012 which claims the benefit of and priority to U.S. Provisional Patent Application No. 61 567 484 filed Dec. 6 2011 the entire disclosure of each of which is hereby incorporated herein by reference.

This disclosure relates generally to a system and method for providing content to a mobile device based on light positioning information determined from light received from one or more light sources.

Indoor positioning services refers to methods where networks of devices and algorithms are used to locate mobile devices within buildings. Indoor positioning is regarded as a key component of location aware mobile computing and is a critical element in providing augmented reality AR services. Location aware computing refers to applications that utilize a user s location to provide content relevant to that location. Additionally AR is a technology that overlays a virtual space onto a real physical space. To successfully enable AR and location aware computing accurate indoor positioning is a key requirement.

Global Positioning Systems GPS loses significant power when passing through construction materials and suffers from multi path propagation effects that make it unsuitable for indoor environments. Techniques based on received signal strength indication RSSI from WiFi and Bluetooth wireless access points have also been explored. However complex indoor environments cause radio waves propagate in dynamic and unpredictable ways limiting the accuracy of positioning systems based on RSSI. Ultrasonic techniques US which transmit acoustic waves to microphones are another method which can be used to approximate indoor position. They operate at lower frequencies than systems based on WiFi and attenuate significantly when passing through walls. This potentially makes US techniques more accurate than WiFi or Bluetooth techniques.

Optical indoor positioning techniques use optical signals either visible or infrared and can be used to accurately locate mobile devices indoors. These are more accurate than the approaches mentioned previously since optical signals are highly directional and cannot penetrate solid objects. However this directionality limits the potential reliability of optical signals since difficulty in aligning the receiver and transmitter can occur.

Some embodiments disclose a method of determining a position of a camera enabled mobile device when it is indoors at a server the server using at least one identification code broadcast from light sources in modulated light the method including receiving at the server the at least one identification code from the camera enabled mobile device determining based on the at least one identification code and geo location information received from the mobile device a map that identifies positions of light sources in a building wherein the geo location information includes a geographical location of the camera enabled mobile device calculating based on the at least one identification code and the map that identifies locations of the light sources indoor position information that identifies the location of the camera enabled mobile device within the building and sending the indoor position information to the camera enabled mobile device to enable the camera enabled mobile device to locate itself within the building.

Certain embodiments disclose a method of providing indoor position information and associated selected content to a camera enabled mobile device from a server based on light source identification codes broadcast from light sources in modulated light the method including receiving at the server at least one identification code from the camera enabled mobile device calculating based on the at least one identification code and on a map that identifies locations of the light sources indoor position information that identify the location of the camera enabled mobile device within a building and selecting location specific content that provides information based on the location of the camera enabled mobile device within the building.

Other embodiments disclose a server configured to provide indoor position information and associated selected content to a camera enabled mobile device based on identification codes broadcast from light sources in modulated light the server including an interface configured to receive at least one identification code from the camera enabled mobile device a memory that is configured to store identification codes at least one map and location specific content and a module running on a processor that is configured to determine based on the at least one identification code and on a map that identifies locations of the light sources indoor position information that identifies the location of the camera enabled mobile device within a building and is configured to communicate with memory to retrieve the map and light source identification information as well as location specific content.

Systems and methods are provided that disclose providing a positioning service for devices based on light received from one or more light sources. This light based positioning service uses light information transmitted by each light source to determine the position of the device. The device captures the one or more light sources and is then able to detect the information transmitted by each of the light sources. The light information can include an identification code that is used to identify the position of the light source. By capturing more than one light source on the device the accuracy of the device s position can be improved. The position information can then be used to provide relevant content information to the user. The light sources are each independent beacons that transmit individual identification information through light.

In some embodiments light sources are used to provide an indoor positioning service to mobile devices. Each light source is given an identification code corresponding to an associated database which contains information that ties the light source to specific location data. The identification codes are broadcasted through visible light by modulating the LED light source. The modulation occurs at speeds that are undetectable by the human eye yet appropriate to be received by a camera equipped mobile device. The mobile device receives the identification information and uses it to lookup its indoor position in the form of location data. Since the identification information is transmitted through visible light which is highly directional the mobile device is known to be within the line of sight of the LED light source. Since the indoor position of the LED light source is known from building floor plans and lighting plans the corresponding indoor position of the mobile device can be determined.

Another embodiment describes a scenario where a mobile device is in view of three or more LED light sources. Each source emits unique identification information and with knowledge of the relative positions of each LED light source one can calculate the device s relative position in three dimensions. This process utilizes photogrammetric image processing techniques to identify and calculate coordinates for the positions of the light sources in order to relatively locate the mobile device.

Yet another embodiment describes a system by which a mobile device can receive content based upon identification information received from either one or more LED light sources. The identification information is used to access a database that correlates LED lights and content. An example of such a use case would be a mobile device user in a museum who receives identification information from a light source illuminating an exhibit and then uses the received identification information to obtain additional content about the exhibit.

Light is a modulated LED light source and is part of the visible electromagnetic wireless spectrum. LEDs are considered digital devices which can be rapidly switched on and off to send signals above the rate which the human eye can see. This allows them to be exploited to send digital data through the visible light itself. By modulating the LEDs turning them on and off rapidly one can send digital information that is unperceivable to the human eye but is perceivable by applicable sensors including but not limited to image sensors and other types of photosensors.

There are many modulation techniques used to send information through light . One technique On Off Keying OOK is a scheme to transmit digital data by rapidly switching a signal source on and off. OOK is the simplest form of amplitude shift keying ASK which is a modulation technique that represents digital data through either the presence or absence of a carrier wave. When communicating with visible light the carrier wave takes the form of the transmitted light signal. Therefore at a rudimentary level when the light signal is turned on a digital one is perceived and when the light signal is turned off a zero is perceived. Furthermore the rate at which the light signal is turned on and off represents the modulation frequency. Note that regardless of changing the modulation frequency the carrier wave remains unchanged as this is an inherent property of the light itself. For example the carrier wave corresponding to a blue light signal is uniquely different than the carrier wave corresponding to a red light signal. While these two signals differ only in the wavelength specific to their perceived color they can be perceived as two discrete signals.

In addition to OOK another possible technique is defined as Digital Pulse Recognition DPR . This modulation technique exploits the rolling shutter mechanism of a complementary metal oxide semiconductor CMOS image sensor. Due to their superior energy efficiency CMOS sensors are preferred to charged coupled device CCD sensors on mobile devices. When a CMOS image sensor with a rolling shutter takes an image it does not expose the entire image simultaneously. Instead the rolling shutter partially exposes different portions of the frame at different points in time. Typically this causes various unwanted effects skew wobble and partial exposure. In the presence of an LED light driven by a pulse width modulated signal images received from a CMOS sensor exhibit residual banding in the form of visible distortions. The image appears to have alternating dark white stripes. The stripes are a direct result of the rolling shutter mechanism and their width is proportional to the frequency of the pulse width modulated PWM signal. Higher frequencies correspond to narrower stripes and lower frequencies result in wider stripes. Practical frequency ranges for use with this technique are between 60 Hz and 5000 Hz. This technique allows one to exploit the rolling shutter mechanism to recover digital data from an optically encoded signal.

DPR has the potential for much higher data rates than both OOK and frequency shift keying FSK . In FSK and OOK the camera s frame rate limits the data rate. The highest possible data rate is half of the frame rate since each symbol spans over two frames. In DPR modulation a single frame is sufficient for capturing the transmitted symbol. Furthermore symbols are not binary there are can be as many as 30 different possibilities for a symbol.

In the DPR modulation scheme image processing is used to measure the stripe width of the recorded image. By successively changing the LED driver frequency for each frame information is essentially transmitted through recognition of the band widths. In the current design 10 separate frequencies are used. For a 30 frames per second FPS camera this corresponded to an effective data transfer rate of 100 bits per second bps .

Both of these techniques are interesting because they can allow the transmission of information through single color light sources instead of having to create lighting sources which contain multiple color lights. In the world of LED lighting products white light is majorly achieved by layering a phosphorous coating on top of blue LEDs. The coating creates the visible perception of white light instead of blue. The alternative to this can be achieved through combining red green and blue LED lights however this approach is expensive and power inefficient as the lumens per watt properties differ between different colored LEDs. Blue LEDs are generally more energy efficient than their red and green counterparts which is why they are used in most commercial LED lighting products. It is because of this reason that it makes the most sense to use a data modulation technique that uses a single wavelength of light rather than multiple because this complies with LED lighting products.

In addition to LED light sources other types of light sources are also capable of transmitting information through modulation. Alternative incandescent and fluorescent technologies can also be exploited to achieve data transmission however the circuitry is more complex because the turn on and turn off times of incandescent and fluorescent lights are subject to additional factors.

The modulation frequency of the light source is highly dependent on the receiving circuitry. While incandescent and fluorescent technologies generally do not flicker on and off during the course of normal operation LED lighting sources are sometimes designed to flicker above the rate which the eye can see in order to increase their longevity and consume less power. Most humans cannot see flicker above 60 Hz but in rare instances can perceive flicker at 100 Hz to 110 Hz. To combat this lighting manufactures design flicker above 200 Hz into their lighting products.

Mobile device can be a smart mobile device and is most commonly found in the form of mobile phones tablets and portable laptop computers. In order for a mobile device to receive information from the LED light source it has an embedded or attached sensor which is used to receive the incoming light signals. One such sensor is a camera which has a typical frame refresh rate between fifteen and sixty frames per second fps . The fps is directly related to the speed at which optical signals can be transmitted and received by the camera. The sensor can capture a number of successive image frames that can later be analyzed to determine if a light source is providing information through light.

Mobile device can include a processor module memory and sensor in order to capture and analyze light received from light sources. The mobile device can analyze the successive image frames captured by the sensor by using the module. The module can be logic implemented in any combination of hardware and software. The logic can be stored in memory and run by processor to modify the successive images and analyze the successive images to determine information encoded in the light of one or more light sources. The module can be built in to the mobile device to provide the capabilities or it can be downloaded and installed. The module can be an application that runs on the mobile device when selected by a user. The module can also be used to receive content and other information related to the position of the mobile device and to provide this content to other modules or to the mobile device.

The reception of optically transmitted information is particularly interesting when used as an indoor positioning system. In a light based positioning system the physical locations of light sources can be used to approximate the relative position of a mobile device within line of sight. On the mobile side in addition to a receiving module the mobile device can use information to determine position of the mobile device. The mobile device can access a data source containing information about where the lights are physically located to determine position. This data source can be stored locally or in the case where the mobile device has a network connection the data source could be stored on an external server .

For scenarios where a network connection is not available before entering an indoor space the mobile device could optionally download a map pack containing the information used to locate itself indoors instead of relying on an external server . In order to automate this process the mobile device would first use an alternative existing technique for resolving its position and would use the gained location information to download the appropriate map pack. The techniques for receiving geo location information include for example GPS GSM WiFi user input accelerometer gyroscope digital compass barometer Bluetooth and cellular tower identification information. These techniques can also be used to fill gaps between when a position of the mobile device is determined using the light based technique. For example a mobile device can be placed at times so its camera does not capture light sources. Between these times these alternative existing techniques can be used for filling in position and location information that can be helpful to the user. The map pack would contain a map of the indoor space the user is entering locations of the lights from some sort of existing or third party lighting plan and any location dependent content for the mobile device to consume. Any requests for location information would simply access data stored locally on the mobile device and would not need to access a remote server via a network .

In terms of the experience when using a light based positioning system the indoor location reception and calculation can happen with little to no user input. The process operates as a background service and reads from the receiving module without actually writing them to the display screen of the mobile device. This is analogous to the way WiFi positioning operates signals are read in a background service without requiring user interaction. The results of the received information can be displayed in a number of ways depending on the desired application. In the case of an indoor navigation application the user would see an identifying marker overlaid on a map of the indoor space they are moving around in. In the case of content delivery the user might see a mobile media images text videos or recorded audio about the objects they are standing in front of.

In scenarios where the mobile device is in view of several light sources it can receive multiple signals at once. is a representation of a mobile device receiving identification information from multiple LED light sources . Each light source is transmitting its own unique piece of information. In order to identify its position or receive location based content the mobile device can then use the received information to access a database containing information about the relative positions of the LED light sources and any additional content . When three or more sources of light are in view relative indoor position can be determined in three dimensions. The position accuracy decreases with less than three sources of light yet remains constant with three or more sources. With the relative positions of lights known the mobile device can use photogrammetry to calculate its position relative to the light sources.

Photogrammetry is a technique used to determine the geometric properties of objects found in photographic images. In the context of locating mobile devices using light sources photogrammetry refers to utilizing the corresponding positions of LED light sources and their positions in 3 D space to determine the relative position of a camera equipped mobile device. When three unique sources of light are seen by the camera on a mobile device three unique coordinates can be created from the various unique combinations of and their relative positions in space can be determined.

For a mobile device equipped with an image sensor we can consider the following scenario. When multiple LED light sources appear in the image sensors field of view the sources appear brighter relative to the other pixels on the image. Thresholds can then be applied to the image to isolate the light sources. For example pixel regions above the threshold are set to the highest possible pixel value and the pixel regions below the threshold are set to the minimum possible pixel value. This allows for additional image processing to be performed on the isolated light sources. The end result is a binary image containing white continuous blobs where LED light sources are detected and dark elsewhere where the sources are not detected.

A blob detection algorithm can then be used to find separate LED light sources. A minimum of three separate LED blobs are used to resolve the 3 D position of a mobile device . Each LED blob represents a region of interest for the information reception and is simultaneously transmitting a unique piece of information via the modulated visible signal from the light source. For the purposes of reception each region of interest is processed independently of other regions of interest and is considered to be uniquely identifiable. A center of mass calculation for each region can be performed to determine the pixel coordinates of the center of each LED light source. This center of mass calculation is performed for each frame to track the regions of interest as they move around the image.

Once the regions of interest are established a detection algorithm captures multiple image frames for each region of interest in order to receive the visible light signal contained in each blob. For each frame in a detected region of interest a threshold algorithm determines whether the frame contains a 1 in the case of an aggregate pixel value above the threshold or a 0 in the case of an aggregate pixel value lower than the threshold . The threshold algorithm is used since the communication is asynchronous so the camera receiver period may overlap between the transmission of a 1 and a 0 from the LED light source.

The result of converting successive image frames in a region of interest to binary values is in essence a down sampled digital version of the signal received from the LED light source. Next demodulation of the down sampled digital signal is used to recover the transmitted bits. This down sampling is used due to the fact that the signal modulation frequency should be above the rate at which the human eye can see and the image sensor frame rate is typically limited to 15 30 fps.

At a lower level the mobile device processes data on a frame by frame basis. Each frame is split into separate regions of interest based on the detection of light sources. For each region of interest a thresholding algorithm is used to determine whether a given region is on or off . This is done by taking the average pixel value for the region and comparing it to the threshold value. If the region is on the demodulator assumes the light source has just transmitted a 1 . If the region is off the demodulator assumes the light source has sent a 0 . The result of this is the equivalent of a 1 bit analog to digital conversion ADC at a sampling rate which is equal to the frame rate of the camera.

After a frame is processed the results of the ADC conversation are stored in a circular buffer. A sliding correlator is applied to the buffer to look for the presence of start bits . If start bits are found the demodulation algorithm assumes it is reading a valid packet of information and proceeds to capture the rest of the transmission. Two samples are used for each bit so the algorithm creates a linear buffer that is twice the size of the remaining packet. Each subsequent ADC is written sequentially to the linear buffer. When the linear buffer is filled the demodulation algorithm performs a fast fourier transform FFT on the buffer to recover the transmitted signal.

Electrical connection is an electrical source that is used to supply power to the LED light source . This most commonly comes in the form of a 120 Volt 60 Hz signal in the United States and 230 Volt 50 Hz in Europe. While depicted in as a three pronged outlet it can also take the form of a two terminal Edison socket which the bulb is screwed into or a bundle of wires containing a live neutral and or ground. When considering other forms of lighting such as backlighting and accent lighting the electrical connection can also come in the form of a DC source instead of an AC source.

Most LED light sources contain an AC DC converter which converts the alternating current from the power source to a direct current source used internally by the components found inside the bulb or light source. The converter takes the alternating current source commonly found in existing lighting wiring and converts it to a direct current source. LED light sources generally use direct current therefore an AC DC converter is found in most lighting products regardless of form factor.

LED driver provides the correct amount of current and voltage to the LEDs contained inside the lighting source. This component is commonly available and can have either a constant current or constant voltage output. The LEDs found inside most lighting sources are current controlled devices which require a specific amount of current in order to operate as designed. This is important for commercial lighting products because LEDs change color and luminosity in regards to different currents. In order to compensate for this the LED driver circuitry is designed to emit a constant amount of current while varying the voltage to appropriately compensate for the voltage drops across each LED. Alternatively there are some high voltage LEDs which require a constant voltage to maintain their color and luminosity. For these cases the LED driver circuitry provides a constant voltage while varying the current.

Modulator serves the function of modulating the LED light source on and off to optically send light signals. The circuits comprising the modulator can simply consist of solid state transistors controlled by a digital input. In essence the modulator turns the LEDs on and off by allowing or preventing current flow. When current flows through the modulator with the switches closed the LEDs turn on and when the switches are open in the modulator no current can flow and the LEDs turn off. When the modulator is controlled by an additional logic component it has the ability to send repeating patterns of on off signals in order to transmit digital data through the visible light . The modulator interfaces directly in between the AC DC converter and the LED driver and is controlled by a microcontroller .

The microcontroller provides the digital input signal to the modulator unit . This function can also be achieved using a field programmable gate array FPGA but typically consumes more power with added complexity. The microcontroller s task is to send a pre determined sequence of signals to the modulator which then interfaces with the LED driver to modulate the outgoing visible light from the LED source . The microcontroller contains a nonvolatile memory storage area which stores the identification code of the light signal. Examples of possible nonvolatile memory sources include programmable read only memory PROM electrically erasable programmable read only memory EEPROM or Flash.

In regards to the microcontroller pins the microcontroller contains a digital output pin which is used to modulate the light output. To generate the output signal waveforms timer modules within the microcontroller are used. Typical logic levels for the digital output are 3.3V and 5V. This digital output feeds into the modulator which interrupts the driver circuit for the LED light source . Alternatively if the LED light source requires lower power such as backlighting or individual LED diodes the output of the microcontroller could also be used to drive the light sources directly.

The sequence of signals sent from the microcontroller determines the information which is transmitted from the LED light source . describes the information format of the optically transmitted information from the light . At the highest level each packet of information contains some sort of starting bit sequence which indicates the beginning of a packet followed by data and some sort of error detection identifier. The size and position of each portion of information is dependent on the application and is also constrained by requirements of the receiving device.

Each packet of information transmitted from the LED light source contains a sequence of starting bits followed by data and then terminated with an error detection code . Since the LED light sources are continually broadcasting information erroneous packets are simply discarded while the receiver listens for the starting bits indicating the beginning of the next packet. In cases where multiple sources of light are observed by a mobile device multiple pieces of information are received simultaneously.

Information describes the encoded information that is transmitted by the LED light source . The information is contained in a packet structure with multiple bits which correspond to numeric integer values. The data portion of the information packet can include unique ID codes . Currently the data size is set to 10 bits but can be of varying length. Each bit represents a binary 1 or 0 with 10 bits of data corresponding to 1024 possible values. This corresponds to 1024 unique possibilities of ID codes before there is a duplicate. The ID code can include location information in the ID code that provides a general indication of geographical location of the light. This geographical location information can be used to more quickly locate light source information that is used in determining indoor positioning on the mobile device. For example the geographical information can point to a database to begin searching to find relevant information for positioning. The geographical information can include existing location identifiers such as area code zip code census tract or any other customized information.

The ID code is static and is assigned during the calibration phase of the LED light source during the manufacturing process. One method to assign the ID code is to place instructions to generate a random code in the nonvolatile memory. Once the LED light source is powered on the microcontroller reads the ID code from the nonvolatile memory storage area and then uses this code for broadcasting each and every time it is subsequently powered on. Since the ID code is static once it is assigned it will be forever associated locally to the specific LED light source which contains the microcontroller .

Photosensors are devices which receive incoming electromagnetic signals such as light and convert them to electrical signals. In a similar fashion image sensors are arrays of photosensors which convert optical images into electronic signals. The ability to receive signals from multiple sources is an important benefit when using image sensors for receiving multiple optical signals.

Image sensor is a typical sensor which is found in most smart devices. The image sensor converts the incoming optical signal into an electronic signal. Many devices contain complementary metal oxide semiconductor CMOS image sensors however some still use charge coupled devices CCD . CMOS image sensors are the more popular choice for mobile devices due to lower manufacturing costs and lower power consumption. There are several tradeoffs to consider when choosing an image sensor to perform photogrammetry on multiple LED light sources . One tradeoff between the camera resolution and the accuracy of the photogrammetric process when triangulating between multiple light sources increasing the number of pixels will increase the accuracy. There is also another tradeoff between the data rate of the transmission and the sampling rate in frames per second of the camera. The data rate in bits second is half the frame rate of the camera e.g. a 30 fps camera will receive 15 bps . And finally when determining the length of the information packet the larger the size the longer the reception period as more bits generally requires longer sampling periods to capture the full message.

CPU is a generic CPU block found in most smart devices. The CPU is in charge of processing received information and sending relevant information to the network adapter . Additionally the CPU has the ability to read and write information to embedded storage within the mobile device . The CPU can use any standard computer architecture. Common architectures for microcontroller devices include ARM and x86.

The network adapter is the networking interface that allows the mobile device to connect to cellular and WiFi networks. The network connection is used in order for the mobile device to access a data source containing light ID codes with their corresponding location data . This can be accomplished without a data connection by storing location data locally to the mobile device s internal storage but the presence of a network adapter allows for greater flexibility and decreases the resources needed. Furthermore the network adapter is also used to deliver location dependent content to the mobile device when it is connected to a larger network .

Enclosed area is a spatial representation of an enclosed room containing four LED sources and two mobile devices meaning that they can operate next to each other without interference. As a rule of thumb if the received image feed from the mobile device sees one or more distinct bright sources of light it has the ability to differentiate and receive the unique information without interference. Because the light capture is based on line of sight interference is mitigated. In this line of sight environment interference can arise when light capture mechanism of the mobile device is blocked from the line of sight view of the light source.

Network represents a data network which can be accessed by mobile devices via their embedded network adapters . The networked can consist of a wired or wireless local area network LAN with a method to access a larger wide area network WAN or a cellular data network Edge 3G 4G LTS etc . The network connection provides the ability for the mobile devices to send and receive information from additional sources whether locally or remotely.

Location data is the indoor location information which matches the received information . The location data corresponds to indoor coordinates which match the ID code similar to how outdoor GPS tags known locations of interest with corresponding information. The location data could also contain generic data associated with the light identification information . This could include multimedia content examples of which include recorded audio videos and images. The location data can also vary depending on other criteria such as temporal criteria historical criteria or user specified criteria for example.

The temporal criteria can include the time of day. The historical criteria can include user location history e.g. locations visited frequently Internet browsing history retail purchases or any other recorded information about a mobile device user. The user specified criteria can include policies or rules setup by a user to specify the type of content they wish to receive or actions the mobile device should take based on location information. For example the user specified criteria can include how the mobile device behaves when the user is close to an item that is on sale. The user may specify that a coupon is presented to the user or information about the item is presented on the mobile device. The information about the item can include videos pictures text audio and or a combination of these that describe or relate to the item. The item can be something that is for sale a display a museum piece or any other physical object.

Server handles incoming ID codes and appropriately returns indoor location data to the mobile devices . The handling can including receiving incoming ID codes searching databases to determine matches calculating position coordinates based on the ID codes and communicating indoor location data . Since the LED light sources are acting as dumb one way communication beacons it is up to other devices to determine how to use the ID codes to calculate position information and deliver related content. In some embodiments the server can include the information used to link ID codes to physical spaces and to deliver location specific content. The server is designed to handle the incoming requests in a scaleable manner and return results to the mobile devices in real time.

The server can include one or more interfaces to the network that are configured to send and receive messages and information in a number of protocols such as Internet Protocol IP and Transmission Control Protocol TCP . The protocols can be arranged in a stack that is used to communicate over network to mobile device . The server can also include memory that is configured to store databases and information used in providing position coordinates and related location based content. The server can include one or more modules that can be implemented in software or other logic. These modules can perform calculations and perform operations to implement functionality on the server. The server can use one or more processors to run the modules to perform logical operations.

To describe the server interaction in more detail delves into location specific areas containing databases and web services . The areas represent a subset databases and web services for individual locations where there are installed LED light sources . The server directly communicates with these installations which have their own separate sets of information. At a high level databases represent the stored information pertaining to a specific area while the web services represent services which allow users customers administrators and developers access to the ID codes indoor locations and other information.

In order to send relevant information after each received ID code the server requests information pertaining to the specific area . Contained in each area are databases which contain information corresponding to the specific ID code . This information can take multiple formats and has the ability to be content specific to a variety of static and dynamic parameters.

In order to optimize response time the server can constrain its search space by using existing positioning technologies available to the mobile device or from information in the light source ID code depending on the embodiment. In essence the server looks for the lights IDs within a specific radius of the current approximate position of the mobile device and ignores those that are geographically irrelevant. This practice is known as geo fencing and dramatically reduces the request response time of the server . As final verification if the database contains one or more of the same IDs within the current search space that match the ID codes received by the mobile device within a specific time frame then a successful transaction can be assumed.

As seen in each database contains numerous sub categories which store specific types of information. The categories are labeled light IDs maps content and analytics .

Light IDs is a category which contains records of the individual light ID codes which are contained in an area . In a typical light positioning enabled installation there will be tens to hundreds of unique LED light sources broadcasting unique ID codes . The purpose of the light IDs database is to maintain and keep a record of where the ID codes are physically located in the area . These records can come in form of but are not limited to GPS latitude longitude and altitude coordinates which are directly mapped into an indoor space. For instance most indoor facilities have information about the number of installed lights how far apart they are spaced and how high the ceilings are. You can then match this information with building floor plans or satellite imagery to create a digital mapping of where each light is positioned.

To expand upon the Light IDs category additional information can come in the form of location specific maps . These maps can take on many physical and digital forms either directly from the management of the location or a third party vendor or outside source. In addition to mapping information location specific content and analytics are also contained inside the databases .

To deal with duplicate ID Codes additional distinguishing information can be contained inside of the individual log records ID 1 ID 2 and ID 3 . This information can contain additional records about neighboring ID Codes which are in physical proximity of the LED light source or additional sensor data including but not limited to accelerometer or gyroscope data WiFi triangulation or fingerprinting data GSM signature data infrared or Bluetooth data and ultrasonic audio data. Each additional sensor is an input into a Bayesian model that maintains an estimation of the current smartphone position and the uncertainty associated with the current estimation. Bayesian inference is a statistical method used to calculate degrees of probability due to changes in sensory input. In general greater numbers of sensory inputs correlate with lower uncertainty.

In order to calibrate the light based positioning system a user equipped with a specific mobile application will need to walk around the specific area . The mobile application contains map information of the indoor space with the positions of the LED light sources overlaid on the map. As the user walks around they will receive ID codes from the lights. When the user receives an ID code they will use the map on the mobile app to select which LED light source they are under. After the user confirms the selection of the light the mobile application sends a request to the server to update the light location contained in the lighting plan with the ID code . Additional user provided metadata including but not limited to current WiFi access points RSSI and cellular tower information can also be included with the server request to update additional databases.

In addition to manual calibration calibration of LED light source locations can also be achieved via crowd sourcing. In this algorithm as mobile application users move around an indoor space receiving ID codes they will send requests to the server containing the light ID code received the current approximate position based on other positioning techniques such as WiFi GPS GSM and inertial sensors and the error of the current approximation. Given enough users machine learning algorithms on the server can be used to infer the relative position of each LED light source . The accuracy of this calibration method depends heavily on the number of mobile application users.

Floor plan contains information about the floor plan for specific areas . The contained information can be in the form of computer aided drafting files scanned images and legacy documents pertaining to old floor plans. The information is used to build a model corresponding to the most recent building structure and layout. These models are subject to changes and updates through methods including but not limited to crowd sourcing models where users update inaccuracies third party mapping software updates and additional input from private vendors.

Lighting plan contains information about the physical lighting fixture layout electrical wiring and any additional information regarding the lighting systems in the area . This information can also come in a variety of physical and digital forms such as the floor plan information. The lighting plan information is used in the calibration process of assigning light ID codes to physical coordinates within an area . In essence a location with multiple LED light sources acts a large mesh network except in this case each node light ID is a non networked beacon of information that does not know about its surrounding neighbors. To help make sense of multiple light ID codes the lighting plan information is used as one of many ways to tell the backend server where LED light sources are located.

User provided information contains additional data that the user manually uploads in regards to building changes updates or new information that is acquired. The user in this case is most likely the facility manager or staff member but could also originate from an end user of the system who contributes via a crowd sourcing or machine learning mechanism. For instance if an end user was using a light based positioning system in a museum and was unable to find a particular exhibit or noticed inaccurate information in regards to location or classification of the exhibit they could red flag the occurrence using their mobile device . When coupled with data from additional users sometimes known as a crowd sourcing method this user provided information can be used to update and repair inaccuracies in the maps database.

Aggregated data contains information that is gathered by the system that can be used to augment the current information that is known about the mapping environment. This can occur during normal operation of the system where multiple mobile devices are constantly sending and receiving location data from the server . Over time the aggregation of this data can be used to better approximate how light ID codes correspond to the physical locations of the LED light sources . For instance if multiple mobile devices consistently receive a new ID code in a repeatable pattern with respect to additional known ID codes and other sources of location information then this information can be recorded and stored in the aggregated data database. This information can additionally be used to recalibrate and in essence self heal a light based positioning system.

User based content refers to content that is dependent on user criteria. The content can depend on but is not limited to user age sex preference habits etc. For instance a male user might receive different advertisements and promotions than a female world. Additionally age and past purchase habits could also be used to distinguish which is the correct piece of content to be presented to the user.

Dynamic content refers to content which changes with varying frequency. The content can change dependent on a temporal bases daily weekly monthly etc. For instance seasonal marketing and content could be automatically presented to the user dependent on the month of the year or content in the form of morning evening or nightly specials could be presented numerous times throughout the individual day.

In addition to content point of purchase information can be delivered as well. This could be implemented by using the received ID code to a secure connection which establishes and completes a transaction linked to a user s selected payment method. Additionally a standalone point of purchase feature could be implemented by simply linking ID codes directly to merchandise or services.

Dwell time refers to the time spent in each particular location inside of a specific area . Separate records are maintained for individual users and the dwell times are aggregated and sorted in the dwell time file. Path taken refers to the physical path taken by a user in each specific area .

As an example which combines many of the above descriptions consider an example involving a store owner that installed a light based indoor positioning system and a customer walking around the store using a mobile device capable of receiving optically transmitted information. The customer drives to the parking lot of the store parks and walks in. Using the background sensors and location services available to her phone as modeled in the customer s mobile device already knows that she has approached and most likely entered a store outfitted with a light based positioning system. Once this information is known the application running on the customer s mobile device initiates several background services and begins to start looking for optical signals as depicted in .

Prior to the customer entering the store the store owner has already calibrated and preloaded the database with the unique LED light sources map information pertaining to the store floor plan and user provided product locations and content in the form of multimedia and local deals in the form of promotions that can only be activated by visiting that particular section of the store.

In the meantime the customer is walking around the store looking to find particular items on her shopping list which she has already digitally loaded onto her mobile device . Next the customer is prompted by her mobile device that one of the items on her list has moved locations and an image of the store layout is displayed with a flashing icon indicating where her desired product has moved. The mobile phone can guide her to the new product. Then as soon as she gets close to the product an informational video is prompted on her screen detailing the most popular recipe and how it is prepared. And finally in addition to finding her desired product the customer receives a discount promotion for taking the time to seek out the new location of the product.

In addition to the services offered by this system to the customer the store owner now gains value from learning about the shopping experiences of the customer. This comes in the form of aggregated data that is captured and stored in the analytics section of his stores database . This example is one of many applications that can be enabled with an accurate indoor light based positioning system.

The next block sample image sensor refers to the act of turning on and reading data from the embedded image sensor in the mobile device . Receive ID is a decision block which either moves forward if a location ID is received or returns to sample the image sensor . Get location data corresponding to ID from server occurs once a location ID has been received. The mobile device queries the server asking for location data relevant to the ID code. This describes the process of a user obtaining an ID code from a non networked LED light source and using the unique identifier to look up additional information from either the server or a locally stored source.

Finally content is another decision block which determines if there is location based content associated with the received ID code. If content is available the process continues on to the last block where the content is queried if not the process ends. As described above the get content data corresponding to ID from server refers to the act of retrieving content data associated with a known location from either a server or local source.

Light positioning enabled is a decision block that moves forward if the mobile device is close to an enabled location or repeats the previous function if not. Initiate background service 2 is activated once the mobile device enters an enabled area. The service is tasked with initiating the functions that receive location information via the modulated light.

Sample ambient light sensor is the first function of the previous service which samples the ambient light sensor data as soon as the sensor detects a change. The function of this task is to determine if the sensor has gone from dark to light if the user takes the device out of a pocket or enclosure or from light to dark the user has placed the device inside of a pocket or enclosure. As an alternative to sampling the light sensor the algorithm could also look for a change in the accelerometer reading. This would correspond to the user taking the phone out of their pocket. Detect change is the decision block that moves forward if the ambient light sensor has gone from dark to light meaning that the mobile device is potentially in view of surrounding modulated light.

Sample alternative sources refers to the act leveraging existing alternative positioning technologies such as WiFi Bluetooth ultrasound inertial navigation or employing an existing service using one or more of any available services. Record internal sensor data is a task which records the current accelerometer data for a period of time before returning to the Sample image sensor block. This task is performed so that location information is constantly being collected even when modulated light is not being detected. This allows the mobile device and or server to keep track of the mobile device s position.

Each location contains multiple LED light sources each of which broadcast unique identification codes . In order to interact with the system from an operators perspective a mobile device can use the database service application which contains multiple privilege levels for different levels of access. The client privilege level determines read write permissions to each of these databases. These levels include users which refer to general front end system users administrators which are usually IT or operations management level within an installation developers which have access to the application programming interfaces of the system for use in custom application development and root level which contains master control over the users and access to everything contained in the system and databases.

Mobile devices in each location and receive identification codes from lights in their respective locations. They then send the received identification codes through the network which connects to database service application through user application and has read access to maps and content and write access to analytics . A generic client connects to database service application through network connection .

The client uses a password authorized login screen to access the respective permission status. Clients with administrator permissions have read write access to light IDs read access to maps read write access to content and read access to analytics . Clients with developer permissions have read access to light IDs read access to maps read write access to content and read access to analytics . A client with root permissions has read write access to databases .

As an overview describes the top down approach to our current implementation of a light based positioning system. At the highest level known locations of installed non network standalone LED light sources are used to accurately identify the relative position of mobile devices . In order to obtain identification information from the lights the background processes running on the mobile device have been described in . Once the mobile device has acquired a unique or semi unique ID code from the light or combination of lights it uses this information to query a database for additional information. This information can come in many forms and is used to create a more personalized experience for the user. As initially mentioned this local experience is used for location aware mobile computing and augmented reality applications. In addition to local personalized information location based analytics applications can be enabled from the aggregated data and traffic running through the server .

The use of light based positioning capabilities provide a number of benefits. For example the positioning information obtained by using light sources is highly precise compared to alternative techniques for positioning information. The accuracy of a light based positioning system can be down to a few centimeters in three dimensions in some embodiments. This positioning ability enables a number of useful services to be provided. In certain embodiments additional mobile device information can be used in combination with the positioning information. For example accelerometer position information can be used in conjunction with light source based position to offer augmented reality or location aware content that relevant to the device s position. The relevant content can be displayed to augment what is being displayed on the mobile device or the display can provide relevant information. Applications on the mobile device can also be launched when the mobile device enters certain areas or based on a combination of criteria and position information. The applications can be used to provide additional information to the user of the mobile device.

The light based positioning systems and methods can also be used to manage and run a business. For example the light based positioning can help keep track of inventory and to make changes to related databases of information. In a warehouse for example the light positioning system can direct a person to where a particular item is located by giving directions and visual aids. The light positioning can even provide positioning information to direct the person to the correct shelf the item is currently residing on. If the person removes the item the mobile device can update the inventory databases to reflect the change. The same function can be implemented in a store environment as merchandise locations are changed or updated. This information can then be used in providing content to a user. For example if a shopper wants more information about an item the updated location can be used to locate the item or direct the shopper to an online website to purchase an out of stock item. In some embodiments the mobile device using the light based positioning technique in conjunction with a wireless connection and other information can be used to provide non intrusive data collection on customers. The data collection of how customers move through a store and where they spend time can be used to improve layout of stores and displays of merchandise.

The light based positioning system are also easy and low cost to setup compared to other location positioning systems. Since each light source operates autonomously a building owner only needs to swap out existing light sources for those that provide light based information to a camera enabled device. The light sources are non networked independent beacons that broadcast identification codes configured when manufactured. This allows the light sources to be manufactured at a lower cost compared to networked light sources. Further the non networked independent beacon light sources in the light based positioning system can be easier for building owners to install.

The light based positioning system can also include optimizations in some embodiments. For example location information obtained from either the identification code or from alternative techniques can be used to reduce latency in determining position information. This optimization can work through geo fencing by constraining the search area to find information regarding the captured light sources more quickly. This can reduce the overall delay experienced by a user from the time the mobile device captures the light sources to when relevant position information is provide to the mobile device and or relevant content is provided to the mobile device.

The techniques and methods disclosed for use in light based positioning systems can be used with a variety of camera equipped mobile or stationary devices such as mobile phones tablet computers netbooks laptops desktops or custom designed hardware. Further the scope of the present invention is not limited to the above described embodiments but rather is defined by the appended claims. These claims represent modifications and improvements to what has been described.

