---

title: Domain join and managed directory support for virtual computing environments
abstract: A virtual computing environment service may receive a request from a customer to provision a virtual computing environment and join the virtual computing environment to a managed directory. The virtual computing environment service may provision the virtual computing environment and uses a set of administrator credentials from the customer and a set of credentials corresponding to the environment to access the managed directory and request joining of the environment to the managed directory. In response, the managed directory may create a computer account corresponding to the environment and which enables the environment to be used to access the managed directory. The virtual computing environment service may then enable the customer to specify one or more users that may utilize the virtual computing environment to access the managed directory.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09565190&OS=09565190&RS=09565190
owner: Amazon Technologies, Inc.
number: 09565190
owner_city: Seattle
owner_country: US
publication_date: 20141107
---
Virtual computing environments are often configured to join one or more managed directories to enable users of these environments to access particular data. For instance an administrator of a virtual computing environment may use a set of credentials to authenticate himself herself and perform one or more actions to join a virtual computing environment to a managed directory. An administrator can utilize environment deployment tools or server imaging tools to perform the domain join between the managed directory and the particular virtual computing environment. Alternatively this process can be performed manually wherein the administrator uses his her credentials through a graphical user interface or other application to join the virtual computing environment to a managed directory. However the process of performing the domain join between the virtual computing environment and a managed directory can be labor intensive adding expense and potential for error in the process.

In the following description various embodiments will be described. For purposes of explanation specific configurations and details are set forth in order to provide a thorough understanding of the embodiments. However it will also be apparent to one skilled in the art that the embodiments may be practiced without the specific details. Furthermore well known features may be omitted or simplified in order not to obscure the embodiment being described.

Techniques described and suggested herein relate to the joining of a virtual computing environment to a managed directory through domain join operations. In an embodiment an administrator associated with a customer through a virtual computing environment service requests provisioning of a virtual computing environment that may be utilized by the administrator and other designated users. The administrator may be required to provide a set of domain join credentials usable to identify the administrator and associated with an account specifying one or more permissions for accessing and creating computer objects within the directory. The domain join credentials may be utilized for causing the domain join of the virtual computing environment to a directory provided through a managed directory service or through the customer s on premises network. In response the virtual computing environment service may transmit through a virtual network interface associated with a customer virtual network provided by a virtual network service a request to the customer s managed directory domain controller to request creation of a computer account within the customer s managed directory.

Once the computer account associated with the newly provisioned virtual computing environment has been created within the customer s managed directory the administrator through the virtual computing environment service may add one or more user accounts to the newly provisioned virtual computing environment. For instance the administrator may add domain credentials associated with a user to a local e.g. relative to the virtual computing environment group to enable user access to the virtual computing environment. These credentials may be utilized by the customer s managed directory to determine whether the user is authorized to access particular data stored within the managed directory or perform other actions as defined by the administrator.

In an embodiment a user of a client provides to a set of domain credentials to an authentication server in order to access the newly provisioned virtual computing environment. The user may be associated with the customer through an employment relationship or other relationship. The authentication server may transmit these credentials to a domain controller of the customer s managed directory through a second virtual network interface associated with the customer virtual network provided by the virtual network service. If the managed directory domain controller is able to verify based on the provided credentials that the user is authorized to access the virtual computing environment the managed directory domain controller may provide the authentication server with a token specifying an Internet Protocol IP address of a network gateway usable to access the virtual computing environment. Additionally the managed directory domain controller may cause the virtual network interface to provide to the gateway an identifier corresponding to the user such that the gateway may be able to identify the user when he she attempts to access the virtual computing environment. The authentication server may provide the token to the user s client to enable access to the virtual computing environment.

Once the user s client has received the token from the authentication server the user s client may utilize the IP address specified within the token to establish a communications channel with the network gateway. The user s client may provide the received token to the network gateway which may be configured to determine whether the user is permitted to access the virtual computing environment. If the network gateway based on the token determines that the user is authorized to access the virtual computing environment the network gateway may establish a secure communications channel between the user s client and the particular virtual computing environment. Further the user may access the customer s managed directory through the virtual computing environment upon verification of the user s identity by the network gateway and the managed directory domain controller.

In this manner a user may be able to utilize his her own domain credentials to access a virtual computing environment joined to a customer s managed directory without requiring an administrator to manually perform the domain join process for the virtual computing environment and the customer s managed directory. In addition the techniques described and suggested herein facilitate additional technical advantages. For example because in some embodiments the credentials utilized to enable the domain join of the virtual computing environment to the customer s managed directory are not exposed to the user a user may only be required to use one set of credentials to not only access the virtual computing environment but also the customer s managed directory. Thus a user is not required to provide a secondary set of credentials to establish the domain join between the virtual computing environment and the customer s managed directory.

The customer may be an individual organization or automated process that could utilize one or more services provided by the computing resource service provider to provision and manage one or more resources to support his or her operations. The customer may further be an administrator or other domain user of a customer network which may include a plurality of computing hardware resources which may be located at least in part on the customer premises. In some embodiments the computing hardware resources that may be included within the customer network include hardware servers data storage devices network devices and other equipment such as server racks networking cables and the like. The customer may utilize these computing hardware resources to operate one or more services which may be utilized by a user through a user client to access computer system resources within the customer network . Accessing computer system resources may include creating resources updating resources deleting resources obtaining information about the resources and the like.

In an embodiment the customer network includes one or more directories which may be accessed by the user through the user client . These one or more directories may include customer data that may be accessible to authenticated entities such as the user through the user client . The customer network may provide access to customer managed directories by providing links to the customer directory locations such as by a uniform resource identifier URI object or some other such linkage. As may be contemplated the URI may be provided by a computer system client device operating within the customer network or by a process running at the data center or by a process running on a computer system connected to the datacenter or by a managed directory service or by a combination of these and or other such computer system entities. The customer network may further include a directory domain controller which may be configured to enable domain joining of one or more directories within the customer network and other computing environments. For instance a customer may utilize the directory domain controller to perform a domain join of one or more customer directories with one or more virtual computing environments or other computing environments.

Accordingly as illustrated in the environment includes a virtual computing environment service that may be provided by a computing resource service provider to its customers and other delegated users. The virtual computing environment service may comprise one or more physical hosts which may be used to instantiate one or more virtual machine images. Further the virtual computing environment that may be provisioned through the virtual computing environment service may be a single tenant e.g. usable by only a single user at a time desktop or other single tenant virtual computing environment which may not employ a desktop metaphor. These one or more virtual machine images may include an operating system and one or more applications that when instantiated may be installed on one or more physical hosts within the virtual computing environment service . As with the user client the virtual computing environment service may provide customers and other users with a virtual computing environment interface which may be used to interact with one or more applications available within the virtual computing environment.

In an embodiment a customer or other administrator accesses the virtual computing environment service to provision one or more virtual computing environments. Through an interface the customer or other administrator e.g. domain user may specify the operating system and other applications that may be included for each of these virtual computing environments. Further the customer or administrator may join these one or more virtual computing environments to his her directories within the customer network . For instance when a customer or other administrator provisions a virtual computing environment through the virtual computing environment service the customer or other administrator may configure the virtual computing environment to be a part of the customer virtual network which may be provisioned through use of a virtual network service provided by the computing resource service provider . Accordingly the customer or other administrator may associate a virtual network interface to the particular virtual computing environment and establish a connection between the virtual computing environment and the customer s directory within the customer network . Through the virtual computing environment service the customer or other administrator may provide particular environment credentials usable to access the customer network and define one or more users authorized to utilize the virtual computing environment. While a virtual computing environment service and virtual computing environments are used extensively throughout the present disclosure for the purpose of illustration other computing resources associated with other services may be joined with a customer s directory. For instance a customer or other administrator may provision a virtual machine instance through a virtual computer system service provided by a computing resource service provider. The customer or other administrator may configure the virtual machine instance to be part of the customer virtual network and establish the connection between the instance and the customer s directory.

When the customer or other domain user joins the virtual computing environment to the directory within the customer network the customer network may create a computer account within the computer network which may be associated with the newly provisioned virtual computing environment. Additionally the customer or other domain user may define through the virtual computing environment service one or more users that are permitted to utilize the virtual computing environment. The virtual computing environment may include one or more agents that are configured to verify user identities and establish a connection between the virtual computing environment and the customer network to enable access to the customer s directories.

Once the virtual computing environment has been provisioned and properly configured to enable access to the customer s directories a user through a user client may be able to access the virtual computing environment. For instance through the user client a user may be able to utilize a computing resource service provider interface to provide his her customer domain credentials and request access to the virtual computing environment. This interface may be associated with an authentication server which may be configured to provide through the user client the interface wherein a user may provide his her domain credentials. When the user through the user client provides his her domain credentials the authentication server may provide these credentials to the customer s directory domain controller which may be accessible through a virtual network interface provided by the virtual network service and associated with the customers virtual network .

The customer s directory domain controller upon receiving the domain credentials from the authentication server may determine whether the user is authorized to access the virtual computing environment and the one or more directories within the customer network . If the directory domain controller determines that the user is authorized to do so the directory domain controller may transmit a token to the authentication server which may specify one or more identifiers for the user and an IP address of a network gateway usable to access the virtual computing environment. Additionally the authentication server may transmit a notification to the computing resource service provider that the user has been authenticated and that communications are to be received from the user client . This may enable the computing resource service provider to configure the network gateway to expect certain communications associated with a particular identifier.

Once the user client receives the token from the authentication server the user client may establish a communications channel with the network gateway and provide the token to the network gateway. The network gateway based at least in part on the identifiers specified within the token may verify the identity of the user client and establish a communications channel with the virtual computing environment service and the customer s virtual computing environment. Further the virtual computing environment service may ensure that the virtual computing environment is connected through the customers virtual network to the customer network and the one or more directories associated with the virtual computing environment. This may enable the user through the user client to utilize the virtual computing environment to interact with data stored within these directories.

As noted above an authentication server may be utilized to obtain user domain credentials and authenticate this user based at least in part on communications with a directory domain controller of a customer network and the received credentials. If the user is authenticated the authentication server may provide the user with a token usable to access the customer s virtual computing environment through the virtual computing environment service. Accordingly shows an illustrative example of an environment in which a user is authenticated for access to a virtual computing environment through an authentication server based at least in part on a customer network directory domain controller in accordance with at least one embodiment. The virtual computing environment may include a virtual operating system desktop also known as a virtual desktop comprising an operating system and one or more applications that may be utilized within the desktop.

In the environment an authentication server may receive from a user client one or more domain credentials usable to access a customer network . The authentication server may transmit the received one or more domain credentials to an authentication conduit which may be configured to operate as a proxy server for transmitting the received domain credentials through a virtual network interface within a customer virtual network to a directory domain controller within the customer network . The virtual network interface may be attached to one or more computing resources within the customer s virtual network e.g. the authentication conduit which a customer may provision through a virtual network service . The virtual network interface may further include a public IP address which may enable communications between the customer s virtual network and the on premises e.g. customer data center or other customer facility customer network . Accordingly the authentication server through the authentication conduit and the virtual network interface may transmit the received user domain credentials to a directory domain controller within the customer network for user authentication.

When the directory domain controller receives the user s domain credentials from the virtual network interface the directory domain controller may access a user account data store to determine whether the user domain credentials are authentic and if so determine whether the user is authorized to access a virtual computing environment within a virtual computing environment service and through the virtual computing environment access the customer s directories within the customer network . Once the user has been authenticated and the one or more permissions determined the directory domain controller may provide an acknowledgment to the authentication server that the user has been authenticated and is authorized to access the customer s virtual computing environment and perform one or more actions. Additionally the computing resource service provider may receive a notification that the authentication of the user was successful. This may cause the computing resource service provider to initiate a customer virtual computing environment session within the virtual computing environment service and provide a notification to a network gateway associated with the virtual computing environment service specifying one or more identifiers associated with the user.

The authentication server may utilize the acknowledgment from the directory domain controller to generate a token which may specify one or more user identifiers and an IP address of the network gateway. This token may enable the user client to access the network gateway establish a communications channel with the network gateway and provide the received token to enable the network gateway to verify the identity of the user client. Once the network gateway is able to verify the user s identity through use of the token the network gateway may direct the user client to the newly established customer virtual computing environment session within the virtual computing environment service .

When the user client establishes a secure communications channel with the virtual computing environment the virtual computing environment through an agent operating within the virtual computing environment may transmit the machine credentials associated with the virtual computing environment to a second virtual network interface within the customer s virtual network . The second virtual network interface may provide these machine credentials to the authentication conduit which through the first network interface may transmit these machine credentials to the directory domain controller to enable the directory domain controller to verify that the virtual computing environment may be utilized to enable the user to access the one or more managed directories within the customer network . Thus if the machine credentials are determined to be authentic the directory domain controller may enable the virtual computing environment to access these managed directories through the second virtual network interface . The agent operating within the virtual computing environment may be configured to monitor the one or more managed directories to ensure that the request to join the virtual computing environment to the one or more managed directories is fulfilled. For instance if the machine credentials are not authentic or the domain credentials associated with the domain user are not valid the directory domain controller may deny the request to join the one or more managed directories to the virtual computing environment . The agent may receive a notification from the directory domain controller to this effect and cause the agent to notify the domain user of the issue. Further the agent may perform other actions to address such failures e.g. transmit notification to an administrator or the customer regarding the issue thereby enabling the administrator customer to perform any remedial actions .

In an alternative embodiment the customer maintains one or more managed directories through a managed directory service provided by the computing resource service provider. The managed directory service may provide directory services which may provide an authenticated entity access to the customer directories according to the authorization credentials and or policies. For example in an embodiment where a computer system entity may be authorized to read and write a certain data store on a customer directory the ability to do so may be provided by the directory services. Directory services may provide access to customer directories by providing links to the customer directory locations such as by a uniform resource identifier URI object or some other such linkage. As may be contemplated the URI may be provided by the computer system client device or by a process running at the data center or by a process running on a computer system connected to the datacenter or by the managed directory service or by a combination of these and or other such computer system entities. Thus when a user through the user client provides one or more credentials in order to access the customer s virtual computing environment the authentication server may verify through the managed directory service whether the user can be authenticated and is authorized to access the virtual computing environment. Accordingly shows an illustrative example of an environment in which a user is authenticated for access to a virtual computing environment through an authentication server based at least in part on user information within a managed directory service in accordance with at least one embodiment.

In the environment an authentication server may receive one or more sets of credentials from a user through his her user client. As opposed to the environment illustrated above in connection with wherein the authentication server may transmit the received credentials through an authentication conduit and a virtual network interface of the customer s virtual network to a directory domain controller within the customer network in the environment the authentication server may instead provide the one or more sets of credentials directly to a directory domain controller associated with a customer s managed directories managed by the managed directory service . The directory domain controller may include an authentication service which may authenticate credentials of a user computer system process automated process or other such entity to at least determine whether that entity is authorized to access the managed directory service and or the customer directories associated with the managed directory service . In some embodiments the credentials may be authenticated by the managed directory service itself or they may be authenticated by a process program or service under the control of the managed directory service or they may be authenticated by a process program or service that the managed directory service may communicate with or they may be authenticated by a combination of these and or other such services or entities.

Once the user has been authenticated the managed directory service may utilize authorization services included within the directory domain controller which may authorize a user computer system process automated process or other such entity to at least determine which actions of one or more possible actions that entity may perform. Examples of actions that an entity may or may not be authorized to perform include but are not limited to creating resources on the customer directory destroying resources on the customer directory attaching to resources on the customer directory detaching from resources on the customer directory providing access links to resources on the customer directory reclaiming access links to resources on the customer directory allowing reads from resources on the customer directory allowing writes to resources on the customer directory and or other such actions.

If the user can be authenticated and is authorized to perform one or more actions within the managed directory service and the customer virtual computing environment the managed directory service may provide the authentication server with a token specifying one or more identifiers for the user and an IP address of a network gateway usable to access the customer virtual computing environment within the virtual computing environment service . The authentication server may provide the token to the user client which may utilize the IP address specified within the token to establish a communications channel with the network gateway. For instance the user client may provide the network gateway with the token from the authentication server . The network gateway may utilize the one or more user identifiers specified within the token to verify the identity of the user and determine whether the user may access the customer virtual computing environment . If the user s identity can be verified the network gateway may establish a communications channel between the user client and the virtual computing environment .

Once the user has established a communications channel with the customer virtual computing environment the customer virtual computing environment may communicate with the managed directory service through a virtual network interface of the customer s virtual network to enable the user to utilize the virtual computing environment to access the one or more managed directories maintained within the managed directory service . The customer s virtual network may be provisioned by the customer through a virtual network service . The virtual network service may enable the customer to manage a virtual network comprising various computing resources provided by a computing resource service provider. Thus the customer s virtual network through use of one or more virtual network interfaces may facilitate communications between the virtual computing environment the managed directory service and the user client.

As noted above a user through use of a user client may utilize one or more sets of domain credentials associated with a customer network domain to access a virtual computing environment provided by a computing resource service provider. This virtual computing environment may be configured to access the customer network to enable use of one or more managed directories included therein. Accordingly shows an illustrative example of an environment in which a user client utilizes information from an authentication server to access a virtual computing environment in accordance with at least one embodiment. The user client can include any appropriate device operable to send and or receive requests messages or information over an appropriate network and in some embodiments convey information back to a user of the device. Examples of such client devices include personal computers cell phones handheld messaging devices laptop computers tablet computers set top boxes personal data assistants embedded computer systems electronic book readers and the like.

A user through the user client may utilize a computing resource service provider application to access the customer virtual computing environment provisioned by the customer through the virtual computing environment service . This application may be configured to interact with an authentication server to enable the user of the user client to provide his her customer domain credentials to the authentication server . The authentication server may utilize one or more standards for authentication and authorization of users such as the OAuth standard. For instance as noted above the authentication server may transmit the received domain credentials through a virtual network interface within the customer s virtual network to the customer s on premises network to authenticate the user and determine whether the user is authorized to access the customer s virtual computing environment . If the directory domain controller within the customer s on premises network is able to authenticate the user and determine that the user is authorized to access the customer s virtual computing environment the directory domain controller may transmit a notification to the authentication server acknowledging the user s identity and authorization to access the customer s virtual computing environment .

When the authentication server receives the notification from the directory domain controller the authentication server may generate one or more access tokens which may specify the identity of the user utilizing the user client any user group memberships within the virtual computing environment and the user s privileges within the virtual computing environment . Further the one or more access tokens may specify an IP address of a network gateway which may enable the user client to communicate with the network gateway to establish a communications channel through the network gateway with the customer s virtual computing environment . The network gateway may be configured to receive one or more notifications from the computing resource service provider upon authentication of the user. For instance the computing resource service provider may transmit a notification to the network gateway specifying one or more identifiers corresponding to the user and an IP address associated with the user client . The one or more identifiers may be the same identifiers specified within the one or more access tokens provided to the user client .

Once the user client receives the one or more access tokens from the authentication server the user client may utilize the IP address specified within these one or more access tokens to interact with the network gateway and attempt to establish a communications channel with the customer s virtual computing environment through the virtual computing environment service . The network gateway upon receiving the one or more access tokens from the user client may determine whether the one or more identifiers specified within the one or more access tokens correspond to the one or more identifiers provided by the computing resource service provider upon authentication of the user. For instance the network gateway may communicate with the authentication server to determine the validity of the one or more access tokens received from the user client . If the one or more access tokens are deemed valid the network gateway may determine whether the one or more identifiers match. If the identifiers match the network gateway may establish a secure communications channel between the user client and the customer virtual computing environment thus enabling the user client to access the customer virtual computing environment .

As noted above when a user through his her user client provides one or more sets of domain credentials to an authentication server the authentication server may transmit these credentials to a directory domain controller within a customer network to determine whether the user may be authenticated and is authorized to access the customer s virtual computing environment. If the user is authenticated and is authorized to access the virtual computing environment the authentication server may provide the user client with one or more access tokens which may enable the user client to establish a secure communications channel with the virtual computing environment and hence the customer s managed directories. Accordingly shows an illustrative example of a process for authenticating a user for access to a virtual computing environment joined to a managed directory in accordance with at least one embodiment. The process may be performed by the aforementioned authentication server which may be configured to enable users through user clients to provide one or more sets of domain credentials. Further the authentication server may be configured to communicate with a directory domain controller within a customer network through a virtual network interface component of the customer s virtual network provided by the virtual network service. Alternatively if the customer s one or more managed directories are maintained within a managed directory service provided by a computing resource service provider the authentication server may be configured to interact with this managed directory service to authenticate the user.

When a user utilizes his her user client to launch a computing resource service provider application to access the virtual computing environment the application may transmit a request to the authentication server such as through one or more application programming interface API calls to the authentication server to obtain one or more authentication interfaces. The authentication interface may enable the user to provide his her domain credentials for use within the customer network to the authentication server. For example if the authentication server utilizes the OAuth standard for authentication and authorization the authentication server may provide the user client with a Hypertext Transfer Protocol HTTP response in the form of one or more HyperText Markup Language HTML pages. These HTML pages may include one or more input fields which may be used by the user of the user client to input his her domain credentials. Thus the authentication server through these HTML pages or other response may receive the one or more sets of credentials from the user client.

Once the authentication server has received the one or more sets of credentials from the user client the authentication server may determine whether the customer s one or more managed directories are maintained within a managed directory service or reside in the customer s on premises network. For instance the authentication server may utilize information included with the domain credentials to identify the particular customer whose virtual computing environment and managed directories the user is trying to access. Based at least in part on one or more customer identifiers included with the domain credentials the authentication server may identify any customer computing resources maintained by the computing resource service provider the configuration of a customer s virtual network and information usable for accessing the customer s on premises network through the customer s virtual network.

If the one or more managed directories reside within a managed directory service provided by the computing resource service provider the authentication server may transmit the received one or more sets of credentials to the managed directory service. The managed directory service as noted above may include authentication and authorization services which may be configured to verify the user s credentials and determine one or more permissions and or restrictions applicable to the user respectively. For instance the authentication service within the managed directory service may include a user account data store which may include one or more user accounts corresponding to each user registered with the managed directory service. Each user account may specify one or more user names and corresponding passwords which may serve as the user s credentials for accessing the managed directory service. Thus when the authentication server provides the user s domain credentials to the managed directory service the authentication service may utilize these credentials to determine whether the credentials correspond to a user account stored therein. If the user domain credentials correspond to a user account the managed directory service may utilize one or more user identifiers to determine through the authorization service whether the user is authorized to access the customer s managed directories. If the user is authorized to do so the managed directory service may transmit a notification to the authentication server indicating that the user has been authenticated and is authorized to access the customer s managed directories.

Alternatively if the one or more managed directories reside within the customer s on premises network the authentication server may access a virtual network interface within the customer s virtual network to provide the one or more sets of credentials to a directory domain controller within the customer s on premises network. The directory domain controller may utilize the received one or more sets of credentials from the user to determine whether the user may be authenticated and whether the user is authorized to access the one or more managed directories maintained within the customer s on premises network. If the directory domain controller is able to authenticate the user and determine that the user is authorized to access the customer s managed directories the directory domain controller may transmit a notification to the authentication server indicating that the user has been authenticated and is authorized to access these managed directories.

Based at least in part on the notification received from either the managed directory service or the directory domain controller the authentication server may determine whether the one or more sets of credentials provided by the user are valid. If the authentication server determines that the one or more sets of credentials are not valid e.g. the user could not be authenticated and or does not have the requisite permissions to access customer resources the authentication server may deny the user access to the customer s virtual computing environment. However if the authentication server determines based at least in part on the notification that the credentials are valid the authentication server may generate an access token which the user client may utilize to access the virtual computing environment. The access token may specify an IP address of the virtual computing environment and a network gateway which may receive the token and determine whether to enable the user client to establish a communications channel with the virtual computing environment. Further the access token may specify one or more user identifiers which the network gateway may utilize to determine whether the user client may establish the communications channel with the virtual computing environment. For instance as will be described in greater detail below when the authentication server receives the notification from the directory domain controller or the managed directory service the computing resource service provider may transmit a notification to the network gateway specifying the one or more user identifiers that are included within the access token.

As noted above a customer or other administrator may configure a virtual computing environment to access one or more managed directories within a managed directory service or within the customer s on premises network. For instance the customer or other administrator may access a virtual computing environment service to request provisioning of a new virtual computing environment. Through this service the customer or other administrator may establish a connection between the virtual computing environment and the customer s managed directories and specify one or more users that may utilize the virtual computing environment to access these managed directories. Accordingly shows an illustrative example of a process for joining a managed directory to a virtual computing environment and enabling user access to the virtual computing environment in accordance with at least one embodiment. The process may be performed by the aforementioned virtual computing environment service which may be provided by a computing resource service provider to its customers for provisioning and use of one or more virtual computing environments.

When a customer or other administrator first accesses the virtual computing environment service he she may request provisioning of one or more virtual computing environments which delegated users may utilize to interact with one or more applications and data as defined by the customer or other administrator. Further the customer or other administrator may configure the virtual computing environment to enable users to access one or more managed directories within the customer s on premises directory or maintained by a managed directory service. Thus the virtual computing environment service may detect the launch of a new virtual computing environment and receive from the customer or other domain user a set of domain join credentials usable to access the customer s managed directories either within the customer s on premises network or in the managed directory service and join these managed directories to the newly provisioned environment. The domain join credentials may be encrypted such that the credentials may be passed to a directory domain controller securely and enable the directory domain controller or other computing resource to decrypt these credentials. Alternatively the domain join credentials may be decrypted by an agent operating within the newly provisioned virtual computing environment. The domain join credentials may be encrypted in a manner that does not require administrator input e.g. virtual computing environment service through the agent may encrypt the credentials and provide these to domain users as needed .

The virtual computing environment upon initial launch may generate one or more sets of environment credentials that may be unique to the environment. These credentials may be used by other services and resources to authenticate the virtual computing environment when it attempts to access these other services and resources on behalf of a user of the environment. The virtual computing environment service may first determine whether to transmit these environment credentials along with the domain join credentials to either the managed directory service or directory domain controller within the customer network . If the virtual computing environment service determines that the domain join credentials and the environment credentials are to be transmitted to the managed directory service the virtual computing environment service may transmit these credentials to the managed directory service and detect creation of a computer account within the managed directory service that may be associated with the customer s managed directories. Alternatively if the customer directories are maintained within the customer s network the virtual computing environment service may transmit these environment credentials along with the domain join credentials to the customer network directory domain controller to request creation of a computer account associated with the virtual computing environment. This computer account may specify one or more IP addresses corresponding to the virtual computing environment as well as the one or more environment credentials associated with the environment and received from the virtual computing environment.

When the customer network directory domain controller receives the request from the virtual computing environment the directory domain controller may refer to one or more user accounts within a user account data store to determine whether the customer or other domain user is authorized to perform a domain join of the virtual computing environment and the one or more managed directories. Based at least in part on this determination the managed directory service or directory domain controller may generate a computer account associated with the virtual computing environment that may be configured to enable the virtual computing environment to access the managed directories.

If the credentials provided by the customer or other administrator are not valid e.g. directory domain controller is unable to authenticate the customer domain user or the customer domain user is not authorized to perform the domain join the virtual computing environment service may deny the customer or other domain user request to join the virtual computing environment to the one or more managed directories. However if the customer or other domain user credentials are valid and the domain join between the virtual computing environment and the one or more managed directories is successful the virtual computing environment service may enable the customer or other domain user to add one or more users to a local group of users that may access this newly provisioned virtual computing environment. For instance the customer or other domain user may specify one or more user identifiers corresponding to each user permitted to access this virtual computing environment. These user identifiers may be further specified within the managed directory such that when the user utilizes the user client to access the virtual computing environment using his her domain credentials the authentication server may be able to obtain these user identifiers and include them within the access token.

Once the customer or other domain user has specified which one or more users may access the virtual computing environment the virtual computing environment service may enable user access to the one or more managed directories through the virtual computing environment. For instance the virtual computing environment service may transmit a request to the managed directory service or the directory domain controller to ensure that the users specified within the virtual computing environment correspond to one or more users of the one or more directories. This may ensure a seamless process when a user accesses the virtual computing environment and attempts to interact with the one or more managed directories.

As noted above once the authentication server has received a notification from a directory domain controller within the customer s on premises network or from a managed directory service provided by a computing resource service provider that a user s domain credentials are valid the authentication server may generate one or more access tokens that may enable the user client to access the virtual computing environment. Additionally the authentication server may transmit a notification to the computing resource service provider specifying the one or more user identifiers and or IP address corresponding to the user client being used to access the virtual computing environment. This may enable the computing resource service provider to provide the user identifiers and or IP address to a network gateway which may be used to enable establishment of a secure communications channel between the user client and the particular virtual computing environment. Accordingly shows an illustrative example of a process for configuring a network gateway for enabling a user to access a virtual computing environment in accordance with at least one embodiment. The process may be performed by the aforementioned computing resource service provider or a management sub system operating on behalf of the service provider.

When the directory domain controller within the customer s on premises network or the managed directory service determine that a user s credentials are valid and that the user is authorized to access the customer s virtual computing environment the authentication server may receive a notification indicating that the user s domain credentials are valid. This may enable the authentication server to generate the one or more access tokens necessary for the user client to access the virtual computing environment. Further the authentication server may transmit a notification to the computing resource service provider indicating that the user s domain credentials are valid as well one or more identifiers corresponding to the user within the computing resource service provider domain. Thus the computing resource service provider may receive a notification from the authentication server that the credentials supplied by the user are valid.

Once the computing resource service provider has received the notification from the authentication server the computing resource service provider may transmit a notification to the network gateway in order to indicate that the user client will be attempting to access the virtual computing environment. This notification may specify the IP address associated with the user client as well as other user identifiers that may be used to identify the user and ensure access to the correct virtual computing environment. Additionally the computing resource service provider may access the virtual computing environment service to establish a virtual computing environment session for the particular user. The computing resource service provider may establish a virtual network interface for the virtual computing environment to enable communications from the user client to the virtual computing environment and from the virtual computing environment to the one or more managed directories joined to the environment.

As noted above a computing resource service provider may provide various computing resource services to its customers. For instance in this particular illustrative example the computing resource service provider provides at least seven types of services. The services provided by the computing resource service provider in this example include a virtual computer system service a database service an object based data storage service a block level data storage service a managed directory service a virtual network service a virtual computing environment service and one or more other services although not all embodiments of the present disclosure will include all such services and additional services may be provided in addition to or as an alternative to services explicitly described herein.

The virtual computer system service may be a collection of computing resources configured to instantiate virtual machine instances onto virtual computer systems on behalf of the customers of the computing resource service provider . Customers of the computing resource service provider may interact with the virtual computer system service to provision and operate virtual computer systems that are instantiated on physical computing devices hosted e.g. physical hosts and operated by the computing resource service provider . The virtual computer systems may be used for various purposes such as to operate as servers supporting a website. Other applications for the virtual computer systems may be to support database applications electronic commerce applications business applications and or other applications.

The object based data storage service may comprise a collection of computing resources that collectively operate to store data for a customer . The data stored in the data storage service may be organized into data objects. The data objects may have arbitrary sizes except perhaps for certain constraints on size. Thus the object based data storage service may store numerous data objects of varying sizes. The object based data storage service may operate as a key value store that associates data objects with identifiers of the data objects which may be used by the customer to retrieve or perform other operations in connection with the data objects stored by the object based data storage service . Access to the object based data storage service may be through appropriately configured API calls.

The block level data storage service may comprise a collection of computing resources that collectively operate to store data for a customer. For instance the block level data storage system may be configured to provide block level data storage volumes for use with a virtual machine instance as noted above. A customer may interact with the block level data storage service to provision a block level data storage volume that in turn may be mounted as a storage device e.g. hard drive onto a virtual machine instance. The storage volume may be configured to behave like a raw unformatted block storage device with a block level customer interface. Accordingly a customer through properly configured API calls to the service may create a file system on top of the block level data storage volumes or utilize the volume as a block level storage device e.g. a hard drive .

The managed directory service may provide a variety of services to enable computer systems and or computer system client devices to access customer directories including but not limited to authentication authorization and directory services. For example the managed directory service may provide authentication services which may authenticate credentials of a user computer system process automated process or other such entity to at least determine whether that entity is authorized to access the managed directory service and or the customer directories associated with the managed directory service . In some embodiments the credentials may be authenticated by the managed directory service itself or they may be authenticated by a process program or service under the control of the managed directory service or they may be authenticated by a process program or service that the managed directory service may communicate with or they may be authenticated by a combination of these and or other such services or entities.

The managed directory service may also provide authorization services which may authorize a user computer system process automated process or other such entity to at least determine which actions of one or more possible actions that entity may perform. Examples of actions that an entity may or may not be authorized to perform include but are not limited to creating directories on the customer directory destroying directories on the customer directory attaching to directories on the customer directory detaching from directories on the customer directory providing access links to directories on the customer directory reclaiming access links to directories on the customer directory allowing reads from directories on the customer directory allowing writes to directories on the customer directory and or other such actions.

The managed directory service may also provide directory services which may provide an authenticated entity access to the customer directories according to the authorization credentials and or policies. For example in an embodiment where a computer system entity may be authorized to read and write a certain data store on a customer directory the ability to do so may be provided by the directory services. Directory services may provide access to customer directories by providing links to the customer directory locations such as by a URI object or some other such linkage. As may be contemplated the URI may be provided by the computer system client device or by a process running at the data center or by a process running on a computer system connected to the data center or by the managed directory service or by a combination of these and or other such computer system entities.

The virtual network service may enable customers to provision a logically isolated virtual network within the computing resource service provider environment. Within this isolated virtual network a customer may be able to define a range of IP addresses for various computing resources and configure network gateways and virtual network interfaces to enable public communications with these computing resources. Through the virtual network service a customer may be able to create a network connection between his her on premises network and the virtual network such that the computing resources within the computing resource service provider environment may be able to access computing resources located within the customer s on premises network.

The virtual computing environment service may allow customers to interact through the interface with one or more virtual computing environments. For instance the virtual computing environment service may enable customers to remotely manage and maintain one or more virtual machine images. These virtual machine images may be maintained in data storage within a virtual machine image data store. When a customer submits a request for provisioning a virtual machine instance the virtual computing environment service may identify the machine image the customer has requested and allocate the resources necessary e.g. the processors and random access memory RAM required to operate the components of the machine image to process the machine image. The machine image may be instantiated on one or more physical storage devices e.g. one or more servers or hard drives that may act as a physical host for the instance. The virtual computing environment may be configured to communicate with one or more managed directories through the managed directory service or through a directory domain controller within the customer s on premises network.

The illustrative environment includes at least one application server and a data store . It should be understood that there can be several application servers layers or other elements processes or components which may be chained or otherwise configured which can interact to perform tasks such as obtaining data from an appropriate data store. Servers as used herein may be implemented in various ways such as hardware devices or virtual computer systems. In some contexts servers may refer to a programming module being executed on a computer system. As used herein unless otherwise stated or clear from context the term data store refers to any device or combination of devices capable of storing accessing and retrieving data which may include any combination and number of data servers databases data storage devices and data storage media in any standard distributed virtual or clustered environment. The application server can include any appropriate hardware software and firmware for integrating with the data store as needed to execute aspects of one or more applications for the client device handling some or all of the data access and business logic for an application. The application server may provide access control services in cooperation with the data store and is able to generate content including but not limited to text graphics audio video and or other content usable to be provided to the user which may be served to the user by the web server in the form of HyperText Markup Language HTML Extensible Markup Language XML JavaScript Cascading Style Sheets CSS or another appropriate client side structured language. Content transferred to a client device may be processed by the client device to provide the content in one or more forms including but not limited to forms that are perceptible to the user audibly visually and or through other senses including touch taste and or smell. The handling of all requests and responses as well as the delivery of content between the client device and the application server can be handled by the web server using PHP Hypertext Preprocessor PHP Python Ruby Perl Java HTML XML or another appropriate server side structured language in this example. It should be understood that the web and application servers are not required and are merely example components as structured code discussed herein can be executed on any appropriate device or host machine as discussed elsewhere herein. Further operations described herein as being performed by a single device may unless otherwise clear from context be performed collectively by multiple devices which may form a distributed and or virtual system.

The data store can include several separate data tables databases data documents dynamic data storage schemes and or other data storage mechanisms and media for storing data relating to a particular aspect of the present disclosure. For example the data store illustrated may include mechanisms for storing production data and user information which can be used to serve content for the production side. The data store also is shown to include a mechanism for storing log data which can be used for reporting analysis or other such purposes. It should be understood that there can be many other aspects that may need to be stored in the data store such as page image information and access rights information which can be stored in any of the above listed mechanisms as appropriate or in additional mechanisms in the data store . The data store is operable through logic associated therewith to receive instructions from the application server and obtain update or otherwise process data in response thereto. The application server may provide static dynamic or a combination of static and dynamic data in response to the received instructions. Dynamic data such as data used in web logs blogs shopping applications news services and other such applications may be generated by server side structured languages as described herein or may be provided by a content management system CMS operating on or under the control of the application server. In one example a user through a device operated by the user might submit a search request for a certain type of item. In this case the data store might access the user information to verify the identity of the user and can access the catalog detail information to obtain information about items of that type. The information then can be returned to the user such as in a results listing on a web page that the user is able to view via a browser on the user device . Information for a particular item of interest can be viewed in a dedicated page or window of the browser. It should be noted however that embodiments of the present disclosure are not necessarily limited to the context of web pages but may be more generally applicable to processing requests in general where the requests are not necessarily requests for content.

Each server typically will include an operating system that provides executable program instructions for the general administration and operation of that server and typically will include a computer readable storage medium e.g. a hard disk random access memory read only memory etc. storing instructions that when executed by a processor of the server allow the server to perform its intended functions. Suitable implementations for the operating system and general functionality of the servers are known or commercially available and are readily implemented by persons having ordinary skill in the art particularly in light of the disclosure herein.

The environment in one embodiment is a distributed and or virtual computing environment utilizing several computer systems and components that are interconnected via communication links using one or more computer networks or direct connections. However it will be appreciated by those of ordinary skill in the art that such a system could operate equally well in a system having fewer or a greater number of components than are illustrated in . Thus the depiction of the system in should be taken as being illustrative in nature and not limiting to the scope of the disclosure.

The various embodiments further can be implemented in a wide variety of operating environments which in some cases can include one or more user computers computing devices or processing devices which can be used to operate any of a number of applications. User or client devices can include any of a number of general purpose personal computers such as desktop laptop or tablet computers running a standard operating system as well as cellular wireless and handheld devices running mobile software and capable of supporting a number of networking and messaging protocols. Such a system also can include a number of workstations running any of a variety of commercially available operating systems and other known applications for purposes such as development and database management. These devices also can include other electronic devices such as dummy terminals thin clients gaming systems and other devices capable of communicating via a network. These devices also can include virtual devices such as virtual machines hypervisors and other virtual devices capable of communicating via a network.

Various embodiments of the present disclosure utilize at least one network that would be familiar to those skilled in the art for supporting communications using any of a variety of commercially available protocols such as Transmission Control Protocol Internet Protocol TCP IP User Datagram Protocol UDP protocols operating in various layers of the Open System Interconnection OSI model File Transfer Protocol FTP Universal Plug and Play UpnP Network File System NFS Common Internet File System CIFS and AppleTalk. The network can be for example a local area network a wide area network a virtual private network the Internet an intranet an extranet a public switched telephone network an infrared network a wireless network a satellite network and any combination thereof.

In embodiments utilizing a web server the web server can run any of a variety of server or mid tier applications including Hypertext Transfer Protocol HTTP servers FTP servers Common Gateway Interface CGI servers data servers Java servers Apache servers and business application servers. The server s also may be capable of executing programs or scripts in response to requests from user devices such as by executing one or more web applications that may be implemented as one or more scripts or programs written in any programming language such as Java C C or C or any scripting language such as Ruby PHP Perl Python or TCL as well as combinations thereof. The server s may also include database servers including without limitation those commercially available from Oracle Microsoft Sybase and IBM as well as open source servers such as MySQL Postgres SQLite MongoDB and any other server capable of storing retrieving and accessing structured or unstructured data. Database servers may include table based servers document based servers unstructured servers relational servers non relational servers or combinations of these and or other database servers.

The environment can include a variety of data stores and other memory and storage media as discussed above. These can reside in a variety of locations such as on a storage medium local to and or resident in one or more of the computers or remote from any or all of the computers across the network. In a particular set of embodiments the information may reside in a storage area network SAN familiar to those skilled in the art. Similarly any necessary files for performing the functions attributed to the computers servers or other network devices may be stored locally and or remotely as appropriate. Where a system includes computerized devices each such device can include hardware elements that may be electrically coupled via a bus the elements including for example at least one central processing unit CPU or processor at least one input device e.g. a mouse keyboard controller touch screen or keypad and at least one output device e.g. a display device printer or speaker . Such a system may also include one or more storage devices such as disk drives optical storage devices and solid state storage devices such as random access memory RAM or read only memory ROM as well as removable media devices memory cards flash cards etc.

Such devices also can include a computer readable storage media reader a communications device e.g. a modem a network card wireless or wired an infrared communication device etc. and working memory as described above. The computer readable storage media reader can be connected with or configured to receive a computer readable storage medium representing remote local fixed and or removable storage devices as well as storage media for temporarily and or more permanently containing storing transmitting and retrieving computer readable information. The system and various devices also typically will include a number of software applications modules services or other elements located within at least one working memory device including an operating system and application programs such as a client application or web browser. It should be appreciated that alternate embodiments may have numerous variations from that described above. For example customized hardware might also be used and or particular elements might be implemented in hardware software including portable software such as applets or both. Further connection to other computing devices such as network input output devices may be employed.

Storage media and computer readable media for containing code or portions of code can include any appropriate media known or used in the art including storage media and communication media such as but not limited to volatile and non volatile removable and non removable media implemented in any method or technology for storage and or transmission of information such as computer readable instructions data structures program modules or other data including RAM ROM Electrically Erasable Programmable Read Only Memory EEPROM flash memory or other memory technology Compact Disc Read Only Memory CD ROM digital versatile disk DVD or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by the system device. Based on the disclosure and teachings provided herein a person of ordinary skill in the art will appreciate other ways and or methods to implement the various embodiments.

The specification and drawings are accordingly to be regarded in an illustrative rather than a restrictive sense. It will however be evident that various modifications and changes may be made thereunto without departing from the broader spirit and scope of the invention as set forth in the claims.

Other variations are within the spirit of the present disclosure. Thus while the disclosed techniques are susceptible to various modifications and alternative constructions certain illustrated embodiments thereof are shown in the drawings and have been described above in detail. It should be understood however that there is no intention to limit the invention to the specific form or forms disclosed but on the contrary the intention is to cover all modifications alternative constructions and equivalents falling within the spirit and scope of the invention as defined in the appended claims.

The use of the terms a and an and the and similar referents in the context of describing the disclosed embodiments especially in the context of the following claims are to be construed to cover both the singular and the plural unless otherwise indicated herein or clearly contradicted by context. The terms comprising having including and containing are to be construed as open ended terms i.e. meaning including but not limited to unless otherwise noted. The term connected when unmodified and referring to physical connections is to be construed as partly or wholly contained within attached to or joined together even if there is something intervening. Recitation of ranges of values herein are merely intended to serve as a shorthand method of referring individually to each separate value falling within the range unless otherwise indicated herein and each separate value is incorporated into the specification as if it were individually recited herein. The use of the term set e.g. a set of items or subset unless otherwise noted or contradicted by context is to be construed as a nonempty collection comprising one or more members. Further unless otherwise noted or contradicted by context the term subset of a corresponding set does not necessarily denote a proper subset of the corresponding set but the subset and the corresponding set may be equal.

Conjunctive language such as phrases of the form at least one of A B and C or at least one of A B and C unless specifically stated otherwise or otherwise clearly contradicted by context is otherwise understood with the context as used in general to present that an item term etc. may be either A or B or C or any nonempty subset of the set of A and B and C. For instance in the illustrative example of a set having three members the conjunctive phrases at least one of A B and C and at least one of A B and C refer to any of the following sets A B C A B A C B C A B C. Thus such conjunctive language is not generally intended to imply that certain embodiments require at least one of A at least one of B and at least one of C each to be present.

Operations of processes described herein can be performed in any suitable order unless otherwise indicated herein or otherwise clearly contradicted by context. Processes described herein or variations and or combinations thereof may be performed under the control of one or more computer systems configured with executable instructions and may be implemented as code e.g. executable instructions one or more computer programs or one or more applications executing collectively on one or more processors by hardware or combinations thereof. The code may be stored on a computer readable storage medium for example in the form of a computer program comprising a plurality of instructions executable by one or more processors. The computer readable storage medium may be non transitory.

The use of any and all examples or exemplary language e.g. such as provided herein is intended merely to better illuminate embodiments of the invention and does not pose a limitation on the scope of the invention unless otherwise claimed. No language in the specification should be construed as indicating any non claimed element as essential to the practice of the invention.

Embodiments of this disclosure are described herein including the best mode known to the inventors for carrying out the invention. Variations of those embodiments may become apparent to those of ordinary skill in the art upon reading the foregoing description. The inventors expect skilled artisans to employ such variations as appropriate and the inventors intend for embodiments of the present disclosure to be practiced otherwise than as specifically described herein. Accordingly the scope of the present disclosure includes all modifications and equivalents of the subject matter recited in the claims appended hereto as permitted by applicable law. Moreover any combination of the above described elements in all possible variations thereof is encompassed by the scope of the present disclosure unless otherwise indicated herein or otherwise clearly contradicted by context.

All references including publications patent applications and patents cited herein are hereby incorporated by reference to the same extent as if each reference were individually and specifically indicated to be incorporated by reference and were set forth in its entirety herein. cm What is claimed is 

