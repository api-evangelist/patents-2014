---

title: Dynamic geohash-based geofencing
abstract: A method and system for dynamic geohash-based geofencing within a geographic area including obtaining metadata including a campaign identifier and geometric data, generating a geometry using the geometric data, mapping the geometry to a geohash grid to obtain a first geohash set having a first geohash in the geohash grid, storing the first geohash and the campaign identifier in an entry in a geohash index, obtaining a user position within the geographic area from a mobile device, generating a user geohash using the user position, matching the user geohash to the entry in the geohash index, obtaining the campaign identifier from the entry in the geohash index, and providing content corresponding to the campaign identifier to the mobile device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09426620&OS=09426620&RS=09426620
owner: Twitter, Inc.
number: 09426620
owner_city: San Francisco
owner_country: US
publication_date: 20140314
---
Location based advertising is commonly used by vendors and service providers to reach consumers within a specified range of a target location.

In general in one aspect embodiments of the invention provide a method for dynamic geohash based geofencing within a geographic area including obtaining metadata including a campaign identifier and geometric data generating a geometry using the geometric data mapping the geometry to a geohash grid to obtain a first geohash set having a first geohash in the geohash grid storing the first geohash and the campaign identifier in an entry in a geohash index obtaining a user position within the geographic area from a mobile device generating a user geohash using the user position matching the user geohash to the entry in the geohash index obtaining the campaign identifier from the entry in the geohash index and providing content corresponding to the campaign identifier to the mobile device.

In general in one aspect embodiments of the invention provide a system for dynamic geohash based geofencing within a geographic area including memory and a computer processor for executing a dynamic geofencing application stored in memory and causing the computer processor to obtain metadata including a campaign identifier and geometric data generate a geometry using the geometric data map the geometry to a geohash grid to obtain a first geohash set having a first geohash in the geohash grid store the first geohash and the campaign identifier in an entry in a geohash index obtain a user position within the geographic area from a mobile device generate a user geohash using the user position match the user geohash to the entry in the geohash index obtain the campaign identifier from the entry in the geohash index and provide content corresponding to the campaign identifier to the mobile device.

In general in one aspect embodiments of the invention provide a computer readable medium storing instructions for dynamic geohash based geofencing within a geographic area the instructions comprising functionality to obtain metadata including a campaign identifier and geometric data generate a geometry using the geometric data map the geometry to a geohash grid to obtain a first geohash set having a first geohash in the geohash grid store the first geohash and the campaign identifier in an entry in a geohash index obtain a user position within the geographic area from a mobile device generate a user geohash using the user position match the user geohash to the entry in the geohash index obtain the campaign identifier from the entry in the geohash index and provide content corresponding to the campaign identifier to the mobile device.

Other aspects of the invention will be apparent from the following description and the appended claims.

Specific embodiments of the invention will now be described in detail with reference to the accompanying figures. Like elements in the various figures are denoted by like reference numerals for consistency.

In the following detailed description of embodiments of the invention numerous specific details are set forth in order to provide a more thorough understanding of the invention. However it will be apparent to one of ordinary skill in the art that the invention may be practiced without these specific details. In other instances well known features have not been described in detail to avoid unnecessarily complicating the description.

In general embodiments of the invention provide a method and system for geofencing in order to provide notifications to or receive notifications from desired targets within the bounded regions of a geofence for various purposes including advertising or promotional campaigns event invitations or movement alerts. More specifically embodiments of the invention provide a method and system for dynamic geofencing allowing the targeting of mobile devices within delimited areas that may change over time. The delimited areas may be expressed in geometries each including one or more global positions. Additionally embodiments of the invention implement dynamic geofencing and associated geometries using geohashes which are character string representations of bounding boxes that approximate the global positions contained within.

In one or more embodiments of the invention the mobile device is a hardware mobile device capable of executing software e.g. a mobile application . Examples of a mobile device may include but are not limited to a smartphone a laptop computer a tablet computer a PDA a navigation device a wearable device e.g. a smart watch Google Glass a netbook computer a computer embedded in a vehicle e.g. embedded computer in a car or any other computing device that is designed to be moved during normal use.

In one or more embodiments of the invention the mobile device includes a global positioning system receiver . The global positioning system GPS receiver is any combination of software firmware and or hardware that executes on the mobile device to track the global position of the mobile device. The GPS receiver may be resident on the mobile device or via a wireless connection with another source of GPS information for example a mobile access point. In one or more embodiments of the invention the GPS receiver includes functionality to provide to the mobile device positions in GPS coordinate format detailing the global position of the mobile device. The mobile device may include other functionality to determine the location of the mobile device aside from a GPS receiver without departing from the invention. For example if the mobile device is connected to a network the mobile device may include functionality to obtain its Internet Protocol IP address and convert the IP address to GPS coordinates.

In one or more embodiments of the invention the data repository is any type of storage unit and or device e.g. a file system database collection of tables or any other storage mechanism for storing data. Further the data repository may include multiple different storage units and or devices. The multiple different storage units and or devices may or may not be of the same type or located at the same physical site. The data repository may be stored for example on the mobile device and or on a server.

In one or more embodiments of the invention the data repository is configured to store campaign content one or more geohash grids campaign metadata one or more campaign indexes one or more geohash indexes and or any other data relevant to geofencing and geohash related applications. Each of these components is described below.

In one or more embodiments of the invention campaign content includes any information including images text video and or audio content associated with one or more campaigns. For example for a particular ad campaign the associated campaign content may include a campaign identifier and an advertisement for a particular company and or brand. Alternatively or additionally in one or more embodiments campaign content may include user generated content e.g. content generated and posted by another user on a social media platform. For example the campaign with which the campaign content is associated may correspond to promoting content from specific users on the social media platform. In another example consider a scenario in which user A creates content A on a social media platform and that there is a campaign to promote the content of user A when user B is located within a geofence that is associated with the aforementioned campaign content A may be displayed or otherwise provided to user B. Alternatively or additionally the campaign may correspond to notification when a particular activity or event occurs see example below . The campaign and or campaign content is not limited to the above examples rather embodiments of the invention may be used to provide any type of content in any form to one or more users using one or more embodiments of the invention. In one or more embodiments of the invention the campaign identifier campaign ID may be any numeric alphanumeric and or symbolic string used to identify a given campaign.

In one or more embodiments of the invention a geohash grid may subdivide a given geographic area into cells of identical or substantially similar size and or cells of differing size. Each cell in the geohash grid is defined by an alphanumeric string called a geohash. For example the area roughly encompassing greater New York City may be associated with a geohash value of dr5 .

Campaign metadata campaign indexes and geohash indexes are detailed in the following discussion of . Discussion of resumes thereafter.

Returning to in one or more embodiments of the invention the dynamic geofencing application may be any combination of hardware software and or firmware and may include functionality to obtain a geohash grid for a geographic area which may be of any size and or dimension . The geographic area may be for example the planet Earth the United States of America or the city of Tokyo. The geohash grid may be obtained from the data repository from an external source or it may be generated by the dynamic geofencing application DGA itself.

In one or more embodiments of the invention the DGA may include functionality to generate one or more geometries using the campaign metadata. For example if the campaign metadata indicates a point coordinate and a 2 mile radius the DGA may calculate the circumference and or the area encompassed by the indicated circle.

In one or more embodiments of the invention the DGA may include functionality to map one or more geometries or geometric data to a geohash grid to obtain a set of geohashes. After the geometries have been generated the DGA may overlay the geometries onto the geohash grid in order to determine which cells in the geohash grid intersect the generated geometries.

In one or more embodiments of the invention the DGA may include functionality to write data to and read data from a data repository e.g. in . The DGA may include functionality to read or erase values from the various data structures in the data repository using a lookup key for example the DGA may retrieve a geohash list from the campaign index by sending the corresponding campaign ID.

In one or more embodiments of the invention the DGA may include functionality to obtain one or more positions of a mobile device within a geographic area. Each position may be in one of a number of formats including for example a GPS coordinate set postal address or zip code. Positions may be current or previous positions and may be obtained directly from the mobile device from the data repository or from any external source.

In one or more embodiments of the invention the DGA may include functionality to generate a geohash using a geographic coordinate set. A set of geographic coordinates may be converted to a geohash using one of a number of different algorithms. In one such algorithm for example a geohash is obtained by interleaving the bits of the latitude and longitude of a coordinate formatted position and encoding the result in base 32 to create a convenient string representation i.e. the geohash that can be expressed using five bits of data. In other embodiments the geohash may be generated by encoding the interleaved bits of the position in another format for example base 36.

In one or more embodiments of the invention the DGA may include functionality to match a geohash value to the geohash field of an entry in the geohash index. The geohash value may be generated from the position e.g. expressed as geographic coordinates of a mobile device using an algorithm similar to the one detailed above.

In one or more embodiments of the invention the DGA may include functionality to communicate with external entities e.g. the mobile device a remote server etc. . In one or more embodiments of the invention the DGA may execute on a mobile device. The DGA may include the necessary application programming interface API and or any number of other components used for communicating with entities outside of the system. The API can include any number of specifications for making requests from and or providing data to the system. For example a function of the API may provide campaign content to a requesting mobile device within the geofence associated with the campaign.

In one or more embodiments of the invention the functionality of the DGA may be divided or otherwise split between the mobile device and other external entities e.g. a remote server .

While show a configuration of components other configurations may be used without departing from the scope of the invention. For example various components may be combined to create a single component. As another example the functionality performed by a single component may be performed by two or more components.

In Step a geohash grid is obtained. The granularity i.e. cell size of the geohash grid may be predetermined to offer a desired level of precision or to facilitate resource efficient operation of the system. For example using a geohash grid having a finer granularity will yield a more precise geofence including a greater number of geohashes each includes a longer character string. Alternatively using a geohash grid having a coarse granularity will require less disk space to store a geofence generated from the grid at the cost of losing precision.

The granularity of the geohash grid may be based in part or in whole on the population density of the geographic area. For example it may be desirable for an ad campaign to have a larger geofence in sparsely populated areas to reach a greater number of potential consumers additionally in such locations consumers may be more likely to travel a greater distance for a bargain. Rather than having to set geometries of differing sizes a vendor may simply specify a uniform geometry for multiple positions and using a density granular geohash grid the size of each corresponding geofence will vary accordingly.

In Step campaign metadata is obtained that includes a campaign ID and geometric data. As an example a single entry in the campaign metadata may provide i STARBUCKS001 for the campaign ID ii the coordinates 40.715 74.009 and 37.777 122.416 for the geometries and iii 10 miles for the buffer.

In Step one or more geometries are generated from the geometric data obtained in Step . Geometries generated from the exemplary data in the previous step may vary depending on whether the data are indicated as points or a line. For example in the first instance the resulting geometries may be two circles each centered at one of the listed positions and having a 10 mile radius. In the second instance the resulting geometry may be an oblong centered on the line connecting the listed positions having a width of 20 miles and a length of 20 miles plus the distance between the two positions.

In Step the one or more geometries are mapped onto the geohash grid to obtain a geohash set for the campaign. The set of geohashes obtained by the DGA may include all geohashes corresponding to cells positioned entirely within the geometries and or all geohashes corresponding to cells positioned partly within the geometries.

In Step the campaign ID obtained in Step and the geohash set obtained in Step are stored as a paired entry in a campaign index. The campaign index may be a hash table including key value pairs. For example a given campaign index entry may have the following two fields AMEX002 as the entry s key or campaign ID and dr5r dr5s as the entry s value or geohash set.

In Step a geohash index is generated using the campaign index. A new geohash index entry may be generated for each geohash in the geohash set of a given campaign index entry including the geohash as the new entry s key and the campaign ID as the new entry s value. Geohash index entries resulting from the exemplary data in the previous step may appear as follows 1 dr5r AMEX002 and 2 dr5s AMEX002 . After Step is completed the process proceeds to end.

In Step a user position within the geographic area is obtained. For example the position of a user s mobile device may be obtained from a GPS receiver resident on the mobile device or through IP to coordinate conversion. Multiple positions may be obtained at once or over a predetermined time interval and from one or more devices. As an example the global positions of multiple mobile devices in a specific time zone may be obtained from those devices once an hour between the hours of 8 a.m. and 8 p.m. The positions may be scraped from Internet messaging services. For example all user posts on a particular social media platform posted at 12 01 p.m. may be scraped to provide the embedded positions of those users at that specific time. The user s position within a geographic area may be obtained using other mechanisms without departing from the invention. As another example the position of a mobile device may be obtained by the user s service provider through mobile tracking means such as triangulation using cellular base stations.

In Step a user geohash is generated using the user position obtained in Step . If the obtained position is in a format other than a coordinate set for example a street address or a zip code the position may be converted to a coordinate format before a geohash is generated. The length of the generated geohash may depend on the precision of the position obtained. For example converting a coordinate having 20 decimal places will generate a longer geohash than converting a coordinate having 10 decimal places. Additionally the generated geohash may be truncated to a predetermined length.

In Step the user geohash is matched to a geohash index entry. The system may make an identical match in which case it is determined that the geohash value is equivalent to the contents of a geohash field i.e. a key in the geohash index entry. Alternatively the system may perform a prefix match in which case it is determined that a truncation of the geohash value is equivalent to the contents of the geohash field in a geohash index entry. This alternative would be necessary where the geohash grid has a coarse granularity and the geohash generated from the position has a large number of decimal places.

In Step the campaign ID corresponding to the matching geohash index entry is obtained. The campaign ID is the value of the matching geohash index entry.

In Step content associated with the campaign ID is provided to the mobile device. The content may be retrieved from the data repository and may be modified to conform to the specifications of the mobile device.

In Step a campaign ID and new geometric data are obtained. The campaign ID and new geometric data may be obtained in the same fashion as in Step .

In Step the geohash set corresponding to the campaign ID is obtained from the campaign index. The geohash set may be obtained by using the campaign ID as a key lookup in the campaign index.

In Step the entry including the campaign ID is deleted from the campaign index. Both the campaign ID and the geohash set corresponding to the campaign ID may be deleted.

In optional Step all geohash index entries including a geohash in the geohash set are modified by deleting the campaign ID from the entry. This step may be executed by first identifying each geohash in the geohash set obtained in Step . The geohashes may then be individually used as key lookups to identify and delete the campaign ID from each entry corresponding to a geohash in the geohash set. If no other campaign IDs remain in the entry after deleting the campaign ID from Step then the value for the entry may be set to NULL or the entry may be deleted in its entirety. Step may be necessary if in Step the pre existing geohash index is retained and modified rather than replaced by a new geohash index.

In Step one or more new geometries are generated from the new geometric data. The geometries are generated in the same fashion as in Step .

In Step the one or more new geometries are mapped onto a geohash grid to obtain a new geohash set. The geohash grid may be the same or a different geohash grid obtained in Step but the geometries may be mapped onto the geohash grid in the same fashion as in Step .

In Step the campaign ID and the new geohash set are stored as a paired entry in the campaign index. The campaign ID and geohash set may be stored as a key and a value respectively in the same fashion as in Step .

In Step a new geohash index is generated using the campaign index. The geohash index may be generated in the same fashion as in Step . Alternatively each geohash in the new geohash set and the campaign ID may be stored as a paired entry in old geohash index. Each geohash and the campaign ID may be stored as a key and a value respectively in the same fashion as in Step with the exception that the geohashes and campaign ID are stored in the geohash index rather than the campaign index.

The following example is for explanatory purposes only and not intended to limit the scope of the invention. In other words the following example is an example of one embodiment of the invention. Other embodiments may exist without departing from the scope of the invention.

Suppose that Adam operates Adam s Foods a food truck in New York City. Adam desires to run a promotional campaign offering various appetizers free of charge between the hours of 3 p.m. and 4 p.m. Adam wants to advertise the promotion via smartphone to consumers located within a 30 yard radius of the food truck.

Adam enters into an arrangement with Chirper a cellular service provider to broadcast his ads to users of the service. Chirper explains to Adam that to conserve resources Chirper intends to approximate his geofence using geohash es . Adam agrees and submits his advertisement along with geometric data for his desired geofence to Chirper which Chirper stores with other campaign content on its database.

Initially Chirper stores campaign metadata for the campaign in its database. Chirper assigns Adam s campaign the campaign ID Adam001. At exactly 3 p.m. Chirper enters Adam001 40.715 74.009 the current location of Adam s food truck expressed in latitude and longitude and a buffer of 30 yards into a metadata table on its database. Chirper generates a geohash grid having a 7 character granularity corresponding to geohashes of roughly one New York City block. Chirper generates a circle from the campaign metadata above having a radius of 30 yards surrounding the location of Adam s food truck. Chirper maps the generated circle onto the geohash grid to obtain a set of two geohashes that fully encompass the generated circle dr5regu dr5reuh. Chirper then stores the data pair Adam001 dr5regu dr5reuh into a campaign index hashtable. Finally Chirper generates a geohash index that includes at least the two entries dr5regu Adam001 and dr5reuh Adam001. 

For the following hour from 3 4 p.m. Chirper obtains a multitude of positions from its subscribers mobile devices. Suppose that George is one such subscriber and at 3 30 p.m. George is one block away from Adam s Foods. Chirper obtains George s position from the GPS receiver on George s mobile phone. Chirper converts the obtained position s latitude and longitude into binary interleaves the bits and the converts the result into base 32 to obtain a geohash value of dr5reuha9blm3. Chirper accesses the geohash index on its database and searches for a matching geohash. The geohash corresponding to George s position is truncated one character at a time until a match is reached. In this case George s position is truncated to dr5reuh and this value successfully matches an entry in the geohash index corresponding to Adam s campaign. Chirper obtains the campaign ID Adam001 from the geohash index retrieves the advertisement associated with this campaign ID from the campaign content on its database and sends the ad to George s cell phone. George then receives a notification that Adam s food truck is nearby and that George can eat free for the next 30 minutes.

The following day at 3 p.m. Chirper obtains the current position of Adam s food truck by pinging the cook s mobile phone. The position is 40.736 73.982 . Chirper stores this information in its campaign metadata. Chirper obtains the geohash grid used the previous day from its database.

Because Adam has moved Chirper deletes the previous day s information from its indexes. Accordingly Chirper retrieves the geohash set dr5regu dr5reuh corresponding to the campaign ID Adam001 from the campaign index on its database. After obtaining the geohash set Chirper deletes the entire entry from the campaign index. Next Chirper deletes the following two entries from the geohash index dr5regu Adam001 and dr5reuh Adam001. At this point all information pertaining to Adam s prior location has been removed from the indexes.

Again a 30 yard circle is generated around Adam s position and is mapped to the geohash grid. Chirper determines that the new geofence includes the geohash set dr5rsrz dr5rsxb. The data pair Adam001 dr5rsrz dr5rsxb is entered into the campaign index. Finally the data pairs dr5rsrz Adam001 and dr5rsxb Adam001 are entered into the geohash index.

The invention is not limited to the processes or examples described above. In one or more embodiments of the invention the system may be used to send a notification unrelated to an advertising campaign to one or more mobile devices. For example for users that want to share information or host events they may use geofencing to broadcast such information.

One or more embodiments of the invention may be used to build a moving or changing geofence that is updated in real time in response to the movement of for example the mobile device. For example let Adam s truck from the above example be an ice cream truck rather than a food truck. Adam s ice cream truck continuously moves around New York city. Adam desires to generate notifications to users within a radius of the ice cream truck that updates in real time. The system described in the above example may be modified so that the geohash and campaign indexes are updated to track the position of Adam s truck every second rather than every day thus approximating a real time moving geofence.

One or more embodiments of the invention may also be used to send a notification from a mobile device to another mobile device or to a remote server. A client may desire to implement the invention so that the client is notified once a target mobile device leaves a geofenced area. For example if a tiger wearing or implanted with such a device escapes a zoo a subscriber may receive notification that the tiger has escaped along with the tiger s real time tracking info. The target mobile device may include one or more components of the invention including a GPS receiver a dynamic geofence application and or a data repository including one or more of the data structures described above. In one or more embodiments of the invention the geofence and campaign indexes may include paired index entries relating one or more geohashes to a subscriber ID rather than a campaign ID.

One or more embodiments of the invention may generate a geofence corresponding to geohashes outside a geometry rather than corresponding to geohashes within a geometry. In the previous example building a geofence from geohashes outside a geometry allows a notification to be sent to a subscriber once the tiger leaves the geofence and the geohash value generated from the tiger s new position matches the geohash index entry corresponding to the subscriber ID. One or more embodiments of the invention may then provide an escape notification from the mobile device equipped on the tiger to a remote mobile device belonging to the subscriber and or to a remote server.

Embodiments of the invention may be implemented on virtually any type of computing system regardless of the platform being used. For example the computing system may be one or more mobile devices e.g. laptop computer smart phone personal digital assistant tablet computer or other mobile device desktop computers servers blades in a server chassis or any other type of computing device or devices that includes at least the minimum processing power memory and input and output device s to perform one or more embodiments of the invention. For example as shown in the computing system may include one or more computer processor s associated memory e.g. random access memory RAM cache memory flash memory etc. one or more storage device s e.g. a hard disk an optical drive such as a compact disk CD drive or digital versatile disk DVD drive a flash memory stick etc. and numerous other elements and functionalities. The computer processor s may be an integrated circuit for processing instructions. For example the computer processor s may be one or more cores or micro cores of a processor. The computing system may also include one or more input device s such as a touchscreen keyboard mouse microphone touchpad electronic pen or any other type of input device. Further the computing system may include one or more output device s such as a screen e.g. a liquid crystal display LCD a plasma display touchscreen cathode ray tube CRT monitor projector or other display device a printer external storage or any other output device. One or more of the output device s may be the same or different from the input device s . The computing system may be connected to a network e.g. a local area network LAN a wide area network WAN such as the Internet mobile network or any other type of network via a network interface connection not shown . The input and output device s may be locally or remotely e.g. via the network connected to the computer processor s memory and storage device s . Many different types of computing systems exist and the aforementioned input and output device s may take other forms.

Software instructions in the form of computer readable program code to perform embodiments of the invention may be stored in whole or in part temporarily or permanently on a non transitory computer readable medium such as a CD DVD storage device a diskette a tape flash memory physical memory or any other computer readable storage medium. Specifically the software instructions may correspond to computer readable program code that when executed by a processor s is configured to perform embodiments of the invention.

Further one or more elements of the aforementioned computing system may be located at a remote location and connected to the other elements over a network . Further embodiments of the invention may be implemented on a distributed system having a plurality of nodes where each portion of the invention may be located on a different node within the distributed system. In one embodiment of the invention the node corresponds to a distinct computing device. Alternatively the node may correspond to a computer processor with associated physical memory. The node may alternatively correspond to a computer processor or micro core of a computer processor with shared memory and or resources.

While the invention has been described with respect to a limited number of embodiments those skilled in the art having benefit of this disclosure will appreciate that other embodiments can be devised which do not depart from the scope of the invention as disclosed herein. Accordingly the scope of the invention should be limited only by the attached claims.

