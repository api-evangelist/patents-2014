---

title: Geolocation routing and simulation of network conditions
abstract: Methods and systems for geolocation routing and simulation of network conditions are disclosed. A network traffic profile is determined for a client device. A network access server selects an endpoint server based on the location of the selected endpoint server. The network access server routes traffic from the client device to an external server through the selected endpoint server. The network traffic from the client device to the external server appears to originate from a network address of the selected endpoint server. Network conditions for the network traffic are simulated based on the network traffic profile.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09660895&OS=09660895&RS=09660895
owner: Amazon Technologies, Inc.
number: 09660895
owner_city: Reno
owner_country: US
publication_date: 20140304
---
Many companies and other organizations operate computer networks that interconnect numerous computing systems to support their operations such as with the computing systems being co located or instead located in multiple distinct geographical locations e.g. connected via one or more private or public intermediate networks . For example data centers housing significant numbers of interconnected computing systems have become commonplace such as private data centers that are operated by and on behalf of a single organization and public data centers that are operated by entities as businesses to provide computing resources to customers. Some public data center operators provide network access power and secure installation facilities for hardware owned by various customers while other public data center operators provide full service facilities that also include hardware resources made available for use by their customers. As the scale and scope of typical data centers has increased the tasks of provisioning administering and managing the computing resources have become increasingly complicated.

Examples of such large scale systems include online merchants and marketplaces internet service providers online businesses such as photo processing services corporate networks cloud computing services web based hosting services etc. These entities may maintain computing resources in the form of large numbers of computing devices e.g. thousands of hosts that are hosted in geographically diverse locations. Clients of such systems may also be located in geographically diverse locations. Additionally clients may connect to such systems using communications media and networks with varying characteristics and conditions. Variations in network characteristics and network conditions may result in different experiences for clients.

While embodiments are described herein by way of example for several embodiments and illustrative drawings those skilled in the art will recognize that embodiments are not limited to the embodiments or drawings described. It should be understood that the drawings and detailed description thereto are not intended to limit embodiments to the particular form disclosed but on the contrary the intention is to cover all modifications equivalents and alternatives falling within the spirit and scope as defined by the appended claims. The headings used herein are for organizational purposes only and are not meant to be used to limit the scope of the description or the claims. As used throughout this application the word may is used in a permissive sense i.e. meaning having the potential to rather than the mandatory sense i.e. meaning must . Similarly the words include including and includes mean including but not limited to. 

Various embodiments of methods and systems for performing geolocation routing and simulation of network conditions are described. Using the methods and systems as described herein network connections may be simulated for clients in varying geographical locations. Tunneling may be used to perform geolocation routing to endpoint servers in various geographical locations so that outgoing network traffic may appear to originate from those locations. Additionally traffic shaping may be performed to simulate different network conditions e.g. degraded conditions . In this manner customer service technicians for an online organization e.g. an online merchant may simulate the experiences of customers in various locations.

In various embodiments the network access server may provide network access by connecting to one or more of the endpoint servers A N over the network s . The network access server may include a plurality of components that are configured to perform aspects of providing network access. For example the network access server may include endpoint selection functionality tunneling functionality and network traffic shaping functionality . The network access server may comprise one or more computing devices any of which may be implemented by the example computing device illustrated in . In various embodiments the functionality of the different services components and or modules of the network access server e.g. endpoint selection functionality tunneling functionality and network traffic shaping functionality may be provided by the same computing device or by different computing devices. If any of the various components are implemented using different computing devices then the respective computing devices may be communicatively coupled e.g. via a network. Each of the endpoint selection functionality tunneling functionality and network traffic shaping functionality may represent any combination of software and hardware usable to perform their respective functions as discussed as follows.

In one embodiment the endpoint selection functionality may select ones of the endpoint servers A N for use in providing network access. An endpoint server may be selected based on any suitable combination of characteristics. In one embodiment an endpoint server may be selected based on its geographical location. In this manner the network simulation system may provide network access at endpoints in various geographical locations in order to simulate a physical presence in those geographical locations. In one embodiment an endpoint server may also be selected based on its hardware and or software configuration its performance metrics its usage costs etc.

In one embodiment the tunneling functionality may implement secure tunneling with one or more of the endpoint servers A N e.g. ones of the endpoint servers selected using the endpoint selection functionality . In one embodiment the tunneling functionality may use any suitable authentication and encryption techniques to ensure the security of data transmitted over a secure tunnel between the network access server and one of the endpoint servers A N. The tunnel may be established using a point to point connection over one or more public and or private network s and or interconnections. In one embodiment the tunnel established between the network access server and one of the endpoint servers A N may be implemented as a secure tunnel or virtual private network VPN tunnel.

In one embodiment the network traffic shaping functionality may simulate different network characteristics and or conditions. For example the network traffic shaping functionality may simulate network characteristics such as latency bandwidth caps and packet loss. The various characteristics may be simulated for network access provided through one or more of the endpoint servers A N. In one embodiment the network traffic shaping functionality may use a traffic shaping component of an operating system on the network access server to modify characteristics of incoming and outgoing network traffic. Using the endpoint selection functionality tunneling functionality and network traffic shaping functionality the network access server may provide secure network access having simulated network conditions to an endpoint server in a particular geographical location.

Each of the endpoint servers A N may comprise one or more computing devices any of which may be implemented by the example computing device illustrated in . In various embodiments portions of the functionality of the network simulation system including the network access server and the endpoint servers A N may be provided by the same computing device or by any suitable number of different computing devices. In some embodiments the network access server and or endpoint servers A N may be implemented as virtual compute instances or as physical compute instances. The virtual compute instances and or physical compute instances may be provisioned and maintained by a provider network that manages computational resources memory resources storage resources and network resources. A virtual compute instance may comprise one or more servers with a specified computational capacity which may be specified by indicating the type and number of CPUs the main memory size and so on and a specified software stack e.g. a particular version of an operating system which may in turn run on top of a hypervisor . One or more virtual compute instances may be implemented by the example computing device illustrated in .

In one embodiment a suitable component of the network simulation system may select and or provision the endpoint servers A N. For example the endpoint servers A N may be provisioned from a suitable pool of available computing instances. In one embodiment additional computing instances may be added to the endpoint servers A N as needed. In one embodiment computing instances may be returned to the pool of available computing instances from the endpoint servers A N if the computing instances are not needed at a particular point in time.

In one embodiment the functionality of aspects of the network simulation system including the network access server and or endpoint servers A N may be provided to clients using a provider network. For example the functionality of the network simulation system may be presented to clients as a web accessible service. A network set up by an entity such as a business or a public sector organization to provide one or more services such as various types of cloud based computing or storage accessible via the Internet and or other networks to a distributed set of clients may be termed a provider network. A provider network may include numerous data centers hosting various resource pools such as collections of physical and or virtualized computer servers storage devices networking equipment and the like that are used to implement and distribute the infrastructure and services offered by the provider. The resources may in some embodiments be offered to clients in units called instances such as virtual or physical compute instances or storage instances. A number of different types of computing devices may be used singly or in combination to implement the resources of the provider network in different embodiments including general purpose or special purpose computer servers storage devices network devices and the like.

In one embodiment a provider network may implement a flexible set of resource reservation control and access interfaces for clients. For example a provider network may implement a programmatic resource reservation interface e.g. via a web site or a set of web pages that allows clients to learn about select purchase access to and or reserve resources. In one embodiment the endpoint servers A N may be reserved by the network access server or any other suitable component using such an interface. In one embodiment the network access server may use one or more suitable interfaces such as one or more web pages an application programming interface API or a command line interface CLI to reserve and configure the endpoint servers A N.

In various embodiments the network access server may provide wired and or wireless access to the client devices A N. In one embodiment for example the network access server may implement or include a wireless access point to allow the client devices A N to connect to the wired network s over a wireless connection. Accordingly the network access server may manage a local wireless network which the client devices A N may discover and join. In one embodiment the network access server may provide network access to the endpoint servers A N to client devices A N that are geographically remote from the network access server but connected to the network access server over one or more public or private networks.

In one embodiment the network access server may comprise a client profiling functionality . The client profiling functionality may generate and or maintain different network traffic shaping profiles for the client devices A N. Each network traffic shaping profile also referred to herein as a network traffic profile a traffic shaping profile or a profile may describe network conditions that are sought to be simulated using the network traffic shaping functionality . Using the traffic shaping profiles different network conditions may be simulated for different client devices. In one embodiment different network conditions may be simulated for different client devices in a simultaneous or concurrent manner. The client profiling functionality may also maintain a geolocation selection for each of the client devices A N and the geolocation selection may be used to select one of the endpoint servers A N for a particular client. In one embodiment the client profiling functionality may generate and or maintain a different profile for each of the client devices A N that obtain network access through the network access server . In one embodiment two or more of the client devices A N may share a traffic shaping profile e.g. if the same or similar network conditions and the same geolocation are sought to be simulated for the client devices that share the profile. Using the client profiling functionality and the tunneling functionality the network access server may provide network access for multiple clients at any given time where each client has its own individual tunnel and traffic shaping profile. Further aspects of traffic shaping profiles are discussed below with reference to .

The geographical zones A N may reflect physical areas of any suitable size including hemispheres time zones continents nations states districts or other areas defined by political or geographical boundaries. In one embodiment the geographical zones A N may reflect business boundaries such as geographical zones served by different marketplaces offered by an online merchant. In one embodiment two or more of the geographical zones A N may overlap at least partially. In one embodiment any of the geographical zones A N may include locations that are not contiguous. In one embodiment at least some of the geographical zones A N may represent the locations of endpoint servers A N that are owned and or operated by the same entity that operates the network access server . In one embodiment at least some of the geographical zones A N may represent the locations of endpoint servers A N that are leased and not owned by the same entity that operates the network access server .

The client device A may seek to communicate with an external server and the external server may be located in a particular geographical zone B. In one embodiment the external server may implement a geolocation restriction such that it will acknowledge or conduct particular types of transactions only with clients within the same geographical zone B and possibly one or more additional zones . For example the external server may represent an online merchant online marketplace or other entity that provides data to or conducts transactions with clients only in particular locales. In one embodiment the external server may be determined based on the desired geolocation specified by the client device A. For example the external server may represent an online marketplace that serves clients in the specified geographical zone B and the external server may be selected from a set of external servers that represent online marketplaces for a variety of geographical zones. Accordingly the network simulation system may perform the following operations to allow the client device A to communicate with the external server .

In one embodiment the client device A may send to the network access server a packet A having a source address of the client device s address A and a destination address e.g. a web address or IP address of the external server . In one embodiment the traffic shaping profile and or the desired geographical zone B may be specified by the client device A using any suitable interface. Using the traffic shaping profile associated with the client device A the packet A may be processed by the network traffic shaping functionality e.g. to modify the latency and or packet loss of the traffic and or to respect a bandwidth cap etc. The endpoint server B may be selected for the packet A based on the desired geographical zone B as well as any other desired characteristics. When the packet is ready to be transmitted over the network s to the endpoint server B the network access server may determine which routing table to use for the packet. In one embodiment each routing table has a one to one relationship with a tunnel interface. The packet may be processed using network address translation NAT so that the source address is changed from the address A of the client device A to the external address B of the tunnel interface. In one embodiment the source port of the packet may be changed to a random port. The mapping for the modified address and the modified source port may be stored in a table so that packets received from the endpoint server B may be correctly routed back to the client device A. The modified packet B now having a source address B of the tunnel interface may be encapsulated encrypted and sent to the endpoint server B through the tunnel.

The endpoint server B may receive the packet B de encapsulate it and inspect the inner packet. The inner packet may include the source address B and the destination address of the external server . Using network address translation on the endpoint server B the source address of the packet may be changed to the address C of the endpoint server B and the source port may again be randomized. The mapping for the newly modified address and newly modified source port may be stored in a table for the routing of packets back to the client device A. The further modified packet C may be sent to the external server . The further modified packet C may be sent over one or more public networks e.g. the internet and the further modified packet C may not be encapsulated or encrypted. The external server may respond to the packet and the response may be sent back to the client device A using the tunnel between the endpoint server B and the network access server . Packets sent back to the client device A may be processed by the network traffic shaping functionality using the traffic shaping profile associated with the client device A e.g. to modify the latency and or packet loss of the traffic and or to respect a bandwidth cap etc.

In this manner the experience of a client with an online marketplace or other suitable server may be simulated by a user outside the geographical scope of the marketplace. The user may represent a customer service technician or other employee associated with the online marketplace. The client device may run a test suite to gather performance metrics under the simulated network conditions. The network access server may maintain different traffic shaping settings for individual client devices A N. By simulating various network conditions for customers in various geographical areas the customer experience on the online marketplace may be tested under the various network conditions and or from the various geographical locations. Accordingly the network simulation system may eliminate the need to maintain whitelists of IP addresses that bypass geolocation restrictions for access to the external server .

In one embodiment one of the client devices A N may specify the parameters associated with a profile using a suitable interface provided by the network access server and the client profiling functionality may generate and maintain a profile with the specified parameters. The interface s may include an application programming interface API and or a user friendly web based interface. In one embodiment one of the client devices A N may select from a set of predefined traffic shaping profiles using a suitable interface provided by the network access server . The predefined traffic shaping profiles may represent particular types of networks and or particular network conditions. For example the client profiling functionality may provide predefined profiles for simulating 3G wireless networks 4G wireless networks Edge wireless networks LTE wireless networks WiFi networks satellite based networks etc. Additionally the predefined profiles may include profiles for particular types of network conditions such as a 3G poor profile to simulate a low quality or degraded 3G network.

Each of the traffic shaping profiles A N may include one or more parameters describing network conditions to be simulated. In one embodiment each profile may include a latency parameter e.g. latency parameters A N to indicate a latency metric to be simulated a bandwidth parameter e.g. bandwidth parameters A N to indicate a bandwidth cap to be simulated and a packet loss parameter e.g. packet loss parameters A N to indicate a packet loss metric to be simulated. For example a profile for simulating a satellite based network may indicate a 5 ms latency a 1 megabit bandwidth cap and a 5 packet loss. As another example a profile for simulating an LTE network may indicate a 100 ms latency a 14 megabit bandwidth cap and a 0 packet loss. In one embodiment each of the profiles A N may include a desired geolocation e.g. geolocations A N to be simulated for one or more of the client devices A N. In this manner different networks or connection types may be simulated by maintaining different profiles for shaping or conditioning network traffic between a client device and a selected endpoint server.

In one embodiment a client device may change its associated traffic shaping profile at any time and on the fly. In other words a client device may request that a second set of packets be conditioned according to a second set of traffic shaping parameters after a first set of packets has already been conditioned according to a first set of traffic shaping parameters. Changing the traffic shaping profile for a client device may include changing the requested geolocation or maintaining the same geolocation.

As shown in one or more packets may be received at the network access server from the client device. As shown in traffic shaping may be performed on the one or more packets based on the traffic shaping parameters in the network traffic profile associated with the client. In one embodiment performing the traffic shaping may include modifying latency characteristics for the one or more packets enforcing a bandwidth cap and or dropping one or more packets based on a packet loss parameter.

As shown in an endpoint server may be selected to provide network access for the client device. The endpoint server may be selected by the network access server from a pool of available endpoint servers based on the geolocation requested by the client device and the geographical location of the selected endpoint server. For example the endpoint server may be selected because it is physically located within a particular geographical zone specified by the client device.

As shown in network traffic e.g. the one or more packets may be routed from the client device to an external server through the selected endpoint server. As discussed above with respect to the network traffic may be routed using simulated conditions based on the network traffic profile e.g. to modify the latency and or packet loss of the traffic and or to respect a bandwidth cap. A tunnel e.g. a VPN tunnel or other secure tunnel may be used to send the network traffic from the network access server to the selected endpoint server. Using tunneling and network address translation the traffic received at the external server may appear to originate from the selected endpoint server rather than from the client device or network access server. In this manner a geolocation restriction enforced by the external server may be bypassed.

In at least some embodiments a computer system that implements a portion or all of one or more of the technologies described herein may include a general purpose computer system that includes or is configured to access one or more computer readable media. illustrates such a general purpose computing device . In the illustrated embodiment computing device includes one or more processors coupled to a system memory via an input output I O interface . Computing device further includes a network interface coupled to I O interface .

In various embodiments computing device may be a uniprocessor system including one processor or a multiprocessor system including several processors and through e.g. two four eight or another suitable number referred to collectively as processors . Processors may include any suitable processors capable of executing instructions. For example in various embodiments processors may be general purpose or embedded processors implementing any of a variety of instruction set architectures ISAs such as the x86 PowerPC SPARC or MIPS ISAs or any other suitable ISA. In multiprocessor systems each of processors may commonly but not necessarily implement the same ISA.

System memory may be configured to store program instructions and data accessible by processor s . In various embodiments system memory may be implemented using any suitable memory technology such as static random access memory SRAM synchronous dynamic RAM SDRAM nonvolatile Flash type memory or any other type of memory. In the illustrated embodiment program instructions and data implementing one or more desired functions such as those methods techniques and data described above are shown stored within system memory as code i.e. program instructions and data .

In one embodiment I O interface may be configured to coordinate I O traffic between processor system memory and any peripheral devices in the device including network interface or other peripheral interfaces. In some embodiments I O interface may perform any necessary protocol timing or other data transformations to convert data signals from one component e.g. system memory into a format suitable for use by another component e.g. processor . In some embodiments I O interface may include support for devices attached through various types of peripheral buses such as a variant of the Peripheral Component Interconnect PCI bus standard or the Universal Serial Bus USB standard for example. In some embodiments the function of I O interface may be split into two or more separate components such as a north bridge and a south bridge for example. Also in some embodiments some or all of the functionality of I O interface such as an interface to system memory may be incorporated directly into processor .

Network interface may be configured to allow data to be exchanged between computing device and other devices attached to a network or networks such as other computer systems or devices for example. In various embodiments network interface may support communication via any suitable wired or wireless general data networks such as types of Ethernet network for example. Additionally network interface may support communication via telecommunications telephony networks such as analog voice networks or digital fiber communications networks via storage area networks such as Fibre Channel SANs or via any other suitable type of network and or protocol.

In some embodiments system memory may be one embodiment of a computer readable i.e. computer accessible medium configured to store program instructions and data as described above for implementing embodiments of the corresponding methods and apparatus. However in other embodiments program instructions and or data may be received sent or stored upon different types of computer readable media. Generally speaking a computer readable medium may include non transitory storage media or memory media such as magnetic or optical media e.g. disk or DVD CD coupled to computing device via I O interface . A non transitory computer readable storage medium may also include any volatile or non volatile media such as RAM e.g. SDRAM DDR SDRAM RDRAM SRAM etc. ROM etc that may be included in some embodiments of computing device as system memory or another type of memory. Further a computer readable medium may include transmission media or signals such as electrical electromagnetic or digital signals conveyed via a communication medium such as a network and or a wireless link such as may be implemented via network interface . Portions or all of multiple computing devices such as that illustrated in may be used to implement the described functionality in various embodiments for example software components running on a variety of different devices and servers may collaborate to provide the functionality. In some embodiments portions of the described functionality may be implemented using storage devices network devices or special purpose computer systems in addition to or instead of being implemented using general purpose computer systems. The term computing device as used herein refers to at least all these types of devices and is not limited to these types of devices.

Various embodiments may further include receiving sending or storing instructions and or data implemented in accordance with the foregoing description upon a computer readable medium. Generally speaking a computer readable medium may include storage media or memory media such as magnetic or optical media e.g. disk or DVD CD ROM volatile or non volatile media such as RAM e.g. SDRAM DDR RDRAM SRAM etc. ROM etc. In some embodiments a computer readable medium may also include transmission media or signals such as electrical electromagnetic or digital signals conveyed via a communication medium such as network and or a wireless link.

The various methods as illustrated in the Figures and described herein represent exemplary embodiments of methods. The methods may be implemented in software hardware or a combination thereof. In various of the methods the order of the steps may be changed and various elements may be added reordered combined omitted modified etc. Various of the steps may be performed automatically e.g. without being directly prompted by user input and or programmatically e.g. according to program instructions .

Various modifications and changes may be made as would be obvious to a person skilled in the art having the benefit of this disclosure. It is intended to embrace all such modifications and changes and accordingly the above description is to be regarded in an illustrative rather than a restrictive sense.

