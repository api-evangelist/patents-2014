---

title: Methods and apparatuses for abstracting filters in a network visibility infrastructure
abstract: Embodiments of the invention disclose methods for managing visibility filters in a plurality of network visibility infrastructure elements of a visibility network such that these network visibility infrastructure elements and their filters are managed as a network and filter configuring, packet replication, and redundancy are implemented efficiently from a centralized filter control module.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09571296&OS=09571296&RS=09571296
owner: IXIA
number: 09571296
owner_city: Calabasas
owner_country: US
publication_date: 20140430
---
The present invention relates to methods and apparatuses for improving network visibility in a network environment. More particularly the present invention relates in one or more embodiments to improvements in configuring and managing network visibility infrastructures in a network environment.

A network is typically formed of among others a large number of switching resources such as for example routers and switches and links. Data in the form of packets for example may be sent through the links of the network. By configuring the switches appropriately data packets may be sent from a given sender coupled to the network to a given receiver also coupled to the network although the sender and the receiver may be physically located far apart. The speed with which data packets are transferred from the sender to the receiver depends in part on the capacity and speed of the links as well as on the switching resources. The internet is an example of such a network and is well known and thus its basic operating principles will not be discussed in great details herein.

Network Packet Brokers NPB and network taps taps and mirroring ports on switching resources have long been incorporated into networks such as internal networks and or the internet to facilitate processing of data packets and or to route data packets to from network monitoring tools. These monitoring tools may include for example network analysis tools forensic tools various network monitoring tools firewalls malware prevention tools intrusion detection tools etc.

Generally speaking taps are implemented at specific points in the network to access the data traffic and pass the data whether the original data packets or the replicated copies thereof to the monitoring tools. NPBs on the other hand represent hardware and or software modules that perform among other tasks aggregation of monitored traffic which again can be the original data packets or replicated copies thereof from multiple links segments filtering and grooming of traffic to relieve overburdened monitoring tools load balancing traffic across a pool of monitoring tools and regeneration of traffic to multiple monitoring tools. Both taps and NPBs are available from vendors such as Ixia Corporation of Calabasas Calif.

Mirroring ports are ports implemented on the switching resources and are configured to send replicated data packets that traverse the switching resources which may be all traversing packets or a filtered set thereof .

To facilitate discussion shows the relationship between the production network the network visibility infrastructure and the network monitoring tools .

Production network represents the network of switching resources and links that is configured to transport data between the sender and the receiver. Network monitoring tools performs functions that are not directly related to the transport of packets through production network but are nevertheless necessary to ensure optimum performance of production network . These network monitoring functions include for example security application performance monitoring APM network performance monitor NPM malware detection intrusion detection as well as other network management tasks. The list above is not inclusive and these network monitoring functions are known to those skilled in the art.

Network visibility infrastructure comprises for example the taps the network packet brokers and the mirroring ports e.g. SPAN ports from Cisco Corporation of San Jose Calif. that are disposed at various nodes in production network to obtain data packets or copies thereof for use by network monitoring tools .

The couplings between network devices A C with NPB are accomplished using respective mirroring ports A C such as a SPAN or Switch Port Analyzer ports in the terminology of vendor Cisco Corporation of San Jose Calif. on the network devices. Data packets traversing each of NDs A C may be replicated and provided to respective mirroring ports which packets are then provided on respective links A C to respective ingress ports not shown of NPB . In this configuration NPB is said to be connected in an out of band configuration with respect to packets traversing NDs A C since the original packets continue on their way without traversing NPB while NPB receives the replicated packets from NDs A C for forwarding to one or more of the monitoring tools and .

Packets traversing between ND D and ND E can be tapped by tap which is coupled to both NDs D and E. In one example the packets from NDs D and E may be duplicated by tap and provided to NPB via links D and E respectively. In this configuration NPB is said to be connected in an out of band configuration with respect to packets traversing NDs D and E since the original packets continue on their way without traversing NPB while NPB receives the replicated packets from NDs D E.

In another example the packets from ND D may be intercepted by tap and redirected by tap to NPB and from NPB to one or more of the monitoring tools for further forwarding to an analysis tool such as analyzer before being routed to ND E if the result of the analysis indicates that such routing is permissible. Malware detection may be one such type of analysis. In this configuration NPB is said to be connected in an in line configuration since NPB is in the data path between ND D and ND E and packets must traverse NPB before reaching the destination.

Although only a few of the switching resources e.g. network devices are shown in it should be understood that a typical network may involve hundreds or thousands of these switching resources. Configuring and managing such a large number of switching resources are huge problems for network operators and thus network operators have turned to technologies such as Software Defined Networks SDNs to ease the task of configuring and managing the switching resources.

Generally speaking SDN decouples the switching hardware e.g. the actual packet processors or network processors that perform the switching from the control plane implemented at least by the operating system and may include applications . Without decoupling each network resource such as a switch or a router would have its own forwarding hardware controlled by its own applications executing on its own operating system. Any change in the configuration and management of the network or links thereof tends to involve reconfiguring a large number of associated switching resources using local applications executed on each of the switching resources.

SDN implements an abstracted operating system control module and applications are executed on this abstracted operating system. The switching hardware circuitry and some control logic e.g. packet processors or network processors are implemented locally at each of the switching resources. The applications abstracted operating system communicate with the switching hardware at each of the switching resources via well established standard such as OpenFlow Open Software Foundation ONF https www.opennetworking.org .

In SDN if a change needs to be made to an application and or to the operating system it is no longer necessary to make the change on each of the switching resources. Instead the change can be made at the centralized applications and or the abstracted operating system thereby simplifying configuration and or maintenance. To put it differently SDN permits the network operator to configure and manage the switching resources of the network from a centralized location using a software centric paradigm.

Although taps network packet brokers and mirroring ports are also disposed throughout the network these network visibility resources are not considered switching resources and thus far there has been no way to manage the network visibility infrastructures as an integrated network. There is however a need to also reduce the configuration and or maintenance burden associated with implementing a large number of these network visibility resources over vast distances as well as to better integrate network visibility into network traffic management and routing. Addressing these needs are one among many goals of embodiments of the present invention.

The invention relates in an embodiment to a method for managing visibility filters in a plurality of network visibility infrastructure elements of a visibility network. The plurality of network visibility infrastructure elements is configured for redirecting packets to monitoring tools. The packets represent packets transmitted by a switching network or packets generated from the packets transmitted by the switching network. The method includes providing a plurality of filters wherein at least one filter of the plurality of filters is associated with each of the plurality of network visibility infrastructure elements. The method also includes providing a centralized filter control module that has information pertaining network ports tool ports and visibility element ports of the plurality of network visibility infrastructure elements. The centralized filter control module is disposed remotely from and communicably coupled with each of the plurality of filters. The method further includes configuring the filters by specifying for each of the filters information pertaining to network port filter parameters action to be taken and tool port wherein the configuring is performed using the centralized filter control module.

In another embodiment the invention relates to a method for managing packet duplication in a plurality of network visibility infrastructure elements of a visibility network. The plurality of network visibility infrastructure elements is configured for redirecting packets to monitoring tools. The packets represent packets transmitted by a switching network or packets generated from the packets transmitted by the switching network. The method includes providing the plurality of network visibility infrastructure elements. The method also includes providing a plurality of filters wherein at least one filter of the plurality of filters is associated with each of the plurality of network visibility infrastructure elements. The method further includes providing a centralized filter control module that has information pertaining ports of the plurality of network visibility infrastructure elements. The centralized filter control module is disposed remotely from and communicably coupled with each of the plurality of filters. The method yet also includes implementing hierarchical packet duplication using the centralized filter control module such that if a packet is destined toward multiple destination ports of the plurality of network visibility infrastructure elements the packet is duplicated only by the network visibility infrastructure element disposed immediately before physical paths toward the direction of the multiple destination ports diverge and such that multiple copies of the packet do not traverse the same physical hop between two network visibility infrastructure elements while being transmitted between an origination port of one of the plurality of network visibility infrastructure elements toward the multiple destination ports.

In yet another embodiment the invention relates to a method for implementing redundancy in a visibility network which has a plurality of network visibility infrastructure elements configured for redirecting packets to monitoring tools. The packets represent packets transmitted by switching elements of a switching network or packets generated from the packets transmitted by switching elements of the switching network. The method includes providing the plurality of network visibility infrastructure elements. The method also includes providing a plurality of filters wherein at least one filter of the plurality of filters is associated with each of the plurality of network visibility infrastructure elements. The method further includes providing a centralized filter control module wherein the centralized filter control module has information pertaining ports of the plurality of network visibility infrastructure elements. The centralized filter control module is disposed remote from and communicably coupled with each of the plurality of filters. The method yet also includes ascertaining utilizing the information whether communication between a given switching element of the switching network and a given monitoring tool of the monitoring tools has multiple possible paths. The method yet further includes switching from a first path of the multiple possible paths to a second path of the multiple possible paths if the communication using first path experiences failure.

The present invention will now be described in detail with reference to a few embodiments thereof as illustrated in the accompanying drawings. In the following description numerous specific details are set forth in order to provide a thorough understanding of the present invention. It will be apparent however to one skilled in the art that the present invention may be practiced without some or all of these specific details. In other instances well known process steps and or structures have not been described in detail in order to not unnecessarily obscure the present invention.

Various embodiments are described hereinbelow including methods and techniques. It should be kept in mind that the invention might also cover articles of manufacture that includes a computer readable medium on which computer readable instructions for carrying out embodiments of the inventive technique are stored. The computer readable medium may include for example semiconductor magnetic opto magnetic optical or other forms of computer readable medium for storing computer readable code. Further the invention may also cover apparatuses for practicing embodiments of the invention. Such apparatus may include circuits dedicated and or programmable to carry out tasks pertaining to embodiments of the invention. Examples of such apparatus include a general purpose computer and or a dedicated computing device when appropriately programmed and may include a combination of a computer computing device and dedicated programmable circuits adapted for the various tasks pertaining to embodiments of the invention.

Embodiments of the invention relate to methods and apparatus for implementing and managing the network visibility infrastructure elements as a network. As the term is employed herein the network visibility infrastructure elements include the resources that provide original redirected or replicated packets to network monitoring tools. In this disclosure taps network packet processors and mirroring ports are employed as examples of the network visibility infrastructures although these examples are not limiting. The monitoring tools may include for example and without limitation network analysis tools forensic tools various network monitoring tools firewalls malware prevention tools intrusion detection tools etc.

In one or more embodiments the control plane is decoupled from the forwarding hardware plane of the network visibility infrastructure element such that the control plane may be abstracted. By abstracting the control plane and the application plane from the actual forwarding hardware at each of the network visibility infrastructure elements it is possible to modularize the architecture such that while the forwarding hardware still resides at each of the network visibility infrastructure elements dispersed throughout the network the operating system and the applications may be abstracted and remotely located.

Application Programming Interfaces APIs and interoperability modules are established between the abstracted operating system and the forwarding hardware such that the forwarding hardware can be readily provisioned on a plug and play basis at the network visibility infrastructure elements as long as they comply with the APIs and pre established logical architecture. Communication between the abstracted operating system and its associated forwarding hardware may follow a standard analogous to for example OpenFlow .

The centralization of the control elements associated with the abstracted operating system which may be implemented remote from the network visibility resource elements themselves provides opportunities for more efficient configuration and management of the network visibility resource elements as well as integrated with existing SDNs.

These and other features and advantages of embodiments of the invention may be understood with reference to the figures and discussions that follow.

In the example of since the operating system such as is implemented locally at the network visibility infrastructure element such as NPB the control plane and the hardware forwarding plane including for example the forwarding hardware are tightly coupled. If changes to the OS are required these changes need to be made at each operating system of each NPB.

Further since the applications such as is implemented locally at the network visibility infrastructure element such as NPB and executes on the operating system disposed locally the application plane and the forwarding plane including for example the forwarding hardware are also tightly coupled. If changes to the application are required these changes need to be made to the application program installed in each NPB.

Further since each network visibility infrastructure element is treated as a stand alone component in the sense that they are not coordinated with one another it is difficult to manage the network visibility infrastructure elements as a network. As well it is difficult to obtain a network wide view of the network from the independently operating network visibility infrastructure elements. Still further coordination among the network visibility infrastructure elements for purposes such as load balancing and conflict resolution between network requirements and tool capabilities are cumbersome and difficult if not impossible.

In contrast to the arrangement of the operating system i.e. control plane of the network visibility infrastructure elements has been abstracted from the network visibility infrastructure elements and implemented as a software implemented network operating system such as on an actual or virtual server . Applications such as execute on this software implemented network operating system and thus do not need to be executing at each network visibility infrastructure element.

The abstracted network visibility infrastructure operating system communicates with each of the network visibility infrastructure elements using pre defined APIs Application Programming Interface such that any forwarding hardware complying to the API can be employed for network visibility purposes. In this manner the network visibility infrastructure elements can be provisioned on a plug and play basis at any location on the network and configuration and or maintenance of these network visibility infrastructure elements may be performed at a central location via applications executing on the abstracted network visibility infrastructure operating system.

It should be understood that it is not absolutely required that all operating system functionalities of the network visibility infrastructure elements be abstracted. In one or more embodiments the network visibility infrastructure operating system may implement some operating system functionalities and software and or firmware local to the network visibility infrastructure elements may implement other operating system functionalities. Preferably the network visibility infrastructure operating system implements functionalities that can benefit from centralization such as for example and without limitation custom parameter settings for the network visibility infrastructure elements and or the tools while software and or firmware local to the network visibility infrastructure elements may implement other operating system functionalities that would be more beneficially implemented locally e.g. to reduce demand on network bandwidth and to facilitate fast provisioning . The exact allocation of operating system functionalities between local software firmware and network visibility infrastructure operating system can vary as desired.

In one or more embodiments the communication to from the forwarding hardware and or the network visibility infrastructure operating system in the control plane is accomplished by implementing a common logical architecture for the network visibility functions including for example all or some of the functions to provision to configure to communication with and or to maintain the network visibility infrastructure and or the network monitoring tools . For actual communication between the controlling function e.g. the aforementioned abstracted network visibility infrastructure operating system and the forwarding hardware APIs and protocols may be predefined in advance. In this manner any forwarding hardware communicating using the common logical architecture and API protocol may communicate with the abstracted network visibility infrastructure operating system and vice versa.

In an embodiment the inventor herein realizes that although the OpenFlow standard for software defined networks See OpenFlow Switch Specification published by the Open Networking Foundation ONF https www.opennetworking.org does not contemplate the visibility infrastructure as a network the visibility infrastructure could benefit from being configured and managed as a network that co exists with the OpenFlow managed switching network. To this end the OpenFlow protocol and logical architecture are augmented to also be employed to configure and manage the visibility infrastructures i.e. the taps NPBs and mirroring ports that have heretofore been regarded as stand alone devices by OpenFlow .

In one or more embodiments extensions are made to the logical architecture of OpenFlow and the OpenFlow specification is augmented with APIs and logical models for communicating with the modular forwarding hardware of the network visibility infrastructure elements and with the abstracted control plane of the network visibility infrastructure. In this manner OpenFlow can be used to configure and manage both the switching network and the network visibility infrastructure.

For example there are APIs that exist in OpenFlow that can be used as is at network visibility infrastructure such as packet redirecting to a destination port. There are also OpenFlow functionalities such as redirecting packets to a LAG link aggregation port that can be used at the network visibility infrastructure device as a load balancing group. There are APIs that need to be added to OpenFlow such as strict load balancing group where traffic distribution is consistent upon link failure.

Additionally there is implemented a network controller SDN control software which implements the control layer Operating System and the aforementioned logical architecture and APIs necessary to allow the control layer Operating System to be abstracted from the data path forwarding hardware and to facilitate communication between the control layer Operating System and the data path forwarding hardware over network links. Through established APIs and applications providing L L service functions at the application layer may be executed on the abstracted Operating System of control layer .

Further there are implemented Data Path Layer Interoperability module and Control Layer Interoperability module representing modules for communicating with the tools shown in by representative Deep Packet Analysis . In one or more embodiments these modules permit direct configuration of the network visibility infrastructure. Network visibility resources such as taps mirroring ports and NPBs may be pre allocated to the monitoring tools if desired. As well the tools may manage their resources directly without involvement of the applications at the application layer and SDNV . For example filter configuration bandwidth management the management and configuration of tunnels packet attributes threshold crossing alerts as well as other alerts may be managed without involvement of the applications at the application layer and SDNV . To elaborate although SDNV is a central management of the network visibility infrastructure it is highly desired to allow a fast configuration and a dedicated resources to the tools. For example an intrusion detection tool can quickly react to a suspicious traffic and configured the NPB to redirect a specific traffic the dedicated resource is the TCAM i.e. reserved classification entries at the NPB. This feature is possible by using the NVI .

There is further an Application Layer Interoperability Module for facilitating communication from the monitoring tools and the production network controller to the network visibility infrastructure. In this manner network visibility applications can directly communicate with the tools and the production network controller and configure and or manage the network visibility infrastructure as a network. Example not exhaustive or limiting of such applications include filter abstraction management network visibility SLA Service Level Agreement control SmartTap management such as managing and configuration of tunnel packet attributes threshold crossing alerts as well as other alerts etc. As is known SmartTap provides the ability to control which attributes to filter and the exact tunneling along with simple configuration management thereof. Further details pertaining to the SmartTap product may be obtained from Ixia Corporation of Calabasas Calif.

An example advantage of having a network view or of managing the network visibility infrastructure pertaining to the network monitoring management function as a network alongside the software defined network pertaining to the switching function is the ability to resolve conflicts between tool requirements and network requirements. For example if the network bandwidth management SLA calls for a particular SLA requirement and this network bandwidth SLA requirement conflicts with the tool s specification such as bandwidth capability of the tool a network view of the tools and the network would enable applications in the application layer to detect such discrepancy to configure the tools to adapt such as load balancing or additional visibility resource provisioning to the network bandwidth SLA requirement or to raise alerts with the network operator. This is particularly true if both the software defined network and the network visibility infrastructure follow or are based upon the OpenFlow standard.

As can be appreciated from the foregoing embodiments of the invention define and implement a network visibility infrastructure that can be configured and managed as a network based on the open network concept and the OpenFlow standard. With this approach both the switching network and the network visibility infrastructure can be managed as networks and more importantly can be managed together to consolidate network and tool requirements capabilities to provide greater insight into network operation as well as flexibility and efficiency as far as detecting conflicts configuration and management of the network visibility infrastructure elements as well as configuration and management of the monitoring tools.

Furthermore one or more embodiments of the invention decouple the control and forwarding functions of the network visibility infrastructure elements such as taps and NPBs to allow abstraction of the control layer. One or more embodiments of the invention enable network visibility control to be directly programmable and the underlying infrastructure to be abstracted for network visibility services. By adopting the software defined network concept and the OpenFlow standard albeit slightly modified to handle the network visibility infrastructures and requirements capabilities thereof one or more embodiments promote a unified management capability that integrates both networks. In one or more embodiments network control network traffic SLA for inline packets for example can be directly programmable. Further tool traffic SLA and packets attributes associated with network monitoring tools and security systems can be directly programmable.

In accordance with one or more embodiments of the invention network visibility filters can be abstracted and managed abstractly to significantly ease the burden associated with filter provisioning and configuration.

As the term is employed herein a visibility filter refers to a filter implemented on a network visibility infrastructure element such as a network packet broker or tap to classify packets the result of the classification being the basis for further action by the network visibility infrastructure element. In the following paragraphs network packet brokers will be employed as primary examples to discuss the details of embodiments of the visibility filter abstraction invention. However it should be understood that principles of the invention are not limited to network packet brokers or any particular type of network visibility infrastructure element.

Visibility filters are deployed at network visibility infrastructure elements to classify packets so that the network visibility infrastructure element can ascertain what action to take with regard to the received packet. Filters can be based on the ingress port e.g. which ingress port of the NPB received this packet on the source or destination MAC Media Access Controller address on the source or destination IP address on the protocol e.g. TCP IP versus UDP or on any other attribute that can be ascertained from the header and or content of packets themselves. Actions that may be taken may include without limitation redirecting the packet to another port duplicating the packet dropping the packet counting the packet limiting the packet rate limit the flow associated with the packet etc.

In the past filter configuration has always been performed at the network visibility infrastructure element on an element by element basis. The network operator has to have knowledge of the identity of the network visibility infrastructure elements involved where the network visibility infrastructure elements are implemented in the network as well as other network connectivity parameters associated with the network visibility infrastructure element configuration.

Further since the network visibility infrastructure elements are not managed together as a network each NPB has to do its own classification in order to ascertain what action to take with respect to an incoming packet. When stacked NPBs are employed i.e. when multiple NPBs are in the path between the switching network and the tool such as the case when the egress port of one NPB is coupled to the ingress port of another NPB packet replication is not coordinated and is not always hierarchical leading to inefficient use of NPB resources. Still further since the network visibility infrastructure elements are not managed together as a network the failure of a NVIE often means monitoring is unavailable or implementing alternate routing to from the affected monitoring tools would be cumbersome and time consuming although there may exists other NVIEs already coupled to the switching network and or the tools and which can serve as redundancy backups.

In accordance with one or more embodiments of the invention the network visibility infrastructure elements NVIE are managed together as a network and all their ports are known to a centralized filter control module. If there are 6 NVIEs and each has 10 ports for example the centralized filter control module would have a network level knowledge that 60 ports exist. The centralized filter control module further has knowledge whether a given NVIE port is coupled to the switching network or to the tool network or to another NVIE such as in a stacked NPB arrangement . This information may be ascertained by the centralized filter control module by an auto discovery process by registration from the NVIEs as each NVIE is coupled to the network or is powered on or by a human operator entering the NVIE data into the centralized filter control module.

In accordance with one or more embodiments the NVIE ports are classified into one of three types network port tool port or NPB NPB port. A network port represents a NVIE port that is coupled to the switching network such as to a switch or a router to exchange data packets with the switching network. The network port represents the first NVIE port along the switching network to monitoring tool path that receives the packet.

A tool port represents a NVIE port that is coupled to the monitoring tool to exchange data packets with the monitoring tool. The tool port represents the last NVIE egress port that touches the packet before the packet is received by the monitoring tool along the switching network to monitoring tool path.

A NPB NPB port represents an NPB port that is coupled to another NPB port for internal routing purposes among the network of NPBs. NPB NPB ports exist because some switching network to monitoring tool path may involve traversal of multiple networked NPBs. NPB NPB port is a subset of a class of ports known as visibility element port since visibility elements include NPBs but also includes taps mirroring ports etc. In the following example NPB NPB ports will be employed for discussion although it should be understood that embodiments of the invention also apply to visibility element ports in general.

The user may then configure a filter simply as a function of the network port the tool port the filtering parameters and the action to be taken. The user may then provide this filter specification to the centralized filter control module to accomplish filtering. Note that this filter abstraction does not require the user to know the identity of the NVIE s involved where the NVIE s is are located or how the NVIE s is are connected to the rest of the network.

As an example a filter specification may have the format of Network Ports Filter Parameters Action to be Taken Tool Ports for packets destined from the switching network to the monitoring tools. As a concrete example the filter may read network port IP source Address 123.11.101.42 redirected to tool port . With this filter any packet arriving at network port that has the IP source address 123.11.101.42 would be redirected by the NVIE to tool port . Note that it is unnecessary for the user to know the exact location of the NVIE that implements network port or the exact location of the NVIE that implements tool port or the connectivity details of these NVIEs in order to configure and implement the filter.

Filter management is thus abstracted to four parameters Network Port Filter parameters Action to be Taken Tool Port. The centralized filter control module then computes the path to be taken including any traversal of multiple stacked NPBs between the specified network port and the specified tool port. This computation is familiar to one skilled in the art and is possible because the centralized filter control module knowledge of all the NVIEs and their locations and their ports and manage them as a network.

If the NVIE network is inline i.e. the data packet would be sent back to the switching network after monitoring the filter specification for the return path may read Tool port. Filter Parameters Action to be Taken Network Port . As a concrete example the filter may read Tool port MAC source Address 00 0a 95 9d 68 16 redirected to network port . With this filter any packet arriving at tool port that has the MAC source address 00 0a 95 9d 68 16 would be redirected by the NVIE to network port . Again note that it is unnecessary for the user to know the exact location of the NVIE that implements network port or the exact location of the NVIE that implements tool port or the connectivity details of these NVIEs to configure and implement the filter.

Filtering may take many forms for example first match or all matches regular expressions programmable lookup or TCAM based. If TCAM based the filtering may involve multiple lookups packet depth parameters TCAM entry length parameters number of entries and or pre TCAM engines range port group etc. . The list is intended only as examples and not exhaustive nor limiting.

In accordance with one or more embodiments of the invention packet classification is done only at first NVIE along the switching network to monitoring tool path for out of band traffic. For inline traffic packet classification may also be done at the first NVIE along the return monitoring tool to switching network path.

NPB is communicatively coupled to NPB . NPB is communicatively coupled to NPB . NPB is communicatively coupled to tap . Two ports N and N of tap are coupled to switch and router of production network . One port N of NPB is coupled to router while one port N of NPB is coupled to switch .

On the tool side two ports T and T of NPB are communicatively coupled to IPS Intrusion Prevention System . A port T of NPB is communicatively coupled to remote network monitoring RMON . A port T of NPB is communicatively coupled to analyzer while a port T of NPB is communicatively coupled to firewall .

Central Filter Control Module which is implemented as part of the remoted control plane has knowledge of ports N N as well as ports T T. Ports N N are network ports since they are communicatively coupled to switches and routers of the switching network while ports T T are tool ports since they are communicatively coupled to the tools .

Further if a user filter specification specifies for example redirecting the packet from network port N to tool port T upon satisfying the filter criteria central filter control module would be able to ascertain the path from network port N through tap through NPB NPB NPB and egress out tool port T of NPB since central filter control module not only has knowledge of the existence and specifications of ports N N and T T but also the connectivity details of network visibility infrastructure .

As mentioned in an embodiment only the first NVIE in the switching network to monitoring tool needs to perform the packet classification in accordance with an embodiment. For example if a filter specifies redirecting from network port N to tool port T and tool port T upon satisfying the filter criteria only NPB associated with network port N needs to perform the classification to derive a unique flow ID for internal use by the network visibility infrastructure . Although NPB and NPB would be in the switching network to monitoring tool path redirection by NPB and NPB may be performed based on this flow ID without the need for packet classification by NPB and NPB .

For inline packets that need to be returned to the switching network after being sent to tools only the first NVIE in the monitoring tool to switching network path needs to perform the packet classification in accordance with an embodiment. For example if a filter specifies redirecting the packet from tool port T to network port N upon satisfying the filter criteria only NPB associated with tool port T needs to perform the classification to derive a unique flow ID for internal use by the network visibility infrastructure . Although NPB and tap would be in the monitoring tool to switching network path redirection by NPB and tap may be performed based on this flow ID without the need for packet classification by NPB and tap .

In other embodiments packet classification can be performed on a hop by hop basis if desired. If such is the case there is also no need for the user to be aware of the internal structure of the Network Visibility Infrastructure.

Since the NVIEs are implemented as a network hierarchical packet replication may be managed by the centralized filter control module. This is an advantage of managing the NVIEs as a network with abstracted control since replication can be performed more efficiently. As an example consider a filter that specifies replicating the packet from network port N to tool ports T T and T upon satisfying the filter criteria. In this case NPB performs the classification as mentioned earlier and redirects the packet to NPB . NPB redirects the packet to port T while replicating a copy of the packet to send to NPB . Note that only one copy is sent to NPB so save on visibility network bandwidth as well as processing cycles time by NPB although the filter specifies that both ports T and T also receive replicated packets. At NPB the packet is then replicated and sent to ports T and T. This hierarchical replication may be precomputed in advance by the centralized filter control module since the centralized filter control module has a network view of the NVIEs.

In this manner if a packet needs to be replicated to multiple ports e.g. packet A to ports B C and D thus forming multiple logical paths A B A C and A D such packet is not replicated if the multiple logical paths traverse the same physical hop between two network visibility infrastructure elements. If the physical communication paths diverge toward different destination ports e.g. ports B C or D and it is no longer possible for the multiple logical paths to share a physical hop between two network visibility infrastructure elements the last possible network visibility infrastructure elements shared by the multiple logical paths will perform duplication prior to sending multiple packets toward different destinations via different physical paths. One can visualize this hierarchical packet replication as traversing a root system of a tree wherein the packet to be duplicated traverses from the upper portion of the root system toward the tips of the roots and only gets replicated at the location where the root splits into two or more physical paths toward the root tips. Prior to a root split location it is not necessary to have multiple copies traversing the same physical hop portion of the root .

As a general rule filters tend to be implemented only for NPBs connected to the network ports to handle inline and out of band traffic to the tools or NPBs that are connected to the tool ports to handle inline traffic that is returned from the tools to the network . Internal ports i.e. NPB NPB ports are provisioned with filters for the packet redirection functionality to redirect packets from the switching network to the tools or to redirect packets from the tools to the switching network and to optimize hierarchical replication of inline packets. NPB NPB port filters may be triggered by flow ID in one or more embodiments. In this manner a smaller TCAM may be used to service these NPB NPB ports since deep packet inspection is not necessary.

It should be noted that although the use of flow IDs is contemplated embodiments of the invention also involve classification at every NVIE that needs to take action with respect to the packet it receives. Thus the use of flow IDs is an optimization and not a requirement to implement filter abstraction.

The fact that the filters are managed together as network also means that it is possible to quickly and efficiently reconfigure filters in the network visibility infrastructures to provide high availability when there are changes in the network visibility infrastructure. As an example if there are redundant routes from a given network port to a tool port the failure of a NPB port or an entire NPB would trigger reconfiguring the filter specification to redirect the packets along the redundant route thereby improving overall availability of the visibility network.

As can be appreciated from the foregoing embodiments of the invention significantly ease user and application filter configuration. By managing the NVIEs as a network and by abstracting the filters to the network ports and tool ports the user and applications do not have to know the identity of the NVIE involved where the NVIE is located or the connectivity details of the network visibility infrastructure elements.

While this invention has been described in terms of several preferred embodiments there are alterations permutations and equivalents which fall within the scope of this invention. Although various examples are provided herein it is intended that these examples be illustrative and not limiting with respect to the invention.

Also the title and summary are provided herein for convenience and should not be used to construe the scope of the claims herein. Further the abstract is written in a highly abbreviated form and is provided herein for convenience and thus should not be employed to construe or limit the overall invention which is expressed in the claims. If the term set is employed herein such term is intended to have its commonly understood mathematical meaning to cover zero one or more than one member. It should also be noted that there are many alternative ways of implementing the methods and apparatuses of the present invention. It is therefore intended that the following appended claims be interpreted as including all such alterations permutations and equivalents as fall within the true spirit and scope of the present invention.

